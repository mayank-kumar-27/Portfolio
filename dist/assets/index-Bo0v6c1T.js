var _Q=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var nke=_Q((uke,IZ)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function O8(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var B8={exports:{}},PS={},U8={exports:{}},Cn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A1=Symbol.for("react.element"),bQ=Symbol.for("react.portal"),SQ=Symbol.for("react.fragment"),EQ=Symbol.for("react.strict_mode"),CQ=Symbol.for("react.profiler"),MQ=Symbol.for("react.provider"),TQ=Symbol.for("react.context"),RQ=Symbol.for("react.forward_ref"),AQ=Symbol.for("react.suspense"),IQ=Symbol.for("react.memo"),PQ=Symbol.for("react.lazy"),bF=Symbol.iterator;function kQ(n){return n===null||typeof n!="object"?null:(n=bF&&n[bF]||n["@@iterator"],typeof n=="function"?n:null)}var z8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},V8=Object.assign,W8={};function tg(n,e,t){this.props=n,this.context=e,this.refs=W8,this.updater=t||z8}tg.prototype.isReactComponent={};tg.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};tg.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function H8(){}H8.prototype=tg.prototype;function I4(n,e,t){this.props=n,this.context=e,this.refs=W8,this.updater=t||z8}var P4=I4.prototype=new H8;P4.constructor=I4;V8(P4,tg.prototype);P4.isPureReactComponent=!0;var SF=Array.isArray,G8=Object.prototype.hasOwnProperty,k4={current:null},$8={key:!0,ref:!0,__self:!0,__source:!0};function j8(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)G8.call(e,r)&&!$8.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var u=Array(a),l=0;l<a;l++)u[l]=arguments[l+2];i.children=u}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:A1,type:n,key:o,ref:s,props:i,_owner:k4.current}}function DQ(n,e){return{$$typeof:A1,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function D4(n){return typeof n=="object"&&n!==null&&n.$$typeof===A1}function NQ(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var EF=/\/+/g;function a3(n,e){return typeof n=="object"&&n!==null&&n.key!=null?NQ(""+n.key):e.toString(36)}function d_(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case A1:case bQ:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+a3(s,0):r,SF(i)?(t="",n!=null&&(t=n.replace(EF,"$&/")+"/"),d_(i,e,t,"",function(l){return l})):i!=null&&(D4(i)&&(i=DQ(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(EF,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",SF(n))for(var a=0;a<n.length;a++){o=n[a];var u=r+a3(o,a);s+=d_(o,e,t,u,i)}else if(u=kQ(n),typeof u=="function")for(n=u.call(n),a=0;!(o=n.next()).done;)o=o.value,u=r+a3(o,a++),s+=d_(o,e,t,u,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function m2(n,e,t){if(n==null)return n;var r=[],i=0;return d_(n,r,"","",function(o){return e.call(t,o,i++)}),r}function LQ(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ts={current:null},p_={transition:null},FQ={ReactCurrentDispatcher:ts,ReactCurrentBatchConfig:p_,ReactCurrentOwner:k4};function X8(){throw Error("act(...) is not supported in production builds of React.")}Cn.Children={map:m2,forEach:function(n,e,t){m2(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return m2(n,function(){e++}),e},toArray:function(n){return m2(n,function(e){return e})||[]},only:function(n){if(!D4(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Cn.Component=tg;Cn.Fragment=SQ;Cn.Profiler=CQ;Cn.PureComponent=I4;Cn.StrictMode=EQ;Cn.Suspense=AQ;Cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=FQ;Cn.act=X8;Cn.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=V8({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=k4.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(u in e)G8.call(e,u)&&!$8.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=t;else if(1<u){a=Array(u);for(var l=0;l<u;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:A1,type:n.type,key:i,ref:o,props:r,_owner:s}};Cn.createContext=function(n){return n={$$typeof:TQ,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:MQ,_context:n},n.Consumer=n};Cn.createElement=j8;Cn.createFactory=function(n){var e=j8.bind(null,n);return e.type=n,e};Cn.createRef=function(){return{current:null}};Cn.forwardRef=function(n){return{$$typeof:RQ,render:n}};Cn.isValidElement=D4;Cn.lazy=function(n){return{$$typeof:PQ,_payload:{_status:-1,_result:n},_init:LQ}};Cn.memo=function(n,e){return{$$typeof:IQ,type:n,compare:e===void 0?null:e}};Cn.startTransition=function(n){var e=p_.transition;p_.transition={};try{n()}finally{p_.transition=e}};Cn.unstable_act=X8;Cn.useCallback=function(n,e){return ts.current.useCallback(n,e)};Cn.useContext=function(n){return ts.current.useContext(n)};Cn.useDebugValue=function(){};Cn.useDeferredValue=function(n){return ts.current.useDeferredValue(n)};Cn.useEffect=function(n,e){return ts.current.useEffect(n,e)};Cn.useId=function(){return ts.current.useId()};Cn.useImperativeHandle=function(n,e,t){return ts.current.useImperativeHandle(n,e,t)};Cn.useInsertionEffect=function(n,e){return ts.current.useInsertionEffect(n,e)};Cn.useLayoutEffect=function(n,e){return ts.current.useLayoutEffect(n,e)};Cn.useMemo=function(n,e){return ts.current.useMemo(n,e)};Cn.useReducer=function(n,e,t){return ts.current.useReducer(n,e,t)};Cn.useRef=function(n){return ts.current.useRef(n)};Cn.useState=function(n){return ts.current.useState(n)};Cn.useSyncExternalStore=function(n,e,t){return ts.current.useSyncExternalStore(n,e,t)};Cn.useTransition=function(){return ts.current.useTransition()};Cn.version="18.3.1";U8.exports=Cn;var H=U8.exports;const q8=O8(H);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OQ=H,BQ=Symbol.for("react.element"),UQ=Symbol.for("react.fragment"),zQ=Object.prototype.hasOwnProperty,VQ=OQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,WQ={key:!0,ref:!0,__self:!0,__source:!0};function Y8(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)zQ.call(e,r)&&!WQ.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:BQ,type:n,key:o,ref:s,props:i,_owner:VQ.current}}PS.Fragment=UQ;PS.jsx=Y8;PS.jsxs=Y8;B8.exports=PS;var G=B8.exports,K8={exports:{}},da={},Z8={exports:{}},Q8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(F,U){var L=F.length;F.push(U);e:for(;0<L;){var j=L-1>>>1,Q=F[j];if(0<i(Q,U))F[j]=U,F[L]=Q,L=j;else break e}}function t(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var U=F[0],L=F.pop();if(L!==U){F[0]=L;e:for(var j=0,Q=F.length,K=Q>>>1;j<K;){var ie=2*(j+1)-1,pe=F[ie],we=ie+1,ce=F[we];if(0>i(pe,L))we<Q&&0>i(ce,pe)?(F[j]=ce,F[we]=L,j=we):(F[j]=pe,F[ie]=L,j=ie);else if(we<Q&&0>i(ce,L))F[j]=ce,F[we]=L,j=we;else break e}}return U}function i(F,U){var L=F.sortIndex-U.sortIndex;return L!==0?L:F.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var u=[],l=[],c=1,h=null,f=3,d=!1,p=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(F){for(var U=t(l);U!==null;){if(U.callback===null)r(l);else if(U.startTime<=F)r(l),U.sortIndex=U.expirationTime,e(u,U);else break;U=t(l)}}function b(F){if(v=!1,_(F),!p)if(t(u)!==null)p=!0,z(S);else{var U=t(l);U!==null&&V(b,U.startTime-F)}}function S(F,U){p=!1,v&&(v=!1,m(R),R=-1),d=!0;var L=f;try{for(_(U),h=t(u);h!==null&&(!(h.expirationTime>U)||F&&!P());){var j=h.callback;if(typeof j=="function"){h.callback=null,f=h.priorityLevel;var Q=j(h.expirationTime<=U);U=n.unstable_now(),typeof Q=="function"?h.callback=Q:h===t(u)&&r(u),_(U)}else r(u);h=t(u)}if(h!==null)var K=!0;else{var ie=t(l);ie!==null&&V(b,ie.startTime-U),K=!1}return K}finally{h=null,f=L,d=!1}}var E=!1,C=null,R=-1,T=5,A=-1;function P(){return!(n.unstable_now()-A<T)}function k(){if(C!==null){var F=n.unstable_now();A=F;var U=!0;try{U=C(!0,F)}finally{U?W():(E=!1,C=null)}}else E=!1}var W;if(typeof x=="function")W=function(){x(k)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,O=N.port2;N.port1.onmessage=k,W=function(){O.postMessage(null)}}else W=function(){g(k,0)};function z(F){C=F,E||(E=!0,W())}function V(F,U){R=g(function(){F(n.unstable_now())},U)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_continueExecution=function(){p||d||(p=!0,z(S))},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(F){switch(f){case 1:case 2:case 3:var U=3;break;default:U=f}var L=f;f=U;try{return F()}finally{f=L}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(F,U){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var L=f;f=F;try{return U()}finally{f=L}},n.unstable_scheduleCallback=function(F,U,L){var j=n.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?j+L:j):L=j,F){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=L+Q,F={id:c++,callback:U,priorityLevel:F,startTime:L,expirationTime:Q,sortIndex:-1},L>j?(F.sortIndex=L,e(l,F),t(u)===null&&F===t(l)&&(v?(m(R),R=-1):v=!0,V(b,L-j))):(F.sortIndex=Q,e(u,F),p||d||(p=!0,z(S))),F},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(F){var U=f;return function(){var L=f;f=U;try{return F.apply(this,arguments)}finally{f=L}}}})(Q8);Z8.exports=Q8;var HQ=Z8.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GQ=H,ca=HQ;function Qe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var J8=new Set,xy={};function ep(n,e){Tv(n,e),Tv(n+"Capture",e)}function Tv(n,e){for(xy[n]=e,n=0;n<e.length;n++)J8.add(e[n])}var cc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sR=Object.prototype.hasOwnProperty,$Q=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,CF={},MF={};function jQ(n){return sR.call(MF,n)?!0:sR.call(CF,n)?!1:$Q.test(n)?MF[n]=!0:(CF[n]=!0,!1)}function XQ(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function qQ(n,e,t,r){if(e===null||typeof e>"u"||XQ(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ns(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var so={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){so[n]=new ns(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];so[e]=new ns(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){so[n]=new ns(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){so[n]=new ns(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){so[n]=new ns(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){so[n]=new ns(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){so[n]=new ns(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){so[n]=new ns(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){so[n]=new ns(n,5,!1,n.toLowerCase(),null,!1,!1)});var N4=/[\-:]([a-z])/g;function L4(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(N4,L4);so[e]=new ns(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(N4,L4);so[e]=new ns(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(N4,L4);so[e]=new ns(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){so[n]=new ns(n,1,!1,n.toLowerCase(),null,!1,!1)});so.xlinkHref=new ns("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){so[n]=new ns(n,1,!1,n.toLowerCase(),null,!0,!0)});function F4(n,e,t,r){var i=so.hasOwnProperty(e)?so[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qQ(e,t,i,r)&&(t=null),r||i===null?jQ(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Sc=GQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,v2=Symbol.for("react.element"),Cm=Symbol.for("react.portal"),Mm=Symbol.for("react.fragment"),O4=Symbol.for("react.strict_mode"),aR=Symbol.for("react.profiler"),eV=Symbol.for("react.provider"),tV=Symbol.for("react.context"),B4=Symbol.for("react.forward_ref"),uR=Symbol.for("react.suspense"),lR=Symbol.for("react.suspense_list"),U4=Symbol.for("react.memo"),rh=Symbol.for("react.lazy"),nV=Symbol.for("react.offscreen"),TF=Symbol.iterator;function zg(n){return n===null||typeof n!="object"?null:(n=TF&&n[TF]||n["@@iterator"],typeof n=="function"?n:null)}var Fr=Object.assign,u3;function b0(n){if(u3===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);u3=e&&e[1]||""}return`
`+u3+n}var l3=!1;function c3(n,e){if(!n||l3)return"";l3=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(n,[],e)}else{try{e.call()}catch(l){r=l}n.call(e.prototype)}else{try{throw Error()}catch(l){r=l}n()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var u=`
`+i[s].replace(" at new "," at ");return n.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",n.displayName)),u}while(1<=s&&0<=a);break}}}finally{l3=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?b0(n):""}function YQ(n){switch(n.tag){case 5:return b0(n.type);case 16:return b0("Lazy");case 13:return b0("Suspense");case 19:return b0("SuspenseList");case 0:case 2:case 15:return n=c3(n.type,!1),n;case 11:return n=c3(n.type.render,!1),n;case 1:return n=c3(n.type,!0),n;default:return""}}function cR(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Mm:return"Fragment";case Cm:return"Portal";case aR:return"Profiler";case O4:return"StrictMode";case uR:return"Suspense";case lR:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case tV:return(n.displayName||"Context")+".Consumer";case eV:return(n._context.displayName||"Context")+".Provider";case B4:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case U4:return e=n.displayName||null,e!==null?e:cR(n.type)||"Memo";case rh:e=n._payload,n=n._init;try{return cR(n(e))}catch{}}return null}function KQ(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cR(e);case 8:return e===O4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Bh(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function rV(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function ZQ(n){var e=rV(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function g2(n){n._valueTracker||(n._valueTracker=ZQ(n))}function iV(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=rV(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Y_(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function hR(n,e){var t=e.checked;return Fr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function RF(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Bh(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function oV(n,e){e=e.checked,e!=null&&F4(n,"checked",e,!1)}function fR(n,e){oV(n,e);var t=Bh(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?dR(n,e.type,t):e.hasOwnProperty("defaultValue")&&dR(n,e.type,Bh(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function AF(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function dR(n,e,t){(e!=="number"||Y_(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var S0=Array.isArray;function Jm(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Bh(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function pR(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Qe(91));return Fr({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function IF(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Qe(92));if(S0(t)){if(1<t.length)throw Error(Qe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Bh(t)}}function sV(n,e){var t=Bh(e.value),r=Bh(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function PF(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function aV(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mR(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?aV(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var y2,uV=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(y2=y2||document.createElement("div"),y2.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=y2.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function wy(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var L0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},QQ=["Webkit","ms","Moz","O"];Object.keys(L0).forEach(function(n){QQ.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),L0[e]=L0[n]})});function lV(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||L0.hasOwnProperty(n)&&L0[n]?(""+e).trim():e+"px"}function cV(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=lV(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var JQ=Fr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vR(n,e){if(e){if(JQ[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Qe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Qe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Qe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Qe(62))}}function gR(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yR=null;function z4(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var xR=null,ev=null,tv=null;function kF(n){if(n=k1(n)){if(typeof xR!="function")throw Error(Qe(280));var e=n.stateNode;e&&(e=FS(e),xR(n.stateNode,n.type,e))}}function hV(n){ev?tv?tv.push(n):tv=[n]:ev=n}function fV(){if(ev){var n=ev,e=tv;if(tv=ev=null,kF(n),e)for(n=0;n<e.length;n++)kF(e[n])}}function dV(n,e){return n(e)}function pV(){}var h3=!1;function mV(n,e,t){if(h3)return n(e,t);h3=!0;try{return dV(n,e,t)}finally{h3=!1,(ev!==null||tv!==null)&&(pV(),fV())}}function _y(n,e){var t=n.stateNode;if(t===null)return null;var r=FS(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Qe(231,e,typeof t));return t}var wR=!1;if(cc)try{var Vg={};Object.defineProperty(Vg,"passive",{get:function(){wR=!0}}),window.addEventListener("test",Vg,Vg),window.removeEventListener("test",Vg,Vg)}catch{wR=!1}function eJ(n,e,t,r,i,o,s,a,u){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(c){this.onError(c)}}var F0=!1,K_=null,Z_=!1,_R=null,tJ={onError:function(n){F0=!0,K_=n}};function nJ(n,e,t,r,i,o,s,a,u){F0=!1,K_=null,eJ.apply(tJ,arguments)}function rJ(n,e,t,r,i,o,s,a,u){if(nJ.apply(this,arguments),F0){if(F0){var l=K_;F0=!1,K_=null}else throw Error(Qe(198));Z_||(Z_=!0,_R=l)}}function tp(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function vV(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function DF(n){if(tp(n)!==n)throw Error(Qe(188))}function iJ(n){var e=n.alternate;if(!e){if(e=tp(n),e===null)throw Error(Qe(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return DF(i),n;if(o===r)return DF(i),e;o=o.sibling}throw Error(Qe(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Qe(189))}}if(t.alternate!==r)throw Error(Qe(190))}if(t.tag!==3)throw Error(Qe(188));return t.stateNode.current===t?n:e}function gV(n){return n=iJ(n),n!==null?yV(n):null}function yV(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=yV(n);if(e!==null)return e;n=n.sibling}return null}var xV=ca.unstable_scheduleCallback,NF=ca.unstable_cancelCallback,oJ=ca.unstable_shouldYield,sJ=ca.unstable_requestPaint,ni=ca.unstable_now,aJ=ca.unstable_getCurrentPriorityLevel,V4=ca.unstable_ImmediatePriority,wV=ca.unstable_UserBlockingPriority,Q_=ca.unstable_NormalPriority,uJ=ca.unstable_LowPriority,_V=ca.unstable_IdlePriority,kS=null,cl=null;function lJ(n){if(cl&&typeof cl.onCommitFiberRoot=="function")try{cl.onCommitFiberRoot(kS,n,void 0,(n.current.flags&128)===128)}catch{}}var yu=Math.clz32?Math.clz32:fJ,cJ=Math.log,hJ=Math.LN2;function fJ(n){return n>>>=0,n===0?32:31-(cJ(n)/hJ|0)|0}var x2=64,w2=4194304;function E0(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function J_(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=E0(a):(o&=s,o!==0&&(r=E0(o)))}else s=t&~i,s!==0?r=E0(s):o!==0&&(r=E0(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-yu(e),i=1<<t,r|=n[t],e&=~i;return r}function dJ(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function pJ(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-yu(o),a=1<<s,u=i[s];u===-1?(!(a&t)||a&r)&&(i[s]=dJ(a,e)):u<=e&&(n.expiredLanes|=a),o&=~a}}function bR(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function bV(){var n=x2;return x2<<=1,!(x2&4194240)&&(x2=64),n}function f3(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function I1(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-yu(e),n[e]=t}function mJ(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-yu(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function W4(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-yu(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var er=0;function SV(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var EV,H4,CV,MV,TV,SR=!1,_2=[],bh=null,Sh=null,Eh=null,by=new Map,Sy=new Map,uh=[],vJ="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function LF(n,e){switch(n){case"focusin":case"focusout":bh=null;break;case"dragenter":case"dragleave":Sh=null;break;case"mouseover":case"mouseout":Eh=null;break;case"pointerover":case"pointerout":by.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Sy.delete(e.pointerId)}}function Wg(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=k1(e),e!==null&&H4(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function gJ(n,e,t,r,i){switch(e){case"focusin":return bh=Wg(bh,n,e,t,r,i),!0;case"dragenter":return Sh=Wg(Sh,n,e,t,r,i),!0;case"mouseover":return Eh=Wg(Eh,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return by.set(o,Wg(by.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Sy.set(o,Wg(Sy.get(o)||null,n,e,t,r,i)),!0}return!1}function RV(n){var e=id(n.target);if(e!==null){var t=tp(e);if(t!==null){if(e=t.tag,e===13){if(e=vV(t),e!==null){n.blockedOn=e,TV(n.priority,function(){CV(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function m_(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=ER(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);yR=r,t.target.dispatchEvent(r),yR=null}else return e=k1(t),e!==null&&H4(e),n.blockedOn=t,!1;e.shift()}return!0}function FF(n,e,t){m_(n)&&t.delete(e)}function yJ(){SR=!1,bh!==null&&m_(bh)&&(bh=null),Sh!==null&&m_(Sh)&&(Sh=null),Eh!==null&&m_(Eh)&&(Eh=null),by.forEach(FF),Sy.forEach(FF)}function Hg(n,e){n.blockedOn===e&&(n.blockedOn=null,SR||(SR=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,yJ)))}function Ey(n){function e(i){return Hg(i,n)}if(0<_2.length){Hg(_2[0],n);for(var t=1;t<_2.length;t++){var r=_2[t];r.blockedOn===n&&(r.blockedOn=null)}}for(bh!==null&&Hg(bh,n),Sh!==null&&Hg(Sh,n),Eh!==null&&Hg(Eh,n),by.forEach(e),Sy.forEach(e),t=0;t<uh.length;t++)r=uh[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<uh.length&&(t=uh[0],t.blockedOn===null);)RV(t),t.blockedOn===null&&uh.shift()}var nv=Sc.ReactCurrentBatchConfig,eb=!0;function xJ(n,e,t,r){var i=er,o=nv.transition;nv.transition=null;try{er=1,G4(n,e,t,r)}finally{er=i,nv.transition=o}}function wJ(n,e,t,r){var i=er,o=nv.transition;nv.transition=null;try{er=4,G4(n,e,t,r)}finally{er=i,nv.transition=o}}function G4(n,e,t,r){if(eb){var i=ER(n,e,t,r);if(i===null)b3(n,e,r,tb,t),LF(n,r);else if(gJ(i,n,e,t,r))r.stopPropagation();else if(LF(n,r),e&4&&-1<vJ.indexOf(n)){for(;i!==null;){var o=k1(i);if(o!==null&&EV(o),o=ER(n,e,t,r),o===null&&b3(n,e,r,tb,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else b3(n,e,r,null,t)}}var tb=null;function ER(n,e,t,r){if(tb=null,n=z4(r),n=id(n),n!==null)if(e=tp(n),e===null)n=null;else if(t=e.tag,t===13){if(n=vV(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return tb=n,null}function AV(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(aJ()){case V4:return 1;case wV:return 4;case Q_:case uJ:return 16;case _V:return 536870912;default:return 16}default:return 16}}var hh=null,$4=null,v_=null;function IV(){if(v_)return v_;var n,e=$4,t=e.length,r,i="value"in hh?hh.value:hh.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return v_=i.slice(n,1<r?1-r:void 0)}function g_(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function b2(){return!0}function OF(){return!1}function pa(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?b2:OF,this.isPropagationStopped=OF,this}return Fr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=b2)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=b2)},persist:function(){},isPersistent:b2}),e}var ng={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},j4=pa(ng),P1=Fr({},ng,{view:0,detail:0}),_J=pa(P1),d3,p3,Gg,DS=Fr({},P1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:X4,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Gg&&(Gg&&n.type==="mousemove"?(d3=n.screenX-Gg.screenX,p3=n.screenY-Gg.screenY):p3=d3=0,Gg=n),d3)},movementY:function(n){return"movementY"in n?n.movementY:p3}}),BF=pa(DS),bJ=Fr({},DS,{dataTransfer:0}),SJ=pa(bJ),EJ=Fr({},P1,{relatedTarget:0}),m3=pa(EJ),CJ=Fr({},ng,{animationName:0,elapsedTime:0,pseudoElement:0}),MJ=pa(CJ),TJ=Fr({},ng,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),RJ=pa(TJ),AJ=Fr({},ng,{data:0}),UF=pa(AJ),IJ={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PJ={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kJ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DJ(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=kJ[n])?!!e[n]:!1}function X4(){return DJ}var NJ=Fr({},P1,{key:function(n){if(n.key){var e=IJ[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=g_(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?PJ[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:X4,charCode:function(n){return n.type==="keypress"?g_(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?g_(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),LJ=pa(NJ),FJ=Fr({},DS,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zF=pa(FJ),OJ=Fr({},P1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:X4}),BJ=pa(OJ),UJ=Fr({},ng,{propertyName:0,elapsedTime:0,pseudoElement:0}),zJ=pa(UJ),VJ=Fr({},DS,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),WJ=pa(VJ),HJ=[9,13,27,32],q4=cc&&"CompositionEvent"in window,O0=null;cc&&"documentMode"in document&&(O0=document.documentMode);var GJ=cc&&"TextEvent"in window&&!O0,PV=cc&&(!q4||O0&&8<O0&&11>=O0),VF=" ",WF=!1;function kV(n,e){switch(n){case"keyup":return HJ.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function DV(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Tm=!1;function $J(n,e){switch(n){case"compositionend":return DV(e);case"keypress":return e.which!==32?null:(WF=!0,VF);case"textInput":return n=e.data,n===VF&&WF?null:n;default:return null}}function jJ(n,e){if(Tm)return n==="compositionend"||!q4&&kV(n,e)?(n=IV(),v_=$4=hh=null,Tm=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return PV&&e.locale!=="ko"?null:e.data;default:return null}}var XJ={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function HF(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!XJ[n.type]:e==="textarea"}function NV(n,e,t,r){hV(r),e=nb(e,"onChange"),0<e.length&&(t=new j4("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var B0=null,Cy=null;function qJ(n){$V(n,0)}function NS(n){var e=Im(n);if(iV(e))return n}function YJ(n,e){if(n==="change")return e}var LV=!1;if(cc){var v3;if(cc){var g3="oninput"in document;if(!g3){var GF=document.createElement("div");GF.setAttribute("oninput","return;"),g3=typeof GF.oninput=="function"}v3=g3}else v3=!1;LV=v3&&(!document.documentMode||9<document.documentMode)}function $F(){B0&&(B0.detachEvent("onpropertychange",FV),Cy=B0=null)}function FV(n){if(n.propertyName==="value"&&NS(Cy)){var e=[];NV(e,Cy,n,z4(n)),mV(qJ,e)}}function KJ(n,e,t){n==="focusin"?($F(),B0=e,Cy=t,B0.attachEvent("onpropertychange",FV)):n==="focusout"&&$F()}function ZJ(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return NS(Cy)}function QJ(n,e){if(n==="click")return NS(e)}function JJ(n,e){if(n==="input"||n==="change")return NS(e)}function eee(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Cu=typeof Object.is=="function"?Object.is:eee;function My(n,e){if(Cu(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!sR.call(e,i)||!Cu(n[i],e[i]))return!1}return!0}function jF(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function XF(n,e){var t=jF(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=jF(t)}}function OV(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?OV(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function BV(){for(var n=window,e=Y_();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Y_(n.document)}return e}function Y4(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function tee(n){var e=BV(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&OV(t.ownerDocument.documentElement,t)){if(r!==null&&Y4(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=XF(t,o);var s=XF(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var nee=cc&&"documentMode"in document&&11>=document.documentMode,Rm=null,CR=null,U0=null,MR=!1;function qF(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;MR||Rm==null||Rm!==Y_(r)||(r=Rm,"selectionStart"in r&&Y4(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),U0&&My(U0,r)||(U0=r,r=nb(CR,"onSelect"),0<r.length&&(e=new j4("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Rm)))}function S2(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Am={animationend:S2("Animation","AnimationEnd"),animationiteration:S2("Animation","AnimationIteration"),animationstart:S2("Animation","AnimationStart"),transitionend:S2("Transition","TransitionEnd")},y3={},UV={};cc&&(UV=document.createElement("div").style,"AnimationEvent"in window||(delete Am.animationend.animation,delete Am.animationiteration.animation,delete Am.animationstart.animation),"TransitionEvent"in window||delete Am.transitionend.transition);function LS(n){if(y3[n])return y3[n];if(!Am[n])return n;var e=Am[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in UV)return y3[n]=e[t];return n}var zV=LS("animationend"),VV=LS("animationiteration"),WV=LS("animationstart"),HV=LS("transitionend"),GV=new Map,YF="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tf(n,e){GV.set(n,e),ep(e,[n])}for(var x3=0;x3<YF.length;x3++){var w3=YF[x3],ree=w3.toLowerCase(),iee=w3[0].toUpperCase()+w3.slice(1);tf(ree,"on"+iee)}tf(zV,"onAnimationEnd");tf(VV,"onAnimationIteration");tf(WV,"onAnimationStart");tf("dblclick","onDoubleClick");tf("focusin","onFocus");tf("focusout","onBlur");tf(HV,"onTransitionEnd");Tv("onMouseEnter",["mouseout","mouseover"]);Tv("onMouseLeave",["mouseout","mouseover"]);Tv("onPointerEnter",["pointerout","pointerover"]);Tv("onPointerLeave",["pointerout","pointerover"]);ep("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ep("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ep("onBeforeInput",["compositionend","keypress","textInput","paste"]);ep("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ep("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ep("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var C0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oee=new Set("cancel close invalid load scroll toggle".split(" ").concat(C0));function KF(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,rJ(r,e,void 0,n),n.currentTarget=null}function $V(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],u=a.instance,l=a.currentTarget;if(a=a.listener,u!==o&&i.isPropagationStopped())break e;KF(i,a,l),o=u}else for(s=0;s<r.length;s++){if(a=r[s],u=a.instance,l=a.currentTarget,a=a.listener,u!==o&&i.isPropagationStopped())break e;KF(i,a,l),o=u}}}if(Z_)throw n=_R,Z_=!1,_R=null,n}function mr(n,e){var t=e[PR];t===void 0&&(t=e[PR]=new Set);var r=n+"__bubble";t.has(r)||(jV(e,n,2,!1),t.add(r))}function _3(n,e,t){var r=0;e&&(r|=4),jV(t,n,r,e)}var E2="_reactListening"+Math.random().toString(36).slice(2);function Ty(n){if(!n[E2]){n[E2]=!0,J8.forEach(function(t){t!=="selectionchange"&&(oee.has(t)||_3(t,!1,n),_3(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[E2]||(e[E2]=!0,_3("selectionchange",!1,e))}}function jV(n,e,t,r){switch(AV(e)){case 1:var i=xJ;break;case 4:i=wJ;break;default:i=G4}t=i.bind(null,e,t,n),i=void 0,!wR||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function b3(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var u=s.tag;if((u===3||u===4)&&(u=s.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;s=s.return}for(;a!==null;){if(s=id(a),s===null)return;if(u=s.tag,u===5||u===6){r=o=s;continue e}a=a.parentNode}}r=r.return}mV(function(){var l=o,c=z4(t),h=[];e:{var f=GV.get(n);if(f!==void 0){var d=j4,p=n;switch(n){case"keypress":if(g_(t)===0)break e;case"keydown":case"keyup":d=LJ;break;case"focusin":p="focus",d=m3;break;case"focusout":p="blur",d=m3;break;case"beforeblur":case"afterblur":d=m3;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=BF;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=SJ;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=BJ;break;case zV:case VV:case WV:d=MJ;break;case HV:d=zJ;break;case"scroll":d=_J;break;case"wheel":d=WJ;break;case"copy":case"cut":case"paste":d=RJ;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=zF}var v=(e&4)!==0,g=!v&&n==="scroll",m=v?f!==null?f+"Capture":null:f;v=[];for(var x=l,_;x!==null;){_=x;var b=_.stateNode;if(_.tag===5&&b!==null&&(_=b,m!==null&&(b=_y(x,m),b!=null&&v.push(Ry(x,b,_)))),g)break;x=x.return}0<v.length&&(f=new d(f,p,null,t,c),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",d=n==="mouseout"||n==="pointerout",f&&t!==yR&&(p=t.relatedTarget||t.fromElement)&&(id(p)||p[hc]))break e;if((d||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,d?(p=t.relatedTarget||t.toElement,d=l,p=p?id(p):null,p!==null&&(g=tp(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=l),d!==p)){if(v=BF,b="onMouseLeave",m="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(v=zF,b="onPointerLeave",m="onPointerEnter",x="pointer"),g=d==null?f:Im(d),_=p==null?f:Im(p),f=new v(b,x+"leave",d,t,c),f.target=g,f.relatedTarget=_,b=null,id(c)===l&&(v=new v(m,x+"enter",p,t,c),v.target=_,v.relatedTarget=g,b=v),g=b,d&&p)t:{for(v=d,m=p,x=0,_=v;_;_=Pp(_))x++;for(_=0,b=m;b;b=Pp(b))_++;for(;0<x-_;)v=Pp(v),x--;for(;0<_-x;)m=Pp(m),_--;for(;x--;){if(v===m||m!==null&&v===m.alternate)break t;v=Pp(v),m=Pp(m)}v=null}else v=null;d!==null&&ZF(h,f,d,v,!1),p!==null&&g!==null&&ZF(h,g,p,v,!0)}}e:{if(f=l?Im(l):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var S=YJ;else if(HF(f))if(LV)S=JJ;else{S=ZJ;var E=KJ}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=QJ);if(S&&(S=S(n,l))){NV(h,S,t,c);break e}E&&E(n,f,l),n==="focusout"&&(E=f._wrapperState)&&E.controlled&&f.type==="number"&&dR(f,"number",f.value)}switch(E=l?Im(l):window,n){case"focusin":(HF(E)||E.contentEditable==="true")&&(Rm=E,CR=l,U0=null);break;case"focusout":U0=CR=Rm=null;break;case"mousedown":MR=!0;break;case"contextmenu":case"mouseup":case"dragend":MR=!1,qF(h,t,c);break;case"selectionchange":if(nee)break;case"keydown":case"keyup":qF(h,t,c)}var C;if(q4)e:{switch(n){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Tm?kV(n,t)&&(R="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(PV&&t.locale!=="ko"&&(Tm||R!=="onCompositionStart"?R==="onCompositionEnd"&&Tm&&(C=IV()):(hh=c,$4="value"in hh?hh.value:hh.textContent,Tm=!0)),E=nb(l,R),0<E.length&&(R=new UF(R,n,null,t,c),h.push({event:R,listeners:E}),C?R.data=C:(C=DV(t),C!==null&&(R.data=C)))),(C=GJ?$J(n,t):jJ(n,t))&&(l=nb(l,"onBeforeInput"),0<l.length&&(c=new UF("onBeforeInput","beforeinput",null,t,c),h.push({event:c,listeners:l}),c.data=C))}$V(h,e)})}function Ry(n,e,t){return{instance:n,listener:e,currentTarget:t}}function nb(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=_y(n,t),o!=null&&r.unshift(Ry(n,o,i)),o=_y(n,e),o!=null&&r.push(Ry(n,o,i))),n=n.return}return r}function Pp(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function ZF(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,u=a.alternate,l=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&l!==null&&(a=l,i?(u=_y(t,o),u!=null&&s.unshift(Ry(t,u,a))):i||(u=_y(t,o),u!=null&&s.push(Ry(t,u,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var see=/\r\n?/g,aee=/\u0000|\uFFFD/g;function QF(n){return(typeof n=="string"?n:""+n).replace(see,`
`).replace(aee,"")}function C2(n,e,t){if(e=QF(e),QF(n)!==e&&t)throw Error(Qe(425))}function rb(){}var TR=null,RR=null;function AR(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var IR=typeof setTimeout=="function"?setTimeout:void 0,uee=typeof clearTimeout=="function"?clearTimeout:void 0,JF=typeof Promise=="function"?Promise:void 0,lee=typeof queueMicrotask=="function"?queueMicrotask:typeof JF<"u"?function(n){return JF.resolve(null).then(n).catch(cee)}:IR;function cee(n){setTimeout(function(){throw n})}function S3(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Ey(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Ey(e)}function Ch(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function eO(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var rg=Math.random().toString(36).slice(2),el="__reactFiber$"+rg,Ay="__reactProps$"+rg,hc="__reactContainer$"+rg,PR="__reactEvents$"+rg,hee="__reactListeners$"+rg,fee="__reactHandles$"+rg;function id(n){var e=n[el];if(e)return e;for(var t=n.parentNode;t;){if(e=t[hc]||t[el]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=eO(n);n!==null;){if(t=n[el])return t;n=eO(n)}return e}n=t,t=n.parentNode}return null}function k1(n){return n=n[el]||n[hc],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Im(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Qe(33))}function FS(n){return n[Ay]||null}var kR=[],Pm=-1;function nf(n){return{current:n}}function gr(n){0>Pm||(n.current=kR[Pm],kR[Pm]=null,Pm--)}function hr(n,e){Pm++,kR[Pm]=n.current,n.current=e}var Uh={},Do=nf(Uh),xs=nf(!1),Ud=Uh;function Rv(n,e){var t=n.type.contextTypes;if(!t)return Uh;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ws(n){return n=n.childContextTypes,n!=null}function ib(){gr(xs),gr(Do)}function tO(n,e,t){if(Do.current!==Uh)throw Error(Qe(168));hr(Do,e),hr(xs,t)}function XV(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Qe(108,KQ(n)||"Unknown",i));return Fr({},t,r)}function ob(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Uh,Ud=Do.current,hr(Do,n),hr(xs,xs.current),!0}function nO(n,e,t){var r=n.stateNode;if(!r)throw Error(Qe(169));t?(n=XV(n,e,Ud),r.__reactInternalMemoizedMergedChildContext=n,gr(xs),gr(Do),hr(Do,n)):gr(xs),hr(xs,t)}var $l=null,OS=!1,E3=!1;function qV(n){$l===null?$l=[n]:$l.push(n)}function dee(n){OS=!0,qV(n)}function rf(){if(!E3&&$l!==null){E3=!0;var n=0,e=er;try{var t=$l;for(er=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}$l=null,OS=!1}catch(i){throw $l!==null&&($l=$l.slice(n+1)),xV(V4,rf),i}finally{er=e,E3=!1}}return null}var km=[],Dm=0,sb=null,ab=0,Ra=[],Aa=0,zd=null,Ql=1,Jl="";function Wf(n,e){km[Dm++]=ab,km[Dm++]=sb,sb=n,ab=e}function YV(n,e,t){Ra[Aa++]=Ql,Ra[Aa++]=Jl,Ra[Aa++]=zd,zd=n;var r=Ql;n=Jl;var i=32-yu(r)-1;r&=~(1<<i),t+=1;var o=32-yu(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Ql=1<<32-yu(e)+i|t<<i|r,Jl=o+n}else Ql=1<<o|t<<i|r,Jl=n}function K4(n){n.return!==null&&(Wf(n,1),YV(n,1,0))}function Z4(n){for(;n===sb;)sb=km[--Dm],km[Dm]=null,ab=km[--Dm],km[Dm]=null;for(;n===zd;)zd=Ra[--Aa],Ra[Aa]=null,Jl=Ra[--Aa],Ra[Aa]=null,Ql=Ra[--Aa],Ra[Aa]=null}var sa=null,ea=null,_r=!1,hu=null;function KV(n,e){var t=La(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function rO(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,sa=n,ea=Ch(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,sa=n,ea=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=zd!==null?{id:Ql,overflow:Jl}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=La(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,sa=n,ea=null,!0):!1;default:return!1}}function DR(n){return(n.mode&1)!==0&&(n.flags&128)===0}function NR(n){if(_r){var e=ea;if(e){var t=e;if(!rO(n,e)){if(DR(n))throw Error(Qe(418));e=Ch(t.nextSibling);var r=sa;e&&rO(n,e)?KV(r,t):(n.flags=n.flags&-4097|2,_r=!1,sa=n)}}else{if(DR(n))throw Error(Qe(418));n.flags=n.flags&-4097|2,_r=!1,sa=n}}}function iO(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;sa=n}function M2(n){if(n!==sa)return!1;if(!_r)return iO(n),_r=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!AR(n.type,n.memoizedProps)),e&&(e=ea)){if(DR(n))throw ZV(),Error(Qe(418));for(;e;)KV(n,e),e=Ch(e.nextSibling)}if(iO(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Qe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ea=Ch(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ea=null}}else ea=sa?Ch(n.stateNode.nextSibling):null;return!0}function ZV(){for(var n=ea;n;)n=Ch(n.nextSibling)}function Av(){ea=sa=null,_r=!1}function Q4(n){hu===null?hu=[n]:hu.push(n)}var pee=Sc.ReactCurrentBatchConfig;function $g(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Qe(309));var r=t.stateNode}if(!r)throw Error(Qe(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Qe(284));if(!t._owner)throw Error(Qe(290,n))}return n}function T2(n,e){throw n=Object.prototype.toString.call(e),Error(Qe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function oO(n){var e=n._init;return e(n._payload)}function QV(n){function e(m,x){if(n){var _=m.deletions;_===null?(m.deletions=[x],m.flags|=16):_.push(x)}}function t(m,x){if(!n)return null;for(;x!==null;)e(m,x),x=x.sibling;return null}function r(m,x){for(m=new Map;x!==null;)x.key!==null?m.set(x.key,x):m.set(x.index,x),x=x.sibling;return m}function i(m,x){return m=Ah(m,x),m.index=0,m.sibling=null,m}function o(m,x,_){return m.index=_,n?(_=m.alternate,_!==null?(_=_.index,_<x?(m.flags|=2,x):_):(m.flags|=2,x)):(m.flags|=1048576,x)}function s(m){return n&&m.alternate===null&&(m.flags|=2),m}function a(m,x,_,b){return x===null||x.tag!==6?(x=P3(_,m.mode,b),x.return=m,x):(x=i(x,_),x.return=m,x)}function u(m,x,_,b){var S=_.type;return S===Mm?c(m,x,_.props.children,b,_.key):x!==null&&(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===rh&&oO(S)===x.type)?(b=i(x,_.props),b.ref=$g(m,x,_),b.return=m,b):(b=E_(_.type,_.key,_.props,null,m.mode,b),b.ref=$g(m,x,_),b.return=m,b)}function l(m,x,_,b){return x===null||x.tag!==4||x.stateNode.containerInfo!==_.containerInfo||x.stateNode.implementation!==_.implementation?(x=k3(_,m.mode,b),x.return=m,x):(x=i(x,_.children||[]),x.return=m,x)}function c(m,x,_,b,S){return x===null||x.tag!==7?(x=_d(_,m.mode,b,S),x.return=m,x):(x=i(x,_),x.return=m,x)}function h(m,x,_){if(typeof x=="string"&&x!==""||typeof x=="number")return x=P3(""+x,m.mode,_),x.return=m,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case v2:return _=E_(x.type,x.key,x.props,null,m.mode,_),_.ref=$g(m,null,x),_.return=m,_;case Cm:return x=k3(x,m.mode,_),x.return=m,x;case rh:var b=x._init;return h(m,b(x._payload),_)}if(S0(x)||zg(x))return x=_d(x,m.mode,_,null),x.return=m,x;T2(m,x)}return null}function f(m,x,_,b){var S=x!==null?x.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return S!==null?null:a(m,x,""+_,b);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case v2:return _.key===S?u(m,x,_,b):null;case Cm:return _.key===S?l(m,x,_,b):null;case rh:return S=_._init,f(m,x,S(_._payload),b)}if(S0(_)||zg(_))return S!==null?null:c(m,x,_,b,null);T2(m,_)}return null}function d(m,x,_,b,S){if(typeof b=="string"&&b!==""||typeof b=="number")return m=m.get(_)||null,a(x,m,""+b,S);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case v2:return m=m.get(b.key===null?_:b.key)||null,u(x,m,b,S);case Cm:return m=m.get(b.key===null?_:b.key)||null,l(x,m,b,S);case rh:var E=b._init;return d(m,x,_,E(b._payload),S)}if(S0(b)||zg(b))return m=m.get(_)||null,c(x,m,b,S,null);T2(x,b)}return null}function p(m,x,_,b){for(var S=null,E=null,C=x,R=x=0,T=null;C!==null&&R<_.length;R++){C.index>R?(T=C,C=null):T=C.sibling;var A=f(m,C,_[R],b);if(A===null){C===null&&(C=T);break}n&&C&&A.alternate===null&&e(m,C),x=o(A,x,R),E===null?S=A:E.sibling=A,E=A,C=T}if(R===_.length)return t(m,C),_r&&Wf(m,R),S;if(C===null){for(;R<_.length;R++)C=h(m,_[R],b),C!==null&&(x=o(C,x,R),E===null?S=C:E.sibling=C,E=C);return _r&&Wf(m,R),S}for(C=r(m,C);R<_.length;R++)T=d(C,m,R,_[R],b),T!==null&&(n&&T.alternate!==null&&C.delete(T.key===null?R:T.key),x=o(T,x,R),E===null?S=T:E.sibling=T,E=T);return n&&C.forEach(function(P){return e(m,P)}),_r&&Wf(m,R),S}function v(m,x,_,b){var S=zg(_);if(typeof S!="function")throw Error(Qe(150));if(_=S.call(_),_==null)throw Error(Qe(151));for(var E=S=null,C=x,R=x=0,T=null,A=_.next();C!==null&&!A.done;R++,A=_.next()){C.index>R?(T=C,C=null):T=C.sibling;var P=f(m,C,A.value,b);if(P===null){C===null&&(C=T);break}n&&C&&P.alternate===null&&e(m,C),x=o(P,x,R),E===null?S=P:E.sibling=P,E=P,C=T}if(A.done)return t(m,C),_r&&Wf(m,R),S;if(C===null){for(;!A.done;R++,A=_.next())A=h(m,A.value,b),A!==null&&(x=o(A,x,R),E===null?S=A:E.sibling=A,E=A);return _r&&Wf(m,R),S}for(C=r(m,C);!A.done;R++,A=_.next())A=d(C,m,R,A.value,b),A!==null&&(n&&A.alternate!==null&&C.delete(A.key===null?R:A.key),x=o(A,x,R),E===null?S=A:E.sibling=A,E=A);return n&&C.forEach(function(k){return e(m,k)}),_r&&Wf(m,R),S}function g(m,x,_,b){if(typeof _=="object"&&_!==null&&_.type===Mm&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case v2:e:{for(var S=_.key,E=x;E!==null;){if(E.key===S){if(S=_.type,S===Mm){if(E.tag===7){t(m,E.sibling),x=i(E,_.props.children),x.return=m,m=x;break e}}else if(E.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===rh&&oO(S)===E.type){t(m,E.sibling),x=i(E,_.props),x.ref=$g(m,E,_),x.return=m,m=x;break e}t(m,E);break}else e(m,E);E=E.sibling}_.type===Mm?(x=_d(_.props.children,m.mode,b,_.key),x.return=m,m=x):(b=E_(_.type,_.key,_.props,null,m.mode,b),b.ref=$g(m,x,_),b.return=m,m=b)}return s(m);case Cm:e:{for(E=_.key;x!==null;){if(x.key===E)if(x.tag===4&&x.stateNode.containerInfo===_.containerInfo&&x.stateNode.implementation===_.implementation){t(m,x.sibling),x=i(x,_.children||[]),x.return=m,m=x;break e}else{t(m,x);break}else e(m,x);x=x.sibling}x=k3(_,m.mode,b),x.return=m,m=x}return s(m);case rh:return E=_._init,g(m,x,E(_._payload),b)}if(S0(_))return p(m,x,_,b);if(zg(_))return v(m,x,_,b);T2(m,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,x!==null&&x.tag===6?(t(m,x.sibling),x=i(x,_),x.return=m,m=x):(t(m,x),x=P3(_,m.mode,b),x.return=m,m=x),s(m)):t(m,x)}return g}var Iv=QV(!0),JV=QV(!1),ub=nf(null),lb=null,Nm=null,J4=null;function eP(){J4=Nm=lb=null}function tP(n){var e=ub.current;gr(ub),n._currentValue=e}function LR(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function rv(n,e){lb=n,J4=Nm=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(ms=!0),n.firstContext=null)}function Ha(n){var e=n._currentValue;if(J4!==n)if(n={context:n,memoizedValue:e,next:null},Nm===null){if(lb===null)throw Error(Qe(308));Nm=n,lb.dependencies={lanes:0,firstContext:n}}else Nm=Nm.next=n;return e}var od=null;function nP(n){od===null?od=[n]:od.push(n)}function eW(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,nP(e)):(t.next=i.next,i.next=t),e.interleaved=t,fc(n,r)}function fc(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var ih=!1;function rP(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tW(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ic(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Mh(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Bn&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,fc(n,t)}return i=r.interleaved,i===null?(e.next=e,nP(r)):(e.next=i.next,i.next=e),r.interleaved=e,fc(n,t)}function y_(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,W4(n,t)}}function sO(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function cb(n,e,t,r){var i=n.updateQueue;ih=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var u=a,l=u.next;u.next=null,s===null?o=l:s.next=l,s=u;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==s&&(a===null?c.firstBaseUpdate=l:a.next=l,c.lastBaseUpdate=u))}if(o!==null){var h=i.baseState;s=0,c=l=u=null,a=o;do{var f=a.lane,d=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,v=a;switch(f=e,d=t,v.tag){case 1:if(p=v.payload,typeof p=="function"){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=v.payload,f=typeof p=="function"?p.call(d,h,f):p,f==null)break e;h=Fr({},h,f);break e;case 2:ih=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(l=c=d,u=h):c=c.next=d,s|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(u=h),i.baseState=u,i.firstBaseUpdate=l,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Wd|=s,n.lanes=s,n.memoizedState=h}}function aO(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Qe(191,i));i.call(r)}}}var D1={},hl=nf(D1),Iy=nf(D1),Py=nf(D1);function sd(n){if(n===D1)throw Error(Qe(174));return n}function iP(n,e){switch(hr(Py,e),hr(Iy,n),hr(hl,D1),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:mR(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=mR(e,n)}gr(hl),hr(hl,e)}function Pv(){gr(hl),gr(Iy),gr(Py)}function nW(n){sd(Py.current);var e=sd(hl.current),t=mR(e,n.type);e!==t&&(hr(Iy,n),hr(hl,t))}function oP(n){Iy.current===n&&(gr(hl),gr(Iy))}var Rr=nf(0);function hb(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var C3=[];function sP(){for(var n=0;n<C3.length;n++)C3[n]._workInProgressVersionPrimary=null;C3.length=0}var x_=Sc.ReactCurrentDispatcher,M3=Sc.ReactCurrentBatchConfig,Vd=0,Dr=null,wi=null,Ui=null,fb=!1,z0=!1,ky=0,mee=0;function fo(){throw Error(Qe(321))}function aP(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Cu(n[t],e[t]))return!1;return!0}function uP(n,e,t,r,i,o){if(Vd=o,Dr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,x_.current=n===null||n.memoizedState===null?xee:wee,n=t(r,i),z0){o=0;do{if(z0=!1,ky=0,25<=o)throw Error(Qe(301));o+=1,Ui=wi=null,e.updateQueue=null,x_.current=_ee,n=t(r,i)}while(z0)}if(x_.current=db,e=wi!==null&&wi.next!==null,Vd=0,Ui=wi=Dr=null,fb=!1,e)throw Error(Qe(300));return n}function lP(){var n=ky!==0;return ky=0,n}function ju(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ui===null?Dr.memoizedState=Ui=n:Ui=Ui.next=n,Ui}function Ga(){if(wi===null){var n=Dr.alternate;n=n!==null?n.memoizedState:null}else n=wi.next;var e=Ui===null?Dr.memoizedState:Ui.next;if(e!==null)Ui=e,wi=n;else{if(n===null)throw Error(Qe(310));wi=n,n={memoizedState:wi.memoizedState,baseState:wi.baseState,baseQueue:wi.baseQueue,queue:wi.queue,next:null},Ui===null?Dr.memoizedState=Ui=n:Ui=Ui.next=n}return Ui}function Dy(n,e){return typeof e=="function"?e(n):e}function T3(n){var e=Ga(),t=e.queue;if(t===null)throw Error(Qe(311));t.lastRenderedReducer=n;var r=wi,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,u=null,l=o;do{var c=l.lane;if((Vd&c)===c)u!==null&&(u=u.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:n(r,l.action);else{var h={lane:c,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};u===null?(a=u=h,s=r):u=u.next=h,Dr.lanes|=c,Wd|=c}l=l.next}while(l!==null&&l!==o);u===null?s=r:u.next=a,Cu(r,e.memoizedState)||(ms=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=u,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,Dr.lanes|=o,Wd|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function R3(n){var e=Ga(),t=e.queue;if(t===null)throw Error(Qe(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);Cu(o,e.memoizedState)||(ms=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function rW(){}function iW(n,e){var t=Dr,r=Ga(),i=e(),o=!Cu(r.memoizedState,i);if(o&&(r.memoizedState=i,ms=!0),r=r.queue,cP(aW.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||Ui!==null&&Ui.memoizedState.tag&1){if(t.flags|=2048,Ny(9,sW.bind(null,t,r,i,e),void 0,null),Vi===null)throw Error(Qe(349));Vd&30||oW(t,e,i)}return i}function oW(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Dr.updateQueue,e===null?(e={lastEffect:null,stores:null},Dr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function sW(n,e,t,r){e.value=t,e.getSnapshot=r,uW(e)&&lW(n)}function aW(n,e,t){return t(function(){uW(e)&&lW(n)})}function uW(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Cu(n,t)}catch{return!0}}function lW(n){var e=fc(n,1);e!==null&&xu(e,n,1,-1)}function uO(n){var e=ju();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dy,lastRenderedState:n},e.queue=n,n=n.dispatch=yee.bind(null,Dr,n),[e.memoizedState,n]}function Ny(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Dr.updateQueue,e===null?(e={lastEffect:null,stores:null},Dr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function cW(){return Ga().memoizedState}function w_(n,e,t,r){var i=ju();Dr.flags|=n,i.memoizedState=Ny(1|e,t,void 0,r===void 0?null:r)}function BS(n,e,t,r){var i=Ga();r=r===void 0?null:r;var o=void 0;if(wi!==null){var s=wi.memoizedState;if(o=s.destroy,r!==null&&aP(r,s.deps)){i.memoizedState=Ny(e,t,o,r);return}}Dr.flags|=n,i.memoizedState=Ny(1|e,t,o,r)}function lO(n,e){return w_(8390656,8,n,e)}function cP(n,e){return BS(2048,8,n,e)}function hW(n,e){return BS(4,2,n,e)}function fW(n,e){return BS(4,4,n,e)}function dW(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function pW(n,e,t){return t=t!=null?t.concat([n]):null,BS(4,4,dW.bind(null,e,n),t)}function hP(){}function mW(n,e){var t=Ga();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&aP(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function vW(n,e){var t=Ga();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&aP(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function gW(n,e,t){return Vd&21?(Cu(t,e)||(t=bV(),Dr.lanes|=t,Wd|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,ms=!0),n.memoizedState=t)}function vee(n,e){var t=er;er=t!==0&&4>t?t:4,n(!0);var r=M3.transition;M3.transition={};try{n(!1),e()}finally{er=t,M3.transition=r}}function yW(){return Ga().memoizedState}function gee(n,e,t){var r=Rh(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},xW(n))wW(e,t);else if(t=eW(n,e,t,r),t!==null){var i=Zo();xu(t,n,r,i),_W(t,e,r)}}function yee(n,e,t){var r=Rh(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(xW(n))wW(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,Cu(a,s)){var u=e.interleaved;u===null?(i.next=i,nP(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}t=eW(n,e,i,r),t!==null&&(i=Zo(),xu(t,n,r,i),_W(t,e,r))}}function xW(n){var e=n.alternate;return n===Dr||e!==null&&e===Dr}function wW(n,e){z0=fb=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function _W(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,W4(n,t)}}var db={readContext:Ha,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},xee={readContext:Ha,useCallback:function(n,e){return ju().memoizedState=[n,e===void 0?null:e],n},useContext:Ha,useEffect:lO,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,w_(4194308,4,dW.bind(null,e,n),t)},useLayoutEffect:function(n,e){return w_(4194308,4,n,e)},useInsertionEffect:function(n,e){return w_(4,2,n,e)},useMemo:function(n,e){var t=ju();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=ju();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=gee.bind(null,Dr,n),[r.memoizedState,n]},useRef:function(n){var e=ju();return n={current:n},e.memoizedState=n},useState:uO,useDebugValue:hP,useDeferredValue:function(n){return ju().memoizedState=n},useTransition:function(){var n=uO(!1),e=n[0];return n=vee.bind(null,n[1]),ju().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Dr,i=ju();if(_r){if(t===void 0)throw Error(Qe(407));t=t()}else{if(t=e(),Vi===null)throw Error(Qe(349));Vd&30||oW(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,lO(aW.bind(null,r,o,n),[n]),r.flags|=2048,Ny(9,sW.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=ju(),e=Vi.identifierPrefix;if(_r){var t=Jl,r=Ql;t=(r&~(1<<32-yu(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=ky++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=mee++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},wee={readContext:Ha,useCallback:mW,useContext:Ha,useEffect:cP,useImperativeHandle:pW,useInsertionEffect:hW,useLayoutEffect:fW,useMemo:vW,useReducer:T3,useRef:cW,useState:function(){return T3(Dy)},useDebugValue:hP,useDeferredValue:function(n){var e=Ga();return gW(e,wi.memoizedState,n)},useTransition:function(){var n=T3(Dy)[0],e=Ga().memoizedState;return[n,e]},useMutableSource:rW,useSyncExternalStore:iW,useId:yW,unstable_isNewReconciler:!1},_ee={readContext:Ha,useCallback:mW,useContext:Ha,useEffect:cP,useImperativeHandle:pW,useInsertionEffect:hW,useLayoutEffect:fW,useMemo:vW,useReducer:R3,useRef:cW,useState:function(){return R3(Dy)},useDebugValue:hP,useDeferredValue:function(n){var e=Ga();return wi===null?e.memoizedState=n:gW(e,wi.memoizedState,n)},useTransition:function(){var n=R3(Dy)[0],e=Ga().memoizedState;return[n,e]},useMutableSource:rW,useSyncExternalStore:iW,useId:yW,unstable_isNewReconciler:!1};function uu(n,e){if(n&&n.defaultProps){e=Fr({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function FR(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Fr({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var US={isMounted:function(n){return(n=n._reactInternals)?tp(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Zo(),i=Rh(n),o=ic(r,i);o.payload=e,t!=null&&(o.callback=t),e=Mh(n,o,i),e!==null&&(xu(e,n,i,r),y_(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Zo(),i=Rh(n),o=ic(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Mh(n,o,i),e!==null&&(xu(e,n,i,r),y_(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Zo(),r=Rh(n),i=ic(t,r);i.tag=2,e!=null&&(i.callback=e),e=Mh(n,i,r),e!==null&&(xu(e,n,r,t),y_(e,n,r))}};function cO(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!My(t,r)||!My(i,o):!0}function bW(n,e,t){var r=!1,i=Uh,o=e.contextType;return typeof o=="object"&&o!==null?o=Ha(o):(i=ws(e)?Ud:Do.current,r=e.contextTypes,o=(r=r!=null)?Rv(n,i):Uh),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=US,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function hO(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&US.enqueueReplaceState(e,e.state,null)}function OR(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},rP(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Ha(o):(o=ws(e)?Ud:Do.current,i.context=Rv(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(FR(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&US.enqueueReplaceState(i,i.state,null),cb(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function kv(n,e){try{var t="",r=e;do t+=YQ(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function A3(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function BR(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var bee=typeof WeakMap=="function"?WeakMap:Map;function SW(n,e,t){t=ic(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){mb||(mb=!0,qR=r),BR(n,e)},t}function EW(n,e,t){t=ic(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){BR(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){BR(n,e),typeof r!="function"&&(Th===null?Th=new Set([this]):Th.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function fO(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new bee;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=Fee.bind(null,n,e,t),e.then(n,n))}function dO(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function pO(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=ic(-1,1),e.tag=2,Mh(t,e,1))),t.lanes|=1),n)}var See=Sc.ReactCurrentOwner,ms=!1;function Wo(n,e,t,r){e.child=n===null?JV(e,null,t,r):Iv(e,n.child,t,r)}function mO(n,e,t,r,i){t=t.render;var o=e.ref;return rv(e,i),r=uP(n,e,t,r,o,i),t=lP(),n!==null&&!ms?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,dc(n,e,i)):(_r&&t&&K4(e),e.flags|=1,Wo(n,e,r,i),e.child)}function vO(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!xP(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,CW(n,e,o,r,i)):(n=E_(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:My,t(s,r)&&n.ref===e.ref)return dc(n,e,i)}return e.flags|=1,n=Ah(o,r),n.ref=e.ref,n.return=e,e.child=n}function CW(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(My(o,r)&&n.ref===e.ref)if(ms=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(ms=!0);else return e.lanes=n.lanes,dc(n,e,i)}return UR(n,e,t,r,i)}function MW(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},hr(Fm,Hs),Hs|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,hr(Fm,Hs),Hs|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,hr(Fm,Hs),Hs|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,hr(Fm,Hs),Hs|=r;return Wo(n,e,i,t),e.child}function TW(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function UR(n,e,t,r,i){var o=ws(t)?Ud:Do.current;return o=Rv(e,o),rv(e,i),t=uP(n,e,t,r,o,i),r=lP(),n!==null&&!ms?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,dc(n,e,i)):(_r&&r&&K4(e),e.flags|=1,Wo(n,e,t,i),e.child)}function gO(n,e,t,r,i){if(ws(t)){var o=!0;ob(e)}else o=!1;if(rv(e,i),e.stateNode===null)__(n,e),bW(e,t,r),OR(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var u=s.context,l=t.contextType;typeof l=="object"&&l!==null?l=Ha(l):(l=ws(t)?Ud:Do.current,l=Rv(e,l));var c=t.getDerivedStateFromProps,h=typeof c=="function"||typeof s.getSnapshotBeforeUpdate=="function";h||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||u!==l)&&hO(e,s,r,l),ih=!1;var f=e.memoizedState;s.state=f,cb(e,r,s,i),u=e.memoizedState,a!==r||f!==u||xs.current||ih?(typeof c=="function"&&(FR(e,t,c,r),u=e.memoizedState),(a=ih||cO(e,t,a,r,f,u,l))?(h||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),s.props=r,s.state=u,s.context=l,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,tW(n,e),a=e.memoizedProps,l=e.type===e.elementType?a:uu(e.type,a),s.props=l,h=e.pendingProps,f=s.context,u=t.contextType,typeof u=="object"&&u!==null?u=Ha(u):(u=ws(t)?Ud:Do.current,u=Rv(e,u));var d=t.getDerivedStateFromProps;(c=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==h||f!==u)&&hO(e,s,r,u),ih=!1,f=e.memoizedState,s.state=f,cb(e,r,s,i);var p=e.memoizedState;a!==h||f!==p||xs.current||ih?(typeof d=="function"&&(FR(e,t,d,r),p=e.memoizedState),(l=ih||cO(e,t,l,r,f,p,u)||!1)?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,p,u),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,p,u)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),s.props=r,s.state=p,s.context=u,r=l):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return zR(n,e,t,r,o,i)}function zR(n,e,t,r,i,o){TW(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&nO(e,t,!1),dc(n,e,o);r=e.stateNode,See.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Iv(e,n.child,null,o),e.child=Iv(e,null,a,o)):Wo(n,e,a,o),e.memoizedState=r.state,i&&nO(e,t,!0),e.child}function RW(n){var e=n.stateNode;e.pendingContext?tO(n,e.pendingContext,e.pendingContext!==e.context):e.context&&tO(n,e.context,!1),iP(n,e.containerInfo)}function yO(n,e,t,r,i){return Av(),Q4(i),e.flags|=256,Wo(n,e,t,r),e.child}var VR={dehydrated:null,treeContext:null,retryLane:0};function WR(n){return{baseLanes:n,cachePool:null,transitions:null}}function AW(n,e,t){var r=e.pendingProps,i=Rr.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),hr(Rr,i&1),n===null)return NR(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=WS(s,r,0,null),n=_d(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=WR(t),e.memoizedState=VR,n):fP(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Eee(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var u={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=Ah(i,u),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=Ah(a,o):(o=_d(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?WR(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=VR,r}return o=n.child,n=o.sibling,r=Ah(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function fP(n,e){return e=WS({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function R2(n,e,t,r){return r!==null&&Q4(r),Iv(e,n.child,null,t),n=fP(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Eee(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=A3(Error(Qe(422))),R2(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=WS({mode:"visible",children:r.children},i,0,null),o=_d(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Iv(e,n.child,null,s),e.child.memoizedState=WR(s),e.memoizedState=VR,o);if(!(e.mode&1))return R2(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Qe(419)),r=A3(o,r,void 0),R2(n,e,s,r)}if(a=(s&n.childLanes)!==0,ms||a){if(r=Vi,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,fc(n,i),xu(r,n,i,-1))}return yP(),r=A3(Error(Qe(421))),R2(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=Oee.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,ea=Ch(i.nextSibling),sa=e,_r=!0,hu=null,n!==null&&(Ra[Aa++]=Ql,Ra[Aa++]=Jl,Ra[Aa++]=zd,Ql=n.id,Jl=n.overflow,zd=e),e=fP(e,r.children),e.flags|=4096,e)}function xO(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),LR(n.return,e,t)}function I3(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function IW(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Wo(n,e,r.children,t),r=Rr.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&xO(n,t,e);else if(n.tag===19)xO(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(hr(Rr,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&hb(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),I3(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&hb(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}I3(e,!0,t,null,o);break;case"together":I3(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function __(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function dc(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Wd|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Qe(153));if(e.child!==null){for(n=e.child,t=Ah(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Ah(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Cee(n,e,t){switch(e.tag){case 3:RW(e),Av();break;case 5:nW(e);break;case 1:ws(e.type)&&ob(e);break;case 4:iP(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;hr(ub,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(hr(Rr,Rr.current&1),e.flags|=128,null):t&e.child.childLanes?AW(n,e,t):(hr(Rr,Rr.current&1),n=dc(n,e,t),n!==null?n.sibling:null);hr(Rr,Rr.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return IW(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),hr(Rr,Rr.current),r)break;return null;case 22:case 23:return e.lanes=0,MW(n,e,t)}return dc(n,e,t)}var PW,HR,kW,DW;PW=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};HR=function(){};kW=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,sd(hl.current);var o=null;switch(t){case"input":i=hR(n,i),r=hR(n,r),o=[];break;case"select":i=Fr({},i,{value:void 0}),r=Fr({},r,{value:void 0}),o=[];break;case"textarea":i=pR(n,i),r=pR(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=rb)}vR(t,r);var s;t=null;for(l in i)if(!r.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var a=i[l];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(xy.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var u=r[l];if(a=i!=null?i[l]:void 0,r.hasOwnProperty(l)&&u!==a&&(u!=null||a!=null))if(l==="style")if(a){for(s in a)!a.hasOwnProperty(s)||u&&u.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in u)u.hasOwnProperty(s)&&a[s]!==u[s]&&(t||(t={}),t[s]=u[s])}else t||(o||(o=[]),o.push(l,t)),t=u;else l==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(o=o||[]).push(l,u)):l==="children"?typeof u!="string"&&typeof u!="number"||(o=o||[]).push(l,""+u):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(xy.hasOwnProperty(l)?(u!=null&&l==="onScroll"&&mr("scroll",n),o||a===u||(o=[])):(o=o||[]).push(l,u))}t&&(o=o||[]).push("style",t);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};DW=function(n,e,t,r){t!==r&&(e.flags|=4)};function jg(n,e){if(!_r)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function po(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Mee(n,e,t){var r=e.pendingProps;switch(Z4(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return po(e),null;case 1:return ws(e.type)&&ib(),po(e),null;case 3:return r=e.stateNode,Pv(),gr(xs),gr(Do),sP(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(M2(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,hu!==null&&(ZR(hu),hu=null))),HR(n,e),po(e),null;case 5:oP(e);var i=sd(Py.current);if(t=e.type,n!==null&&e.stateNode!=null)kW(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Qe(166));return po(e),null}if(n=sd(hl.current),M2(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[el]=e,r[Ay]=o,n=(e.mode&1)!==0,t){case"dialog":mr("cancel",r),mr("close",r);break;case"iframe":case"object":case"embed":mr("load",r);break;case"video":case"audio":for(i=0;i<C0.length;i++)mr(C0[i],r);break;case"source":mr("error",r);break;case"img":case"image":case"link":mr("error",r),mr("load",r);break;case"details":mr("toggle",r);break;case"input":RF(r,o),mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},mr("invalid",r);break;case"textarea":IF(r,o),mr("invalid",r)}vR(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&C2(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&C2(r.textContent,a,n),i=["children",""+a]):xy.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&mr("scroll",r)}switch(t){case"input":g2(r),AF(r,o,!0);break;case"textarea":g2(r),PF(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=rb)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=aV(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[el]=e,n[Ay]=r,PW(n,e,!1,!1),e.stateNode=n;e:{switch(s=gR(t,r),t){case"dialog":mr("cancel",n),mr("close",n),i=r;break;case"iframe":case"object":case"embed":mr("load",n),i=r;break;case"video":case"audio":for(i=0;i<C0.length;i++)mr(C0[i],n);i=r;break;case"source":mr("error",n),i=r;break;case"img":case"image":case"link":mr("error",n),mr("load",n),i=r;break;case"details":mr("toggle",n),i=r;break;case"input":RF(n,r),i=hR(n,r),mr("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Fr({},r,{value:void 0}),mr("invalid",n);break;case"textarea":IF(n,r),i=pR(n,r),mr("invalid",n);break;default:i=r}vR(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var u=a[o];o==="style"?cV(n,u):o==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&uV(n,u)):o==="children"?typeof u=="string"?(t!=="textarea"||u!=="")&&wy(n,u):typeof u=="number"&&wy(n,""+u):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(xy.hasOwnProperty(o)?u!=null&&o==="onScroll"&&mr("scroll",n):u!=null&&F4(n,o,u,s))}switch(t){case"input":g2(n),AF(n,r,!1);break;case"textarea":g2(n),PF(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Bh(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?Jm(n,!!r.multiple,o,!1):r.defaultValue!=null&&Jm(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=rb)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return po(e),null;case 6:if(n&&e.stateNode!=null)DW(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Qe(166));if(t=sd(Py.current),sd(hl.current),M2(e)){if(r=e.stateNode,t=e.memoizedProps,r[el]=e,(o=r.nodeValue!==t)&&(n=sa,n!==null))switch(n.tag){case 3:C2(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&C2(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[el]=e,e.stateNode=r}return po(e),null;case 13:if(gr(Rr),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(_r&&ea!==null&&e.mode&1&&!(e.flags&128))ZV(),Av(),e.flags|=98560,o=!1;else if(o=M2(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Qe(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Qe(317));o[el]=e}else Av(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;po(e),o=!1}else hu!==null&&(ZR(hu),hu=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Rr.current&1?Ci===0&&(Ci=3):yP())),e.updateQueue!==null&&(e.flags|=4),po(e),null);case 4:return Pv(),HR(n,e),n===null&&Ty(e.stateNode.containerInfo),po(e),null;case 10:return tP(e.type._context),po(e),null;case 17:return ws(e.type)&&ib(),po(e),null;case 19:if(gr(Rr),o=e.memoizedState,o===null)return po(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)jg(o,!1);else{if(Ci!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=hb(n),s!==null){for(e.flags|=128,jg(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return hr(Rr,Rr.current&1|2),e.child}n=n.sibling}o.tail!==null&&ni()>Dv&&(e.flags|=128,r=!0,jg(o,!1),e.lanes=4194304)}else{if(!r)if(n=hb(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),jg(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!_r)return po(e),null}else 2*ni()-o.renderingStartTime>Dv&&t!==1073741824&&(e.flags|=128,r=!0,jg(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=ni(),e.sibling=null,t=Rr.current,hr(Rr,r?t&1|2:t&1),e):(po(e),null);case 22:case 23:return gP(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Hs&1073741824&&(po(e),e.subtreeFlags&6&&(e.flags|=8192)):po(e),null;case 24:return null;case 25:return null}throw Error(Qe(156,e.tag))}function Tee(n,e){switch(Z4(e),e.tag){case 1:return ws(e.type)&&ib(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Pv(),gr(xs),gr(Do),sP(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return oP(e),null;case 13:if(gr(Rr),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Qe(340));Av()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return gr(Rr),null;case 4:return Pv(),null;case 10:return tP(e.type._context),null;case 22:case 23:return gP(),null;case 24:return null;default:return null}}var A2=!1,bo=!1,Ree=typeof WeakSet=="function"?WeakSet:Set,gt=null;function Lm(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){jr(n,e,r)}else t.current=null}function GR(n,e,t){try{t()}catch(r){jr(n,e,r)}}var wO=!1;function Aee(n,e){if(TR=eb,n=BV(),Y4(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,u=-1,l=0,c=0,h=n,f=null;t:for(;;){for(var d;h!==t||i!==0&&h.nodeType!==3||(a=s+i),h!==o||r!==0&&h.nodeType!==3||(u=s+r),h.nodeType===3&&(s+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===n)break t;if(f===t&&++l===i&&(a=s),f===o&&++c===r&&(u=s),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}t=a===-1||u===-1?null:{start:a,end:u}}else t=null}t=t||{start:0,end:0}}else t=null;for(RR={focusedElem:n,selectionRange:t},eb=!1,gt=e;gt!==null;)if(e=gt,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,gt=n;else for(;gt!==null;){e=gt;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var v=p.memoizedProps,g=p.memoizedState,m=e.stateNode,x=m.getSnapshotBeforeUpdate(e.elementType===e.type?v:uu(e.type,v),g);m.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Qe(163))}}catch(b){jr(e,e.return,b)}if(n=e.sibling,n!==null){n.return=e.return,gt=n;break}gt=e.return}return p=wO,wO=!1,p}function V0(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&GR(e,t,o)}i=i.next}while(i!==r)}}function zS(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function $R(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function NW(n){var e=n.alternate;e!==null&&(n.alternate=null,NW(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[el],delete e[Ay],delete e[PR],delete e[hee],delete e[fee])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function LW(n){return n.tag===5||n.tag===3||n.tag===4}function _O(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||LW(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function jR(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=rb));else if(r!==4&&(n=n.child,n!==null))for(jR(n,e,t),n=n.sibling;n!==null;)jR(n,e,t),n=n.sibling}function XR(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(XR(n,e,t),n=n.sibling;n!==null;)XR(n,e,t),n=n.sibling}var qi=null,cu=!1;function Hc(n,e,t){for(t=t.child;t!==null;)FW(n,e,t),t=t.sibling}function FW(n,e,t){if(cl&&typeof cl.onCommitFiberUnmount=="function")try{cl.onCommitFiberUnmount(kS,t)}catch{}switch(t.tag){case 5:bo||Lm(t,e);case 6:var r=qi,i=cu;qi=null,Hc(n,e,t),qi=r,cu=i,qi!==null&&(cu?(n=qi,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):qi.removeChild(t.stateNode));break;case 18:qi!==null&&(cu?(n=qi,t=t.stateNode,n.nodeType===8?S3(n.parentNode,t):n.nodeType===1&&S3(n,t),Ey(n)):S3(qi,t.stateNode));break;case 4:r=qi,i=cu,qi=t.stateNode.containerInfo,cu=!0,Hc(n,e,t),qi=r,cu=i;break;case 0:case 11:case 14:case 15:if(!bo&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&GR(t,e,s),i=i.next}while(i!==r)}Hc(n,e,t);break;case 1:if(!bo&&(Lm(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){jr(t,e,a)}Hc(n,e,t);break;case 21:Hc(n,e,t);break;case 22:t.mode&1?(bo=(r=bo)||t.memoizedState!==null,Hc(n,e,t),bo=r):Hc(n,e,t);break;default:Hc(n,e,t)}}function bO(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Ree),e.forEach(function(r){var i=Bee.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function tu(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:qi=a.stateNode,cu=!1;break e;case 3:qi=a.stateNode.containerInfo,cu=!0;break e;case 4:qi=a.stateNode.containerInfo,cu=!0;break e}a=a.return}if(qi===null)throw Error(Qe(160));FW(o,s,i),qi=null,cu=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(l){jr(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)OW(e,n),e=e.sibling}function OW(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(tu(e,n),Gu(n),r&4){try{V0(3,n,n.return),zS(3,n)}catch(v){jr(n,n.return,v)}try{V0(5,n,n.return)}catch(v){jr(n,n.return,v)}}break;case 1:tu(e,n),Gu(n),r&512&&t!==null&&Lm(t,t.return);break;case 5:if(tu(e,n),Gu(n),r&512&&t!==null&&Lm(t,t.return),n.flags&32){var i=n.stateNode;try{wy(i,"")}catch(v){jr(n,n.return,v)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,u=n.updateQueue;if(n.updateQueue=null,u!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&oV(i,o),gR(a,s);var l=gR(a,o);for(s=0;s<u.length;s+=2){var c=u[s],h=u[s+1];c==="style"?cV(i,h):c==="dangerouslySetInnerHTML"?uV(i,h):c==="children"?wy(i,h):F4(i,c,h,l)}switch(a){case"input":fR(i,o);break;case"textarea":sV(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var d=o.value;d!=null?Jm(i,!!o.multiple,d,!1):f!==!!o.multiple&&(o.defaultValue!=null?Jm(i,!!o.multiple,o.defaultValue,!0):Jm(i,!!o.multiple,o.multiple?[]:"",!1))}i[Ay]=o}catch(v){jr(n,n.return,v)}}break;case 6:if(tu(e,n),Gu(n),r&4){if(n.stateNode===null)throw Error(Qe(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(v){jr(n,n.return,v)}}break;case 3:if(tu(e,n),Gu(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Ey(e.containerInfo)}catch(v){jr(n,n.return,v)}break;case 4:tu(e,n),Gu(n);break;case 13:tu(e,n),Gu(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(mP=ni())),r&4&&bO(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(bo=(l=bo)||c,tu(e,n),bo=l):tu(e,n),Gu(n),r&8192){if(l=n.memoizedState!==null,(n.stateNode.isHidden=l)&&!c&&n.mode&1)for(gt=n,c=n.child;c!==null;){for(h=gt=c;gt!==null;){switch(f=gt,d=f.child,f.tag){case 0:case 11:case 14:case 15:V0(4,f,f.return);break;case 1:Lm(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(v){jr(r,t,v)}}break;case 5:Lm(f,f.return);break;case 22:if(f.memoizedState!==null){EO(h);continue}}d!==null?(d.return=f,gt=d):EO(h)}c=c.sibling}e:for(c=null,h=n;;){if(h.tag===5){if(c===null){c=h;try{i=h.stateNode,l?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=h.stateNode,u=h.memoizedProps.style,s=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=lV("display",s))}catch(v){jr(n,n.return,v)}}}else if(h.tag===6){if(c===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(v){jr(n,n.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;c===h&&(c=null),h=h.return}c===h&&(c=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:tu(e,n),Gu(n),r&4&&bO(n);break;case 21:break;default:tu(e,n),Gu(n)}}function Gu(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(LW(t)){var r=t;break e}t=t.return}throw Error(Qe(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(wy(i,""),r.flags&=-33);var o=_O(n);XR(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=_O(n);jR(n,a,s);break;default:throw Error(Qe(161))}}catch(u){jr(n,n.return,u)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Iee(n,e,t){gt=n,BW(n)}function BW(n,e,t){for(var r=(n.mode&1)!==0;gt!==null;){var i=gt,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||A2;if(!s){var a=i.alternate,u=a!==null&&a.memoizedState!==null||bo;a=A2;var l=bo;if(A2=s,(bo=u)&&!l)for(gt=i;gt!==null;)s=gt,u=s.child,s.tag===22&&s.memoizedState!==null?CO(i):u!==null?(u.return=s,gt=u):CO(i);for(;o!==null;)gt=o,BW(o),o=o.sibling;gt=i,A2=a,bo=l}SO(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,gt=o):SO(n)}}function SO(n){for(;gt!==null;){var e=gt;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bo||zS(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bo)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:uu(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&aO(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}aO(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&t.focus();break;case"img":u.src&&(t.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var c=l.memoizedState;if(c!==null){var h=c.dehydrated;h!==null&&Ey(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Qe(163))}bo||e.flags&512&&$R(e)}catch(f){jr(e,e.return,f)}}if(e===n){gt=null;break}if(t=e.sibling,t!==null){t.return=e.return,gt=t;break}gt=e.return}}function EO(n){for(;gt!==null;){var e=gt;if(e===n){gt=null;break}var t=e.sibling;if(t!==null){t.return=e.return,gt=t;break}gt=e.return}}function CO(n){for(;gt!==null;){var e=gt;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{zS(4,e)}catch(u){jr(e,t,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){jr(e,i,u)}}var o=e.return;try{$R(e)}catch(u){jr(e,o,u)}break;case 5:var s=e.return;try{$R(e)}catch(u){jr(e,s,u)}}}catch(u){jr(e,e.return,u)}if(e===n){gt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,gt=a;break}gt=e.return}}var Pee=Math.ceil,pb=Sc.ReactCurrentDispatcher,dP=Sc.ReactCurrentOwner,za=Sc.ReactCurrentBatchConfig,Bn=0,Vi=null,fi=null,no=0,Hs=0,Fm=nf(0),Ci=0,Ly=null,Wd=0,VS=0,pP=0,W0=null,cs=null,mP=0,Dv=1/0,Hl=null,mb=!1,qR=null,Th=null,I2=!1,fh=null,vb=0,H0=0,YR=null,b_=-1,S_=0;function Zo(){return Bn&6?ni():b_!==-1?b_:b_=ni()}function Rh(n){return n.mode&1?Bn&2&&no!==0?no&-no:pee.transition!==null?(S_===0&&(S_=bV()),S_):(n=er,n!==0||(n=window.event,n=n===void 0?16:AV(n.type)),n):1}function xu(n,e,t,r){if(50<H0)throw H0=0,YR=null,Error(Qe(185));I1(n,t,r),(!(Bn&2)||n!==Vi)&&(n===Vi&&(!(Bn&2)&&(VS|=t),Ci===4&&lh(n,no)),_s(n,r),t===1&&Bn===0&&!(e.mode&1)&&(Dv=ni()+500,OS&&rf()))}function _s(n,e){var t=n.callbackNode;pJ(n,e);var r=J_(n,n===Vi?no:0);if(r===0)t!==null&&NF(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&NF(t),e===1)n.tag===0?dee(MO.bind(null,n)):qV(MO.bind(null,n)),lee(function(){!(Bn&6)&&rf()}),t=null;else{switch(SV(r)){case 1:t=V4;break;case 4:t=wV;break;case 16:t=Q_;break;case 536870912:t=_V;break;default:t=Q_}t=jW(t,UW.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function UW(n,e){if(b_=-1,S_=0,Bn&6)throw Error(Qe(327));var t=n.callbackNode;if(iv()&&n.callbackNode!==t)return null;var r=J_(n,n===Vi?no:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=gb(n,r);else{e=r;var i=Bn;Bn|=2;var o=VW();(Vi!==n||no!==e)&&(Hl=null,Dv=ni()+500,wd(n,e));do try{Nee();break}catch(a){zW(n,a)}while(!0);eP(),pb.current=o,Bn=i,fi!==null?e=0:(Vi=null,no=0,e=Ci)}if(e!==0){if(e===2&&(i=bR(n),i!==0&&(r=i,e=KR(n,i))),e===1)throw t=Ly,wd(n,0),lh(n,r),_s(n,ni()),t;if(e===6)lh(n,r);else{if(i=n.current.alternate,!(r&30)&&!kee(i)&&(e=gb(n,r),e===2&&(o=bR(n),o!==0&&(r=o,e=KR(n,o))),e===1))throw t=Ly,wd(n,0),lh(n,r),_s(n,ni()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Qe(345));case 2:Hf(n,cs,Hl);break;case 3:if(lh(n,r),(r&130023424)===r&&(e=mP+500-ni(),10<e)){if(J_(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Zo(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=IR(Hf.bind(null,n,cs,Hl),e);break}Hf(n,cs,Hl);break;case 4:if(lh(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-yu(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=ni()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Pee(r/1960))-r,10<r){n.timeoutHandle=IR(Hf.bind(null,n,cs,Hl),r);break}Hf(n,cs,Hl);break;case 5:Hf(n,cs,Hl);break;default:throw Error(Qe(329))}}}return _s(n,ni()),n.callbackNode===t?UW.bind(null,n):null}function KR(n,e){var t=W0;return n.current.memoizedState.isDehydrated&&(wd(n,e).flags|=256),n=gb(n,e),n!==2&&(e=cs,cs=t,e!==null&&ZR(e)),n}function ZR(n){cs===null?cs=n:cs.push.apply(cs,n)}function kee(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Cu(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function lh(n,e){for(e&=~pP,e&=~VS,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-yu(e),r=1<<t;n[t]=-1,e&=~r}}function MO(n){if(Bn&6)throw Error(Qe(327));iv();var e=J_(n,0);if(!(e&1))return _s(n,ni()),null;var t=gb(n,e);if(n.tag!==0&&t===2){var r=bR(n);r!==0&&(e=r,t=KR(n,r))}if(t===1)throw t=Ly,wd(n,0),lh(n,e),_s(n,ni()),t;if(t===6)throw Error(Qe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Hf(n,cs,Hl),_s(n,ni()),null}function vP(n,e){var t=Bn;Bn|=1;try{return n(e)}finally{Bn=t,Bn===0&&(Dv=ni()+500,OS&&rf())}}function Hd(n){fh!==null&&fh.tag===0&&!(Bn&6)&&iv();var e=Bn;Bn|=1;var t=za.transition,r=er;try{if(za.transition=null,er=1,n)return n()}finally{er=r,za.transition=t,Bn=e,!(Bn&6)&&rf()}}function gP(){Hs=Fm.current,gr(Fm)}function wd(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,uee(t)),fi!==null)for(t=fi.return;t!==null;){var r=t;switch(Z4(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ib();break;case 3:Pv(),gr(xs),gr(Do),sP();break;case 5:oP(r);break;case 4:Pv();break;case 13:gr(Rr);break;case 19:gr(Rr);break;case 10:tP(r.type._context);break;case 22:case 23:gP()}t=t.return}if(Vi=n,fi=n=Ah(n.current,null),no=Hs=e,Ci=0,Ly=null,pP=VS=Wd=0,cs=W0=null,od!==null){for(e=0;e<od.length;e++)if(t=od[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}od=null}return n}function zW(n,e){do{var t=fi;try{if(eP(),x_.current=db,fb){for(var r=Dr.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}fb=!1}if(Vd=0,Ui=wi=Dr=null,z0=!1,ky=0,dP.current=null,t===null||t.return===null){Ci=1,Ly=e,fi=null;break}e:{var o=n,s=t.return,a=t,u=e;if(e=no,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var l=u,c=a,h=c.tag;if(!(c.mode&1)&&(h===0||h===11||h===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=dO(s);if(d!==null){d.flags&=-257,pO(d,s,a,o,e),d.mode&1&&fO(o,l,e),e=d,u=l;var p=e.updateQueue;if(p===null){var v=new Set;v.add(u),e.updateQueue=v}else p.add(u);break e}else{if(!(e&1)){fO(o,l,e),yP();break e}u=Error(Qe(426))}}else if(_r&&a.mode&1){var g=dO(s);if(g!==null){!(g.flags&65536)&&(g.flags|=256),pO(g,s,a,o,e),Q4(kv(u,a));break e}}o=u=kv(u,a),Ci!==4&&(Ci=2),W0===null?W0=[o]:W0.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var m=SW(o,u,e);sO(o,m);break e;case 1:a=u;var x=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Th===null||!Th.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var b=EW(o,a,e);sO(o,b);break e}}o=o.return}while(o!==null)}HW(t)}catch(S){e=S,fi===t&&t!==null&&(fi=t=t.return);continue}break}while(!0)}function VW(){var n=pb.current;return pb.current=db,n===null?db:n}function yP(){(Ci===0||Ci===3||Ci===2)&&(Ci=4),Vi===null||!(Wd&268435455)&&!(VS&268435455)||lh(Vi,no)}function gb(n,e){var t=Bn;Bn|=2;var r=VW();(Vi!==n||no!==e)&&(Hl=null,wd(n,e));do try{Dee();break}catch(i){zW(n,i)}while(!0);if(eP(),Bn=t,pb.current=r,fi!==null)throw Error(Qe(261));return Vi=null,no=0,Ci}function Dee(){for(;fi!==null;)WW(fi)}function Nee(){for(;fi!==null&&!oJ();)WW(fi)}function WW(n){var e=$W(n.alternate,n,Hs);n.memoizedProps=n.pendingProps,e===null?HW(n):fi=e,dP.current=null}function HW(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Tee(t,e),t!==null){t.flags&=32767,fi=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ci=6,fi=null;return}}else if(t=Mee(t,e,Hs),t!==null){fi=t;return}if(e=e.sibling,e!==null){fi=e;return}fi=e=n}while(e!==null);Ci===0&&(Ci=5)}function Hf(n,e,t){var r=er,i=za.transition;try{za.transition=null,er=1,Lee(n,e,t,r)}finally{za.transition=i,er=r}return null}function Lee(n,e,t,r){do iv();while(fh!==null);if(Bn&6)throw Error(Qe(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Qe(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(mJ(n,o),n===Vi&&(fi=Vi=null,no=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||I2||(I2=!0,jW(Q_,function(){return iv(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=za.transition,za.transition=null;var s=er;er=1;var a=Bn;Bn|=4,dP.current=null,Aee(n,t),OW(t,n),tee(RR),eb=!!TR,RR=TR=null,n.current=t,Iee(t),sJ(),Bn=a,er=s,za.transition=o}else n.current=t;if(I2&&(I2=!1,fh=n,vb=i),o=n.pendingLanes,o===0&&(Th=null),lJ(t.stateNode),_s(n,ni()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(mb)throw mb=!1,n=qR,qR=null,n;return vb&1&&n.tag!==0&&iv(),o=n.pendingLanes,o&1?n===YR?H0++:(H0=0,YR=n):H0=0,rf(),null}function iv(){if(fh!==null){var n=SV(vb),e=za.transition,t=er;try{if(za.transition=null,er=16>n?16:n,fh===null)var r=!1;else{if(n=fh,fh=null,vb=0,Bn&6)throw Error(Qe(331));var i=Bn;for(Bn|=4,gt=n.current;gt!==null;){var o=gt,s=o.child;if(gt.flags&16){var a=o.deletions;if(a!==null){for(var u=0;u<a.length;u++){var l=a[u];for(gt=l;gt!==null;){var c=gt;switch(c.tag){case 0:case 11:case 15:V0(8,c,o)}var h=c.child;if(h!==null)h.return=c,gt=h;else for(;gt!==null;){c=gt;var f=c.sibling,d=c.return;if(NW(c),c===l){gt=null;break}if(f!==null){f.return=d,gt=f;break}gt=d}}}var p=o.alternate;if(p!==null){var v=p.child;if(v!==null){p.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(v!==null)}}gt=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,gt=s;else e:for(;gt!==null;){if(o=gt,o.flags&2048)switch(o.tag){case 0:case 11:case 15:V0(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,gt=m;break e}gt=o.return}}var x=n.current;for(gt=x;gt!==null;){s=gt;var _=s.child;if(s.subtreeFlags&2064&&_!==null)_.return=s,gt=_;else e:for(s=x;gt!==null;){if(a=gt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:zS(9,a)}}catch(S){jr(a,a.return,S)}if(a===s){gt=null;break e}var b=a.sibling;if(b!==null){b.return=a.return,gt=b;break e}gt=a.return}}if(Bn=i,rf(),cl&&typeof cl.onPostCommitFiberRoot=="function")try{cl.onPostCommitFiberRoot(kS,n)}catch{}r=!0}return r}finally{er=t,za.transition=e}}return!1}function TO(n,e,t){e=kv(t,e),e=SW(n,e,1),n=Mh(n,e,1),e=Zo(),n!==null&&(I1(n,1,e),_s(n,e))}function jr(n,e,t){if(n.tag===3)TO(n,n,t);else for(;e!==null;){if(e.tag===3){TO(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Th===null||!Th.has(r))){n=kv(t,n),n=EW(e,n,1),e=Mh(e,n,1),n=Zo(),e!==null&&(I1(e,1,n),_s(e,n));break}}e=e.return}}function Fee(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Zo(),n.pingedLanes|=n.suspendedLanes&t,Vi===n&&(no&t)===t&&(Ci===4||Ci===3&&(no&130023424)===no&&500>ni()-mP?wd(n,0):pP|=t),_s(n,e)}function GW(n,e){e===0&&(n.mode&1?(e=w2,w2<<=1,!(w2&130023424)&&(w2=4194304)):e=1);var t=Zo();n=fc(n,e),n!==null&&(I1(n,e,t),_s(n,t))}function Oee(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),GW(n,t)}function Bee(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Qe(314))}r!==null&&r.delete(e),GW(n,t)}var $W;$W=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||xs.current)ms=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return ms=!1,Cee(n,e,t);ms=!!(n.flags&131072)}else ms=!1,_r&&e.flags&1048576&&YV(e,ab,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;__(n,e),n=e.pendingProps;var i=Rv(e,Do.current);rv(e,t),i=uP(null,e,r,n,i,t);var o=lP();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ws(r)?(o=!0,ob(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,rP(e),i.updater=US,e.stateNode=i,i._reactInternals=e,OR(e,r,n,t),e=zR(null,e,r,!0,o,t)):(e.tag=0,_r&&o&&K4(e),Wo(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(__(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=zee(r),n=uu(r,n),i){case 0:e=UR(null,e,r,n,t);break e;case 1:e=gO(null,e,r,n,t);break e;case 11:e=mO(null,e,r,n,t);break e;case 14:e=vO(null,e,r,uu(r.type,n),t);break e}throw Error(Qe(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:uu(r,i),UR(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:uu(r,i),gO(n,e,r,i,t);case 3:e:{if(RW(e),n===null)throw Error(Qe(387));r=e.pendingProps,o=e.memoizedState,i=o.element,tW(n,e),cb(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=kv(Error(Qe(423)),e),e=yO(n,e,r,t,i);break e}else if(r!==i){i=kv(Error(Qe(424)),e),e=yO(n,e,r,t,i);break e}else for(ea=Ch(e.stateNode.containerInfo.firstChild),sa=e,_r=!0,hu=null,t=JV(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Av(),r===i){e=dc(n,e,t);break e}Wo(n,e,r,t)}e=e.child}return e;case 5:return nW(e),n===null&&NR(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,AR(r,i)?s=null:o!==null&&AR(r,o)&&(e.flags|=32),TW(n,e),Wo(n,e,s,t),e.child;case 6:return n===null&&NR(e),null;case 13:return AW(n,e,t);case 4:return iP(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Iv(e,null,r,t):Wo(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:uu(r,i),mO(n,e,r,i,t);case 7:return Wo(n,e,e.pendingProps,t),e.child;case 8:return Wo(n,e,e.pendingProps.children,t),e.child;case 12:return Wo(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,hr(ub,r._currentValue),r._currentValue=s,o!==null)if(Cu(o.value,s)){if(o.children===i.children&&!xs.current){e=dc(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(o.tag===1){u=ic(-1,t&-t),u.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var c=l.pending;c===null?u.next=u:(u.next=c.next,c.next=u),l.pending=u}}o.lanes|=t,u=o.alternate,u!==null&&(u.lanes|=t),LR(o.return,t,e),a.lanes|=t;break}u=u.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Qe(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),LR(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Wo(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,rv(e,t),i=Ha(i),r=r(i),e.flags|=1,Wo(n,e,r,t),e.child;case 14:return r=e.type,i=uu(r,e.pendingProps),i=uu(r.type,i),vO(n,e,r,i,t);case 15:return CW(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:uu(r,i),__(n,e),e.tag=1,ws(r)?(n=!0,ob(e)):n=!1,rv(e,t),bW(e,r,i),OR(e,r,i,t),zR(null,e,r,!0,n,t);case 19:return IW(n,e,t);case 22:return MW(n,e,t)}throw Error(Qe(156,e.tag))};function jW(n,e){return xV(n,e)}function Uee(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function La(n,e,t,r){return new Uee(n,e,t,r)}function xP(n){return n=n.prototype,!(!n||!n.isReactComponent)}function zee(n){if(typeof n=="function")return xP(n)?1:0;if(n!=null){if(n=n.$$typeof,n===B4)return 11;if(n===U4)return 14}return 2}function Ah(n,e){var t=n.alternate;return t===null?(t=La(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function E_(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")xP(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case Mm:return _d(t.children,i,o,e);case O4:s=8,i|=8;break;case aR:return n=La(12,t,e,i|2),n.elementType=aR,n.lanes=o,n;case uR:return n=La(13,t,e,i),n.elementType=uR,n.lanes=o,n;case lR:return n=La(19,t,e,i),n.elementType=lR,n.lanes=o,n;case nV:return WS(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case eV:s=10;break e;case tV:s=9;break e;case B4:s=11;break e;case U4:s=14;break e;case rh:s=16,r=null;break e}throw Error(Qe(130,n==null?n:typeof n,""))}return e=La(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function _d(n,e,t,r){return n=La(7,n,r,e),n.lanes=t,n}function WS(n,e,t,r){return n=La(22,n,r,e),n.elementType=nV,n.lanes=t,n.stateNode={isHidden:!1},n}function P3(n,e,t){return n=La(6,n,null,e),n.lanes=t,n}function k3(n,e,t){return e=La(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Vee(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=f3(0),this.expirationTimes=f3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=f3(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function wP(n,e,t,r,i,o,s,a,u){return n=new Vee(n,e,t,a,u),e===1?(e=1,o===!0&&(e|=8)):e=0,o=La(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},rP(o),n}function Wee(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Cm,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function XW(n){if(!n)return Uh;n=n._reactInternals;e:{if(tp(n)!==n||n.tag!==1)throw Error(Qe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ws(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Qe(171))}if(n.tag===1){var t=n.type;if(ws(t))return XV(n,t,e)}return e}function qW(n,e,t,r,i,o,s,a,u){return n=wP(t,r,!0,n,i,o,s,a,u),n.context=XW(null),t=n.current,r=Zo(),i=Rh(t),o=ic(r,i),o.callback=e??null,Mh(t,o,i),n.current.lanes=i,I1(n,i,r),_s(n,r),n}function HS(n,e,t,r){var i=e.current,o=Zo(),s=Rh(i);return t=XW(t),e.context===null?e.context=t:e.pendingContext=t,e=ic(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Mh(i,e,s),n!==null&&(xu(n,i,s,o),y_(n,i,s)),s}function yb(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function RO(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function _P(n,e){RO(n,e),(n=n.alternate)&&RO(n,e)}function Hee(){return null}var YW=typeof reportError=="function"?reportError:function(n){console.error(n)};function bP(n){this._internalRoot=n}GS.prototype.render=bP.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Qe(409));HS(n,e,null,null)};GS.prototype.unmount=bP.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Hd(function(){HS(null,n,null,null)}),e[hc]=null}};function GS(n){this._internalRoot=n}GS.prototype.unstable_scheduleHydration=function(n){if(n){var e=MV();n={blockedOn:null,target:n,priority:e};for(var t=0;t<uh.length&&e!==0&&e<uh[t].priority;t++);uh.splice(t,0,n),t===0&&RV(n)}};function SP(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function $S(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function AO(){}function Gee(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var l=yb(s);o.call(l)}}var s=qW(e,r,n,0,null,!1,!1,"",AO);return n._reactRootContainer=s,n[hc]=s.current,Ty(n.nodeType===8?n.parentNode:n),Hd(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var l=yb(u);a.call(l)}}var u=wP(n,0,!1,null,null,!1,!1,"",AO);return n._reactRootContainer=u,n[hc]=u.current,Ty(n.nodeType===8?n.parentNode:n),Hd(function(){HS(e,u,t,r)}),u}function jS(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var u=yb(s);a.call(u)}}HS(e,s,n,i)}else s=Gee(t,e,n,i,r);return yb(s)}EV=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=E0(e.pendingLanes);t!==0&&(W4(e,t|1),_s(e,ni()),!(Bn&6)&&(Dv=ni()+500,rf()))}break;case 13:Hd(function(){var r=fc(n,1);if(r!==null){var i=Zo();xu(r,n,1,i)}}),_P(n,1)}};H4=function(n){if(n.tag===13){var e=fc(n,134217728);if(e!==null){var t=Zo();xu(e,n,134217728,t)}_P(n,134217728)}};CV=function(n){if(n.tag===13){var e=Rh(n),t=fc(n,e);if(t!==null){var r=Zo();xu(t,n,e,r)}_P(n,e)}};MV=function(){return er};TV=function(n,e){var t=er;try{return er=n,e()}finally{er=t}};xR=function(n,e,t){switch(e){case"input":if(fR(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=FS(r);if(!i)throw Error(Qe(90));iV(r),fR(r,i)}}}break;case"textarea":sV(n,t);break;case"select":e=t.value,e!=null&&Jm(n,!!t.multiple,e,!1)}};dV=vP;pV=Hd;var $ee={usingClientEntryPoint:!1,Events:[k1,Im,FS,hV,fV,vP]},Xg={findFiberByHostInstance:id,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},jee={bundleType:Xg.bundleType,version:Xg.version,rendererPackageName:Xg.rendererPackageName,rendererConfig:Xg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sc.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=gV(n),n===null?null:n.stateNode},findFiberByHostInstance:Xg.findFiberByHostInstance||Hee,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var P2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!P2.isDisabled&&P2.supportsFiber)try{kS=P2.inject(jee),cl=P2}catch{}}da.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$ee;da.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!SP(e))throw Error(Qe(200));return Wee(n,e,null,t)};da.createRoot=function(n,e){if(!SP(n))throw Error(Qe(299));var t=!1,r="",i=YW;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=wP(n,1,!1,null,null,t,!1,r,i),n[hc]=e.current,Ty(n.nodeType===8?n.parentNode:n),new bP(e)};da.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Qe(188)):(n=Object.keys(n).join(","),Error(Qe(268,n)));return n=gV(e),n=n===null?null:n.stateNode,n};da.flushSync=function(n){return Hd(n)};da.hydrate=function(n,e,t){if(!$S(e))throw Error(Qe(200));return jS(null,n,e,!0,t)};da.hydrateRoot=function(n,e,t){if(!SP(n))throw Error(Qe(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=YW;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=qW(e,null,n,1,t??null,i,!1,o,s),n[hc]=e.current,Ty(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new GS(e)};da.render=function(n,e,t){if(!$S(e))throw Error(Qe(200));return jS(null,n,e,!1,t)};da.unmountComponentAtNode=function(n){if(!$S(n))throw Error(Qe(40));return n._reactRootContainer?(Hd(function(){jS(null,null,n,!1,function(){n._reactRootContainer=null,n[hc]=null})}),!0):!1};da.unstable_batchedUpdates=vP;da.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!$S(t))throw Error(Qe(200));if(n==null||n._reactInternals===void 0)throw Error(Qe(38));return jS(n,e,t,!1,r)};da.version="18.3.1-next-f1338f8080-20240426";function KW(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KW)}catch(n){console.error(n)}}KW(),K8.exports=da;var Xee=K8.exports,ZW,IO=Xee;ZW=IO.createRoot,IO.hydrateRoot;/**
 * react-router v7.11.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var PO="popstate";function qee(n={}){function e(r,i){let{pathname:o,search:s,hash:a}=r.location;return QR("",{pathname:o,search:s,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:Fy(i)}return Kee(e,t,null,n)}function Nr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Mu(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Yee(){return Math.random().toString(36).substring(2,10)}function kO(n,e){return{usr:n.state,key:n.key,idx:e}}function QR(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?ig(e):e,state:t,key:e&&e.key||r||Yee()}}function Fy({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function ig(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function Kee(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a="POP",u=null,l=c();l==null&&(l=0,s.replaceState({...s.state,idx:l},""));function c(){return(s.state||{idx:null}).idx}function h(){a="POP";let g=c(),m=g==null?null:g-l;l=g,u&&u({action:a,location:v.location,delta:m})}function f(g,m){a="PUSH";let x=QR(v.location,g,m);l=c()+1;let _=kO(x,l),b=v.createHref(x);try{s.pushState(_,"",b)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;i.location.assign(b)}o&&u&&u({action:a,location:v.location,delta:1})}function d(g,m){a="REPLACE";let x=QR(v.location,g,m);l=c();let _=kO(x,l),b=v.createHref(x);s.replaceState(_,"",b),o&&u&&u({action:a,location:v.location,delta:0})}function p(g){return Zee(g)}let v={get action(){return a},get location(){return n(i,s)},listen(g){if(u)throw new Error("A history only accepts one active listener");return i.addEventListener(PO,h),u=g,()=>{i.removeEventListener(PO,h),u=null}},createHref(g){return e(i,g)},createURL:p,encodeLocation(g){let m=p(g);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:d,go(g){return s.go(g)}};return v}function Zee(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Nr(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:Fy(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function QW(n,e,t="/"){return Qee(n,e,t,!1)}function Qee(n,e,t,r){let i=typeof e=="string"?ig(e):e,o=pc(i.pathname||"/",t);if(o==null)return null;let s=JW(n);Jee(s);let a=null;for(let u=0;a==null&&u<s.length;++u){let l=cte(o);a=ute(s[u],l,r)}return a}function JW(n,e=[],t=[],r="",i=!1){let o=(s,a,u=i,l)=>{let c={relativePath:l===void 0?s.path||"":l,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(r)&&u)return;Nr(c.relativePath.startsWith(r),`Absolute route path "${c.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(r.length)}let h=oc([r,c.relativePath]),f=t.concat(c);s.children&&s.children.length>0&&(Nr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),JW(s.children,e,f,h,u)),!(s.path==null&&!s.index)&&e.push({path:h,score:ste(h,s.index),routesMeta:f})};return n.forEach((s,a)=>{var u;if(s.path===""||!((u=s.path)!=null&&u.includes("?")))o(s,a);else for(let l of e7(s.path))o(s,a,!0,l)}),e}function e7(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let s=e7(r.join("/")),a=[];return a.push(...s.map(u=>u===""?o:[o,u].join("/"))),i&&a.push(...s),a.map(u=>n.startsWith("/")&&u===""?"/":u)}function Jee(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:ate(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var ete=/^:[\w-]+$/,tte=3,nte=2,rte=1,ite=10,ote=-2,DO=n=>n==="*";function ste(n,e){let t=n.split("/"),r=t.length;return t.some(DO)&&(r+=ote),e&&(r+=nte),t.filter(i=>!DO(i)).reduce((i,o)=>i+(ete.test(o)?tte:o===""?rte:ite),r)}function ate(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function ute(n,e,t=!1){let{routesMeta:r}=n,i={},o="/",s=[];for(let a=0;a<r.length;++a){let u=r[a],l=a===r.length-1,c=o==="/"?e:e.slice(o.length)||"/",h=xb({path:u.relativePath,caseSensitive:u.caseSensitive,end:l},c),f=u.route;if(!h&&l&&t&&!r[r.length-1].route.index&&(h=xb({path:u.relativePath,caseSensitive:u.caseSensitive,end:!1},c)),!h)return null;Object.assign(i,h.params),s.push({params:i,pathname:oc([o,h.pathname]),pathnameBase:pte(oc([o,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(o=oc([o,h.pathnameBase]))}return s}function xb(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=lte(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,{paramName:c,isOptional:h},f)=>{if(c==="*"){let p=a[f]||"";s=o.slice(0,o.length-p.length).replace(/(.)\/+$/,"$1")}const d=a[f];return h&&!d?l[c]=void 0:l[c]=(d||"").replace(/%2F/g,"/"),l},{}),pathname:o,pathnameBase:s,pattern:n}}function lte(n,e=!1,t=!0){Mu(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,a,u)=>(r.push({paramName:a,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function cte(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Mu(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function pc(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}var t7=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,hte=n=>t7.test(n);function fte(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?ig(n):n,o;if(t)if(hte(t))o=t;else{if(t.includes("//")){let s=t;t=t.replace(/\/\/+/g,"/"),Mu(!1,`Pathnames cannot have embedded double slashes - normalizing ${s} -> ${t}`)}t.startsWith("/")?o=NO(t.substring(1),"/"):o=NO(t,e)}else o=e;return{pathname:o,search:mte(r),hash:vte(i)}}function NO(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function D3(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function dte(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function n7(n){let e=dte(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function r7(n,e,t,r=!1){let i;typeof n=="string"?i=ig(n):(i={...n},Nr(!i.pathname||!i.pathname.includes("?"),D3("?","pathname","search",i)),Nr(!i.pathname||!i.pathname.includes("#"),D3("#","pathname","hash",i)),Nr(!i.search||!i.search.includes("#"),D3("#","search","hash",i)));let o=n===""||i.pathname==="",s=o?"/":i.pathname,a;if(s==null)a=t;else{let h=e.length-1;if(!r&&s.startsWith("..")){let f=s.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}a=h>=0?e[h]:"/"}let u=fte(i,a),l=s&&s!=="/"&&s.endsWith("/"),c=(o||s===".")&&t.endsWith("/");return!u.pathname.endsWith("/")&&(l||c)&&(u.pathname+="/"),u}var oc=n=>n.join("/").replace(/\/\/+/g,"/"),pte=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),mte=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,vte=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,gte=class{constructor(n,e,t,r=!1){this.status=n,this.statusText=e||"",this.internal=r,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function yte(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function xte(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var i7=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function o7(n,e){let t=n;if(typeof t!="string"||!t7.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let r=t,i=!1;if(i7)try{let o=new URL(window.location.href),s=t.startsWith("//")?new URL(o.protocol+t):new URL(t),a=pc(s.pathname,e);s.origin===o.origin&&a!=null?t=a+s.search+s.hash:i=!0}catch{Mu(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var s7=["POST","PUT","PATCH","DELETE"];new Set(s7);var wte=["GET",...s7];new Set(wte);var og=H.createContext(null);og.displayName="DataRouter";var XS=H.createContext(null);XS.displayName="DataRouterState";var _te=H.createContext(!1),a7=H.createContext({isTransitioning:!1});a7.displayName="ViewTransition";var bte=H.createContext(new Map);bte.displayName="Fetchers";var Ste=H.createContext(null);Ste.displayName="Await";var Za=H.createContext(null);Za.displayName="Navigation";var N1=H.createContext(null);N1.displayName="Location";var Ec=H.createContext({outlet:null,matches:[],isDataRoute:!1});Ec.displayName="Route";var EP=H.createContext(null);EP.displayName="RouteError";var u7="REACT_ROUTER_ERROR",Ete="REDIRECT",Cte="ROUTE_ERROR_RESPONSE";function Mte(n){if(n.startsWith(`${u7}:${Ete}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function Tte(n){if(n.startsWith(`${u7}:${Cte}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new gte(e.status,e.statusText,e.data)}catch{}}function Rte(n,{relative:e}={}){Nr(L1(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=H.useContext(Za),{hash:i,pathname:o,search:s}=F1(n,{relative:e}),a=o;return t!=="/"&&(a=o==="/"?t:oc([t,o])),r.createHref({pathname:a,search:s,hash:i})}function L1(){return H.useContext(N1)!=null}function Ru(){return Nr(L1(),"useLocation() may be used only in the context of a <Router> component."),H.useContext(N1).location}var l7="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function c7(n){H.useContext(Za).static||H.useLayoutEffect(n)}function qS(){let{isDataRoute:n}=H.useContext(Ec);return n?Vte():Ate()}function Ate(){Nr(L1(),"useNavigate() may be used only in the context of a <Router> component.");let n=H.useContext(og),{basename:e,navigator:t}=H.useContext(Za),{matches:r}=H.useContext(Ec),{pathname:i}=Ru(),o=JSON.stringify(n7(r)),s=H.useRef(!1);return c7(()=>{s.current=!0}),H.useCallback((u,l={})=>{if(Mu(s.current,l7),!s.current)return;if(typeof u=="number"){t.go(u);return}let c=r7(u,JSON.parse(o),i,l.relative==="path");n==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:oc([e,c.pathname])),(l.replace?t.replace:t.push)(c,l.state,l)},[e,t,o,i,n])}H.createContext(null);function F1(n,{relative:e}={}){let{matches:t}=H.useContext(Ec),{pathname:r}=Ru(),i=JSON.stringify(n7(t));return H.useMemo(()=>r7(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function Ite(n,e){return h7(n,e)}function h7(n,e,t,r,i){var x;Nr(L1(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=H.useContext(Za),{matches:s}=H.useContext(Ec),a=s[s.length-1],u=a?a.params:{},l=a?a.pathname:"/",c=a?a.pathnameBase:"/",h=a&&a.route;{let _=h&&h.path||"";d7(l,!h||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let f=Ru(),d;if(e){let _=typeof e=="string"?ig(e):e;Nr(c==="/"||((x=_.pathname)==null?void 0:x.startsWith(c)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${_.pathname}" was given in the \`location\` prop.`),d=_}else d=f;let p=d.pathname||"/",v=p;if(c!=="/"){let _=c.replace(/^\//,"").split("/");v="/"+p.replace(/^\//,"").split("/").slice(_.length).join("/")}let g=QW(n,{pathname:v});Mu(h||g!=null,`No routes matched location "${d.pathname}${d.search}${d.hash}" `),Mu(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${d.pathname}${d.search}${d.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let m=Lte(g&&g.map(_=>Object.assign({},_,{params:Object.assign({},u,_.params),pathname:oc([c,o.encodeLocation?o.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?c:oc([c,o.encodeLocation?o.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),s,t,r,i);return e&&m?H.createElement(N1.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...d},navigationType:"POP"}},m):m}function Pte(){let n=zte(),e=yte(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",n),s=H.createElement(H.Fragment,null,H.createElement("p",null," Hey developer "),H.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",H.createElement("code",{style:o},"ErrorBoundary")," or"," ",H.createElement("code",{style:o},"errorElement")," prop on your route.")),H.createElement(H.Fragment,null,H.createElement("h2",null,"Unexpected Application Error!"),H.createElement("h3",{style:{fontStyle:"italic"}},e),t?H.createElement("pre",{style:i},t):null,s)}var kte=H.createElement(Pte,null),f7=class extends H.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const t=Tte(n.digest);t&&(n=t)}let e=n!==void 0?H.createElement(Ec.Provider,{value:this.props.routeContext},H.createElement(EP.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?H.createElement(Dte,{error:n},e):e}};f7.contextType=_te;var N3=new WeakMap;function Dte({children:n,error:e}){let{basename:t}=H.useContext(Za);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=Mte(e.digest);if(r){let i=N3.get(e);if(i)throw i;let o=o7(r.location,t);if(i7&&!N3.get(e))if(o.isExternal||r.reloadDocument)window.location.href=o.absoluteURL||o.to;else{const s=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(o.to,{replace:r.replace}));throw N3.set(e,s),s}return H.createElement("meta",{httpEquiv:"refresh",content:`0;url=${o.absoluteURL||o.to}`})}}return n}function Nte({routeContext:n,match:e,children:t}){let r=H.useContext(og);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),H.createElement(Ec.Provider,{value:n},t)}function Lte(n,e=[],t=null,r=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,s=t==null?void 0:t.errors;if(s!=null){let c=o.findIndex(h=>h.route.id&&(s==null?void 0:s[h.route.id])!==void 0);Nr(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),o=o.slice(0,Math.min(o.length,c+1))}let a=!1,u=-1;if(t)for(let c=0;c<o.length;c++){let h=o[c];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=c),h.route.id){let{loaderData:f,errors:d}=t,p=h.route.loader&&!f.hasOwnProperty(h.route.id)&&(!d||d[h.route.id]===void 0);if(h.route.lazy||p){a=!0,u>=0?o=o.slice(0,u+1):o=[o[0]];break}}}let l=t&&r?(c,h)=>{var f,d;r(c,{location:t.location,params:((d=(f=t.matches)==null?void 0:f[0])==null?void 0:d.params)??{},unstable_pattern:xte(t.matches),errorInfo:h})}:void 0;return o.reduceRight((c,h,f)=>{let d,p=!1,v=null,g=null;t&&(d=s&&h.route.id?s[h.route.id]:void 0,v=h.route.errorElement||kte,a&&(u<0&&f===0?(d7("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,g=null):u===f&&(p=!0,g=h.route.hydrateFallbackElement||null)));let m=e.concat(o.slice(0,f+1)),x=()=>{let _;return d?_=v:p?_=g:h.route.Component?_=H.createElement(h.route.Component,null):h.route.element?_=h.route.element:_=c,H.createElement(Nte,{match:h,routeContext:{outlet:c,matches:m,isDataRoute:t!=null},children:_})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?H.createElement(f7,{location:t.location,revalidation:t.revalidation,component:v,error:d,children:x(),routeContext:{outlet:null,matches:m,isDataRoute:!0},onError:l}):x()},null)}function CP(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Fte(n){let e=H.useContext(og);return Nr(e,CP(n)),e}function Ote(n){let e=H.useContext(XS);return Nr(e,CP(n)),e}function Bte(n){let e=H.useContext(Ec);return Nr(e,CP(n)),e}function MP(n){let e=Bte(n),t=e.matches[e.matches.length-1];return Nr(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function Ute(){return MP("useRouteId")}function zte(){var r;let n=H.useContext(EP),e=Ote("useRouteError"),t=MP("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function Vte(){let{router:n}=Fte("useNavigate"),e=MP("useNavigate"),t=H.useRef(!1);return c7(()=>{t.current=!0}),H.useCallback(async(i,o={})=>{Mu(t.current,l7),t.current&&(typeof i=="number"?await n.navigate(i):await n.navigate(i,{fromRouteId:e,...o}))},[n,e])}var LO={};function d7(n,e,t){!e&&!LO[n]&&(LO[n]=!0,Mu(!1,t))}H.memo(Wte);function Wte({routes:n,future:e,state:t,onError:r}){return h7(n,void 0,t,r,e)}function hm(n){Nr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Hte({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:o=!1,unstable_useTransitions:s}){Nr(!L1(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=n.replace(/^\/*/,"/"),u=H.useMemo(()=>({basename:a,navigator:i,static:o,unstable_useTransitions:s,future:{}}),[a,i,o,s]);typeof t=="string"&&(t=ig(t));let{pathname:l="/",search:c="",hash:h="",state:f=null,key:d="default"}=t,p=H.useMemo(()=>{let v=pc(l,a);return v==null?null:{location:{pathname:v,search:c,hash:h,state:f,key:d},navigationType:r}},[a,l,c,h,f,d,r]);return Mu(p!=null,`<Router basename="${a}"> is not able to match the URL "${l}${c}${h}" because it does not start with the basename, so the <Router> won't render anything.`),p==null?null:H.createElement(Za.Provider,{value:u},H.createElement(N1.Provider,{children:e,value:p}))}function Gte({children:n,location:e}){return Ite(JR(n),e)}function JR(n,e=[]){let t=[];return H.Children.forEach(n,(r,i)=>{if(!H.isValidElement(r))return;let o=[...e,i];if(r.type===H.Fragment){t.push.apply(t,JR(r.props.children,o));return}Nr(r.type===hm,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Nr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let s={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(s.children=JR(r.props.children,o)),t.push(s)}),t}var C_="get",M_="application/x-www-form-urlencoded";function YS(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function $te(n){return YS(n)&&n.tagName.toLowerCase()==="button"}function jte(n){return YS(n)&&n.tagName.toLowerCase()==="form"}function Xte(n){return YS(n)&&n.tagName.toLowerCase()==="input"}function qte(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Yte(n,e){return n.button===0&&(!e||e==="_self")&&!qte(n)}var k2=null;function Kte(){if(k2===null)try{new FormData(document.createElement("form"),0),k2=!1}catch{k2=!0}return k2}var Zte=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function L3(n){return n!=null&&!Zte.has(n)?(Mu(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${M_}"`),null):n}function Qte(n,e){let t,r,i,o,s;if(jte(n)){let a=n.getAttribute("action");r=a?pc(a,e):null,t=n.getAttribute("method")||C_,i=L3(n.getAttribute("enctype"))||M_,o=new FormData(n)}else if($te(n)||Xte(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let u=n.getAttribute("formaction")||a.getAttribute("action");if(r=u?pc(u,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||C_,i=L3(n.getAttribute("formenctype"))||L3(a.getAttribute("enctype"))||M_,o=new FormData(a,n),!Kte()){let{name:l,type:c,value:h}=n;if(c==="image"){let f=l?`${l}.`:"";o.append(`${f}x`,"0"),o.append(`${f}y`,"0")}else l&&o.append(l,h)}}else{if(YS(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=C_,r=null,i=M_,s=n}return o&&i==="text/plain"&&(s=o,o=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:o,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function TP(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Jte(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&pc(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function ene(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tne(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function nne(n,e,t){let r=await Promise.all(n.map(async i=>{let o=e.routes[i.route.id];if(o){let s=await ene(o,t);return s.links?s.links():[]}return[]}));return sne(r.flat(1).filter(tne).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function FO(n,e,t,r,i,o){let s=(u,l)=>t[l]?u.route.id!==t[l].route.id:!0,a=(u,l)=>{var c;return t[l].pathname!==u.pathname||((c=t[l].route.path)==null?void 0:c.endsWith("*"))&&t[l].params["*"]!==u.params["*"]};return o==="assets"?e.filter((u,l)=>s(u,l)||a(u,l)):o==="data"?e.filter((u,l)=>{var h;let c=r.routes[u.route.id];if(!c||!c.hasLoader)return!1;if(s(u,l)||a(u,l))return!0;if(u.route.shouldRevalidate){let f=u.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((h=t[0])==null?void 0:h.params)||{},nextUrl:new URL(n,window.origin),nextParams:u.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function rne(n,e,{includeHydrateFallback:t}={}){return ine(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function ine(n){return[...new Set(n)]}function one(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function sne(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let o=JSON.stringify(one(i));return t.has(o)||(t.add(o),r.push({key:o,link:i})),r},[])}function p7(){let n=H.useContext(og);return TP(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function ane(){let n=H.useContext(XS);return TP(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var RP=H.createContext(void 0);RP.displayName="FrameworkContext";function m7(){let n=H.useContext(RP);return TP(n,"You must render this element inside a <HydratedRouter> element"),n}function une(n,e){let t=H.useContext(RP),[r,i]=H.useState(!1),[o,s]=H.useState(!1),{onFocus:a,onBlur:u,onMouseEnter:l,onMouseLeave:c,onTouchStart:h}=e,f=H.useRef(null);H.useEffect(()=>{if(n==="render"&&s(!0),n==="viewport"){let v=m=>{m.forEach(x=>{s(x.isIntersecting)})},g=new IntersectionObserver(v,{threshold:.5});return f.current&&g.observe(f.current),()=>{g.disconnect()}}},[n]),H.useEffect(()=>{if(r){let v=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(v)}}},[r]);let d=()=>{i(!0)},p=()=>{i(!1),s(!1)};return t?n!=="intent"?[o,f,{}]:[o,f,{onFocus:qg(a,d),onBlur:qg(u,p),onMouseEnter:qg(l,d),onMouseLeave:qg(c,p),onTouchStart:qg(h,d)}]:[!1,f,{}]}function qg(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function lne({page:n,...e}){let{router:t}=p7(),r=H.useMemo(()=>QW(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?H.createElement(hne,{page:n,matches:r,...e}):null}function cne(n){let{manifest:e,routeModules:t}=m7(),[r,i]=H.useState([]);return H.useEffect(()=>{let o=!1;return nne(n,e,t).then(s=>{o||i(s)}),()=>{o=!0}},[n,e,t]),r}function hne({page:n,matches:e,...t}){let r=Ru(),{manifest:i,routeModules:o}=m7(),{basename:s}=p7(),{loaderData:a,matches:u}=ane(),l=H.useMemo(()=>FO(n,e,u,i,r,"data"),[n,e,u,i,r]),c=H.useMemo(()=>FO(n,e,u,i,r,"assets"),[n,e,u,i,r]),h=H.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let p=new Set,v=!1;if(e.forEach(m=>{var _;let x=i.routes[m.route.id];!x||!x.hasLoader||(!l.some(b=>b.route.id===m.route.id)&&m.route.id in a&&((_=o[m.route.id])!=null&&_.shouldRevalidate)||x.hasClientLoader?v=!0:p.add(m.route.id))}),p.size===0)return[];let g=Jte(n,s,"data");return v&&p.size>0&&g.searchParams.set("_routes",e.filter(m=>p.has(m.route.id)).map(m=>m.route.id).join(",")),[g.pathname+g.search]},[s,a,r,i,l,e,n,o]),f=H.useMemo(()=>rne(c,i),[c,i]),d=cne(c);return H.createElement(H.Fragment,null,h.map(p=>H.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...t})),f.map(p=>H.createElement("link",{key:p,rel:"modulepreload",href:p,...t})),d.map(({key:p,link:v})=>H.createElement("link",{key:p,nonce:t.nonce,...v})))}function fne(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var dne=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dne&&(window.__reactRouterVersion="7.11.0")}catch{}function pne({basename:n,children:e,unstable_useTransitions:t,window:r}){let i=H.useRef();i.current==null&&(i.current=qee({window:r,v5Compat:!0}));let o=i.current,[s,a]=H.useState({action:o.action,location:o.location}),u=H.useCallback(l=>{t===!1?a(l):H.startTransition(()=>a(l))},[t]);return H.useLayoutEffect(()=>o.listen(u),[o,u]),H.createElement(Hte,{basename:n,children:e,location:s.location,navigationType:s.action,navigator:o,unstable_useTransitions:t})}var v7=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,g7=H.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:o,replace:s,state:a,target:u,to:l,preventScrollReset:c,viewTransition:h,unstable_defaultShouldRevalidate:f,...d},p){let{basename:v,unstable_useTransitions:g}=H.useContext(Za),m=typeof l=="string"&&v7.test(l),x=o7(l,v);l=x.to;let _=Rte(l,{relative:i}),[b,S,E]=une(r,d),C=yne(l,{replace:s,state:a,target:u,preventScrollReset:c,relative:i,viewTransition:h,unstable_defaultShouldRevalidate:f,unstable_useTransitions:g});function R(A){e&&e(A),A.defaultPrevented||C(A)}let T=H.createElement("a",{...d,...E,href:x.absoluteURL||_,onClick:x.isExternal||o?e:R,ref:fne(p,S),target:u,"data-discover":!m&&t==="render"?"true":void 0});return b&&!m?H.createElement(H.Fragment,null,T,H.createElement(lne,{page:_})):T});g7.displayName="Link";var mne=H.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:o,to:s,viewTransition:a,children:u,...l},c){let h=F1(s,{relative:l.relative}),f=Ru(),d=H.useContext(XS),{navigator:p,basename:v}=H.useContext(Za),g=d!=null&&Sne(h)&&a===!0,m=p.encodeLocation?p.encodeLocation(h).pathname:h.pathname,x=f.pathname,_=d&&d.navigation&&d.navigation.location?d.navigation.location.pathname:null;t||(x=x.toLowerCase(),_=_?_.toLowerCase():null,m=m.toLowerCase()),_&&v&&(_=pc(_,v)||_);const b=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let S=x===m||!i&&x.startsWith(m)&&x.charAt(b)==="/",E=_!=null&&(_===m||!i&&_.startsWith(m)&&_.charAt(m.length)==="/"),C={isActive:S,isPending:E,isTransitioning:g},R=S?e:void 0,T;typeof r=="function"?T=r(C):T=[r,S?"active":null,E?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let A=typeof o=="function"?o(C):o;return H.createElement(g7,{...l,"aria-current":R,className:T,ref:c,style:A,to:s,viewTransition:a},typeof u=="function"?u(C):u)});mne.displayName="NavLink";var vne=H.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:o,method:s=C_,action:a,onSubmit:u,relative:l,preventScrollReset:c,viewTransition:h,unstable_defaultShouldRevalidate:f,...d},p)=>{let{unstable_useTransitions:v}=H.useContext(Za),g=_ne(),m=bne(a,{relative:l}),x=s.toLowerCase()==="get"?"get":"post",_=typeof a=="string"&&v7.test(a),b=S=>{if(u&&u(S),S.defaultPrevented)return;S.preventDefault();let E=S.nativeEvent.submitter,C=(E==null?void 0:E.getAttribute("formmethod"))||s,R=()=>g(E||S.currentTarget,{fetcherKey:e,method:C,navigate:t,replace:i,state:o,relative:l,preventScrollReset:c,viewTransition:h,unstable_defaultShouldRevalidate:f});v&&t!==!1?H.startTransition(()=>R()):R()};return H.createElement("form",{ref:p,method:x,action:m,onSubmit:r?u:b,...d,"data-discover":!_&&n==="render"?"true":void 0})});vne.displayName="Form";function gne(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function y7(n){let e=H.useContext(og);return Nr(e,gne(n)),e}function yne(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:o,viewTransition:s,unstable_defaultShouldRevalidate:a,unstable_useTransitions:u}={}){let l=qS(),c=Ru(),h=F1(n,{relative:o});return H.useCallback(f=>{if(Yte(f,e)){f.preventDefault();let d=t!==void 0?t:Fy(c)===Fy(h),p=()=>l(n,{replace:d,state:r,preventScrollReset:i,relative:o,viewTransition:s,unstable_defaultShouldRevalidate:a});u?H.startTransition(()=>p()):p()}},[c,l,h,t,r,e,n,i,o,s,a,u])}var xne=0,wne=()=>`__${String(++xne)}__`;function _ne(){let{router:n}=y7("useSubmit"),{basename:e}=H.useContext(Za),t=Ute(),r=n.fetch,i=n.navigate;return H.useCallback(async(o,s={})=>{let{action:a,method:u,encType:l,formData:c,body:h}=Qte(o,e);if(s.navigate===!1){let f=s.fetcherKey||wne();await r(f,t,s.action||a,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:c,body:h,formMethod:s.method||u,formEncType:s.encType||l,flushSync:s.flushSync})}else await i(s.action||a,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:c,body:h,formMethod:s.method||u,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[r,i,e,t])}function bne(n,{relative:e}={}){let{basename:t}=H.useContext(Za),r=H.useContext(Ec);Nr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...F1(n||".",{relative:e})},s=Ru();if(n==null){o.search=s.search;let a=new URLSearchParams(o.search),u=a.getAll("index");if(u.some(c=>c==="")){a.delete("index"),u.filter(h=>h).forEach(h=>a.append("index",h));let c=a.toString();o.search=c?`?${c}`:""}}return(!n||n===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:oc([t,o.pathname])),Fy(o)}function Sne(n,{relative:e}={}){let t=H.useContext(a7);Nr(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=y7("useViewTransitionState"),i=F1(n,{relative:e});if(!t.isTransitioning)return!1;let o=pc(t.currentLocation.pathname,r)||t.currentLocation.pathname,s=pc(t.nextLocation.pathname,r)||t.nextLocation.pathname;return xb(i.pathname,s)!=null||xb(i.pathname,o)!=null}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const sg="160",Ene={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Cne={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},x7=0,eA=1,w7=2,Mne=3,_7=0,KS=1,G0=2,lu=3,yl=0,Mi=1,jo=2,Tne=2,Qo=0,bd=1,wb=2,tA=3,nA=4,b7=5,ch=100,S7=101,E7=102,rA=103,iA=104,C7=200,M7=201,T7=202,R7=203,_b=204,bb=205,A7=206,I7=207,P7=208,k7=209,D7=210,N7=211,L7=212,F7=213,O7=214,B7=0,AP=1,U7=2,Oy=3,z7=4,V7=5,W7=6,H7=7,O1=0,G7=1,$7=2,wu=0,j7=1,X7=2,q7=3,IP=4,Y7=5,K7=6,oA="attached",Z7="detached",ZS=300,mc=301,zh=302,By=303,Uy=304,ag=306,zy=1e3,qr=1001,Vy=1002,ti=1003,Sb=1004,Rne=1004,$0=1005,Ane=1005,Fn=1006,PP=1007,Ine=1007,Vh=1008,Pne=1008,ro=1009,Q7=1010,J7=1011,QS=1012,kP=1013,il=1014,vs=1015,Wh=1016,DP=1017,NP=1018,sc=1020,e9=1021,eo=1023,t9=1024,n9=1025,Ih=1026,Hh=1027,r9=1028,LP=1029,i9=1030,FP=1031,OP=1033,T_=33776,R_=33777,A_=33778,I_=33779,sA=35840,aA=35841,uA=35842,lA=35843,BP=36196,cA=37492,hA=37496,fA=37808,dA=37809,pA=37810,mA=37811,vA=37812,gA=37813,yA=37814,xA=37815,wA=37816,_A=37817,bA=37818,SA=37819,EA=37820,CA=37821,P_=36492,MA=36494,TA=36495,o9=36283,RA=36284,AA=36285,IA=36286,s9=2200,a9=2201,u9=2202,Wy=2300,Hy=2301,k_=2302,ad=2400,ud=2401,Gy=2402,JS=2500,UP=2501,kne=0,Dne=1,Nne=2,zP=3e3,Ph=3001,ug=3200,l9=3201,of=0,c9=1,Xo="",Rn="srgb",$a="srgb-linear",eE="display-p3",B1="display-p3-linear",$y="linear",ur="srgb",jy="rec709",Xy="p3",Lne=0,Gf=7680,Fne=7681,One=7682,Bne=7683,Une=34055,zne=34056,Vne=5386,Wne=512,Hne=513,Gne=514,$ne=515,jne=516,Xne=517,qne=518,PA=519,h9=512,f9=513,d9=514,VP=515,p9=516,m9=517,v9=518,g9=519,qy=35044,Yne=35048,Kne=35040,Zne=35045,Qne=35049,Jne=35041,ere=35046,tre=35050,nre=35042,rre="100",kA="300 es",Eb=1035,mu=2e3,Nv=2001;class Qa{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e);e.target=null}}}const mo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let OO=1234567;const Sd=Math.PI/180,Lv=180/Math.PI;function aa(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(mo[n&255]+mo[n>>8&255]+mo[n>>16&255]+mo[n>>24&255]+"-"+mo[e&255]+mo[e>>8&255]+"-"+mo[e>>16&15|64]+mo[e>>24&255]+"-"+mo[t&63|128]+mo[t>>8&255]+"-"+mo[t>>16&255]+mo[t>>24&255]+mo[r&255]+mo[r>>8&255]+mo[r>>16&255]+mo[r>>24&255]).toLowerCase()}function Xr(n,e,t){return Math.max(e,Math.min(t,n))}function WP(n,e){return(n%e+e)%e}function ire(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function ore(n,e,t){return n!==e?(t-n)/(e-n):0}function j0(n,e,t){return(1-t)*n+t*e}function sre(n,e,t,r){return j0(n,e,1-Math.exp(-t*r))}function are(n,e=1){return e-Math.abs(WP(n,e*2)-e)}function ure(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function lre(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function cre(n,e){return n+Math.floor(Math.random()*(e-n+1))}function hre(n,e){return n+Math.random()*(e-n)}function fre(n){return n*(.5-Math.random())}function dre(n){n!==void 0&&(OO=n);let e=OO+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function pre(n){return n*Sd}function mre(n){return n*Lv}function DA(n){return(n&n-1)===0&&n!==0}function vre(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Cb(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function gre(n,e,t,r,i){const o=Math.cos,s=Math.sin,a=o(t/2),u=s(t/2),l=o((e+r)/2),c=s((e+r)/2),h=o((e-r)/2),f=s((e-r)/2),d=o((r-e)/2),p=s((r-e)/2);switch(i){case"XYX":n.set(a*c,u*h,u*f,a*l);break;case"YZY":n.set(u*f,a*c,u*h,a*l);break;case"ZXZ":n.set(u*h,u*f,a*c,a*l);break;case"XZX":n.set(a*c,u*p,u*d,a*l);break;case"YXY":n.set(u*d,a*c,u*p,a*l);break;case"ZYZ":n.set(u*p,u*d,a*c,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function hs(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function cn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const zs={DEG2RAD:Sd,RAD2DEG:Lv,generateUUID:aa,clamp:Xr,euclideanModulo:WP,mapLinear:ire,inverseLerp:ore,lerp:j0,damp:sre,pingpong:are,smoothstep:ure,smootherstep:lre,randInt:cre,randFloat:hre,randFloatSpread:fre,seededRandom:dre,degToRad:pre,radToDeg:mre,isPowerOfTwo:DA,ceilPowerOfTwo:vre,floorPowerOfTwo:Cb,setQuaternionFromProperEuler:gre,normalize:cn,denormalize:hs};class De{constructor(e=0,t=0){De.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Xr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*r-s*i+e.x,this.y=o*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class pn{constructor(e,t,r,i,o,s,a,u,l){pn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,u,l)}set(e,t,r,i,o,s,a,u,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=a,c[3]=t,c[4]=o,c[5]=u,c[6]=r,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[3],u=r[6],l=r[1],c=r[4],h=r[7],f=r[2],d=r[5],p=r[8],v=i[0],g=i[3],m=i[6],x=i[1],_=i[4],b=i[7],S=i[2],E=i[5],C=i[8];return o[0]=s*v+a*x+u*S,o[3]=s*g+a*_+u*E,o[6]=s*m+a*b+u*C,o[1]=l*v+c*x+h*S,o[4]=l*g+c*_+h*E,o[7]=l*m+c*b+h*C,o[2]=f*v+d*x+p*S,o[5]=f*g+d*_+p*E,o[8]=f*m+d*b+p*C,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8];return t*s*c-t*a*l-r*o*c+r*a*u+i*o*l-i*s*u}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=c*s-a*l,f=a*u-c*o,d=l*o-s*u,p=t*h+r*f+i*d;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const v=1/p;return e[0]=h*v,e[1]=(i*l-c*r)*v,e[2]=(a*r-i*s)*v,e[3]=f*v,e[4]=(c*t-i*u)*v,e[5]=(i*o-a*t)*v,e[6]=d*v,e[7]=(r*u-l*t)*v,e[8]=(s*t-r*o)*v,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,s,a){const u=Math.cos(o),l=Math.sin(o);return this.set(r*u,r*l,-r*(u*s+l*a)+s+e,-i*l,i*u,-i*(-l*s+u*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(F3.makeScale(e,t)),this}rotate(e){return this.premultiply(F3.makeRotation(-e)),this}translate(e,t){return this.premultiply(F3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const F3=new pn;function y9(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const yre={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Om(n,e){return new yre[n](e)}function Yy(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function x9(){const n=Yy("canvas");return n.style.display="block",n}const BO={};function X0(n){n in BO||(BO[n]=!0,console.warn(n))}const UO=new pn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),zO=new pn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),D2={[$a]:{transfer:$y,primaries:jy,toReference:n=>n,fromReference:n=>n},[Rn]:{transfer:ur,primaries:jy,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[B1]:{transfer:$y,primaries:Xy,toReference:n=>n.applyMatrix3(zO),fromReference:n=>n.applyMatrix3(UO)},[eE]:{transfer:ur,primaries:Xy,toReference:n=>n.convertSRGBToLinear().applyMatrix3(zO),fromReference:n=>n.applyMatrix3(UO).convertLinearToSRGB()}},xre=new Set([$a,B1]),Jn={enabled:!0,_workingColorSpace:$a,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!xre.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=D2[e].toReference,i=D2[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return D2[n].primaries},getTransfer:function(n){return n===Xo?$y:D2[n].transfer}};function ov(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function O3(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let kp;class HP{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{kp===void 0&&(kp=Yy("canvas")),kp.width=e.width,kp.height=e.height;const r=kp.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=kp}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Yy("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let s=0;s<o.length;s++)o[s]=ov(o[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(ov(t[r]/255)*255):t[r]=ov(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let wre=0;class ld{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:wre++}),this.uuid=aa(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?o.push(B3(i[s].image)):o.push(B3(i[s]))}else o=B3(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function B3(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?HP.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _re=0;class Lr extends Qa{constructor(e=Lr.DEFAULT_IMAGE,t=Lr.DEFAULT_MAPPING,r=qr,i=qr,o=Fn,s=Vh,a=eo,u=ro,l=Lr.DEFAULT_ANISOTROPY,c=Xo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_re++}),this.uuid=aa(),this.name="",this.source=new ld(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=u,this.offset=new De(0,0),this.repeat=new De(1,1),this.center=new De(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new pn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof c=="string"?this.colorSpace=c:(X0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=c===Ph?Rn:Xo),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==ZS)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zy:e.x=e.x-Math.floor(e.x);break;case qr:e.x=e.x<0?0:1;break;case Vy:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zy:e.y=e.y-Math.floor(e.y);break;case qr:e.y=e.y<0?0:1;break;case Vy:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return X0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Rn?Ph:zP}set encoding(e){X0("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===Ph?Rn:Xo}}Lr.DEFAULT_IMAGE=null;Lr.DEFAULT_MAPPING=ZS;Lr.DEFAULT_ANISOTROPY=1;class On{constructor(e=0,t=0,r=0,i=1){On.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*o,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*o,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*o,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const u=e.elements,l=u[0],c=u[4],h=u[8],f=u[1],d=u[5],p=u[9],v=u[2],g=u[6],m=u[10];if(Math.abs(c-f)<.01&&Math.abs(h-v)<.01&&Math.abs(p-g)<.01){if(Math.abs(c+f)<.1&&Math.abs(h+v)<.1&&Math.abs(p+g)<.1&&Math.abs(l+d+m-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(l+1)/2,b=(d+1)/2,S=(m+1)/2,E=(c+f)/4,C=(h+v)/4,R=(p+g)/4;return _>b&&_>S?_<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(_),i=E/r,o=C/r):b>S?b<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(b),r=E/i,o=R/i):S<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(S),r=C/o,i=R/o),this.set(r,i,o,t),this}let x=Math.sqrt((g-p)*(g-p)+(h-v)*(h-v)+(f-c)*(f-c));return Math.abs(x)<.001&&(x=1),this.x=(g-p)/x,this.y=(h-v)/x,this.z=(f-c)/x,this.w=Math.acos((l+d+m-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class w9 extends Qa{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new On(0,0,e,t),this.scissorTest=!1,this.viewport=new On(0,0,e,t);const i={width:e,height:t,depth:1};r.encoding!==void 0&&(X0("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===Ph?Rn:Xo),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Fn,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new Lr(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ld(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class oi extends w9{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class tE extends Lr{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ti,this.minFilter=ti,this.wrapR=qr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bre extends oi{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new tE(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class GP extends Lr{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=ti,this.minFilter=ti,this.wrapR=qr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Sre extends oi{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new GP(null,e,t,r),this.texture.isRenderTargetTexture=!0}}class Ere extends oi{constructor(e=1,t=1,r=1,i={}){super(e,t,i),this.isWebGLMultipleRenderTargets=!0;const o=this.texture;this.texture=[];for(let s=0;s<r;s++)this.texture[s]=o.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,o=this.texture.length;i<o;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class bs{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,s,a){let u=r[i+0],l=r[i+1],c=r[i+2],h=r[i+3];const f=o[s+0],d=o[s+1],p=o[s+2],v=o[s+3];if(a===0){e[t+0]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(a===1){e[t+0]=f,e[t+1]=d,e[t+2]=p,e[t+3]=v;return}if(h!==v||u!==f||l!==d||c!==p){let g=1-a;const m=u*f+l*d+c*p+h*v,x=m>=0?1:-1,_=1-m*m;if(_>Number.EPSILON){const S=Math.sqrt(_),E=Math.atan2(S,m*x);g=Math.sin(g*E)/S,a=Math.sin(a*E)/S}const b=a*x;if(u=u*g+f*b,l=l*g+d*b,c=c*g+p*b,h=h*g+v*b,g===1-a){const S=1/Math.sqrt(u*u+l*l+c*c+h*h);u*=S,l*=S,c*=S,h*=S}}e[t]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,o,s){const a=r[i],u=r[i+1],l=r[i+2],c=r[i+3],h=o[s],f=o[s+1],d=o[s+2],p=o[s+3];return e[t]=a*p+c*h+u*d-l*f,e[t+1]=u*p+c*f+l*h-a*d,e[t+2]=l*p+c*d+a*f-u*h,e[t+3]=c*p-a*h-u*f-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,s=e._order,a=Math.cos,u=Math.sin,l=a(r/2),c=a(i/2),h=a(o/2),f=u(r/2),d=u(i/2),p=u(o/2);switch(s){case"XYZ":this._x=f*c*h+l*d*p,this._y=l*d*h-f*c*p,this._z=l*c*p+f*d*h,this._w=l*c*h-f*d*p;break;case"YXZ":this._x=f*c*h+l*d*p,this._y=l*d*h-f*c*p,this._z=l*c*p-f*d*h,this._w=l*c*h+f*d*p;break;case"ZXY":this._x=f*c*h-l*d*p,this._y=l*d*h+f*c*p,this._z=l*c*p+f*d*h,this._w=l*c*h-f*d*p;break;case"ZYX":this._x=f*c*h-l*d*p,this._y=l*d*h+f*c*p,this._z=l*c*p-f*d*h,this._w=l*c*h+f*d*p;break;case"YZX":this._x=f*c*h+l*d*p,this._y=l*d*h+f*c*p,this._z=l*c*p-f*d*h,this._w=l*c*h-f*d*p;break;case"XZY":this._x=f*c*h-l*d*p,this._y=l*d*h-f*c*p,this._z=l*c*p+f*d*h,this._w=l*c*h+f*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],s=t[1],a=t[5],u=t[9],l=t[2],c=t[6],h=t[10],f=r+a+h;if(f>0){const d=.5/Math.sqrt(f+1);this._w=.25/d,this._x=(c-u)*d,this._y=(o-l)*d,this._z=(s-i)*d}else if(r>a&&r>h){const d=2*Math.sqrt(1+r-a-h);this._w=(c-u)/d,this._x=.25*d,this._y=(i+s)/d,this._z=(o+l)/d}else if(a>h){const d=2*Math.sqrt(1+a-r-h);this._w=(o-l)/d,this._x=(i+s)/d,this._y=.25*d,this._z=(u+c)/d}else{const d=2*Math.sqrt(1+h-r-a);this._w=(s-i)/d,this._x=(o+l)/d,this._y=(u+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Xr(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,s=e._w,a=t._x,u=t._y,l=t._z,c=t._w;return this._x=r*c+s*a+i*l-o*u,this._y=i*c+s*u+o*a-r*l,this._z=o*c+s*l+r*u-i*a,this._w=s*c-r*a-i*u-o*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,s=this._w;let a=s*e._w+r*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=i,this._z=o,this;const u=1-a*a;if(u<=Number.EPSILON){const d=1-t;return this._w=d*s+t*this._w,this._x=d*r+t*this._x,this._y=d*i+t*this._y,this._z=d*o+t*this._z,this.normalize(),this}const l=Math.sqrt(u),c=Math.atan2(l,a),h=Math.sin((1-t)*c)/l,f=Math.sin(t*c)/l;return this._w=s*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=o*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(o),r*Math.cos(o),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ne{constructor(e=0,t=0,r=0){ne.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(VO.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(VO.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,s=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*s,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*s,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,s=e.y,a=e.z,u=e.w,l=2*(s*i-a*r),c=2*(a*t-o*i),h=2*(o*r-s*t);return this.x=t+u*l+s*h-a*c,this.y=r+u*c+a*l-o*h,this.z=i+u*h+o*c-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,s=t.x,a=t.y,u=t.z;return this.x=i*u-o*a,this.y=o*s-r*u,this.z=r*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return U3.copy(this).projectOnVector(e),this.sub(U3)}reflect(e){return this.sub(U3.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Xr(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const U3=new ne,VO=new bs;class Jo{constructor(e=new ne(1/0,1/0,1/0),t=new ne(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(nu.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(nu.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=nu.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let s=0,a=o.count;s<a;s++)e.isMesh===!0?e.getVertexPosition(s,nu):nu.fromBufferAttribute(o,s),nu.applyMatrix4(e.matrixWorld),this.expandByPoint(nu);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),N2.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),N2.copy(r.boundingBox)),N2.applyMatrix4(e.matrixWorld),this.union(N2)}const i=e.children;for(let o=0,s=i.length;o<s;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,nu),nu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Yg),L2.subVectors(this.max,Yg),Dp.subVectors(e.a,Yg),Np.subVectors(e.b,Yg),Lp.subVectors(e.c,Yg),Gc.subVectors(Np,Dp),$c.subVectors(Lp,Np),Tf.subVectors(Dp,Lp);let t=[0,-Gc.z,Gc.y,0,-$c.z,$c.y,0,-Tf.z,Tf.y,Gc.z,0,-Gc.x,$c.z,0,-$c.x,Tf.z,0,-Tf.x,-Gc.y,Gc.x,0,-$c.y,$c.x,0,-Tf.y,Tf.x,0];return!z3(t,Dp,Np,Lp,L2)||(t=[1,0,0,0,1,0,0,0,1],!z3(t,Dp,Np,Lp,L2))?!1:(F2.crossVectors(Gc,$c),t=[F2.x,F2.y,F2.z],z3(t,Dp,Np,Lp,L2))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,nu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(nu).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ll[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ll[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ll[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ll[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ll[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ll[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ll[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ll[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ll),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ll=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne],nu=new ne,N2=new Jo,Dp=new ne,Np=new ne,Lp=new ne,Gc=new ne,$c=new ne,Tf=new ne,Yg=new ne,L2=new ne,F2=new ne,Rf=new ne;function z3(n,e,t,r,i){for(let o=0,s=n.length-3;o<=s;o+=3){Rf.fromArray(n,o);const a=i.x*Math.abs(Rf.x)+i.y*Math.abs(Rf.y)+i.z*Math.abs(Rf.z),u=e.dot(Rf),l=t.dot(Rf),c=r.dot(Rf);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>a)return!1}return!0}const Cre=new Jo,Kg=new ne,V3=new ne;class Ao{constructor(e=new ne,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):Cre.setFromPoints(e).getCenter(r);let i=0;for(let o=0,s=e.length;o<s;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Kg.subVectors(e,this.center);const t=Kg.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(Kg,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(V3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Kg.copy(e.center).add(V3)),this.expandByPoint(Kg.copy(e.center).sub(V3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Fl=new ne,W3=new ne,O2=new ne,jc=new ne,H3=new ne,B2=new ne,G3=new ne;class lg{constructor(e=new ne,t=new ne(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Fl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Fl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Fl.copy(this.origin).addScaledVector(this.direction,t),Fl.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){W3.copy(e).add(t).multiplyScalar(.5),O2.copy(t).sub(e).normalize(),jc.copy(this.origin).sub(W3);const o=e.distanceTo(t)*.5,s=-this.direction.dot(O2),a=jc.dot(this.direction),u=-jc.dot(O2),l=jc.lengthSq(),c=Math.abs(1-s*s);let h,f,d,p;if(c>0)if(h=s*u-a,f=s*a-u,p=o*c,h>=0)if(f>=-p)if(f<=p){const v=1/c;h*=v,f*=v,d=h*(h+s*f+2*a)+f*(s*h+f+2*u)+l}else f=o,h=Math.max(0,-(s*f+a)),d=-h*h+f*(f+2*u)+l;else f=-o,h=Math.max(0,-(s*f+a)),d=-h*h+f*(f+2*u)+l;else f<=-p?(h=Math.max(0,-(-s*o+a)),f=h>0?-o:Math.min(Math.max(-o,-u),o),d=-h*h+f*(f+2*u)+l):f<=p?(h=0,f=Math.min(Math.max(-o,-u),o),d=f*(f+2*u)+l):(h=Math.max(0,-(s*o+a)),f=h>0?o:Math.min(Math.max(-o,-u),o),d=-h*h+f*(f+2*u)+l);else f=s>0?-o:o,h=Math.max(0,-(s*f+a)),d=-h*h+f*(f+2*u)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(W3).addScaledVector(O2,f),d}intersectSphere(e,t){Fl.subVectors(e.center,this.origin);const r=Fl.dot(this.direction),i=Fl.dot(Fl)-r*r,o=e.radius*e.radius;if(i>o)return null;const s=Math.sqrt(o-i),a=r-s,u=r+s;return u<0?null:a<0?this.at(u,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,s,a,u;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(r=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(r=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),c>=0?(o=(e.min.y-f.y)*c,s=(e.max.y-f.y)*c):(o=(e.max.y-f.y)*c,s=(e.min.y-f.y)*c),r>s||o>i||((o>r||isNaN(r))&&(r=o),(s<i||isNaN(i))&&(i=s),h>=0?(a=(e.min.z-f.z)*h,u=(e.max.z-f.z)*h):(a=(e.max.z-f.z)*h,u=(e.min.z-f.z)*h),r>u||a>i)||((a>r||r!==r)&&(r=a),(u<i||i!==i)&&(i=u),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Fl)!==null}intersectTriangle(e,t,r,i,o){H3.subVectors(t,e),B2.subVectors(r,e),G3.crossVectors(H3,B2);let s=this.direction.dot(G3),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;jc.subVectors(this.origin,e);const u=a*this.direction.dot(B2.crossVectors(jc,B2));if(u<0)return null;const l=a*this.direction.dot(H3.cross(jc));if(l<0||u+l>s)return null;const c=-a*jc.dot(G3);return c<0?null:this.at(c/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class tn{constructor(e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g){tn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g)}set(e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g){const m=this.elements;return m[0]=e,m[4]=t,m[8]=r,m[12]=i,m[1]=o,m[5]=s,m[9]=a,m[13]=u,m[2]=l,m[6]=c,m[10]=h,m[14]=f,m[3]=d,m[7]=p,m[11]=v,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new tn().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Fp.setFromMatrixColumn(e,0).length(),o=1/Fp.setFromMatrixColumn(e,1).length(),s=1/Fp.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,s=Math.cos(r),a=Math.sin(r),u=Math.cos(i),l=Math.sin(i),c=Math.cos(o),h=Math.sin(o);if(e.order==="XYZ"){const f=s*c,d=s*h,p=a*c,v=a*h;t[0]=u*c,t[4]=-u*h,t[8]=l,t[1]=d+p*l,t[5]=f-v*l,t[9]=-a*u,t[2]=v-f*l,t[6]=p+d*l,t[10]=s*u}else if(e.order==="YXZ"){const f=u*c,d=u*h,p=l*c,v=l*h;t[0]=f+v*a,t[4]=p*a-d,t[8]=s*l,t[1]=s*h,t[5]=s*c,t[9]=-a,t[2]=d*a-p,t[6]=v+f*a,t[10]=s*u}else if(e.order==="ZXY"){const f=u*c,d=u*h,p=l*c,v=l*h;t[0]=f-v*a,t[4]=-s*h,t[8]=p+d*a,t[1]=d+p*a,t[5]=s*c,t[9]=v-f*a,t[2]=-s*l,t[6]=a,t[10]=s*u}else if(e.order==="ZYX"){const f=s*c,d=s*h,p=a*c,v=a*h;t[0]=u*c,t[4]=p*l-d,t[8]=f*l+v,t[1]=u*h,t[5]=v*l+f,t[9]=d*l-p,t[2]=-l,t[6]=a*u,t[10]=s*u}else if(e.order==="YZX"){const f=s*u,d=s*l,p=a*u,v=a*l;t[0]=u*c,t[4]=v-f*h,t[8]=p*h+d,t[1]=h,t[5]=s*c,t[9]=-a*c,t[2]=-l*c,t[6]=d*h+p,t[10]=f-v*h}else if(e.order==="XZY"){const f=s*u,d=s*l,p=a*u,v=a*l;t[0]=u*c,t[4]=-h,t[8]=l*c,t[1]=f*h+v,t[5]=s*c,t[9]=d*h-p,t[2]=p*h-d,t[6]=a*c,t[10]=v*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Mre,e,Tre)}lookAt(e,t,r){const i=this.elements;return Bs.subVectors(e,t),Bs.lengthSq()===0&&(Bs.z=1),Bs.normalize(),Xc.crossVectors(r,Bs),Xc.lengthSq()===0&&(Math.abs(r.z)===1?Bs.x+=1e-4:Bs.z+=1e-4,Bs.normalize(),Xc.crossVectors(r,Bs)),Xc.normalize(),U2.crossVectors(Bs,Xc),i[0]=Xc.x,i[4]=U2.x,i[8]=Bs.x,i[1]=Xc.y,i[5]=U2.y,i[9]=Bs.y,i[2]=Xc.z,i[6]=U2.z,i[10]=Bs.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[4],u=r[8],l=r[12],c=r[1],h=r[5],f=r[9],d=r[13],p=r[2],v=r[6],g=r[10],m=r[14],x=r[3],_=r[7],b=r[11],S=r[15],E=i[0],C=i[4],R=i[8],T=i[12],A=i[1],P=i[5],k=i[9],W=i[13],N=i[2],O=i[6],z=i[10],V=i[14],F=i[3],U=i[7],L=i[11],j=i[15];return o[0]=s*E+a*A+u*N+l*F,o[4]=s*C+a*P+u*O+l*U,o[8]=s*R+a*k+u*z+l*L,o[12]=s*T+a*W+u*V+l*j,o[1]=c*E+h*A+f*N+d*F,o[5]=c*C+h*P+f*O+d*U,o[9]=c*R+h*k+f*z+d*L,o[13]=c*T+h*W+f*V+d*j,o[2]=p*E+v*A+g*N+m*F,o[6]=p*C+v*P+g*O+m*U,o[10]=p*R+v*k+g*z+m*L,o[14]=p*T+v*W+g*V+m*j,o[3]=x*E+_*A+b*N+S*F,o[7]=x*C+_*P+b*O+S*U,o[11]=x*R+_*k+b*z+S*L,o[15]=x*T+_*W+b*V+S*j,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],s=e[1],a=e[5],u=e[9],l=e[13],c=e[2],h=e[6],f=e[10],d=e[14],p=e[3],v=e[7],g=e[11],m=e[15];return p*(+o*u*h-i*l*h-o*a*f+r*l*f+i*a*d-r*u*d)+v*(+t*u*d-t*l*f+o*s*f-i*s*d+i*l*c-o*u*c)+g*(+t*l*h-t*a*d-o*s*h+r*s*d+o*a*c-r*l*c)+m*(-i*a*c-t*u*h+t*a*f+i*s*h-r*s*f+r*u*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],x=h*g*l-v*f*l+v*u*d-a*g*d-h*u*m+a*f*m,_=p*f*l-c*g*l-p*u*d+s*g*d+c*u*m-s*f*m,b=c*v*l-p*h*l+p*a*d-s*v*d-c*a*m+s*h*m,S=p*h*u-c*v*u-p*a*f+s*v*f+c*a*g-s*h*g,E=t*x+r*_+i*b+o*S;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/E;return e[0]=x*C,e[1]=(v*f*o-h*g*o-v*i*d+r*g*d+h*i*m-r*f*m)*C,e[2]=(a*g*o-v*u*o+v*i*l-r*g*l-a*i*m+r*u*m)*C,e[3]=(h*u*o-a*f*o-h*i*l+r*f*l+a*i*d-r*u*d)*C,e[4]=_*C,e[5]=(c*g*o-p*f*o+p*i*d-t*g*d-c*i*m+t*f*m)*C,e[6]=(p*u*o-s*g*o-p*i*l+t*g*l+s*i*m-t*u*m)*C,e[7]=(s*f*o-c*u*o+c*i*l-t*f*l-s*i*d+t*u*d)*C,e[8]=b*C,e[9]=(p*h*o-c*v*o-p*r*d+t*v*d+c*r*m-t*h*m)*C,e[10]=(s*v*o-p*a*o+p*r*l-t*v*l-s*r*m+t*a*m)*C,e[11]=(c*a*o-s*h*o-c*r*l+t*h*l+s*r*d-t*a*d)*C,e[12]=S*C,e[13]=(c*v*i-p*h*i+p*r*f-t*v*f-c*r*g+t*h*g)*C,e[14]=(p*a*i-s*v*i-p*r*u+t*v*u+s*r*g-t*a*g)*C,e[15]=(s*h*i-c*a*i+c*r*u-t*h*u-s*r*f+t*a*f)*C,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,s=e.x,a=e.y,u=e.z,l=o*s,c=o*a;return this.set(l*s+r,l*a-i*u,l*u+i*a,0,l*a+i*u,c*a+r,c*u-i*s,0,l*u-i*a,c*u+i*s,o*u*u+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,s){return this.set(1,r,o,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,s=t._y,a=t._z,u=t._w,l=o+o,c=s+s,h=a+a,f=o*l,d=o*c,p=o*h,v=s*c,g=s*h,m=a*h,x=u*l,_=u*c,b=u*h,S=r.x,E=r.y,C=r.z;return i[0]=(1-(v+m))*S,i[1]=(d+b)*S,i[2]=(p-_)*S,i[3]=0,i[4]=(d-b)*E,i[5]=(1-(f+m))*E,i[6]=(g+x)*E,i[7]=0,i[8]=(p+_)*C,i[9]=(g-x)*C,i[10]=(1-(f+v))*C,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=Fp.set(i[0],i[1],i[2]).length();const s=Fp.set(i[4],i[5],i[6]).length(),a=Fp.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],ru.copy(this);const l=1/o,c=1/s,h=1/a;return ru.elements[0]*=l,ru.elements[1]*=l,ru.elements[2]*=l,ru.elements[4]*=c,ru.elements[5]*=c,ru.elements[6]*=c,ru.elements[8]*=h,ru.elements[9]*=h,ru.elements[10]*=h,t.setFromRotationMatrix(ru),r.x=o,r.y=s,r.z=a,this}makePerspective(e,t,r,i,o,s,a=mu){const u=this.elements,l=2*o/(t-e),c=2*o/(r-i),h=(t+e)/(t-e),f=(r+i)/(r-i);let d,p;if(a===mu)d=-(s+o)/(s-o),p=-2*s*o/(s-o);else if(a===Nv)d=-s/(s-o),p=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return u[0]=l,u[4]=0,u[8]=h,u[12]=0,u[1]=0,u[5]=c,u[9]=f,u[13]=0,u[2]=0,u[6]=0,u[10]=d,u[14]=p,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,r,i,o,s,a=mu){const u=this.elements,l=1/(t-e),c=1/(r-i),h=1/(s-o),f=(t+e)*l,d=(r+i)*c;let p,v;if(a===mu)p=(s+o)*h,v=-2*h;else if(a===Nv)p=o*h,v=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return u[0]=2*l,u[4]=0,u[8]=0,u[12]=-f,u[1]=0,u[5]=2*c,u[9]=0,u[13]=-d,u[2]=0,u[6]=0,u[10]=v,u[14]=-p,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Fp=new ne,ru=new tn,Mre=new ne(0,0,0),Tre=new ne(1,1,1),Xc=new ne,U2=new ne,Bs=new ne,WO=new tn,HO=new bs;let $P=class _9{constructor(e=0,t=0,r=0,i=_9.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],s=i[4],a=i[8],u=i[1],l=i[5],c=i[9],h=i[2],f=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(Xr(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Xr(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(Xr(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-Xr(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Xr(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Xr(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return WO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(WO,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return HO.setFromEuler(this),this.setFromQuaternion(HO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};$P.DEFAULT_ORDER="XYZ";class Ed{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Rre=0;const GO=new ne,Op=new bs,Ol=new tn,z2=new ne,Zg=new ne,Are=new ne,Ire=new bs,$O=new ne(1,0,0),jO=new ne(0,1,0),XO=new ne(0,0,1),Pre={type:"added"},kre={type:"removed"};class $n extends Qa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Rre++}),this.uuid=aa(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=$n.DEFAULT_UP.clone();const e=new ne,t=new $P,r=new bs,i=new ne(1,1,1);function o(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new tn},normalMatrix:{value:new pn}}),this.matrix=new tn,this.matrixWorld=new tn,this.matrixAutoUpdate=$n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=$n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Ed,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Op.setFromAxisAngle(e,t),this.quaternion.multiply(Op),this}rotateOnWorldAxis(e,t){return Op.setFromAxisAngle(e,t),this.quaternion.premultiply(Op),this}rotateX(e){return this.rotateOnAxis($O,e)}rotateY(e){return this.rotateOnAxis(jO,e)}rotateZ(e){return this.rotateOnAxis(XO,e)}translateOnAxis(e,t){return GO.copy(e).applyQuaternion(this.quaternion),this.position.add(GO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis($O,e)}translateY(e){return this.translateOnAxis(jO,e)}translateZ(e){return this.translateOnAxis(XO,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ol.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?z2.copy(e):z2.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Zg.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ol.lookAt(Zg,z2,this.up):Ol.lookAt(z2,Zg,this.up),this.quaternion.setFromRotationMatrix(Ol),i&&(Ol.extractRotation(i.matrixWorld),Op.setFromRotationMatrix(Ol),this.quaternion.premultiply(Op.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Pre)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(kre)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ol.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ol.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ol),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,s=i.length;o<s;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zg,e,Are),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Zg,Ire,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const o=t[r];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let o=0,s=i.length;o<s;o++){const a=i[o];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function o(a,u){return a[u.uuid]===void 0&&(a[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const u=a.shapes;if(Array.isArray(u))for(let l=0,c=u.length;l<c;l++){const h=u[l];o(e.shapes,h)}else o(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let u=0,l=this.material.length;u<l;u++)a.push(o(e.materials,this.material[u]));i.material=a}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const u=this.animations[a];i.animations.push(o(e.animations,u))}}if(t){const a=s(e.geometries),u=s(e.materials),l=s(e.textures),c=s(e.images),h=s(e.shapes),f=s(e.skeletons),d=s(e.animations),p=s(e.nodes);a.length>0&&(r.geometries=a),u.length>0&&(r.materials=u),l.length>0&&(r.textures=l),c.length>0&&(r.images=c),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),d.length>0&&(r.animations=d),p.length>0&&(r.nodes=p)}return r.object=i,r;function s(a){const u=[];for(const l in a){const c=a[l];delete c.metadata,u.push(c)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}$n.DEFAULT_UP=new ne(0,1,0);$n.DEFAULT_MATRIX_AUTO_UPDATE=!0;$n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const iu=new ne,Bl=new ne,$3=new ne,Ul=new ne,Bp=new ne,Up=new ne,qO=new ne,j3=new ne,X3=new ne,q3=new ne;let V2=!1,cd=class $f{constructor(e=new ne,t=new ne,r=new ne){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),iu.subVectors(e,t),i.cross(iu);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){iu.subVectors(i,t),Bl.subVectors(r,t),$3.subVectors(e,t);const s=iu.dot(iu),a=iu.dot(Bl),u=iu.dot($3),l=Bl.dot(Bl),c=Bl.dot($3),h=s*l-a*a;if(h===0)return o.set(0,0,0),null;const f=1/h,d=(l*u-a*c)*f,p=(s*c-a*u)*f;return o.set(1-d-p,p,d)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Ul)===null?!1:Ul.x>=0&&Ul.y>=0&&Ul.x+Ul.y<=1}static getUV(e,t,r,i,o,s,a,u){return V2===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),V2=!0),this.getInterpolation(e,t,r,i,o,s,a,u)}static getInterpolation(e,t,r,i,o,s,a,u){return this.getBarycoord(e,t,r,i,Ul)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(o,Ul.x),u.addScaledVector(s,Ul.y),u.addScaledVector(a,Ul.z),u)}static isFrontFacing(e,t,r,i){return iu.subVectors(r,t),Bl.subVectors(e,t),iu.cross(Bl).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return iu.subVectors(this.c,this.b),Bl.subVectors(this.a,this.b),iu.cross(Bl).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $f.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $f.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,o){return V2===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),V2=!0),$f.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}getInterpolation(e,t,r,i,o){return $f.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return $f.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $f.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let s,a;Bp.subVectors(i,r),Up.subVectors(o,r),j3.subVectors(e,r);const u=Bp.dot(j3),l=Up.dot(j3);if(u<=0&&l<=0)return t.copy(r);X3.subVectors(e,i);const c=Bp.dot(X3),h=Up.dot(X3);if(c>=0&&h<=c)return t.copy(i);const f=u*h-c*l;if(f<=0&&u>=0&&c<=0)return s=u/(u-c),t.copy(r).addScaledVector(Bp,s);q3.subVectors(e,o);const d=Bp.dot(q3),p=Up.dot(q3);if(p>=0&&d<=p)return t.copy(o);const v=d*l-u*p;if(v<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(r).addScaledVector(Up,a);const g=c*p-d*h;if(g<=0&&h-c>=0&&d-p>=0)return qO.subVectors(o,i),a=(h-c)/(h-c+(d-p)),t.copy(i).addScaledVector(qO,a);const m=1/(g+v+f);return s=v*m,a=f*m,t.copy(r).addScaledVector(Bp,s).addScaledVector(Up,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}};const b9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qc={h:0,s:0,l:0},W2={h:0,s:0,l:0};function Y3(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class ct{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Rn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Jn.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=Jn.workingColorSpace){return this.r=e,this.g=t,this.b=r,Jn.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=Jn.workingColorSpace){if(e=WP(e,1),t=Xr(t,0,1),r=Xr(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,s=2*r-o;this.r=Y3(s,o,e+1/3),this.g=Y3(s,o,e),this.b=Y3(s,o,e-1/3)}return Jn.toWorkingColorSpace(this,i),this}setStyle(e,t=Rn){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],s=o.length;if(s===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Rn){const r=b9[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ov(e.r),this.g=ov(e.g),this.b=ov(e.b),this}copyLinearToSRGB(e){return this.r=O3(e.r),this.g=O3(e.g),this.b=O3(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Rn){return Jn.fromWorkingColorSpace(vo.copy(this),e),Math.round(Xr(vo.r*255,0,255))*65536+Math.round(Xr(vo.g*255,0,255))*256+Math.round(Xr(vo.b*255,0,255))}getHexString(e=Rn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Jn.workingColorSpace){Jn.fromWorkingColorSpace(vo.copy(this),t);const r=vo.r,i=vo.g,o=vo.b,s=Math.max(r,i,o),a=Math.min(r,i,o);let u,l;const c=(a+s)/2;if(a===s)u=0,l=0;else{const h=s-a;switch(l=c<=.5?h/(s+a):h/(2-s-a),s){case r:u=(i-o)/h+(i<o?6:0);break;case i:u=(o-r)/h+2;break;case o:u=(r-i)/h+4;break}u/=6}return e.h=u,e.s=l,e.l=c,e}getRGB(e,t=Jn.workingColorSpace){return Jn.fromWorkingColorSpace(vo.copy(this),t),e.r=vo.r,e.g=vo.g,e.b=vo.b,e}getStyle(e=Rn){Jn.fromWorkingColorSpace(vo.copy(this),e);const t=vo.r,r=vo.g,i=vo.b;return e!==Rn?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(qc),this.setHSL(qc.h+e,qc.s+t,qc.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(qc),e.getHSL(W2);const r=j0(qc.h,W2.h,t),i=j0(qc.s,W2.s,t),o=j0(qc.l,W2.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const vo=new ct;ct.NAMES=b9;let Dre=0;class $i extends Qa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dre++}),this.uuid=aa(),this.name="",this.type="Material",this.blending=bd,this.side=yl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=_b,this.blendDst=bb,this.blendEquation=ch,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ct(0,0,0),this.blendAlpha=0,this.depthFunc=Oy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=PA,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gf,this.stencilZFail=Gf,this.stencilZPass=Gf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==bd&&(r.blending=this.blending),this.side!==yl&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==_b&&(r.blendSrc=this.blendSrc),this.blendDst!==bb&&(r.blendDst=this.blendDst),this.blendEquation!==ch&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Oy&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==PA&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gf&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Gf&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Gf&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const s=[];for(const a in o){const u=o[a];delete u.metadata,s.push(u)}return s}if(t){const o=i(e.textures),s=i(e.images);o.length>0&&(r.textures=o),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class sf extends $i{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ql=Nre();function Nre(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),i=new Uint32Array(512);for(let u=0;u<256;++u){const l=u-127;l<-27?(r[u]=0,r[u|256]=32768,i[u]=24,i[u|256]=24):l<-14?(r[u]=1024>>-l-14,r[u|256]=1024>>-l-14|32768,i[u]=-l-1,i[u|256]=-l-1):l<=15?(r[u]=l+15<<10,r[u|256]=l+15<<10|32768,i[u]=13,i[u|256]=13):l<128?(r[u]=31744,r[u|256]=64512,i[u]=24,i[u|256]=24):(r[u]=31744,r[u|256]=64512,i[u]=13,i[u|256]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let u=1;u<1024;++u){let l=u<<13,c=0;for(;!(l&8388608);)l<<=1,c-=8388608;l&=-8388609,c+=947912704,o[u]=l|c}for(let u=1024;u<2048;++u)o[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)s[u]=u<<23;s[31]=1199570944,s[32]=2147483648;for(let u=33;u<63;++u)s[u]=2147483648+(u-32<<23);s[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(a[u]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:i,mantissaTable:o,exponentTable:s,offsetTable:a}}function as(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Xr(n,-65504,65504),ql.floatView[0]=n;const e=ql.uint32View[0],t=e>>23&511;return ql.baseTable[t]+((e&8388607)>>ql.shiftTable[t])}function M0(n){const e=n>>10;return ql.uint32View[0]=ql.mantissaTable[ql.offsetTable[e]+(n&1023)]+ql.exponentTable[e],ql.floatView[0]}const Lre={toHalfFloat:as,fromHalfFloat:M0},ui=new ne,H2=new De;class In{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=qy,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=vs,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)H2.fromBufferAttribute(this,t),H2.applyMatrix3(e),this.setXY(t,H2.x,H2.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)ui.fromBufferAttribute(this,t),ui.applyMatrix3(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ui.fromBufferAttribute(this,t),ui.applyMatrix4(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ui.fromBufferAttribute(this,t),ui.applyNormalMatrix(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ui.fromBufferAttribute(this,t),ui.transformDirection(e),this.setXYZ(t,ui.x,ui.y,ui.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=hs(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=cn(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=hs(t,this.array)),t}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=hs(t,this.array)),t}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=hs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=hs(t,this.array)),t}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array),o=cn(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==qy&&(e.usage=this.usage),e}}class Fre extends In{constructor(e,t,r){super(new Int8Array(e),t,r)}}class Ore extends In{constructor(e,t,r){super(new Uint8Array(e),t,r)}}class Bre extends In{constructor(e,t,r){super(new Uint8ClampedArray(e),t,r)}}class Ure extends In{constructor(e,t,r){super(new Int16Array(e),t,r)}}class jP extends In{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class zre extends In{constructor(e,t,r){super(new Int32Array(e),t,r)}}class XP extends In{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Vre extends In{constructor(e,t,r){super(new Uint16Array(e),t,r),this.isFloat16BufferAttribute=!0}getX(e){let t=M0(this.array[e*this.itemSize]);return this.normalized&&(t=hs(t,this.array)),t}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize]=as(t),this}getY(e){let t=M0(this.array[e*this.itemSize+1]);return this.normalized&&(t=hs(t,this.array)),t}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+1]=as(t),this}getZ(e){let t=M0(this.array[e*this.itemSize+2]);return this.normalized&&(t=hs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+2]=as(t),this}getW(e){let t=M0(this.array[e*this.itemSize+3]);return this.normalized&&(t=hs(t,this.array)),t}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+3]=as(t),this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array)),this.array[e+0]=as(t),this.array[e+1]=as(r),this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array)),this.array[e+0]=as(t),this.array[e+1]=as(r),this.array[e+2]=as(i),this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array),o=cn(o,this.array)),this.array[e+0]=as(t),this.array[e+1]=as(r),this.array[e+2]=as(i),this.array[e+3]=as(o),this}}class At extends In{constructor(e,t,r){super(new Float32Array(e),t,r)}}class Wre extends In{constructor(e,t,r){super(new Float64Array(e),t,r)}}let Hre=0;const Ca=new tn,K3=new $n,zp=new ne,Us=new Jo,Qg=new Jo,Fi=new ne;class an extends Qa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Hre++}),this.uuid=aa(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(y9(e)?XP:jP)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new pn().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ca.makeRotationFromQuaternion(e),this.applyMatrix4(Ca),this}rotateX(e){return Ca.makeRotationX(e),this.applyMatrix4(Ca),this}rotateY(e){return Ca.makeRotationY(e),this.applyMatrix4(Ca),this}rotateZ(e){return Ca.makeRotationZ(e),this.applyMatrix4(Ca),this}translate(e,t,r){return Ca.makeTranslation(e,t,r),this.applyMatrix4(Ca),this}scale(e,t,r){return Ca.makeScale(e,t,r),this.applyMatrix4(Ca),this}lookAt(e){return K3.lookAt(e),K3.updateMatrix(),this.applyMatrix4(K3.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zp).negate(),this.translate(zp.x,zp.y,zp.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new At(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new ne(-1/0,-1/0,-1/0),new ne(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];Us.setFromBufferAttribute(o),this.morphTargetsRelative?(Fi.addVectors(this.boundingBox.min,Us.min),this.boundingBox.expandByPoint(Fi),Fi.addVectors(this.boundingBox.max,Us.max),this.boundingBox.expandByPoint(Fi)):(this.boundingBox.expandByPoint(Us.min),this.boundingBox.expandByPoint(Us.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ao);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new ne,1/0);return}if(e){const r=this.boundingSphere.center;if(Us.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){const a=t[o];Qg.setFromBufferAttribute(a),this.morphTargetsRelative?(Fi.addVectors(Us.min,Qg.min),Us.expandByPoint(Fi),Fi.addVectors(Us.max,Qg.max),Us.expandByPoint(Fi)):(Us.expandByPoint(Qg.min),Us.expandByPoint(Qg.max))}Us.getCenter(r);let i=0;for(let o=0,s=e.count;o<s;o++)Fi.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(Fi));if(t)for(let o=0,s=t.length;o<s;o++){const a=t[o],u=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)Fi.fromBufferAttribute(a,l),u&&(zp.fromBufferAttribute(e,l),Fi.add(zp)),i=Math.max(i,r.distanceToSquared(Fi))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.array,i=t.position.array,o=t.normal.array,s=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new In(new Float32Array(4*a),4));const u=this.getAttribute("tangent").array,l=[],c=[];for(let A=0;A<a;A++)l[A]=new ne,c[A]=new ne;const h=new ne,f=new ne,d=new ne,p=new De,v=new De,g=new De,m=new ne,x=new ne;function _(A,P,k){h.fromArray(i,A*3),f.fromArray(i,P*3),d.fromArray(i,k*3),p.fromArray(s,A*2),v.fromArray(s,P*2),g.fromArray(s,k*2),f.sub(h),d.sub(h),v.sub(p),g.sub(p);const W=1/(v.x*g.y-g.x*v.y);isFinite(W)&&(m.copy(f).multiplyScalar(g.y).addScaledVector(d,-v.y).multiplyScalar(W),x.copy(d).multiplyScalar(v.x).addScaledVector(f,-g.x).multiplyScalar(W),l[A].add(m),l[P].add(m),l[k].add(m),c[A].add(x),c[P].add(x),c[k].add(x))}let b=this.groups;b.length===0&&(b=[{start:0,count:r.length}]);for(let A=0,P=b.length;A<P;++A){const k=b[A],W=k.start,N=k.count;for(let O=W,z=W+N;O<z;O+=3)_(r[O+0],r[O+1],r[O+2])}const S=new ne,E=new ne,C=new ne,R=new ne;function T(A){C.fromArray(o,A*3),R.copy(C);const P=l[A];S.copy(P),S.sub(C.multiplyScalar(C.dot(P))).normalize(),E.crossVectors(R,P);const W=E.dot(c[A])<0?-1:1;u[A*4]=S.x,u[A*4+1]=S.y,u[A*4+2]=S.z,u[A*4+3]=W}for(let A=0,P=b.length;A<P;++A){const k=b[A],W=k.start,N=k.count;for(let O=W,z=W+N;O<z;O+=3)T(r[O+0]),T(r[O+1]),T(r[O+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new In(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,d=r.count;f<d;f++)r.setXYZ(f,0,0,0);const i=new ne,o=new ne,s=new ne,a=new ne,u=new ne,l=new ne,c=new ne,h=new ne;if(e)for(let f=0,d=e.count;f<d;f+=3){const p=e.getX(f+0),v=e.getX(f+1),g=e.getX(f+2);i.fromBufferAttribute(t,p),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,g),c.subVectors(s,o),h.subVectors(i,o),c.cross(h),a.fromBufferAttribute(r,p),u.fromBufferAttribute(r,v),l.fromBufferAttribute(r,g),a.add(c),u.add(c),l.add(c),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(v,u.x,u.y,u.z),r.setXYZ(g,l.x,l.y,l.z)}else for(let f=0,d=t.count;f<d;f+=3)i.fromBufferAttribute(t,f+0),o.fromBufferAttribute(t,f+1),s.fromBufferAttribute(t,f+2),c.subVectors(s,o),h.subVectors(i,o),c.cross(h),r.setXYZ(f+0,c.x,c.y,c.z),r.setXYZ(f+1,c.x,c.y,c.z),r.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)Fi.fromBufferAttribute(e,t),Fi.normalize(),e.setXYZ(t,Fi.x,Fi.y,Fi.z)}toNonIndexed(){function e(a,u){const l=a.array,c=a.itemSize,h=a.normalized,f=new l.constructor(u.length*c);let d=0,p=0;for(let v=0,g=u.length;v<g;v++){a.isInterleavedBufferAttribute?d=u[v]*a.data.stride+a.offset:d=u[v]*c;for(let m=0;m<c;m++)f[p++]=l[d++]}return new In(f,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new an,r=this.index.array,i=this.attributes;for(const a in i){const u=i[a],l=e(u,r);t.setAttribute(a,l)}const o=this.morphAttributes;for(const a in o){const u=[],l=o[a];for(let c=0,h=l.length;c<h;c++){const f=l[c],d=e(f,r);u.push(d)}t.morphAttributes[a]=u}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,u=s.length;a<u;a++){const l=s[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const l in u)u[l]!==void 0&&(e[l]=u[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const u in r){const l=r[u];e.data.attributes[u]=l.toJSON(e.data)}const i={};let o=!1;for(const u in this.morphAttributes){const l=this.morphAttributes[u],c=[];for(let h=0,f=l.length;h<f;h++){const d=l[h];c.push(d.toJSON(e.data))}c.length>0&&(i[u]=c,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const l in i){const c=i[l];this.setAttribute(l,c.clone(t))}const o=e.morphAttributes;for(const l in o){const c=[],h=o[l];for(let f=0,d=h.length;f<d;f++)c.push(h[f].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let l=0,c=s.length;l<c;l++){const h=s[l];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const YO=new tn,Af=new lg,G2=new Ao,KO=new ne,Vp=new ne,Wp=new ne,Hp=new ne,Z3=new ne,$2=new ne,j2=new De,X2=new De,q2=new De,ZO=new ne,QO=new ne,JO=new ne,Y2=new ne,K2=new ne;let yr=class extends $n{constructor(e=new an,t=new sf){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(o&&a){$2.set(0,0,0);for(let u=0,l=o.length;u<l;u++){const c=a[u],h=o[u];c!==0&&(Z3.fromBufferAttribute(h,e),s?$2.addScaledVector(Z3,c):$2.addScaledVector(Z3.sub(t),c))}t.add($2)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),G2.copy(r.boundingSphere),G2.applyMatrix4(o),Af.copy(e.ray).recast(e.near),!(G2.containsPoint(Af.origin)===!1&&(Af.intersectSphere(G2,KO)===null||Af.origin.distanceToSquared(KO)>(e.far-e.near)**2))&&(YO.copy(o).invert(),Af.copy(e.ray).applyMatrix4(YO),!(r.boundingBox!==null&&Af.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,Af)))}_computeIntersections(e,t,r){let i;const o=this.geometry,s=this.material,a=o.index,u=o.attributes.position,l=o.attributes.uv,c=o.attributes.uv1,h=o.attributes.normal,f=o.groups,d=o.drawRange;if(a!==null)if(Array.isArray(s))for(let p=0,v=f.length;p<v;p++){const g=f[p],m=s[g.materialIndex],x=Math.max(g.start,d.start),_=Math.min(a.count,Math.min(g.start+g.count,d.start+d.count));for(let b=x,S=_;b<S;b+=3){const E=a.getX(b),C=a.getX(b+1),R=a.getX(b+2);i=Z2(this,m,e,r,l,c,h,E,C,R),i&&(i.faceIndex=Math.floor(b/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),v=Math.min(a.count,d.start+d.count);for(let g=p,m=v;g<m;g+=3){const x=a.getX(g),_=a.getX(g+1),b=a.getX(g+2);i=Z2(this,s,e,r,l,c,h,x,_,b),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}else if(u!==void 0)if(Array.isArray(s))for(let p=0,v=f.length;p<v;p++){const g=f[p],m=s[g.materialIndex],x=Math.max(g.start,d.start),_=Math.min(u.count,Math.min(g.start+g.count,d.start+d.count));for(let b=x,S=_;b<S;b+=3){const E=b,C=b+1,R=b+2;i=Z2(this,m,e,r,l,c,h,E,C,R),i&&(i.faceIndex=Math.floor(b/3),i.face.materialIndex=g.materialIndex,t.push(i))}}else{const p=Math.max(0,d.start),v=Math.min(u.count,d.start+d.count);for(let g=p,m=v;g<m;g+=3){const x=g,_=g+1,b=g+2;i=Z2(this,s,e,r,l,c,h,x,_,b),i&&(i.faceIndex=Math.floor(g/3),t.push(i))}}}};function Gre(n,e,t,r,i,o,s,a){let u;if(e.side===Mi?u=r.intersectTriangle(s,o,i,!0,a):u=r.intersectTriangle(i,o,s,e.side===yl,a),u===null)return null;K2.copy(a),K2.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(K2);return l<t.near||l>t.far?null:{distance:l,point:K2.clone(),object:n}}function Z2(n,e,t,r,i,o,s,a,u,l){n.getVertexPosition(a,Vp),n.getVertexPosition(u,Wp),n.getVertexPosition(l,Hp);const c=Gre(n,e,t,r,Vp,Wp,Hp,Y2);if(c){i&&(j2.fromBufferAttribute(i,a),X2.fromBufferAttribute(i,u),q2.fromBufferAttribute(i,l),c.uv=cd.getInterpolation(Y2,Vp,Wp,Hp,j2,X2,q2,new De)),o&&(j2.fromBufferAttribute(o,a),X2.fromBufferAttribute(o,u),q2.fromBufferAttribute(o,l),c.uv1=cd.getInterpolation(Y2,Vp,Wp,Hp,j2,X2,q2,new De),c.uv2=c.uv1),s&&(ZO.fromBufferAttribute(s,a),QO.fromBufferAttribute(s,u),JO.fromBufferAttribute(s,l),c.normal=cd.getInterpolation(Y2,Vp,Wp,Hp,ZO,QO,JO,new ne),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const h={a,b:u,c:l,normal:new ne,materialIndex:0};cd.getNormal(Vp,Wp,Hp,h.normal),c.face=h}return c}class np extends an{constructor(e=1,t=1,r=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:s};const a=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const u=[],l=[],c=[],h=[];let f=0,d=0;p("z","y","x",-1,-1,r,t,e,s,o,0),p("z","y","x",1,-1,r,t,-e,s,o,1),p("x","z","y",1,1,e,r,t,i,s,2),p("x","z","y",1,-1,e,r,-t,i,s,3),p("x","y","z",1,-1,e,t,r,i,o,4),p("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(u),this.setAttribute("position",new At(l,3)),this.setAttribute("normal",new At(c,3)),this.setAttribute("uv",new At(h,2));function p(v,g,m,x,_,b,S,E,C,R,T){const A=b/C,P=S/R,k=b/2,W=S/2,N=E/2,O=C+1,z=R+1;let V=0,F=0;const U=new ne;for(let L=0;L<z;L++){const j=L*P-W;for(let Q=0;Q<O;Q++){const K=Q*A-k;U[v]=K*x,U[g]=j*_,U[m]=N,l.push(U.x,U.y,U.z),U[v]=0,U[g]=0,U[m]=E>0?1:-1,c.push(U.x,U.y,U.z),h.push(Q/C),h.push(1-L/R),V+=1}}for(let L=0;L<R;L++)for(let j=0;j<C;j++){const Q=f+j+O*L,K=f+j+O*(L+1),ie=f+(j+1)+O*(L+1),pe=f+(j+1)+O*L;u.push(Q,K,pe),u.push(K,ie,pe),F+=6}a.addGroup(d,F,T),d+=F,f+=V}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new np(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Fv(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function zo(n){const e={};for(let t=0;t<n.length;t++){const r=Fv(n[t]);for(const i in r)e[i]=r[i]}return e}function $re(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function S9(n){return n.getRenderTarget()===null?n.outputColorSpace:Jn.workingColorSpace}const qP={clone:Fv,merge:zo};var jre=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Xre=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class pi extends $i{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=jre,this.fragmentShader=Xre,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Fv(e.uniforms),this.uniformsGroups=$re(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class Gd extends $n{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new tn,this.projectionMatrix=new tn,this.projectionMatrixInverse=new tn,this.coordinateSystem=mu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}let Si=class extends Gd{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Lv*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Sd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Lv*2*Math.atan(Math.tan(Sd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Sd*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const u=s.fullWidth,l=s.fullHeight;o+=s.offsetX*i/u,t-=s.offsetY*r/l,i*=s.width/u,r*=s.height/l}const a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Gp=-90,$p=1;class E9 extends $n{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Si(Gp,$p,e,t);i.layers=this.layers,this.add(i);const o=new Si(Gp,$p,e,t);o.layers=this.layers,this.add(o);const s=new Si(Gp,$p,e,t);s.layers=this.layers,this.add(s);const a=new Si(Gp,$p,e,t);a.layers=this.layers,this.add(a);const u=new Si(Gp,$p,e,t);u.layers=this.layers,this.add(u);const l=new Si(Gp,$p,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,s,a,u]=t;for(const l of t)this.remove(l);if(e===mu)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===Nv)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,s,a,u,l,c]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const v=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,u),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=v,e.setRenderTarget(r,5,i),e.render(t,c),e.setRenderTarget(h,f,d),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class U1 extends Lr{constructor(e,t,r,i,o,s,a,u,l,c){e=e!==void 0?e:[],t=t!==void 0?t:mc,super(e,t,r,i,o,s,a,u,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class C9 extends oi{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];t.encoding!==void 0&&(X0("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===Ph?Rn:Xo),this.texture=new U1(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Fn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new np(5,5,5),o=new pi({name:"CubemapFromEquirect",uniforms:Fv(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Mi,blending:Qo});o.uniforms.tEquirect.value=t;const s=new yr(i,o),a=t.minFilter;return t.minFilter===Vh&&(t.minFilter=Fn),new E9(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(o)}}const Q3=new ne,qre=new ne,Yre=new pn;class oh{constructor(e=new ne(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=Q3.subVectors(r,t).cross(qre.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Q3),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||Yre.getNormalMatrix(e),i=this.coplanarPoint(Q3).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const If=new Ao,Q2=new ne;class z1{constructor(e=new oh,t=new oh,r=new oh,i=new oh,o=new oh,s=new oh){this.planes=[e,t,r,i,o,s]}set(e,t,r,i,o,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=mu){const r=this.planes,i=e.elements,o=i[0],s=i[1],a=i[2],u=i[3],l=i[4],c=i[5],h=i[6],f=i[7],d=i[8],p=i[9],v=i[10],g=i[11],m=i[12],x=i[13],_=i[14],b=i[15];if(r[0].setComponents(u-o,f-l,g-d,b-m).normalize(),r[1].setComponents(u+o,f+l,g+d,b+m).normalize(),r[2].setComponents(u+s,f+c,g+p,b+x).normalize(),r[3].setComponents(u-s,f-c,g-p,b-x).normalize(),r[4].setComponents(u-a,f-h,g-v,b-_).normalize(),t===mu)r[5].setComponents(u+a,f+h,g+v,b+_).normalize();else if(t===Nv)r[5].setComponents(a,h,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),If.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),If.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(If)}intersectsSprite(e){return If.center.set(0,0,0),If.radius=.7071067811865476,If.applyMatrix4(e.matrixWorld),this.intersectsSphere(If)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Q2.x=i.normal.x>0?e.max.x:e.min.x,Q2.y=i.normal.y>0?e.max.y:e.min.y,Q2.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Q2)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function M9(){let n=null,e=!1,t=null,r=null;function i(o,s){t(o,s),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function Kre(n,e){const t=e.isWebGL2,r=new WeakMap;function i(l,c){const h=l.array,f=l.usage,d=h.byteLength,p=n.createBuffer();n.bindBuffer(c,p),n.bufferData(c,h,f),l.onUploadCallback();let v;if(h instanceof Float32Array)v=n.FLOAT;else if(h instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)v=n.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else v=n.UNSIGNED_SHORT;else if(h instanceof Int16Array)v=n.SHORT;else if(h instanceof Uint32Array)v=n.UNSIGNED_INT;else if(h instanceof Int32Array)v=n.INT;else if(h instanceof Int8Array)v=n.BYTE;else if(h instanceof Uint8Array)v=n.UNSIGNED_BYTE;else if(h instanceof Uint8ClampedArray)v=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:v,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version,size:d}}function o(l,c,h){const f=c.array,d=c._updateRange,p=c.updateRanges;if(n.bindBuffer(h,l),d.count===-1&&p.length===0&&n.bufferSubData(h,0,f),p.length!==0){for(let v=0,g=p.length;v<g;v++){const m=p[v];t?n.bufferSubData(h,m.start*f.BYTES_PER_ELEMENT,f,m.start,m.count):n.bufferSubData(h,m.start*f.BYTES_PER_ELEMENT,f.subarray(m.start,m.start+m.count))}c.clearUpdateRanges()}d.count!==-1&&(t?n.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f,d.offset,d.count):n.bufferSubData(h,d.offset*f.BYTES_PER_ELEMENT,f.subarray(d.offset,d.offset+d.count)),d.count=-1),c.onUploadCallback()}function s(l){return l.isInterleavedBufferAttribute&&(l=l.data),r.get(l)}function a(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=r.get(l);c&&(n.deleteBuffer(c.buffer),r.delete(l))}function u(l,c){if(l.isGLBufferAttribute){const f=r.get(l);(!f||f.version<l.version)&&r.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const h=r.get(l);if(h===void 0)r.set(l,i(l,c));else if(h.version<l.version){if(h.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");o(h.buffer,l,c),h.version=l.version}}return{get:s,remove:a,update:u}}class fl extends an{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,s=t/2,a=Math.floor(r),u=Math.floor(i),l=a+1,c=u+1,h=e/a,f=t/u,d=[],p=[],v=[],g=[];for(let m=0;m<c;m++){const x=m*f-s;for(let _=0;_<l;_++){const b=_*h-o;p.push(b,-x,0),v.push(0,0,1),g.push(_/a),g.push(1-m/u)}}for(let m=0;m<u;m++)for(let x=0;x<a;x++){const _=x+l*m,b=x+l*(m+1),S=x+1+l*(m+1),E=x+1+l*m;d.push(_,b,E),d.push(b,S,E)}this.setIndex(d),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(v,3)),this.setAttribute("uv",new At(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fl(e.width,e.height,e.widthSegments,e.heightSegments)}}var Zre=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,Qre=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Jre=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,eie=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,tie=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,nie=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,rie=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,iie=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,oie=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,sie=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,aie=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,uie=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,lie=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,cie=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,hie=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,fie=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,die=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,pie=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,mie=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,vie=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,gie=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,yie=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,xie=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,wie=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,_ie=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,bie=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Sie=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Eie=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Cie=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Mie=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Tie="gl_FragColor = linearToOutputTexel( gl_FragColor );",Rie=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Aie=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Iie=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Pie=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,kie=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Die=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Nie=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Lie=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Fie=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Oie=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Bie=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Uie=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,zie=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Vie=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Wie=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Hie=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Gie=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,$ie=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,jie=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Xie=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,qie=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Yie=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,Kie=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Zie=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Qie=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Jie=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,eoe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,toe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,noe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,roe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,ioe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,ooe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,soe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,aoe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uoe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,loe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,coe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,hoe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,foe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,doe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,poe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,moe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,voe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,goe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,yoe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,xoe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,woe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,_oe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,boe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Soe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Eoe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Coe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Moe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Toe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Roe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Aoe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Ioe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Poe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,koe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,Doe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Noe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Loe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Foe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Ooe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Boe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Uoe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zoe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Voe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Woe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Hoe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color *= toneMappingExposure;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	return color;
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Goe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,$oe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,joe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Xoe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,qoe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,Yoe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const Koe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,Zoe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Qoe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Joe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ese=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,tse=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,nse=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,rse=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,ise=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ose=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,sse=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ase=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,use=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,lse=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,cse=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,hse=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fse=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dse=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pse=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,mse=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vse=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,gse=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,yse=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xse=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wse=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,_se=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bse=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sse=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ese=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Cse=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Mse=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Tse=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Rse=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Ase=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ln={alphahash_fragment:Zre,alphahash_pars_fragment:Qre,alphamap_fragment:Jre,alphamap_pars_fragment:eie,alphatest_fragment:tie,alphatest_pars_fragment:nie,aomap_fragment:rie,aomap_pars_fragment:iie,batching_pars_vertex:oie,batching_vertex:sie,begin_vertex:aie,beginnormal_vertex:uie,bsdfs:lie,iridescence_fragment:cie,bumpmap_pars_fragment:hie,clipping_planes_fragment:fie,clipping_planes_pars_fragment:die,clipping_planes_pars_vertex:pie,clipping_planes_vertex:mie,color_fragment:vie,color_pars_fragment:gie,color_pars_vertex:yie,color_vertex:xie,common:wie,cube_uv_reflection_fragment:_ie,defaultnormal_vertex:bie,displacementmap_pars_vertex:Sie,displacementmap_vertex:Eie,emissivemap_fragment:Cie,emissivemap_pars_fragment:Mie,colorspace_fragment:Tie,colorspace_pars_fragment:Rie,envmap_fragment:Aie,envmap_common_pars_fragment:Iie,envmap_pars_fragment:Pie,envmap_pars_vertex:kie,envmap_physical_pars_fragment:Gie,envmap_vertex:Die,fog_vertex:Nie,fog_pars_vertex:Lie,fog_fragment:Fie,fog_pars_fragment:Oie,gradientmap_pars_fragment:Bie,lightmap_fragment:Uie,lightmap_pars_fragment:zie,lights_lambert_fragment:Vie,lights_lambert_pars_fragment:Wie,lights_pars_begin:Hie,lights_toon_fragment:$ie,lights_toon_pars_fragment:jie,lights_phong_fragment:Xie,lights_phong_pars_fragment:qie,lights_physical_fragment:Yie,lights_physical_pars_fragment:Kie,lights_fragment_begin:Zie,lights_fragment_maps:Qie,lights_fragment_end:Jie,logdepthbuf_fragment:eoe,logdepthbuf_pars_fragment:toe,logdepthbuf_pars_vertex:noe,logdepthbuf_vertex:roe,map_fragment:ioe,map_pars_fragment:ooe,map_particle_fragment:soe,map_particle_pars_fragment:aoe,metalnessmap_fragment:uoe,metalnessmap_pars_fragment:loe,morphcolor_vertex:coe,morphnormal_vertex:hoe,morphtarget_pars_vertex:foe,morphtarget_vertex:doe,normal_fragment_begin:poe,normal_fragment_maps:moe,normal_pars_fragment:voe,normal_pars_vertex:goe,normal_vertex:yoe,normalmap_pars_fragment:xoe,clearcoat_normal_fragment_begin:woe,clearcoat_normal_fragment_maps:_oe,clearcoat_pars_fragment:boe,iridescence_pars_fragment:Soe,opaque_fragment:Eoe,packing:Coe,premultiplied_alpha_fragment:Moe,project_vertex:Toe,dithering_fragment:Roe,dithering_pars_fragment:Aoe,roughnessmap_fragment:Ioe,roughnessmap_pars_fragment:Poe,shadowmap_pars_fragment:koe,shadowmap_pars_vertex:Doe,shadowmap_vertex:Noe,shadowmask_pars_fragment:Loe,skinbase_vertex:Foe,skinning_pars_vertex:Ooe,skinning_vertex:Boe,skinnormal_vertex:Uoe,specularmap_fragment:zoe,specularmap_pars_fragment:Voe,tonemapping_fragment:Woe,tonemapping_pars_fragment:Hoe,transmission_fragment:Goe,transmission_pars_fragment:$oe,uv_pars_fragment:joe,uv_pars_vertex:Xoe,uv_vertex:qoe,worldpos_vertex:Yoe,background_vert:Koe,background_frag:Zoe,backgroundCube_vert:Qoe,backgroundCube_frag:Joe,cube_vert:ese,cube_frag:tse,depth_vert:nse,depth_frag:rse,distanceRGBA_vert:ise,distanceRGBA_frag:ose,equirect_vert:sse,equirect_frag:ase,linedashed_vert:use,linedashed_frag:lse,meshbasic_vert:cse,meshbasic_frag:hse,meshlambert_vert:fse,meshlambert_frag:dse,meshmatcap_vert:pse,meshmatcap_frag:mse,meshnormal_vert:vse,meshnormal_frag:gse,meshphong_vert:yse,meshphong_frag:xse,meshphysical_vert:wse,meshphysical_frag:_se,meshtoon_vert:bse,meshtoon_frag:Sse,points_vert:Ese,points_frag:Cse,shadow_vert:Mse,shadow_frag:Tse,sprite_vert:Rse,sprite_frag:Ase},st={common:{diffuse:{value:new ct(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new pn}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new pn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new pn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new pn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new pn},normalScale:{value:new De(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new pn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new pn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new pn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new pn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0},uvTransform:{value:new pn}},sprite:{diffuse:{value:new ct(16777215)},opacity:{value:1},center:{value:new De(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new pn},alphaMap:{value:null},alphaMapTransform:{value:new pn},alphaTest:{value:0}}},Ia={basic:{uniforms:zo([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.fog]),vertexShader:ln.meshbasic_vert,fragmentShader:ln.meshbasic_frag},lambert:{uniforms:zo([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.fog,st.lights,{emissive:{value:new ct(0)}}]),vertexShader:ln.meshlambert_vert,fragmentShader:ln.meshlambert_frag},phong:{uniforms:zo([st.common,st.specularmap,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.fog,st.lights,{emissive:{value:new ct(0)},specular:{value:new ct(1118481)},shininess:{value:30}}]),vertexShader:ln.meshphong_vert,fragmentShader:ln.meshphong_frag},standard:{uniforms:zo([st.common,st.envmap,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.roughnessmap,st.metalnessmap,st.fog,st.lights,{emissive:{value:new ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag},toon:{uniforms:zo([st.common,st.aomap,st.lightmap,st.emissivemap,st.bumpmap,st.normalmap,st.displacementmap,st.gradientmap,st.fog,st.lights,{emissive:{value:new ct(0)}}]),vertexShader:ln.meshtoon_vert,fragmentShader:ln.meshtoon_frag},matcap:{uniforms:zo([st.common,st.bumpmap,st.normalmap,st.displacementmap,st.fog,{matcap:{value:null}}]),vertexShader:ln.meshmatcap_vert,fragmentShader:ln.meshmatcap_frag},points:{uniforms:zo([st.points,st.fog]),vertexShader:ln.points_vert,fragmentShader:ln.points_frag},dashed:{uniforms:zo([st.common,st.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ln.linedashed_vert,fragmentShader:ln.linedashed_frag},depth:{uniforms:zo([st.common,st.displacementmap]),vertexShader:ln.depth_vert,fragmentShader:ln.depth_frag},normal:{uniforms:zo([st.common,st.bumpmap,st.normalmap,st.displacementmap,{opacity:{value:1}}]),vertexShader:ln.meshnormal_vert,fragmentShader:ln.meshnormal_frag},sprite:{uniforms:zo([st.sprite,st.fog]),vertexShader:ln.sprite_vert,fragmentShader:ln.sprite_frag},background:{uniforms:{uvTransform:{value:new pn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ln.background_vert,fragmentShader:ln.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ln.backgroundCube_vert,fragmentShader:ln.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ln.cube_vert,fragmentShader:ln.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ln.equirect_vert,fragmentShader:ln.equirect_frag},distanceRGBA:{uniforms:zo([st.common,st.displacementmap,{referencePosition:{value:new ne},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ln.distanceRGBA_vert,fragmentShader:ln.distanceRGBA_frag},shadow:{uniforms:zo([st.lights,st.fog,{color:{value:new ct(0)},opacity:{value:1}}]),vertexShader:ln.shadow_vert,fragmentShader:ln.shadow_frag}};Ia.physical={uniforms:zo([Ia.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new pn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new pn},clearcoatNormalScale:{value:new De(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new pn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new pn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new pn},sheen:{value:0},sheenColor:{value:new ct(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new pn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new pn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new pn},transmissionSamplerSize:{value:new De},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new pn},attenuationDistance:{value:0},attenuationColor:{value:new ct(0)},specularColor:{value:new ct(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new pn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new pn},anisotropyVector:{value:new De},anisotropyMap:{value:null},anisotropyMapTransform:{value:new pn}}]),vertexShader:ln.meshphysical_vert,fragmentShader:ln.meshphysical_frag};const J2={r:0,b:0,g:0};function Ise(n,e,t,r,i,o,s){const a=new ct(0);let u=o===!0?0:1,l,c,h=null,f=0,d=null;function p(g,m){let x=!1,_=m.isScene===!0?m.background:null;_&&_.isTexture&&(_=(m.backgroundBlurriness>0?t:e).get(_)),_===null?v(a,u):_&&_.isColor&&(v(_,1),x=!0);const b=n.xr.getEnvironmentBlendMode();b==="additive"?r.buffers.color.setClear(0,0,0,1,s):b==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(n.autoClear||x)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||_.mapping===ag)?(c===void 0&&(c=new yr(new np(1,1,1),new pi({name:"BackgroundCubeMaterial",uniforms:Fv(Ia.backgroundCube.uniforms),vertexShader:Ia.backgroundCube.vertexShader,fragmentShader:Ia.backgroundCube.fragmentShader,side:Mi,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(S,E,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=m.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,c.material.toneMapped=Jn.getTransfer(_.colorSpace)!==ur,(h!==_||f!==_.version||d!==n.toneMapping)&&(c.material.needsUpdate=!0,h=_,f=_.version,d=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(l===void 0&&(l=new yr(new fl(2,2),new pi({name:"BackgroundMaterial",uniforms:Fv(Ia.background.uniforms),vertexShader:Ia.background.vertexShader,fragmentShader:Ia.background.fragmentShader,side:yl,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=m.backgroundIntensity,l.material.toneMapped=Jn.getTransfer(_.colorSpace)!==ur,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),(h!==_||f!==_.version||d!==n.toneMapping)&&(l.material.needsUpdate=!0,h=_,f=_.version,d=n.toneMapping),l.layers.enableAll(),g.unshift(l,l.geometry,l.material,0,0,null))}function v(g,m){g.getRGB(J2,S9(n)),r.buffers.color.setClear(J2.r,J2.g,J2.b,m,s)}return{getClearColor:function(){return a},setClearColor:function(g,m=1){a.set(g),u=m,v(a,u)},getClearAlpha:function(){return u},setClearAlpha:function(g){u=g,v(a,u)},render:p}}function Pse(n,e,t,r){const i=n.getParameter(n.MAX_VERTEX_ATTRIBS),o=r.isWebGL2?null:e.get("OES_vertex_array_object"),s=r.isWebGL2||o!==null,a={},u=g(null);let l=u,c=!1;function h(N,O,z,V,F){let U=!1;if(s){const L=v(V,z,O);l!==L&&(l=L,d(l.object)),U=m(N,V,z,F),U&&x(N,V,z,F)}else{const L=O.wireframe===!0;(l.geometry!==V.id||l.program!==z.id||l.wireframe!==L)&&(l.geometry=V.id,l.program=z.id,l.wireframe=L,U=!0)}F!==null&&t.update(F,n.ELEMENT_ARRAY_BUFFER),(U||c)&&(c=!1,R(N,O,z,V),F!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(F).buffer))}function f(){return r.isWebGL2?n.createVertexArray():o.createVertexArrayOES()}function d(N){return r.isWebGL2?n.bindVertexArray(N):o.bindVertexArrayOES(N)}function p(N){return r.isWebGL2?n.deleteVertexArray(N):o.deleteVertexArrayOES(N)}function v(N,O,z){const V=z.wireframe===!0;let F=a[N.id];F===void 0&&(F={},a[N.id]=F);let U=F[O.id];U===void 0&&(U={},F[O.id]=U);let L=U[V];return L===void 0&&(L=g(f()),U[V]=L),L}function g(N){const O=[],z=[],V=[];for(let F=0;F<i;F++)O[F]=0,z[F]=0,V[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:z,attributeDivisors:V,object:N,attributes:{},index:null}}function m(N,O,z,V){const F=l.attributes,U=O.attributes;let L=0;const j=z.getAttributes();for(const Q in j)if(j[Q].location>=0){const ie=F[Q];let pe=U[Q];if(pe===void 0&&(Q==="instanceMatrix"&&N.instanceMatrix&&(pe=N.instanceMatrix),Q==="instanceColor"&&N.instanceColor&&(pe=N.instanceColor)),ie===void 0||ie.attribute!==pe||pe&&ie.data!==pe.data)return!0;L++}return l.attributesNum!==L||l.index!==V}function x(N,O,z,V){const F={},U=O.attributes;let L=0;const j=z.getAttributes();for(const Q in j)if(j[Q].location>=0){let ie=U[Q];ie===void 0&&(Q==="instanceMatrix"&&N.instanceMatrix&&(ie=N.instanceMatrix),Q==="instanceColor"&&N.instanceColor&&(ie=N.instanceColor));const pe={};pe.attribute=ie,ie&&ie.data&&(pe.data=ie.data),F[Q]=pe,L++}l.attributes=F,l.attributesNum=L,l.index=V}function _(){const N=l.newAttributes;for(let O=0,z=N.length;O<z;O++)N[O]=0}function b(N){S(N,0)}function S(N,O){const z=l.newAttributes,V=l.enabledAttributes,F=l.attributeDivisors;z[N]=1,V[N]===0&&(n.enableVertexAttribArray(N),V[N]=1),F[N]!==O&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](N,O),F[N]=O)}function E(){const N=l.newAttributes,O=l.enabledAttributes;for(let z=0,V=O.length;z<V;z++)O[z]!==N[z]&&(n.disableVertexAttribArray(z),O[z]=0)}function C(N,O,z,V,F,U,L){L===!0?n.vertexAttribIPointer(N,O,z,F,U):n.vertexAttribPointer(N,O,z,V,F,U)}function R(N,O,z,V){if(r.isWebGL2===!1&&(N.isInstancedMesh||V.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;_();const F=V.attributes,U=z.getAttributes(),L=O.defaultAttributeValues;for(const j in U){const Q=U[j];if(Q.location>=0){let K=F[j];if(K===void 0&&(j==="instanceMatrix"&&N.instanceMatrix&&(K=N.instanceMatrix),j==="instanceColor"&&N.instanceColor&&(K=N.instanceColor)),K!==void 0){const ie=K.normalized,pe=K.itemSize,we=t.get(K);if(we===void 0)continue;const ce=we.buffer,_e=we.type,Oe=we.bytesPerElement,Ve=r.isWebGL2===!0&&(_e===n.INT||_e===n.UNSIGNED_INT||K.gpuType===kP);if(K.isInterleavedBufferAttribute){const Ne=K.data,Z=Ne.stride,de=K.offset;if(Ne.isInstancedInterleavedBuffer){for(let me=0;me<Q.locationSize;me++)S(Q.location+me,Ne.meshPerAttribute);N.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=Ne.meshPerAttribute*Ne.count)}else for(let me=0;me<Q.locationSize;me++)b(Q.location+me);n.bindBuffer(n.ARRAY_BUFFER,ce);for(let me=0;me<Q.locationSize;me++)C(Q.location+me,pe/Q.locationSize,_e,ie,Z*Oe,(de+pe/Q.locationSize*me)*Oe,Ve)}else{if(K.isInstancedBufferAttribute){for(let Ne=0;Ne<Q.locationSize;Ne++)S(Q.location+Ne,K.meshPerAttribute);N.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let Ne=0;Ne<Q.locationSize;Ne++)b(Q.location+Ne);n.bindBuffer(n.ARRAY_BUFFER,ce);for(let Ne=0;Ne<Q.locationSize;Ne++)C(Q.location+Ne,pe/Q.locationSize,_e,ie,pe*Oe,pe/Q.locationSize*Ne*Oe,Ve)}}else if(L!==void 0){const ie=L[j];if(ie!==void 0)switch(ie.length){case 2:n.vertexAttrib2fv(Q.location,ie);break;case 3:n.vertexAttrib3fv(Q.location,ie);break;case 4:n.vertexAttrib4fv(Q.location,ie);break;default:n.vertexAttrib1fv(Q.location,ie)}}}}E()}function T(){k();for(const N in a){const O=a[N];for(const z in O){const V=O[z];for(const F in V)p(V[F].object),delete V[F];delete O[z]}delete a[N]}}function A(N){if(a[N.id]===void 0)return;const O=a[N.id];for(const z in O){const V=O[z];for(const F in V)p(V[F].object),delete V[F];delete O[z]}delete a[N.id]}function P(N){for(const O in a){const z=a[O];if(z[N.id]===void 0)continue;const V=z[N.id];for(const F in V)p(V[F].object),delete V[F];delete z[N.id]}}function k(){W(),c=!0,l!==u&&(l=u,d(l.object))}function W(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:h,reset:k,resetDefaultState:W,dispose:T,releaseStatesOfGeometry:A,releaseStatesOfProgram:P,initAttributes:_,enableAttribute:b,disableUnusedAttributes:E}}function kse(n,e,t,r){const i=r.isWebGL2;let o;function s(c){o=c}function a(c,h){n.drawArrays(o,c,h),t.update(h,o,1)}function u(c,h,f){if(f===0)return;let d,p;if(i)d=n,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](o,c,h,f),t.update(h,o,f)}function l(c,h,f){if(f===0)return;const d=e.get("WEBGL_multi_draw");if(d===null)for(let p=0;p<f;p++)this.render(c[p],h[p]);else{d.multiDrawArraysWEBGL(o,c,0,h,0,f);let p=0;for(let v=0;v<f;v++)p+=h[v];t.update(p,o,1)}}this.setMode=s,this.render=a,this.renderInstances=u,this.renderMultiDraw=l}function Dse(n,e,t){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const C=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(C){if(C==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";C="mediump"}return C==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s=typeof WebGL2RenderingContext<"u"&&n.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const u=o(a);u!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",u,"instead."),a=u);const l=s||e.has("WEBGL_draw_buffers"),c=t.logarithmicDepthBuffer===!0,h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),f=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=n.getParameter(n.MAX_TEXTURE_SIZE),p=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),g=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),m=n.getParameter(n.MAX_VARYING_VECTORS),x=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),_=f>0,b=s||e.has("OES_texture_float"),S=_&&b,E=s?n.getParameter(n.MAX_SAMPLES):0;return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:i,getMaxPrecision:o,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:f,maxTextureSize:d,maxCubemapSize:p,maxAttributes:v,maxVertexUniforms:g,maxVaryings:m,maxFragmentUniforms:x,vertexTextures:_,floatFragmentTextures:b,floatVertexTextures:S,maxSamples:E}}function Nse(n){const e=this;let t=null,r=0,i=!1,o=!1;const s=new oh,a=new pn,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const d=h.length!==0||f||r!==0||i;return i=f,r=h.length,d},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(h,f){t=c(h,f,0)},this.setState=function(h,f,d){const p=h.clippingPlanes,v=h.clipIntersection,g=h.clipShadows,m=n.get(h);if(!i||p===null||p.length===0||o&&!g)o?c(null):l();else{const x=o?0:r,_=x*4;let b=m.clippingState||null;u.value=b,b=c(p,f,_,d);for(let S=0;S!==_;++S)b[S]=t[S];m.clippingState=b,this.numIntersection=v?this.numPlanes:0,this.numPlanes+=x}};function l(){u.value!==t&&(u.value=t,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(h,f,d,p){const v=h!==null?h.length:0;let g=null;if(v!==0){if(g=u.value,p!==!0||g===null){const m=d+v*4,x=f.matrixWorldInverse;a.getNormalMatrix(x),(g===null||g.length<m)&&(g=new Float32Array(m));for(let _=0,b=d;_!==v;++_,b+=4)s.copy(h[_]).applyMatrix4(x,a),s.normal.toArray(g,b),g[b+3]=s.constant}u.value=g,u.needsUpdate=!0}return e.numPlanes=v,e.numIntersection=0,g}}function Lse(n){let e=new WeakMap;function t(s,a){return a===By?s.mapping=mc:a===Uy&&(s.mapping=zh),s}function r(s){if(s&&s.isTexture){const a=s.mapping;if(a===By||a===Uy)if(e.has(s)){const u=e.get(s).texture;return t(u,s.mapping)}else{const u=s.image;if(u&&u.height>0){const l=new C9(u.height/2);return l.fromEquirectangularTexture(n,s),e.set(s,l),s.addEventListener("dispose",i),t(l.texture,s.mapping)}else return null}}return s}function i(s){const a=s.target;a.removeEventListener("dispose",i);const u=e.get(a);u!==void 0&&(e.delete(a),u.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}class af extends Gd{constructor(e=-1,t=1,r=1,i=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,s=r+e,a=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=l*this.view.offsetX,s=o+l*this.view.width,a-=c*this.view.offsetY,u=a-c*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,u,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Bm=4,eB=[.125,.215,.35,.446,.526,.582],td=20,J3=new af,tB=new ct;let eM=null,tM=0,nM=0;const jf=(1+Math.sqrt(5))/2,jp=1/jf,nB=[new ne(1,1,1),new ne(-1,1,1),new ne(1,1,-1),new ne(-1,1,-1),new ne(0,jf,jp),new ne(0,jf,-jp),new ne(jp,0,jf),new ne(-jp,0,jf),new ne(jf,jp,0),new ne(-jf,jp,0)];class NA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){eM=this._renderer.getRenderTarget(),tM=this._renderer.getActiveCubeFace(),nM=this._renderer.getActiveMipmapLevel(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=oB(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=iB(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(eM,tM,nM),e.scissorTest=!1,ew(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===mc||e.mapping===zh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),eM=this._renderer.getRenderTarget(),tM=this._renderer.getActiveCubeFace(),nM=this._renderer.getActiveMipmapLevel();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Fn,minFilter:Fn,generateMipmaps:!1,type:Wh,format:eo,colorSpace:$a,depthBuffer:!1},i=rB(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=rB(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Fse(o)),this._blurMaterial=Ose(o,e,t)}return i}_compileMaterial(e){const t=new yr(this._lodPlanes[0],e);this._renderer.compile(t,J3)}_sceneToCubeUV(e,t,r,i){const a=new Si(90,1,t,r),u=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],c=this._renderer,h=c.autoClear,f=c.toneMapping;c.getClearColor(tB),c.toneMapping=wu,c.autoClear=!1;const d=new sf({name:"PMREM.Background",side:Mi,depthWrite:!1,depthTest:!1}),p=new yr(new np,d);let v=!1;const g=e.background;g?g.isColor&&(d.color.copy(g),e.background=null,v=!0):(d.color.copy(tB),v=!0);for(let m=0;m<6;m++){const x=m%3;x===0?(a.up.set(0,u[m],0),a.lookAt(l[m],0,0)):x===1?(a.up.set(0,0,u[m]),a.lookAt(0,l[m],0)):(a.up.set(0,u[m],0),a.lookAt(0,0,l[m]));const _=this._cubeSize;ew(i,x*_,m>2?_:0,_,_),c.setRenderTarget(i),v&&c.render(p,a),c.render(e,a)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=f,c.autoClear=h,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===mc||e.mapping===zh;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=oB()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=iB());const o=i?this._cubemapMaterial:this._equirectMaterial,s=new yr(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;const u=this._cubeSize;ew(t,0,0,3*u,2*u),r.setRenderTarget(t),r.render(s,J3)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const o=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),s=nB[(i-1)%nB.length];this._blur(e,i-1,i,o,s)}t.autoClear=r}_blur(e,t,r,i,o){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",o),this._halfBlur(s,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,s,a){const u=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new yr(this._lodPlanes[i],l),f=l.uniforms,d=this._sizeLods[r]-1,p=isFinite(o)?Math.PI/(2*d):2*Math.PI/(2*td-1),v=o/p,g=isFinite(o)?1+Math.floor(c*v):td;g>td&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${td}`);const m=[];let x=0;for(let C=0;C<td;++C){const R=C/v,T=Math.exp(-R*R/2);m.push(T),C===0?x+=T:C<g&&(x+=2*T)}for(let C=0;C<m.length;C++)m[C]=m[C]/x;f.envMap.value=e.texture,f.samples.value=g,f.weights.value=m,f.latitudinal.value=s==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:_}=this;f.dTheta.value=p,f.mipInt.value=_-r;const b=this._sizeLods[i],S=3*b*(i>_-Bm?i-_+Bm:0),E=4*(this._cubeSize-b);ew(t,S,E,3*b,2*b),u.setRenderTarget(t),u.render(h,J3)}}function Fse(n){const e=[],t=[],r=[];let i=n;const o=n-Bm+1+eB.length;for(let s=0;s<o;s++){const a=Math.pow(2,i);t.push(a);let u=1/a;s>n-Bm?u=eB[s-n+Bm-1]:s===0&&(u=0),r.push(u);const l=1/(a-2),c=-l,h=1+l,f=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,v=3,g=2,m=1,x=new Float32Array(v*p*d),_=new Float32Array(g*p*d),b=new Float32Array(m*p*d);for(let E=0;E<d;E++){const C=E%3*2/3-1,R=E>2?0:-1,T=[C,R,0,C+2/3,R,0,C+2/3,R+1,0,C,R,0,C+2/3,R+1,0,C,R+1,0];x.set(T,v*p*E),_.set(f,g*p*E);const A=[E,E,E,E,E,E];b.set(A,m*p*E)}const S=new an;S.setAttribute("position",new In(x,v)),S.setAttribute("uv",new In(_,g)),S.setAttribute("faceIndex",new In(b,m)),e.push(S),i>Bm&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function rB(n,e,t){const r=new oi(n,e,t);return r.texture.mapping=ag,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ew(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function Ose(n,e,t){const r=new Float32Array(td),i=new ne(0,1,0);return new pi({name:"SphericalGaussianBlur",defines:{n:td,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:YP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function iB(){return new pi({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:YP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function oB(){return new pi({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:YP(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Qo,depthTest:!1,depthWrite:!1})}function YP(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Bse(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const u=a.mapping,l=u===By||u===Uy,c=u===mc||u===zh;if(l||c)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new NA(n)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{const h=a.image;if(l&&h&&h.height>0||c&&h&&i(h)){t===null&&(t=new NA(n));const f=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,f),a.addEventListener("dispose",o),f.texture}else return null}}}return a}function i(a){let u=0;const l=6;for(let c=0;c<l;c++)a[c]!==void 0&&u++;return u===l}function o(a){const u=a.target;u.removeEventListener("dispose",o);const l=e.get(u);l!==void 0&&(e.delete(u),l.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function Use(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(r){r.isWebGL2?(t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance")):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function zse(n,e,t,r){const i={},o=new WeakMap;function s(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const p in f.attributes)e.remove(f.attributes[p]);for(const p in f.morphAttributes){const v=f.morphAttributes[p];for(let g=0,m=v.length;g<m;g++)e.remove(v[g])}f.removeEventListener("dispose",s),delete i[f.id];const d=o.get(f);d&&(e.remove(d),o.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(h,f){return i[f.id]===!0||(f.addEventListener("dispose",s),i[f.id]=!0,t.memory.geometries++),f}function u(h){const f=h.attributes;for(const p in f)e.update(f[p],n.ARRAY_BUFFER);const d=h.morphAttributes;for(const p in d){const v=d[p];for(let g=0,m=v.length;g<m;g++)e.update(v[g],n.ARRAY_BUFFER)}}function l(h){const f=[],d=h.index,p=h.attributes.position;let v=0;if(d!==null){const x=d.array;v=d.version;for(let _=0,b=x.length;_<b;_+=3){const S=x[_+0],E=x[_+1],C=x[_+2];f.push(S,E,E,C,C,S)}}else if(p!==void 0){const x=p.array;v=p.version;for(let _=0,b=x.length/3-1;_<b;_+=3){const S=_+0,E=_+1,C=_+2;f.push(S,E,E,C,C,S)}}else return;const g=new(y9(f)?XP:jP)(f,1);g.version=v;const m=o.get(h);m&&e.remove(m),o.set(h,g)}function c(h){const f=o.get(h);if(f){const d=h.index;d!==null&&f.version<d.version&&l(h)}else l(h);return o.get(h)}return{get:a,update:u,getWireframeAttribute:c}}function Vse(n,e,t,r){const i=r.isWebGL2;let o;function s(d){o=d}let a,u;function l(d){a=d.type,u=d.bytesPerElement}function c(d,p){n.drawElements(o,p,a,d*u),t.update(p,o,1)}function h(d,p,v){if(v===0)return;let g,m;if(i)g=n,m="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](o,p,a,d*u,v),t.update(p,o,v)}function f(d,p,v){if(v===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<v;m++)this.render(d[m]/u,p[m]);else{g.multiDrawElementsWEBGL(o,p,0,a,d,0,v);let m=0;for(let x=0;x<v;x++)m+=p[x];t.update(m,o,1)}}this.setMode=s,this.setIndex=l,this.render=c,this.renderInstances=h,this.renderMultiDraw=f}function Wse(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,s,a){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function Hse(n,e){return n[0]-e[0]}function Gse(n,e){return Math.abs(e[1])-Math.abs(n[1])}function $se(n,e,t){const r={},i=new Float32Array(8),o=new WeakMap,s=new On,a=[];for(let l=0;l<8;l++)a[l]=[l,0];function u(l,c,h){const f=l.morphTargetInfluences;if(e.isWebGL2===!0){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,v=p!==void 0?p.length:0;let g=o.get(c);if(g===void 0||g.count!==v){let O=function(){W.dispose(),o.delete(c),c.removeEventListener("dispose",O)};var d=O;g!==void 0&&g.texture.dispose();const _=c.morphAttributes.position!==void 0,b=c.morphAttributes.normal!==void 0,S=c.morphAttributes.color!==void 0,E=c.morphAttributes.position||[],C=c.morphAttributes.normal||[],R=c.morphAttributes.color||[];let T=0;_===!0&&(T=1),b===!0&&(T=2),S===!0&&(T=3);let A=c.attributes.position.count*T,P=1;A>e.maxTextureSize&&(P=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const k=new Float32Array(A*P*4*v),W=new tE(k,A,P,v);W.type=vs,W.needsUpdate=!0;const N=T*4;for(let z=0;z<v;z++){const V=E[z],F=C[z],U=R[z],L=A*P*4*z;for(let j=0;j<V.count;j++){const Q=j*N;_===!0&&(s.fromBufferAttribute(V,j),k[L+Q+0]=s.x,k[L+Q+1]=s.y,k[L+Q+2]=s.z,k[L+Q+3]=0),b===!0&&(s.fromBufferAttribute(F,j),k[L+Q+4]=s.x,k[L+Q+5]=s.y,k[L+Q+6]=s.z,k[L+Q+7]=0),S===!0&&(s.fromBufferAttribute(U,j),k[L+Q+8]=s.x,k[L+Q+9]=s.y,k[L+Q+10]=s.z,k[L+Q+11]=U.itemSize===4?s.w:1)}}g={count:v,texture:W,size:new De(A,P)},o.set(c,g),c.addEventListener("dispose",O)}let m=0;for(let _=0;_<f.length;_++)m+=f[_];const x=c.morphTargetsRelative?1:1-m;h.getUniforms().setValue(n,"morphTargetBaseInfluence",x),h.getUniforms().setValue(n,"morphTargetInfluences",f),h.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const p=f===void 0?0:f.length;let v=r[c.id];if(v===void 0||v.length!==p){v=[];for(let b=0;b<p;b++)v[b]=[b,0];r[c.id]=v}for(let b=0;b<p;b++){const S=v[b];S[0]=b,S[1]=f[b]}v.sort(Gse);for(let b=0;b<8;b++)b<p&&v[b][1]?(a[b][0]=v[b][0],a[b][1]=v[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(Hse);const g=c.morphAttributes.position,m=c.morphAttributes.normal;let x=0;for(let b=0;b<8;b++){const S=a[b],E=S[0],C=S[1];E!==Number.MAX_SAFE_INTEGER&&C?(g&&c.getAttribute("morphTarget"+b)!==g[E]&&c.setAttribute("morphTarget"+b,g[E]),m&&c.getAttribute("morphNormal"+b)!==m[E]&&c.setAttribute("morphNormal"+b,m[E]),i[b]=C,x+=C):(g&&c.hasAttribute("morphTarget"+b)===!0&&c.deleteAttribute("morphTarget"+b),m&&c.hasAttribute("morphNormal"+b)===!0&&c.deleteAttribute("morphNormal"+b),i[b]=0)}const _=c.morphTargetsRelative?1:1-x;h.getUniforms().setValue(n,"morphTargetBaseInfluence",_),h.getUniforms().setValue(n,"morphTargetInfluences",i)}}return{update:u}}function jse(n,e,t,r){let i=new WeakMap;function o(u){const l=r.render.frame,c=u.geometry,h=e.get(u,c);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),u.isInstancedMesh&&(u.hasEventListener("dispose",a)===!1&&u.addEventListener("dispose",a),i.get(u)!==l&&(t.update(u.instanceMatrix,n.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,n.ARRAY_BUFFER),i.set(u,l))),u.isSkinnedMesh){const f=u.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function s(){i=new WeakMap}function a(u){const l=u.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:o,dispose:s}}class V1 extends Lr{constructor(e,t,r,i,o,s,a,u,l,c){if(c=c!==void 0?c:Ih,c!==Ih&&c!==Hh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&c===Ih&&(r=il),r===void 0&&c===Hh&&(r=sc),super(null,i,o,s,a,u,c,r,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:ti,this.minFilter=u!==void 0?u:ti,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const T9=new Lr,R9=new V1(1,1);R9.compareFunction=VP;const A9=new tE,I9=new GP,P9=new U1,sB=[],aB=[],uB=new Float32Array(16),lB=new Float32Array(9),cB=new Float32Array(4);function cg(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=sB[i];if(o===void 0&&(o=new Float32Array(i),sB[i]=o),e!==0){r.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,n[s].toArray(o,a)}return o}function Ti(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Ri(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function nE(n,e){let t=aB[e];t===void 0&&(t=new Int32Array(e),aB[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Xse(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function qse(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2fv(this.addr,e),Ri(t,e)}}function Yse(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ti(t,e))return;n.uniform3fv(this.addr,e),Ri(t,e)}}function Kse(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4fv(this.addr,e),Ri(t,e)}}function Zse(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ti(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ri(t,e)}else{if(Ti(t,r))return;cB.set(r),n.uniformMatrix2fv(this.addr,!1,cB),Ri(t,r)}}function Qse(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ti(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ri(t,e)}else{if(Ti(t,r))return;lB.set(r),n.uniformMatrix3fv(this.addr,!1,lB),Ri(t,r)}}function Jse(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ti(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ri(t,e)}else{if(Ti(t,r))return;uB.set(r),n.uniformMatrix4fv(this.addr,!1,uB),Ri(t,r)}}function eae(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function tae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2iv(this.addr,e),Ri(t,e)}}function nae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ti(t,e))return;n.uniform3iv(this.addr,e),Ri(t,e)}}function rae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4iv(this.addr,e),Ri(t,e)}}function iae(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function oae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ti(t,e))return;n.uniform2uiv(this.addr,e),Ri(t,e)}}function sae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ti(t,e))return;n.uniform3uiv(this.addr,e),Ri(t,e)}}function aae(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ti(t,e))return;n.uniform4uiv(this.addr,e),Ri(t,e)}}function uae(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);const o=this.type===n.SAMPLER_2D_SHADOW?R9:T9;t.setTexture2D(e||o,i)}function lae(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||I9,i)}function cae(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||P9,i)}function hae(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||A9,i)}function fae(n){switch(n){case 5126:return Xse;case 35664:return qse;case 35665:return Yse;case 35666:return Kse;case 35674:return Zse;case 35675:return Qse;case 35676:return Jse;case 5124:case 35670:return eae;case 35667:case 35671:return tae;case 35668:case 35672:return nae;case 35669:case 35673:return rae;case 5125:return iae;case 36294:return oae;case 36295:return sae;case 36296:return aae;case 35678:case 36198:case 36298:case 36306:case 35682:return uae;case 35679:case 36299:case 36307:return lae;case 35680:case 36300:case 36308:case 36293:return cae;case 36289:case 36303:case 36311:case 36292:return hae}}function dae(n,e){n.uniform1fv(this.addr,e)}function pae(n,e){const t=cg(e,this.size,2);n.uniform2fv(this.addr,t)}function mae(n,e){const t=cg(e,this.size,3);n.uniform3fv(this.addr,t)}function vae(n,e){const t=cg(e,this.size,4);n.uniform4fv(this.addr,t)}function gae(n,e){const t=cg(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function yae(n,e){const t=cg(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function xae(n,e){const t=cg(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function wae(n,e){n.uniform1iv(this.addr,e)}function _ae(n,e){n.uniform2iv(this.addr,e)}function bae(n,e){n.uniform3iv(this.addr,e)}function Sae(n,e){n.uniform4iv(this.addr,e)}function Eae(n,e){n.uniform1uiv(this.addr,e)}function Cae(n,e){n.uniform2uiv(this.addr,e)}function Mae(n,e){n.uniform3uiv(this.addr,e)}function Tae(n,e){n.uniform4uiv(this.addr,e)}function Rae(n,e,t){const r=this.cache,i=e.length,o=nE(t,i);Ti(r,o)||(n.uniform1iv(this.addr,o),Ri(r,o));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||T9,o[s])}function Aae(n,e,t){const r=this.cache,i=e.length,o=nE(t,i);Ti(r,o)||(n.uniform1iv(this.addr,o),Ri(r,o));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||I9,o[s])}function Iae(n,e,t){const r=this.cache,i=e.length,o=nE(t,i);Ti(r,o)||(n.uniform1iv(this.addr,o),Ri(r,o));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||P9,o[s])}function Pae(n,e,t){const r=this.cache,i=e.length,o=nE(t,i);Ti(r,o)||(n.uniform1iv(this.addr,o),Ri(r,o));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||A9,o[s])}function kae(n){switch(n){case 5126:return dae;case 35664:return pae;case 35665:return mae;case 35666:return vae;case 35674:return gae;case 35675:return yae;case 35676:return xae;case 5124:case 35670:return wae;case 35667:case 35671:return _ae;case 35668:case 35672:return bae;case 35669:case 35673:return Sae;case 5125:return Eae;case 36294:return Cae;case 36295:return Mae;case 36296:return Tae;case 35678:case 36198:case 36298:case 36306:case 35682:return Rae;case 35679:case 36299:case 36307:return Aae;case 35680:case 36300:case 36308:case 36293:return Iae;case 36289:case 36303:case 36311:case 36292:return Pae}}class Dae{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=fae(t.type)}}class Nae{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=kae(t.type)}}class Lae{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const a=i[o];a.setValue(e,t[a.id],r)}}}const rM=/(\w+)(\])?(\[|\.)?/g;function hB(n,e){n.seq.push(e),n.map[e.id]=e}function Fae(n,e,t){const r=n.name,i=r.length;for(rM.lastIndex=0;;){const o=rM.exec(r),s=rM.lastIndex;let a=o[1];const u=o[2]==="]",l=o[3];if(u&&(a=a|0),l===void 0||l==="["&&s+2===i){hB(t,l===void 0?new Dae(a,n,e):new Nae(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new Lae(a),hB(t,h)),t=h}}}class D_{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),s=e.getUniformLocation(t,o.name);Fae(o,s,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,s=t.length;o!==s;++o){const a=t[o],u=r[a.id];u.needsUpdate!==!1&&a.setValue(e,u.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const s=e[i];s.id in t&&r.push(s)}return r}}function fB(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const Oae=37297;let Bae=0;function Uae(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=i;s<o;s++){const a=s+1;r.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return r.join(`
`)}function zae(n){const e=Jn.getPrimaries(Jn.workingColorSpace),t=Jn.getPrimaries(n);let r;switch(e===t?r="":e===Xy&&t===jy?r="LinearDisplayP3ToLinearSRGB":e===jy&&t===Xy&&(r="LinearSRGBToLinearDisplayP3"),n){case $a:case B1:return[r,"LinearTransferOETF"];case Rn:case eE:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function dB(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const s=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+Uae(n.getShaderSource(e),s)}else return i}function Vae(n,e){const t=zae(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Wae(n,e){let t;switch(e){case j7:t="Linear";break;case X7:t="Reinhard";break;case q7:t="OptimizedCineon";break;case IP:t="ACESFilmic";break;case K7:t="AgX";break;case Y7:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Hae(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.normalMapTangentSpace||n.clearcoatNormalMap||n.flatShading||n.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Um).join(`
`)}function Gae(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(Um).join(`
`)}function $ae(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function jae(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),s=o.name;let a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[s]={type:o.type,location:n.getAttribLocation(e,s),locationSize:a}}return t}function Um(n){return n!==""}function pB(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function mB(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Xae=/^[ \t]*#include +<([\w\d./]+)>/gm;function LA(n){return n.replace(Xae,Yae)}const qae=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Yae(n,e){let t=ln[e];if(t===void 0){const r=qae.get(e);if(r!==void 0)t=ln[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return LA(t)}const Kae=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function vB(n){return n.replace(Kae,Zae)}function Zae(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function gB(n){let e="precision "+n.precision+` float;
precision `+n.precision+" int;";return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Qae(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===KS?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===G0?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===lu&&(e="SHADOWMAP_TYPE_VSM"),e}function Jae(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case mc:case zh:e="ENVMAP_TYPE_CUBE";break;case ag:e="ENVMAP_TYPE_CUBE_UV";break}return e}function eue(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case zh:e="ENVMAP_MODE_REFRACTION";break}return e}function tue(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case O1:e="ENVMAP_BLENDING_MULTIPLY";break;case G7:e="ENVMAP_BLENDING_MIX";break;case $7:e="ENVMAP_BLENDING_ADD";break}return e}function nue(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function rue(n,e,t,r){const i=n.getContext(),o=t.defines;let s=t.vertexShader,a=t.fragmentShader;const u=Qae(t),l=Jae(t),c=eue(t),h=tue(t),f=nue(t),d=t.isWebGL2?"":Hae(t),p=Gae(t),v=$ae(o),g=i.createProgram();let m,x,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Um).join(`
`),m.length>0&&(m+=`
`),x=[d,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(Um).join(`
`),x.length>0&&(x+=`
`)):(m=[gB(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Um).join(`
`),x=[d,gB(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==wu?"#define TONE_MAPPING":"",t.toneMapping!==wu?ln.tonemapping_pars_fragment:"",t.toneMapping!==wu?Wae("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ln.colorspace_pars_fragment,Vae("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Um).join(`
`)),s=LA(s),s=pB(s,t),s=mB(s,t),a=LA(a),a=pB(a,t),a=mB(a,t),s=vB(s),a=vB(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,m=[p,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,x=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===kA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===kA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+x);const b=_+m+s,S=_+x+a,E=fB(i,i.VERTEX_SHADER,b),C=fB(i,i.FRAGMENT_SHADER,S);i.attachShader(g,E),i.attachShader(g,C),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function R(k){if(n.debug.checkShaderErrors){const W=i.getProgramInfoLog(g).trim(),N=i.getShaderInfoLog(E).trim(),O=i.getShaderInfoLog(C).trim();let z=!0,V=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(z=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,g,E,C);else{const F=dB(i,E,"vertex"),U=dB(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Program Info Log: `+W+`
`+F+`
`+U)}else W!==""?console.warn("THREE.WebGLProgram: Program Info Log:",W):(N===""||O==="")&&(V=!1);V&&(k.diagnostics={runnable:z,programLog:W,vertexShader:{log:N,prefix:m},fragmentShader:{log:O,prefix:x}})}i.deleteShader(E),i.deleteShader(C),T=new D_(i,g),A=jae(i,g)}let T;this.getUniforms=function(){return T===void 0&&R(this),T};let A;this.getAttributes=function(){return A===void 0&&R(this),A};let P=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=i.getProgramParameter(g,Oae)),P},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Bae++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=E,this.fragmentShader=C,this}let iue=0;class oue{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new sue(e),t.set(e,r)),r}}class sue{constructor(e){this.id=iue++,this.code=e,this.usedTimes=0}}function aue(n,e,t,r,i,o,s){const a=new Ed,u=new oue,l=[],c=i.isWebGL2,h=i.logarithmicDepthBuffer,f=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function v(T){return T===0?"uv":`uv${T}`}function g(T,A,P,k,W){const N=k.fog,O=W.geometry,z=T.isMeshStandardMaterial?k.environment:null,V=(T.isMeshStandardMaterial?t:e).get(T.envMap||z),F=V&&V.mapping===ag?V.image.height:null,U=p[T.type];T.precision!==null&&(d=i.getMaxPrecision(T.precision),d!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",d,"instead."));const L=O.morphAttributes.position||O.morphAttributes.normal||O.morphAttributes.color,j=L!==void 0?L.length:0;let Q=0;O.morphAttributes.position!==void 0&&(Q=1),O.morphAttributes.normal!==void 0&&(Q=2),O.morphAttributes.color!==void 0&&(Q=3);let K,ie,pe,we;if(U){const ft=Ia[U];K=ft.vertexShader,ie=ft.fragmentShader}else K=T.vertexShader,ie=T.fragmentShader,u.update(T),pe=u.getVertexShaderID(T),we=u.getFragmentShaderID(T);const ce=n.getRenderTarget(),_e=W.isInstancedMesh===!0,Oe=W.isBatchedMesh===!0,Ve=!!T.map,Ne=!!T.matcap,Z=!!V,de=!!T.aoMap,me=!!T.lightMap,Ie=!!T.bumpMap,xe=!!T.normalMap,se=!!T.displacementMap,Xe=!!T.emissiveMap,X=!!T.metalnessMap,$=!!T.roughnessMap,le=T.anisotropy>0,ze=T.clearcoat>0,Te=T.iridescence>0,J=T.sheen>0,be=T.transmission>0,ke=le&&!!T.anisotropyMap,He=ze&&!!T.clearcoatMap,Ue=ze&&!!T.clearcoatNormalMap,We=ze&&!!T.clearcoatRoughnessMap,Le=Te&&!!T.iridescenceMap,yt=Te&&!!T.iridescenceThicknessMap,rt=J&&!!T.sheenColorMap,dt=J&&!!T.sheenRoughnessMap,ot=!!T.specularMap,Je=!!T.specularColorMap,Wt=!!T.specularIntensityMap,jt=be&&!!T.transmissionMap,yn=be&&!!T.thicknessMap,nt=!!T.gradientMap,Ye=!!T.alphaMap,ae=T.alphaTest>0,Ze=!!T.alphaHash,et=!!T.extensions,Nt=!!O.attributes.uv1,Tt=!!O.attributes.uv2,hn=!!O.attributes.uv3;let Sn=wu;return T.toneMapped&&(ce===null||ce.isXRRenderTarget===!0)&&(Sn=n.toneMapping),{isWebGL2:c,shaderID:U,shaderType:T.type,shaderName:T.name,vertexShader:K,fragmentShader:ie,defines:T.defines,customVertexShaderID:pe,customFragmentShaderID:we,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:d,batching:Oe,instancing:_e,instancingColor:_e&&W.instanceColor!==null,supportsVertexTextures:f,outputColorSpace:ce===null?n.outputColorSpace:ce.isXRRenderTarget===!0?ce.texture.colorSpace:$a,map:Ve,matcap:Ne,envMap:Z,envMapMode:Z&&V.mapping,envMapCubeUVHeight:F,aoMap:de,lightMap:me,bumpMap:Ie,normalMap:xe,displacementMap:f&&se,emissiveMap:Xe,normalMapObjectSpace:xe&&T.normalMapType===c9,normalMapTangentSpace:xe&&T.normalMapType===of,metalnessMap:X,roughnessMap:$,anisotropy:le,anisotropyMap:ke,clearcoat:ze,clearcoatMap:He,clearcoatNormalMap:Ue,clearcoatRoughnessMap:We,iridescence:Te,iridescenceMap:Le,iridescenceThicknessMap:yt,sheen:J,sheenColorMap:rt,sheenRoughnessMap:dt,specularMap:ot,specularColorMap:Je,specularIntensityMap:Wt,transmission:be,transmissionMap:jt,thicknessMap:yn,gradientMap:nt,opaque:T.transparent===!1&&T.blending===bd,alphaMap:Ye,alphaTest:ae,alphaHash:Ze,combine:T.combine,mapUv:Ve&&v(T.map.channel),aoMapUv:de&&v(T.aoMap.channel),lightMapUv:me&&v(T.lightMap.channel),bumpMapUv:Ie&&v(T.bumpMap.channel),normalMapUv:xe&&v(T.normalMap.channel),displacementMapUv:se&&v(T.displacementMap.channel),emissiveMapUv:Xe&&v(T.emissiveMap.channel),metalnessMapUv:X&&v(T.metalnessMap.channel),roughnessMapUv:$&&v(T.roughnessMap.channel),anisotropyMapUv:ke&&v(T.anisotropyMap.channel),clearcoatMapUv:He&&v(T.clearcoatMap.channel),clearcoatNormalMapUv:Ue&&v(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:We&&v(T.clearcoatRoughnessMap.channel),iridescenceMapUv:Le&&v(T.iridescenceMap.channel),iridescenceThicknessMapUv:yt&&v(T.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&v(T.sheenColorMap.channel),sheenRoughnessMapUv:dt&&v(T.sheenRoughnessMap.channel),specularMapUv:ot&&v(T.specularMap.channel),specularColorMapUv:Je&&v(T.specularColorMap.channel),specularIntensityMapUv:Wt&&v(T.specularIntensityMap.channel),transmissionMapUv:jt&&v(T.transmissionMap.channel),thicknessMapUv:yn&&v(T.thicknessMap.channel),alphaMapUv:Ye&&v(T.alphaMap.channel),vertexTangents:!!O.attributes.tangent&&(xe||le),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!O.attributes.color&&O.attributes.color.itemSize===4,vertexUv1s:Nt,vertexUv2s:Tt,vertexUv3s:hn,pointsUvs:W.isPoints===!0&&!!O.attributes.uv&&(Ve||Ye),fog:!!N,useFog:T.fog===!0,fogExp2:N&&N.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:h,skinning:W.isSkinnedMesh===!0,morphTargets:O.morphAttributes.position!==void 0,morphNormals:O.morphAttributes.normal!==void 0,morphColors:O.morphAttributes.color!==void 0,morphTargetsCount:j,morphTextureStride:Q,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:Sn,useLegacyLights:n._useLegacyLights,decodeVideoTexture:Ve&&T.map.isVideoTexture===!0&&Jn.getTransfer(T.map.colorSpace)===ur,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===jo,flipSided:T.side===Mi,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:et&&T.extensions.derivatives===!0,extensionFragDepth:et&&T.extensions.fragDepth===!0,extensionDrawBuffers:et&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:et&&T.extensions.shaderTextureLOD===!0,extensionClipCullDistance:et&&T.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()}}function m(T){const A=[];if(T.shaderID?A.push(T.shaderID):(A.push(T.customVertexShaderID),A.push(T.customFragmentShaderID)),T.defines!==void 0)for(const P in T.defines)A.push(P),A.push(T.defines[P]);return T.isRawShaderMaterial===!1&&(x(A,T),_(A,T),A.push(n.outputColorSpace)),A.push(T.customProgramCacheKey),A.join()}function x(T,A){T.push(A.precision),T.push(A.outputColorSpace),T.push(A.envMapMode),T.push(A.envMapCubeUVHeight),T.push(A.mapUv),T.push(A.alphaMapUv),T.push(A.lightMapUv),T.push(A.aoMapUv),T.push(A.bumpMapUv),T.push(A.normalMapUv),T.push(A.displacementMapUv),T.push(A.emissiveMapUv),T.push(A.metalnessMapUv),T.push(A.roughnessMapUv),T.push(A.anisotropyMapUv),T.push(A.clearcoatMapUv),T.push(A.clearcoatNormalMapUv),T.push(A.clearcoatRoughnessMapUv),T.push(A.iridescenceMapUv),T.push(A.iridescenceThicknessMapUv),T.push(A.sheenColorMapUv),T.push(A.sheenRoughnessMapUv),T.push(A.specularMapUv),T.push(A.specularColorMapUv),T.push(A.specularIntensityMapUv),T.push(A.transmissionMapUv),T.push(A.thicknessMapUv),T.push(A.combine),T.push(A.fogExp2),T.push(A.sizeAttenuation),T.push(A.morphTargetsCount),T.push(A.morphAttributeCount),T.push(A.numDirLights),T.push(A.numPointLights),T.push(A.numSpotLights),T.push(A.numSpotLightMaps),T.push(A.numHemiLights),T.push(A.numRectAreaLights),T.push(A.numDirLightShadows),T.push(A.numPointLightShadows),T.push(A.numSpotLightShadows),T.push(A.numSpotLightShadowsWithMaps),T.push(A.numLightProbes),T.push(A.shadowMapType),T.push(A.toneMapping),T.push(A.numClippingPlanes),T.push(A.numClipIntersection),T.push(A.depthPacking)}function _(T,A){a.disableAll(),A.isWebGL2&&a.enable(0),A.supportsVertexTextures&&a.enable(1),A.instancing&&a.enable(2),A.instancingColor&&a.enable(3),A.matcap&&a.enable(4),A.envMap&&a.enable(5),A.normalMapObjectSpace&&a.enable(6),A.normalMapTangentSpace&&a.enable(7),A.clearcoat&&a.enable(8),A.iridescence&&a.enable(9),A.alphaTest&&a.enable(10),A.vertexColors&&a.enable(11),A.vertexAlphas&&a.enable(12),A.vertexUv1s&&a.enable(13),A.vertexUv2s&&a.enable(14),A.vertexUv3s&&a.enable(15),A.vertexTangents&&a.enable(16),A.anisotropy&&a.enable(17),A.alphaHash&&a.enable(18),A.batching&&a.enable(19),T.push(a.mask),a.disableAll(),A.fog&&a.enable(0),A.useFog&&a.enable(1),A.flatShading&&a.enable(2),A.logarithmicDepthBuffer&&a.enable(3),A.skinning&&a.enable(4),A.morphTargets&&a.enable(5),A.morphNormals&&a.enable(6),A.morphColors&&a.enable(7),A.premultipliedAlpha&&a.enable(8),A.shadowMapEnabled&&a.enable(9),A.useLegacyLights&&a.enable(10),A.doubleSided&&a.enable(11),A.flipSided&&a.enable(12),A.useDepthPacking&&a.enable(13),A.dithering&&a.enable(14),A.transmission&&a.enable(15),A.sheen&&a.enable(16),A.opaque&&a.enable(17),A.pointsUvs&&a.enable(18),A.decodeVideoTexture&&a.enable(19),T.push(a.mask)}function b(T){const A=p[T.type];let P;if(A){const k=Ia[A];P=qP.clone(k.uniforms)}else P=T.uniforms;return P}function S(T,A){let P;for(let k=0,W=l.length;k<W;k++){const N=l[k];if(N.cacheKey===A){P=N,++P.usedTimes;break}}return P===void 0&&(P=new rue(n,A,T,o),l.push(P)),P}function E(T){if(--T.usedTimes===0){const A=l.indexOf(T);l[A]=l[l.length-1],l.pop(),T.destroy()}}function C(T){u.remove(T)}function R(){u.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:b,acquireProgram:S,releaseProgram:E,releaseShaderCache:C,programs:l,dispose:R}}function uue(){let n=new WeakMap;function e(o){let s=n.get(o);return s===void 0&&(s={},n.set(o,s)),s}function t(o){n.delete(o)}function r(o,s,a){n.get(o)[s]=a}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function lue(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function yB(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function xB(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function s(h,f,d,p,v,g){let m=n[e];return m===void 0?(m={id:h.id,object:h,geometry:f,material:d,groupOrder:p,renderOrder:h.renderOrder,z:v,group:g},n[e]=m):(m.id=h.id,m.object=h,m.geometry=f,m.material=d,m.groupOrder=p,m.renderOrder=h.renderOrder,m.z=v,m.group=g),e++,m}function a(h,f,d,p,v,g){const m=s(h,f,d,p,v,g);d.transmission>0?r.push(m):d.transparent===!0?i.push(m):t.push(m)}function u(h,f,d,p,v,g){const m=s(h,f,d,p,v,g);d.transmission>0?r.unshift(m):d.transparent===!0?i.unshift(m):t.unshift(m)}function l(h,f){t.length>1&&t.sort(h||lue),r.length>1&&r.sort(f||yB),i.length>1&&i.sort(f||yB)}function c(){for(let h=e,f=n.length;h<f;h++){const d=n[h];if(d.id===null)break;d.id=null,d.object=null,d.geometry=null,d.material=null,d.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:a,unshift:u,finish:c,sort:l}}function cue(){let n=new WeakMap;function e(r,i){const o=n.get(r);let s;return o===void 0?(s=new xB,n.set(r,[s])):i>=o.length?(s=new xB,o.push(s)):s=o[i],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function hue(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ne,color:new ct};break;case"SpotLight":t={position:new ne,direction:new ne,color:new ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ne,color:new ct,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ne,skyColor:new ct,groundColor:new ct};break;case"RectAreaLight":t={color:new ct,position:new ne,halfWidth:new ne,halfHeight:new ne};break}return n[e.id]=t,t}}}function fue(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new De,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let due=0;function pue(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function mue(n,e){const t=new hue,r=fue(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new ne);const o=new ne,s=new tn,a=new tn;function u(c,h){let f=0,d=0,p=0;for(let k=0;k<9;k++)i.probe[k].set(0,0,0);let v=0,g=0,m=0,x=0,_=0,b=0,S=0,E=0,C=0,R=0,T=0;c.sort(pue);const A=h===!0?Math.PI:1;for(let k=0,W=c.length;k<W;k++){const N=c[k],O=N.color,z=N.intensity,V=N.distance,F=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)f+=O.r*z*A,d+=O.g*z*A,p+=O.b*z*A;else if(N.isLightProbe){for(let U=0;U<9;U++)i.probe[U].addScaledVector(N.sh.coefficients[U],z);T++}else if(N.isDirectionalLight){const U=t.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity*A),N.castShadow){const L=N.shadow,j=r.get(N);j.shadowBias=L.bias,j.shadowNormalBias=L.normalBias,j.shadowRadius=L.radius,j.shadowMapSize=L.mapSize,i.directionalShadow[v]=j,i.directionalShadowMap[v]=F,i.directionalShadowMatrix[v]=N.shadow.matrix,b++}i.directional[v]=U,v++}else if(N.isSpotLight){const U=t.get(N);U.position.setFromMatrixPosition(N.matrixWorld),U.color.copy(O).multiplyScalar(z*A),U.distance=V,U.coneCos=Math.cos(N.angle),U.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),U.decay=N.decay,i.spot[m]=U;const L=N.shadow;if(N.map&&(i.spotLightMap[C]=N.map,C++,L.updateMatrices(N),N.castShadow&&R++),i.spotLightMatrix[m]=L.matrix,N.castShadow){const j=r.get(N);j.shadowBias=L.bias,j.shadowNormalBias=L.normalBias,j.shadowRadius=L.radius,j.shadowMapSize=L.mapSize,i.spotShadow[m]=j,i.spotShadowMap[m]=F,E++}m++}else if(N.isRectAreaLight){const U=t.get(N);U.color.copy(O).multiplyScalar(z),U.halfWidth.set(N.width*.5,0,0),U.halfHeight.set(0,N.height*.5,0),i.rectArea[x]=U,x++}else if(N.isPointLight){const U=t.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity*A),U.distance=N.distance,U.decay=N.decay,N.castShadow){const L=N.shadow,j=r.get(N);j.shadowBias=L.bias,j.shadowNormalBias=L.normalBias,j.shadowRadius=L.radius,j.shadowMapSize=L.mapSize,j.shadowCameraNear=L.camera.near,j.shadowCameraFar=L.camera.far,i.pointShadow[g]=j,i.pointShadowMap[g]=F,i.pointShadowMatrix[g]=N.shadow.matrix,S++}i.point[g]=U,g++}else if(N.isHemisphereLight){const U=t.get(N);U.skyColor.copy(N.color).multiplyScalar(z*A),U.groundColor.copy(N.groundColor).multiplyScalar(z*A),i.hemi[_]=U,_++}}x>0&&(e.isWebGL2?n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=st.LTC_FLOAT_1,i.rectAreaLTC2=st.LTC_FLOAT_2):(i.rectAreaLTC1=st.LTC_HALF_1,i.rectAreaLTC2=st.LTC_HALF_2):n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=st.LTC_FLOAT_1,i.rectAreaLTC2=st.LTC_FLOAT_2):n.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=st.LTC_HALF_1,i.rectAreaLTC2=st.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=f,i.ambient[1]=d,i.ambient[2]=p;const P=i.hash;(P.directionalLength!==v||P.pointLength!==g||P.spotLength!==m||P.rectAreaLength!==x||P.hemiLength!==_||P.numDirectionalShadows!==b||P.numPointShadows!==S||P.numSpotShadows!==E||P.numSpotMaps!==C||P.numLightProbes!==T)&&(i.directional.length=v,i.spot.length=m,i.rectArea.length=x,i.point.length=g,i.hemi.length=_,i.directionalShadow.length=b,i.directionalShadowMap.length=b,i.pointShadow.length=S,i.pointShadowMap.length=S,i.spotShadow.length=E,i.spotShadowMap.length=E,i.directionalShadowMatrix.length=b,i.pointShadowMatrix.length=S,i.spotLightMatrix.length=E+C-R,i.spotLightMap.length=C,i.numSpotLightShadowsWithMaps=R,i.numLightProbes=T,P.directionalLength=v,P.pointLength=g,P.spotLength=m,P.rectAreaLength=x,P.hemiLength=_,P.numDirectionalShadows=b,P.numPointShadows=S,P.numSpotShadows=E,P.numSpotMaps=C,P.numLightProbes=T,i.version=due++)}function l(c,h){let f=0,d=0,p=0,v=0,g=0;const m=h.matrixWorldInverse;for(let x=0,_=c.length;x<_;x++){const b=c[x];if(b.isDirectionalLight){const S=i.directional[f];S.direction.setFromMatrixPosition(b.matrixWorld),o.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(m),f++}else if(b.isSpotLight){const S=i.spot[p];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(m),S.direction.setFromMatrixPosition(b.matrixWorld),o.setFromMatrixPosition(b.target.matrixWorld),S.direction.sub(o),S.direction.transformDirection(m),p++}else if(b.isRectAreaLight){const S=i.rectArea[v];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(m),a.identity(),s.copy(b.matrixWorld),s.premultiply(m),a.extractRotation(s),S.halfWidth.set(b.width*.5,0,0),S.halfHeight.set(0,b.height*.5,0),S.halfWidth.applyMatrix4(a),S.halfHeight.applyMatrix4(a),v++}else if(b.isPointLight){const S=i.point[d];S.position.setFromMatrixPosition(b.matrixWorld),S.position.applyMatrix4(m),d++}else if(b.isHemisphereLight){const S=i.hemi[g];S.direction.setFromMatrixPosition(b.matrixWorld),S.direction.transformDirection(m),g++}}}return{setup:u,setupView:l,state:i}}function wB(n,e){const t=new mue(n,e),r=[],i=[];function o(){r.length=0,i.length=0}function s(h){r.push(h)}function a(h){i.push(h)}function u(h){t.setup(r,h)}function l(h){t.setupView(r,h)}return{init:o,state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:u,setupLightsView:l,pushLight:s,pushShadow:a}}function vue(n,e){let t=new WeakMap;function r(o,s=0){const a=t.get(o);let u;return a===void 0?(u=new wB(n,e),t.set(o,[u])):s>=a.length?(u=new wB(n,e),a.push(u)):u=a[s],u}function i(){t=new WeakMap}return{get:r,dispose:i}}class KP extends $i{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=ug,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class ZP extends $i{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const gue=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,yue=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function xue(n,e,t){let r=new z1;const i=new De,o=new De,s=new On,a=new KP({depthPacking:l9}),u=new ZP,l={},c=t.maxTextureSize,h={[yl]:Mi,[Mi]:yl,[jo]:jo},f=new pi({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new De},radius:{value:4}},vertexShader:gue,fragmentShader:yue}),d=f.clone();d.defines.HORIZONTAL_PASS=1;const p=new an;p.setAttribute("position",new In(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const v=new yr(p,f),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=KS;let m=this.type;this.render=function(E,C,R){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||E.length===0)return;const T=n.getRenderTarget(),A=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),k=n.state;k.setBlending(Qo),k.buffers.color.setClear(1,1,1,1),k.buffers.depth.setTest(!0),k.setScissorTest(!1);const W=m!==lu&&this.type===lu,N=m===lu&&this.type!==lu;for(let O=0,z=E.length;O<z;O++){const V=E[O],F=V.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(F.autoUpdate===!1&&F.needsUpdate===!1)continue;i.copy(F.mapSize);const U=F.getFrameExtents();if(i.multiply(U),o.copy(F.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(o.x=Math.floor(c/U.x),i.x=o.x*U.x,F.mapSize.x=o.x),i.y>c&&(o.y=Math.floor(c/U.y),i.y=o.y*U.y,F.mapSize.y=o.y)),F.map===null||W===!0||N===!0){const j=this.type!==lu?{minFilter:ti,magFilter:ti}:{};F.map!==null&&F.map.dispose(),F.map=new oi(i.x,i.y,j),F.map.texture.name=V.name+".shadowMap",F.camera.updateProjectionMatrix()}n.setRenderTarget(F.map),n.clear();const L=F.getViewportCount();for(let j=0;j<L;j++){const Q=F.getViewport(j);s.set(o.x*Q.x,o.y*Q.y,o.x*Q.z,o.y*Q.w),k.viewport(s),F.updateMatrices(V,j),r=F.getFrustum(),b(C,R,F.camera,V,this.type)}F.isPointLightShadow!==!0&&this.type===lu&&x(F,R),F.needsUpdate=!1}m=this.type,g.needsUpdate=!1,n.setRenderTarget(T,A,P)};function x(E,C){const R=e.update(v);f.defines.VSM_SAMPLES!==E.blurSamples&&(f.defines.VSM_SAMPLES=E.blurSamples,d.defines.VSM_SAMPLES=E.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new oi(i.x,i.y)),f.uniforms.shadow_pass.value=E.map.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,n.setRenderTarget(E.mapPass),n.clear(),n.renderBufferDirect(C,null,R,f,v,null),d.uniforms.shadow_pass.value=E.mapPass.texture,d.uniforms.resolution.value=E.mapSize,d.uniforms.radius.value=E.radius,n.setRenderTarget(E.map),n.clear(),n.renderBufferDirect(C,null,R,d,v,null)}function _(E,C,R,T){let A=null;const P=R.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(P!==void 0)A=P;else if(A=R.isPointLight===!0?u:a,n.localClippingEnabled&&C.clipShadows===!0&&Array.isArray(C.clippingPlanes)&&C.clippingPlanes.length!==0||C.displacementMap&&C.displacementScale!==0||C.alphaMap&&C.alphaTest>0||C.map&&C.alphaTest>0){const k=A.uuid,W=C.uuid;let N=l[k];N===void 0&&(N={},l[k]=N);let O=N[W];O===void 0&&(O=A.clone(),N[W]=O,C.addEventListener("dispose",S)),A=O}if(A.visible=C.visible,A.wireframe=C.wireframe,T===lu?A.side=C.shadowSide!==null?C.shadowSide:C.side:A.side=C.shadowSide!==null?C.shadowSide:h[C.side],A.alphaMap=C.alphaMap,A.alphaTest=C.alphaTest,A.map=C.map,A.clipShadows=C.clipShadows,A.clippingPlanes=C.clippingPlanes,A.clipIntersection=C.clipIntersection,A.displacementMap=C.displacementMap,A.displacementScale=C.displacementScale,A.displacementBias=C.displacementBias,A.wireframeLinewidth=C.wireframeLinewidth,A.linewidth=C.linewidth,R.isPointLight===!0&&A.isMeshDistanceMaterial===!0){const k=n.properties.get(A);k.light=R}return A}function b(E,C,R,T,A){if(E.visible===!1)return;if(E.layers.test(C.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&A===lu)&&(!E.frustumCulled||r.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,E.matrixWorld);const W=e.update(E),N=E.material;if(Array.isArray(N)){const O=W.groups;for(let z=0,V=O.length;z<V;z++){const F=O[z],U=N[F.materialIndex];if(U&&U.visible){const L=_(E,U,T,A);E.onBeforeShadow(n,E,C,R,W,L,F),n.renderBufferDirect(R,null,W,L,E,F),E.onAfterShadow(n,E,C,R,W,L,F)}}}else if(N.visible){const O=_(E,N,T,A);E.onBeforeShadow(n,E,C,R,W,O,null),n.renderBufferDirect(R,null,W,O,E,null),E.onAfterShadow(n,E,C,R,W,O,null)}}const k=E.children;for(let W=0,N=k.length;W<N;W++)b(k[W],C,R,T,A)}function S(E){E.target.removeEventListener("dispose",S);for(const R in l){const T=l[R],A=E.target.uuid;A in T&&(T[A].dispose(),delete T[A])}}}function wue(n,e,t){const r=t.isWebGL2;function i(){let ae=!1;const Ze=new On;let et=null;const Nt=new On(0,0,0,0);return{setMask:function(Tt){et!==Tt&&!ae&&(n.colorMask(Tt,Tt,Tt,Tt),et=Tt)},setLocked:function(Tt){ae=Tt},setClear:function(Tt,hn,Sn,mt,ft){ft===!0&&(Tt*=mt,hn*=mt,Sn*=mt),Ze.set(Tt,hn,Sn,mt),Nt.equals(Ze)===!1&&(n.clearColor(Tt,hn,Sn,mt),Nt.copy(Ze))},reset:function(){ae=!1,et=null,Nt.set(-1,0,0,0)}}}function o(){let ae=!1,Ze=null,et=null,Nt=null;return{setTest:function(Tt){Tt?Oe(n.DEPTH_TEST):Ve(n.DEPTH_TEST)},setMask:function(Tt){Ze!==Tt&&!ae&&(n.depthMask(Tt),Ze=Tt)},setFunc:function(Tt){if(et!==Tt){switch(Tt){case B7:n.depthFunc(n.NEVER);break;case AP:n.depthFunc(n.ALWAYS);break;case U7:n.depthFunc(n.LESS);break;case Oy:n.depthFunc(n.LEQUAL);break;case z7:n.depthFunc(n.EQUAL);break;case V7:n.depthFunc(n.GEQUAL);break;case W7:n.depthFunc(n.GREATER);break;case H7:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}et=Tt}},setLocked:function(Tt){ae=Tt},setClear:function(Tt){Nt!==Tt&&(n.clearDepth(Tt),Nt=Tt)},reset:function(){ae=!1,Ze=null,et=null,Nt=null}}}function s(){let ae=!1,Ze=null,et=null,Nt=null,Tt=null,hn=null,Sn=null,mt=null,ft=null;return{setTest:function(Mt){ae||(Mt?Oe(n.STENCIL_TEST):Ve(n.STENCIL_TEST))},setMask:function(Mt){Ze!==Mt&&!ae&&(n.stencilMask(Mt),Ze=Mt)},setFunc:function(Mt,Ke,Rt){(et!==Mt||Nt!==Ke||Tt!==Rt)&&(n.stencilFunc(Mt,Ke,Rt),et=Mt,Nt=Ke,Tt=Rt)},setOp:function(Mt,Ke,Rt){(hn!==Mt||Sn!==Ke||mt!==Rt)&&(n.stencilOp(Mt,Ke,Rt),hn=Mt,Sn=Ke,mt=Rt)},setLocked:function(Mt){ae=Mt},setClear:function(Mt){ft!==Mt&&(n.clearStencil(Mt),ft=Mt)},reset:function(){ae=!1,Ze=null,et=null,Nt=null,Tt=null,hn=null,Sn=null,mt=null,ft=null}}}const a=new i,u=new o,l=new s,c=new WeakMap,h=new WeakMap;let f={},d={},p=new WeakMap,v=[],g=null,m=!1,x=null,_=null,b=null,S=null,E=null,C=null,R=null,T=new ct(0,0,0),A=0,P=!1,k=null,W=null,N=null,O=null,z=null;const V=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,U=0;const L=n.getParameter(n.VERSION);L.indexOf("WebGL")!==-1?(U=parseFloat(/^WebGL (\d)/.exec(L)[1]),F=U>=1):L.indexOf("OpenGL ES")!==-1&&(U=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),F=U>=2);let j=null,Q={};const K=n.getParameter(n.SCISSOR_BOX),ie=n.getParameter(n.VIEWPORT),pe=new On().fromArray(K),we=new On().fromArray(ie);function ce(ae,Ze,et,Nt){const Tt=new Uint8Array(4),hn=n.createTexture();n.bindTexture(ae,hn),n.texParameteri(ae,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(ae,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Sn=0;Sn<et;Sn++)r&&(ae===n.TEXTURE_3D||ae===n.TEXTURE_2D_ARRAY)?n.texImage3D(Ze,0,n.RGBA,1,1,Nt,0,n.RGBA,n.UNSIGNED_BYTE,Tt):n.texImage2D(Ze+Sn,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Tt);return hn}const _e={};_e[n.TEXTURE_2D]=ce(n.TEXTURE_2D,n.TEXTURE_2D,1),_e[n.TEXTURE_CUBE_MAP]=ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),r&&(_e[n.TEXTURE_2D_ARRAY]=ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),_e[n.TEXTURE_3D]=ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),u.setClear(1),l.setClear(0),Oe(n.DEPTH_TEST),u.setFunc(Oy),Xe(!1),X(eA),Oe(n.CULL_FACE),xe(Qo);function Oe(ae){f[ae]!==!0&&(n.enable(ae),f[ae]=!0)}function Ve(ae){f[ae]!==!1&&(n.disable(ae),f[ae]=!1)}function Ne(ae,Ze){return d[ae]!==Ze?(n.bindFramebuffer(ae,Ze),d[ae]=Ze,r&&(ae===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=Ze),ae===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=Ze)),!0):!1}function Z(ae,Ze){let et=v,Nt=!1;if(ae)if(et=p.get(Ze),et===void 0&&(et=[],p.set(Ze,et)),ae.isWebGLMultipleRenderTargets){const Tt=ae.texture;if(et.length!==Tt.length||et[0]!==n.COLOR_ATTACHMENT0){for(let hn=0,Sn=Tt.length;hn<Sn;hn++)et[hn]=n.COLOR_ATTACHMENT0+hn;et.length=Tt.length,Nt=!0}}else et[0]!==n.COLOR_ATTACHMENT0&&(et[0]=n.COLOR_ATTACHMENT0,Nt=!0);else et[0]!==n.BACK&&(et[0]=n.BACK,Nt=!0);Nt&&(t.isWebGL2?n.drawBuffers(et):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(et))}function de(ae){return g!==ae?(n.useProgram(ae),g=ae,!0):!1}const me={[ch]:n.FUNC_ADD,[S7]:n.FUNC_SUBTRACT,[E7]:n.FUNC_REVERSE_SUBTRACT};if(r)me[rA]=n.MIN,me[iA]=n.MAX;else{const ae=e.get("EXT_blend_minmax");ae!==null&&(me[rA]=ae.MIN_EXT,me[iA]=ae.MAX_EXT)}const Ie={[C7]:n.ZERO,[M7]:n.ONE,[T7]:n.SRC_COLOR,[_b]:n.SRC_ALPHA,[D7]:n.SRC_ALPHA_SATURATE,[P7]:n.DST_COLOR,[A7]:n.DST_ALPHA,[R7]:n.ONE_MINUS_SRC_COLOR,[bb]:n.ONE_MINUS_SRC_ALPHA,[k7]:n.ONE_MINUS_DST_COLOR,[I7]:n.ONE_MINUS_DST_ALPHA,[N7]:n.CONSTANT_COLOR,[L7]:n.ONE_MINUS_CONSTANT_COLOR,[F7]:n.CONSTANT_ALPHA,[O7]:n.ONE_MINUS_CONSTANT_ALPHA};function xe(ae,Ze,et,Nt,Tt,hn,Sn,mt,ft,Mt){if(ae===Qo){m===!0&&(Ve(n.BLEND),m=!1);return}if(m===!1&&(Oe(n.BLEND),m=!0),ae!==b7){if(ae!==x||Mt!==P){if((_!==ch||E!==ch)&&(n.blendEquation(n.FUNC_ADD),_=ch,E=ch),Mt)switch(ae){case bd:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case wb:n.blendFunc(n.ONE,n.ONE);break;case tA:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case nA:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}else switch(ae){case bd:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case wb:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case tA:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case nA:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ae);break}b=null,S=null,C=null,R=null,T.set(0,0,0),A=0,x=ae,P=Mt}return}Tt=Tt||Ze,hn=hn||et,Sn=Sn||Nt,(Ze!==_||Tt!==E)&&(n.blendEquationSeparate(me[Ze],me[Tt]),_=Ze,E=Tt),(et!==b||Nt!==S||hn!==C||Sn!==R)&&(n.blendFuncSeparate(Ie[et],Ie[Nt],Ie[hn],Ie[Sn]),b=et,S=Nt,C=hn,R=Sn),(mt.equals(T)===!1||ft!==A)&&(n.blendColor(mt.r,mt.g,mt.b,ft),T.copy(mt),A=ft),x=ae,P=!1}function se(ae,Ze){ae.side===jo?Ve(n.CULL_FACE):Oe(n.CULL_FACE);let et=ae.side===Mi;Ze&&(et=!et),Xe(et),ae.blending===bd&&ae.transparent===!1?xe(Qo):xe(ae.blending,ae.blendEquation,ae.blendSrc,ae.blendDst,ae.blendEquationAlpha,ae.blendSrcAlpha,ae.blendDstAlpha,ae.blendColor,ae.blendAlpha,ae.premultipliedAlpha),u.setFunc(ae.depthFunc),u.setTest(ae.depthTest),u.setMask(ae.depthWrite),a.setMask(ae.colorWrite);const Nt=ae.stencilWrite;l.setTest(Nt),Nt&&(l.setMask(ae.stencilWriteMask),l.setFunc(ae.stencilFunc,ae.stencilRef,ae.stencilFuncMask),l.setOp(ae.stencilFail,ae.stencilZFail,ae.stencilZPass)),le(ae.polygonOffset,ae.polygonOffsetFactor,ae.polygonOffsetUnits),ae.alphaToCoverage===!0?Oe(n.SAMPLE_ALPHA_TO_COVERAGE):Ve(n.SAMPLE_ALPHA_TO_COVERAGE)}function Xe(ae){k!==ae&&(ae?n.frontFace(n.CW):n.frontFace(n.CCW),k=ae)}function X(ae){ae!==x7?(Oe(n.CULL_FACE),ae!==W&&(ae===eA?n.cullFace(n.BACK):ae===w7?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ve(n.CULL_FACE),W=ae}function $(ae){ae!==N&&(F&&n.lineWidth(ae),N=ae)}function le(ae,Ze,et){ae?(Oe(n.POLYGON_OFFSET_FILL),(O!==Ze||z!==et)&&(n.polygonOffset(Ze,et),O=Ze,z=et)):Ve(n.POLYGON_OFFSET_FILL)}function ze(ae){ae?Oe(n.SCISSOR_TEST):Ve(n.SCISSOR_TEST)}function Te(ae){ae===void 0&&(ae=n.TEXTURE0+V-1),j!==ae&&(n.activeTexture(ae),j=ae)}function J(ae,Ze,et){et===void 0&&(j===null?et=n.TEXTURE0+V-1:et=j);let Nt=Q[et];Nt===void 0&&(Nt={type:void 0,texture:void 0},Q[et]=Nt),(Nt.type!==ae||Nt.texture!==Ze)&&(j!==et&&(n.activeTexture(et),j=et),n.bindTexture(ae,Ze||_e[ae]),Nt.type=ae,Nt.texture=Ze)}function be(){const ae=Q[j];ae!==void 0&&ae.type!==void 0&&(n.bindTexture(ae.type,null),ae.type=void 0,ae.texture=void 0)}function ke(){try{n.compressedTexImage2D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function He(){try{n.compressedTexImage3D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Ue(){try{n.texSubImage2D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function We(){try{n.texSubImage3D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Le(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function yt(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function rt(){try{n.texStorage2D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function dt(){try{n.texStorage3D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function ot(){try{n.texImage2D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Je(){try{n.texImage3D.apply(n,arguments)}catch(ae){console.error("THREE.WebGLState:",ae)}}function Wt(ae){pe.equals(ae)===!1&&(n.scissor(ae.x,ae.y,ae.z,ae.w),pe.copy(ae))}function jt(ae){we.equals(ae)===!1&&(n.viewport(ae.x,ae.y,ae.z,ae.w),we.copy(ae))}function yn(ae,Ze){let et=h.get(Ze);et===void 0&&(et=new WeakMap,h.set(Ze,et));let Nt=et.get(ae);Nt===void 0&&(Nt=n.getUniformBlockIndex(Ze,ae.name),et.set(ae,Nt))}function nt(ae,Ze){const Nt=h.get(Ze).get(ae);c.get(Ze)!==Nt&&(n.uniformBlockBinding(Ze,Nt,ae.__bindingPointIndex),c.set(Ze,Nt))}function Ye(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),r===!0&&(n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),f={},j=null,Q={},d={},p=new WeakMap,v=[],g=null,m=!1,x=null,_=null,b=null,S=null,E=null,C=null,R=null,T=new ct(0,0,0),A=0,P=!1,k=null,W=null,N=null,O=null,z=null,pe.set(0,0,n.canvas.width,n.canvas.height),we.set(0,0,n.canvas.width,n.canvas.height),a.reset(),u.reset(),l.reset()}return{buffers:{color:a,depth:u,stencil:l},enable:Oe,disable:Ve,bindFramebuffer:Ne,drawBuffers:Z,useProgram:de,setBlending:xe,setMaterial:se,setFlipSided:Xe,setCullFace:X,setLineWidth:$,setPolygonOffset:le,setScissorTest:ze,activeTexture:Te,bindTexture:J,unbindTexture:be,compressedTexImage2D:ke,compressedTexImage3D:He,texImage2D:ot,texImage3D:Je,updateUBOMapping:yn,uniformBlockBinding:nt,texStorage2D:rt,texStorage3D:dt,texSubImage2D:Ue,texSubImage3D:We,compressedTexSubImage2D:Le,compressedTexSubImage3D:yt,scissor:Wt,viewport:jt,reset:Ye}}function _ue(n,e,t,r,i,o,s){const a=i.isWebGL2,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new WeakMap;let h;const f=new WeakMap;let d=!1;try{d=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(X,$){return d?new OffscreenCanvas(X,$):Yy("canvas")}function v(X,$,le,ze){let Te=1;if((X.width>ze||X.height>ze)&&(Te=ze/Math.max(X.width,X.height)),Te<1||$===!0)if(typeof HTMLImageElement<"u"&&X instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&X instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&X instanceof ImageBitmap){const J=$?Cb:Math.floor,be=J(Te*X.width),ke=J(Te*X.height);h===void 0&&(h=p(be,ke));const He=le?p(be,ke):h;return He.width=be,He.height=ke,He.getContext("2d").drawImage(X,0,0,be,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+X.width+"x"+X.height+") to ("+be+"x"+ke+")."),He}else return"data"in X&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+X.width+"x"+X.height+")."),X;return X}function g(X){return DA(X.width)&&DA(X.height)}function m(X){return a?!1:X.wrapS!==qr||X.wrapT!==qr||X.minFilter!==ti&&X.minFilter!==Fn}function x(X,$){return X.generateMipmaps&&$&&X.minFilter!==ti&&X.minFilter!==Fn}function _(X){n.generateMipmap(X)}function b(X,$,le,ze,Te=!1){if(a===!1)return $;if(X!==null){if(n[X]!==void 0)return n[X];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+X+"'")}let J=$;if($===n.RED&&(le===n.FLOAT&&(J=n.R32F),le===n.HALF_FLOAT&&(J=n.R16F),le===n.UNSIGNED_BYTE&&(J=n.R8)),$===n.RED_INTEGER&&(le===n.UNSIGNED_BYTE&&(J=n.R8UI),le===n.UNSIGNED_SHORT&&(J=n.R16UI),le===n.UNSIGNED_INT&&(J=n.R32UI),le===n.BYTE&&(J=n.R8I),le===n.SHORT&&(J=n.R16I),le===n.INT&&(J=n.R32I)),$===n.RG&&(le===n.FLOAT&&(J=n.RG32F),le===n.HALF_FLOAT&&(J=n.RG16F),le===n.UNSIGNED_BYTE&&(J=n.RG8)),$===n.RGBA){const be=Te?$y:Jn.getTransfer(ze);le===n.FLOAT&&(J=n.RGBA32F),le===n.HALF_FLOAT&&(J=n.RGBA16F),le===n.UNSIGNED_BYTE&&(J=be===ur?n.SRGB8_ALPHA8:n.RGBA8),le===n.UNSIGNED_SHORT_4_4_4_4&&(J=n.RGBA4),le===n.UNSIGNED_SHORT_5_5_5_1&&(J=n.RGB5_A1)}return(J===n.R16F||J===n.R32F||J===n.RG16F||J===n.RG32F||J===n.RGBA16F||J===n.RGBA32F)&&e.get("EXT_color_buffer_float"),J}function S(X,$,le){return x(X,le)===!0||X.isFramebufferTexture&&X.minFilter!==ti&&X.minFilter!==Fn?Math.log2(Math.max($.width,$.height))+1:X.mipmaps!==void 0&&X.mipmaps.length>0?X.mipmaps.length:X.isCompressedTexture&&Array.isArray(X.image)?$.mipmaps.length:1}function E(X){return X===ti||X===Sb||X===$0?n.NEAREST:n.LINEAR}function C(X){const $=X.target;$.removeEventListener("dispose",C),T($),$.isVideoTexture&&c.delete($)}function R(X){const $=X.target;$.removeEventListener("dispose",R),P($)}function T(X){const $=r.get(X);if($.__webglInit===void 0)return;const le=X.source,ze=f.get(le);if(ze){const Te=ze[$.__cacheKey];Te.usedTimes--,Te.usedTimes===0&&A(X),Object.keys(ze).length===0&&f.delete(le)}r.remove(X)}function A(X){const $=r.get(X);n.deleteTexture($.__webglTexture);const le=X.source,ze=f.get(le);delete ze[$.__cacheKey],s.memory.textures--}function P(X){const $=X.texture,le=r.get(X),ze=r.get($);if(ze.__webglTexture!==void 0&&(n.deleteTexture(ze.__webglTexture),s.memory.textures--),X.depthTexture&&X.depthTexture.dispose(),X.isWebGLCubeRenderTarget)for(let Te=0;Te<6;Te++){if(Array.isArray(le.__webglFramebuffer[Te]))for(let J=0;J<le.__webglFramebuffer[Te].length;J++)n.deleteFramebuffer(le.__webglFramebuffer[Te][J]);else n.deleteFramebuffer(le.__webglFramebuffer[Te]);le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer[Te])}else{if(Array.isArray(le.__webglFramebuffer))for(let Te=0;Te<le.__webglFramebuffer.length;Te++)n.deleteFramebuffer(le.__webglFramebuffer[Te]);else n.deleteFramebuffer(le.__webglFramebuffer);if(le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer),le.__webglMultisampledFramebuffer&&n.deleteFramebuffer(le.__webglMultisampledFramebuffer),le.__webglColorRenderbuffer)for(let Te=0;Te<le.__webglColorRenderbuffer.length;Te++)le.__webglColorRenderbuffer[Te]&&n.deleteRenderbuffer(le.__webglColorRenderbuffer[Te]);le.__webglDepthRenderbuffer&&n.deleteRenderbuffer(le.__webglDepthRenderbuffer)}if(X.isWebGLMultipleRenderTargets)for(let Te=0,J=$.length;Te<J;Te++){const be=r.get($[Te]);be.__webglTexture&&(n.deleteTexture(be.__webglTexture),s.memory.textures--),r.remove($[Te])}r.remove($),r.remove(X)}let k=0;function W(){k=0}function N(){const X=k;return X>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+X+" texture units while this GPU supports only "+i.maxTextures),k+=1,X}function O(X){const $=[];return $.push(X.wrapS),$.push(X.wrapT),$.push(X.wrapR||0),$.push(X.magFilter),$.push(X.minFilter),$.push(X.anisotropy),$.push(X.internalFormat),$.push(X.format),$.push(X.type),$.push(X.generateMipmaps),$.push(X.premultiplyAlpha),$.push(X.flipY),$.push(X.unpackAlignment),$.push(X.colorSpace),$.join()}function z(X,$){const le=r.get(X);if(X.isVideoTexture&&se(X),X.isRenderTargetTexture===!1&&X.version>0&&le.__version!==X.version){const ze=X.image;if(ze===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ze.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{pe(le,X,$);return}}t.bindTexture(n.TEXTURE_2D,le.__webglTexture,n.TEXTURE0+$)}function V(X,$){const le=r.get(X);if(X.version>0&&le.__version!==X.version){pe(le,X,$);return}t.bindTexture(n.TEXTURE_2D_ARRAY,le.__webglTexture,n.TEXTURE0+$)}function F(X,$){const le=r.get(X);if(X.version>0&&le.__version!==X.version){pe(le,X,$);return}t.bindTexture(n.TEXTURE_3D,le.__webglTexture,n.TEXTURE0+$)}function U(X,$){const le=r.get(X);if(X.version>0&&le.__version!==X.version){we(le,X,$);return}t.bindTexture(n.TEXTURE_CUBE_MAP,le.__webglTexture,n.TEXTURE0+$)}const L={[zy]:n.REPEAT,[qr]:n.CLAMP_TO_EDGE,[Vy]:n.MIRRORED_REPEAT},j={[ti]:n.NEAREST,[Sb]:n.NEAREST_MIPMAP_NEAREST,[$0]:n.NEAREST_MIPMAP_LINEAR,[Fn]:n.LINEAR,[PP]:n.LINEAR_MIPMAP_NEAREST,[Vh]:n.LINEAR_MIPMAP_LINEAR},Q={[h9]:n.NEVER,[g9]:n.ALWAYS,[f9]:n.LESS,[VP]:n.LEQUAL,[d9]:n.EQUAL,[v9]:n.GEQUAL,[p9]:n.GREATER,[m9]:n.NOTEQUAL};function K(X,$,le){if(le?(n.texParameteri(X,n.TEXTURE_WRAP_S,L[$.wrapS]),n.texParameteri(X,n.TEXTURE_WRAP_T,L[$.wrapT]),(X===n.TEXTURE_3D||X===n.TEXTURE_2D_ARRAY)&&n.texParameteri(X,n.TEXTURE_WRAP_R,L[$.wrapR]),n.texParameteri(X,n.TEXTURE_MAG_FILTER,j[$.magFilter]),n.texParameteri(X,n.TEXTURE_MIN_FILTER,j[$.minFilter])):(n.texParameteri(X,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(X,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),(X===n.TEXTURE_3D||X===n.TEXTURE_2D_ARRAY)&&n.texParameteri(X,n.TEXTURE_WRAP_R,n.CLAMP_TO_EDGE),($.wrapS!==qr||$.wrapT!==qr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(X,n.TEXTURE_MAG_FILTER,E($.magFilter)),n.texParameteri(X,n.TEXTURE_MIN_FILTER,E($.minFilter)),$.minFilter!==ti&&$.minFilter!==Fn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),$.compareFunction&&(n.texParameteri(X,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(X,n.TEXTURE_COMPARE_FUNC,Q[$.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const ze=e.get("EXT_texture_filter_anisotropic");if($.magFilter===ti||$.minFilter!==$0&&$.minFilter!==Vh||$.type===vs&&e.has("OES_texture_float_linear")===!1||a===!1&&$.type===Wh&&e.has("OES_texture_half_float_linear")===!1)return;($.anisotropy>1||r.get($).__currentAnisotropy)&&(n.texParameterf(X,ze.TEXTURE_MAX_ANISOTROPY_EXT,Math.min($.anisotropy,i.getMaxAnisotropy())),r.get($).__currentAnisotropy=$.anisotropy)}}function ie(X,$){let le=!1;X.__webglInit===void 0&&(X.__webglInit=!0,$.addEventListener("dispose",C));const ze=$.source;let Te=f.get(ze);Te===void 0&&(Te={},f.set(ze,Te));const J=O($);if(J!==X.__cacheKey){Te[J]===void 0&&(Te[J]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,le=!0),Te[J].usedTimes++;const be=Te[X.__cacheKey];be!==void 0&&(Te[X.__cacheKey].usedTimes--,be.usedTimes===0&&A($)),X.__cacheKey=J,X.__webglTexture=Te[J].texture}return le}function pe(X,$,le){let ze=n.TEXTURE_2D;($.isDataArrayTexture||$.isCompressedArrayTexture)&&(ze=n.TEXTURE_2D_ARRAY),$.isData3DTexture&&(ze=n.TEXTURE_3D);const Te=ie(X,$),J=$.source;t.bindTexture(ze,X.__webglTexture,n.TEXTURE0+le);const be=r.get(J);if(J.version!==be.__version||Te===!0){t.activeTexture(n.TEXTURE0+le);const ke=Jn.getPrimaries(Jn.workingColorSpace),He=$.colorSpace===Xo?null:Jn.getPrimaries($.colorSpace),Ue=$.colorSpace===Xo||ke===He?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,$.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,$.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ue);const We=m($)&&g($.image)===!1;let Le=v($.image,We,!1,i.maxTextureSize);Le=Xe($,Le);const yt=g(Le)||a,rt=o.convert($.format,$.colorSpace);let dt=o.convert($.type),ot=b($.internalFormat,rt,dt,$.colorSpace,$.isVideoTexture);K(ze,$,yt);let Je;const Wt=$.mipmaps,jt=a&&$.isVideoTexture!==!0&&ot!==BP,yn=be.__version===void 0||Te===!0,nt=S($,Le,yt);if($.isDepthTexture)ot=n.DEPTH_COMPONENT,a?$.type===vs?ot=n.DEPTH_COMPONENT32F:$.type===il?ot=n.DEPTH_COMPONENT24:$.type===sc?ot=n.DEPTH24_STENCIL8:ot=n.DEPTH_COMPONENT16:$.type===vs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),$.format===Ih&&ot===n.DEPTH_COMPONENT&&$.type!==QS&&$.type!==il&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),$.type=il,dt=o.convert($.type)),$.format===Hh&&ot===n.DEPTH_COMPONENT&&(ot=n.DEPTH_STENCIL,$.type!==sc&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),$.type=sc,dt=o.convert($.type))),yn&&(jt?t.texStorage2D(n.TEXTURE_2D,1,ot,Le.width,Le.height):t.texImage2D(n.TEXTURE_2D,0,ot,Le.width,Le.height,0,rt,dt,null));else if($.isDataTexture)if(Wt.length>0&&yt){jt&&yn&&t.texStorage2D(n.TEXTURE_2D,nt,ot,Wt[0].width,Wt[0].height);for(let Ye=0,ae=Wt.length;Ye<ae;Ye++)Je=Wt[Ye],jt?t.texSubImage2D(n.TEXTURE_2D,Ye,0,0,Je.width,Je.height,rt,dt,Je.data):t.texImage2D(n.TEXTURE_2D,Ye,ot,Je.width,Je.height,0,rt,dt,Je.data);$.generateMipmaps=!1}else jt?(yn&&t.texStorage2D(n.TEXTURE_2D,nt,ot,Le.width,Le.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,Le.width,Le.height,rt,dt,Le.data)):t.texImage2D(n.TEXTURE_2D,0,ot,Le.width,Le.height,0,rt,dt,Le.data);else if($.isCompressedTexture)if($.isCompressedArrayTexture){jt&&yn&&t.texStorage3D(n.TEXTURE_2D_ARRAY,nt,ot,Wt[0].width,Wt[0].height,Le.depth);for(let Ye=0,ae=Wt.length;Ye<ae;Ye++)Je=Wt[Ye],$.format!==eo?rt!==null?jt?t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Ye,0,0,0,Je.width,Je.height,Le.depth,rt,Je.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Ye,ot,Je.width,Je.height,Le.depth,0,Je.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):jt?t.texSubImage3D(n.TEXTURE_2D_ARRAY,Ye,0,0,0,Je.width,Je.height,Le.depth,rt,dt,Je.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Ye,ot,Je.width,Je.height,Le.depth,0,rt,dt,Je.data)}else{jt&&yn&&t.texStorage2D(n.TEXTURE_2D,nt,ot,Wt[0].width,Wt[0].height);for(let Ye=0,ae=Wt.length;Ye<ae;Ye++)Je=Wt[Ye],$.format!==eo?rt!==null?jt?t.compressedTexSubImage2D(n.TEXTURE_2D,Ye,0,0,Je.width,Je.height,rt,Je.data):t.compressedTexImage2D(n.TEXTURE_2D,Ye,ot,Je.width,Je.height,0,Je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):jt?t.texSubImage2D(n.TEXTURE_2D,Ye,0,0,Je.width,Je.height,rt,dt,Je.data):t.texImage2D(n.TEXTURE_2D,Ye,ot,Je.width,Je.height,0,rt,dt,Je.data)}else if($.isDataArrayTexture)jt?(yn&&t.texStorage3D(n.TEXTURE_2D_ARRAY,nt,ot,Le.width,Le.height,Le.depth),t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Le.width,Le.height,Le.depth,rt,dt,Le.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,ot,Le.width,Le.height,Le.depth,0,rt,dt,Le.data);else if($.isData3DTexture)jt?(yn&&t.texStorage3D(n.TEXTURE_3D,nt,ot,Le.width,Le.height,Le.depth),t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Le.width,Le.height,Le.depth,rt,dt,Le.data)):t.texImage3D(n.TEXTURE_3D,0,ot,Le.width,Le.height,Le.depth,0,rt,dt,Le.data);else if($.isFramebufferTexture){if(yn)if(jt)t.texStorage2D(n.TEXTURE_2D,nt,ot,Le.width,Le.height);else{let Ye=Le.width,ae=Le.height;for(let Ze=0;Ze<nt;Ze++)t.texImage2D(n.TEXTURE_2D,Ze,ot,Ye,ae,0,rt,dt,null),Ye>>=1,ae>>=1}}else if(Wt.length>0&&yt){jt&&yn&&t.texStorage2D(n.TEXTURE_2D,nt,ot,Wt[0].width,Wt[0].height);for(let Ye=0,ae=Wt.length;Ye<ae;Ye++)Je=Wt[Ye],jt?t.texSubImage2D(n.TEXTURE_2D,Ye,0,0,rt,dt,Je):t.texImage2D(n.TEXTURE_2D,Ye,ot,rt,dt,Je);$.generateMipmaps=!1}else jt?(yn&&t.texStorage2D(n.TEXTURE_2D,nt,ot,Le.width,Le.height),t.texSubImage2D(n.TEXTURE_2D,0,0,0,rt,dt,Le)):t.texImage2D(n.TEXTURE_2D,0,ot,rt,dt,Le);x($,yt)&&_(ze),be.__version=J.version,$.onUpdate&&$.onUpdate($)}X.__version=$.version}function we(X,$,le){if($.image.length!==6)return;const ze=ie(X,$),Te=$.source;t.bindTexture(n.TEXTURE_CUBE_MAP,X.__webglTexture,n.TEXTURE0+le);const J=r.get(Te);if(Te.version!==J.__version||ze===!0){t.activeTexture(n.TEXTURE0+le);const be=Jn.getPrimaries(Jn.workingColorSpace),ke=$.colorSpace===Xo?null:Jn.getPrimaries($.colorSpace),He=$.colorSpace===Xo||be===ke?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,$.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,$.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,He);const Ue=$.isCompressedTexture||$.image[0].isCompressedTexture,We=$.image[0]&&$.image[0].isDataTexture,Le=[];for(let Ye=0;Ye<6;Ye++)!Ue&&!We?Le[Ye]=v($.image[Ye],!1,!0,i.maxCubemapSize):Le[Ye]=We?$.image[Ye].image:$.image[Ye],Le[Ye]=Xe($,Le[Ye]);const yt=Le[0],rt=g(yt)||a,dt=o.convert($.format,$.colorSpace),ot=o.convert($.type),Je=b($.internalFormat,dt,ot,$.colorSpace),Wt=a&&$.isVideoTexture!==!0,jt=J.__version===void 0||ze===!0;let yn=S($,yt,rt);K(n.TEXTURE_CUBE_MAP,$,rt);let nt;if(Ue){Wt&&jt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,yn,Je,yt.width,yt.height);for(let Ye=0;Ye<6;Ye++){nt=Le[Ye].mipmaps;for(let ae=0;ae<nt.length;ae++){const Ze=nt[ae];$.format!==eo?dt!==null?Wt?t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae,0,0,Ze.width,Ze.height,dt,Ze.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae,Je,Ze.width,Ze.height,0,Ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Wt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae,0,0,Ze.width,Ze.height,dt,ot,Ze.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae,Je,Ze.width,Ze.height,0,dt,ot,Ze.data)}}}else{nt=$.mipmaps,Wt&&jt&&(nt.length>0&&yn++,t.texStorage2D(n.TEXTURE_CUBE_MAP,yn,Je,Le[0].width,Le[0].height));for(let Ye=0;Ye<6;Ye++)if(We){Wt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,0,0,Le[Ye].width,Le[Ye].height,dt,ot,Le[Ye].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,Je,Le[Ye].width,Le[Ye].height,0,dt,ot,Le[Ye].data);for(let ae=0;ae<nt.length;ae++){const et=nt[ae].image[Ye].image;Wt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae+1,0,0,et.width,et.height,dt,ot,et.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae+1,Je,et.width,et.height,0,dt,ot,et.data)}}else{Wt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,0,0,dt,ot,Le[Ye]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,Je,dt,ot,Le[Ye]);for(let ae=0;ae<nt.length;ae++){const Ze=nt[ae];Wt?t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae+1,0,0,dt,ot,Ze.image[Ye]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,ae+1,Je,dt,ot,Ze.image[Ye])}}}x($,rt)&&_(n.TEXTURE_CUBE_MAP),J.__version=Te.version,$.onUpdate&&$.onUpdate($)}X.__version=$.version}function ce(X,$,le,ze,Te,J){const be=o.convert(le.format,le.colorSpace),ke=o.convert(le.type),He=b(le.internalFormat,be,ke,le.colorSpace);if(!r.get($).__hasExternalTextures){const We=Math.max(1,$.width>>J),Le=Math.max(1,$.height>>J);Te===n.TEXTURE_3D||Te===n.TEXTURE_2D_ARRAY?t.texImage3D(Te,J,He,We,Le,$.depth,0,be,ke,null):t.texImage2D(Te,J,He,We,Le,0,be,ke,null)}t.bindFramebuffer(n.FRAMEBUFFER,X),xe($)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ze,Te,r.get(le).__webglTexture,0,Ie($)):(Te===n.TEXTURE_2D||Te>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Te<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,ze,Te,r.get(le).__webglTexture,J),t.bindFramebuffer(n.FRAMEBUFFER,null)}function _e(X,$,le){if(n.bindRenderbuffer(n.RENDERBUFFER,X),$.depthBuffer&&!$.stencilBuffer){let ze=a===!0?n.DEPTH_COMPONENT24:n.DEPTH_COMPONENT16;if(le||xe($)){const Te=$.depthTexture;Te&&Te.isDepthTexture&&(Te.type===vs?ze=n.DEPTH_COMPONENT32F:Te.type===il&&(ze=n.DEPTH_COMPONENT24));const J=Ie($);xe($)?u.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,J,ze,$.width,$.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,J,ze,$.width,$.height)}else n.renderbufferStorage(n.RENDERBUFFER,ze,$.width,$.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,X)}else if($.depthBuffer&&$.stencilBuffer){const ze=Ie($);le&&xe($)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,ze,n.DEPTH24_STENCIL8,$.width,$.height):xe($)?u.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ze,n.DEPTH24_STENCIL8,$.width,$.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,$.width,$.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,X)}else{const ze=$.isWebGLMultipleRenderTargets===!0?$.texture:[$.texture];for(let Te=0;Te<ze.length;Te++){const J=ze[Te],be=o.convert(J.format,J.colorSpace),ke=o.convert(J.type),He=b(J.internalFormat,be,ke,J.colorSpace),Ue=Ie($);le&&xe($)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Ue,He,$.width,$.height):xe($)?u.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Ue,He,$.width,$.height):n.renderbufferStorage(n.RENDERBUFFER,He,$.width,$.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Oe(X,$){if($&&$.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,X),!($.depthTexture&&$.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get($.depthTexture).__webglTexture||$.depthTexture.image.width!==$.width||$.depthTexture.image.height!==$.height)&&($.depthTexture.image.width=$.width,$.depthTexture.image.height=$.height,$.depthTexture.needsUpdate=!0),z($.depthTexture,0);const ze=r.get($.depthTexture).__webglTexture,Te=Ie($);if($.depthTexture.format===Ih)xe($)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ze,0,Te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ze,0);else if($.depthTexture.format===Hh)xe($)?u.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ze,0,Te):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ze,0);else throw new Error("Unknown depthTexture format")}function Ve(X){const $=r.get(X),le=X.isWebGLCubeRenderTarget===!0;if(X.depthTexture&&!$.__autoAllocateDepthBuffer){if(le)throw new Error("target.depthTexture not supported in Cube render targets");Oe($.__webglFramebuffer,X)}else if(le){$.__webglDepthbuffer=[];for(let ze=0;ze<6;ze++)t.bindFramebuffer(n.FRAMEBUFFER,$.__webglFramebuffer[ze]),$.__webglDepthbuffer[ze]=n.createRenderbuffer(),_e($.__webglDepthbuffer[ze],X,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,$.__webglFramebuffer),$.__webglDepthbuffer=n.createRenderbuffer(),_e($.__webglDepthbuffer,X,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ne(X,$,le){const ze=r.get(X);$!==void 0&&ce(ze.__webglFramebuffer,X,X.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),le!==void 0&&Ve(X)}function Z(X){const $=X.texture,le=r.get(X),ze=r.get($);X.addEventListener("dispose",R),X.isWebGLMultipleRenderTargets!==!0&&(ze.__webglTexture===void 0&&(ze.__webglTexture=n.createTexture()),ze.__version=$.version,s.memory.textures++);const Te=X.isWebGLCubeRenderTarget===!0,J=X.isWebGLMultipleRenderTargets===!0,be=g(X)||a;if(Te){le.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)if(a&&$.mipmaps&&$.mipmaps.length>0){le.__webglFramebuffer[ke]=[];for(let He=0;He<$.mipmaps.length;He++)le.__webglFramebuffer[ke][He]=n.createFramebuffer()}else le.__webglFramebuffer[ke]=n.createFramebuffer()}else{if(a&&$.mipmaps&&$.mipmaps.length>0){le.__webglFramebuffer=[];for(let ke=0;ke<$.mipmaps.length;ke++)le.__webglFramebuffer[ke]=n.createFramebuffer()}else le.__webglFramebuffer=n.createFramebuffer();if(J)if(i.drawBuffers){const ke=X.texture;for(let He=0,Ue=ke.length;He<Ue;He++){const We=r.get(ke[He]);We.__webglTexture===void 0&&(We.__webglTexture=n.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&X.samples>0&&xe(X)===!1){const ke=J?$:[$];le.__webglMultisampledFramebuffer=n.createFramebuffer(),le.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,le.__webglMultisampledFramebuffer);for(let He=0;He<ke.length;He++){const Ue=ke[He];le.__webglColorRenderbuffer[He]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,le.__webglColorRenderbuffer[He]);const We=o.convert(Ue.format,Ue.colorSpace),Le=o.convert(Ue.type),yt=b(Ue.internalFormat,We,Le,Ue.colorSpace,X.isXRRenderTarget===!0),rt=Ie(X);n.renderbufferStorageMultisample(n.RENDERBUFFER,rt,yt,X.width,X.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+He,n.RENDERBUFFER,le.__webglColorRenderbuffer[He])}n.bindRenderbuffer(n.RENDERBUFFER,null),X.depthBuffer&&(le.__webglDepthRenderbuffer=n.createRenderbuffer(),_e(le.__webglDepthRenderbuffer,X,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Te){t.bindTexture(n.TEXTURE_CUBE_MAP,ze.__webglTexture),K(n.TEXTURE_CUBE_MAP,$,be);for(let ke=0;ke<6;ke++)if(a&&$.mipmaps&&$.mipmaps.length>0)for(let He=0;He<$.mipmaps.length;He++)ce(le.__webglFramebuffer[ke][He],X,$,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,He);else ce(le.__webglFramebuffer[ke],X,$,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0);x($,be)&&_(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(J){const ke=X.texture;for(let He=0,Ue=ke.length;He<Ue;He++){const We=ke[He],Le=r.get(We);t.bindTexture(n.TEXTURE_2D,Le.__webglTexture),K(n.TEXTURE_2D,We,be),ce(le.__webglFramebuffer,X,We,n.COLOR_ATTACHMENT0+He,n.TEXTURE_2D,0),x(We,be)&&_(n.TEXTURE_2D)}t.unbindTexture()}else{let ke=n.TEXTURE_2D;if((X.isWebGL3DRenderTarget||X.isWebGLArrayRenderTarget)&&(a?ke=X.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ke,ze.__webglTexture),K(ke,$,be),a&&$.mipmaps&&$.mipmaps.length>0)for(let He=0;He<$.mipmaps.length;He++)ce(le.__webglFramebuffer[He],X,$,n.COLOR_ATTACHMENT0,ke,He);else ce(le.__webglFramebuffer,X,$,n.COLOR_ATTACHMENT0,ke,0);x($,be)&&_(ke),t.unbindTexture()}X.depthBuffer&&Ve(X)}function de(X){const $=g(X)||a,le=X.isWebGLMultipleRenderTargets===!0?X.texture:[X.texture];for(let ze=0,Te=le.length;ze<Te;ze++){const J=le[ze];if(x(J,$)){const be=X.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,ke=r.get(J).__webglTexture;t.bindTexture(be,ke),_(be),t.unbindTexture()}}}function me(X){if(a&&X.samples>0&&xe(X)===!1){const $=X.isWebGLMultipleRenderTargets?X.texture:[X.texture],le=X.width,ze=X.height;let Te=n.COLOR_BUFFER_BIT;const J=[],be=X.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=r.get(X),He=X.isWebGLMultipleRenderTargets===!0;if(He)for(let Ue=0;Ue<$.length;Ue++)t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ue,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ue,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,ke.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglFramebuffer);for(let Ue=0;Ue<$.length;Ue++){J.push(n.COLOR_ATTACHMENT0+Ue),X.depthBuffer&&J.push(be);const We=ke.__ignoreDepthValues!==void 0?ke.__ignoreDepthValues:!1;if(We===!1&&(X.depthBuffer&&(Te|=n.DEPTH_BUFFER_BIT),X.stencilBuffer&&(Te|=n.STENCIL_BUFFER_BIT)),He&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ue]),We===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[be]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[be])),He){const Le=r.get($[Ue]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Le,0)}n.blitFramebuffer(0,0,le,ze,0,0,le,ze,Te,n.NEAREST),l&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,J)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),He)for(let Ue=0;Ue<$.length;Ue++){t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ue,n.RENDERBUFFER,ke.__webglColorRenderbuffer[Ue]);const We=r.get($[Ue]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,ke.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ue,n.TEXTURE_2D,We,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,ke.__webglMultisampledFramebuffer)}}function Ie(X){return Math.min(i.maxSamples,X.samples)}function xe(X){const $=r.get(X);return a&&X.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&$.__useRenderToTexture!==!1}function se(X){const $=s.render.frame;c.get(X)!==$&&(c.set(X,$),X.update())}function Xe(X,$){const le=X.colorSpace,ze=X.format,Te=X.type;return X.isCompressedTexture===!0||X.isVideoTexture===!0||X.format===Eb||le!==$a&&le!==Xo&&(Jn.getTransfer(le)===ur?a===!1?e.has("EXT_sRGB")===!0&&ze===eo?(X.format=Eb,X.minFilter=Fn,X.generateMipmaps=!1):$=HP.sRGBToLinear($):(ze!==eo||Te!==ro)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",le)),$}this.allocateTextureUnit=N,this.resetTextureUnits=W,this.setTexture2D=z,this.setTexture2DArray=V,this.setTexture3D=F,this.setTextureCube=U,this.rebindTextures=Ne,this.setupRenderTarget=Z,this.updateRenderTargetMipmap=de,this.updateMultisampleRenderTarget=me,this.setupDepthRenderbuffer=Ve,this.setupFrameBufferTexture=ce,this.useMultisampledRTT=xe}function k9(n,e,t){const r=t.isWebGL2;function i(o,s=Xo){let a;const u=Jn.getTransfer(s);if(o===ro)return n.UNSIGNED_BYTE;if(o===DP)return n.UNSIGNED_SHORT_4_4_4_4;if(o===NP)return n.UNSIGNED_SHORT_5_5_5_1;if(o===Q7)return n.BYTE;if(o===J7)return n.SHORT;if(o===QS)return n.UNSIGNED_SHORT;if(o===kP)return n.INT;if(o===il)return n.UNSIGNED_INT;if(o===vs)return n.FLOAT;if(o===Wh)return r?n.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(o===e9)return n.ALPHA;if(o===eo)return n.RGBA;if(o===t9)return n.LUMINANCE;if(o===n9)return n.LUMINANCE_ALPHA;if(o===Ih)return n.DEPTH_COMPONENT;if(o===Hh)return n.DEPTH_STENCIL;if(o===Eb)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(o===r9)return n.RED;if(o===LP)return n.RED_INTEGER;if(o===i9)return n.RG;if(o===FP)return n.RG_INTEGER;if(o===OP)return n.RGBA_INTEGER;if(o===T_||o===R_||o===A_||o===I_)if(u===ur)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(o===T_)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===R_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===A_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===I_)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(o===T_)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===R_)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===A_)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===I_)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===sA||o===aA||o===uA||o===lA)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(o===sA)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===aA)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===uA)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===lA)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===BP)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===cA||o===hA)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(o===cA)return u===ur?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(o===hA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===fA||o===dA||o===pA||o===mA||o===vA||o===gA||o===yA||o===xA||o===wA||o===_A||o===bA||o===SA||o===EA||o===CA)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(o===fA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===dA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===pA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===mA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===vA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===gA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===yA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===xA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===wA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===_A)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===bA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===SA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===EA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===CA)return u===ur?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===P_||o===MA||o===TA)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(o===P_)return u===ur?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(o===MA)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(o===TA)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(o===o9||o===RA||o===AA||o===IA)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(o===P_)return a.COMPRESSED_RED_RGTC1_EXT;if(o===RA)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(o===AA)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(o===IA)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return o===sc?r?n.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):n[o]!==void 0?n[o]:null}return{convert:i}}class D9 extends Si{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class zm extends $n{constructor(){super(),this.isGroup=!0,this.type="Group"}}const bue={type:"move"};class iM{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new zm,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new zm,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ne,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ne),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new zm,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ne,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ne),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,s=null;const a=this._targetRay,u=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){s=!0;for(const v of e.hand.values()){const g=t.getJointPose(v,r),m=this._getHandJoint(l,v);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,m.jointRadius=g.radius),m.visible=g!==null}const c=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=c.position.distanceTo(h.position),d=.02,p=.005;l.inputState.pinching&&f>d+p?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=d-p&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,o.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(o.linearVelocity)):u.hasLinearVelocity=!1,o.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(o.angularVelocity)):u.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(bue)))}return a!==null&&(a.visible=i!==null),u!==null&&(u.visible=o!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new zm;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class Sue extends Qa{constructor(e,t){super();const r=this;let i=null,o=1,s=null,a="local-floor",u=1,l=null,c=null,h=null,f=null,d=null,p=null;const v=t.getContextAttributes();let g=null,m=null;const x=[],_=[],b=new De;let S=null;const E=new Si;E.layers.enable(1),E.viewport=new On;const C=new Si;C.layers.enable(2),C.viewport=new On;const R=[E,C],T=new D9;T.layers.enable(1),T.layers.enable(2);let A=null,P=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(K){let ie=x[K];return ie===void 0&&(ie=new iM,x[K]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(K){let ie=x[K];return ie===void 0&&(ie=new iM,x[K]=ie),ie.getGripSpace()},this.getHand=function(K){let ie=x[K];return ie===void 0&&(ie=new iM,x[K]=ie),ie.getHandSpace()};function k(K){const ie=_.indexOf(K.inputSource);if(ie===-1)return;const pe=x[ie];pe!==void 0&&(pe.update(K.inputSource,K.frame,l||s),pe.dispatchEvent({type:K.type,data:K.inputSource}))}function W(){i.removeEventListener("select",k),i.removeEventListener("selectstart",k),i.removeEventListener("selectend",k),i.removeEventListener("squeeze",k),i.removeEventListener("squeezestart",k),i.removeEventListener("squeezeend",k),i.removeEventListener("end",W),i.removeEventListener("inputsourceschange",N);for(let K=0;K<x.length;K++){const ie=_[K];ie!==null&&(_[K]=null,x[K].disconnect(ie))}A=null,P=null,e.setRenderTarget(g),d=null,f=null,h=null,i=null,m=null,Q.stop(),r.isPresenting=!1,e.setPixelRatio(S),e.setSize(b.width,b.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(K){o=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(K){a=K,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(K){l=K},this.getBaseLayer=function(){return f!==null?f:d},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(K){if(i=K,i!==null){if(g=e.getRenderTarget(),i.addEventListener("select",k),i.addEventListener("selectstart",k),i.addEventListener("selectend",k),i.addEventListener("squeeze",k),i.addEventListener("squeezestart",k),i.addEventListener("squeezeend",k),i.addEventListener("end",W),i.addEventListener("inputsourceschange",N),v.xrCompatible!==!0&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(b),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const ie={antialias:i.renderState.layers===void 0?v.antialias:!0,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:o};d=new XRWebGLLayer(i,t,ie),i.updateRenderState({baseLayer:d}),e.setPixelRatio(1),e.setSize(d.framebufferWidth,d.framebufferHeight,!1),m=new oi(d.framebufferWidth,d.framebufferHeight,{format:eo,type:ro,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil})}else{let ie=null,pe=null,we=null;v.depth&&(we=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ie=v.stencil?Hh:Ih,pe=v.stencil?sc:il);const ce={colorFormat:t.RGBA8,depthFormat:we,scaleFactor:o};h=new XRWebGLBinding(i,t),f=h.createProjectionLayer(ce),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),m=new oi(f.textureWidth,f.textureHeight,{format:eo,type:ro,depthTexture:new V1(f.textureWidth,f.textureHeight,pe,void 0,void 0,void 0,void 0,void 0,void 0,ie),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0});const _e=e.properties.get(m);_e.__ignoreDepthValues=f.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(u),l=null,s=await i.requestReferenceSpace(a),Q.setContext(i),Q.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function N(K){for(let ie=0;ie<K.removed.length;ie++){const pe=K.removed[ie],we=_.indexOf(pe);we>=0&&(_[we]=null,x[we].disconnect(pe))}for(let ie=0;ie<K.added.length;ie++){const pe=K.added[ie];let we=_.indexOf(pe);if(we===-1){for(let _e=0;_e<x.length;_e++)if(_e>=_.length){_.push(pe),we=_e;break}else if(_[_e]===null){_[_e]=pe,we=_e;break}if(we===-1)break}const ce=x[we];ce&&ce.connect(pe)}}const O=new ne,z=new ne;function V(K,ie,pe){O.setFromMatrixPosition(ie.matrixWorld),z.setFromMatrixPosition(pe.matrixWorld);const we=O.distanceTo(z),ce=ie.projectionMatrix.elements,_e=pe.projectionMatrix.elements,Oe=ce[14]/(ce[10]-1),Ve=ce[14]/(ce[10]+1),Ne=(ce[9]+1)/ce[5],Z=(ce[9]-1)/ce[5],de=(ce[8]-1)/ce[0],me=(_e[8]+1)/_e[0],Ie=Oe*de,xe=Oe*me,se=we/(-de+me),Xe=se*-de;ie.matrixWorld.decompose(K.position,K.quaternion,K.scale),K.translateX(Xe),K.translateZ(se),K.matrixWorld.compose(K.position,K.quaternion,K.scale),K.matrixWorldInverse.copy(K.matrixWorld).invert();const X=Oe+se,$=Ve+se,le=Ie-Xe,ze=xe+(we-Xe),Te=Ne*Ve/$*X,J=Z*Ve/$*X;K.projectionMatrix.makePerspective(le,ze,Te,J,X,$),K.projectionMatrixInverse.copy(K.projectionMatrix).invert()}function F(K,ie){ie===null?K.matrixWorld.copy(K.matrix):K.matrixWorld.multiplyMatrices(ie.matrixWorld,K.matrix),K.matrixWorldInverse.copy(K.matrixWorld).invert()}this.updateCamera=function(K){if(i===null)return;T.near=C.near=E.near=K.near,T.far=C.far=E.far=K.far,(A!==T.near||P!==T.far)&&(i.updateRenderState({depthNear:T.near,depthFar:T.far}),A=T.near,P=T.far);const ie=K.parent,pe=T.cameras;F(T,ie);for(let we=0;we<pe.length;we++)F(pe[we],ie);pe.length===2?V(T,E,C):T.projectionMatrix.copy(E.projectionMatrix),U(K,T,ie)};function U(K,ie,pe){pe===null?K.matrix.copy(ie.matrixWorld):(K.matrix.copy(pe.matrixWorld),K.matrix.invert(),K.matrix.multiply(ie.matrixWorld)),K.matrix.decompose(K.position,K.quaternion,K.scale),K.updateMatrixWorld(!0),K.projectionMatrix.copy(ie.projectionMatrix),K.projectionMatrixInverse.copy(ie.projectionMatrixInverse),K.isPerspectiveCamera&&(K.fov=Lv*2*Math.atan(1/K.projectionMatrix.elements[5]),K.zoom=1)}this.getCamera=function(){return T},this.getFoveation=function(){if(!(f===null&&d===null))return u},this.setFoveation=function(K){u=K,f!==null&&(f.fixedFoveation=K),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=K)};let L=null;function j(K,ie){if(c=ie.getViewerPose(l||s),p=ie,c!==null){const pe=c.views;d!==null&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));let we=!1;pe.length!==T.cameras.length&&(T.cameras.length=0,we=!0);for(let ce=0;ce<pe.length;ce++){const _e=pe[ce];let Oe=null;if(d!==null)Oe=d.getViewport(_e);else{const Ne=h.getViewSubImage(f,_e);Oe=Ne.viewport,ce===0&&(e.setRenderTargetTextures(m,Ne.colorTexture,f.ignoreDepthValues?void 0:Ne.depthStencilTexture),e.setRenderTarget(m))}let Ve=R[ce];Ve===void 0&&(Ve=new Si,Ve.layers.enable(ce),Ve.viewport=new On,R[ce]=Ve),Ve.matrix.fromArray(_e.transform.matrix),Ve.matrix.decompose(Ve.position,Ve.quaternion,Ve.scale),Ve.projectionMatrix.fromArray(_e.projectionMatrix),Ve.projectionMatrixInverse.copy(Ve.projectionMatrix).invert(),Ve.viewport.set(Oe.x,Oe.y,Oe.width,Oe.height),ce===0&&(T.matrix.copy(Ve.matrix),T.matrix.decompose(T.position,T.quaternion,T.scale)),we===!0&&T.cameras.push(Ve)}}for(let pe=0;pe<x.length;pe++){const we=_[pe],ce=x[pe];we!==null&&ce!==void 0&&ce.update(we,ie,l||s)}L&&L(K,ie),ie.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ie}),p=null}const Q=new M9;Q.setAnimationLoop(j),this.setAnimationLoop=function(K){L=K},this.dispose=function(){}}}function Eue(n,e){function t(g,m){g.matrixAutoUpdate===!0&&g.updateMatrix(),m.value.copy(g.matrix)}function r(g,m){m.color.getRGB(g.fogColor.value,S9(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function i(g,m,x,_,b){m.isMeshBasicMaterial||m.isMeshLambertMaterial?o(g,m):m.isMeshToonMaterial?(o(g,m),h(g,m)):m.isMeshPhongMaterial?(o(g,m),c(g,m)):m.isMeshStandardMaterial?(o(g,m),f(g,m),m.isMeshPhysicalMaterial&&d(g,m,b)):m.isMeshMatcapMaterial?(o(g,m),p(g,m)):m.isMeshDepthMaterial?o(g,m):m.isMeshDistanceMaterial?(o(g,m),v(g,m)):m.isMeshNormalMaterial?o(g,m):m.isLineBasicMaterial?(s(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?u(g,m,x,_):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function o(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.bumpMap&&(g.bumpMap.value=m.bumpMap,t(m.bumpMap,g.bumpMapTransform),g.bumpScale.value=m.bumpScale,m.side===Mi&&(g.bumpScale.value*=-1)),m.normalMap&&(g.normalMap.value=m.normalMap,t(m.normalMap,g.normalMapTransform),g.normalScale.value.copy(m.normalScale),m.side===Mi&&g.normalScale.value.negate()),m.displacementMap&&(g.displacementMap.value=m.displacementMap,t(m.displacementMap,g.displacementMapTransform),g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap,t(m.emissiveMap,g.emissiveMapTransform)),m.specularMap&&(g.specularMap.value=m.specularMap,t(m.specularMap,g.specularMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const x=e.get(m).envMap;if(x&&(g.envMap.value=x,g.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;const _=n._useLegacyLights===!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*_,t(m.lightMap,g.lightMapTransform)}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity,t(m.aoMap,g.aoMapTransform))}function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform))}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function u(g,m,x,_){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*x,g.scale.value=_*.5,m.map&&(g.map.value=m.map,t(m.map,g.uvTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map,t(m.map,g.mapTransform)),m.alphaMap&&(g.alphaMap.value=m.alphaMap,t(m.alphaMap,g.alphaMapTransform)),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest)}function c(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function h(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function f(g,m){g.metalness.value=m.metalness,m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap,t(m.metalnessMap,g.metalnessMapTransform)),g.roughness.value=m.roughness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap,t(m.roughnessMap,g.roughnessMapTransform)),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,x){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap,t(m.sheenColorMap,g.sheenColorMapTransform)),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap,t(m.sheenRoughnessMap,g.sheenRoughnessMapTransform))),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap,t(m.clearcoatMap,g.clearcoatMapTransform)),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap,t(m.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),m.clearcoatNormalMap&&(g.clearcoatNormalMap.value=m.clearcoatNormalMap,t(m.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),m.side===Mi&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap,t(m.iridescenceMap,g.iridescenceMapTransform)),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap,t(m.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=x.texture,g.transmissionSamplerSize.value.set(x.width,x.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap,t(m.transmissionMap,g.transmissionMapTransform)),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap,t(m.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),m.anisotropy>0&&(g.anisotropyVector.value.set(m.anisotropy*Math.cos(m.anisotropyRotation),m.anisotropy*Math.sin(m.anisotropyRotation)),m.anisotropyMap&&(g.anisotropyMap.value=m.anisotropyMap,t(m.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap,t(m.specularColorMap,g.specularColorMapTransform)),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap,t(m.specularIntensityMap,g.specularIntensityMapTransform))}function p(g,m){m.matcap&&(g.matcap.value=m.matcap)}function v(g,m){const x=e.get(m).light;g.referencePosition.value.setFromMatrixPosition(x.matrixWorld),g.nearDistance.value=x.shadow.camera.near,g.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Cue(n,e,t,r){let i={},o={},s=[];const a=t.isWebGL2?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0;function u(x,_){const b=_.program;r.uniformBlockBinding(x,b)}function l(x,_){let b=i[x.id];b===void 0&&(p(x),b=c(x),i[x.id]=b,x.addEventListener("dispose",g));const S=_.program;r.updateUBOMapping(x,S);const E=e.render.frame;o[x.id]!==E&&(f(x),o[x.id]=E)}function c(x){const _=h();x.__bindingPointIndex=_;const b=n.createBuffer(),S=x.__size,E=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,b),n.bufferData(n.UNIFORM_BUFFER,S,E),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,_,b),b}function h(){for(let x=0;x<a;x++)if(s.indexOf(x)===-1)return s.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(x){const _=i[x.id],b=x.uniforms,S=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,_);for(let E=0,C=b.length;E<C;E++){const R=Array.isArray(b[E])?b[E]:[b[E]];for(let T=0,A=R.length;T<A;T++){const P=R[T];if(d(P,E,T,S)===!0){const k=P.__offset,W=Array.isArray(P.value)?P.value:[P.value];let N=0;for(let O=0;O<W.length;O++){const z=W[O],V=v(z);typeof z=="number"||typeof z=="boolean"?(P.__data[0]=z,n.bufferSubData(n.UNIFORM_BUFFER,k+N,P.__data)):z.isMatrix3?(P.__data[0]=z.elements[0],P.__data[1]=z.elements[1],P.__data[2]=z.elements[2],P.__data[3]=0,P.__data[4]=z.elements[3],P.__data[5]=z.elements[4],P.__data[6]=z.elements[5],P.__data[7]=0,P.__data[8]=z.elements[6],P.__data[9]=z.elements[7],P.__data[10]=z.elements[8],P.__data[11]=0):(z.toArray(P.__data,N),N+=V.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,k,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function d(x,_,b,S){const E=x.value,C=_+"_"+b;if(S[C]===void 0)return typeof E=="number"||typeof E=="boolean"?S[C]=E:S[C]=E.clone(),!0;{const R=S[C];if(typeof E=="number"||typeof E=="boolean"){if(R!==E)return S[C]=E,!0}else if(R.equals(E)===!1)return R.copy(E),!0}return!1}function p(x){const _=x.uniforms;let b=0;const S=16;for(let C=0,R=_.length;C<R;C++){const T=Array.isArray(_[C])?_[C]:[_[C]];for(let A=0,P=T.length;A<P;A++){const k=T[A],W=Array.isArray(k.value)?k.value:[k.value];for(let N=0,O=W.length;N<O;N++){const z=W[N],V=v(z),F=b%S;F!==0&&S-F<V.boundary&&(b+=S-F),k.__data=new Float32Array(V.storage/Float32Array.BYTES_PER_ELEMENT),k.__offset=b,b+=V.storage}}}const E=b%S;return E>0&&(b+=S-E),x.__size=b,x.__cache={},this}function v(x){const _={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(_.boundary=4,_.storage=4):x.isVector2?(_.boundary=8,_.storage=8):x.isVector3||x.isColor?(_.boundary=16,_.storage=12):x.isVector4?(_.boundary=16,_.storage=16):x.isMatrix3?(_.boundary=48,_.storage=48):x.isMatrix4?(_.boundary=64,_.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),_}function g(x){const _=x.target;_.removeEventListener("dispose",g);const b=s.indexOf(_.__bindingPointIndex);s.splice(b,1),n.deleteBuffer(i[_.id]),delete i[_.id],delete o[_.id]}function m(){for(const x in i)n.deleteBuffer(i[x]);s=[],i={},o={}}return{bind:u,update:l,dispose:m}}class hg{constructor(e={}){const{canvas:t=x9(),context:r=null,depth:i=!0,stencil:o=!0,alpha:s=!1,antialias:a=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1}=e;this.isWebGLRenderer=!0;let f;r!==null?f=r.getContextAttributes().alpha:f=s;const d=new Uint32Array(4),p=new Int32Array(4);let v=null,g=null;const m=[],x=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Rn,this._useLegacyLights=!1,this.toneMapping=wu,this.toneMappingExposure=1;const _=this;let b=!1,S=0,E=0,C=null,R=-1,T=null;const A=new On,P=new On;let k=null;const W=new ct(0);let N=0,O=t.width,z=t.height,V=1,F=null,U=null;const L=new On(0,0,O,z),j=new On(0,0,O,z);let Q=!1;const K=new z1;let ie=!1,pe=!1,we=null;const ce=new tn,_e=new De,Oe=new ne,Ve={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ne(){return C===null?V:1}let Z=r;function de(q,ge){for(let Re=0;Re<q.length;Re++){const Me=q[Re],Ee=t.getContext(Me,ge);if(Ee!==null)return Ee}return null}try{const q={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:u,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${sg}`),t.addEventListener("webglcontextlost",Ye,!1),t.addEventListener("webglcontextrestored",ae,!1),t.addEventListener("webglcontextcreationerror",Ze,!1),Z===null){const ge=["webgl2","webgl","experimental-webgl"];if(_.isWebGL1Renderer===!0&&ge.shift(),Z=de(ge,q),Z===null)throw de(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&Z instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),Z.getShaderPrecisionFormat===void 0&&(Z.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}let me,Ie,xe,se,Xe,X,$,le,ze,Te,J,be,ke,He,Ue,We,Le,yt,rt,dt,ot,Je,Wt,jt;function yn(){me=new Use(Z),Ie=new Dse(Z,me,e),me.init(Ie),Je=new k9(Z,me,Ie),xe=new wue(Z,me,Ie),se=new Wse(Z),Xe=new uue,X=new _ue(Z,me,xe,Xe,Ie,Je,se),$=new Lse(_),le=new Bse(_),ze=new Kre(Z,Ie),Wt=new Pse(Z,me,ze,Ie),Te=new zse(Z,ze,se,Wt),J=new jse(Z,Te,ze,se),rt=new $se(Z,Ie,X),We=new Nse(Xe),be=new aue(_,$,le,me,Ie,Wt,We),ke=new Eue(_,Xe),He=new cue,Ue=new vue(me,Ie),yt=new Ise(_,$,le,xe,J,f,u),Le=new xue(_,J,Ie),jt=new Cue(Z,se,Ie,xe),dt=new kse(Z,me,se,Ie),ot=new Vse(Z,me,se,Ie),se.programs=be.programs,_.capabilities=Ie,_.extensions=me,_.properties=Xe,_.renderLists=He,_.shadowMap=Le,_.state=xe,_.info=se}yn();const nt=new Sue(_,Z);this.xr=nt,this.getContext=function(){return Z},this.getContextAttributes=function(){return Z.getContextAttributes()},this.forceContextLoss=function(){const q=me.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){const q=me.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(q){q!==void 0&&(V=q,this.setSize(O,z,!1))},this.getSize=function(q){return q.set(O,z)},this.setSize=function(q,ge,Re=!0){if(nt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}O=q,z=ge,t.width=Math.floor(q*V),t.height=Math.floor(ge*V),Re===!0&&(t.style.width=q+"px",t.style.height=ge+"px"),this.setViewport(0,0,q,ge)},this.getDrawingBufferSize=function(q){return q.set(O*V,z*V).floor()},this.setDrawingBufferSize=function(q,ge,Re){O=q,z=ge,V=Re,t.width=Math.floor(q*Re),t.height=Math.floor(ge*Re),this.setViewport(0,0,q,ge)},this.getCurrentViewport=function(q){return q.copy(A)},this.getViewport=function(q){return q.copy(L)},this.setViewport=function(q,ge,Re,Me){q.isVector4?L.set(q.x,q.y,q.z,q.w):L.set(q,ge,Re,Me),xe.viewport(A.copy(L).multiplyScalar(V).floor())},this.getScissor=function(q){return q.copy(j)},this.setScissor=function(q,ge,Re,Me){q.isVector4?j.set(q.x,q.y,q.z,q.w):j.set(q,ge,Re,Me),xe.scissor(P.copy(j).multiplyScalar(V).floor())},this.getScissorTest=function(){return Q},this.setScissorTest=function(q){xe.setScissorTest(Q=q)},this.setOpaqueSort=function(q){F=q},this.setTransparentSort=function(q){U=q},this.getClearColor=function(q){return q.copy(yt.getClearColor())},this.setClearColor=function(){yt.setClearColor.apply(yt,arguments)},this.getClearAlpha=function(){return yt.getClearAlpha()},this.setClearAlpha=function(){yt.setClearAlpha.apply(yt,arguments)},this.clear=function(q=!0,ge=!0,Re=!0){let Me=0;if(q){let Ee=!1;if(C!==null){const it=C.texture.format;Ee=it===OP||it===FP||it===LP}if(Ee){const it=C.texture.type,xt=it===ro||it===il||it===QS||it===sc||it===DP||it===NP,Ht=yt.getClearColor(),vt=yt.getClearAlpha(),wt=Ht.r,Ut=Ht.g,Yt=Ht.b;xt?(d[0]=wt,d[1]=Ut,d[2]=Yt,d[3]=vt,Z.clearBufferuiv(Z.COLOR,0,d)):(p[0]=wt,p[1]=Ut,p[2]=Yt,p[3]=vt,Z.clearBufferiv(Z.COLOR,0,p))}else Me|=Z.COLOR_BUFFER_BIT}ge&&(Me|=Z.DEPTH_BUFFER_BIT),Re&&(Me|=Z.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Z.clear(Me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ye,!1),t.removeEventListener("webglcontextrestored",ae,!1),t.removeEventListener("webglcontextcreationerror",Ze,!1),He.dispose(),Ue.dispose(),Xe.dispose(),$.dispose(),le.dispose(),J.dispose(),Wt.dispose(),jt.dispose(),be.dispose(),nt.dispose(),nt.removeEventListener("sessionstart",ft),nt.removeEventListener("sessionend",Mt),we&&(we.dispose(),we=null),Ke.stop()};function Ye(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function ae(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const q=se.autoReset,ge=Le.enabled,Re=Le.autoUpdate,Me=Le.needsUpdate,Ee=Le.type;yn(),se.autoReset=q,Le.enabled=ge,Le.autoUpdate=Re,Le.needsUpdate=Me,Le.type=Ee}function Ze(q){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",q.statusMessage)}function et(q){const ge=q.target;ge.removeEventListener("dispose",et),Nt(ge)}function Nt(q){Tt(q),Xe.remove(q)}function Tt(q){const ge=Xe.get(q).programs;ge!==void 0&&(ge.forEach(function(Re){be.releaseProgram(Re)}),q.isShaderMaterial&&be.releaseShaderCache(q))}this.renderBufferDirect=function(q,ge,Re,Me,Ee,it){ge===null&&(ge=Ve);const xt=Ee.isMesh&&Ee.matrixWorld.determinant()<0,Ht=Yn(q,ge,Re,Me,Ee);xe.setMaterial(Me,xt);let vt=Re.index,wt=1;if(Me.wireframe===!0){if(vt=Te.getWireframeAttribute(Re),vt===void 0)return;wt=2}const Ut=Re.drawRange,Yt=Re.attributes.position;let ar=Ut.start*wt,Er=(Ut.start+Ut.count)*wt;it!==null&&(ar=Math.max(ar,it.start*wt),Er=Math.min(Er,(it.start+it.count)*wt)),vt!==null?(ar=Math.max(ar,0),Er=Math.min(Er,vt.count)):Yt!=null&&(ar=Math.max(ar,0),Er=Math.min(Er,Yt.count));const Mn=Er-ar;if(Mn<0||Mn===1/0)return;Wt.setup(Ee,Me,Ht,Re,vt);let xr,$t=dt;if(vt!==null&&(xr=ze.get(vt),$t=ot,$t.setIndex(xr)),Ee.isMesh)Me.wireframe===!0?(xe.setLineWidth(Me.wireframeLinewidth*Ne()),$t.setMode(Z.LINES)):$t.setMode(Z.TRIANGLES);else if(Ee.isLine){let ut=Me.linewidth;ut===void 0&&(ut=1),xe.setLineWidth(ut*Ne()),Ee.isLineSegments?$t.setMode(Z.LINES):Ee.isLineLoop?$t.setMode(Z.LINE_LOOP):$t.setMode(Z.LINE_STRIP)}else Ee.isPoints?$t.setMode(Z.POINTS):Ee.isSprite&&$t.setMode(Z.TRIANGLES);if(Ee.isBatchedMesh)$t.renderMultiDraw(Ee._multiDrawStarts,Ee._multiDrawCounts,Ee._multiDrawCount);else if(Ee.isInstancedMesh)$t.renderInstances(ar,Mn,Ee.count);else if(Re.isInstancedBufferGeometry){const ut=Re._maxInstanceCount!==void 0?Re._maxInstanceCount:1/0,ma=Math.min(Re.instanceCount,ut);$t.renderInstances(ar,Mn,ma)}else $t.render(ar,Mn)};function hn(q,ge,Re){q.transparent===!0&&q.side===jo&&q.forceSinglePass===!1?(q.side=Mi,q.needsUpdate=!0,qn(q,ge,Re),q.side=yl,q.needsUpdate=!0,qn(q,ge,Re),q.side=jo):qn(q,ge,Re)}this.compile=function(q,ge,Re=null){Re===null&&(Re=q),g=Ue.get(Re),g.init(),x.push(g),Re.traverseVisible(function(Ee){Ee.isLight&&Ee.layers.test(ge.layers)&&(g.pushLight(Ee),Ee.castShadow&&g.pushShadow(Ee))}),q!==Re&&q.traverseVisible(function(Ee){Ee.isLight&&Ee.layers.test(ge.layers)&&(g.pushLight(Ee),Ee.castShadow&&g.pushShadow(Ee))}),g.setupLights(_._useLegacyLights);const Me=new Set;return q.traverse(function(Ee){const it=Ee.material;if(it)if(Array.isArray(it))for(let xt=0;xt<it.length;xt++){const Ht=it[xt];hn(Ht,Re,Ee),Me.add(Ht)}else hn(it,Re,Ee),Me.add(it)}),x.pop(),g=null,Me},this.compileAsync=function(q,ge,Re=null){const Me=this.compile(q,ge,Re);return new Promise(Ee=>{function it(){if(Me.forEach(function(xt){Xe.get(xt).currentProgram.isReady()&&Me.delete(xt)}),Me.size===0){Ee(q);return}setTimeout(it,10)}me.get("KHR_parallel_shader_compile")!==null?it():setTimeout(it,10)})};let Sn=null;function mt(q){Sn&&Sn(q)}function ft(){Ke.stop()}function Mt(){Ke.start()}const Ke=new M9;Ke.setAnimationLoop(mt),typeof self<"u"&&Ke.setContext(self),this.setAnimationLoop=function(q){Sn=q,nt.setAnimationLoop(q),q===null?Ke.stop():Ke.start()},nt.addEventListener("sessionstart",ft),nt.addEventListener("sessionend",Mt),this.render=function(q,ge){if(ge!==void 0&&ge.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),ge.parent===null&&ge.matrixWorldAutoUpdate===!0&&ge.updateMatrixWorld(),nt.enabled===!0&&nt.isPresenting===!0&&(nt.cameraAutoUpdate===!0&&nt.updateCamera(ge),ge=nt.getCamera()),q.isScene===!0&&q.onBeforeRender(_,q,ge,C),g=Ue.get(q,x.length),g.init(),x.push(g),ce.multiplyMatrices(ge.projectionMatrix,ge.matrixWorldInverse),K.setFromProjectionMatrix(ce),pe=this.localClippingEnabled,ie=We.init(this.clippingPlanes,pe),v=He.get(q,m.length),v.init(),m.push(v),Rt(q,ge,0,_.sortObjects),v.finish(),_.sortObjects===!0&&v.sort(F,U),this.info.render.frame++,ie===!0&&We.beginShadows();const Re=g.state.shadowsArray;if(Le.render(Re,q,ge),ie===!0&&We.endShadows(),this.info.autoReset===!0&&this.info.reset(),yt.render(v,q),g.setupLights(_._useLegacyLights),ge.isArrayCamera){const Me=ge.cameras;for(let Ee=0,it=Me.length;Ee<it;Ee++){const xt=Me[Ee];It(v,q,xt,xt.viewport)}}else It(v,q,ge);C!==null&&(X.updateMultisampleRenderTarget(C),X.updateRenderTargetMipmap(C)),q.isScene===!0&&q.onAfterRender(_,q,ge),Wt.resetDefaultState(),R=-1,T=null,x.pop(),x.length>0?g=x[x.length-1]:g=null,m.pop(),m.length>0?v=m[m.length-1]:v=null};function Rt(q,ge,Re,Me){if(q.visible===!1)return;if(q.layers.test(ge.layers)){if(q.isGroup)Re=q.renderOrder;else if(q.isLOD)q.autoUpdate===!0&&q.update(ge);else if(q.isLight)g.pushLight(q),q.castShadow&&g.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||K.intersectsSprite(q)){Me&&Oe.setFromMatrixPosition(q.matrixWorld).applyMatrix4(ce);const xt=J.update(q),Ht=q.material;Ht.visible&&v.push(q,xt,Ht,Re,Oe.z,null)}}else if((q.isMesh||q.isLine||q.isPoints)&&(!q.frustumCulled||K.intersectsObject(q))){const xt=J.update(q),Ht=q.material;if(Me&&(q.boundingSphere!==void 0?(q.boundingSphere===null&&q.computeBoundingSphere(),Oe.copy(q.boundingSphere.center)):(xt.boundingSphere===null&&xt.computeBoundingSphere(),Oe.copy(xt.boundingSphere.center)),Oe.applyMatrix4(q.matrixWorld).applyMatrix4(ce)),Array.isArray(Ht)){const vt=xt.groups;for(let wt=0,Ut=vt.length;wt<Ut;wt++){const Yt=vt[wt],ar=Ht[Yt.materialIndex];ar&&ar.visible&&v.push(q,xt,ar,Re,Oe.z,Yt)}}else Ht.visible&&v.push(q,xt,Ht,Re,Oe.z,null)}}const it=q.children;for(let xt=0,Ht=it.length;xt<Ht;xt++)Rt(it[xt],ge,Re,Me)}function It(q,ge,Re,Me){const Ee=q.opaque,it=q.transmissive,xt=q.transparent;g.setupLightsView(Re),ie===!0&&We.setGlobalState(_.clippingPlanes,Re),it.length>0&&Gt(Ee,it,ge,Re),Me&&xe.viewport(A.copy(Me)),Ee.length>0&&tr(Ee,ge,Re),it.length>0&&tr(it,ge,Re),xt.length>0&&tr(xt,ge,Re),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function Gt(q,ge,Re,Me){if((Re.isScene===!0?Re.overrideMaterial:null)!==null)return;const it=Ie.isWebGL2;we===null&&(we=new oi(1,1,{generateMipmaps:!0,type:me.has("EXT_color_buffer_half_float")?Wh:ro,minFilter:Vh,samples:it?4:0})),_.getDrawingBufferSize(_e),it?we.setSize(_e.x,_e.y):we.setSize(Cb(_e.x),Cb(_e.y));const xt=_.getRenderTarget();_.setRenderTarget(we),_.getClearColor(W),N=_.getClearAlpha(),N<1&&_.setClearColor(16777215,.5),_.clear();const Ht=_.toneMapping;_.toneMapping=wu,tr(q,Re,Me),X.updateMultisampleRenderTarget(we),X.updateRenderTargetMipmap(we);let vt=!1;for(let wt=0,Ut=ge.length;wt<Ut;wt++){const Yt=ge[wt],ar=Yt.object,Er=Yt.geometry,Mn=Yt.material,xr=Yt.group;if(Mn.side===jo&&ar.layers.test(Me.layers)){const $t=Mn.side;Mn.side=Mi,Mn.needsUpdate=!0,qt(ar,Re,Me,Er,Mn,xr),Mn.side=$t,Mn.needsUpdate=!0,vt=!0}}vt===!0&&(X.updateMultisampleRenderTarget(we),X.updateRenderTargetMipmap(we)),_.setRenderTarget(xt),_.setClearColor(W,N),_.toneMapping=Ht}function tr(q,ge,Re){const Me=ge.isScene===!0?ge.overrideMaterial:null;for(let Ee=0,it=q.length;Ee<it;Ee++){const xt=q[Ee],Ht=xt.object,vt=xt.geometry,wt=Me===null?xt.material:Me,Ut=xt.group;Ht.layers.test(Re.layers)&&qt(Ht,ge,Re,vt,wt,Ut)}}function qt(q,ge,Re,Me,Ee,it){q.onBeforeRender(_,ge,Re,Me,Ee,it),q.modelViewMatrix.multiplyMatrices(Re.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),Ee.onBeforeRender(_,ge,Re,Me,q,it),Ee.transparent===!0&&Ee.side===jo&&Ee.forceSinglePass===!1?(Ee.side=Mi,Ee.needsUpdate=!0,_.renderBufferDirect(Re,ge,Me,Ee,q,it),Ee.side=yl,Ee.needsUpdate=!0,_.renderBufferDirect(Re,ge,Me,Ee,q,it),Ee.side=jo):_.renderBufferDirect(Re,ge,Me,Ee,q,it),q.onAfterRender(_,ge,Re,Me,Ee,it)}function qn(q,ge,Re){ge.isScene!==!0&&(ge=Ve);const Me=Xe.get(q),Ee=g.state.lights,it=g.state.shadowsArray,xt=Ee.state.version,Ht=be.getParameters(q,Ee.state,it,ge,Re),vt=be.getProgramCacheKey(Ht);let wt=Me.programs;Me.environment=q.isMeshStandardMaterial?ge.environment:null,Me.fog=ge.fog,Me.envMap=(q.isMeshStandardMaterial?le:$).get(q.envMap||Me.environment),wt===void 0&&(q.addEventListener("dispose",et),wt=new Map,Me.programs=wt);let Ut=wt.get(vt);if(Ut!==void 0){if(Me.currentProgram===Ut&&Me.lightsStateVersion===xt)return Qn(q,Ht),Ut}else Ht.uniforms=be.getUniforms(q),q.onBuild(Re,Ht,_),q.onBeforeCompile(Ht,_),Ut=be.acquireProgram(Ht,vt),wt.set(vt,Ut),Me.uniforms=Ht.uniforms;const Yt=Me.uniforms;return(!q.isShaderMaterial&&!q.isRawShaderMaterial||q.clipping===!0)&&(Yt.clippingPlanes=We.uniform),Qn(q,Ht),Me.needsLights=mi(q),Me.lightsStateVersion=xt,Me.needsLights&&(Yt.ambientLightColor.value=Ee.state.ambient,Yt.lightProbe.value=Ee.state.probe,Yt.directionalLights.value=Ee.state.directional,Yt.directionalLightShadows.value=Ee.state.directionalShadow,Yt.spotLights.value=Ee.state.spot,Yt.spotLightShadows.value=Ee.state.spotShadow,Yt.rectAreaLights.value=Ee.state.rectArea,Yt.ltc_1.value=Ee.state.rectAreaLTC1,Yt.ltc_2.value=Ee.state.rectAreaLTC2,Yt.pointLights.value=Ee.state.point,Yt.pointLightShadows.value=Ee.state.pointShadow,Yt.hemisphereLights.value=Ee.state.hemi,Yt.directionalShadowMap.value=Ee.state.directionalShadowMap,Yt.directionalShadowMatrix.value=Ee.state.directionalShadowMatrix,Yt.spotShadowMap.value=Ee.state.spotShadowMap,Yt.spotLightMatrix.value=Ee.state.spotLightMatrix,Yt.spotLightMap.value=Ee.state.spotLightMap,Yt.pointShadowMap.value=Ee.state.pointShadowMap,Yt.pointShadowMatrix.value=Ee.state.pointShadowMatrix),Me.currentProgram=Ut,Me.uniformsList=null,Ut}function Sr(q){if(q.uniformsList===null){const ge=q.currentProgram.getUniforms();q.uniformsList=D_.seqWithValue(ge.seq,q.uniforms)}return q.uniformsList}function Qn(q,ge){const Re=Xe.get(q);Re.outputColorSpace=ge.outputColorSpace,Re.batching=ge.batching,Re.instancing=ge.instancing,Re.instancingColor=ge.instancingColor,Re.skinning=ge.skinning,Re.morphTargets=ge.morphTargets,Re.morphNormals=ge.morphNormals,Re.morphColors=ge.morphColors,Re.morphTargetsCount=ge.morphTargetsCount,Re.numClippingPlanes=ge.numClippingPlanes,Re.numIntersection=ge.numClipIntersection,Re.vertexAlphas=ge.vertexAlphas,Re.vertexTangents=ge.vertexTangents,Re.toneMapping=ge.toneMapping}function Yn(q,ge,Re,Me,Ee){ge.isScene!==!0&&(ge=Ve),X.resetTextureUnits();const it=ge.fog,xt=Me.isMeshStandardMaterial?ge.environment:null,Ht=C===null?_.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:$a,vt=(Me.isMeshStandardMaterial?le:$).get(Me.envMap||xt),wt=Me.vertexColors===!0&&!!Re.attributes.color&&Re.attributes.color.itemSize===4,Ut=!!Re.attributes.tangent&&(!!Me.normalMap||Me.anisotropy>0),Yt=!!Re.morphAttributes.position,ar=!!Re.morphAttributes.normal,Er=!!Re.morphAttributes.color;let Mn=wu;Me.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(Mn=_.toneMapping);const xr=Re.morphAttributes.position||Re.morphAttributes.normal||Re.morphAttributes.color,$t=xr!==void 0?xr.length:0,ut=Xe.get(Me),ma=g.state.lights;if(ie===!0&&(pe===!0||q!==T)){const ji=q===T&&Me.id===R;We.setState(Me,q,ji)}let mn=!1;Me.version===ut.__version?(ut.needsLights&&ut.lightsStateVersion!==ma.state.version||ut.outputColorSpace!==Ht||Ee.isBatchedMesh&&ut.batching===!1||!Ee.isBatchedMesh&&ut.batching===!0||Ee.isInstancedMesh&&ut.instancing===!1||!Ee.isInstancedMesh&&ut.instancing===!0||Ee.isSkinnedMesh&&ut.skinning===!1||!Ee.isSkinnedMesh&&ut.skinning===!0||Ee.isInstancedMesh&&ut.instancingColor===!0&&Ee.instanceColor===null||Ee.isInstancedMesh&&ut.instancingColor===!1&&Ee.instanceColor!==null||ut.envMap!==vt||Me.fog===!0&&ut.fog!==it||ut.numClippingPlanes!==void 0&&(ut.numClippingPlanes!==We.numPlanes||ut.numIntersection!==We.numIntersection)||ut.vertexAlphas!==wt||ut.vertexTangents!==Ut||ut.morphTargets!==Yt||ut.morphNormals!==ar||ut.morphColors!==Er||ut.toneMapping!==Mn||Ie.isWebGL2===!0&&ut.morphTargetsCount!==$t)&&(mn=!0):(mn=!0,ut.__version=Me.version);let Br=ut.currentProgram;mn===!0&&(Br=qn(Me,ge,Ee));let Lu=!1,va=!1,ki=!1;const Kr=Br.getUniforms(),Fu=ut.uniforms;if(xe.useProgram(Br.program)&&(Lu=!0,va=!0,ki=!0),Me.id!==R&&(R=Me.id,va=!0),Lu||T!==q){Kr.setValue(Z,"projectionMatrix",q.projectionMatrix),Kr.setValue(Z,"viewMatrix",q.matrixWorldInverse);const ji=Kr.map.cameraPosition;ji!==void 0&&ji.setValue(Z,Oe.setFromMatrixPosition(q.matrixWorld)),Ie.logarithmicDepthBuffer&&Kr.setValue(Z,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),(Me.isMeshPhongMaterial||Me.isMeshToonMaterial||Me.isMeshLambertMaterial||Me.isMeshBasicMaterial||Me.isMeshStandardMaterial||Me.isShaderMaterial)&&Kr.setValue(Z,"isOrthographic",q.isOrthographicCamera===!0),T!==q&&(T=q,va=!0,ki=!0)}if(Ee.isSkinnedMesh){Kr.setOptional(Z,Ee,"bindMatrix"),Kr.setOptional(Z,Ee,"bindMatrixInverse");const ji=Ee.skeleton;ji&&(Ie.floatVertexTextures?(ji.boneTexture===null&&ji.computeBoneTexture(),Kr.setValue(Z,"boneTexture",ji.boneTexture,X)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}Ee.isBatchedMesh&&(Kr.setOptional(Z,Ee,"batchingTexture"),Kr.setValue(Z,"batchingTexture",Ee._matricesTexture,X));const gp=Re.morphAttributes;if((gp.position!==void 0||gp.normal!==void 0||gp.color!==void 0&&Ie.isWebGL2===!0)&&rt.update(Ee,Re,Br),(va||ut.receiveShadow!==Ee.receiveShadow)&&(ut.receiveShadow=Ee.receiveShadow,Kr.setValue(Z,"receiveShadow",Ee.receiveShadow)),Me.isMeshGouraudMaterial&&Me.envMap!==null&&(Fu.envMap.value=vt,Fu.flipEnvMap.value=vt.isCubeTexture&&vt.isRenderTargetTexture===!1?-1:1),va&&(Kr.setValue(Z,"toneMappingExposure",_.toneMappingExposure),ut.needsLights&&Nn(Fu,ki),it&&Me.fog===!0&&ke.refreshFogUniforms(Fu,it),ke.refreshMaterialUniforms(Fu,Me,V,z,we),D_.upload(Z,Sr(ut),Fu,X)),Me.isShaderMaterial&&Me.uniformsNeedUpdate===!0&&(D_.upload(Z,Sr(ut),Fu,X),Me.uniformsNeedUpdate=!1),Me.isSpriteMaterial&&Kr.setValue(Z,"center",Ee.center),Kr.setValue(Z,"modelViewMatrix",Ee.modelViewMatrix),Kr.setValue(Z,"normalMatrix",Ee.normalMatrix),Kr.setValue(Z,"modelMatrix",Ee.matrixWorld),Me.isShaderMaterial||Me.isRawShaderMaterial){const ji=Me.uniformsGroups;for(let yp=0,Ds=ji.length;yp<Ds;yp++)if(Ie.isWebGL2){const bx=ji[yp];jt.update(bx,Br),jt.bind(bx,Br)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Br}function Nn(q,ge){q.ambientLightColor.needsUpdate=ge,q.lightProbe.needsUpdate=ge,q.directionalLights.needsUpdate=ge,q.directionalLightShadows.needsUpdate=ge,q.pointLights.needsUpdate=ge,q.pointLightShadows.needsUpdate=ge,q.spotLights.needsUpdate=ge,q.spotLightShadows.needsUpdate=ge,q.rectAreaLights.needsUpdate=ge,q.hemisphereLights.needsUpdate=ge}function mi(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&q.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(q,ge,Re){Xe.get(q.texture).__webglTexture=ge,Xe.get(q.depthTexture).__webglTexture=Re;const Me=Xe.get(q);Me.__hasExternalTextures=!0,Me.__hasExternalTextures&&(Me.__autoAllocateDepthBuffer=Re===void 0,Me.__autoAllocateDepthBuffer||me.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Me.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(q,ge){const Re=Xe.get(q);Re.__webglFramebuffer=ge,Re.__useDefaultFramebuffer=ge===void 0},this.setRenderTarget=function(q,ge=0,Re=0){C=q,S=ge,E=Re;let Me=!0,Ee=null,it=!1,xt=!1;if(q){const vt=Xe.get(q);vt.__useDefaultFramebuffer!==void 0?(xe.bindFramebuffer(Z.FRAMEBUFFER,null),Me=!1):vt.__webglFramebuffer===void 0?X.setupRenderTarget(q):vt.__hasExternalTextures&&X.rebindTextures(q,Xe.get(q.texture).__webglTexture,Xe.get(q.depthTexture).__webglTexture);const wt=q.texture;(wt.isData3DTexture||wt.isDataArrayTexture||wt.isCompressedArrayTexture)&&(xt=!0);const Ut=Xe.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(Array.isArray(Ut[ge])?Ee=Ut[ge][Re]:Ee=Ut[ge],it=!0):Ie.isWebGL2&&q.samples>0&&X.useMultisampledRTT(q)===!1?Ee=Xe.get(q).__webglMultisampledFramebuffer:Array.isArray(Ut)?Ee=Ut[Re]:Ee=Ut,A.copy(q.viewport),P.copy(q.scissor),k=q.scissorTest}else A.copy(L).multiplyScalar(V).floor(),P.copy(j).multiplyScalar(V).floor(),k=Q;if(xe.bindFramebuffer(Z.FRAMEBUFFER,Ee)&&Ie.drawBuffers&&Me&&xe.drawBuffers(q,Ee),xe.viewport(A),xe.scissor(P),xe.setScissorTest(k),it){const vt=Xe.get(q.texture);Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+ge,vt.__webglTexture,Re)}else if(xt){const vt=Xe.get(q.texture),wt=ge||0;Z.framebufferTextureLayer(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,vt.__webglTexture,Re||0,wt)}R=-1},this.readRenderTargetPixels=function(q,ge,Re,Me,Ee,it,xt){if(!(q&&q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ht=Xe.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&xt!==void 0&&(Ht=Ht[xt]),Ht){xe.bindFramebuffer(Z.FRAMEBUFFER,Ht);try{const vt=q.texture,wt=vt.format,Ut=vt.type;if(wt!==eo&&Je.convert(wt)!==Z.getParameter(Z.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Yt=Ut===Wh&&(me.has("EXT_color_buffer_half_float")||Ie.isWebGL2&&me.has("EXT_color_buffer_float"));if(Ut!==ro&&Je.convert(Ut)!==Z.getParameter(Z.IMPLEMENTATION_COLOR_READ_TYPE)&&!(Ut===vs&&(Ie.isWebGL2||me.has("OES_texture_float")||me.has("WEBGL_color_buffer_float")))&&!Yt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ge>=0&&ge<=q.width-Me&&Re>=0&&Re<=q.height-Ee&&Z.readPixels(ge,Re,Me,Ee,Je.convert(wt),Je.convert(Ut),it)}finally{const vt=C!==null?Xe.get(C).__webglFramebuffer:null;xe.bindFramebuffer(Z.FRAMEBUFFER,vt)}}},this.copyFramebufferToTexture=function(q,ge,Re=0){const Me=Math.pow(2,-Re),Ee=Math.floor(ge.image.width*Me),it=Math.floor(ge.image.height*Me);X.setTexture2D(ge,0),Z.copyTexSubImage2D(Z.TEXTURE_2D,Re,0,0,q.x,q.y,Ee,it),xe.unbindTexture()},this.copyTextureToTexture=function(q,ge,Re,Me=0){const Ee=ge.image.width,it=ge.image.height,xt=Je.convert(Re.format),Ht=Je.convert(Re.type);X.setTexture2D(Re,0),Z.pixelStorei(Z.UNPACK_FLIP_Y_WEBGL,Re.flipY),Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Re.premultiplyAlpha),Z.pixelStorei(Z.UNPACK_ALIGNMENT,Re.unpackAlignment),ge.isDataTexture?Z.texSubImage2D(Z.TEXTURE_2D,Me,q.x,q.y,Ee,it,xt,Ht,ge.image.data):ge.isCompressedTexture?Z.compressedTexSubImage2D(Z.TEXTURE_2D,Me,q.x,q.y,ge.mipmaps[0].width,ge.mipmaps[0].height,xt,ge.mipmaps[0].data):Z.texSubImage2D(Z.TEXTURE_2D,Me,q.x,q.y,xt,Ht,ge.image),Me===0&&Re.generateMipmaps&&Z.generateMipmap(Z.TEXTURE_2D),xe.unbindTexture()},this.copyTextureToTexture3D=function(q,ge,Re,Me,Ee=0){if(_.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const it=q.max.x-q.min.x+1,xt=q.max.y-q.min.y+1,Ht=q.max.z-q.min.z+1,vt=Je.convert(Me.format),wt=Je.convert(Me.type);let Ut;if(Me.isData3DTexture)X.setTexture3D(Me,0),Ut=Z.TEXTURE_3D;else if(Me.isDataArrayTexture||Me.isCompressedArrayTexture)X.setTexture2DArray(Me,0),Ut=Z.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Z.pixelStorei(Z.UNPACK_FLIP_Y_WEBGL,Me.flipY),Z.pixelStorei(Z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Me.premultiplyAlpha),Z.pixelStorei(Z.UNPACK_ALIGNMENT,Me.unpackAlignment);const Yt=Z.getParameter(Z.UNPACK_ROW_LENGTH),ar=Z.getParameter(Z.UNPACK_IMAGE_HEIGHT),Er=Z.getParameter(Z.UNPACK_SKIP_PIXELS),Mn=Z.getParameter(Z.UNPACK_SKIP_ROWS),xr=Z.getParameter(Z.UNPACK_SKIP_IMAGES),$t=Re.isCompressedTexture?Re.mipmaps[Ee]:Re.image;Z.pixelStorei(Z.UNPACK_ROW_LENGTH,$t.width),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,$t.height),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,q.min.x),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,q.min.y),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,q.min.z),Re.isDataTexture||Re.isData3DTexture?Z.texSubImage3D(Ut,Ee,ge.x,ge.y,ge.z,it,xt,Ht,vt,wt,$t.data):Re.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Z.compressedTexSubImage3D(Ut,Ee,ge.x,ge.y,ge.z,it,xt,Ht,vt,$t.data)):Z.texSubImage3D(Ut,Ee,ge.x,ge.y,ge.z,it,xt,Ht,vt,wt,$t),Z.pixelStorei(Z.UNPACK_ROW_LENGTH,Yt),Z.pixelStorei(Z.UNPACK_IMAGE_HEIGHT,ar),Z.pixelStorei(Z.UNPACK_SKIP_PIXELS,Er),Z.pixelStorei(Z.UNPACK_SKIP_ROWS,Mn),Z.pixelStorei(Z.UNPACK_SKIP_IMAGES,xr),Ee===0&&Me.generateMipmaps&&Z.generateMipmap(Ut),xe.unbindTexture()},this.initTexture=function(q){q.isCubeTexture?X.setTextureCube(q,0):q.isData3DTexture?X.setTexture3D(q,0):q.isDataArrayTexture||q.isCompressedArrayTexture?X.setTexture2DArray(q,0):X.setTexture2D(q,0),xe.unbindTexture()},this.resetState=function(){S=0,E=0,C=null,xe.reset(),Wt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return mu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===eE?"display-p3":"srgb",t.unpackColorSpace=Jn.workingColorSpace===B1?"display-p3":"srgb"}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===Rn?Ph:zP}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===Ph?Rn:$a}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class N9 extends hg{}N9.prototype.isWebGL1Renderer=!0;class rE{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ct(e),this.density=t}clone(){return new rE(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class iE{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new ct(e),this.near=t,this.far=r}clone(){return new iE(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class vc extends $n{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class oE{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=qy,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=aa()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,o=this.stride;i<o;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=aa()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=aa()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Oo=new ne;class $d{constructor(e,t,r,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.applyMatrix4(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.applyNormalMatrix(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Oo.fromBufferAttribute(this,t),Oo.transformDirection(e),this.setXYZ(t,Oo.x,Oo.y,Oo.z);return this}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=hs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=hs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=hs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=hs(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),r=cn(r,this.array),i=cn(i,this.array),o=cn(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[i+o])}return new In(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new $d(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[i+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class QP extends $i{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Xp;const Jg=new ne,qp=new ne,Yp=new ne,Kp=new De,e0=new De,L9=new tn,tw=new ne,t0=new ne,nw=new ne,_B=new De,oM=new De,bB=new De;class F9 extends $n{constructor(e=new QP){if(super(),this.isSprite=!0,this.type="Sprite",Xp===void 0){Xp=new an;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new oE(t,5);Xp.setIndex([0,1,2,0,2,3]),Xp.setAttribute("position",new $d(r,3,0,!1)),Xp.setAttribute("uv",new $d(r,2,3,!1))}this.geometry=Xp,this.material=e,this.center=new De(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),qp.setFromMatrixScale(this.matrixWorld),L9.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Yp.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&qp.multiplyScalar(-Yp.z);const r=this.material.rotation;let i,o;r!==0&&(o=Math.cos(r),i=Math.sin(r));const s=this.center;rw(tw.set(-.5,-.5,0),Yp,s,qp,i,o),rw(t0.set(.5,-.5,0),Yp,s,qp,i,o),rw(nw.set(.5,.5,0),Yp,s,qp,i,o),_B.set(0,0),oM.set(1,0),bB.set(1,1);let a=e.ray.intersectTriangle(tw,t0,nw,!1,Jg);if(a===null&&(rw(t0.set(-.5,.5,0),Yp,s,qp,i,o),oM.set(0,1),a=e.ray.intersectTriangle(tw,nw,t0,!1,Jg),a===null))return;const u=e.ray.origin.distanceTo(Jg);u<e.near||u>e.far||t.push({distance:u,point:Jg.clone(),uv:cd.getInterpolation(Jg,tw,t0,nw,_B,oM,bB,new De),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function rw(n,e,t,r,i,o){Kp.subVectors(n,t).addScalar(.5).multiply(r),i!==void 0?(e0.x=o*Kp.x-i*Kp.y,e0.y=i*Kp.x+o*Kp.y):e0.copy(Kp),n.copy(e),n.x+=e0.x,n.y+=e0.y,n.applyMatrix4(L9)}const iw=new ne,SB=new ne;class O9 extends $n{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,i=t.length;r<i;r++){const o=t[r];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const i=this.levels;let o;for(o=0;o<i.length&&!(t<i[o].distance);o++);return i.splice(o,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,i;for(r=1,i=t.length;r<i;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),e<o)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){iw.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(iw);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){iw.setFromMatrixPosition(e.matrixWorld),SB.setFromMatrixPosition(this.matrixWorld);const r=iw.distanceTo(SB)/e.zoom;t[0].object.visible=!0;let i,o;for(i=1,o=t.length;i<o;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),r>=s)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<o;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let i=0,o=r.length;i<o;i++){const s=r[i];t.object.levels.push({object:s.object.uuid,distance:s.distance,hysteresis:s.hysteresis})}return t}}const EB=new ne,CB=new On,MB=new On,Mue=new ne,TB=new tn,ow=new ne,sM=new Ao,RB=new tn,aM=new lg;class B9 extends yr{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=oA,this.bindMatrix=new tn,this.bindMatrixInverse=new tn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Jo),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,ow),this.boundingBox.expandByPoint(ow)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ao),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,ow),this.boundingSphere.expandByPoint(ow)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,i=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),sM.copy(this.boundingSphere),sM.applyMatrix4(i),e.ray.intersectsSphere(sM)!==!1&&(RB.copy(i).invert(),aM.copy(e.ray).applyMatrix4(RB),!(this.boundingBox!==null&&aM.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,aM)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new On,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===oA?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Z7?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const r=this.skeleton,i=this.geometry;CB.fromBufferAttribute(i.attributes.skinIndex,e),MB.fromBufferAttribute(i.attributes.skinWeight,e),EB.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const s=MB.getComponent(o);if(s!==0){const a=CB.getComponent(o);TB.multiplyMatrices(r.bones[a].matrixWorld,r.boneInverses[a]),t.addScaledVector(Mue.copy(EB).applyMatrix4(TB),s)}}return t.applyMatrix4(this.bindMatrixInverse)}boneTransform(e,t){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(e,t)}}class JP extends $n{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ac extends Lr{constructor(e=null,t=1,r=1,i,o,s,a,u,l=ti,c=ti,h,f){super(null,s,a,u,l,c,i,o,h,f),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const AB=new tn,Tue=new tn;class sE{constructor(e=[],t=[]){this.uuid=aa(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new tn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new tn;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture;for(let o=0,s=e.length;o<s;o++){const a=e[o]?e[o].matrixWorld:Tue;AB.multiplyMatrices(a,t[o]),AB.toArray(r,o*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new sE(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new ac(t,e,e,eo,vs);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,i=e.bones.length;r<i;r++){const o=e.bones[r];let s=t[o];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),s=new JP),this.bones.push(s),this.boneInverses.push(new tn().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let i=0,o=t.length;i<o;i++){const s=t[i];e.bones.push(s.uuid);const a=r[i];e.boneInverses.push(a.toArray())}return e}}class Ov extends In{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Zp=new tn,IB=new tn,sw=[],PB=new Jo,Rue=new tn,n0=new yr,r0=new Ao;class U9 extends yr{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ov(new Float32Array(r*16),16),this.instanceColor=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,Rue)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Jo),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Zp),PB.copy(e.boundingBox).applyMatrix4(Zp),this.boundingBox.union(PB)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ao),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Zp),r0.copy(e.boundingSphere).applyMatrix4(Zp),this.boundingSphere.union(r0)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const r=this.matrixWorld,i=this.count;if(n0.geometry=this.geometry,n0.material=this.material,n0.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),r0.copy(this.boundingSphere),r0.applyMatrix4(r),e.ray.intersectsSphere(r0)!==!1))for(let o=0;o<i;o++){this.getMatrixAt(o,Zp),IB.multiplyMatrices(r,Zp),n0.matrixWorld=IB,n0.raycast(e,sw);for(let s=0,a=sw.length;s<a;s++){const u=sw[s];u.instanceId=o,u.object=this,t.push(u)}sw.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Ov(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}function Aue(n,e){return n.z-e.z}function Iue(n,e){return e.z-n.z}class Pue{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const r=this.pool,i=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const o=r[this.index];i.push(o),this.index++,o.start=e.start,o.count=e.count,o.z=t}reset(){this.list.length=0,this.index=0}}const Qp="batchId",Yc=new tn,kB=new tn,kue=new tn,DB=new tn,uM=new z1,aw=new Jo,Pf=new Ao,i0=new ne,lM=new Pue,go=new yr,uw=[];function Due(n,e,t=0){const r=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const i=n.count;for(let o=0;o<i;o++)for(let s=0;s<r;s++)e.setComponent(o+t,s,n.getComponent(o,s))}else e.array.set(n.array,t*r);e.needsUpdate=!0}class z9 extends yr{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=t*2,i){super(new an,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new ac(t,e,e,eo,vs);this._matricesTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,i=this._maxGeometryCount,o=this._maxIndexCount;if(this._geometryInitialized===!1){for(const a in e.attributes){const u=e.getAttribute(a),{array:l,itemSize:c,normalized:h}=u,f=new l.constructor(r*c),d=new u.constructor(f,c,h);d.setUsage(u.usage),t.setAttribute(a,d)}if(e.getIndex()!==null){const a=r>65536?new Uint32Array(o):new Uint16Array(o);t.setIndex(new In(a,1))}const s=i>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(Qp,new In(s,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Qp))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Qp}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(r===Qp)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const i=e.getAttribute(r),o=t.getAttribute(r);if(i.itemSize!==o.itemSize||i.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jo);const e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let i=0;i<e;i++)r[i]!==!1&&(this.getMatrixAt(i,Yc),this.getBoundingBoxAt(i,aw).applyMatrix4(Yc),t.union(aw))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ao);const e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let i=0;i<e;i++)r[i]!==!1&&(this.getMatrixAt(i,Yc),this.getBoundingSphereAt(i,Pf).applyMatrix4(Yc),t.union(Pf))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const i={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const s=this._reservedRanges,a=this._drawRanges,u=this._bounds;this._geometryCount!==0&&(o=s[s.length-1]),t===-1?i.vertexCount=e.getAttribute("position").count:i.vertexCount=t,o===null?i.vertexStart=0:i.vertexStart=o.vertexStart+o.vertexCount;const l=e.getIndex(),c=l!==null;if(c&&(r===-1?i.indexCount=l.count:i.indexCount=r,o===null?i.indexStart=0:i.indexStart=o.indexStart+o.indexCount),i.indexStart!==-1&&i.indexStart+i.indexCount>this._maxIndexCount||i.vertexStart+i.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const h=this._visibility,f=this._active,d=this._matricesTexture,p=this._matricesTexture.image.data;h.push(!0),f.push(!0);const v=this._geometryCount;this._geometryCount++,kue.toArray(p,v*16),d.needsUpdate=!0,s.push(i),a.push({start:c?i.indexStart:i.vertexStart,count:-1}),u.push({boxInitialized:!1,box:new Jo,sphereInitialized:!1,sphere:new Ao});const g=this.geometry.getAttribute(Qp);for(let m=0;m<i.vertexCount;m++)g.setX(i.vertexStart+m,v);return g.needsUpdate=!0,this.setGeometryAt(v,e),v}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,i=r.getIndex()!==null,o=r.getIndex(),s=t.getIndex(),a=this._reservedRanges[e];if(i&&s.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const u=a.vertexStart,l=a.vertexCount;for(const d in r.attributes){if(d===Qp)continue;const p=t.getAttribute(d),v=r.getAttribute(d);Due(p,v,u);const g=p.itemSize;for(let m=p.count,x=l;m<x;m++){const _=u+m;for(let b=0;b<g;b++)v.setComponent(_,b,0)}v.needsUpdate=!0}if(i){const d=a.indexStart;for(let p=0;p<s.count;p++)o.setX(d+p,u+s.getX(p));for(let p=s.count,v=a.indexCount;p<v;p++)o.setX(d+p,u);o.needsUpdate=!0}const c=this._bounds[e];t.boundingBox!==null?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,t.boundingSphere!==null?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const h=this._drawRanges[e],f=t.getAttribute("position");return h.count=i?s.count:f.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1?this:(t[e]=!1,this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(this._active[e]===!1)return this;const i=this._bounds[e],o=i.box,s=this.geometry;if(i.boxInitialized===!1){o.makeEmpty();const a=s.index,u=s.attributes.position,l=this._drawRanges[e];for(let c=l.start,h=l.start+l.count;c<h;c++){let f=c;a&&(f=a.getX(f)),o.expandByPoint(i0.fromBufferAttribute(u,f))}i.boxInitialized=!0}return t.copy(o),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return this;const i=this._bounds[e],o=i.sphere,s=this.geometry;if(i.sphereInitialized===!1){o.makeEmpty(),this.getBoundingBoxAt(e,aw),aw.getCenter(o.center);const a=s.index,u=s.attributes.position,l=this._drawRanges[e];let c=0;for(let h=l.start,f=l.start+l.count;h<f;h++){let d=h;a&&(d=a.getX(d)),i0.fromBufferAttribute(u,d),c=Math.max(c,o.center.distanceToSquared(i0))}o.radius=Math.sqrt(c),i.sphereInitialized=!0}return t.copy(o),t}setMatrixAt(e,t){const r=this._active,i=this._matricesTexture,o=this._matricesTexture.image.data,s=this._geometryCount;return e>=s||r[e]===!1?this:(t.toArray(o,e*16),i.needsUpdate=!0,this)}getMatrixAt(e,t){const r=this._active,i=this._matricesTexture.image.data,o=this._geometryCount;return e>=o||r[e]===!1?null:t.fromArray(i,e*16)}setVisibleAt(e,t){const r=this._visibility,i=this._active,o=this._geometryCount;return e>=o||i[e]===!1||r[e]===t?this:(r[e]=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._visibility,r=this._active,i=this._geometryCount;return e>=i||r[e]===!1?!1:t[e]}raycast(e,t){const r=this._visibility,i=this._active,o=this._drawRanges,s=this._geometryCount,a=this.matrixWorld,u=this.geometry;go.material=this.material,go.geometry.index=u.index,go.geometry.attributes=u.attributes,go.geometry.boundingBox===null&&(go.geometry.boundingBox=new Jo),go.geometry.boundingSphere===null&&(go.geometry.boundingSphere=new Ao);for(let l=0;l<s;l++){if(!r[l]||!i[l])continue;const c=o[l];go.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(l,go.matrixWorld).premultiply(a),this.getBoundingBoxAt(l,go.geometry.boundingBox),this.getBoundingSphereAt(l,go.geometry.boundingSphere),go.raycast(e,uw);for(let h=0,f=uw.length;h<f;h++){const d=uw[h];d.object=this,d.batchId=l,t.push(d)}uw.length=0}go.material=null,go.geometry.index=null,go.geometry.attributes={},go.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,r,i,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=i.getIndex(),a=s===null?1:s.array.BYTES_PER_ELEMENT,u=this._visibility,l=this._multiDrawStarts,c=this._multiDrawCounts,h=this._drawRanges,f=this.perObjectFrustumCulled;f&&(DB.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),uM.setFromProjectionMatrix(DB,e.isWebGPURenderer?Nv:mu));let d=0;if(this.sortObjects){kB.copy(this.matrixWorld).invert(),i0.setFromMatrixPosition(r.matrixWorld).applyMatrix4(kB);for(let g=0,m=u.length;g<m;g++)if(u[g]){this.getMatrixAt(g,Yc),this.getBoundingSphereAt(g,Pf).applyMatrix4(Yc);let x=!1;if(f&&(x=!uM.intersectsSphere(Pf)),!x){const _=i0.distanceTo(Pf.center);lM.push(h[g],_)}}const p=lM.list,v=this.customSort;v===null?p.sort(o.transparent?Iue:Aue):v.call(this,p,r);for(let g=0,m=p.length;g<m;g++){const x=p[g];l[d]=x.start*a,c[d]=x.count,d++}lM.reset()}else for(let p=0,v=u.length;p<v;p++)if(u[p]){let g=!1;if(f&&(this.getMatrixAt(p,Yc),this.getBoundingSphereAt(p,Pf).applyMatrix4(Yc),g=!uM.intersectsSphere(Pf)),!g){const m=h[p];l[d]=m.start*a,c[d]=m.count,d++}}this._multiDrawCount=d,this._visibilityChanged=!1}onBeforeShadow(e,t,r,i,o,s){this.onBeforeRender(e,null,i,o,s)}}class rs extends $i{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ct(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const NB=new ne,LB=new ne,FB=new tn,cM=new lg,lw=new Ao;class Gh extends $n{constructor(e=new an,t=new rs){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let i=1,o=t.count;i<o;i++)NB.fromBufferAttribute(t,i-1),LB.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=NB.distanceTo(LB);e.setAttribute("lineDistance",new At(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),lw.copy(r.boundingSphere),lw.applyMatrix4(i),lw.radius+=o,e.ray.intersectsSphere(lw)===!1)return;FB.copy(i).invert(),cM.copy(e.ray).applyMatrix4(FB);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),u=a*a,l=new ne,c=new ne,h=new ne,f=new ne,d=this.isLineSegments?2:1,p=r.index,g=r.attributes.position;if(p!==null){const m=Math.max(0,s.start),x=Math.min(p.count,s.start+s.count);for(let _=m,b=x-1;_<b;_+=d){const S=p.getX(_),E=p.getX(_+1);if(l.fromBufferAttribute(g,S),c.fromBufferAttribute(g,E),cM.distanceSqToSegment(l,c,f,h)>u)continue;f.applyMatrix4(this.matrixWorld);const R=e.ray.origin.distanceTo(f);R<e.near||R>e.far||t.push({distance:R,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else{const m=Math.max(0,s.start),x=Math.min(g.count,s.start+s.count);for(let _=m,b=x-1;_<b;_+=d){if(l.fromBufferAttribute(g,_),c.fromBufferAttribute(g,_+1),cM.distanceSqToSegment(l,c,f,h)>u)continue;f.applyMatrix4(this.matrixWorld);const E=e.ray.origin.distanceTo(f);E<e.near||E>e.far||t.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}const OB=new ne,BB=new ne;class Au extends Gh{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let i=0,o=t.count;i<o;i+=2)OB.fromBufferAttribute(t,i),BB.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+OB.distanceTo(BB);e.setAttribute("lineDistance",new At(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class V9 extends Gh{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ek extends $i{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const UB=new tn,FA=new lg,cw=new Ao,hw=new ne;class W9 extends $n{constructor(e=new an,t=new ek){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold,s=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),cw.copy(r.boundingSphere),cw.applyMatrix4(i),cw.radius+=o,e.ray.intersectsSphere(cw)===!1)return;UB.copy(i).invert(),FA.copy(e.ray).applyMatrix4(UB);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),u=a*a,l=r.index,h=r.attributes.position;if(l!==null){const f=Math.max(0,s.start),d=Math.min(l.count,s.start+s.count);for(let p=f,v=d;p<v;p++){const g=l.getX(p);hw.fromBufferAttribute(h,g),zB(hw,g,u,i,e,t,this)}}else{const f=Math.max(0,s.start),d=Math.min(h.count,s.start+s.count);for(let p=f,v=d;p<v;p++)hw.fromBufferAttribute(h,p),zB(hw,p,u,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}function zB(n,e,t,r,i,o,s){const a=FA.distanceSqToPoint(n);if(a<t){const u=new ne;FA.closestPointToPoint(n,u),u.applyMatrix4(r);const l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;o.push({distance:l,distanceToRay:Math.sqrt(a),point:u,index:e,face:null,object:s})}}class Nue extends Lr{constructor(e,t,r,i,o,s,a,u,l){super(e,t,r,i,o,s,a,u,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:Fn,this.magFilter=o!==void 0?o:Fn,this.generateMipmaps=!1;const c=this;function h(){c.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Lue extends Lr{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=ti,this.minFilter=ti,this.generateMipmaps=!1,this.needsUpdate=!0}}class aE extends Lr{constructor(e,t,r,i,o,s,a,u,l,c,h,f){super(null,s,a,u,l,c,i,o,h,f),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Fue extends aE{constructor(e,t,r,i,o,s){super(e,t,r,o,s),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=qr}}class Oue extends aE{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,mc),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Bue extends Lr{constructor(e,t,r,i,o,s,a,u,l){super(e,t,r,i,o,s,a,u,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Iu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),o=0;t.push(0);for(let s=1;s<=e;s++)r=this.getPoint(s/e),o+=r.distanceTo(i),t.push(o),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const o=r.length;let s;t?s=t:s=e*r[o-1];let a=0,u=o-1,l;for(;a<=u;)if(i=Math.floor(a+(u-a)/2),l=r[i]-s,l<0)a=i+1;else if(l>0)u=i-1;else{u=i;break}if(i=u,r[i]===s)return i/(o-1);const c=r[i],f=r[i+1]-c,d=(s-c)/f;return(i+d)/(o-1)}getTangent(e,t){let i=e-1e-4,o=e+1e-4;i<0&&(i=0),o>1&&(o=1);const s=this.getPoint(i),a=this.getPoint(o),u=t||(s.isVector2?new De:new ne);return u.copy(a).sub(s).normalize(),u}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new ne,i=[],o=[],s=[],a=new ne,u=new tn;for(let d=0;d<=e;d++){const p=d/e;i[d]=this.getTangentAt(p,new ne)}o[0]=new ne,s[0]=new ne;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),f=Math.abs(i[0].z);c<=l&&(l=c,r.set(1,0,0)),h<=l&&(l=h,r.set(0,1,0)),f<=l&&r.set(0,0,1),a.crossVectors(i[0],r).normalize(),o[0].crossVectors(i[0],a),s[0].crossVectors(i[0],o[0]);for(let d=1;d<=e;d++){if(o[d]=o[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(Xr(i[d-1].dot(i[d]),-1,1));o[d].applyMatrix4(u.makeRotationAxis(a,p))}s[d].crossVectors(i[d],o[d])}if(t===!0){let d=Math.acos(Xr(o[0].dot(o[e]),-1,1));d/=e,i[0].dot(a.crossVectors(o[0],o[e]))>0&&(d=-d);for(let p=1;p<=e;p++)o[p].applyMatrix4(u.makeRotationAxis(i[p],d*p)),s[p].crossVectors(i[p],o[p])}return{tangents:i,normals:o,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class uE extends Iu{constructor(e=0,t=0,r=1,i=1,o=0,s=Math.PI*2,a=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=s,this.aClockwise=a,this.aRotation=u}getPoint(e,t){const r=t||new De,i=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const s=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(s?o=0:o=i),this.aClockwise===!0&&!s&&(o===i?o=-i:o=o-i);const a=this.aStartAngle+e*o;let u=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),f=u-this.aX,d=l-this.aY;u=f*c-d*h+this.aX,l=f*h+d*c+this.aY}return r.set(u,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class H9 extends uE{constructor(e,t,r,i,o,s){super(e,t,r,r,i,o,s),this.isArcCurve=!0,this.type="ArcCurve"}}function tk(){let n=0,e=0,t=0,r=0;function i(o,s,a,u){n=o,e=a,t=-3*o+3*s-2*a-u,r=2*o-2*s+a+u}return{initCatmullRom:function(o,s,a,u,l){i(s,a,l*(a-o),l*(u-s))},initNonuniformCatmullRom:function(o,s,a,u,l,c,h){let f=(s-o)/l-(a-o)/(l+c)+(a-s)/c,d=(a-s)/c-(u-s)/(c+h)+(u-a)/h;f*=c,d*=c,i(s,a,f,d)},calc:function(o){const s=o*o,a=s*o;return n+e*o+t*s+r*a}}}const fw=new ne,hM=new tk,fM=new tk,dM=new tk;class G9 extends Iu{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new ne){const r=t,i=this.points,o=i.length,s=(o-(this.closed?0:1))*e;let a=Math.floor(s),u=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/o)+1)*o:u===0&&a===o-1&&(a=o-2,u=1);let l,c;this.closed||a>0?l=i[(a-1)%o]:(fw.subVectors(i[0],i[1]).add(i[0]),l=fw);const h=i[a%o],f=i[(a+1)%o];if(this.closed||a+2<o?c=i[(a+2)%o]:(fw.subVectors(i[o-1],i[o-2]).add(i[o-1]),c=fw),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let p=Math.pow(l.distanceToSquared(h),d),v=Math.pow(h.distanceToSquared(f),d),g=Math.pow(f.distanceToSquared(c),d);v<1e-4&&(v=1),p<1e-4&&(p=v),g<1e-4&&(g=v),hM.initNonuniformCatmullRom(l.x,h.x,f.x,c.x,p,v,g),fM.initNonuniformCatmullRom(l.y,h.y,f.y,c.y,p,v,g),dM.initNonuniformCatmullRom(l.z,h.z,f.z,c.z,p,v,g)}else this.curveType==="catmullrom"&&(hM.initCatmullRom(l.x,h.x,f.x,c.x,this.tension),fM.initCatmullRom(l.y,h.y,f.y,c.y,this.tension),dM.initCatmullRom(l.z,h.z,f.z,c.z,this.tension));return r.set(hM.calc(u),fM.calc(u),dM.calc(u)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new ne().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function VB(n,e,t,r,i){const o=(r-e)*.5,s=(i-t)*.5,a=n*n,u=n*a;return(2*t-2*r+o+s)*u+(-3*t+3*r-2*o-s)*a+o*n+t}function Uue(n,e){const t=1-n;return t*t*e}function zue(n,e){return 2*(1-n)*n*e}function Vue(n,e){return n*n*e}function q0(n,e,t,r){return Uue(n,e)+zue(n,t)+Vue(n,r)}function Wue(n,e){const t=1-n;return t*t*t*e}function Hue(n,e){const t=1-n;return 3*t*t*n*e}function Gue(n,e){return 3*(1-n)*n*n*e}function $ue(n,e){return n*n*n*e}function Y0(n,e,t,r,i){return Wue(n,e)+Hue(n,t)+Gue(n,r)+$ue(n,i)}class nk extends Iu{constructor(e=new De,t=new De,r=new De,i=new De){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new De){const r=t,i=this.v0,o=this.v1,s=this.v2,a=this.v3;return r.set(Y0(e,i.x,o.x,s.x,a.x),Y0(e,i.y,o.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class $9 extends Iu{constructor(e=new ne,t=new ne,r=new ne,i=new ne){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new ne){const r=t,i=this.v0,o=this.v1,s=this.v2,a=this.v3;return r.set(Y0(e,i.x,o.x,s.x,a.x),Y0(e,i.y,o.y,s.y,a.y),Y0(e,i.z,o.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class rk extends Iu{constructor(e=new De,t=new De){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new De){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new De){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class j9 extends Iu{constructor(e=new ne,t=new ne){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ne){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ne){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ik extends Iu{constructor(e=new De,t=new De,r=new De){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new De){const r=t,i=this.v0,o=this.v1,s=this.v2;return r.set(q0(e,i.x,o.x,s.x),q0(e,i.y,o.y,s.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ok extends Iu{constructor(e=new ne,t=new ne,r=new ne){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ne){const r=t,i=this.v0,o=this.v1,s=this.v2;return r.set(q0(e,i.x,o.x,s.x),q0(e,i.y,o.y,s.y),q0(e,i.z,o.z,s.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sk extends Iu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new De){const r=t,i=this.points,o=(i.length-1)*e,s=Math.floor(o),a=o-s,u=i[s===0?s:s-1],l=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return r.set(VB(a,u.x,l.x,c.x,h.x),VB(a,u.y,l.y,c.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push(new De().fromArray(i))}return this}}var Mb=Object.freeze({__proto__:null,ArcCurve:H9,CatmullRomCurve3:G9,CubicBezierCurve:nk,CubicBezierCurve3:$9,EllipseCurve:uE,LineCurve:rk,LineCurve3:j9,QuadraticBezierCurve:ik,QuadraticBezierCurve3:ok,SplineCurve:sk});class X9 extends Iu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Mb[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=r){const s=i[o]-r,a=this.curves[o],u=a.getLength(),l=u===0?0:1-s/u;return a.getPointAt(l,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,o=this.curves;i<o.length;i++){const s=o[i],a=s.isEllipseCurve?e*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,u=s.getPoints(a);for(let l=0;l<u.length;l++){const c=u[l];r&&r.equals(c)||(t.push(c),r=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push(new Mb[i.type]().fromJSON(i))}return this}}class Ky extends X9{constructor(e){super(),this.type="Path",this.currentPoint=new De,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new rk(this.currentPoint.clone(),new De(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const o=new ik(this.currentPoint.clone(),new De(e,t),new De(r,i));return this.curves.push(o),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,o,s){const a=new nk(this.currentPoint.clone(),new De(e,t),new De(r,i),new De(o,s));return this.curves.push(a),this.currentPoint.set(o,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new sk(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,o,s){const a=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(e+a,t+u,r,i,o,s),this}absarc(e,t,r,i,o,s){return this.absellipse(e,t,r,r,i,o,s),this}ellipse(e,t,r,i,o,s,a,u){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,r,i,o,s,a,u),this}absellipse(e,t,r,i,o,s,a,u){const l=new uE(e,t,r,i,o,s,a,u);if(this.curves.length>0){const h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class W1 extends an{constructor(e=[new De(0,-.5),new De(.5,0),new De(0,.5)],t=12,r=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t),i=Xr(i,0,Math.PI*2);const o=[],s=[],a=[],u=[],l=[],c=1/t,h=new ne,f=new De,d=new ne,p=new ne,v=new ne;let g=0,m=0;for(let x=0;x<=e.length-1;x++)switch(x){case 0:g=e[x+1].x-e[x].x,m=e[x+1].y-e[x].y,d.x=m*1,d.y=-g,d.z=m*0,v.copy(d),d.normalize(),u.push(d.x,d.y,d.z);break;case e.length-1:u.push(v.x,v.y,v.z);break;default:g=e[x+1].x-e[x].x,m=e[x+1].y-e[x].y,d.x=m*1,d.y=-g,d.z=m*0,p.copy(d),d.x+=v.x,d.y+=v.y,d.z+=v.z,d.normalize(),u.push(d.x,d.y,d.z),v.copy(p)}for(let x=0;x<=t;x++){const _=r+x*c*i,b=Math.sin(_),S=Math.cos(_);for(let E=0;E<=e.length-1;E++){h.x=e[E].x*b,h.y=e[E].y,h.z=e[E].x*S,s.push(h.x,h.y,h.z),f.x=x/t,f.y=E/(e.length-1),a.push(f.x,f.y);const C=u[3*E+0]*b,R=u[3*E+1],T=u[3*E+0]*S;l.push(C,R,T)}}for(let x=0;x<t;x++)for(let _=0;_<e.length-1;_++){const b=_+x*e.length,S=b,E=b+e.length,C=b+e.length+1,R=b+1;o.push(S,E,R),o.push(C,R,E)}this.setIndex(o),this.setAttribute("position",new At(s,3)),this.setAttribute("uv",new At(a,2)),this.setAttribute("normal",new At(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new W1(e.points,e.segments,e.phiStart,e.phiLength)}}class lE extends W1{constructor(e=1,t=1,r=4,i=8){const o=new Ky;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(r),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:i}}static fromJSON(e){return new lE(e.radius,e.length,e.capSegments,e.radialSegments)}}class cE extends an{constructor(e=1,t=32,r=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},t=Math.max(3,t);const o=[],s=[],a=[],u=[],l=new ne,c=new De;s.push(0,0,0),a.push(0,0,1),u.push(.5,.5);for(let h=0,f=3;h<=t;h++,f+=3){const d=r+h/t*i;l.x=e*Math.cos(d),l.y=e*Math.sin(d),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[f]/e+1)/2,c.y=(s[f+1]/e+1)/2,u.push(c.x,c.y)}for(let h=1;h<=t;h++)o.push(h,h+1,0);this.setIndex(o),this.setAttribute("position",new At(s,3)),this.setAttribute("normal",new At(a,3)),this.setAttribute("uv",new At(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cE(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class fg extends an{constructor(e=1,t=1,r=1,i=32,o=1,s=!1,a=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:u};const l=this;i=Math.floor(i),o=Math.floor(o);const c=[],h=[],f=[],d=[];let p=0;const v=[],g=r/2;let m=0;x(),s===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new At(h,3)),this.setAttribute("normal",new At(f,3)),this.setAttribute("uv",new At(d,2));function x(){const b=new ne,S=new ne;let E=0;const C=(t-e)/r;for(let R=0;R<=o;R++){const T=[],A=R/o,P=A*(t-e)+e;for(let k=0;k<=i;k++){const W=k/i,N=W*u+a,O=Math.sin(N),z=Math.cos(N);S.x=P*O,S.y=-A*r+g,S.z=P*z,h.push(S.x,S.y,S.z),b.set(O,C,z).normalize(),f.push(b.x,b.y,b.z),d.push(W,1-A),T.push(p++)}v.push(T)}for(let R=0;R<i;R++)for(let T=0;T<o;T++){const A=v[T][R],P=v[T+1][R],k=v[T+1][R+1],W=v[T][R+1];c.push(A,P,W),c.push(P,k,W),E+=6}l.addGroup(m,E,0),m+=E}function _(b){const S=p,E=new De,C=new ne;let R=0;const T=b===!0?e:t,A=b===!0?1:-1;for(let k=1;k<=i;k++)h.push(0,g*A,0),f.push(0,A,0),d.push(.5,.5),p++;const P=p;for(let k=0;k<=i;k++){const N=k/i*u+a,O=Math.cos(N),z=Math.sin(N);C.x=T*z,C.y=g*A,C.z=T*O,h.push(C.x,C.y,C.z),f.push(0,A,0),E.x=O*.5+.5,E.y=z*.5*A+.5,d.push(E.x,E.y),p++}for(let k=0;k<i;k++){const W=S+k,N=P+k;b===!0?c.push(N,N+1,W):c.push(N+1,N,W),R+=3}l.addGroup(m,R,b===!0?1:2),m+=R}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fg(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hE extends fg{constructor(e=1,t=1,r=32,i=1,o=!1,s=0,a=Math.PI*2){super(0,e,t,r,i,o,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a}}static fromJSON(e){return new hE(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class uf extends an{constructor(e=[],t=[],r=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i};const o=[],s=[];a(i),l(r),c(),this.setAttribute("position",new At(o,3)),this.setAttribute("normal",new At(o.slice(),3)),this.setAttribute("uv",new At(s,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(x){const _=new ne,b=new ne,S=new ne;for(let E=0;E<t.length;E+=3)d(t[E+0],_),d(t[E+1],b),d(t[E+2],S),u(_,b,S,x)}function u(x,_,b,S){const E=S+1,C=[];for(let R=0;R<=E;R++){C[R]=[];const T=x.clone().lerp(b,R/E),A=_.clone().lerp(b,R/E),P=E-R;for(let k=0;k<=P;k++)k===0&&R===E?C[R][k]=T:C[R][k]=T.clone().lerp(A,k/P)}for(let R=0;R<E;R++)for(let T=0;T<2*(E-R)-1;T++){const A=Math.floor(T/2);T%2===0?(f(C[R][A+1]),f(C[R+1][A]),f(C[R][A])):(f(C[R][A+1]),f(C[R+1][A+1]),f(C[R+1][A]))}}function l(x){const _=new ne;for(let b=0;b<o.length;b+=3)_.x=o[b+0],_.y=o[b+1],_.z=o[b+2],_.normalize().multiplyScalar(x),o[b+0]=_.x,o[b+1]=_.y,o[b+2]=_.z}function c(){const x=new ne;for(let _=0;_<o.length;_+=3){x.x=o[_+0],x.y=o[_+1],x.z=o[_+2];const b=g(x)/2/Math.PI+.5,S=m(x)/Math.PI+.5;s.push(b,1-S)}p(),h()}function h(){for(let x=0;x<s.length;x+=6){const _=s[x+0],b=s[x+2],S=s[x+4],E=Math.max(_,b,S),C=Math.min(_,b,S);E>.9&&C<.1&&(_<.2&&(s[x+0]+=1),b<.2&&(s[x+2]+=1),S<.2&&(s[x+4]+=1))}}function f(x){o.push(x.x,x.y,x.z)}function d(x,_){const b=x*3;_.x=e[b+0],_.y=e[b+1],_.z=e[b+2]}function p(){const x=new ne,_=new ne,b=new ne,S=new ne,E=new De,C=new De,R=new De;for(let T=0,A=0;T<o.length;T+=9,A+=6){x.set(o[T+0],o[T+1],o[T+2]),_.set(o[T+3],o[T+4],o[T+5]),b.set(o[T+6],o[T+7],o[T+8]),E.set(s[A+0],s[A+1]),C.set(s[A+2],s[A+3]),R.set(s[A+4],s[A+5]),S.copy(x).add(_).add(b).divideScalar(3);const P=g(S);v(E,A+0,x,P),v(C,A+2,_,P),v(R,A+4,b,P)}}function v(x,_,b,S){S<0&&x.x===1&&(s[_]=x.x-1),b.x===0&&b.z===0&&(s[_]=S/2/Math.PI+.5)}function g(x){return Math.atan2(x.z,-x.x)}function m(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uf(e.vertices,e.indices,e.radius,e.details)}}class fE extends uf{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=1/r,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,s,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new fE(e.radius,e.detail)}}const dw=new ne,pw=new ne,pM=new ne,mw=new cd;class q9 extends an{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),o=Math.cos(Sd*t),s=e.getIndex(),a=e.getAttribute("position"),u=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),f={},d=[];for(let p=0;p<u;p+=3){s?(l[0]=s.getX(p),l[1]=s.getX(p+1),l[2]=s.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:v,b:g,c:m}=mw;if(v.fromBufferAttribute(a,l[0]),g.fromBufferAttribute(a,l[1]),m.fromBufferAttribute(a,l[2]),mw.getNormal(pM),h[0]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,h[1]=`${Math.round(g.x*i)},${Math.round(g.y*i)},${Math.round(g.z*i)}`,h[2]=`${Math.round(m.x*i)},${Math.round(m.y*i)},${Math.round(m.z*i)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let x=0;x<3;x++){const _=(x+1)%3,b=h[x],S=h[_],E=mw[c[x]],C=mw[c[_]],R=`${b}_${S}`,T=`${S}_${b}`;T in f&&f[T]?(pM.dot(f[T].normal)<=o&&(d.push(E.x,E.y,E.z),d.push(C.x,C.y,C.z)),f[T]=null):R in f||(f[R]={index0:l[x],index1:l[_],normal:pM.clone()})}}for(const p in f)if(f[p]){const{index0:v,index1:g}=f[p];dw.fromBufferAttribute(a,v),pw.fromBufferAttribute(a,g),d.push(dw.x,dw.y,dw.z),d.push(pw.x,pw.y,pw.z)}this.setAttribute("position",new At(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Cd extends Ky{constructor(e){super(e),this.uuid=aa(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push(new Ky().fromJSON(i))}return this}}const jue={triangulate:function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let o=Y9(n,0,i,t,!0);const s=[];if(!o||o.next===o.prev)return s;let a,u,l,c,h,f,d;if(r&&(o=Zue(n,e,o,t)),n.length>80*t){a=l=n[0],u=c=n[1];for(let p=t;p<i;p+=t)h=n[p],f=n[p+1],h<a&&(a=h),f<u&&(u=f),h>l&&(l=h),f>c&&(c=f);d=Math.max(l-a,c-u),d=d!==0?32767/d:0}return Zy(o,s,t,a,u,d,0),s}};function Y9(n,e,t,r,i){let o,s;if(i===ule(n,e,t,r)>0)for(o=e;o<t;o+=r)s=WB(o,n[o],n[o+1],s);else for(o=t-r;o>=e;o-=r)s=WB(o,n[o],n[o+1],s);return s&&dE(s,s.next)&&(Jy(s),s=s.next),s}function jd(n,e){if(!n)return n;e||(e=n);let t=n,r;do if(r=!1,!t.steiner&&(dE(t,t.next)||Ir(t.prev,t,t.next)===0)){if(Jy(t),t=e=t.prev,t===t.next)break;r=!0}else t=t.next;while(r||t!==e);return e}function Zy(n,e,t,r,i,o,s){if(!n)return;!s&&o&&nle(n,r,i,o);let a=n,u,l;for(;n.prev!==n.next;){if(u=n.prev,l=n.next,o?que(n,r,i,o):Xue(n)){e.push(u.i/t|0),e.push(n.i/t|0),e.push(l.i/t|0),Jy(n),n=l.next,a=l.next;continue}if(n=l,n===a){s?s===1?(n=Yue(jd(n),e,t),Zy(n,e,t,r,i,o,2)):s===2&&Kue(n,e,t,r,i,o):Zy(jd(n),e,t,r,i,o,1);break}}}function Xue(n){const e=n.prev,t=n,r=n.next;if(Ir(e,t,r)>=0)return!1;const i=e.x,o=t.x,s=r.x,a=e.y,u=t.y,l=r.y,c=i<o?i<s?i:s:o<s?o:s,h=a<u?a<l?a:l:u<l?u:l,f=i>o?i>s?i:s:o>s?o:s,d=a>u?a>l?a:l:u>l?u:l;let p=r.next;for(;p!==e;){if(p.x>=c&&p.x<=f&&p.y>=h&&p.y<=d&&Vm(i,a,o,u,s,l,p.x,p.y)&&Ir(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function que(n,e,t,r){const i=n.prev,o=n,s=n.next;if(Ir(i,o,s)>=0)return!1;const a=i.x,u=o.x,l=s.x,c=i.y,h=o.y,f=s.y,d=a<u?a<l?a:l:u<l?u:l,p=c<h?c<f?c:f:h<f?h:f,v=a>u?a>l?a:l:u>l?u:l,g=c>h?c>f?c:f:h>f?h:f,m=OA(d,p,e,t,r),x=OA(v,g,e,t,r);let _=n.prevZ,b=n.nextZ;for(;_&&_.z>=m&&b&&b.z<=x;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=g&&_!==i&&_!==s&&Vm(a,c,u,h,l,f,_.x,_.y)&&Ir(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=d&&b.x<=v&&b.y>=p&&b.y<=g&&b!==i&&b!==s&&Vm(a,c,u,h,l,f,b.x,b.y)&&Ir(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=m;){if(_.x>=d&&_.x<=v&&_.y>=p&&_.y<=g&&_!==i&&_!==s&&Vm(a,c,u,h,l,f,_.x,_.y)&&Ir(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=x;){if(b.x>=d&&b.x<=v&&b.y>=p&&b.y<=g&&b!==i&&b!==s&&Vm(a,c,u,h,l,f,b.x,b.y)&&Ir(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Yue(n,e,t){let r=n;do{const i=r.prev,o=r.next.next;!dE(i,o)&&K9(i,r,r.next,o)&&Qy(i,o)&&Qy(o,i)&&(e.push(i.i/t|0),e.push(r.i/t|0),e.push(o.i/t|0),Jy(r),Jy(r.next),r=n=o),r=r.next}while(r!==n);return jd(r)}function Kue(n,e,t,r,i,o){let s=n;do{let a=s.next.next;for(;a!==s.prev;){if(s.i!==a.i&&ole(s,a)){let u=Z9(s,a);s=jd(s,s.next),u=jd(u,u.next),Zy(s,e,t,r,i,o,0),Zy(u,e,t,r,i,o,0);return}a=a.next}s=s.next}while(s!==n)}function Zue(n,e,t,r){const i=[];let o,s,a,u,l;for(o=0,s=e.length;o<s;o++)a=e[o]*r,u=o<s-1?e[o+1]*r:n.length,l=Y9(n,a,u,r,!1),l===l.next&&(l.steiner=!0),i.push(ile(l));for(i.sort(Que),o=0;o<i.length;o++)t=Jue(i[o],t);return t}function Que(n,e){return n.x-e.x}function Jue(n,e){const t=ele(n,e);if(!t)return e;const r=Z9(t,n);return jd(r,r.next),jd(t,t.next)}function ele(n,e){let t=e,r=-1/0,i;const o=n.x,s=n.y;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const f=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(f<=o&&f>r&&(r=f,i=t.x<t.next.x?t:t.next,f===o))return i}t=t.next}while(t!==e);if(!i)return null;const a=i,u=i.x,l=i.y;let c=1/0,h;t=i;do o>=t.x&&t.x>=u&&o!==t.x&&Vm(s<l?o:r,s,u,l,s<l?r:o,s,t.x,t.y)&&(h=Math.abs(s-t.y)/(o-t.x),Qy(t,n)&&(h<c||h===c&&(t.x>i.x||t.x===i.x&&tle(i,t)))&&(i=t,c=h)),t=t.next;while(t!==a);return i}function tle(n,e){return Ir(n.prev,n,e.prev)<0&&Ir(e.next,n,n.next)<0}function nle(n,e,t,r){let i=n;do i.z===0&&(i.z=OA(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,rle(i)}function rle(n){let e,t,r,i,o,s,a,u,l=1;do{for(t=n,n=null,o=null,s=0;t;){for(s++,r=t,a=0,e=0;e<l&&(a++,r=r.nextZ,!!r);e++);for(u=l;a>0||u>0&&r;)a!==0&&(u===0||!r||t.z<=r.z)?(i=t,t=t.nextZ,a--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:n=i,i.prevZ=o,o=i;t=r}o.nextZ=null,l*=2}while(s>1);return n}function OA(n,e,t,r,i){return n=(n-t)*i|0,e=(e-r)*i|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function ile(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Vm(n,e,t,r,i,o,s,a){return(i-s)*(e-a)>=(n-s)*(o-a)&&(n-s)*(r-a)>=(t-s)*(e-a)&&(t-s)*(o-a)>=(i-s)*(r-a)}function ole(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!sle(n,e)&&(Qy(n,e)&&Qy(e,n)&&ale(n,e)&&(Ir(n.prev,n,e.prev)||Ir(n,e.prev,e))||dE(n,e)&&Ir(n.prev,n,n.next)>0&&Ir(e.prev,e,e.next)>0)}function Ir(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function dE(n,e){return n.x===e.x&&n.y===e.y}function K9(n,e,t,r){const i=gw(Ir(n,e,t)),o=gw(Ir(n,e,r)),s=gw(Ir(t,r,n)),a=gw(Ir(t,r,e));return!!(i!==o&&s!==a||i===0&&vw(n,t,e)||o===0&&vw(n,r,e)||s===0&&vw(t,n,r)||a===0&&vw(t,e,r))}function vw(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function gw(n){return n>0?1:n<0?-1:0}function sle(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&K9(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Qy(n,e){return Ir(n.prev,n,n.next)<0?Ir(n,e,n.next)>=0&&Ir(n,n.prev,e)>=0:Ir(n,e,n.prev)<0||Ir(n,n.next,e)<0}function ale(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next;while(t!==n);return r}function Z9(n,e){const t=new BA(n.i,n.x,n.y),r=new BA(e.i,e.x,e.y),i=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,o.next=r,r.prev=o,r}function WB(n,e,t,r){const i=new BA(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Jy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function BA(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ule(n,e,t,r){let i=0;for(let o=e,s=t-r;o<t;o+=r)i+=(n[s]-n[o])*(n[o+1]+n[s+1]),s=o;return i}class dl{static area(e){const t=e.length;let r=0;for(let i=t-1,o=0;o<t;i=o++)r+=e[i].x*e[o].y-e[o].x*e[i].y;return r*.5}static isClockWise(e){return dl.area(e)<0}static triangulateShape(e,t){const r=[],i=[],o=[];HB(e),GB(r,e);let s=e.length;t.forEach(HB);for(let u=0;u<t.length;u++)i.push(s),s+=t[u].length,GB(r,t[u]);const a=jue.triangulate(r,i);for(let u=0;u<a.length;u+=3)o.push(a.slice(u,u+3));return o}}function HB(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function GB(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class pE extends an{constructor(e=new Cd([new De(.5,.5),new De(-.5,.5),new De(-.5,-.5),new De(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],o=[];for(let a=0,u=e.length;a<u;a++){const l=e[a];s(l)}this.setAttribute("position",new At(i,3)),this.setAttribute("uv",new At(o,2)),this.computeVertexNormals();function s(a){const u=[],l=t.curveSegments!==void 0?t.curveSegments:12,c=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,d=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:d-.1,v=t.bevelOffset!==void 0?t.bevelOffset:0,g=t.bevelSegments!==void 0?t.bevelSegments:3;const m=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:lle;let _,b=!1,S,E,C,R;m&&(_=m.getSpacedPoints(c),b=!0,f=!1,S=m.computeFrenetFrames(c,!1),E=new ne,C=new ne,R=new ne),f||(g=0,d=0,p=0,v=0);const T=a.extractPoints(l);let A=T.shape;const P=T.holes;if(!dl.isClockWise(A)){A=A.reverse();for(let Z=0,de=P.length;Z<de;Z++){const me=P[Z];dl.isClockWise(me)&&(P[Z]=me.reverse())}}const W=dl.triangulateShape(A,P),N=A;for(let Z=0,de=P.length;Z<de;Z++){const me=P[Z];A=A.concat(me)}function O(Z,de,me){return de||console.error("THREE.ExtrudeGeometry: vec does not exist"),Z.clone().addScaledVector(de,me)}const z=A.length,V=W.length;function F(Z,de,me){let Ie,xe,se;const Xe=Z.x-de.x,X=Z.y-de.y,$=me.x-Z.x,le=me.y-Z.y,ze=Xe*Xe+X*X,Te=Xe*le-X*$;if(Math.abs(Te)>Number.EPSILON){const J=Math.sqrt(ze),be=Math.sqrt($*$+le*le),ke=de.x-X/J,He=de.y+Xe/J,Ue=me.x-le/be,We=me.y+$/be,Le=((Ue-ke)*le-(We-He)*$)/(Xe*le-X*$);Ie=ke+Xe*Le-Z.x,xe=He+X*Le-Z.y;const yt=Ie*Ie+xe*xe;if(yt<=2)return new De(Ie,xe);se=Math.sqrt(yt/2)}else{let J=!1;Xe>Number.EPSILON?$>Number.EPSILON&&(J=!0):Xe<-Number.EPSILON?$<-Number.EPSILON&&(J=!0):Math.sign(X)===Math.sign(le)&&(J=!0),J?(Ie=-X,xe=Xe,se=Math.sqrt(ze)):(Ie=Xe,xe=X,se=Math.sqrt(ze/2))}return new De(Ie/se,xe/se)}const U=[];for(let Z=0,de=N.length,me=de-1,Ie=Z+1;Z<de;Z++,me++,Ie++)me===de&&(me=0),Ie===de&&(Ie=0),U[Z]=F(N[Z],N[me],N[Ie]);const L=[];let j,Q=U.concat();for(let Z=0,de=P.length;Z<de;Z++){const me=P[Z];j=[];for(let Ie=0,xe=me.length,se=xe-1,Xe=Ie+1;Ie<xe;Ie++,se++,Xe++)se===xe&&(se=0),Xe===xe&&(Xe=0),j[Ie]=F(me[Ie],me[se],me[Xe]);L.push(j),Q=Q.concat(j)}for(let Z=0;Z<g;Z++){const de=Z/g,me=d*Math.cos(de*Math.PI/2),Ie=p*Math.sin(de*Math.PI/2)+v;for(let xe=0,se=N.length;xe<se;xe++){const Xe=O(N[xe],U[xe],Ie);ce(Xe.x,Xe.y,-me)}for(let xe=0,se=P.length;xe<se;xe++){const Xe=P[xe];j=L[xe];for(let X=0,$=Xe.length;X<$;X++){const le=O(Xe[X],j[X],Ie);ce(le.x,le.y,-me)}}}const K=p+v;for(let Z=0;Z<z;Z++){const de=f?O(A[Z],Q[Z],K):A[Z];b?(C.copy(S.normals[0]).multiplyScalar(de.x),E.copy(S.binormals[0]).multiplyScalar(de.y),R.copy(_[0]).add(C).add(E),ce(R.x,R.y,R.z)):ce(de.x,de.y,0)}for(let Z=1;Z<=c;Z++)for(let de=0;de<z;de++){const me=f?O(A[de],Q[de],K):A[de];b?(C.copy(S.normals[Z]).multiplyScalar(me.x),E.copy(S.binormals[Z]).multiplyScalar(me.y),R.copy(_[Z]).add(C).add(E),ce(R.x,R.y,R.z)):ce(me.x,me.y,h/c*Z)}for(let Z=g-1;Z>=0;Z--){const de=Z/g,me=d*Math.cos(de*Math.PI/2),Ie=p*Math.sin(de*Math.PI/2)+v;for(let xe=0,se=N.length;xe<se;xe++){const Xe=O(N[xe],U[xe],Ie);ce(Xe.x,Xe.y,h+me)}for(let xe=0,se=P.length;xe<se;xe++){const Xe=P[xe];j=L[xe];for(let X=0,$=Xe.length;X<$;X++){const le=O(Xe[X],j[X],Ie);b?ce(le.x,le.y+_[c-1].y,_[c-1].x+me):ce(le.x,le.y,h+me)}}}ie(),pe();function ie(){const Z=i.length/3;if(f){let de=0,me=z*de;for(let Ie=0;Ie<V;Ie++){const xe=W[Ie];_e(xe[2]+me,xe[1]+me,xe[0]+me)}de=c+g*2,me=z*de;for(let Ie=0;Ie<V;Ie++){const xe=W[Ie];_e(xe[0]+me,xe[1]+me,xe[2]+me)}}else{for(let de=0;de<V;de++){const me=W[de];_e(me[2],me[1],me[0])}for(let de=0;de<V;de++){const me=W[de];_e(me[0]+z*c,me[1]+z*c,me[2]+z*c)}}r.addGroup(Z,i.length/3-Z,0)}function pe(){const Z=i.length/3;let de=0;we(N,de),de+=N.length;for(let me=0,Ie=P.length;me<Ie;me++){const xe=P[me];we(xe,de),de+=xe.length}r.addGroup(Z,i.length/3-Z,1)}function we(Z,de){let me=Z.length;for(;--me>=0;){const Ie=me;let xe=me-1;xe<0&&(xe=Z.length-1);for(let se=0,Xe=c+g*2;se<Xe;se++){const X=z*se,$=z*(se+1),le=de+Ie+X,ze=de+xe+X,Te=de+xe+$,J=de+Ie+$;Oe(le,ze,Te,J)}}}function ce(Z,de,me){u.push(Z),u.push(de),u.push(me)}function _e(Z,de,me){Ve(Z),Ve(de),Ve(me);const Ie=i.length/3,xe=x.generateTopUV(r,i,Ie-3,Ie-2,Ie-1);Ne(xe[0]),Ne(xe[1]),Ne(xe[2])}function Oe(Z,de,me,Ie){Ve(Z),Ve(de),Ve(Ie),Ve(de),Ve(me),Ve(Ie);const xe=i.length/3,se=x.generateSideWallUV(r,i,xe-6,xe-3,xe-2,xe-1);Ne(se[0]),Ne(se[1]),Ne(se[3]),Ne(se[1]),Ne(se[2]),Ne(se[3])}function Ve(Z){i.push(u[Z*3+0]),i.push(u[Z*3+1]),i.push(u[Z*3+2])}function Ne(Z){o.push(Z.x),o.push(Z.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,r=this.parameters.options;return cle(t,r,e)}static fromJSON(e,t){const r=[];for(let o=0,s=e.shapes.length;o<s;o++){const a=t[e.shapes[o]];r.push(a)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new Mb[i.type]().fromJSON(i)),new pE(r,e.options)}}const lle={generateTopUV:function(n,e,t,r,i){const o=e[t*3],s=e[t*3+1],a=e[r*3],u=e[r*3+1],l=e[i*3],c=e[i*3+1];return[new De(o,s),new De(a,u),new De(l,c)]},generateSideWallUV:function(n,e,t,r,i,o){const s=e[t*3],a=e[t*3+1],u=e[t*3+2],l=e[r*3],c=e[r*3+1],h=e[r*3+2],f=e[i*3],d=e[i*3+1],p=e[i*3+2],v=e[o*3],g=e[o*3+1],m=e[o*3+2];return Math.abs(a-c)<Math.abs(s-l)?[new De(s,1-u),new De(l,1-h),new De(f,1-p),new De(v,1-m)]:[new De(a,1-u),new De(c,1-h),new De(d,1-p),new De(g,1-m)]}};function cle(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++){const o=n[r];t.shapes.push(o.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class mE extends uf{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,i=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mE(e.radius,e.detail)}}class H1 extends uf{constructor(e=1,t=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new H1(e.radius,e.detail)}}class vE extends an{constructor(e=.5,t=1,r=32,i=1,o=0,s=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:o,thetaLength:s},r=Math.max(3,r),i=Math.max(1,i);const a=[],u=[],l=[],c=[];let h=e;const f=(t-e)/i,d=new ne,p=new De;for(let v=0;v<=i;v++){for(let g=0;g<=r;g++){const m=o+g/r*s;d.x=h*Math.cos(m),d.y=h*Math.sin(m),u.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=f}for(let v=0;v<i;v++){const g=v*(r+1);for(let m=0;m<r;m++){const x=m+g,_=x,b=x+r+1,S=x+r+2,E=x+1;a.push(_,b,E),a.push(b,S,E)}}this.setIndex(a),this.setAttribute("position",new At(u,3)),this.setAttribute("normal",new At(l,3)),this.setAttribute("uv",new At(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vE(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class gE extends an{constructor(e=new Cd([new De(0,.5),new De(-.5,-.5),new De(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],o=[],s=[];let a=0,u=0;if(Array.isArray(e)===!1)l(e);else for(let c=0;c<e.length;c++)l(e[c]),this.addGroup(a,u,c),a+=u,u=0;this.setIndex(r),this.setAttribute("position",new At(i,3)),this.setAttribute("normal",new At(o,3)),this.setAttribute("uv",new At(s,2));function l(c){const h=i.length/3,f=c.extractPoints(t);let d=f.shape;const p=f.holes;dl.isClockWise(d)===!1&&(d=d.reverse());for(let g=0,m=p.length;g<m;g++){const x=p[g];dl.isClockWise(x)===!0&&(p[g]=x.reverse())}const v=dl.triangulateShape(d,p);for(let g=0,m=p.length;g<m;g++){const x=p[g];d=d.concat(x)}for(let g=0,m=d.length;g<m;g++){const x=d[g];i.push(x.x,x.y,0),o.push(0,0,1),s.push(x.x,x.y)}for(let g=0,m=v.length;g<m;g++){const x=v[g],_=x[0]+h,b=x[1]+h,S=x[2]+h;r.push(_,b,S),u+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return hle(t,e)}static fromJSON(e,t){const r=[];for(let i=0,o=e.shapes.length;i<o;i++){const s=t[e.shapes[i]];r.push(s)}return new gE(r,e.curveSegments)}}function hle(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const i=n[t];e.shapes.push(i.uuid)}else e.shapes.push(n.uuid);return e}class G1 extends an{constructor(e=1,t=32,r=16,i=0,o=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const u=Math.min(s+a,Math.PI);let l=0;const c=[],h=new ne,f=new ne,d=[],p=[],v=[],g=[];for(let m=0;m<=r;m++){const x=[],_=m/r;let b=0;m===0&&s===0?b=.5/t:m===r&&u===Math.PI&&(b=-.5/t);for(let S=0;S<=t;S++){const E=S/t;h.x=-e*Math.cos(i+E*o)*Math.sin(s+_*a),h.y=e*Math.cos(s+_*a),h.z=e*Math.sin(i+E*o)*Math.sin(s+_*a),p.push(h.x,h.y,h.z),f.copy(h).normalize(),v.push(f.x,f.y,f.z),g.push(E+b,1-_),x.push(l++)}c.push(x)}for(let m=0;m<r;m++)for(let x=0;x<t;x++){const _=c[m][x+1],b=c[m][x],S=c[m+1][x],E=c[m+1][x+1];(m!==0||s>0)&&d.push(_,b,E),(m!==r-1||u<Math.PI)&&d.push(b,S,E)}this.setIndex(d),this.setAttribute("position",new At(p,3)),this.setAttribute("normal",new At(v,3)),this.setAttribute("uv",new At(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new G1(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class yE extends uf{constructor(e=1,t=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new yE(e.radius,e.detail)}}class xE extends an{constructor(e=1,t=.4,r=12,i=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:o},r=Math.floor(r),i=Math.floor(i);const s=[],a=[],u=[],l=[],c=new ne,h=new ne,f=new ne;for(let d=0;d<=r;d++)for(let p=0;p<=i;p++){const v=p/i*o,g=d/r*Math.PI*2;h.x=(e+t*Math.cos(g))*Math.cos(v),h.y=(e+t*Math.cos(g))*Math.sin(v),h.z=t*Math.sin(g),a.push(h.x,h.y,h.z),c.x=e*Math.cos(v),c.y=e*Math.sin(v),f.subVectors(h,c).normalize(),u.push(f.x,f.y,f.z),l.push(p/i),l.push(d/r)}for(let d=1;d<=r;d++)for(let p=1;p<=i;p++){const v=(i+1)*d+p-1,g=(i+1)*(d-1)+p-1,m=(i+1)*(d-1)+p,x=(i+1)*d+p;s.push(v,g,x),s.push(g,m,x)}this.setIndex(s),this.setAttribute("position",new At(a,3)),this.setAttribute("normal",new At(u,3)),this.setAttribute("uv",new At(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xE(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class wE extends an{constructor(e=1,t=.4,r=64,i=8,o=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:o,q:s},r=Math.floor(r),i=Math.floor(i);const a=[],u=[],l=[],c=[],h=new ne,f=new ne,d=new ne,p=new ne,v=new ne,g=new ne,m=new ne;for(let _=0;_<=r;++_){const b=_/r*o*Math.PI*2;x(b,o,s,e,d),x(b+.01,o,s,e,p),g.subVectors(p,d),m.addVectors(p,d),v.crossVectors(g,m),m.crossVectors(v,g),v.normalize(),m.normalize();for(let S=0;S<=i;++S){const E=S/i*Math.PI*2,C=-t*Math.cos(E),R=t*Math.sin(E);h.x=d.x+(C*m.x+R*v.x),h.y=d.y+(C*m.y+R*v.y),h.z=d.z+(C*m.z+R*v.z),u.push(h.x,h.y,h.z),f.subVectors(h,d).normalize(),l.push(f.x,f.y,f.z),c.push(_/r),c.push(S/i)}}for(let _=1;_<=r;_++)for(let b=1;b<=i;b++){const S=(i+1)*(_-1)+(b-1),E=(i+1)*_+(b-1),C=(i+1)*_+b,R=(i+1)*(_-1)+b;a.push(S,E,R),a.push(E,C,R)}this.setIndex(a),this.setAttribute("position",new At(u,3)),this.setAttribute("normal",new At(l,3)),this.setAttribute("uv",new At(c,2));function x(_,b,S,E,C){const R=Math.cos(_),T=Math.sin(_),A=S/b*_,P=Math.cos(A);C.x=E*(2+P)*.5*R,C.y=E*(2+P)*T*.5,C.z=E*Math.sin(A)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new wE(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class _E extends an{constructor(e=new ok(new ne(-1,-1,0),new ne(-1,1,0),new ne(1,1,0)),t=64,r=1,i=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:o};const s=e.computeFrenetFrames(t,o);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new ne,u=new ne,l=new De;let c=new ne;const h=[],f=[],d=[],p=[];v(),this.setIndex(p),this.setAttribute("position",new At(h,3)),this.setAttribute("normal",new At(f,3)),this.setAttribute("uv",new At(d,2));function v(){for(let _=0;_<t;_++)g(_);g(o===!1?t:0),x(),m()}function g(_){c=e.getPointAt(_/t,c);const b=s.normals[_],S=s.binormals[_];for(let E=0;E<=i;E++){const C=E/i*Math.PI*2,R=Math.sin(C),T=-Math.cos(C);u.x=T*b.x+R*S.x,u.y=T*b.y+R*S.y,u.z=T*b.z+R*S.z,u.normalize(),f.push(u.x,u.y,u.z),a.x=c.x+r*u.x,a.y=c.y+r*u.y,a.z=c.z+r*u.z,h.push(a.x,a.y,a.z)}}function m(){for(let _=1;_<=t;_++)for(let b=1;b<=i;b++){const S=(i+1)*(_-1)+(b-1),E=(i+1)*_+(b-1),C=(i+1)*_+b,R=(i+1)*(_-1)+b;p.push(S,E,R),p.push(E,C,R)}}function x(){for(let _=0;_<=t;_++)for(let b=0;b<=i;b++)l.x=_/t,l.y=b/i,d.push(l.x,l.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new _E(new Mb[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Q9 extends an{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,i=new ne,o=new ne;if(e.index!==null){const s=e.attributes.position,a=e.index;let u=e.groups;u.length===0&&(u=[{start:0,count:a.count,materialIndex:0}]);for(let l=0,c=u.length;l<c;++l){const h=u[l],f=h.start,d=h.count;for(let p=f,v=f+d;p<v;p+=3)for(let g=0;g<3;g++){const m=a.getX(p+g),x=a.getX(p+(g+1)%3);i.fromBufferAttribute(s,m),o.fromBufferAttribute(s,x),$B(i,o,r)===!0&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}}else{const s=e.attributes.position;for(let a=0,u=s.count/3;a<u;a++)for(let l=0;l<3;l++){const c=3*a+l,h=3*a+(l+1)%3;i.fromBufferAttribute(s,c),o.fromBufferAttribute(s,h),$B(i,o,r)===!0&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new At(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function $B(n,e,t){const r=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(r)===!0||t.has(i)===!0?!1:(t.add(r),t.add(i),!0)}var jB=Object.freeze({__proto__:null,BoxGeometry:np,CapsuleGeometry:lE,CircleGeometry:cE,ConeGeometry:hE,CylinderGeometry:fg,DodecahedronGeometry:fE,EdgesGeometry:q9,ExtrudeGeometry:pE,IcosahedronGeometry:mE,LatheGeometry:W1,OctahedronGeometry:H1,PlaneGeometry:fl,PolyhedronGeometry:uf,RingGeometry:vE,ShapeGeometry:gE,SphereGeometry:G1,TetrahedronGeometry:yE,TorusGeometry:xE,TorusKnotGeometry:wE,TubeGeometry:_E,WireframeGeometry:Q9});class J9 extends $i{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ct(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Wm extends pi{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bE extends $i{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ct(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class eH extends bE{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new De(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Xr(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ct(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ct(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ct(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class tH extends $i{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ct(16777215),this.specular=new ct(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nH extends $i{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ct(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class rH extends $i{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class iH extends $i{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=O1,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oH extends $i{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ct(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=of,this.normalScale=new De(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class sH extends rs{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function hd(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function aH(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function uH(n){function e(i,o){return n[i]-n[o]}const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(e),r}function UA(n,e,t){const r=n.length,i=new n.constructor(r);for(let o=0,s=0;s!==r;++o){const a=t[o]*e;for(let u=0;u!==e;++u)i[s++]=n[a+u]}return i}function ak(n,e,t,r){let i=1,o=n[0];for(;o!==void 0&&o[r]===void 0;)o=n[i++];if(o===void 0)return;let s=o[r];if(s!==void 0)if(Array.isArray(s))do s=o[r],s!==void 0&&(e.push(o.time),t.push.apply(t,s)),o=n[i++];while(o!==void 0);else if(s.toArray!==void 0)do s=o[r],s!==void 0&&(e.push(o.time),s.toArray(t,t.length)),o=n[i++];while(o!==void 0);else do s=o[r],s!==void 0&&(e.push(o.time),t.push(s)),o=n[i++];while(o!==void 0)}function fle(n,e,t,r,i=30){const o=n.clone();o.name=e;const s=[];for(let u=0;u<o.tracks.length;++u){const l=o.tracks[u],c=l.getValueSize(),h=[],f=[];for(let d=0;d<l.times.length;++d){const p=l.times[d]*i;if(!(p<t||p>=r)){h.push(l.times[d]);for(let v=0;v<c;++v)f.push(l.values[d*c+v])}}h.length!==0&&(l.times=hd(h,l.times.constructor),l.values=hd(f,l.values.constructor),s.push(l))}o.tracks=s;let a=1/0;for(let u=0;u<o.tracks.length;++u)a>o.tracks[u].times[0]&&(a=o.tracks[u].times[0]);for(let u=0;u<o.tracks.length;++u)o.tracks[u].shift(-1*a);return o.resetDuration(),o}function dle(n,e=0,t=n,r=30){r<=0&&(r=30);const i=t.tracks.length,o=e/r;for(let s=0;s<i;++s){const a=t.tracks[s],u=a.ValueTypeName;if(u==="bool"||u==="string")continue;const l=n.tracks.find(function(m){return m.name===a.name&&m.ValueTypeName===u});if(l===void 0)continue;let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);let f=0;const d=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=d/3);const p=a.times.length-1;let v;if(o<=a.times[0]){const m=c,x=h-c;v=a.values.slice(m,x)}else if(o>=a.times[p]){const m=p*h+c,x=m+h-c;v=a.values.slice(m,x)}else{const m=a.createInterpolant(),x=c,_=h-c;m.evaluate(o),v=m.resultBuffer.slice(x,_)}u==="quaternion"&&new bs().fromArray(v).normalize().conjugate().toArray(v);const g=l.times.length;for(let m=0;m<g;++m){const x=m*d+f;if(u==="quaternion")bs.multiplyQuaternionsFlat(l.values,x,v,0,l.values,x);else{const _=d-f*2;for(let b=0;b<_;++b)l.values[x+b]-=v[b]}}}return n.blendMode=UP,n}const ple={convertArray:hd,isTypedArray:aH,getKeyframeOrder:uH,sortedArray:UA,flattenJSON:ak,subclip:fle,makeClipAdditive:dle};class $1{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],o=t[r-1];e:{t:{let s;n:{r:if(!(e<i)){for(let a=r+2;;){if(i===void 0){if(e<o)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===a)break;if(o=i,i=t[++r],e<i)break t}s=t.length;break n}if(!(e>=o)){const a=t[1];e<a&&(r=2,o=a);for(let u=r-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===u)break;if(i=o,o=t[--r-1],e>=o)break t}s=r,r=0;break n}break e}for(;r<s;){const a=r+s>>>1;e<t[a]?s=a:r=a+1}if(i=t[r],o=t[r-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,o,i)}return this.interpolate_(r,o,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,o=e*i;for(let s=0;s!==i;++s)t[s]=r[o+s];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class lH extends $1{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ad,endingEnd:ad}}intervalChanged_(e,t,r){const i=this.parameterPositions;let o=e-2,s=e+1,a=i[o],u=i[s];if(a===void 0)switch(this.getSettings_().endingStart){case ud:o=e,a=2*t-r;break;case Gy:o=i.length-2,a=t+i[o]-i[o+1];break;default:o=e,a=r}if(u===void 0)switch(this.getSettings_().endingEnd){case ud:s=e,u=2*r-t;break;case Gy:s=1,u=r+i[1]-i[0];break;default:s=e-1,u=t}const l=(r-t)*.5,c=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(u-r),this._offsetPrev=o*c,this._offsetNext=s*c}interpolate_(e,t,r,i){const o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,u=e*a,l=u-a,c=this._offsetPrev,h=this._offsetNext,f=this._weightPrev,d=this._weightNext,p=(r-t)/(i-t),v=p*p,g=v*p,m=-f*g+2*f*v-f*p,x=(1+f)*g+(-1.5-2*f)*v+(-.5+f)*p+1,_=(-1-d)*g+(1.5+d)*v+.5*p,b=d*g-d*v;for(let S=0;S!==a;++S)o[S]=m*s[c+S]+x*s[l+S]+_*s[u+S]+b*s[h+S];return o}}class uk extends $1{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,u=e*a,l=u-a,c=(r-t)/(i-t),h=1-c;for(let f=0;f!==a;++f)o[f]=s[l+f]*h+s[u+f]*c;return o}}class cH extends $1{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Pu{constructor(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=hd(t,this.TimeBufferType),this.values=hd(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:hd(e.times,Array),values:hd(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new cH(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new uk(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new lH(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Wy:t=this.InterpolantFactoryMethodDiscrete;break;case Hy:t=this.InterpolantFactoryMethodLinear;break;case k_:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Wy;case this.InterpolantFactoryMethodLinear:return Hy;case this.InterpolantFactoryMethodSmooth:return k_}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let o=0,s=i-1;for(;o!==i&&r[o]<e;)++o;for(;s!==-1&&r[s]>t;)--s;if(++s,o!==0||s!==i){o>=s&&(s=Math.max(s,1),o=s-1);const a=this.getValueSize();this.times=r.slice(o,s),this.values=this.values.slice(o*a,s*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,o=r.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let s=null;for(let a=0;a!==o;a++){const u=r[a];if(typeof u=="number"&&isNaN(u)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,u),e=!1;break}if(s!==null&&s>u){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,u,s),e=!1;break}s=u}if(i!==void 0&&aH(i))for(let a=0,u=i.length;a!==u;++a){const l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),i=this.getInterpolation()===k_,o=e.length-1;let s=1;for(let a=1;a<o;++a){let u=!1;const l=e[a],c=e[a+1];if(l!==c&&(a!==1||l!==e[0]))if(i)u=!0;else{const h=a*r,f=h-r,d=h+r;for(let p=0;p!==r;++p){const v=t[h+p];if(v!==t[f+p]||v!==t[d+p]){u=!0;break}}}if(u){if(a!==s){e[s]=e[a];const h=a*r,f=s*r;for(let d=0;d!==r;++d)t[f+d]=t[h+d]}++s}}if(o>0){e[s]=e[o];for(let a=o*r,u=s*r,l=0;l!==r;++l)t[u+l]=t[a+l];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=this.constructor,i=new r(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Pu.prototype.TimeBufferType=Float32Array;Pu.prototype.ValueBufferType=Float32Array;Pu.prototype.DefaultInterpolation=Hy;class rp extends Pu{}rp.prototype.ValueTypeName="bool";rp.prototype.ValueBufferType=Array;rp.prototype.DefaultInterpolation=Wy;rp.prototype.InterpolantFactoryMethodLinear=void 0;rp.prototype.InterpolantFactoryMethodSmooth=void 0;class lk extends Pu{}lk.prototype.ValueTypeName="color";class e1 extends Pu{}e1.prototype.ValueTypeName="number";class hH extends $1{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const o=this.resultBuffer,s=this.sampleValues,a=this.valueSize,u=(r-t)/(i-t);let l=e*a;for(let c=l+a;l!==c;l+=4)bs.slerpFlat(o,0,s,l-a,s,l,u);return o}}class dg extends Pu{InterpolantFactoryMethodLinear(e){return new hH(this.times,this.values,this.getValueSize(),e)}}dg.prototype.ValueTypeName="quaternion";dg.prototype.DefaultInterpolation=Hy;dg.prototype.InterpolantFactoryMethodSmooth=void 0;class ip extends Pu{}ip.prototype.ValueTypeName="string";ip.prototype.ValueBufferType=Array;ip.prototype.DefaultInterpolation=Wy;ip.prototype.InterpolantFactoryMethodLinear=void 0;ip.prototype.InterpolantFactoryMethodSmooth=void 0;class t1 extends Pu{}t1.prototype.ValueTypeName="vector";class n1{constructor(e,t=-1,r,i=JS){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=aa(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let s=0,a=r.length;s!==a;++s)t.push(vle(r[s]).scale(i));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,s=r.length;o!==s;++o)t.push(Pu.toJSON(r[o]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const o=t.length,s=[];for(let a=0;a<o;a++){let u=[],l=[];u.push((a+o-1)%o,a,(a+1)%o),l.push(0,1,0);const c=uH(u);u=UA(u,1,c),l=UA(l,1,c),!i&&u[0]===0&&(u.push(o),l.push(l[0])),s.push(new e1(".morphTargetInfluences["+t[a].name+"]",u,l).scale(1/r))}return new this(e,-1,s)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},o=/^([\w-]*?)([\d]+)$/;for(let a=0,u=e.length;a<u;a++){const l=e[a],c=l.name.match(o);if(c&&c.length>1){const h=c[1];let f=i[h];f||(i[h]=f=[]),f.push(l)}}const s=[];for(const a in i)s.push(this.CreateFromMorphTargetSequence(a,i[a],t,r));return s}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,f,d,p,v){if(d.length!==0){const g=[],m=[];ak(d,g,m,p),g.length!==0&&v.push(new h(f,g,m))}},i=[],o=e.name||"default",s=e.fps||30,a=e.blendMode;let u=e.length||-1;const l=e.hierarchy||[];for(let h=0;h<l.length;h++){const f=l[h].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const d={};let p;for(p=0;p<f.length;p++)if(f[p].morphTargets)for(let v=0;v<f[p].morphTargets.length;v++)d[f[p].morphTargets[v]]=-1;for(const v in d){const g=[],m=[];for(let x=0;x!==f[p].morphTargets.length;++x){const _=f[p];g.push(_.time),m.push(_.morphTarget===v?1:0)}i.push(new e1(".morphTargetInfluence["+v+"]",g,m))}u=d.length*s}else{const d=".bones["+t[h].name+"]";r(t1,d+".position",f,"pos",i),r(dg,d+".quaternion",f,"rot",i),r(t1,d+".scale",f,"scl",i)}}return i.length===0?null:new this(o,u,i,a)}resetDuration(){const e=this.tracks;let t=0;for(let r=0,i=e.length;r!==i;++r){const o=this.tracks[r];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mle(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return e1;case"vector":case"vector2":case"vector3":case"vector4":return t1;case"color":return lk;case"quaternion":return dg;case"bool":case"boolean":return rp;case"string":return ip}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function vle(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=mle(n.type);if(n.times===void 0){const t=[],r=[];ak(n.keys,t,r,"value"),n.times=t,n.values=r}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const ec={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class ck{constructor(e,t,r){const i=this;let o=!1,s=0,a=0,u;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(c){a++,o===!1&&i.onStart!==void 0&&i.onStart(c,s,a),o=!0},this.itemEnd=function(c){s++,i.onProgress!==void 0&&i.onProgress(c,s,a),s===a&&(o=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(c){i.onError!==void 0&&i.onError(c)},this.resolveURL=function(c){return u?u(c):c},this.setURLModifier=function(c){return u=c,this},this.addHandler=function(c,h){return l.push(c,h),this},this.removeHandler=function(c){const h=l.indexOf(c);return h!==-1&&l.splice(h,2),this},this.getHandler=function(c){for(let h=0,f=l.length;h<f;h+=2){const d=l[h],p=l[h+1];if(d.global&&(d.lastIndex=0),d.test(c))return p}return null}}}const fH=new ck;let ks=class{constructor(e){this.manager=e!==void 0?e:fH,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,o){r.load(e,i,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}};ks.DEFAULT_MATERIAL_NAME="__DEFAULT";const zl={};class gle extends Error{constructor(e,t){super(e),this.response=t}}class gc extends ks{constructor(e){super(e)}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=ec.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(zl[e]!==void 0){zl[e].push({onLoad:t,onProgress:r,onError:i});return}zl[e]=[],zl[e].push({onLoad:t,onProgress:r,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,u=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const c=zl[e],h=l.body.getReader(),f=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=f?parseInt(f):0,p=d!==0;let v=0;const g=new ReadableStream({start(m){x();function x(){h.read().then(({done:_,value:b})=>{if(_)m.close();else{v+=b.byteLength;const S=new ProgressEvent("progress",{lengthComputable:p,loaded:v,total:d});for(let E=0,C=c.length;E<C;E++){const R=c[E];R.onProgress&&R.onProgress(S)}m.enqueue(b),x()}})}}});return new Response(g)}else throw new gle(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(u){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),f=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(f);return l.arrayBuffer().then(p=>d.decode(p))}}}).then(l=>{ec.add(e,l);const c=zl[e];delete zl[e];for(let h=0,f=c.length;h<f;h++){const d=c[h];d.onLoad&&d.onLoad(l)}}).catch(l=>{const c=zl[e];if(c===void 0)throw this.manager.itemError(e),l;delete zl[e];for(let h=0,f=c.length;h<f;h++){const d=c[h];d.onError&&d.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class yle extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=new gc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},r,i)}parse(e){const t=[];for(let r=0;r<e.length;r++){const i=n1.parse(e[r]);t.push(i)}return t}}class xle extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=[],a=new aE,u=new gc(this.manager);u.setPath(this.path),u.setResponseType("arraybuffer"),u.setRequestHeader(this.requestHeader),u.setWithCredentials(o.withCredentials);let l=0;function c(h){u.load(e[h],function(f){const d=o.parse(f,!0);s[h]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},l+=1,l===6&&(d.mipmapCount===1&&(a.minFilter=Fn),a.image=s,a.format=d.format,a.needsUpdate=!0,t&&t(a))},r,i)}if(Array.isArray(e))for(let h=0,f=e.length;h<f;++h)c(h);else u.load(e,function(h){const f=o.parse(h,!0);if(f.isCubemap){const d=f.mipmaps.length/f.mipmapCount;for(let p=0;p<d;p++){s[p]={mipmaps:[]};for(let v=0;v<f.mipmapCount;v++)s[p].mipmaps.push(f.mipmaps[p*f.mipmapCount+v]),s[p].format=f.format,s[p].width=f.width,s[p].height=f.height}a.image=s}else a.image.width=f.width,a.image.height=f.height,a.mipmaps=f.mipmaps;f.mipmapCount===1&&(a.minFilter=Fn),a.format=f.format,a.needsUpdate=!0,t&&t(a)},r,i);return a}}class r1 extends ks{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,s=ec.get(e);if(s!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s;const a=Yy("img");function u(){c(),ec.add(e,this),t&&t(this),o.manager.itemEnd(e)}function l(h){c(),i&&i(h),o.manager.itemError(e),o.manager.itemEnd(e)}function c(){a.removeEventListener("load",u,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",u,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}class wle extends ks{constructor(e){super(e)}load(e,t,r,i){const o=new U1;o.colorSpace=Rn;const s=new r1(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function u(l){s.load(e[l],function(c){o.images[l]=c,a++,a===6&&(o.needsUpdate=!0,t&&t(o))},void 0,i)}for(let l=0;l<e.length;++l)u(l);return o}}class _le extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=new ac,a=new gc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(o.withCredentials),a.load(e,function(u){let l;try{l=o.parse(u)}catch(c){if(i!==void 0)i(c);else{console.error(c);return}}l.image!==void 0?s.image=l.image:l.data!==void 0&&(s.image.width=l.width,s.image.height=l.height,s.image.data=l.data),s.wrapS=l.wrapS!==void 0?l.wrapS:qr,s.wrapT=l.wrapT!==void 0?l.wrapT:qr,s.magFilter=l.magFilter!==void 0?l.magFilter:Fn,s.minFilter=l.minFilter!==void 0?l.minFilter:Fn,s.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0?s.colorSpace=l.colorSpace:l.encoding!==void 0&&(s.encoding=l.encoding),l.flipY!==void 0&&(s.flipY=l.flipY),l.format!==void 0&&(s.format=l.format),l.type!==void 0&&(s.type=l.type),l.mipmaps!==void 0&&(s.mipmaps=l.mipmaps,s.minFilter=Vh),l.mipmapCount===1&&(s.minFilter=Fn),l.generateMipmaps!==void 0&&(s.generateMipmaps=l.generateMipmaps),s.needsUpdate=!0,t&&t(s,l)},r,i),s}}class dH extends ks{constructor(e){super(e)}load(e,t,r,i){const o=new Lr,s=new r1(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(a){o.image=a,o.needsUpdate=!0,t!==void 0&&t(o)},r,i),o}}class lf extends $n{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ct(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class pH extends lf{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy($n.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ct(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const mM=new tn,XB=new ne,qB=new ne;class hk{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new De(512,512),this.map=null,this.mapPass=null,this.matrix=new tn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new z1,this._frameExtents=new De(1,1),this._viewportCount=1,this._viewports=[new On(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;XB.setFromMatrixPosition(e.matrixWorld),t.position.copy(XB),qB.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(qB),t.updateMatrixWorld(),mM.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mM),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(mM)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ble extends hk{constructor(){super(new Si(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=Lv*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(r!==t.fov||i!==t.aspect||o!==t.far)&&(t.fov=r,t.aspect=i,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class mH extends lf{constructor(e,t,r=0,i=Math.PI/3,o=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy($n.DEFAULT_UP),this.updateMatrix(),this.target=new $n,this.distance=r,this.angle=i,this.penumbra=o,this.decay=s,this.map=null,this.shadow=new ble}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const YB=new tn,o0=new ne,vM=new ne;class Sle extends hk{constructor(){super(new Si(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new De(4,2),this._viewportCount=6,this._viewports=[new On(2,1,1,1),new On(0,1,1,1),new On(3,1,1,1),new On(1,1,1,1),new On(3,0,1,1),new On(1,0,1,1)],this._cubeDirections=[new ne(1,0,0),new ne(-1,0,0),new ne(0,0,1),new ne(0,0,-1),new ne(0,1,0),new ne(0,-1,0)],this._cubeUps=[new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,0,1),new ne(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,o=e.distance||r.far;o!==r.far&&(r.far=o,r.updateProjectionMatrix()),o0.setFromMatrixPosition(e.matrixWorld),r.position.copy(o0),vM.copy(r.position),vM.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(vM),r.updateMatrixWorld(),i.makeTranslation(-o0.x,-o0.y,-o0.z),YB.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(YB)}}class vH extends lf{constructor(e,t,r=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new Sle}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Ele extends hk{constructor(){super(new af(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class gH extends lf{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy($n.DEFAULT_UP),this.updateMatrix(),this.target=new $n,this.shadow=new Ele}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class yH extends lf{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class xH extends lf{constructor(e,t,r=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class wH{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ne)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,o=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*o),t.addScaledVector(s[3],.488603*r),t.addScaledVector(s[4],1.092548*(r*i)),t.addScaledVector(s[5],1.092548*(i*o)),t.addScaledVector(s[6],.315392*(3*o*o-1)),t.addScaledVector(s[7],1.092548*(r*o)),t.addScaledVector(s[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,o=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*o),t.addScaledVector(s[3],2*.511664*r),t.addScaledVector(s[4],2*.429043*r*i),t.addScaledVector(s[5],2*.429043*i*o),t.addScaledVector(s[6],.743125*o*o-.247708),t.addScaledVector(s[7],2*.429043*r*o),t.addScaledVector(s[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const r=e.x,i=e.y,o=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*o,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*r*o,t[8]=.546274*(r*r-i*i)}}class _H extends lf{constructor(e=new wH,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class SE extends ks{constructor(e){super(e),this.textures={}}load(e,t,r,i){const o=this,s=new gc(o.manager);s.setPath(o.path),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},r,i)}parse(e){const t=this.textures;function r(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const i=SE.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new ct().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const s=e.uniforms[o];switch(i.uniforms[o]={},s.type){case"t":i.uniforms[o].value=r(s.value);break;case"c":i.uniforms[o].value=new ct().setHex(s.value);break;case"v2":i.uniforms[o].value=new De().fromArray(s.value);break;case"v3":i.uniforms[o].value=new ne().fromArray(s.value);break;case"v4":i.uniforms[o].value=new On().fromArray(s.value);break;case"m3":i.uniforms[o].value=new pn().fromArray(s.value);break;case"m4":i.uniforms[o].value=new tn().fromArray(s.value);break;default:i.uniforms[o].value=s.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)i.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),i.normalScale=new De().fromArray(o)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new De().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=r(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:J9,SpriteMaterial:QP,RawShaderMaterial:Wm,ShaderMaterial:pi,PointsMaterial:ek,MeshPhysicalMaterial:eH,MeshStandardMaterial:bE,MeshPhongMaterial:tH,MeshToonMaterial:nH,MeshNormalMaterial:rH,MeshLambertMaterial:iH,MeshDepthMaterial:KP,MeshDistanceMaterial:ZP,MeshBasicMaterial:sf,MeshMatcapMaterial:oH,LineDashedMaterial:sH,LineBasicMaterial:rs,Material:$i};return new t[e]}}class zA{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class bH extends an{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class SH extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=new gc(o.manager);s.setPath(o.path),s.setRequestHeader(o.requestHeader),s.setWithCredentials(o.withCredentials),s.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(u){i?i(u):console.error(u),o.manager.itemError(e)}},r,i)}parse(e){const t={},r={};function i(d,p){if(t[p]!==void 0)return t[p];const g=d.interleavedBuffers[p],m=o(d,g.buffer),x=Om(g.type,m),_=new oE(x,g.stride);return _.uuid=g.uuid,t[p]=_,_}function o(d,p){if(r[p]!==void 0)return r[p];const g=d.arrayBuffers[p],m=new Uint32Array(g).buffer;return r[p]=m,m}const s=e.isInstancedBufferGeometry?new bH:new an,a=e.data.index;if(a!==void 0){const d=Om(a.type,a.array);s.setIndex(new In(d,1))}const u=e.data.attributes;for(const d in u){const p=u[d];let v;if(p.isInterleavedBufferAttribute){const g=i(e.data,p.data);v=new $d(g,p.itemSize,p.offset,p.normalized)}else{const g=Om(p.type,p.array),m=p.isInstancedBufferAttribute?Ov:In;v=new m(g,p.itemSize,p.normalized)}p.name!==void 0&&(v.name=p.name),p.usage!==void 0&&v.setUsage(p.usage),s.setAttribute(d,v)}const l=e.data.morphAttributes;if(l)for(const d in l){const p=l[d],v=[];for(let g=0,m=p.length;g<m;g++){const x=p[g];let _;if(x.isInterleavedBufferAttribute){const b=i(e.data,x.data);_=new $d(b,x.itemSize,x.offset,x.normalized)}else{const b=Om(x.type,x.array);_=new In(b,x.itemSize,x.normalized)}x.name!==void 0&&(_.name=x.name),v.push(_)}s.morphAttributes[d]=v}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let d=0,p=h.length;d!==p;++d){const v=h[d];s.addGroup(v.start,v.count,v.materialIndex)}const f=e.data.boundingSphere;if(f!==void 0){const d=new ne;f.center!==void 0&&d.fromArray(f.center),s.boundingSphere=new Ao(d,f.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class Cle extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=this.path===""?zA.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new gc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){let l=null;try{l=JSON.parse(u)}catch(h){i!==void 0&&i(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(l,t)},r,i)}async loadAsync(e,t){const r=this,i=this.path===""?zA.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const o=new gc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const s=await o.loadAsync(e,t),a=JSON.parse(s),u=a.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(a)}parse(e,t){const r=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),s=this.parseImages(e.images,function(){t!==void 0&&t(l)}),a=this.parseTextures(e.textures,s),u=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,o,u,a,r),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),t!==void 0){let h=!1;for(const f in s)if(s[f].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),u=this.parseObject(e.object,i,a,s,t),l=this.parseSkeletons(e.skeletons,u);return this.bindSkeletons(u,l),u}parseShapes(e){const t={};if(e!==void 0)for(let r=0,i=e.length;r<i;r++){const o=new Cd().fromJSON(e[r]);t[o.uuid]=o}return t}parseSkeletons(e,t){const r={},i={};if(t.traverse(function(o){o.isBone&&(i[o.uuid]=o)}),e!==void 0)for(let o=0,s=e.length;o<s;o++){const a=new sE().fromJSON(e[o],i);r[a.uuid]=a}return r}parseGeometries(e,t){const r={};if(e!==void 0){const i=new SH;for(let o=0,s=e.length;o<s;o++){let a;const u=e[o];switch(u.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(u);break;default:u.type in jB?a=jB[u.type].fromJSON(u,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${u.type}"`)}a.uuid=u.uuid,u.name!==void 0&&(a.name=u.name),u.userData!==void 0&&(a.userData=u.userData),r[u.uuid]=a}}return r}parseMaterials(e,t){const r={},i={};if(e!==void 0){const o=new SE;o.setTextures(t);for(let s=0,a=e.length;s<a;s++){const u=e[s];r[u.uuid]===void 0&&(r[u.uuid]=o.parse(u)),i[u.uuid]=r[u.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let r=0;r<e.length;r++){const i=e[r],o=n1.parse(i);t[o.uuid]=o}return t}parseImages(e,t){const r=this,i={};let o;function s(u){return r.manager.itemStart(u),o.load(u,function(){r.manager.itemEnd(u)},void 0,function(){r.manager.itemError(u),r.manager.itemEnd(u)})}function a(u){if(typeof u=="string"){const l=u,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:r.resourcePath+l;return s(c)}else return u.data?{data:Om(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){const u=new ck(t);o=new r1(u),o.setCrossOrigin(this.crossOrigin);for(let l=0,c=e.length;l<c;l++){const h=e[l],f=h.url;if(Array.isArray(f)){const d=[];for(let p=0,v=f.length;p<v;p++){const g=f[p],m=a(g);m!==null&&(m instanceof HTMLImageElement?d.push(m):d.push(new ac(m.data,m.width,m.height)))}i[h.uuid]=new ld(d)}else{const d=a(h.url);i[h.uuid]=new ld(d)}}}return i}async parseImagesAsync(e){const t=this,r={};let i;async function o(s){if(typeof s=="string"){const a=s,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await i.loadAsync(u)}else return s.data?{data:Om(s.type,s.data),width:s.width,height:s.height}:null}if(e!==void 0&&e.length>0){i=new r1(this.manager),i.setCrossOrigin(this.crossOrigin);for(let s=0,a=e.length;s<a;s++){const u=e[s],l=u.url;if(Array.isArray(l)){const c=[];for(let h=0,f=l.length;h<f;h++){const d=l[h],p=await o(d);p!==null&&(p instanceof HTMLImageElement?c.push(p):c.push(new ac(p.data,p.width,p.height)))}r[u.uuid]=new ld(c)}else{const c=await o(u.url);r[u.uuid]=new ld(c)}}}return r}parseTextures(e,t){function r(o,s){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),s[o])}const i={};if(e!==void 0)for(let o=0,s=e.length;o<s;o++){const a=e[o];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const u=t[a.image],l=u.data;let c;Array.isArray(l)?(c=new U1,l.length===6&&(c.needsUpdate=!0)):(l&&l.data?c=new ac:c=new Lr,l&&(c.needsUpdate=!0)),c.source=u,c.uuid=a.uuid,a.name!==void 0&&(c.name=a.name),a.mapping!==void 0&&(c.mapping=r(a.mapping,Mle)),a.channel!==void 0&&(c.channel=a.channel),a.offset!==void 0&&c.offset.fromArray(a.offset),a.repeat!==void 0&&c.repeat.fromArray(a.repeat),a.center!==void 0&&c.center.fromArray(a.center),a.rotation!==void 0&&(c.rotation=a.rotation),a.wrap!==void 0&&(c.wrapS=r(a.wrap[0],KB),c.wrapT=r(a.wrap[1],KB)),a.format!==void 0&&(c.format=a.format),a.internalFormat!==void 0&&(c.internalFormat=a.internalFormat),a.type!==void 0&&(c.type=a.type),a.colorSpace!==void 0&&(c.colorSpace=a.colorSpace),a.encoding!==void 0&&(c.encoding=a.encoding),a.minFilter!==void 0&&(c.minFilter=r(a.minFilter,ZB)),a.magFilter!==void 0&&(c.magFilter=r(a.magFilter,ZB)),a.anisotropy!==void 0&&(c.anisotropy=a.anisotropy),a.flipY!==void 0&&(c.flipY=a.flipY),a.generateMipmaps!==void 0&&(c.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(c.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(c.compareFunction=a.compareFunction),a.userData!==void 0&&(c.userData=a.userData),i[a.uuid]=c}return i}parseObject(e,t,r,i,o){let s;function a(f){return t[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",f),t[f]}function u(f){if(f!==void 0){if(Array.isArray(f)){const d=[];for(let p=0,v=f.length;p<v;p++){const g=f[p];r[g]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",g),d.push(r[g])}return d}return r[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",f),r[f]}}function l(f){return i[f]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",f),i[f]}let c,h;switch(e.type){case"Scene":s=new vc,e.background!==void 0&&(Number.isInteger(e.background)?s.background=new ct(e.background):s.background=l(e.background)),e.environment!==void 0&&(s.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?s.fog=new iE(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(s.fog=new rE(e.fog.color,e.fog.density)),e.fog.name!==""&&(s.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(s.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(s.backgroundIntensity=e.backgroundIntensity);break;case"PerspectiveCamera":s=new Si(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(s.focus=e.focus),e.zoom!==void 0&&(s.zoom=e.zoom),e.filmGauge!==void 0&&(s.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(s.filmOffset=e.filmOffset),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new af(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(s.zoom=e.zoom),e.view!==void 0&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new yH(e.color,e.intensity);break;case"DirectionalLight":s=new gH(e.color,e.intensity);break;case"PointLight":s=new vH(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new xH(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new mH(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":s=new pH(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=new _H().fromJSON(e);break;case"SkinnedMesh":c=a(e.geometry),h=u(e.material),s=new B9(c,h),e.bindMode!==void 0&&(s.bindMode=e.bindMode),e.bindMatrix!==void 0&&s.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(s.skeleton=e.skeleton);break;case"Mesh":c=a(e.geometry),h=u(e.material),s=new yr(c,h);break;case"InstancedMesh":c=a(e.geometry),h=u(e.material);const f=e.count,d=e.instanceMatrix,p=e.instanceColor;s=new U9(c,h,f),s.instanceMatrix=new Ov(new Float32Array(d.array),16),p!==void 0&&(s.instanceColor=new Ov(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":c=a(e.geometry),h=u(e.material),s=new z9(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,h),s.geometry=c,s.perObjectFrustumCulled=e.perObjectFrustumCulled,s.sortObjects=e.sortObjects,s._drawRanges=e.drawRanges,s._reservedRanges=e.reservedRanges,s._visibility=e.visibility,s._active=e.active,s._bounds=e.bounds.map(v=>{const g=new Jo;g.min.fromArray(v.boxMin),g.max.fromArray(v.boxMax);const m=new Ao;return m.radius=v.sphereRadius,m.center.fromArray(v.sphereCenter),{boxInitialized:v.boxInitialized,box:g,sphereInitialized:v.sphereInitialized,sphere:m}}),s._maxGeometryCount=e.maxGeometryCount,s._maxVertexCount=e.maxVertexCount,s._maxIndexCount=e.maxIndexCount,s._geometryInitialized=e.geometryInitialized,s._geometryCount=e.geometryCount,s._matricesTexture=l(e.matricesTexture.uuid);break;case"LOD":s=new O9;break;case"Line":s=new Gh(a(e.geometry),u(e.material));break;case"LineLoop":s=new V9(a(e.geometry),u(e.material));break;case"LineSegments":s=new Au(a(e.geometry),u(e.material));break;case"PointCloud":case"Points":s=new W9(a(e.geometry),u(e.material));break;case"Sprite":s=new F9(u(e.material));break;case"Group":s=new zm;break;case"Bone":s=new JP;break;default:s=new $n}if(s.uuid=e.uuid,e.name!==void 0&&(s.name=e.name),e.matrix!==void 0?(s.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(e.position!==void 0&&s.position.fromArray(e.position),e.rotation!==void 0&&s.rotation.fromArray(e.rotation),e.quaternion!==void 0&&s.quaternion.fromArray(e.quaternion),e.scale!==void 0&&s.scale.fromArray(e.scale)),e.up!==void 0&&s.up.fromArray(e.up),e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(s.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(s.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(s.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&s.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(s.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(s.visible=e.visible),e.frustumCulled!==void 0&&(s.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(s.renderOrder=e.renderOrder),e.userData!==void 0&&(s.userData=e.userData),e.layers!==void 0&&(s.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let d=0;d<f.length;d++)s.add(this.parseObject(f[d],t,r,i,o))}if(e.animations!==void 0){const f=e.animations;for(let d=0;d<f.length;d++){const p=f[d];s.animations.push(o[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(s.autoUpdate=e.autoUpdate);const f=e.levels;for(let d=0;d<f.length;d++){const p=f[d],v=s.getObjectByProperty("uuid",p.object);v!==void 0&&s.addLevel(v,p.distance,p.hysteresis)}}return s}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const i=t[r.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(i,r.bindMatrix)}})}}const Mle={UVMapping:ZS,CubeReflectionMapping:mc,CubeRefractionMapping:zh,EquirectangularReflectionMapping:By,EquirectangularRefractionMapping:Uy,CubeUVReflectionMapping:ag},KB={RepeatWrapping:zy,ClampToEdgeWrapping:qr,MirroredRepeatWrapping:Vy},ZB={NearestFilter:ti,NearestMipmapNearestFilter:Sb,NearestMipmapLinearFilter:$0,LinearFilter:Fn,LinearMipmapNearestFilter:PP,LinearMipmapLinearFilter:Vh};class Tle extends ks{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,s=ec.get(e);if(s!==void 0){if(o.manager.itemStart(e),s.then){s.then(l=>{t&&t(l),o.manager.itemEnd(e)}).catch(l=>{i&&i(l)});return}return setTimeout(function(){t&&t(s),o.manager.itemEnd(e)},0),s}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const u=fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(l){return ec.add(e,l),t&&t(l),o.manager.itemEnd(e),l}).catch(function(l){i&&i(l),ec.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});ec.add(e,u),o.manager.itemStart(e)}}let yw;class fk{static getContext(){return yw===void 0&&(yw=new(window.AudioContext||window.webkitAudioContext)),yw}static setContext(e){yw=e}}class Rle extends ks{constructor(e){super(e)}load(e,t,r,i){const o=this,s=new gc(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(u){try{const l=u.slice(0);fk.getContext().decodeAudioData(l,function(h){t(h)}).catch(a)}catch(l){a(l)}},r,i);function a(u){i?i(u):console.error(u),o.manager.itemError(e)}}}const QB=new tn,JB=new tn,kf=new tn;class Ale{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Si,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Si,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,kf.copy(e.projectionMatrix);const i=t.eyeSep/2,o=i*t.near/t.focus,s=t.near*Math.tan(Sd*t.fov*.5)/t.zoom;let a,u;JB.elements[12]=-i,QB.elements[12]=i,a=-s*t.aspect+o,u=s*t.aspect+o,kf.elements[0]=2*t.near/(u-a),kf.elements[8]=(u+a)/(u-a),this.cameraL.projectionMatrix.copy(kf),a=-s*t.aspect-o,u=s*t.aspect-o,kf.elements[0]=2*t.near/(u-a),kf.elements[8]=(u+a)/(u-a),this.cameraR.projectionMatrix.copy(kf)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(JB),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(QB)}}class EE{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=e5(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=e5();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function e5(){return(typeof performance>"u"?Date:performance).now()}const Df=new ne,t5=new bs,Ile=new ne,Nf=new ne;class Ple extends $n{constructor(){super(),this.type="AudioListener",this.context=fk.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new EE}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Df,t5,Ile),Nf.set(0,0,-1).applyQuaternion(t5),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Df.x,i),t.positionY.linearRampToValueAtTime(Df.y,i),t.positionZ.linearRampToValueAtTime(Df.z,i),t.forwardX.linearRampToValueAtTime(Nf.x,i),t.forwardY.linearRampToValueAtTime(Nf.y,i),t.forwardZ.linearRampToValueAtTime(Nf.z,i),t.upX.linearRampToValueAtTime(r.x,i),t.upY.linearRampToValueAtTime(r.y,i),t.upZ.linearRampToValueAtTime(r.z,i)}else t.setPosition(Df.x,Df.y,Df.z),t.setOrientation(Nf.x,Nf.y,Nf.z,r.x,r.y,r.z)}}class EH extends $n{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Lf=new ne,n5=new bs,kle=new ne,Ff=new ne;class Dle extends EH{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lf,n5,kle),Ff.set(0,0,1).applyQuaternion(n5);const t=this.panner;if(t.positionX){const r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Lf.x,r),t.positionY.linearRampToValueAtTime(Lf.y,r),t.positionZ.linearRampToValueAtTime(Lf.z,r),t.orientationX.linearRampToValueAtTime(Ff.x,r),t.orientationY.linearRampToValueAtTime(Ff.y,r),t.orientationZ.linearRampToValueAtTime(Ff.z,r)}else t.setPosition(Lf.x,Lf.y,Lf.z),t.setOrientation(Ff.x,Ff.y,Ff.z)}}class Nle{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let r=0;r<t.length;r++)e+=t[r];return e/t.length}}class CH{constructor(e,t,r){this.binding=e,this.valueSize=r;let i,o,s;switch(t){case"quaternion":i=this._slerp,o=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:i=this._lerp,o=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,o=e*i+i;let s=this.cumulativeWeight;if(s===0){for(let a=0;a!==i;++a)r[o+a]=r[a];s=t}else{s+=t;const a=t/s;this._mixBufferRegion(r,o,0,a,i)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,o=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const u=t*this._origIndex;this._mixBufferRegion(r,i,u,1-o,t)}s>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let u=t,l=t+t;u!==l;++u)if(r[u]!==r[u+t]){a.setValue(r,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,i=r*this._origIndex;e.getValue(t,i);for(let o=r,s=i;o!==s;++o)t[o]=t[i+o%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,o){if(i>=.5)for(let s=0;s!==o;++s)e[t+s]=e[r+s]}_slerp(e,t,r,i){bs.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,o){const s=this._workIndex*o;bs.multiplyQuaternionsFlat(e,s,e,t,e,r),bs.slerpFlat(e,t,e,t,e,s,i)}_lerp(e,t,r,i,o){const s=1-i;for(let a=0;a!==o;++a){const u=t+a;e[u]=e[u]*s+e[r+a]*i}}_lerpAdditive(e,t,r,i,o){for(let s=0;s!==o;++s){const a=t+s;e[a]=e[a]+e[r+s]*i}}}const dk="\\[\\]\\.:\\/",Lle=new RegExp("["+dk+"]","g"),pk="[^"+dk+"]",Fle="[^"+dk.replace("\\.","")+"]",Ole=/((?:WC+[\/:])*)/.source.replace("WC",pk),Ble=/(WCOD+)?/.source.replace("WCOD",Fle),Ule=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pk),zle=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pk),Vle=new RegExp("^"+Ole+Ble+Ule+zle+"$"),Wle=["material","materials","bones","map"];class Hle{constructor(e,t,r){const i=r||Ln.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=r.length;i!==o;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}class Ln{constructor(e,t,r){this.path=t,this.parsedPath=r||Ln.parseTrackName(t),this.node=Ln.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Ln.Composite(e,t,r):new Ln(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Lle,"")}static parseTrackName(e){const t=Vle.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const o=r.nodeName.substring(i+1);Wle.indexOf(o)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=o)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(o){for(let s=0;s<o.length;s++){const a=o[s];if(a.name===t||a.uuid===t)return a;const u=r(a.children);if(u)return u}return null},i=r(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)e[t++]=r[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let i=0,o=r.length;i!==o;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,i=t.propertyName;let o=t.propertyIndex;if(e||(e=Ln.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let l=t.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===l){l=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const s=e[i];if(s===void 0){const l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let u=this.BindingType.Direct;if(o!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=o}else s.fromArray!==void 0&&s.toArray!==void 0?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ln.Composite=Hle;Ln.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ln.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ln.prototype.GetterByBindingType=[Ln.prototype._getValue_direct,Ln.prototype._getValue_array,Ln.prototype._getValue_arrayElement,Ln.prototype._getValue_toArray];Ln.prototype.SetterByBindingTypeAndVersioning=[[Ln.prototype._setValue_direct,Ln.prototype._setValue_direct_setNeedsUpdate,Ln.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_array,Ln.prototype._setValue_array_setNeedsUpdate,Ln.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_arrayElement,Ln.prototype._setValue_arrayElement_setNeedsUpdate,Ln.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ln.prototype._setValue_fromArray,Ln.prototype._setValue_fromArray_setNeedsUpdate,Ln.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Gle{constructor(){this.isAnimationObjectGroup=!0,this.uuid=aa(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,i=arguments.length;r!==i;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length;let a,u=e.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const f=arguments[c],d=f.uuid;let p=t[d];if(p===void 0){p=u++,t[d]=p,e.push(f);for(let v=0,g=s;v!==g;++v)o[v].push(new Ln(f,r[v],i[v]))}else if(p<l){a=e[p];const v=--l,g=e[v];t[g.uuid]=p,e[p]=g,t[d]=v,e[v]=f;for(let m=0,x=s;m!==x;++m){const _=o[m],b=_[v];let S=_[p];_[p]=b,S===void 0&&(S=new Ln(f,r[m],i[m])),_[v]=S}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let o=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const u=arguments[s],l=u.uuid,c=t[l];if(c!==void 0&&c>=o){const h=o++,f=e[h];t[f.uuid]=c,e[c]=f,t[l]=h,e[h]=u;for(let d=0,p=i;d!==p;++d){const v=r[d],g=v[h],m=v[c];v[c]=g,v[h]=m}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,r=this._bindings,i=r.length;let o=this.nCachedObjects_,s=e.length;for(let a=0,u=arguments.length;a!==u;++a){const l=arguments[a],c=l.uuid,h=t[c];if(h!==void 0)if(delete t[c],h<o){const f=--o,d=e[f],p=--s,v=e[p];t[d.uuid]=h,e[h]=d,t[v.uuid]=f,e[f]=v,e.pop();for(let g=0,m=i;g!==m;++g){const x=r[g],_=x[f],b=x[p];x[h]=_,x[f]=b,x.pop()}}else{const f=--s,d=e[f];f>0&&(t[d.uuid]=h),e[h]=d,e.pop();for(let p=0,v=i;p!==v;++p){const g=r[p];g[h]=g[f],g.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const r=this._bindingsIndicesByPath;let i=r[e];const o=this._bindings;if(i!==void 0)return o[i];const s=this._paths,a=this._parsedPaths,u=this._objects,l=u.length,c=this.nCachedObjects_,h=new Array(l);i=o.length,r[e]=i,s.push(e),a.push(t),o.push(h);for(let f=c,d=u.length;f!==d;++f){const p=u[f];h[f]=new Ln(p,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){const i=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length-1,u=s[a],l=e[a];t[l]=r,s[r]=u,s.pop(),o[r]=o[a],o.pop(),i[r]=i[a],i.pop()}}}class MH{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const o=t.tracks,s=o.length,a=new Array(s),u={endingStart:ad,endingEnd:ad};for(let l=0;l!==s;++l){const c=o[l].createInterpolant(null);a[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=a9,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const i=this._clip.duration,o=e._clip.duration,s=o/i,a=i/o;e.warp(1,s,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,o=i.time,s=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const u=a.parameterPositions,l=a.sampleValues;return u[0]=o,u[1]=o+r,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const u=(e-o)*r;u<0||r===0?t=0:(this._startTime=null,t=r*u)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const u=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case UP:for(let c=0,h=u.length;c!==h;++c)u[c].evaluate(s),l[c].accumulateAdditive(a);break;case JS:default:for(let c=0,h=u.length;c!==h;++c)u[c].evaluate(s),l[c].accumulate(i,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,o=this._loopCount;const s=r===u9;if(e===0)return o===-1?i:s&&(o&1)===1?t-i:i;if(r===s9){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),i>=t||i<0){const a=Math.floor(i/t);i-=t*a,o+=Math.abs(a);const u=this.repetitions-o;if(u<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(u===1){const l=e<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=o,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(s&&(o&1)===1)return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=ud,i.endingEnd=ud):(e?i.endingStart=this.zeroSlopeAtStart?ud:ad:i.endingStart=Gy,t?i.endingEnd=this.zeroSlopeAtEnd?ud:ad:i.endingEnd=Gy)}_scheduleFading(e,t,r){const i=this._mixer,o=i.time;let s=this._weightInterpolant;s===null&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,u=s.sampleValues;return a[0]=o,u[0]=t,a[1]=o+e,u[1]=r,this}}const $le=new Float32Array(1);class jle extends Qa{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,o=i.length,s=e._propertyBindings,a=e._interpolants,u=r.uuid,l=this._bindingsByRootAndName;let c=l[u];c===void 0&&(c={},l[u]=c);for(let h=0;h!==o;++h){const f=i[h],d=f.name;let p=c[d];if(p!==void 0)++p.referenceCount,s[h]=p;else{if(p=s[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,u,d));continue}const v=t&&t._propertyBindings[h].binding.parsedPath;p=new CH(Ln.create(r,d,v),f.ValueTypeName,f.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,u,d),s[h]=p}a[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,o=this._actionsByClip[i];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,i,r)}const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const o=t[r];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const o=t[r];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,o=this._actionsByClip;let s=o[t];if(s===void 0)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=s;else{const a=s.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),s.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,s=this._actionsByClip,a=s[o],u=a.knownActions,l=u[u.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,u[c]=l,u.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,f=(e._localRoot||this._root).uuid;delete h[f],u.length===0&&delete s[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const o=t[r];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,o=this._bindings;let s=i[t];s===void 0&&(s={},i[t]=s),s[r]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,o=r.path,s=this._bindingsByRootAndName,a=s[i],u=t[t.length-1],l=e._cacheIndex;u._cacheIndex=l,t[l]=u,t.pop(),delete a[o],Object.keys(a).length===0&&delete s[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=r,t[r]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new uk(new Float32Array(2),new Float32Array(2),1,$le),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,o=t[i];e.__cacheIndex=i,t[i]=e,o.__cacheIndex=r,t[r]=o}clipAction(e,t,r){const i=t||this._root,o=i.uuid;let s=typeof e=="string"?n1.findByName(i,e):e;const a=s!==null?s.uuid:e,u=this._actionsByClip[a];let l=null;if(r===void 0&&(s!==null?r=s.blendMode:r=JS),u!==void 0){const h=u.actionByRoot[o];if(h!==void 0&&h.blendMode===r)return h;l=u.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;const c=new MH(this,s,t,r);return this._bindAction(c,l),this._addInactiveAction(c,a,o),c}existingAction(e,t){const r=t||this._root,i=r.uuid,o=typeof e=="string"?n1.findByName(r,e):e,s=o?o.uuid:e,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let r=t-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,i=this.time+=e,o=Math.sign(e),s=this._accuIndex^=1;for(let l=0;l!==r;++l)t[l]._update(i,e,o,s);const a=this._bindings,u=this._nActiveBindings;for(let l=0;l!==u;++l)a[l].apply(s);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,o=i[r];if(o!==void 0){const s=o.knownActions;for(let a=0,u=s.length;a!==u;++a){const l=s[a];this._deactivateAction(l);const c=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=c,t[c]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const s in r){const a=r[s].actionByRoot,u=a[t];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}const i=this._bindingsByRootAndName,o=i[t];if(o!==void 0)for(const s in o){const a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class Pn{constructor(e){this.value=e}clone(){return new Pn(this.value.clone===void 0?this.value:this.value.clone())}}let Xle=0;class qle extends Qa{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Xle++}),this.name="",this.usage=qy,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let r=0,i=t.length;r<i;r++){const o=Array.isArray(t[r])?t[r]:[t[r]];for(let s=0;s<o.length;s++)this.uniforms.push(o[s].clone())}return this}clone(){return new this.constructor().copy(this)}}class Yle extends oE{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class Kle{constructor(e,t,r,i,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=r,this.elementSize=i,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class TH{constructor(e,t,r=0,i=1/0){this.ray=new lg(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Ed,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return VA(e,this,r,t),r.sort(r5),r}intersectObjects(e,t=!0,r=[]){for(let i=0,o=e.length;i<o;i++)VA(e[i],this,r,t);return r.sort(r5),r}}function r5(n,e){return n.distance-e.distance}function VA(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),r===!0){const i=n.children;for(let o=0,s=i.length;o<s;o++)VA(i[o],e,t,!0)}}class Zle{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Xr(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Qle{constructor(e=1,t=0,r=0){return this.radius=e,this.theta=t,this.y=r,this}set(e,t,r){return this.radius=e,this.theta=t,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}clone(){return new this.constructor().copy(this)}}const i5=new De;class Jle{constructor(e=new De(1/0,1/0),t=new De(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=i5.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,i5).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const o5=new ne,xw=new ne;class ece{constructor(e=new ne,t=new ne){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){o5.subVectors(e,this.start),xw.subVectors(this.end,this.start);const r=xw.dot(xw);let o=xw.dot(o5)/r;return t&&(o=Xr(o,0,1)),o}closestPointToPoint(e,t,r){const i=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const s5=new ne;class tce extends $n{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const r=new an,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,u=32;s<u;s++,a++){const l=s/u*Math.PI*2,c=a/u*Math.PI*2;i.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}r.setAttribute("position",new At(i,3));const o=new rs({fog:!1,toneMapped:!1});this.cone=new Au(r,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),s5.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(s5),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Kc=new ne,ww=new tn,gM=new tn;class nce extends Au{constructor(e){const t=RH(e),r=new an,i=[],o=[],s=new ct(0,0,1),a=new ct(0,1,0);for(let l=0;l<t.length;l++){const c=t[l];c.parent&&c.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(s.r,s.g,s.b),o.push(a.r,a.g,a.b))}r.setAttribute("position",new At(i,3)),r.setAttribute("color",new At(o,3));const u=new rs({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,u),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");gM.copy(this.root.matrixWorld).invert();for(let o=0,s=0;o<t.length;o++){const a=t[o];a.parent&&a.parent.isBone&&(ww.multiplyMatrices(gM,a.matrixWorld),Kc.setFromMatrixPosition(ww),i.setXYZ(s,Kc.x,Kc.y,Kc.z),ww.multiplyMatrices(gM,a.parent.matrixWorld),Kc.setFromMatrixPosition(ww),i.setXYZ(s+1,Kc.x,Kc.y,Kc.z),s+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function RH(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,RH(n.children[t]));return e}class rce extends yr{constructor(e,t,r){const i=new G1(t,4,2),o=new sf({wireframe:!0,fog:!1,toneMapped:!1});super(i,o),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ice=new ne,a5=new ct,u5=new ct;class oce extends $n{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const i=new H1(t);i.rotateY(Math.PI*.5),this.material=new sf({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=i.getAttribute("position"),s=new Float32Array(o.count*3);i.setAttribute("color",new In(s,3)),this.add(new yr(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");a5.copy(this.light.color),u5.copy(this.light.groundColor);for(let r=0,i=t.count;r<i;r++){const o=r<i/2?a5:u5;t.setXYZ(r,o.r,o.g,o.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(ice.setFromMatrixPosition(this.light.matrixWorld).negate())}}class sce extends Au{constructor(e=10,t=10,r=4473924,i=8947848){r=new ct(r),i=new ct(i);const o=t/2,s=e/t,a=e/2,u=[],l=[];for(let f=0,d=0,p=-a;f<=t;f++,p+=s){u.push(-a,0,p,a,0,p),u.push(p,0,-a,p,0,a);const v=f===o?r:i;v.toArray(l,d),d+=3,v.toArray(l,d),d+=3,v.toArray(l,d),d+=3,v.toArray(l,d),d+=3}const c=new an;c.setAttribute("position",new At(u,3)),c.setAttribute("color",new At(l,3));const h=new rs({vertexColors:!0,toneMapped:!1});super(c,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class ace extends Au{constructor(e=10,t=16,r=8,i=64,o=4473924,s=8947848){o=new ct(o),s=new ct(s);const a=[],u=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(Math.PI*2),d=Math.sin(f)*e,p=Math.cos(f)*e;a.push(0,0,0),a.push(d,0,p);const v=h&1?o:s;u.push(v.r,v.g,v.b),u.push(v.r,v.g,v.b)}for(let h=0;h<r;h++){const f=h&1?o:s,d=e-e/r*h;for(let p=0;p<i;p++){let v=p/i*(Math.PI*2),g=Math.sin(v)*d,m=Math.cos(v)*d;a.push(g,0,m),u.push(f.r,f.g,f.b),v=(p+1)/i*(Math.PI*2),g=Math.sin(v)*d,m=Math.cos(v)*d,a.push(g,0,m),u.push(f.r,f.g,f.b)}}const l=new an;l.setAttribute("position",new At(a,3)),l.setAttribute("color",new At(u,3));const c=new rs({vertexColors:!0,toneMapped:!1});super(l,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const l5=new ne,_w=new ne,c5=new ne;class uce extends $n{constructor(e,t,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new an;i.setAttribute("position",new At([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new rs({fog:!1,toneMapped:!1});this.lightPlane=new Gh(i,o),this.add(this.lightPlane),i=new an,i.setAttribute("position",new At([0,0,0,0,0,1],3)),this.targetLine=new Gh(i,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),l5.setFromMatrixPosition(this.light.matrixWorld),_w.setFromMatrixPosition(this.light.target.matrixWorld),c5.subVectors(_w,l5),this.lightPlane.lookAt(_w),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_w),this.targetLine.scale.z=c5.length()}}const bw=new ne,zr=new Gd;class lce extends Au{constructor(e){const t=new an,r=new rs({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,v){u(p),u(v)}function u(p){i.push(0,0,0),o.push(0,0,0),s[p]===void 0&&(s[p]=[]),s[p].push(i.length/3-1)}t.setAttribute("position",new At(i,3)),t.setAttribute("color",new At(o,3)),super(t,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new ct(16755200),c=new ct(16711680),h=new ct(43775),f=new ct(16777215),d=new ct(3355443);this.setColors(l,c,h,f,d)}setColors(e,t,r,i,o){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,r.r,r.g,r.b),a.setXYZ(33,r.r,r.g,r.b),a.setXYZ(34,r.r,r.g,r.b),a.setXYZ(35,r.r,r.g,r.b),a.setXYZ(36,r.r,r.g,r.b),a.setXYZ(37,r.r,r.g,r.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,o.r,o.g,o.b),a.setXYZ(41,o.r,o.g,o.b),a.setXYZ(42,o.r,o.g,o.b),a.setXYZ(43,o.r,o.g,o.b),a.setXYZ(44,o.r,o.g,o.b),a.setXYZ(45,o.r,o.g,o.b),a.setXYZ(46,o.r,o.g,o.b),a.setXYZ(47,o.r,o.g,o.b),a.setXYZ(48,o.r,o.g,o.b),a.setXYZ(49,o.r,o.g,o.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,r=1,i=1;zr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qr("c",t,e,zr,0,0,-1),Qr("t",t,e,zr,0,0,1),Qr("n1",t,e,zr,-r,-i,-1),Qr("n2",t,e,zr,r,-i,-1),Qr("n3",t,e,zr,-r,i,-1),Qr("n4",t,e,zr,r,i,-1),Qr("f1",t,e,zr,-r,-i,1),Qr("f2",t,e,zr,r,-i,1),Qr("f3",t,e,zr,-r,i,1),Qr("f4",t,e,zr,r,i,1),Qr("u1",t,e,zr,r*.7,i*1.1,-1),Qr("u2",t,e,zr,-r*.7,i*1.1,-1),Qr("u3",t,e,zr,0,i*2,-1),Qr("cf1",t,e,zr,-r,0,1),Qr("cf2",t,e,zr,r,0,1),Qr("cf3",t,e,zr,0,-i,1),Qr("cf4",t,e,zr,0,i,1),Qr("cn1",t,e,zr,-r,0,-1),Qr("cn2",t,e,zr,r,0,-1),Qr("cn3",t,e,zr,0,-i,-1),Qr("cn4",t,e,zr,0,i,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Qr(n,e,t,r,i,o,s){bw.set(i,o,s).unproject(r);const a=e[n];if(a!==void 0){const u=t.getAttribute("position");for(let l=0,c=a.length;l<c;l++)u.setXYZ(a[l],bw.x,bw.y,bw.z)}}const Sw=new Jo;class cce extends Au{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),o=new an;o.setIndex(new In(r,1)),o.setAttribute("position",new In(i,3)),super(o,new rs({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Sw.setFromObject(this.object),Sw.isEmpty())return;const t=Sw.min,r=Sw.max,i=this.geometry.attributes.position,o=i.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=t.x,o[4]=r.y,o[5]=r.z,o[6]=t.x,o[7]=t.y,o[8]=r.z,o[9]=r.x,o[10]=t.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=t.z,o[15]=t.x,o[16]=r.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=r.x,o[22]=t.y,o[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class hce extends Au{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new an;o.setIndex(new In(r,1)),o.setAttribute("position",new At(i,3)),super(o,new rs({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class fce extends Gh{constructor(e,t=1,r=16776960){const i=r,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],s=new an;s.setAttribute("position",new At(o,3)),s.computeBoundingSphere(),super(s,new rs({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],u=new an;u.setAttribute("position",new At(a,3)),u.computeBoundingSphere(),this.add(new yr(u,new sf({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const h5=new ne;let Ew,yM;class dce extends $n{constructor(e=new ne(0,0,1),t=new ne(0,0,0),r=1,i=16776960,o=r*.2,s=o*.2){super(),this.type="ArrowHelper",Ew===void 0&&(Ew=new an,Ew.setAttribute("position",new At([0,0,0,0,1,0],3)),yM=new fg(0,.5,1,5,1),yM.translate(0,-.5,0)),this.position.copy(t),this.line=new Gh(Ew,new rs({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new yr(yM,new sf({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,o,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{h5.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(h5,t)}}setLength(e,t=e*.2,r=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class pce extends Au{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new an;i.setAttribute("position",new At(t,3)),i.setAttribute("color",new At(r,3));const o=new rs({vertexColors:!0,toneMapped:!1});super(i,o),this.type="AxesHelper"}setColors(e,t,r){const i=new ct,o=this.geometry.attributes.color.array;return i.set(e),i.toArray(o,0),i.toArray(o,3),i.set(t),i.toArray(o,6),i.toArray(o,9),i.set(r),i.toArray(o,12),i.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class mce{constructor(){this.type="ShapePath",this.color=new ct,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ky,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this}bezierCurveTo(e,t,r,i,o,s){return this.currentPath.bezierCurveTo(e,t,r,i,o,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m){const x=[];for(let _=0,b=m.length;_<b;_++){const S=m[_],E=new Cd;E.curves=S.curves,x.push(E)}return x}function r(m,x){const _=x.length;let b=!1;for(let S=_-1,E=0;E<_;S=E++){let C=x[S],R=x[E],T=R.x-C.x,A=R.y-C.y;if(Math.abs(A)>Number.EPSILON){if(A<0&&(C=x[E],T=-T,R=x[S],A=-A),m.y<C.y||m.y>R.y)continue;if(m.y===C.y){if(m.x===C.x)return!0}else{const P=A*(m.x-C.x)-T*(m.y-C.y);if(P===0)return!0;if(P<0)continue;b=!b}}else{if(m.y!==C.y)continue;if(R.x<=m.x&&m.x<=C.x||C.x<=m.x&&m.x<=R.x)return!0}}return b}const i=dl.isClockWise,o=this.subPaths;if(o.length===0)return[];let s,a,u;const l=[];if(o.length===1)return a=o[0],u=new Cd,u.curves=a.curves,l.push(u),l;let c=!i(o[0].getPoints());c=e?!c:c;const h=[],f=[];let d=[],p=0,v;f[p]=void 0,d[p]=[];for(let m=0,x=o.length;m<x;m++)a=o[m],v=a.getPoints(),s=i(v),s=e?!s:s,s?(!c&&f[p]&&p++,f[p]={s:new Cd,p:v},f[p].s.curves=a.curves,c&&p++,d[p]=[]):d[p].push({h:a,p:v[0]});if(!f[0])return t(o);if(f.length>1){let m=!1,x=0;for(let _=0,b=f.length;_<b;_++)h[_]=[];for(let _=0,b=f.length;_<b;_++){const S=d[_];for(let E=0;E<S.length;E++){const C=S[E];let R=!0;for(let T=0;T<f.length;T++)r(C.p,f[T].p)&&(_!==T&&x++,R?(R=!1,h[T].push(C)):m=!0);R&&h[_].push(C)}}x>0&&m===!1&&(d=h)}let g;for(let m=0,x=f.length;m<x;m++){u=f[m].s,l.push(u),g=d[m];for(let _=0,b=g.length;_<b;_++)u.holes.push(g[_].h)}return l}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:sg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=sg);const vce=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:IP,AddEquation:ch,AddOperation:$7,AdditiveAnimationBlendMode:UP,AdditiveBlending:wb,AgXToneMapping:K7,AlphaFormat:e9,AlwaysCompare:g9,AlwaysDepth:AP,AlwaysStencilFunc:PA,AmbientLight:yH,AnimationAction:MH,AnimationClip:n1,AnimationLoader:yle,AnimationMixer:jle,AnimationObjectGroup:Gle,AnimationUtils:ple,ArcCurve:H9,ArrayCamera:D9,ArrowHelper:dce,AttachedBindMode:oA,Audio:EH,AudioAnalyser:Nle,AudioContext:fk,AudioListener:Ple,AudioLoader:Rle,AxesHelper:pce,BackSide:Mi,BasicDepthPacking:ug,BasicShadowMap:_7,BatchedMesh:z9,Bone:JP,BooleanKeyframeTrack:rp,Box2:Jle,Box3:Jo,Box3Helper:hce,BoxGeometry:np,BoxHelper:cce,BufferAttribute:In,BufferGeometry:an,BufferGeometryLoader:SH,ByteType:Q7,Cache:ec,Camera:Gd,CameraHelper:lce,CanvasTexture:Bue,CapsuleGeometry:lE,CatmullRomCurve3:G9,CineonToneMapping:q7,CircleGeometry:cE,ClampToEdgeWrapping:qr,Clock:EE,Color:ct,ColorKeyframeTrack:lk,ColorManagement:Jn,CompressedArrayTexture:Fue,CompressedCubeTexture:Oue,CompressedTexture:aE,CompressedTextureLoader:xle,ConeGeometry:hE,ConstantAlphaFactor:F7,ConstantColorFactor:N7,CubeCamera:E9,CubeReflectionMapping:mc,CubeRefractionMapping:zh,CubeTexture:U1,CubeTextureLoader:wle,CubeUVReflectionMapping:ag,CubicBezierCurve:nk,CubicBezierCurve3:$9,CubicInterpolant:lH,CullFaceBack:eA,CullFaceFront:w7,CullFaceFrontBack:Mne,CullFaceNone:x7,Curve:Iu,CurvePath:X9,CustomBlending:b7,CustomToneMapping:Y7,CylinderGeometry:fg,Cylindrical:Qle,Data3DTexture:GP,DataArrayTexture:tE,DataTexture:ac,DataTextureLoader:_le,DataUtils:Lre,DecrementStencilOp:Bne,DecrementWrapStencilOp:zne,DefaultLoadingManager:fH,DepthFormat:Ih,DepthStencilFormat:Hh,DepthTexture:V1,DetachedBindMode:Z7,DirectionalLight:gH,DirectionalLightHelper:uce,DiscreteInterpolant:cH,DisplayP3ColorSpace:eE,DodecahedronGeometry:fE,DoubleSide:jo,DstAlphaFactor:A7,DstColorFactor:P7,DynamicCopyUsage:tre,DynamicDrawUsage:Yne,DynamicReadUsage:Qne,EdgesGeometry:q9,EllipseCurve:uE,EqualCompare:d9,EqualDepth:z7,EqualStencilFunc:Gne,EquirectangularReflectionMapping:By,EquirectangularRefractionMapping:Uy,Euler:$P,EventDispatcher:Qa,ExtrudeGeometry:pE,FileLoader:gc,Float16BufferAttribute:Vre,Float32BufferAttribute:At,Float64BufferAttribute:Wre,FloatType:vs,Fog:iE,FogExp2:rE,FramebufferTexture:Lue,FrontSide:yl,Frustum:z1,GLBufferAttribute:Kle,GLSL1:rre,GLSL3:kA,GreaterCompare:p9,GreaterDepth:W7,GreaterEqualCompare:v9,GreaterEqualDepth:V7,GreaterEqualStencilFunc:qne,GreaterStencilFunc:jne,GridHelper:sce,Group:zm,HalfFloatType:Wh,HemisphereLight:pH,HemisphereLightHelper:oce,IcosahedronGeometry:mE,ImageBitmapLoader:Tle,ImageLoader:r1,ImageUtils:HP,IncrementStencilOp:One,IncrementWrapStencilOp:Une,InstancedBufferAttribute:Ov,InstancedBufferGeometry:bH,InstancedInterleavedBuffer:Yle,InstancedMesh:U9,Int16BufferAttribute:Ure,Int32BufferAttribute:zre,Int8BufferAttribute:Fre,IntType:kP,InterleavedBuffer:oE,InterleavedBufferAttribute:$d,Interpolant:$1,InterpolateDiscrete:Wy,InterpolateLinear:Hy,InterpolateSmooth:k_,InvertStencilOp:Vne,KeepStencilOp:Gf,KeyframeTrack:Pu,LOD:O9,LatheGeometry:W1,Layers:Ed,LessCompare:f9,LessDepth:U7,LessEqualCompare:VP,LessEqualDepth:Oy,LessEqualStencilFunc:$ne,LessStencilFunc:Hne,Light:lf,LightProbe:_H,Line:Gh,Line3:ece,LineBasicMaterial:rs,LineCurve:rk,LineCurve3:j9,LineDashedMaterial:sH,LineLoop:V9,LineSegments:Au,LinearDisplayP3ColorSpace:B1,LinearEncoding:zP,LinearFilter:Fn,LinearInterpolant:uk,LinearMipMapLinearFilter:Pne,LinearMipMapNearestFilter:Ine,LinearMipmapLinearFilter:Vh,LinearMipmapNearestFilter:PP,LinearSRGBColorSpace:$a,LinearToneMapping:j7,LinearTransfer:$y,Loader:ks,LoaderUtils:zA,LoadingManager:ck,LoopOnce:s9,LoopPingPong:u9,LoopRepeat:a9,LuminanceAlphaFormat:n9,LuminanceFormat:t9,MOUSE:Ene,Material:$i,MaterialLoader:SE,MathUtils:zs,Matrix3:pn,Matrix4:tn,MaxEquation:iA,Mesh:yr,MeshBasicMaterial:sf,MeshDepthMaterial:KP,MeshDistanceMaterial:ZP,MeshLambertMaterial:iH,MeshMatcapMaterial:oH,MeshNormalMaterial:rH,MeshPhongMaterial:tH,MeshPhysicalMaterial:eH,MeshStandardMaterial:bE,MeshToonMaterial:nH,MinEquation:rA,MirroredRepeatWrapping:Vy,MixOperation:G7,MultiplyBlending:nA,MultiplyOperation:O1,NearestFilter:ti,NearestMipMapLinearFilter:Ane,NearestMipMapNearestFilter:Rne,NearestMipmapLinearFilter:$0,NearestMipmapNearestFilter:Sb,NeverCompare:h9,NeverDepth:B7,NeverStencilFunc:Wne,NoBlending:Qo,NoColorSpace:Xo,NoToneMapping:wu,NormalAnimationBlendMode:JS,NormalBlending:bd,NotEqualCompare:m9,NotEqualDepth:H7,NotEqualStencilFunc:Xne,NumberKeyframeTrack:e1,Object3D:$n,ObjectLoader:Cle,ObjectSpaceNormalMap:c9,OctahedronGeometry:H1,OneFactor:M7,OneMinusConstantAlphaFactor:O7,OneMinusConstantColorFactor:L7,OneMinusDstAlphaFactor:I7,OneMinusDstColorFactor:k7,OneMinusSrcAlphaFactor:bb,OneMinusSrcColorFactor:R7,OrthographicCamera:af,P3Primaries:Xy,PCFShadowMap:KS,PCFSoftShadowMap:G0,PMREMGenerator:NA,Path:Ky,PerspectiveCamera:Si,Plane:oh,PlaneGeometry:fl,PlaneHelper:fce,PointLight:vH,PointLightHelper:rce,Points:W9,PointsMaterial:ek,PolarGridHelper:ace,PolyhedronGeometry:uf,PositionalAudio:Dle,PropertyBinding:Ln,PropertyMixer:CH,QuadraticBezierCurve:ik,QuadraticBezierCurve3:ok,Quaternion:bs,QuaternionKeyframeTrack:dg,QuaternionLinearInterpolant:hH,RED_GREEN_RGTC2_Format:AA,RED_RGTC1_Format:o9,REVISION:sg,RGBADepthPacking:l9,RGBAFormat:eo,RGBAIntegerFormat:OP,RGBA_ASTC_10x10_Format:SA,RGBA_ASTC_10x5_Format:wA,RGBA_ASTC_10x6_Format:_A,RGBA_ASTC_10x8_Format:bA,RGBA_ASTC_12x10_Format:EA,RGBA_ASTC_12x12_Format:CA,RGBA_ASTC_4x4_Format:fA,RGBA_ASTC_5x4_Format:dA,RGBA_ASTC_5x5_Format:pA,RGBA_ASTC_6x5_Format:mA,RGBA_ASTC_6x6_Format:vA,RGBA_ASTC_8x5_Format:gA,RGBA_ASTC_8x6_Format:yA,RGBA_ASTC_8x8_Format:xA,RGBA_BPTC_Format:P_,RGBA_ETC2_EAC_Format:hA,RGBA_PVRTC_2BPPV1_Format:lA,RGBA_PVRTC_4BPPV1_Format:uA,RGBA_S3TC_DXT1_Format:R_,RGBA_S3TC_DXT3_Format:A_,RGBA_S3TC_DXT5_Format:I_,RGB_BPTC_SIGNED_Format:MA,RGB_BPTC_UNSIGNED_Format:TA,RGB_ETC1_Format:BP,RGB_ETC2_Format:cA,RGB_PVRTC_2BPPV1_Format:aA,RGB_PVRTC_4BPPV1_Format:sA,RGB_S3TC_DXT1_Format:T_,RGFormat:i9,RGIntegerFormat:FP,RawShaderMaterial:Wm,Ray:lg,Raycaster:TH,Rec709Primaries:jy,RectAreaLight:xH,RedFormat:r9,RedIntegerFormat:LP,ReinhardToneMapping:X7,RenderTarget:w9,RepeatWrapping:zy,ReplaceStencilOp:Fne,ReverseSubtractEquation:E7,RingGeometry:vE,SIGNED_RED_GREEN_RGTC2_Format:IA,SIGNED_RED_RGTC1_Format:RA,SRGBColorSpace:Rn,SRGBTransfer:ur,Scene:vc,ShaderChunk:ln,ShaderLib:Ia,ShaderMaterial:pi,ShadowMaterial:J9,Shape:Cd,ShapeGeometry:gE,ShapePath:mce,ShapeUtils:dl,ShortType:J7,Skeleton:sE,SkeletonHelper:nce,SkinnedMesh:B9,Source:ld,Sphere:Ao,SphereGeometry:G1,Spherical:Zle,SphericalHarmonics3:wH,SplineCurve:sk,SpotLight:mH,SpotLightHelper:tce,Sprite:F9,SpriteMaterial:QP,SrcAlphaFactor:_b,SrcAlphaSaturateFactor:D7,SrcColorFactor:T7,StaticCopyUsage:ere,StaticDrawUsage:qy,StaticReadUsage:Zne,StereoCamera:Ale,StreamCopyUsage:nre,StreamDrawUsage:Kne,StreamReadUsage:Jne,StringKeyframeTrack:ip,SubtractEquation:S7,SubtractiveBlending:tA,TOUCH:Cne,TangentSpaceNormalMap:of,TetrahedronGeometry:yE,Texture:Lr,TextureLoader:dH,TorusGeometry:xE,TorusKnotGeometry:wE,Triangle:cd,TriangleFanDrawMode:Nne,TriangleStripDrawMode:Dne,TrianglesDrawMode:kne,TubeGeometry:_E,TwoPassDoubleSide:Tne,UVMapping:ZS,Uint16BufferAttribute:jP,Uint32BufferAttribute:XP,Uint8BufferAttribute:Ore,Uint8ClampedBufferAttribute:Bre,Uniform:Pn,UniformsGroup:qle,UniformsLib:st,UniformsUtils:qP,UnsignedByteType:ro,UnsignedInt248Type:sc,UnsignedIntType:il,UnsignedShort4444Type:DP,UnsignedShort5551Type:NP,UnsignedShortType:QS,VSMShadowMap:lu,Vector2:De,Vector3:ne,Vector4:On,VectorKeyframeTrack:t1,VideoTexture:Nue,WebGL1Renderer:N9,WebGL3DRenderTarget:Sre,WebGLArrayRenderTarget:bre,WebGLCoordinateSystem:mu,WebGLCubeRenderTarget:C9,WebGLMultipleRenderTargets:Ere,WebGLRenderTarget:oi,WebGLRenderer:hg,WebGLUtils:k9,WebGPUCoordinateSystem:Nv,WireframeGeometry:Q9,WrapAroundEnding:Gy,ZeroCurvatureEnding:ad,ZeroFactor:C7,ZeroSlopeEnding:ud,ZeroStencilOp:Lne,_SRGBAFormat:Eb,createCanvasElement:x9,sRGBEncoding:Ph},Symbol.toStringTag,{value:"Module"})),gce=`
uniform float time;
varying vec2 vUv;
varying vec3 vPosition;

void main() {
  vUv = uv;
  vPosition = position;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,yce=`
uniform sampler2D uDataTexture;
uniform sampler2D uTexture;
uniform vec4 resolution;
varying vec2 vUv;

void main() {
  vec2 uv = vUv;
  vec4 offset = texture2D(uDataTexture, vUv);
  gl_FragColor = texture2D(uTexture, uv - 0.02 * offset.rg);
}`,xce=({grid:n=15,mouse:e=.1,strength:t=.15,relaxation:r=.9,imageSrc:i,className:o=""})=>{const s=H.useRef(null),a=H.useRef(null),u=H.useRef(null),l=H.useRef(null),c=H.useRef(null),h=H.useRef(1),f=H.useRef(null),d=H.useRef(null);return H.useEffect(()=>{if(!s.current)return;const p=s.current,v=new vc;a.current=v;const g=new hg({antialias:!0,alpha:!0,powerPreference:"high-performance"});g.setPixelRatio(Math.min(window.devicePixelRatio,2)),g.setClearColor(0,0),u.current=g,p.innerHTML="",p.appendChild(g.domElement);const m=new af(0,0,0,0,-1e3,1e3);m.position.z=2,l.current=m;const x={time:{value:0},resolution:{value:new On},uTexture:{value:null},uDataTexture:{value:null}};new dH().load(i,O=>{O.minFilter=Fn,O.magFilter=Fn,O.wrapS=qr,O.wrapT=qr,h.current=O.image.width/O.image.height,x.uTexture.value=O,A()});const b=n,S=new Float32Array(4*b*b);for(let O=0;O<b*b;O++)S[O*4]=Math.random()*255-125,S[O*4+1]=Math.random()*255-125;const E=new ac(S,b,b,eo,vs);E.needsUpdate=!0,x.uDataTexture.value=E;const C=new pi({side:jo,uniforms:x,vertexShader:gce,fragmentShader:yce,transparent:!0}),R=new fl(1,1,b-1,b-1),T=new yr(R,C);c.current=T,v.add(T);const A=()=>{if(!p||!g||!m)return;const O=p.getBoundingClientRect(),z=O.width,V=O.height;if(z===0||V===0)return;const F=z/V;g.setSize(z,V),T&&T.scale.set(F,1,1);const U=1,L=U*F;m.left=-L/2,m.right=L/2,m.top=U/2,m.bottom=-U/2,m.updateProjectionMatrix(),x.resolution.value.set(z,V,1,1)};if(window.ResizeObserver){const O=new ResizeObserver(()=>{A()});O.observe(p),d.current=O}else window.addEventListener("resize",A);const P={x:0,y:0,prevX:0,prevY:0,vX:0,vY:0},k=O=>{const z=p.getBoundingClientRect(),V=(O.clientX-z.left)/z.width,F=1-(O.clientY-z.top)/z.height;P.vX=V-P.prevX,P.vY=F-P.prevY,Object.assign(P,{x:V,y:F,prevX:V,prevY:F})},W=()=>{E&&(E.needsUpdate=!0),Object.assign(P,{x:0,y:0,prevX:0,prevY:0,vX:0,vY:0})};p.addEventListener("mousemove",k),p.addEventListener("mouseleave",W),A();const N=()=>{if(f.current=requestAnimationFrame(N),!g||!v||!m)return;x.time.value+=.05;const O=E.image.data;for(let U=0;U<b*b;U++)O[U*4]*=r,O[U*4+1]*=r;const z=b*P.x,V=b*P.y,F=b*e;for(let U=0;U<b;U++)for(let L=0;L<b;L++){const j=Math.pow(z-U,2)+Math.pow(V-L,2);if(j<F*F){const Q=4*(U+b*L),K=Math.min(F/Math.sqrt(j),10);O[Q]+=t*100*P.vX*K,O[Q+1]-=t*100*P.vY*K}}E.needsUpdate=!0,g.render(v,m)};return N(),()=>{f.current&&cancelAnimationFrame(f.current),d.current?d.current.disconnect():window.removeEventListener("resize",A),p.removeEventListener("mousemove",k),p.removeEventListener("mouseleave",W),g&&(g.dispose(),p.contains(g.domElement)&&p.removeChild(g.domElement)),R&&R.dispose(),C&&C.dispose(),E&&E.dispose(),x.uTexture.value&&x.uTexture.value.dispose(),a.current=null,u.current=null,l.current=null,c.current=null}},[n,e,t,r,i]),G.jsx("div",{ref:s,className:`relative overflow-hidden ${o}`,style:{width:"100%",height:"100%",minWidth:"0",minHeight:"0"}})};function Gl(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function AH(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var ua={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Bv={duration:.5,overwrite:!1,delay:0},mk,io,br,Fa=1e8,sr=1/Fa,WA=Math.PI*2,wce=WA/4,_ce=0,IH=Math.sqrt,bce=Math.cos,Sce=Math.sin,Hi=function(e){return typeof e=="string"},Yr=function(e){return typeof e=="function"},yc=function(e){return typeof e=="number"},vk=function(e){return typeof e>"u"},xl=function(e){return typeof e=="object"},Ss=function(e){return e!==!1},gk=function(){return typeof window<"u"},Cw=function(e){return Yr(e)||Hi(e)},PH=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Io=Array.isArray,Ece=/random\([^)]+\)/g,Cce=/,\s*/g,f5=/(?:-?\.?\d|\.)+/gi,kH=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Hm=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,xM=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,DH=/[+-]=-?[.\d]+/,Mce=/[^,'"\[\]\s]+/gi,Tce=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Ar,Yu,HA,yk,ha={},Tb={},NH,LH=function(e){return(Tb=Uv(e,ha))&&As},xk=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},i1=function(e,t){return!t&&console.warn(e)},FH=function(e,t){return e&&(ha[e]=t)&&Tb&&(Tb[e]=t)||ha},o1=function(){return 0},Rce={suppressEvents:!0,isStart:!0,kill:!1},N_={suppressEvents:!0,kill:!1},Ace={suppressEvents:!0},wk={},kh=[],GA={},OH,$s={},wM={},d5=30,L_=[],_k="",bk=function(e){var t=e[0],r,i;if(xl(t)||Yr(t)||(e=[e]),!(r=(t._gsap||{}).harness)){for(i=L_.length;i--&&!L_[i].targetTest(t););r=L_[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new aG(e[i],r)))||e.splice(i,1);return e},Md=function(e){return e._gsap||bk(Oa(e))[0]._gsap},BH=function(e,t,r){return(r=e[t])&&Yr(r)?e[t]():vk(r)&&e.getAttribute&&e.getAttribute(t)||r},Es=function(e,t){return(e=e.split(",")).forEach(t)||e},ei=function(e){return Math.round(e*1e5)/1e5||0},Tr=function(e){return Math.round(e*1e7)/1e7||0},sv=function(e,t){var r=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),r==="+"?e+i:r==="-"?e-i:r==="*"?e*i:e/i},Ice=function(e,t){for(var r=t.length,i=0;e.indexOf(t[i])<0&&++i<r;);return i<r},Rb=function(){var e=kh.length,t=kh.slice(0),r,i;for(GA={},kh.length=0,r=0;r<e;r++)i=t[r],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Sk=function(e){return!!(e._initted||e._startAt||e.add)},UH=function(e,t,r,i){kh.length&&!io&&Rb(),e.render(t,r,!!(io&&t<0&&Sk(e))),kh.length&&!io&&Rb()},zH=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Mce).length<2?t:Hi(e)?e.trim():e},VH=function(e){return e},fa=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},Pce=function(e){return function(t,r){for(var i in r)i in t||i==="duration"&&e||i==="ease"||(t[i]=r[i])}},Uv=function(e,t){for(var r in t)e[r]=t[r];return e},p5=function n(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=xl(t[r])?n(e[r]||(e[r]={}),t[r]):t[r]);return e},Ab=function(e,t){var r={},i;for(i in e)i in t||(r[i]=e[i]);return r},K0=function(e){var t=e.parent||Ar,r=e.keyframes?Pce(Io(e.keyframes)):fa;if(Ss(e.inherit))for(;t;)r(e,t.vars.defaults),t=t.parent||t._dp;return e},kce=function(e,t){for(var r=e.length,i=r===t.length;i&&r--&&e[r]===t[r];);return r<0},WH=function(e,t,r,i,o){var s=e[i],a;if(o)for(a=t[o];s&&s[o]>a;)s=s._prev;return s?(t._next=s._next,s._next=t):(t._next=e[r],e[r]=t),t._next?t._next._prev=t:e[i]=t,t._prev=s,t.parent=t._dp=e,t},CE=function(e,t,r,i){r===void 0&&(r="_first"),i===void 0&&(i="_last");var o=t._prev,s=t._next;o?o._next=s:e[r]===t&&(e[r]=s),s?s._prev=o:e[i]===t&&(e[i]=o),t._next=t._prev=t.parent=null},$h=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Td=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var r=e;r;)r._dirty=1,r=r.parent;return e},Dce=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},$A=function(e,t,r,i){return e._startAt&&(io?e._startAt.revert(N_):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},Nce=function n(e){return!e||e._ts&&n(e.parent)},m5=function(e){return e._repeat?zv(e._tTime,e=e.duration()+e._rDelay)*e:0},zv=function(e,t){var r=Math.floor(e=Tr(e/t));return e&&r===e?r-1:r},Ib=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},ME=function(e){return e._end=Tr(e._start+(e._tDur/Math.abs(e._ts||e._rts||sr)||0))},TE=function(e,t){var r=e._dp;return r&&r.smoothChildTiming&&e._ts&&(e._start=Tr(r._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),ME(e),r._dirty||Td(r,e)),e},HH=function(e,t){var r;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(r=Ib(e.rawTime(),t),(!t._dur||j1(0,t.totalDuration(),r)-t._tTime>sr)&&t.render(r,!0)),Td(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(r=e;r._dp;)r.rawTime()>=0&&r.totalTime(r._tTime),r=r._dp;e._zTime=-sr}},tl=function(e,t,r,i){return t.parent&&$h(t),t._start=Tr((yc(r)?r:r||e!==Ar?Ma(e,r,t):e._time)+t._delay),t._end=Tr(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),WH(e,t,"_first","_last",e._sort?"_start":0),jA(t)||(e._recent=t),i||HH(e,t),e._ts<0&&TE(e,e._tTime),e},GH=function(e,t){return(ha.ScrollTrigger||xk("scrollTrigger",t))&&ha.ScrollTrigger.create(t,e)},$H=function(e,t,r,i,o){if(Ck(e,t,o),!e._initted)return 1;if(!r&&e._pt&&!io&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&OH!==Qs.frame)return kh.push(e),e._lazy=[o,i],1},Lce=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},jA=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},Fce=function(e,t,r,i){var o=e.ratio,s=t<0||!t&&(!e._start&&Lce(e)&&!(!e._initted&&jA(e))||(e._ts<0||e._dp._ts<0)&&!jA(e))?0:1,a=e._rDelay,u=0,l,c,h;if(a&&e._repeat&&(u=j1(0,e._tDur,t),c=zv(u,a),e._yoyo&&c&1&&(s=1-s),c!==zv(e._tTime,a)&&(o=1-s,e.vars.repeatRefresh&&e._initted&&e.invalidate())),s!==o||io||i||e._zTime===sr||!t&&e._zTime){if(!e._initted&&$H(e,t,i,r,u))return;for(h=e._zTime,e._zTime=t||(r?sr:0),r||(r=t&&!h),e.ratio=s,e._from&&(s=1-s),e._time=0,e._tTime=u,l=e._pt;l;)l.r(s,l.d),l=l._next;t<0&&$A(e,t,r,!0),e._onUpdate&&!r&&ta(e,"onUpdate"),u&&e._repeat&&!r&&e.parent&&ta(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===s&&(s&&$h(e,1),!r&&!io&&(ta(e,s?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},Oce=function(e,t,r){var i;if(r>t)for(i=e._first;i&&i._start<=r;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=r;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},Vv=function(e,t,r,i){var o=e._repeat,s=Tr(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=s/e._dur),e._dur=s,e._tDur=o?o<0?1e10:Tr(s*(o+1)+e._rDelay*o):s,a>0&&!i&&TE(e,e._tTime=e._tDur*a),e.parent&&ME(e),r||Td(e.parent,e),e},v5=function(e){return e instanceof qo?Td(e):Vv(e,e._dur)},Bce={_start:0,endTime:o1,totalDuration:o1},Ma=function n(e,t,r){var i=e.labels,o=e._recent||Bce,s=e.duration()>=Fa?o.endTime(!1):e._dur,a,u,l;return Hi(t)&&(isNaN(t)||t in i)?(u=t.charAt(0),l=t.substr(-1)==="%",a=t.indexOf("="),u==="<"||u===">"?(a>=0&&(t=t.replace(/=/,"")),(u==="<"?o._start:o.endTime(o._repeat>=0))+(parseFloat(t.substr(1))||0)*(l?(a<0?o:r).totalDuration()/100:1)):a<0?(t in i||(i[t]=s),i[t]):(u=parseFloat(t.charAt(a-1)+t.substr(a+1)),l&&r&&(u=u/100*(Io(r)?r[0]:r).totalDuration()),a>1?n(e,t.substr(0,a-1),r)+u:s+u)):t==null?s:+t},Z0=function(e,t,r){var i=yc(t[1]),o=(i?2:1)+(e<2?0:1),s=t[o],a,u;if(i&&(s.duration=t[1]),s.parent=r,e){for(a=s,u=r;u&&!("immediateRender"in a);)a=u.vars.defaults||{},u=Ss(u.vars.inherit)&&u.parent;s.immediateRender=Ss(a.immediateRender),e<2?s.runBackwards=1:s.startAt=t[o-1]}return new hi(t[0],s,t[o+1])},cf=function(e,t){return e||e===0?t(e):t},j1=function(e,t,r){return r<e?e:r>t?t:r},So=function(e,t){return!Hi(e)||!(t=Tce.exec(e))?"":t[1]},Uce=function(e,t,r){return cf(r,function(i){return j1(e,t,i)})},XA=[].slice,jH=function(e,t){return e&&xl(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&xl(e[0]))&&!e.nodeType&&e!==Yu},zce=function(e,t,r){return r===void 0&&(r=[]),e.forEach(function(i){var o;return Hi(i)&&!t||jH(i,1)?(o=r).push.apply(o,Oa(i)):r.push(i)})||r},Oa=function(e,t,r){return br&&!t&&br.selector?br.selector(e):Hi(e)&&!r&&(HA||!Wv())?XA.call((t||yk).querySelectorAll(e),0):Io(e)?zce(e,r):jH(e)?XA.call(e,0):e?[e]:[]},qA=function(e){return e=Oa(e)[0]||i1("Invalid scope")||{},function(t){var r=e.current||e.nativeElement||e;return Oa(t,r.querySelectorAll?r:r===e?i1("Invalid scope")||yk.createElement("div"):e)}},XH=function(e){return e.sort(function(){return .5-Math.random()})},qH=function(e){if(Yr(e))return e;var t=xl(e)?e:{each:e},r=Rd(t.ease),i=t.from||0,o=parseFloat(t.base)||0,s={},a=i>0&&i<1,u=isNaN(i)||a,l=t.axis,c=i,h=i;return Hi(i)?c=h={center:.5,edges:.5,end:1}[i]||0:!a&&u&&(c=i[0],h=i[1]),function(f,d,p){var v=(p||t).length,g=s[v],m,x,_,b,S,E,C,R,T;if(!g){if(T=t.grid==="auto"?0:(t.grid||[1,Fa])[1],!T){for(C=-Fa;C<(C=p[T++].getBoundingClientRect().left)&&T<v;);T<v&&T--}for(g=s[v]=[],m=u?Math.min(T,v)*c-.5:i%T,x=T===Fa?0:u?v*h/T-.5:i/T|0,C=0,R=Fa,E=0;E<v;E++)_=E%T-m,b=x-(E/T|0),g[E]=S=l?Math.abs(l==="y"?b:_):IH(_*_+b*b),S>C&&(C=S),S<R&&(R=S);i==="random"&&XH(g),g.max=C-R,g.min=R,g.v=v=(parseFloat(t.amount)||parseFloat(t.each)*(T>v?v-1:l?l==="y"?v/T:T:Math.max(T,v/T))||0)*(i==="edges"?-1:1),g.b=v<0?o-v:o,g.u=So(t.amount||t.each)||0,r=r&&v<0?iG(r):r}return v=(g[f]-g.min)/g.max||0,Tr(g.b+(r?r(v):v)*g.v)+g.u}},YA=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(r){var i=Tr(Math.round(parseFloat(r)/e)*e*t);return(i-i%1)/t+(yc(r)?0:So(r))}},YH=function(e,t){var r=Io(e),i,o;return!r&&xl(e)&&(i=r=e.radius||Fa,e.values?(e=Oa(e.values),(o=!yc(e[0]))&&(i*=i)):e=YA(e.increment)),cf(t,r?Yr(e)?function(s){return o=e(s),Math.abs(o-s)<=i?o:s}:function(s){for(var a=parseFloat(o?s.x:s),u=parseFloat(o?s.y:0),l=Fa,c=0,h=e.length,f,d;h--;)o?(f=e[h].x-a,d=e[h].y-u,f=f*f+d*d):f=Math.abs(e[h]-a),f<l&&(l=f,c=h);return c=!i||l<=i?e[c]:s,o||c===s||yc(s)?c:c+So(s)}:YA(e))},KH=function(e,t,r,i){return cf(Io(e)?!t:r===!0?!!(r=0):!i,function(){return Io(e)?e[~~(Math.random()*e.length)]:(r=r||1e-5)&&(i=r<1?Math.pow(10,(r+"").length-2):1)&&Math.floor(Math.round((e-r/2+Math.random()*(t-e+r*.99))/r)*r*i)/i})},Vce=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(i){return t.reduce(function(o,s){return s(o)},i)}},Wce=function(e,t){return function(r){return e(parseFloat(r))+(t||So(r))}},Hce=function(e,t,r){return QH(e,t,0,1,r)},ZH=function(e,t,r){return cf(r,function(i){return e[~~t(i)]})},Gce=function n(e,t,r){var i=t-e;return Io(e)?ZH(e,n(0,e.length),t):cf(r,function(o){return(i+(o-e)%i)%i+e})},$ce=function n(e,t,r){var i=t-e,o=i*2;return Io(e)?ZH(e,n(0,e.length-1),t):cf(r,function(s){return s=(o+(s-e)%o)%o||0,e+(s>i?o-s:s)})},s1=function(e){return e.replace(Ece,function(t){var r=t.indexOf("[")+1,i=t.substring(r||7,r?t.indexOf("]"):t.length-1).split(Cce);return KH(r?i:+i[0],r?0:+i[1],+i[2]||1e-5)})},QH=function(e,t,r,i,o){var s=t-e,a=i-r;return cf(o,function(u){return r+((u-e)/s*a||0)})},jce=function n(e,t,r,i){var o=isNaN(e+t)?0:function(d){return(1-d)*e+d*t};if(!o){var s=Hi(e),a={},u,l,c,h,f;if(r===!0&&(i=1)&&(r=null),s)e={p:e},t={p:t};else if(Io(e)&&!Io(t)){for(c=[],h=e.length,f=h-2,l=1;l<h;l++)c.push(n(e[l-1],e[l]));h--,o=function(p){p*=h;var v=Math.min(f,~~p);return c[v](p-v)},r=t}else i||(e=Uv(Io(e)?[]:{},e));if(!c){for(u in t)Ek.call(a,e,u,"get",t[u]);o=function(p){return Rk(p,a)||(s?e.p:e)}}}return cf(r,o)},g5=function(e,t,r){var i=e.labels,o=Fa,s,a,u;for(s in i)a=i[s]-t,a<0==!!r&&a&&o>(a=Math.abs(a))&&(u=s,o=a);return u},ta=function(e,t,r){var i=e.vars,o=i[t],s=br,a=e._ctx,u,l,c;if(o)return u=i[t+"Params"],l=i.callbackScope||e,r&&kh.length&&Rb(),a&&(br=a),c=u?o.apply(l,u):o.call(l),br=s,c},T0=function(e){return $h(e),e.scrollTrigger&&e.scrollTrigger.kill(!!io),e.progress()<1&&ta(e,"onInterrupt"),e},Gm,JH=[],eG=function(e){if(e)if(e=!e.name&&e.default||e,gk()||e.headless){var t=e.name,r=Yr(e),i=t&&!r&&e.init?function(){this._props=[]}:e,o={init:o1,render:Rk,add:Ek,kill:uhe,modifier:ahe,rawVars:0},s={targetTest:0,get:0,getSetter:Tk,aliases:{},register:0};if(Wv(),e!==i){if($s[t])return;fa(i,fa(Ab(e,o),s)),Uv(i.prototype,Uv(o,Ab(e,s))),$s[i.prop=t]=i,e.targetTest&&(L_.push(i),wk[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}FH(t,i),e.register&&e.register(As,i,Cs)}else JH.push(e)},or=255,R0={aqua:[0,or,or],lime:[0,or,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,or],navy:[0,0,128],white:[or,or,or],olive:[128,128,0],yellow:[or,or,0],orange:[or,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[or,0,0],pink:[or,192,203],cyan:[0,or,or],transparent:[or,or,or,0]},_M=function(e,t,r){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(r-t)*e*6:e<.5?r:e*3<2?t+(r-t)*(2/3-e)*6:t)*or+.5|0},tG=function(e,t,r){var i=e?yc(e)?[e>>16,e>>8&or,e&or]:0:R0.black,o,s,a,u,l,c,h,f,d,p;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),R0[e])i=R0[e];else if(e.charAt(0)==="#"){if(e.length<6&&(o=e.charAt(1),s=e.charAt(2),a=e.charAt(3),e="#"+o+o+s+s+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&or,i&or,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&or,e&or]}else if(e.substr(0,3)==="hsl"){if(i=p=e.match(f5),!t)u=+i[0]%360/360,l=+i[1]/100,c=+i[2]/100,s=c<=.5?c*(l+1):c+l-c*l,o=c*2-s,i.length>3&&(i[3]*=1),i[0]=_M(u+1/3,o,s),i[1]=_M(u,o,s),i[2]=_M(u-1/3,o,s);else if(~e.indexOf("="))return i=e.match(kH),r&&i.length<4&&(i[3]=1),i}else i=e.match(f5)||R0.transparent;i=i.map(Number)}return t&&!p&&(o=i[0]/or,s=i[1]/or,a=i[2]/or,h=Math.max(o,s,a),f=Math.min(o,s,a),c=(h+f)/2,h===f?u=l=0:(d=h-f,l=c>.5?d/(2-h-f):d/(h+f),u=h===o?(s-a)/d+(s<a?6:0):h===s?(a-o)/d+2:(o-s)/d+4,u*=60),i[0]=~~(u+.5),i[1]=~~(l*100+.5),i[2]=~~(c*100+.5)),r&&i.length<4&&(i[3]=1),i},nG=function(e){var t=[],r=[],i=-1;return e.split(Dh).forEach(function(o){var s=o.match(Hm)||[];t.push.apply(t,s),r.push(i+=s.length+1)}),t.c=r,t},y5=function(e,t,r){var i="",o=(e+i).match(Dh),s=t?"hsla(":"rgba(",a=0,u,l,c,h;if(!o)return e;if(o=o.map(function(f){return(f=tG(f,t,1))&&s+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),r&&(c=nG(e),u=r.c,u.join(i)!==c.c.join(i)))for(l=e.replace(Dh,"1").split(Hm),h=l.length-1;a<h;a++)i+=l[a]+(~u.indexOf(a)?o.shift()||s+"0,0,0,0)":(c.length?c:o.length?o:r).shift());if(!l)for(l=e.split(Dh),h=l.length-1;a<h;a++)i+=l[a]+o[a];return i+l[h]},Dh=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in R0)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),Xce=/hsl[a]?\(/,rG=function(e){var t=e.join(" "),r;if(Dh.lastIndex=0,Dh.test(t))return r=Xce.test(t),e[1]=y5(e[1],r),e[0]=y5(e[0],r,nG(e[1])),!0},a1,Qs=function(){var n=Date.now,e=500,t=33,r=n(),i=r,o=1e3/240,s=o,a=[],u,l,c,h,f,d,p=function v(g){var m=n()-i,x=g===!0,_,b,S,E;if((m>e||m<0)&&(r+=m-t),i+=m,S=i-r,_=S-s,(_>0||x)&&(E=++h.frame,f=S-h.time*1e3,h.time=S=S/1e3,s+=_+(_>=o?4:o-_),b=1),x||(u=l(v)),b)for(d=0;d<a.length;d++)a[d](S,f,E,g)};return h={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(g){return f/(1e3/(g||60))},wake:function(){NH&&(!HA&&gk()&&(Yu=HA=window,yk=Yu.document||{},ha.gsap=As,(Yu.gsapVersions||(Yu.gsapVersions=[])).push(As.version),LH(Tb||Yu.GreenSockGlobals||!Yu.gsap&&Yu||{}),JH.forEach(eG)),c=typeof requestAnimationFrame<"u"&&requestAnimationFrame,u&&h.sleep(),l=c||function(g){return setTimeout(g,s-h.time*1e3+1|0)},a1=1,p(2))},sleep:function(){(c?cancelAnimationFrame:clearTimeout)(u),a1=0,l=o1},lagSmoothing:function(g,m){e=g||1/0,t=Math.min(m||33,e)},fps:function(g){o=1e3/(g||240),s=h.time*1e3+o},add:function(g,m,x){var _=m?function(b,S,E,C){g(b,S,E,C),h.remove(_)}:g;return h.remove(g),a[x?"unshift":"push"](_),Wv(),_},remove:function(g,m){~(m=a.indexOf(g))&&a.splice(m,1)&&d>=m&&d--},_listeners:a},h}(),Wv=function(){return!a1&&Qs.wake()},An={},qce=/^[\d.\-M][\d.\-,\s]/,Yce=/["']/g,Kce=function(e){for(var t={},r=e.substr(1,e.length-3).split(":"),i=r[0],o=1,s=r.length,a,u,l;o<s;o++)u=r[o],a=o!==s-1?u.lastIndexOf(","):u.length,l=u.substr(0,a),t[i]=isNaN(l)?l.replace(Yce,"").trim():+l,i=u.substr(a+1).trim();return t},Zce=function(e){var t=e.indexOf("(")+1,r=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<r?e.indexOf(")",r+1):r)},Qce=function(e){var t=(e+"").split("("),r=An[t[0]];return r&&t.length>1&&r.config?r.config.apply(null,~e.indexOf("{")?[Kce(t[1])]:Zce(e).split(",").map(zH)):An._CE&&qce.test(e)?An._CE("",e):r},iG=function(e){return function(t){return 1-e(1-t)}},oG=function n(e,t){for(var r=e._first,i;r;)r instanceof qo?n(r,t):r.vars.yoyoEase&&(!r._yoyo||!r._repeat)&&r._yoyo!==t&&(r.timeline?n(r.timeline,t):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=t)),r=r._next},Rd=function(e,t){return e&&(Yr(e)?e:An[e]||Qce(e))||t},op=function(e,t,r,i){r===void 0&&(r=function(u){return 1-t(1-u)}),i===void 0&&(i=function(u){return u<.5?t(u*2)/2:1-t((1-u)*2)/2});var o={easeIn:t,easeOut:r,easeInOut:i},s;return Es(e,function(a){An[a]=ha[a]=o,An[s=a.toLowerCase()]=r;for(var u in o)An[s+(u==="easeIn"?".in":u==="easeOut"?".out":".inOut")]=An[a+"."+u]=o[u]}),o},sG=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},bM=function n(e,t,r){var i=t>=1?t:1,o=(r||(e?.3:.45))/(t<1?t:1),s=o/WA*(Math.asin(1/i)||0),a=function(c){return c===1?1:i*Math.pow(2,-10*c)*Sce((c-s)*o)+1},u=e==="out"?a:e==="in"?function(l){return 1-a(1-l)}:sG(a);return o=WA/o,u.config=function(l,c){return n(e,l,c)},u},SM=function n(e,t){t===void 0&&(t=1.70158);var r=function(s){return s?--s*s*((t+1)*s+t)+1:0},i=e==="out"?r:e==="in"?function(o){return 1-r(1-o)}:sG(r);return i.config=function(o){return n(e,o)},i};Es("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;op(n+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(r*2,t)/2:1-Math.pow((1-r)*2,t)/2})});An.Linear.easeNone=An.none=An.Linear.easeIn;op("Elastic",bM("in"),bM("out"),bM());(function(n,e){var t=1/e,r=2*t,i=2.5*t,o=function(a){return a<t?n*a*a:a<r?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};op("Bounce",function(s){return 1-o(1-s)},o)})(7.5625,2.75);op("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)});op("Circ",function(n){return-(IH(1-n*n)-1)});op("Sine",function(n){return n===1?1:-bce(n*wce)+1});op("Back",SM("in"),SM("out"),SM());An.SteppedEase=An.steps=ha.SteppedEase={config:function(e,t){e===void 0&&(e=1);var r=1/e,i=e+(t?0:1),o=t?1:0,s=1-sr;return function(a){return((i*j1(0,s,a)|0)+o)*r}}};Bv.ease=An["quad.out"];Es("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return _k+=n+","+n+"Params,"});var aG=function(e,t){this.id=_ce++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:BH,this.set=t?t.getSetter:Tk},u1=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Vv(this,+t.duration,1,1),this.data=t.data,br&&(this._ctx=br,br.data.push(this)),a1||Qs.wake()}var e=n.prototype;return e.delay=function(r){return r||r===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+r-this._delay),this._delay=r,this):this._delay},e.duration=function(r){return arguments.length?this.totalDuration(this._repeat>0?r+(r+this._rDelay)*this._repeat:r):this.totalDuration()&&this._dur},e.totalDuration=function(r){return arguments.length?(this._dirty=0,Vv(this,this._repeat<0?r:(r-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(r,i){if(Wv(),!arguments.length)return this._tTime;var o=this._dp;if(o&&o.smoothChildTiming&&this._ts){for(TE(this,r),!o._dp||o.parent||HH(o,this);o&&o.parent;)o.parent._time!==o._start+(o._ts>=0?o._tTime/o._ts:(o.totalDuration()-o._tTime)/-o._ts)&&o.totalTime(o._tTime,!0),o=o.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&r<this._tDur||this._ts<0&&r>0||!this._tDur&&!r)&&tl(this._dp,this,this._start-this._delay)}return(this._tTime!==r||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===sr||!this._initted&&this._dur&&r||!r&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=r),UH(this,r,i)),this},e.time=function(r,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),r+m5(this))%(this._dur+this._rDelay)||(r?this._dur:0),i):this._time},e.totalProgress=function(r,i){return arguments.length?this.totalTime(this.totalDuration()*r,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(r,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-r:r)+m5(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(r,i){var o=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(r-1)*o,i):this._repeat?zv(this._tTime,o)+1:1},e.timeScale=function(r,i){if(!arguments.length)return this._rts===-sr?0:this._rts;if(this._rts===r)return this;var o=this.parent&&this._ts?Ib(this.parent._time,this):this._tTime;return this._rts=+r||0,this._ts=this._ps||r===-sr?0:this._rts,this.totalTime(j1(-Math.abs(this._delay),this.totalDuration(),o),i!==!1),ME(this),Dce(this)},e.paused=function(r){return arguments.length?(this._ps!==r&&(this._ps=r,r?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Wv(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==sr&&(this._tTime-=sr)))),this):this._ps},e.startTime=function(r){if(arguments.length){this._start=Tr(r);var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&tl(i,this,this._start-this._delay),this}return this._start},e.endTime=function(r){return this._start+(Ss(r)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(r){var i=this.parent||this._dp;return i?r&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ib(i.rawTime(r),this):this._tTime:this._tTime},e.revert=function(r){r===void 0&&(r=Ace);var i=io;return io=r,Sk(this)&&(this.timeline&&this.timeline.revert(r),this.totalTime(-.01,r.suppressEvents)),this.data!=="nested"&&r.kill!==!1&&this.kill(),io=i,this},e.globalTime=function(r){for(var i=this,o=arguments.length?r:i.rawTime();i;)o=i._start+o/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(r):o},e.repeat=function(r){return arguments.length?(this._repeat=r===1/0?-2:r,v5(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(r){if(arguments.length){var i=this._time;return this._rDelay=r,v5(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(r){return arguments.length?(this._yoyo=r,this):this._yoyo},e.seek=function(r,i){return this.totalTime(Ma(this,r),Ss(i))},e.restart=function(r,i){return this.play().totalTime(r?-this._delay:0,Ss(i)),this._dur||(this._zTime=-sr),this},e.play=function(r,i){return r!=null&&this.seek(r,i),this.reversed(!1).paused(!1)},e.reverse=function(r,i){return r!=null&&this.seek(r||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(r,i){return r!=null&&this.seek(r,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(r){return arguments.length?(!!r!==this.reversed()&&this.timeScale(-this._rts||(r?-sr:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-sr,this},e.isActive=function(){var r=this.parent||this._dp,i=this._start,o;return!!(!r||this._ts&&this._initted&&r.isActive()&&(o=r.rawTime(!0))>=i&&o<this.endTime(!0)-sr)},e.eventCallback=function(r,i,o){var s=this.vars;return arguments.length>1?(i?(s[r]=i,o&&(s[r+"Params"]=o),r==="onUpdate"&&(this._onUpdate=i)):delete s[r],this):s[r]},e.then=function(r){var i=this,o=i._prom;return new Promise(function(s){var a=Yr(r)?r:VH,u=function(){var c=i.then;i.then=null,o&&o(),Yr(a)&&(a=a(i))&&(a.then||a===i)&&(i.then=c),s(a),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?u():i._prom=u})},e.kill=function(){T0(this)},n}();fa(u1.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-sr,_prom:0,_ps:!1,_rts:1});var qo=function(n){AH(e,n);function e(r,i){var o;return r===void 0&&(r={}),o=n.call(this,r)||this,o.labels={},o.smoothChildTiming=!!r.smoothChildTiming,o.autoRemoveChildren=!!r.autoRemoveChildren,o._sort=Ss(r.sortChildren),Ar&&tl(r.parent||Ar,Gl(o),i),r.reversed&&o.reverse(),r.paused&&o.paused(!0),r.scrollTrigger&&GH(Gl(o),r.scrollTrigger),o}var t=e.prototype;return t.to=function(i,o,s){return Z0(0,arguments,this),this},t.from=function(i,o,s){return Z0(1,arguments,this),this},t.fromTo=function(i,o,s,a){return Z0(2,arguments,this),this},t.set=function(i,o,s){return o.duration=0,o.parent=this,K0(o).repeatDelay||(o.repeat=0),o.immediateRender=!!o.immediateRender,new hi(i,o,Ma(this,s),1),this},t.call=function(i,o,s){return tl(this,hi.delayedCall(0,i,o),s)},t.staggerTo=function(i,o,s,a,u,l,c){return s.duration=o,s.stagger=s.stagger||a,s.onComplete=l,s.onCompleteParams=c,s.parent=this,new hi(i,s,Ma(this,u)),this},t.staggerFrom=function(i,o,s,a,u,l,c){return s.runBackwards=1,K0(s).immediateRender=Ss(s.immediateRender),this.staggerTo(i,o,s,a,u,l,c)},t.staggerFromTo=function(i,o,s,a,u,l,c,h){return a.startAt=s,K0(a).immediateRender=Ss(a.immediateRender),this.staggerTo(i,o,a,u,l,c,h)},t.render=function(i,o,s){var a=this._time,u=this._dirty?this.totalDuration():this._tDur,l=this._dur,c=i<=0?0:Tr(i),h=this._zTime<0!=i<0&&(this._initted||!l),f,d,p,v,g,m,x,_,b,S,E,C;if(this!==Ar&&c>u&&i>=0&&(c=u),c!==this._tTime||s||h){if(a!==this._time&&l&&(c+=this._time-a,i+=this._time-a),f=c,b=this._start,_=this._ts,m=!_,h&&(l||(a=this._zTime),(i||!o)&&(this._zTime=i)),this._repeat){if(E=this._yoyo,g=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(g*100+i,o,s);if(f=Tr(c%g),c===u?(v=this._repeat,f=l):(S=Tr(c/g),v=~~S,v&&v===S&&(f=l,v--),f>l&&(f=l)),S=zv(this._tTime,g),!a&&this._tTime&&S!==v&&this._tTime-S*g-this._dur<=0&&(S=v),E&&v&1&&(f=l-f,C=1),v!==S&&!this._lock){var R=E&&S&1,T=R===(E&&v&1);if(v<S&&(R=!R),a=R?0:c%l?l:c,this._lock=1,this.render(a||(C?0:Tr(v*g)),o,!l)._lock=0,this._tTime=c,!o&&this.parent&&ta(this,"onRepeat"),this.vars.repeatRefresh&&!C&&(this.invalidate()._lock=1,S=v),a&&a!==this._time||m!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,u=this._tDur,T&&(this._lock=2,a=R?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!C&&this.invalidate()),this._lock=0,!this._ts&&!m)return this;oG(this,C)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(x=Oce(this,Tr(a),Tr(f)),x&&(c-=f-(f=x._start))),this._tTime=c,this._time=f,this._act=!_,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&c&&l&&!o&&!S&&(ta(this,"onStart"),this._tTime!==c))return this;if(f>=a&&i>=0)for(d=this._first;d;){if(p=d._next,(d._act||f>=d._start)&&d._ts&&x!==d){if(d.parent!==this)return this.render(i,o,s);if(d.render(d._ts>0?(f-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(f-d._start)*d._ts,o,s),f!==this._time||!this._ts&&!m){x=0,p&&(c+=this._zTime=-sr);break}}d=p}else{d=this._last;for(var A=i<0?i:f;d;){if(p=d._prev,(d._act||A<=d._end)&&d._ts&&x!==d){if(d.parent!==this)return this.render(i,o,s);if(d.render(d._ts>0?(A-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(A-d._start)*d._ts,o,s||io&&Sk(d)),f!==this._time||!this._ts&&!m){x=0,p&&(c+=this._zTime=A?-sr:sr);break}}d=p}}if(x&&!o&&(this.pause(),x.render(f>=a?0:-sr)._zTime=f>=a?1:-1,this._ts))return this._start=b,ME(this),this.render(i,o,s);this._onUpdate&&!o&&ta(this,"onUpdate",!0),(c===u&&this._tTime>=this.totalDuration()||!c&&a)&&(b===this._start||Math.abs(_)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(c===u&&this._ts>0||!c&&this._ts<0)&&$h(this,1),!o&&!(i<0&&!a)&&(c||a||!u)&&(ta(this,c===u&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(c<u&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,o){var s=this;if(yc(o)||(o=Ma(this,o,i)),!(i instanceof u1)){if(Io(i))return i.forEach(function(a){return s.add(a,o)}),this;if(Hi(i))return this.addLabel(i,o);if(Yr(i))i=hi.delayedCall(0,i);else return this}return this!==i?tl(this,i,o):this},t.getChildren=function(i,o,s,a){i===void 0&&(i=!0),o===void 0&&(o=!0),s===void 0&&(s=!0),a===void 0&&(a=-Fa);for(var u=[],l=this._first;l;)l._start>=a&&(l instanceof hi?o&&u.push(l):(s&&u.push(l),i&&u.push.apply(u,l.getChildren(!0,o,s)))),l=l._next;return u},t.getById=function(i){for(var o=this.getChildren(1,1,1),s=o.length;s--;)if(o[s].vars.id===i)return o[s]},t.remove=function(i){return Hi(i)?this.removeLabel(i):Yr(i)?this.killTweensOf(i):(i.parent===this&&CE(this,i),i===this._recent&&(this._recent=this._last),Td(this))},t.totalTime=function(i,o){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Tr(Qs.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,o),this._forcing=0,this):this._tTime},t.addLabel=function(i,o){return this.labels[i]=Ma(this,o),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,o,s){var a=hi.delayedCall(0,o||o1,s);return a.data="isPause",this._hasPause=1,tl(this,a,Ma(this,i))},t.removePause=function(i){var o=this._first;for(i=Ma(this,i);o;)o._start===i&&o.data==="isPause"&&$h(o),o=o._next},t.killTweensOf=function(i,o,s){for(var a=this.getTweensOf(i,s),u=a.length;u--;)dh!==a[u]&&a[u].kill(i,o);return this},t.getTweensOf=function(i,o){for(var s=[],a=Oa(i),u=this._first,l=yc(o),c;u;)u instanceof hi?Ice(u._targets,a)&&(l?(!dh||u._initted&&u._ts)&&u.globalTime(0)<=o&&u.globalTime(u.totalDuration())>o:!o||u.isActive())&&s.push(u):(c=u.getTweensOf(a,o)).length&&s.push.apply(s,c),u=u._next;return s},t.tweenTo=function(i,o){o=o||{};var s=this,a=Ma(s,i),u=o,l=u.startAt,c=u.onStart,h=u.onStartParams,f=u.immediateRender,d,p=hi.to(s,fa({ease:o.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:o.duration||Math.abs((a-(l&&"time"in l?l.time:s._time))/s.timeScale())||sr,onStart:function(){if(s.pause(),!d){var g=o.duration||Math.abs((a-(l&&"time"in l?l.time:s._time))/s.timeScale());p._dur!==g&&Vv(p,g,0,1).render(p._time,!0,!0),d=1}c&&c.apply(p,h||[])}},o));return f?p.render(0):p},t.tweenFromTo=function(i,o,s){return this.tweenTo(o,fa({startAt:{time:Ma(this,i)}},s))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),g5(this,Ma(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),g5(this,Ma(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+sr)},t.shiftChildren=function(i,o,s){s===void 0&&(s=0);var a=this._first,u=this.labels,l;for(i=Tr(i);a;)a._start>=s&&(a._start+=i,a._end+=i),a=a._next;if(o)for(l in u)u[l]>=s&&(u[l]+=i);return Td(this)},t.invalidate=function(i){var o=this._first;for(this._lock=0;o;)o.invalidate(i),o=o._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var o=this._first,s;o;)s=o._next,this.remove(o),o=s;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Td(this)},t.totalDuration=function(i){var o=0,s=this,a=s._last,u=Fa,l,c,h;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-i:i));if(s._dirty){for(h=s.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),c=a._start,c>u&&s._sort&&a._ts&&!s._lock?(s._lock=1,tl(s,a,c-a._delay,1)._lock=0):u=c,c<0&&a._ts&&(o-=c,(!h&&!s._dp||h&&h.smoothChildTiming)&&(s._start+=Tr(c/s._ts),s._time-=c,s._tTime-=c),s.shiftChildren(-c,!1,-1/0),u=0),a._end>o&&a._ts&&(o=a._end),a=l;Vv(s,s===Ar&&s._time>o?s._time:o,1,1),s._dirty=0}return s._tDur},e.updateRoot=function(i){if(Ar._ts&&(UH(Ar,Ib(i,Ar)),OH=Qs.frame),Qs.frame>=d5){d5+=ua.autoSleep||120;var o=Ar._first;if((!o||!o._ts)&&ua.autoSleep&&Qs._listeners.length<2){for(;o&&!o._ts;)o=o._next;o||Qs.sleep()}}},e}(u1);fa(qo.prototype,{_lock:0,_hasPause:0,_forcing:0});var Jce=function(e,t,r,i,o,s,a){var u=new Cs(this._pt,e,t,0,1,dG,null,o),l=0,c=0,h,f,d,p,v,g,m,x;for(u.b=r,u.e=i,r+="",i+="",(m=~i.indexOf("random("))&&(i=s1(i)),s&&(x=[r,i],s(x,e,t),r=x[0],i=x[1]),f=r.match(xM)||[];h=xM.exec(i);)p=h[0],v=i.substring(l,h.index),d?d=(d+1)%5:v.substr(-5)==="rgba("&&(d=1),p!==f[c++]&&(g=parseFloat(f[c-1])||0,u._pt={_next:u._pt,p:v||c===1?v:",",s:g,c:p.charAt(1)==="="?sv(g,p)-g:parseFloat(p)-g,m:d&&d<4?Math.round:0},l=xM.lastIndex);return u.c=l<i.length?i.substring(l,i.length):"",u.fp=a,(DH.test(i)||m)&&(u.e=0),this._pt=u,u},Ek=function(e,t,r,i,o,s,a,u,l,c){Yr(i)&&(i=i(o||0,e,s));var h=e[t],f=r!=="get"?r:Yr(h)?l?e[t.indexOf("set")||!Yr(e["get"+t.substr(3)])?t:"get"+t.substr(3)](l):e[t]():h,d=Yr(h)?l?ihe:hG:Mk,p;if(Hi(i)&&(~i.indexOf("random(")&&(i=s1(i)),i.charAt(1)==="="&&(p=sv(f,i)+(So(f)||0),(p||p===0)&&(i=p))),!c||f!==i||KA)return!isNaN(f*i)&&i!==""?(p=new Cs(this._pt,e,t,+f||0,i-(f||0),typeof h=="boolean"?she:fG,0,d),l&&(p.fp=l),a&&p.modifier(a,this,e),this._pt=p):(!h&&!(t in e)&&xk(t,i),Jce.call(this,e,t,f,i,d,u||ua.stringFilter,l))},ehe=function(e,t,r,i,o){if(Yr(e)&&(e=Q0(e,o,t,r,i)),!xl(e)||e.style&&e.nodeType||Io(e)||PH(e))return Hi(e)?Q0(e,o,t,r,i):e;var s={},a;for(a in e)s[a]=Q0(e[a],o,t,r,i);return s},uG=function(e,t,r,i,o,s){var a,u,l,c;if($s[e]&&(a=new $s[e]).init(o,a.rawVars?t[e]:ehe(t[e],i,o,s,r),r,i,s)!==!1&&(r._pt=u=new Cs(r._pt,o,e,0,1,a.render,a,0,a.priority),r!==Gm))for(l=r._ptLookup[r._targets.indexOf(o)],c=a._props.length;c--;)l[a._props[c]]=u;return a},dh,KA,Ck=function n(e,t,r){var i=e.vars,o=i.ease,s=i.startAt,a=i.immediateRender,u=i.lazy,l=i.onUpdate,c=i.runBackwards,h=i.yoyoEase,f=i.keyframes,d=i.autoRevert,p=e._dur,v=e._startAt,g=e._targets,m=e.parent,x=m&&m.data==="nested"?m.vars.targets:g,_=e._overwrite==="auto"&&!mk,b=e.timeline,S,E,C,R,T,A,P,k,W,N,O,z,V;if(b&&(!f||!o)&&(o="none"),e._ease=Rd(o,Bv.ease),e._yEase=h?iG(Rd(h===!0?o:h,Bv.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!b&&!!i.runBackwards,!b||f&&!i.stagger){if(k=g[0]?Md(g[0]).harness:0,z=k&&i[k.prop],S=Ab(i,wk),v&&(v._zTime<0&&v.progress(1),t<0&&c&&a&&!d?v.render(-1,!0):v.revert(c&&p?N_:Rce),v._lazy=0),s){if($h(e._startAt=hi.set(g,fa({data:"isStart",overwrite:!1,parent:m,immediateRender:!0,lazy:!v&&Ss(u),startAt:null,delay:0,onUpdate:l&&function(){return ta(e,"onUpdate")},stagger:0},s))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(io||!a&&!d)&&e._startAt.revert(N_),a&&p&&t<=0&&r<=0){t&&(e._zTime=t);return}}else if(c&&p&&!v){if(t&&(a=!1),C=fa({overwrite:!1,data:"isFromStart",lazy:a&&!v&&Ss(u),immediateRender:a,stagger:0,parent:m},S),z&&(C[k.prop]=z),$h(e._startAt=hi.set(g,C)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(io?e._startAt.revert(N_):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,sr,sr);else if(!t)return}for(e._pt=e._ptCache=0,u=p&&Ss(u)||u&&!p,E=0;E<g.length;E++){if(T=g[E],P=T._gsap||bk(g)[E]._gsap,e._ptLookup[E]=N={},GA[P.id]&&kh.length&&Rb(),O=x===g?E:x.indexOf(T),k&&(W=new k).init(T,z||S,e,O,x)!==!1&&(e._pt=R=new Cs(e._pt,T,W.name,0,1,W.render,W,0,W.priority),W._props.forEach(function(F){N[F]=R}),W.priority&&(A=1)),!k||z)for(C in S)$s[C]&&(W=uG(C,S,e,O,T,x))?W.priority&&(A=1):N[C]=R=Ek.call(e,T,C,"get",S[C],O,x,0,i.stringFilter);e._op&&e._op[E]&&e.kill(T,e._op[E]),_&&e._pt&&(dh=e,Ar.killTweensOf(T,N,e.globalTime(t)),V=!e.parent,dh=0),e._pt&&u&&(GA[P.id]=1)}A&&pG(e),e._onInit&&e._onInit(e)}e._onUpdate=l,e._initted=(!e._op||e._pt)&&!V,f&&t<=0&&b.render(Fa,!0,!0)},the=function(e,t,r,i,o,s,a,u){var l=(e._pt&&e._ptCache||(e._ptCache={}))[t],c,h,f,d;if(!l)for(l=e._ptCache[t]=[],f=e._ptLookup,d=e._targets.length;d--;){if(c=f[d][t],c&&c.d&&c.d._pt)for(c=c.d._pt;c&&c.p!==t&&c.fp!==t;)c=c._next;if(!c)return KA=1,e.vars[t]="+=0",Ck(e,a),KA=0,u?i1(t+" not eligible for reset"):1;l.push(c)}for(d=l.length;d--;)h=l[d],c=h._pt||h,c.s=(i||i===0)&&!o?i:c.s+(i||0)+s*c.c,c.c=r-c.s,h.e&&(h.e=ei(r)+So(h.e)),h.b&&(h.b=c.s+So(h.b))},nhe=function(e,t){var r=e[0]?Md(e[0]).harness:0,i=r&&r.aliases,o,s,a,u;if(!i)return t;o=Uv({},t);for(s in i)if(s in o)for(u=i[s].split(","),a=u.length;a--;)o[u[a]]=o[s];return o},rhe=function(e,t,r,i){var o=t.ease||i||"power1.inOut",s,a;if(Io(t))a=r[e]||(r[e]=[]),t.forEach(function(u,l){return a.push({t:l/(t.length-1)*100,v:u,e:o})});else for(s in t)a=r[s]||(r[s]=[]),s==="ease"||a.push({t:parseFloat(e),v:t[s],e:o})},Q0=function(e,t,r,i,o){return Yr(e)?e.call(t,r,i,o):Hi(e)&&~e.indexOf("random(")?s1(e):e},lG=_k+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",cG={};Es(lG+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return cG[n]=1});var hi=function(n){AH(e,n);function e(r,i,o,s){var a;typeof i=="number"&&(o.duration=i,i=o,o=null),a=n.call(this,s?i:K0(i))||this;var u=a.vars,l=u.duration,c=u.delay,h=u.immediateRender,f=u.stagger,d=u.overwrite,p=u.keyframes,v=u.defaults,g=u.scrollTrigger,m=u.yoyoEase,x=i.parent||Ar,_=(Io(r)||PH(r)?yc(r[0]):"length"in i)?[r]:Oa(r),b,S,E,C,R,T,A,P;if(a._targets=_.length?bk(_):i1("GSAP target "+r+" not found. https://gsap.com",!ua.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=d,p||f||Cw(l)||Cw(c)){if(i=a.vars,b=a.timeline=new qo({data:"nested",defaults:v||{},targets:x&&x.data==="nested"?x.vars.targets:_}),b.kill(),b.parent=b._dp=Gl(a),b._start=0,f||Cw(l)||Cw(c)){if(C=_.length,A=f&&qH(f),xl(f))for(R in f)~lG.indexOf(R)&&(P||(P={}),P[R]=f[R]);for(S=0;S<C;S++)E=Ab(i,cG),E.stagger=0,m&&(E.yoyoEase=m),P&&Uv(E,P),T=_[S],E.duration=+Q0(l,Gl(a),S,T,_),E.delay=(+Q0(c,Gl(a),S,T,_)||0)-a._delay,!f&&C===1&&E.delay&&(a._delay=c=E.delay,a._start+=c,E.delay=0),b.to(T,E,A?A(S,T,_):0),b._ease=An.none;b.duration()?l=c=0:a.timeline=0}else if(p){K0(fa(b.vars.defaults,{ease:"none"})),b._ease=Rd(p.ease||i.ease||"none");var k=0,W,N,O;if(Io(p))p.forEach(function(z){return b.to(_,z,">")}),b.duration();else{E={};for(R in p)R==="ease"||R==="easeEach"||rhe(R,p[R],E,p.easeEach);for(R in E)for(W=E[R].sort(function(z,V){return z.t-V.t}),k=0,S=0;S<W.length;S++)N=W[S],O={ease:N.e,duration:(N.t-(S?W[S-1].t:0))/100*l},O[R]=N.v,b.to(_,O,k),k+=O.duration;b.duration()<l&&b.to({},{duration:l-b.duration()})}}l||a.duration(l=b.duration())}else a.timeline=0;return d===!0&&!mk&&(dh=Gl(a),Ar.killTweensOf(_),dh=0),tl(x,Gl(a),o),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(h||!l&&!p&&a._start===Tr(x._time)&&Ss(h)&&Nce(Gl(a))&&x.data!=="nested")&&(a._tTime=-sr,a.render(Math.max(0,-c)||0)),g&&GH(Gl(a),g),a}var t=e.prototype;return t.render=function(i,o,s){var a=this._time,u=this._tDur,l=this._dur,c=i<0,h=i>u-sr&&!c?u:i<sr?0:i,f,d,p,v,g,m,x,_,b;if(!l)Fce(this,i,o,s);else if(h!==this._tTime||!i||s||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==c||this._lazy){if(f=h,_=this.timeline,this._repeat){if(v=l+this._rDelay,this._repeat<-1&&c)return this.totalTime(v*100+i,o,s);if(f=Tr(h%v),h===u?(p=this._repeat,f=l):(g=Tr(h/v),p=~~g,p&&p===g?(f=l,p--):f>l&&(f=l)),m=this._yoyo&&p&1,m&&(b=this._yEase,f=l-f),g=zv(this._tTime,v),f===a&&!s&&this._initted&&p===g)return this._tTime=h,this;p!==g&&(_&&this._yEase&&oG(_,m),this.vars.repeatRefresh&&!m&&!this._lock&&f!==v&&this._initted&&(this._lock=s=1,this.render(Tr(v*p),!0).invalidate()._lock=0))}if(!this._initted){if($H(this,c?i:f,s,o,h))return this._tTime=0,this;if(a!==this._time&&!(s&&this.vars.repeatRefresh&&p!==g))return this;if(l!==this._dur)return this.render(i,o,s)}if(this._tTime=h,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=x=(b||this._ease)(f/l),this._from&&(this.ratio=x=1-x),!a&&h&&!o&&!g&&(ta(this,"onStart"),this._tTime!==h))return this;for(d=this._pt;d;)d.r(x,d.d),d=d._next;_&&_.render(i<0?i:_._dur*_._ease(f/this._dur),o,s)||this._startAt&&(this._zTime=i),this._onUpdate&&!o&&(c&&$A(this,i,o,s),ta(this,"onUpdate")),this._repeat&&p!==g&&this.vars.onRepeat&&!o&&this.parent&&ta(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(c&&!this._onUpdate&&$A(this,i,!0,!0),(i||!l)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&$h(this,1),!o&&!(c&&!a)&&(h||a||m)&&(ta(this,h===u?"onComplete":"onReverseComplete",!0),this._prom&&!(h<u&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,o,s,a,u){a1||Qs.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),c;return this._initted||Ck(this,l),c=this._ease(l/this._dur),the(this,i,o,s,a,c,l,u)?this.resetTo(i,o,s,a,1):(TE(this,0),this.parent||WH(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,o){if(o===void 0&&(o="all"),!i&&(!o||o==="all"))return this._lazy=this._pt=0,this.parent?T0(this):this.scrollTrigger&&this.scrollTrigger.kill(!!io),this;if(this.timeline){var s=this.timeline.totalDuration();return this.timeline.killTweensOf(i,o,dh&&dh.vars.overwrite!==!0)._first||T0(this),this.parent&&s!==this.timeline.totalDuration()&&Vv(this,this._dur*this.timeline._tDur/s,0,1),this}var a=this._targets,u=i?Oa(i):a,l=this._ptLookup,c=this._pt,h,f,d,p,v,g,m;if((!o||o==="all")&&kce(a,u))return o==="all"&&(this._pt=0),T0(this);for(h=this._op=this._op||[],o!=="all"&&(Hi(o)&&(v={},Es(o,function(x){return v[x]=1}),o=v),o=nhe(a,o)),m=a.length;m--;)if(~u.indexOf(a[m])){f=l[m],o==="all"?(h[m]=o,p=f,d={}):(d=h[m]=h[m]||{},p=o);for(v in p)g=f&&f[v],g&&((!("kill"in g.d)||g.d.kill(v)===!0)&&CE(this,g,"_pt"),delete f[v]),d!=="all"&&(d[v]=1)}return this._initted&&!this._pt&&c&&T0(this),this},e.to=function(i,o){return new e(i,o,arguments[2])},e.from=function(i,o){return Z0(1,arguments)},e.delayedCall=function(i,o,s,a){return new e(o,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:o,onReverseComplete:o,onCompleteParams:s,onReverseCompleteParams:s,callbackScope:a})},e.fromTo=function(i,o,s){return Z0(2,arguments)},e.set=function(i,o){return o.duration=0,o.repeatDelay||(o.repeat=0),new e(i,o)},e.killTweensOf=function(i,o,s){return Ar.killTweensOf(i,o,s)},e}(u1);fa(hi.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Es("staggerTo,staggerFrom,staggerFromTo",function(n){hi[n]=function(){var e=new qo,t=XA.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var Mk=function(e,t,r){return e[t]=r},hG=function(e,t,r){return e[t](r)},ihe=function(e,t,r,i){return e[t](i.fp,r)},ohe=function(e,t,r){return e.setAttribute(t,r)},Tk=function(e,t){return Yr(e[t])?hG:vk(e[t])&&e.setAttribute?ohe:Mk},fG=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},she=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},dG=function(e,t){var r=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;r;)i=r.p+(r.m?r.m(r.s+r.c*e):Math.round((r.s+r.c*e)*1e4)/1e4)+i,r=r._next;i+=t.c}t.set(t.t,t.p,i,t)},Rk=function(e,t){for(var r=t._pt;r;)r.r(e,r.d),r=r._next},ahe=function(e,t,r,i){for(var o=this._pt,s;o;)s=o._next,o.p===i&&o.modifier(e,t,r),o=s},uhe=function(e){for(var t=this._pt,r,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?CE(this,t,"_pt"):t.dep||(r=1),t=i;return!r},lhe=function(e,t,r,i){i.mSet(e,t,i.m.call(i.tween,r,i.mt),i)},pG=function(e){for(var t=e._pt,r,i,o,s;t;){for(r=t._next,i=o;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:s)?t._prev._next=t:o=t,(t._next=i)?i._prev=t:s=t,t=r}e._pt=o},Cs=function(){function n(t,r,i,o,s,a,u,l,c){this.t=r,this.s=o,this.c=s,this.p=i,this.r=a||fG,this.d=u||this,this.set=l||Mk,this.pr=c||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(r,i,o){this.mSet=this.mSet||this.set,this.set=lhe,this.m=r,this.mt=o,this.tween=i},n}();Es(_k+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return wk[n]=1});ha.TweenMax=ha.TweenLite=hi;ha.TimelineLite=ha.TimelineMax=qo;Ar=new qo({sortChildren:!1,defaults:Bv,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});ua.stringFilter=rG;var Ad=[],F_={},che=[],x5=0,hhe=0,EM=function(e){return(F_[e]||che).map(function(t){return t()})},ZA=function(){var e=Date.now(),t=[];e-x5>2&&(EM("matchMediaInit"),Ad.forEach(function(r){var i=r.queries,o=r.conditions,s,a,u,l;for(a in i)s=Yu.matchMedia(i[a]).matches,s&&(u=1),s!==o[a]&&(o[a]=s,l=1);l&&(r.revert(),u&&t.push(r))}),EM("matchMediaRevert"),t.forEach(function(r){return r.onMatch(r,function(i){return r.add(null,i)})}),x5=e,EM("matchMedia"))},mG=function(){function n(t,r){this.selector=r&&qA(r),this.data=[],this._r=[],this.isReverted=!1,this.id=hhe++,t&&this.add(t)}var e=n.prototype;return e.add=function(r,i,o){Yr(r)&&(o=i,i=r,r=Yr);var s=this,a=function(){var l=br,c=s.selector,h;return l&&l!==s&&l.data.push(s),o&&(s.selector=qA(o)),br=s,h=i.apply(s,arguments),Yr(h)&&s._r.push(h),br=l,s.selector=c,s.isReverted=!1,h};return s.last=a,r===Yr?a(s,function(u){return s.add(null,u)}):r?s[r]=a:a},e.ignore=function(r){var i=br;br=null,r(this),br=i},e.getTweens=function(){var r=[];return this.data.forEach(function(i){return i instanceof n?r.push.apply(r,i.getTweens()):i instanceof hi&&!(i.parent&&i.parent.data==="nested")&&r.push(i)}),r},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(r,i){var o=this;if(r?function(){for(var a=o.getTweens(),u=o.data.length,l;u--;)l=o.data[u],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(c){return a.splice(a.indexOf(c),1)}));for(a.map(function(c){return{g:c._dur||c._delay||c._sat&&!c._sat.vars.immediateRender?c.globalTime(0):-1/0,t:c}}).sort(function(c,h){return h.g-c.g||-1/0}).forEach(function(c){return c.t.revert(r)}),u=o.data.length;u--;)l=o.data[u],l instanceof qo?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof hi)&&l.revert&&l.revert(r);o._r.forEach(function(c){return c(r,o)}),o.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var s=Ad.length;s--;)Ad[s].id===this.id&&Ad.splice(s,1)},e.revert=function(r){this.kill(r||{})},n}(),fhe=function(){function n(t){this.contexts=[],this.scope=t,br&&br.data.push(this)}var e=n.prototype;return e.add=function(r,i,o){xl(r)||(r={matches:r});var s=new mG(0,o||this.scope),a=s.conditions={},u,l,c;br&&!s.selector&&(s.selector=br.selector),this.contexts.push(s),i=s.add("onMatch",i),s.queries=r;for(l in r)l==="all"?c=1:(u=Yu.matchMedia(r[l]),u&&(Ad.indexOf(s)<0&&Ad.push(s),(a[l]=u.matches)&&(c=1),u.addListener?u.addListener(ZA):u.addEventListener("change",ZA)));return c&&i(s,function(h){return s.add(null,h)}),this},e.revert=function(r){this.kill(r||{})},e.kill=function(r){this.contexts.forEach(function(i){return i.kill(r,!0)})},n}(),Pb={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(function(i){return eG(i)})},timeline:function(e){return new qo(e)},getTweensOf:function(e,t){return Ar.getTweensOf(e,t)},getProperty:function(e,t,r,i){Hi(e)&&(e=Oa(e)[0]);var o=Md(e||{}).get,s=r?VH:zH;return r==="native"&&(r=""),e&&(t?s(($s[t]&&$s[t].get||o)(e,t,r,i)):function(a,u,l){return s(($s[a]&&$s[a].get||o)(e,a,u,l))})},quickSetter:function(e,t,r){if(e=Oa(e),e.length>1){var i=e.map(function(c){return As.quickSetter(c,t,r)}),o=i.length;return function(c){for(var h=o;h--;)i[h](c)}}e=e[0]||{};var s=$s[t],a=Md(e),u=a.harness&&(a.harness.aliases||{})[t]||t,l=s?function(c){var h=new s;Gm._pt=0,h.init(e,r?c+r:c,Gm,0,[e]),h.render(1,h),Gm._pt&&Rk(1,Gm)}:a.set(e,u);return s?l:function(c){return l(e,u,r?c+r:c,a,1)}},quickTo:function(e,t,r){var i,o=As.to(e,fa((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),r||{})),s=function(u,l,c){return o.resetTo(t,u,l,c)};return s.tween=o,s},isTweening:function(e){return Ar.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Rd(e.ease,Bv.ease)),p5(Bv,e||{})},config:function(e){return p5(ua,e||{})},registerEffect:function(e){var t=e.name,r=e.effect,i=e.plugins,o=e.defaults,s=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!$s[a]&&!ha[a]&&i1(t+" effect requires "+a+" plugin.")}),wM[t]=function(a,u,l){return r(Oa(a),fa(u||{},o),l)},s&&(qo.prototype[t]=function(a,u,l){return this.add(wM[t](a,xl(u)?u:(l=u)&&{},this),l)})},registerEase:function(e,t){An[e]=Rd(t)},parseEase:function(e,t){return arguments.length?Rd(e,t):An},getById:function(e){return Ar.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var r=new qo(e),i,o;for(r.smoothChildTiming=Ss(e.smoothChildTiming),Ar.remove(r),r._dp=0,r._time=r._tTime=Ar._time,i=Ar._first;i;)o=i._next,(t||!(!i._dur&&i instanceof hi&&i.vars.onComplete===i._targets[0]))&&tl(r,i,i._start-i._delay),i=o;return tl(Ar,r,0),r},context:function(e,t){return e?new mG(e,t):br},matchMedia:function(e){return new fhe(e)},matchMediaRefresh:function(){return Ad.forEach(function(e){var t=e.conditions,r,i;for(i in t)t[i]&&(t[i]=!1,r=1);r&&e.revert()})||ZA()},addEventListener:function(e,t){var r=F_[e]||(F_[e]=[]);~r.indexOf(t)||r.push(t)},removeEventListener:function(e,t){var r=F_[e],i=r&&r.indexOf(t);i>=0&&r.splice(i,1)},utils:{wrap:Gce,wrapYoyo:$ce,distribute:qH,random:KH,snap:YH,normalize:Hce,getUnit:So,clamp:Uce,splitColor:tG,toArray:Oa,selector:qA,mapRange:QH,pipe:Vce,unitize:Wce,interpolate:jce,shuffle:XH},install:LH,effects:wM,ticker:Qs,updateRoot:qo.updateRoot,plugins:$s,globalTimeline:Ar,core:{PropTween:Cs,globals:FH,Tween:hi,Timeline:qo,Animation:u1,getCache:Md,_removeLinkedListItem:CE,reverting:function(){return io},context:function(e){return e&&br&&(br.data.push(e),e._ctx=br),br},suppressOverwrites:function(e){return mk=e}}};Es("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return Pb[n]=hi[n]});Qs.add(qo.updateRoot);Gm=Pb.to({},{duration:0});var dhe=function(e,t){for(var r=e._pt;r&&r.p!==t&&r.op!==t&&r.fp!==t;)r=r._next;return r},phe=function(e,t){var r=e._targets,i,o,s;for(i in t)for(o=r.length;o--;)s=e._ptLookup[o][i],s&&(s=s.d)&&(s._pt&&(s=dhe(s,i)),s&&s.modifier&&s.modifier(t[i],e,r[o],i))},CM=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,o,s){s._onInit=function(a){var u,l;if(Hi(o)&&(u={},Es(o,function(c){return u[c]=1}),o=u),t){u={};for(l in o)u[l]=t(o[l]);o=u}phe(a,o)}}}},As=Pb.registerPlugin({name:"attr",init:function(e,t,r,i,o){var s,a,u;this.tween=r;for(s in t)u=e.getAttribute(s)||"",a=this.add(e,"setAttribute",(u||0)+"",t[s],i,o,0,0,s),a.op=s,a.b=u,this._props.push(s)},render:function(e,t){for(var r=t._pt;r;)io?r.set(r.t,r.p,r.b,r):r.r(e,r.d),r=r._next}},{name:"endArray",headless:1,init:function(e,t){for(var r=t.length;r--;)this.add(e,r,e[r]||0,t[r],0,0,0,0,0,1)}},CM("roundProps",YA),CM("modifiers"),CM("snap",YH))||Pb;hi.version=qo.version=As.version="3.14.2";NH=1;gk()&&Wv();An.Power0;An.Power1;An.Power2;An.Power3;An.Power4;An.Linear;An.Quad;An.Cubic;An.Quart;An.Quint;An.Strong;An.Elastic;An.Back;An.SteppedEase;An.Bounce;An.Sine;An.Expo;An.Circ;/*!
 * CSSPlugin 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var w5,ph,av,Ak,fd,_5,Ik,mhe=function(){return typeof window<"u"},xc={},Xf=180/Math.PI,uv=Math.PI/180,Jp=Math.atan2,b5=1e8,Pk=/([A-Z])/g,vhe=/(left|right|width|margin|padding|x)/i,ghe=/[\s,\(]\S/,ol={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},QA=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},yhe=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},xhe=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},whe=function(e,t){return t.set(t.t,t.p,e===1?t.e:e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},_he=function(e,t){var r=t.s+t.c*e;t.set(t.t,t.p,~~(r+(r<0?-.5:.5))+t.u,t)},vG=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},gG=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},bhe=function(e,t,r){return e.style[t]=r},She=function(e,t,r){return e.style.setProperty(t,r)},Ehe=function(e,t,r){return e._gsap[t]=r},Che=function(e,t,r){return e._gsap.scaleX=e._gsap.scaleY=r},Mhe=function(e,t,r,i,o){var s=e._gsap;s.scaleX=s.scaleY=r,s.renderTransform(o,s)},The=function(e,t,r,i,o){var s=e._gsap;s[t]=r,s.renderTransform(o,s)},Pr="transform",Ms=Pr+"Origin",Rhe=function n(e,t){var r=this,i=this.target,o=i.style,s=i._gsap;if(e in xc&&o){if(this.tfm=this.tfm||{},e!=="transform")e=ol[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return r.tfm[a]=jl(i,a)}):this.tfm[e]=s.x?s[e]:jl(i,e),e===Ms&&(this.tfm.zOrigin=s.zOrigin);else return ol.transform.split(",").forEach(function(a){return n.call(r,a,t)});if(this.props.indexOf(Pr)>=0)return;s.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(Ms,t,"")),e=Pr}(o||t)&&this.props.push(e,t,o[e])},yG=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},Ahe=function(){var e=this.props,t=this.target,r=t.style,i=t._gsap,o,s;for(o=0;o<e.length;o+=3)e[o+1]?e[o+1]===2?t[e[o]](e[o+2]):t[e[o]]=e[o+2]:e[o+2]?r[e[o]]=e[o+2]:r.removeProperty(e[o].substr(0,2)==="--"?e[o]:e[o].replace(Pk,"-$1").toLowerCase());if(this.tfm){for(s in this.tfm)i[s]=this.tfm[s];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),o=Ik(),(!o||!o.isStart)&&!r[Pr]&&(yG(r),i.zOrigin&&r[Ms]&&(r[Ms]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},xG=function(e,t){var r={target:e,props:[],revert:Ahe,save:Rhe};return e._gsap||As.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return r.save(i)}),r},wG,JA=function(e,t){var r=ph.createElementNS?ph.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ph.createElement(e);return r&&r.style?r:ph.createElement(e)},na=function n(e,t,r){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Pk,"-$1").toLowerCase())||i.getPropertyValue(t)||!r&&n(e,Hv(t)||t,1)||""},S5="O,Moz,ms,Ms,Webkit".split(","),Hv=function(e,t,r){var i=t||fd,o=i.style,s=5;if(e in o&&!r)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);s--&&!(S5[s]+e in o););return s<0?null:(s===3?"ms":s>=0?S5[s]:"")+e},eI=function(){mhe()&&window.document&&(w5=window,ph=w5.document,av=ph.documentElement,fd=JA("div")||{style:{}},JA("div"),Pr=Hv(Pr),Ms=Pr+"Origin",fd.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",wG=!!Hv("perspective"),Ik=As.core.reverting,Ak=1)},E5=function(e){var t=e.ownerSVGElement,r=JA("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),o;i.style.display="block",r.appendChild(i),av.appendChild(r);try{o=i.getBBox()}catch{}return r.removeChild(i),av.removeChild(r),o},C5=function(e,t){for(var r=t.length;r--;)if(e.hasAttribute(t[r]))return e.getAttribute(t[r])},_G=function(e){var t,r;try{t=e.getBBox()}catch{t=E5(e),r=1}return t&&(t.width||t.height)||r||(t=E5(e)),t&&!t.width&&!t.x&&!t.y?{x:+C5(e,["x","cx","x1"])||0,y:+C5(e,["y","cy","y1"])||0,width:0,height:0}:t},bG=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&_G(e))},jh=function(e,t){if(t){var r=e.style,i;t in xc&&t!==Ms&&(t=Pr),r.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),r.removeProperty(i==="--"?t:t.replace(Pk,"-$1").toLowerCase())):r.removeAttribute(t)}},mh=function(e,t,r,i,o,s){var a=new Cs(e._pt,t,r,0,1,s?gG:vG);return e._pt=a,a.b=i,a.e=o,e._props.push(r),a},M5={deg:1,rad:1,turn:1},Ihe={grid:1,flex:1},Xh=function n(e,t,r,i){var o=parseFloat(r)||0,s=(r+"").trim().substr((o+"").length)||"px",a=fd.style,u=vhe.test(t),l=e.tagName.toLowerCase()==="svg",c=(l?"client":"offset")+(u?"Width":"Height"),h=100,f=i==="px",d=i==="%",p,v,g,m;if(i===s||!o||M5[i]||M5[s])return o;if(s!=="px"&&!f&&(o=n(e,t,r,"px")),m=e.getCTM&&bG(e),(d||s==="%")&&(xc[t]||~t.indexOf("adius")))return p=m?e.getBBox()[u?"width":"height"]:e[c],ei(d?o/p*h:o/100*p);if(a[u?"width":"height"]=h+(f?s:i),v=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!l?e:e.parentNode,m&&(v=(e.ownerSVGElement||{}).parentNode),(!v||v===ph||!v.appendChild)&&(v=ph.body),g=v._gsap,g&&d&&g.width&&u&&g.time===Qs.time&&!g.uncache)return ei(o/g.width*h);if(d&&(t==="height"||t==="width")){var x=e.style[t];e.style[t]=h+i,p=e[c],x?e.style[t]=x:jh(e,t)}else(d||s==="%")&&!Ihe[na(v,"display")]&&(a.position=na(e,"position")),v===e&&(a.position="static"),v.appendChild(fd),p=fd[c],v.removeChild(fd),a.position="absolute";return u&&d&&(g=Md(v),g.time=Qs.time,g.width=v[c]),ei(f?p*o/h:p&&o?h/p*o:0)},jl=function(e,t,r,i){var o;return Ak||eI(),t in ol&&t!=="transform"&&(t=ol[t],~t.indexOf(",")&&(t=t.split(",")[0])),xc[t]&&t!=="transform"?(o=c1(e,i),o=t!=="transformOrigin"?o[t]:o.svg?o.origin:Db(na(e,Ms))+" "+o.zOrigin+"px"):(o=e.style[t],(!o||o==="auto"||i||~(o+"").indexOf("calc("))&&(o=kb[t]&&kb[t](e,t,r)||na(e,t)||BH(e,t)||(t==="opacity"?1:0))),r&&!~(o+"").trim().indexOf(" ")?Xh(e,t,o,r)+r:o},Phe=function(e,t,r,i){if(!r||r==="none"){var o=Hv(t,e,1),s=o&&na(e,o,1);s&&s!==r?(t=o,r=s):t==="borderColor"&&(r=na(e,"borderTopColor"))}var a=new Cs(this._pt,e.style,t,0,1,dG),u=0,l=0,c,h,f,d,p,v,g,m,x,_,b,S;if(a.b=r,a.e=i,r+="",i+="",i.substring(0,6)==="var(--"&&(i=na(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(v=e.style[t],e.style[t]=i,i=na(e,t)||i,v?e.style[t]=v:jh(e,t)),c=[r,i],rG(c),r=c[0],i=c[1],f=r.match(Hm)||[],S=i.match(Hm)||[],S.length){for(;h=Hm.exec(i);)g=h[0],x=i.substring(u,h.index),p?p=(p+1)%5:(x.substr(-5)==="rgba("||x.substr(-5)==="hsla(")&&(p=1),g!==(v=f[l++]||"")&&(d=parseFloat(v)||0,b=v.substr((d+"").length),g.charAt(1)==="="&&(g=sv(d,g)+b),m=parseFloat(g),_=g.substr((m+"").length),u=Hm.lastIndex-_.length,_||(_=_||ua.units[t]||b,u===i.length&&(i+=_,a.e+=_)),b!==_&&(d=Xh(e,t,v,_)||0),a._pt={_next:a._pt,p:x||l===1?x:",",s:d,c:m-d,m:p&&p<4||t==="zIndex"?Math.round:0});a.c=u<i.length?i.substring(u,i.length):""}else a.r=t==="display"&&i==="none"?gG:vG;return DH.test(i)&&(a.e=0),this._pt=a,a},T5={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},khe=function(e){var t=e.split(" "),r=t[0],i=t[1]||"50%";return(r==="top"||r==="bottom"||i==="left"||i==="right")&&(e=r,r=i,i=e),t[0]=T5[r]||r,t[1]=T5[i]||i,t.join(" ")},Dhe=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var r=t.t,i=r.style,o=t.u,s=r._gsap,a,u,l;if(o==="all"||o===!0)i.cssText="",u=1;else for(o=o.split(","),l=o.length;--l>-1;)a=o[l],xc[a]&&(u=1,a=a==="transformOrigin"?Ms:Pr),jh(r,a);u&&(jh(r,Pr),s&&(s.svg&&r.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",c1(r,1),s.uncache=1,yG(i)))}},kb={clearProps:function(e,t,r,i,o){if(o.data!=="isFromStart"){var s=e._pt=new Cs(e._pt,t,r,0,0,Dhe);return s.u=i,s.pr=-10,s.tween=o,e._props.push(r),1}}},l1=[1,0,0,1,0,0],SG={},EG=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},R5=function(e){var t=na(e,Pr);return EG(t)?l1:t.substr(7).match(kH).map(ei)},kk=function(e,t){var r=e._gsap||Md(e),i=e.style,o=R5(e),s,a,u,l;return r.svg&&e.getAttribute("transform")?(u=e.transform.baseVal.consolidate().matrix,o=[u.a,u.b,u.c,u.d,u.e,u.f],o.join(",")==="1,0,0,1,0,0"?l1:o):(o===l1&&!e.offsetParent&&e!==av&&!r.svg&&(u=i.display,i.display="block",s=e.parentNode,(!s||!e.offsetParent&&!e.getBoundingClientRect().width)&&(l=1,a=e.nextElementSibling,av.appendChild(e)),o=R5(e),u?i.display=u:jh(e,"display"),l&&(a?s.insertBefore(e,a):s?s.appendChild(e):av.removeChild(e))),t&&o.length>6?[o[0],o[1],o[4],o[5],o[12],o[13]]:o)},tI=function(e,t,r,i,o,s){var a=e._gsap,u=o||kk(e,!0),l=a.xOrigin||0,c=a.yOrigin||0,h=a.xOffset||0,f=a.yOffset||0,d=u[0],p=u[1],v=u[2],g=u[3],m=u[4],x=u[5],_=t.split(" "),b=parseFloat(_[0])||0,S=parseFloat(_[1])||0,E,C,R,T;r?u!==l1&&(C=d*g-p*v)&&(R=b*(g/C)+S*(-v/C)+(v*x-g*m)/C,T=b*(-p/C)+S*(d/C)-(d*x-p*m)/C,b=R,S=T):(E=_G(e),b=E.x+(~_[0].indexOf("%")?b/100*E.width:b),S=E.y+(~(_[1]||_[0]).indexOf("%")?S/100*E.height:S)),i||i!==!1&&a.smooth?(m=b-l,x=S-c,a.xOffset=h+(m*d+x*v)-m,a.yOffset=f+(m*p+x*g)-x):a.xOffset=a.yOffset=0,a.xOrigin=b,a.yOrigin=S,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!r,e.style[Ms]="0px 0px",s&&(mh(s,a,"xOrigin",l,b),mh(s,a,"yOrigin",c,S),mh(s,a,"xOffset",h,a.xOffset),mh(s,a,"yOffset",f,a.yOffset)),e.setAttribute("data-svg-origin",b+" "+S)},c1=function(e,t){var r=e._gsap||new aG(e);if("x"in r&&!t&&!r.uncache)return r;var i=e.style,o=r.scaleX<0,s="px",a="deg",u=getComputedStyle(e),l=na(e,Ms)||"0",c,h,f,d,p,v,g,m,x,_,b,S,E,C,R,T,A,P,k,W,N,O,z,V,F,U,L,j,Q,K,ie,pe;return c=h=f=v=g=m=x=_=b=0,d=p=1,r.svg=!!(e.getCTM&&bG(e)),u.translate&&((u.translate!=="none"||u.scale!=="none"||u.rotate!=="none")&&(i[Pr]=(u.translate!=="none"?"translate3d("+(u.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(u.rotate!=="none"?"rotate("+u.rotate+") ":"")+(u.scale!=="none"?"scale("+u.scale.split(" ").join(",")+") ":"")+(u[Pr]!=="none"?u[Pr]:"")),i.scale=i.rotate=i.translate="none"),C=kk(e,r.svg),r.svg&&(r.uncache?(F=e.getBBox(),l=r.xOrigin-F.x+"px "+(r.yOrigin-F.y)+"px",V=""):V=!t&&e.getAttribute("data-svg-origin"),tI(e,V||l,!!V||r.originIsAbsolute,r.smooth!==!1,C)),S=r.xOrigin||0,E=r.yOrigin||0,C!==l1&&(P=C[0],k=C[1],W=C[2],N=C[3],c=O=C[4],h=z=C[5],C.length===6?(d=Math.sqrt(P*P+k*k),p=Math.sqrt(N*N+W*W),v=P||k?Jp(k,P)*Xf:0,x=W||N?Jp(W,N)*Xf+v:0,x&&(p*=Math.abs(Math.cos(x*uv))),r.svg&&(c-=S-(S*P+E*W),h-=E-(S*k+E*N))):(pe=C[6],K=C[7],L=C[8],j=C[9],Q=C[10],ie=C[11],c=C[12],h=C[13],f=C[14],R=Jp(pe,Q),g=R*Xf,R&&(T=Math.cos(-R),A=Math.sin(-R),V=O*T+L*A,F=z*T+j*A,U=pe*T+Q*A,L=O*-A+L*T,j=z*-A+j*T,Q=pe*-A+Q*T,ie=K*-A+ie*T,O=V,z=F,pe=U),R=Jp(-W,Q),m=R*Xf,R&&(T=Math.cos(-R),A=Math.sin(-R),V=P*T-L*A,F=k*T-j*A,U=W*T-Q*A,ie=N*A+ie*T,P=V,k=F,W=U),R=Jp(k,P),v=R*Xf,R&&(T=Math.cos(R),A=Math.sin(R),V=P*T+k*A,F=O*T+z*A,k=k*T-P*A,z=z*T-O*A,P=V,O=F),g&&Math.abs(g)+Math.abs(v)>359.9&&(g=v=0,m=180-m),d=ei(Math.sqrt(P*P+k*k+W*W)),p=ei(Math.sqrt(z*z+pe*pe)),R=Jp(O,z),x=Math.abs(R)>2e-4?R*Xf:0,b=ie?1/(ie<0?-ie:ie):0),r.svg&&(V=e.getAttribute("transform"),r.forceCSS=e.setAttribute("transform","")||!EG(na(e,Pr)),V&&e.setAttribute("transform",V))),Math.abs(x)>90&&Math.abs(x)<270&&(o?(d*=-1,x+=v<=0?180:-180,v+=v<=0?180:-180):(p*=-1,x+=x<=0?180:-180)),t=t||r.uncache,r.x=c-((r.xPercent=c&&(!t&&r.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-c)?-50:0)))?e.offsetWidth*r.xPercent/100:0)+s,r.y=h-((r.yPercent=h&&(!t&&r.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*r.yPercent/100:0)+s,r.z=f+s,r.scaleX=ei(d),r.scaleY=ei(p),r.rotation=ei(v)+a,r.rotationX=ei(g)+a,r.rotationY=ei(m)+a,r.skewX=x+a,r.skewY=_+a,r.transformPerspective=b+s,(r.zOrigin=parseFloat(l.split(" ")[2])||!t&&r.zOrigin||0)&&(i[Ms]=Db(l)),r.xOffset=r.yOffset=0,r.force3D=ua.force3D,r.renderTransform=r.svg?Lhe:wG?CG:Nhe,r.uncache=0,r},Db=function(e){return(e=e.split(" "))[0]+" "+e[1]},MM=function(e,t,r){var i=So(t);return ei(parseFloat(t)+parseFloat(Xh(e,"x",r+"px",i)))+i},Nhe=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,CG(e,t)},Of="0deg",s0="0px",Bf=") ",CG=function(e,t){var r=t||this,i=r.xPercent,o=r.yPercent,s=r.x,a=r.y,u=r.z,l=r.rotation,c=r.rotationY,h=r.rotationX,f=r.skewX,d=r.skewY,p=r.scaleX,v=r.scaleY,g=r.transformPerspective,m=r.force3D,x=r.target,_=r.zOrigin,b="",S=m==="auto"&&e&&e!==1||m===!0;if(_&&(h!==Of||c!==Of)){var E=parseFloat(c)*uv,C=Math.sin(E),R=Math.cos(E),T;E=parseFloat(h)*uv,T=Math.cos(E),s=MM(x,s,C*T*-_),a=MM(x,a,-Math.sin(E)*-_),u=MM(x,u,R*T*-_+_)}g!==s0&&(b+="perspective("+g+Bf),(i||o)&&(b+="translate("+i+"%, "+o+"%) "),(S||s!==s0||a!==s0||u!==s0)&&(b+=u!==s0||S?"translate3d("+s+", "+a+", "+u+") ":"translate("+s+", "+a+Bf),l!==Of&&(b+="rotate("+l+Bf),c!==Of&&(b+="rotateY("+c+Bf),h!==Of&&(b+="rotateX("+h+Bf),(f!==Of||d!==Of)&&(b+="skew("+f+", "+d+Bf),(p!==1||v!==1)&&(b+="scale("+p+", "+v+Bf),x.style[Pr]=b||"translate(0, 0)"},Lhe=function(e,t){var r=t||this,i=r.xPercent,o=r.yPercent,s=r.x,a=r.y,u=r.rotation,l=r.skewX,c=r.skewY,h=r.scaleX,f=r.scaleY,d=r.target,p=r.xOrigin,v=r.yOrigin,g=r.xOffset,m=r.yOffset,x=r.forceCSS,_=parseFloat(s),b=parseFloat(a),S,E,C,R,T;u=parseFloat(u),l=parseFloat(l),c=parseFloat(c),c&&(c=parseFloat(c),l+=c,u+=c),u||l?(u*=uv,l*=uv,S=Math.cos(u)*h,E=Math.sin(u)*h,C=Math.sin(u-l)*-f,R=Math.cos(u-l)*f,l&&(c*=uv,T=Math.tan(l-c),T=Math.sqrt(1+T*T),C*=T,R*=T,c&&(T=Math.tan(c),T=Math.sqrt(1+T*T),S*=T,E*=T)),S=ei(S),E=ei(E),C=ei(C),R=ei(R)):(S=h,R=f,E=C=0),(_&&!~(s+"").indexOf("px")||b&&!~(a+"").indexOf("px"))&&(_=Xh(d,"x",s,"px"),b=Xh(d,"y",a,"px")),(p||v||g||m)&&(_=ei(_+p-(p*S+v*C)+g),b=ei(b+v-(p*E+v*R)+m)),(i||o)&&(T=d.getBBox(),_=ei(_+i/100*T.width),b=ei(b+o/100*T.height)),T="matrix("+S+","+E+","+C+","+R+","+_+","+b+")",d.setAttribute("transform",T),x&&(d.style[Pr]=T)},Fhe=function(e,t,r,i,o){var s=360,a=Hi(o),u=parseFloat(o)*(a&&~o.indexOf("rad")?Xf:1),l=u-i,c=i+l+"deg",h,f;return a&&(h=o.split("_")[1],h==="short"&&(l%=s,l!==l%(s/2)&&(l+=l<0?s:-s)),h==="cw"&&l<0?l=(l+s*b5)%s-~~(l/s)*s:h==="ccw"&&l>0&&(l=(l-s*b5)%s-~~(l/s)*s)),e._pt=f=new Cs(e._pt,t,r,i,l,yhe),f.e=c,f.u="deg",e._props.push(r),f},A5=function(e,t){for(var r in t)e[r]=t[r];return e},Ohe=function(e,t,r){var i=A5({},r._gsap),o="perspective,force3D,transformOrigin,svgOrigin",s=r.style,a,u,l,c,h,f,d,p;i.svg?(l=r.getAttribute("transform"),r.setAttribute("transform",""),s[Pr]=t,a=c1(r,1),jh(r,Pr),r.setAttribute("transform",l)):(l=getComputedStyle(r)[Pr],s[Pr]=t,a=c1(r,1),s[Pr]=l);for(u in xc)l=i[u],c=a[u],l!==c&&o.indexOf(u)<0&&(d=So(l),p=So(c),h=d!==p?Xh(r,u,l,p):parseFloat(l),f=parseFloat(c),e._pt=new Cs(e._pt,a,u,h,f-h,QA),e._pt.u=p||0,e._props.push(u));A5(a,i)};Es("padding,margin,Width,Radius",function(n,e){var t="Top",r="Right",i="Bottom",o="Left",s=(e<3?[t,r,i,o]:[t+o,t+r,i+r,i+o]).map(function(a){return e<2?n+a:"border"+a+n});kb[e>1?"border"+n:n]=function(a,u,l,c,h){var f,d;if(arguments.length<4)return f=s.map(function(p){return jl(a,p,l)}),d=f.join(" "),d.split(f[0]).length===5?f[0]:d;f=(c+"").split(" "),d={},s.forEach(function(p,v){return d[p]=f[v]=f[v]||f[(v-1)/2|0]}),a.init(u,d,h)}});var MG={name:"css",register:eI,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,r,i,o){var s=this._props,a=e.style,u=r.vars.startAt,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R,T;Ak||eI(),this.styles=this.styles||xG(e),R=this.styles.props,this.tween=r;for(v in t)if(v!=="autoRound"&&(c=t[v],!($s[v]&&uG(v,t,r,i,e,o)))){if(d=typeof c,p=kb[v],d==="function"&&(c=c.call(r,i,e,o),d=typeof c),d==="string"&&~c.indexOf("random(")&&(c=s1(c)),p)p(this,e,v,c,r)&&(C=1);else if(v.substr(0,2)==="--")l=(getComputedStyle(e).getPropertyValue(v)+"").trim(),c+="",Dh.lastIndex=0,Dh.test(l)||(g=So(l),m=So(c),m?g!==m&&(l=Xh(e,v,l,m)+m):g&&(c+=g)),this.add(a,"setProperty",l,c,i,o,0,0,v),s.push(v),R.push(v,0,a[v]);else if(d!=="undefined"){if(u&&v in u?(l=typeof u[v]=="function"?u[v].call(r,i,e,o):u[v],Hi(l)&&~l.indexOf("random(")&&(l=s1(l)),So(l+"")||l==="auto"||(l+=ua.units[v]||So(jl(e,v))||""),(l+"").charAt(1)==="="&&(l=jl(e,v))):l=jl(e,v),f=parseFloat(l),x=d==="string"&&c.charAt(1)==="="&&c.substr(0,2),x&&(c=c.substr(2)),h=parseFloat(c),v in ol&&(v==="autoAlpha"&&(f===1&&jl(e,"visibility")==="hidden"&&h&&(f=0),R.push("visibility",0,a.visibility),mh(this,a,"visibility",f?"inherit":"hidden",h?"inherit":"hidden",!h)),v!=="scale"&&v!=="transform"&&(v=ol[v],~v.indexOf(",")&&(v=v.split(",")[0]))),_=v in xc,_){if(this.styles.save(v),T=c,d==="string"&&c.substring(0,6)==="var(--"){if(c=na(e,c.substring(4,c.indexOf(")"))),c.substring(0,5)==="calc("){var A=e.style.perspective;e.style.perspective=c,c=na(e,"perspective"),A?e.style.perspective=A:jh(e,"perspective")}h=parseFloat(c)}if(b||(S=e._gsap,S.renderTransform&&!t.parseTransform||c1(e,t.parseTransform),E=t.smoothOrigin!==!1&&S.smooth,b=this._pt=new Cs(this._pt,a,Pr,0,1,S.renderTransform,S,0,-1),b.dep=1),v==="scale")this._pt=new Cs(this._pt,S,"scaleY",S.scaleY,(x?sv(S.scaleY,x+h):h)-S.scaleY||0,QA),this._pt.u=0,s.push("scaleY",v),v+="X";else if(v==="transformOrigin"){R.push(Ms,0,a[Ms]),c=khe(c),S.svg?tI(e,c,0,E,0,this):(m=parseFloat(c.split(" ")[2])||0,m!==S.zOrigin&&mh(this,S,"zOrigin",S.zOrigin,m),mh(this,a,v,Db(l),Db(c)));continue}else if(v==="svgOrigin"){tI(e,c,1,E,0,this);continue}else if(v in SG){Fhe(this,S,v,f,x?sv(f,x+c):c);continue}else if(v==="smoothOrigin"){mh(this,S,"smooth",S.smooth,c);continue}else if(v==="force3D"){S[v]=c;continue}else if(v==="transform"){Ohe(this,c,e);continue}}else v in a||(v=Hv(v)||v);if(_||(h||h===0)&&(f||f===0)&&!ghe.test(c)&&v in a)g=(l+"").substr((f+"").length),h||(h=0),m=So(c)||(v in ua.units?ua.units[v]:g),g!==m&&(f=Xh(e,v,l,m)),this._pt=new Cs(this._pt,_?S:a,v,f,(x?sv(f,x+h):h)-f,!_&&(m==="px"||v==="zIndex")&&t.autoRound!==!1?_he:QA),this._pt.u=m||0,_&&T!==c?(this._pt.b=l,this._pt.e=T,this._pt.r=whe):g!==m&&m!=="%"&&(this._pt.b=l,this._pt.r=xhe);else if(v in a)Phe.call(this,e,v,l,x?x+c:c);else if(v in e)this.add(e,v,l||e[v],x?x+c:c,i,o);else if(v!=="parseTransform"){xk(v,c);continue}_||(v in a?R.push(v,0,a[v]):typeof e[v]=="function"?R.push(v,2,e[v]()):R.push(v,1,l||e[v])),s.push(v)}}C&&pG(this)},render:function(e,t){if(t.tween._time||!Ik())for(var r=t._pt;r;)r.r(e,r.d),r=r._next;else t.styles.revert()},get:jl,aliases:ol,getSetter:function(e,t,r){var i=ol[t];return i&&i.indexOf(",")<0&&(t=i),t in xc&&t!==Ms&&(e._gsap.x||jl(e,"x"))?r&&_5===r?t==="scale"?Che:Ehe:(_5=r||{})&&(t==="scale"?Mhe:The):e.style&&!vk(e.style[t])?bhe:~t.indexOf("-")?She:Tk(e,t)},core:{_removeProperty:jh,_getMatrix:kk}};As.utils.checkPrefix=Hv;As.core.getStyleSaver=xG;(function(n,e,t,r){var i=Es(n+","+e+","+t,function(o){xc[o]=1});Es(e,function(o){ua.units[o]="deg",SG[o]=1}),ol[i[13]]=n+","+e,Es(r,function(o){var s=o.split(":");ol[s[1]]=i[s[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Es("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){ua.units[n]="px"});As.registerPlugin(MG);var en=As.registerPlugin(MG)||As;en.core.Tween;function Bhe(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Uhe(n,e,t){return e&&Bhe(n.prototype,e),n}/*!
 * Observer 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var to,O_,Js,vh,gh,lv,TG,qf,J0,RG,tc,su,AG,IG=function(){return to||typeof window<"u"&&(to=window.gsap)&&to.registerPlugin&&to},PG=1,$m=[],_n=[],pl=[],ey=Date.now,nI=function(e,t){return t},zhe=function(){var e=J0.core,t=e.bridge||{},r=e._scrollers,i=e._proxies;r.push.apply(r,_n),i.push.apply(i,pl),_n=r,pl=i,nI=function(s,a){return t[s](a)}},Nh=function(e,t){return~pl.indexOf(e)&&pl[pl.indexOf(e)+1][t]},ty=function(e){return!!~RG.indexOf(e)},Uo=function(e,t,r,i,o){return e.addEventListener(t,r,{passive:i!==!1,capture:!!o})},Bo=function(e,t,r,i){return e.removeEventListener(t,r,!!i)},Mw="scrollLeft",Tw="scrollTop",rI=function(){return tc&&tc.isPressed||_n.cache++},Nb=function(e,t){var r=function i(o){if(o||o===0){PG&&(Js.history.scrollRestoration="manual");var s=tc&&tc.isPressed;o=i.v=Math.round(o)||(tc&&tc.iOS?1:0),e(o),i.cacheID=_n.cache,s&&nI("ss",o)}else(t||_n.cache!==i.cacheID||nI("ref"))&&(i.cacheID=_n.cache,i.v=e());return i.v+i.offset};return r.offset=0,e&&r},Yo={s:Mw,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:Nb(function(n){return arguments.length?Js.scrollTo(n,_i.sc()):Js.pageXOffset||vh[Mw]||gh[Mw]||lv[Mw]||0})},_i={s:Tw,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Yo,sc:Nb(function(n){return arguments.length?Js.scrollTo(Yo.sc(),n):Js.pageYOffset||vh[Tw]||gh[Tw]||lv[Tw]||0})},us=function(e,t){return(t&&t._ctx&&t._ctx.selector||to.utils.toArray)(e)[0]||(typeof e=="string"&&to.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},Vhe=function(e,t){for(var r=t.length;r--;)if(t[r]===e||t[r].contains(e))return!0;return!1},qh=function(e,t){var r=t.s,i=t.sc;ty(e)&&(e=vh.scrollingElement||gh);var o=_n.indexOf(e),s=i===_i.sc?1:2;!~o&&(o=_n.push(e)-1),_n[o+s]||Uo(e,"scroll",rI);var a=_n[o+s],u=a||(_n[o+s]=Nb(Nh(e,r),!0)||(ty(e)?i:Nb(function(l){return arguments.length?e[r]=l:e[r]})));return u.target=e,a||(u.smooth=to.getProperty(e,"scrollBehavior")==="smooth"),u},iI=function(e,t,r){var i=e,o=e,s=ey(),a=s,u=t||50,l=Math.max(500,u*3),c=function(p,v){var g=ey();v||g-s>u?(o=i,i=p,a=s,s=g):r?i+=p:i=o+(p-o)/(g-a)*(s-a)},h=function(){o=i=r?0:i,a=s=0},f=function(p){var v=a,g=o,m=ey();return(p||p===0)&&p!==i&&c(p),s===a||m-a>l?0:(i+(r?g:-g))/((r?m:s)-v)*1e3};return{update:c,reset:h,getVelocity:f}},a0=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},I5=function(e){var t=Math.max.apply(Math,e),r=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(r)?t:r},kG=function(){J0=to.core.globals().ScrollTrigger,J0&&J0.core&&zhe()},DG=function(e){return to=e||IG(),!O_&&to&&typeof document<"u"&&document.body&&(Js=window,vh=document,gh=vh.documentElement,lv=vh.body,RG=[Js,vh,gh,lv],to.utils.clamp,AG=to.core.context||function(){},qf="onpointerenter"in lv?"pointer":"mouse",TG=ri.isTouch=Js.matchMedia&&Js.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Js||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,su=ri.eventTypes=("ontouchstart"in gh?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in gh?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return PG=0},500),kG(),O_=1),O_};Yo.op=_i;_n.cache=0;var ri=function(){function n(t){this.init(t)}var e=n.prototype;return e.init=function(r){O_||DG(to)||console.warn("Please gsap.registerPlugin(Observer)"),J0||kG();var i=r.tolerance,o=r.dragMinimum,s=r.type,a=r.target,u=r.lineHeight,l=r.debounce,c=r.preventDefault,h=r.onStop,f=r.onStopDelay,d=r.ignore,p=r.wheelSpeed,v=r.event,g=r.onDragStart,m=r.onDragEnd,x=r.onDrag,_=r.onPress,b=r.onRelease,S=r.onRight,E=r.onLeft,C=r.onUp,R=r.onDown,T=r.onChangeX,A=r.onChangeY,P=r.onChange,k=r.onToggleX,W=r.onToggleY,N=r.onHover,O=r.onHoverEnd,z=r.onMove,V=r.ignoreCheck,F=r.isNormalizer,U=r.onGestureStart,L=r.onGestureEnd,j=r.onWheel,Q=r.onEnable,K=r.onDisable,ie=r.onClick,pe=r.scrollSpeed,we=r.capture,ce=r.allowClicks,_e=r.lockAxis,Oe=r.onLockAxis;this.target=a=us(a)||gh,this.vars=r,d&&(d=to.utils.toArray(d)),i=i||1e-9,o=o||0,p=p||1,pe=pe||1,s=s||"wheel,touch,pointer",l=l!==!1,u||(u=parseFloat(Js.getComputedStyle(lv).lineHeight)||22);var Ve,Ne,Z,de,me,Ie,xe,se=this,Xe=0,X=0,$=r.passive||!c&&r.passive!==!1,le=qh(a,Yo),ze=qh(a,_i),Te=le(),J=ze(),be=~s.indexOf("touch")&&!~s.indexOf("pointer")&&su[0]==="pointerdown",ke=ty(a),He=a.ownerDocument||vh,Ue=[0,0,0],We=[0,0,0],Le=0,yt=function(){return Le=ey()},rt=function(ft,Mt){return(se.event=ft)&&d&&Vhe(ft.target,d)||Mt&&be&&ft.pointerType!=="touch"||V&&V(ft,Mt)},dt=function(){se._vx.reset(),se._vy.reset(),Ne.pause(),h&&h(se)},ot=function(){var ft=se.deltaX=I5(Ue),Mt=se.deltaY=I5(We),Ke=Math.abs(ft)>=i,Rt=Math.abs(Mt)>=i;P&&(Ke||Rt)&&P(se,ft,Mt,Ue,We),Ke&&(S&&se.deltaX>0&&S(se),E&&se.deltaX<0&&E(se),T&&T(se),k&&se.deltaX<0!=Xe<0&&k(se),Xe=se.deltaX,Ue[0]=Ue[1]=Ue[2]=0),Rt&&(R&&se.deltaY>0&&R(se),C&&se.deltaY<0&&C(se),A&&A(se),W&&se.deltaY<0!=X<0&&W(se),X=se.deltaY,We[0]=We[1]=We[2]=0),(de||Z)&&(z&&z(se),Z&&(g&&Z===1&&g(se),x&&x(se),Z=0),de=!1),Ie&&!(Ie=!1)&&Oe&&Oe(se),me&&(j(se),me=!1),Ve=0},Je=function(ft,Mt,Ke){Ue[Ke]+=ft,We[Ke]+=Mt,se._vx.update(ft),se._vy.update(Mt),l?Ve||(Ve=requestAnimationFrame(ot)):ot()},Wt=function(ft,Mt){_e&&!xe&&(se.axis=xe=Math.abs(ft)>Math.abs(Mt)?"x":"y",Ie=!0),xe!=="y"&&(Ue[2]+=ft,se._vx.update(ft,!0)),xe!=="x"&&(We[2]+=Mt,se._vy.update(Mt,!0)),l?Ve||(Ve=requestAnimationFrame(ot)):ot()},jt=function(ft){if(!rt(ft,1)){ft=a0(ft,c);var Mt=ft.clientX,Ke=ft.clientY,Rt=Mt-se.x,It=Ke-se.y,Gt=se.isDragging;se.x=Mt,se.y=Ke,(Gt||(Rt||It)&&(Math.abs(se.startX-Mt)>=o||Math.abs(se.startY-Ke)>=o))&&(Z||(Z=Gt?2:1),Gt||(se.isDragging=!0),Wt(Rt,It))}},yn=se.onPress=function(mt){rt(mt,1)||mt&&mt.button||(se.axis=xe=null,Ne.pause(),se.isPressed=!0,mt=a0(mt),Xe=X=0,se.startX=se.x=mt.clientX,se.startY=se.y=mt.clientY,se._vx.reset(),se._vy.reset(),Uo(F?a:He,su[1],jt,$,!0),se.deltaX=se.deltaY=0,_&&_(se))},nt=se.onRelease=function(mt){if(!rt(mt,1)){Bo(F?a:He,su[1],jt,!0);var ft=!isNaN(se.y-se.startY),Mt=se.isDragging,Ke=Mt&&(Math.abs(se.x-se.startX)>3||Math.abs(se.y-se.startY)>3),Rt=a0(mt);!Ke&&ft&&(se._vx.reset(),se._vy.reset(),c&&ce&&to.delayedCall(.08,function(){if(ey()-Le>300&&!mt.defaultPrevented){if(mt.target.click)mt.target.click();else if(He.createEvent){var It=He.createEvent("MouseEvents");It.initMouseEvent("click",!0,!0,Js,1,Rt.screenX,Rt.screenY,Rt.clientX,Rt.clientY,!1,!1,!1,!1,0,null),mt.target.dispatchEvent(It)}}})),se.isDragging=se.isGesturing=se.isPressed=!1,h&&Mt&&!F&&Ne.restart(!0),Z&&ot(),m&&Mt&&m(se),b&&b(se,Ke)}},Ye=function(ft){return ft.touches&&ft.touches.length>1&&(se.isGesturing=!0)&&U(ft,se.isDragging)},ae=function(){return(se.isGesturing=!1)||L(se)},Ze=function(ft){if(!rt(ft)){var Mt=le(),Ke=ze();Je((Mt-Te)*pe,(Ke-J)*pe,1),Te=Mt,J=Ke,h&&Ne.restart(!0)}},et=function(ft){if(!rt(ft)){ft=a0(ft,c),j&&(me=!0);var Mt=(ft.deltaMode===1?u:ft.deltaMode===2?Js.innerHeight:1)*p;Je(ft.deltaX*Mt,ft.deltaY*Mt,0),h&&!F&&Ne.restart(!0)}},Nt=function(ft){if(!rt(ft)){var Mt=ft.clientX,Ke=ft.clientY,Rt=Mt-se.x,It=Ke-se.y;se.x=Mt,se.y=Ke,de=!0,h&&Ne.restart(!0),(Rt||It)&&Wt(Rt,It)}},Tt=function(ft){se.event=ft,N(se)},hn=function(ft){se.event=ft,O(se)},Sn=function(ft){return rt(ft)||a0(ft,c)&&ie(se)};Ne=se._dc=to.delayedCall(f||.25,dt).pause(),se.deltaX=se.deltaY=0,se._vx=iI(0,50,!0),se._vy=iI(0,50,!0),se.scrollX=le,se.scrollY=ze,se.isDragging=se.isGesturing=se.isPressed=!1,AG(this),se.enable=function(mt){return se.isEnabled||(Uo(ke?He:a,"scroll",rI),s.indexOf("scroll")>=0&&Uo(ke?He:a,"scroll",Ze,$,we),s.indexOf("wheel")>=0&&Uo(a,"wheel",et,$,we),(s.indexOf("touch")>=0&&TG||s.indexOf("pointer")>=0)&&(Uo(a,su[0],yn,$,we),Uo(He,su[2],nt),Uo(He,su[3],nt),ce&&Uo(a,"click",yt,!0,!0),ie&&Uo(a,"click",Sn),U&&Uo(He,"gesturestart",Ye),L&&Uo(He,"gestureend",ae),N&&Uo(a,qf+"enter",Tt),O&&Uo(a,qf+"leave",hn),z&&Uo(a,qf+"move",Nt)),se.isEnabled=!0,se.isDragging=se.isGesturing=se.isPressed=de=Z=!1,se._vx.reset(),se._vy.reset(),Te=le(),J=ze(),mt&&mt.type&&yn(mt),Q&&Q(se)),se},se.disable=function(){se.isEnabled&&($m.filter(function(mt){return mt!==se&&ty(mt.target)}).length||Bo(ke?He:a,"scroll",rI),se.isPressed&&(se._vx.reset(),se._vy.reset(),Bo(F?a:He,su[1],jt,!0)),Bo(ke?He:a,"scroll",Ze,we),Bo(a,"wheel",et,we),Bo(a,su[0],yn,we),Bo(He,su[2],nt),Bo(He,su[3],nt),Bo(a,"click",yt,!0),Bo(a,"click",Sn),Bo(He,"gesturestart",Ye),Bo(He,"gestureend",ae),Bo(a,qf+"enter",Tt),Bo(a,qf+"leave",hn),Bo(a,qf+"move",Nt),se.isEnabled=se.isPressed=se.isDragging=!1,K&&K(se))},se.kill=se.revert=function(){se.disable();var mt=$m.indexOf(se);mt>=0&&$m.splice(mt,1),tc===se&&(tc=0)},$m.push(se),F&&ty(a)&&(tc=se),se.enable(v)},Uhe(n,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),n}();ri.version="3.14.2";ri.create=function(n){return new ri(n)};ri.register=DG;ri.getAll=function(){return $m.slice()};ri.getById=function(n){return $m.filter(function(e){return e.vars.id===n})[0]};IG()&&to.registerPlugin(ri);/*!
 * ScrollTrigger 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var bt,fm,wn,lr,qs,Kn,Dk,Lb,h1,ny,A0,Rw,yo,RE,oI,Ho,P5,k5,dm,NG,TM,LG,Vo,sI,FG,OG,eh,aI,Nk,cv,Lk,ry,uI,RM,Aw=1,xo=Date.now,AM=xo(),Va=0,I0=0,D5=function(e,t,r){var i=Gs(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return r["_"+t+"Clamp"]=i,i?e.substr(6,e.length-7):e},N5=function(e,t){return t&&(!Gs(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},Whe=function n(){return I0&&requestAnimationFrame(n)},L5=function(){return RE=1},F5=function(){return RE=0},Ku=function(e){return e},P0=function(e){return Math.round(e*1e5)/1e5||0},BG=function(){return typeof window<"u"},UG=function(){return bt||BG()&&(bt=window.gsap)&&bt.registerPlugin&&bt},Xd=function(e){return!!~Dk.indexOf(e)},zG=function(e){return(e==="Height"?Lk:wn["inner"+e])||qs["client"+e]||Kn["client"+e]},VG=function(e){return Nh(e,"getBoundingClientRect")||(Xd(e)?function(){return W_.width=wn.innerWidth,W_.height=Lk,W_}:function(){return Yl(e)})},Hhe=function(e,t,r){var i=r.d,o=r.d2,s=r.a;return(s=Nh(e,"getBoundingClientRect"))?function(){return s()[i]}:function(){return(t?zG(o):e["client"+o])||0}},Ghe=function(e,t){return!t||~pl.indexOf(e)?VG(e):function(){return W_}},sl=function(e,t){var r=t.s,i=t.d2,o=t.d,s=t.a;return Math.max(0,(r="scroll"+i)&&(s=Nh(e,r))?s()-VG(e)()[o]:Xd(e)?(qs[r]||Kn[r])-zG(i):e[r]-e["offset"+i])},Iw=function(e,t){for(var r=0;r<dm.length;r+=3)(!t||~t.indexOf(dm[r+1]))&&e(dm[r],dm[r+1],dm[r+2])},Gs=function(e){return typeof e=="string"},Eo=function(e){return typeof e=="function"},k0=function(e){return typeof e=="number"},Yf=function(e){return typeof e=="object"},u0=function(e,t,r){return e&&e.progress(t?0:1)&&r&&e.pause()},IM=function(e,t){if(e.enabled){var r=e._ctx?e._ctx.add(function(){return t(e)}):t(e);r&&r.totalTime&&(e.callbackAnimation=r)}},em=Math.abs,WG="left",HG="top",Fk="right",Ok="bottom",Id="width",Pd="height",iy="Right",oy="Left",sy="Top",ay="Bottom",li="padding",Pa="margin",Gv="Width",Bk="Height",gi="px",ka=function(e){return wn.getComputedStyle(e)},$he=function(e){var t=ka(e).position;e.style.position=t==="absolute"||t==="fixed"?t:"relative"},O5=function(e,t){for(var r in t)r in e||(e[r]=t[r]);return e},Yl=function(e,t){var r=t&&ka(e)[oI]!=="matrix(1, 0, 0, 1, 0, 0)"&&bt.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return r&&r.progress(0).kill(),i},Fb=function(e,t){var r=t.d2;return e["offset"+r]||e["client"+r]||0},GG=function(e){var t=[],r=e.labels,i=e.duration(),o;for(o in r)t.push(r[o]/i);return t},jhe=function(e){return function(t){return bt.utils.snap(GG(e),t)}},Uk=function(e){var t=bt.utils.snap(e),r=Array.isArray(e)&&e.slice(0).sort(function(i,o){return i-o});return r?function(i,o,s){s===void 0&&(s=.001);var a;if(!o)return t(i);if(o>0){for(i-=s,a=0;a<r.length;a++)if(r[a]>=i)return r[a];return r[a-1]}else for(a=r.length,i+=s;a--;)if(r[a]<=i)return r[a];return r[0]}:function(i,o,s){s===void 0&&(s=.001);var a=t(i);return!o||Math.abs(a-i)<s||a-i<0==o<0?a:t(o<0?i-e:i+e)}},Xhe=function(e){return function(t,r){return Uk(GG(e))(t,r.direction)}},Pw=function(e,t,r,i){return r.split(",").forEach(function(o){return e(t,o,i)})},Bi=function(e,t,r,i,o){return e.addEventListener(t,r,{passive:!i,capture:!!o})},Oi=function(e,t,r,i){return e.removeEventListener(t,r,!!i)},kw=function(e,t,r){r=r&&r.wheelHandler,r&&(e(t,"wheel",r),e(t,"touchmove",r))},B5={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Dw={toggleActions:"play",anticipatePin:0},Ob={top:0,left:0,center:.5,bottom:1,right:1},B_=function(e,t){if(Gs(e)){var r=e.indexOf("="),i=~r?+(e.charAt(r-1)+1)*parseFloat(e.substr(r+1)):0;~r&&(e.indexOf("%")>r&&(i*=t/100),e=e.substr(0,r-1)),e=i+(e in Ob?Ob[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Nw=function(e,t,r,i,o,s,a,u){var l=o.startColor,c=o.endColor,h=o.fontSize,f=o.indent,d=o.fontWeight,p=lr.createElement("div"),v=Xd(r)||Nh(r,"pinType")==="fixed",g=e.indexOf("scroller")!==-1,m=v?Kn:r,x=e.indexOf("start")!==-1,_=x?l:c,b="border-color:"+_+";font-size:"+h+";color:"+_+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return b+="position:"+((g||u)&&v?"fixed;":"absolute;"),(g||u||!v)&&(b+=(i===_i?Fk:Ok)+":"+(s+parseFloat(f))+"px;"),a&&(b+="box-sizing:border-box;text-align:left;width:"+a.offsetWidth+"px;"),p._isStart=x,p.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),p.style.cssText=b,p.innerText=t||t===0?e+"-"+t:e,m.children[0]?m.insertBefore(p,m.children[0]):m.appendChild(p),p._offset=p["offset"+i.op.d2],U_(p,0,i,x),p},U_=function(e,t,r,i){var o={display:"block"},s=r[i?"os2":"p2"],a=r[i?"p2":"os2"];e._isFlipped=i,o[r.a+"Percent"]=i?-100:0,o[r.a]=i?"1px":0,o["border"+s+Gv]=1,o["border"+a+Gv]=0,o[r.p]=t+"px",bt.set(e,o)},gn=[],lI={},f1,U5=function(){return xo()-Va>34&&(f1||(f1=requestAnimationFrame(uc)))},tm=function(){(!Vo||!Vo.isPressed||Vo.startX>Kn.clientWidth)&&(_n.cache++,Vo?f1||(f1=requestAnimationFrame(uc)):uc(),Va||Yd("scrollStart"),Va=xo())},PM=function(){OG=wn.innerWidth,FG=wn.innerHeight},D0=function(e){_n.cache++,(e===!0||!yo&&!LG&&!lr.fullscreenElement&&!lr.webkitFullscreenElement&&(!sI||OG!==wn.innerWidth||Math.abs(wn.innerHeight-FG)>wn.innerHeight*.25))&&Lb.restart(!0)},qd={},qhe=[],$G=function n(){return Oi(bn,"scrollEnd",n)||dd(!0)},Yd=function(e){return qd[e]&&qd[e].map(function(t){return t()})||qhe},Ws=[],jG=function(e){for(var t=0;t<Ws.length;t+=5)(!e||Ws[t+4]&&Ws[t+4].query===e)&&(Ws[t].style.cssText=Ws[t+1],Ws[t].getBBox&&Ws[t].setAttribute("transform",Ws[t+2]||""),Ws[t+3].uncache=1)},XG=function(){return _n.forEach(function(e){return Eo(e)&&++e.cacheID&&(e.rec=e())})},zk=function(e,t){var r;for(Ho=0;Ho<gn.length;Ho++)r=gn[Ho],r&&(!t||r._ctx===t)&&(e?r.kill(1):r.revert(!0,!0));ry=!0,t&&jG(t),t||Yd("revert")},qG=function(e,t){_n.cache++,(t||!Go)&&_n.forEach(function(r){return Eo(r)&&r.cacheID++&&(r.rec=0)}),Gs(e)&&(wn.history.scrollRestoration=Nk=e)},Go,kd=0,z5,Yhe=function(){if(z5!==kd){var e=z5=kd;requestAnimationFrame(function(){return e===kd&&dd(!0)})}},YG=function(){Kn.appendChild(cv),Lk=!Vo&&cv.offsetHeight||wn.innerHeight,Kn.removeChild(cv)},V5=function(e){return h1(".gsap-marker-start, .gsap-marker-end, .gsap-marker-scroller-start, .gsap-marker-scroller-end").forEach(function(t){return t.style.display=e?"none":"block"})},dd=function(e,t){if(qs=lr.documentElement,Kn=lr.body,Dk=[wn,lr,qs,Kn],Va&&!e&&!ry){Bi(bn,"scrollEnd",$G);return}YG(),Go=bn.isRefreshing=!0,ry||XG();var r=Yd("refreshInit");NG&&bn.sort(),t||zk(),_n.forEach(function(i){Eo(i)&&(i.smooth&&(i.target.style.scrollBehavior="auto"),i(0))}),gn.slice(0).forEach(function(i){return i.refresh()}),ry=!1,gn.forEach(function(i){if(i._subPinOffset&&i.pin){var o=i.vars.horizontal?"offsetWidth":"offsetHeight",s=i.pin[o];i.revert(!0,1),i.adjustPinSpacing(i.pin[o]-s),i.refresh()}}),uI=1,V5(!0),gn.forEach(function(i){var o=sl(i.scroller,i._dir),s=i.vars.end==="max"||i._endClamp&&i.end>o,a=i._startClamp&&i.start>=o;(s||a)&&i.setPositions(a?o-1:i.start,s?Math.max(a?o:i.start+1,o):i.end,!0)}),V5(!1),uI=0,r.forEach(function(i){return i&&i.render&&i.render(-1)}),_n.forEach(function(i){Eo(i)&&(i.smooth&&requestAnimationFrame(function(){return i.target.style.scrollBehavior="smooth"}),i.rec&&i(i.rec))}),qG(Nk,1),Lb.pause(),kd++,Go=2,uc(2),gn.forEach(function(i){return Eo(i.vars.onRefresh)&&i.vars.onRefresh(i)}),Go=bn.isRefreshing=!1,Yd("refresh")},cI=0,z_=1,uy,uc=function(e){if(e===2||!Go&&!ry){bn.isUpdating=!0,uy&&uy.update(0);var t=gn.length,r=xo(),i=r-AM>=50,o=t&&gn[0].scroll();if(z_=cI>o?-1:1,Go||(cI=o),i&&(Va&&!RE&&r-Va>200&&(Va=0,Yd("scrollEnd")),A0=AM,AM=r),z_<0){for(Ho=t;Ho-- >0;)gn[Ho]&&gn[Ho].update(0,i);z_=1}else for(Ho=0;Ho<t;Ho++)gn[Ho]&&gn[Ho].update(0,i);bn.isUpdating=!1}f1=0},hI=[WG,HG,Ok,Fk,Pa+ay,Pa+iy,Pa+sy,Pa+oy,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],V_=hI.concat([Id,Pd,"boxSizing","max"+Gv,"max"+Bk,"position",Pa,li,li+sy,li+iy,li+ay,li+oy]),Khe=function(e,t,r){hv(r);var i=e._gsap;if(i.spacerIsNative)hv(i.spacerState);else if(e._gsap.swappedIn){var o=t.parentNode;o&&(o.insertBefore(e,t),o.removeChild(t))}e._gsap.swappedIn=!1},kM=function(e,t,r,i){if(!e._gsap.swappedIn){for(var o=hI.length,s=t.style,a=e.style,u;o--;)u=hI[o],s[u]=r[u];s.position=r.position==="absolute"?"absolute":"relative",r.display==="inline"&&(s.display="inline-block"),a[Ok]=a[Fk]="auto",s.flexBasis=r.flexBasis||"auto",s.overflow="visible",s.boxSizing="border-box",s[Id]=Fb(e,Yo)+gi,s[Pd]=Fb(e,_i)+gi,s[li]=a[Pa]=a[HG]=a[WG]="0",hv(i),a[Id]=a["max"+Gv]=r[Id],a[Pd]=a["max"+Bk]=r[Pd],a[li]=r[li],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},Zhe=/([A-Z])/g,hv=function(e){if(e){var t=e.t.style,r=e.length,i=0,o,s;for((e.t._gsap||bt.core.getCache(e.t)).uncache=1;i<r;i+=2)s=e[i+1],o=e[i],s?t[o]=s:t[o]&&t.removeProperty(o.replace(Zhe,"-$1").toLowerCase())}},Lw=function(e){for(var t=V_.length,r=e.style,i=[],o=0;o<t;o++)i.push(V_[o],r[V_[o]]);return i.t=e,i},Qhe=function(e,t,r){for(var i=[],o=e.length,s=r?8:0,a;s<o;s+=2)a=e[s],i.push(a,a in t?t[a]:e[s+1]);return i.t=e.t,i},W_={left:0,top:0},W5=function(e,t,r,i,o,s,a,u,l,c,h,f,d,p){Eo(e)&&(e=e(u)),Gs(e)&&e.substr(0,3)==="max"&&(e=f+(e.charAt(4)==="="?B_("0"+e.substr(3),r):0));var v=d?d.time():0,g,m,x;if(d&&d.seek(0),isNaN(e)||(e=+e),k0(e))d&&(e=bt.utils.mapRange(d.scrollTrigger.start,d.scrollTrigger.end,0,f,e)),a&&U_(a,r,i,!0);else{Eo(t)&&(t=t(u));var _=(e||"0").split(" "),b,S,E,C;x=us(t,u)||Kn,b=Yl(x)||{},(!b||!b.left&&!b.top)&&ka(x).display==="none"&&(C=x.style.display,x.style.display="block",b=Yl(x),C?x.style.display=C:x.style.removeProperty("display")),S=B_(_[0],b[i.d]),E=B_(_[1]||"0",r),e=b[i.p]-l[i.p]-c+S+o-E,a&&U_(a,E,i,r-E<20||a._isStart&&E>20),r-=r-E}if(p&&(u[p]=e||-.001,e<0&&(e=0)),s){var R=e+r,T=s._isStart;g="scroll"+i.d2,U_(s,R,i,T&&R>20||!T&&(h?Math.max(Kn[g],qs[g]):s.parentNode[g])<=R+1),h&&(l=Yl(a),h&&(s.style[i.op.p]=l[i.op.p]-i.op.m-s._offset+gi))}return d&&x&&(g=Yl(x),d.seek(f),m=Yl(x),d._caScrollDist=g[i.p]-m[i.p],e=e/d._caScrollDist*f),d&&d.seek(v),d?e:Math.round(e)},Jhe=/(webkit|moz|length|cssText|inset)/i,H5=function(e,t,r,i){if(e.parentNode!==t){var o=e.style,s,a;if(t===Kn){e._stOrig=o.cssText,a=ka(e);for(s in a)!+s&&!Jhe.test(s)&&a[s]&&typeof o[s]=="string"&&s!=="0"&&(o[s]=a[s]);o.top=r,o.left=i}else o.cssText=e._stOrig;bt.core.getCache(e).uncache=1,t.appendChild(e)}},KG=function(e,t,r){var i=t,o=i;return function(s){var a=Math.round(e());return a!==i&&a!==o&&Math.abs(a-i)>3&&Math.abs(a-o)>3&&(s=a,r&&r()),o=i,i=Math.round(s),i}},Fw=function(e,t,r){var i={};i[t.p]="+="+r,bt.set(e,i)},G5=function(e,t){var r=qh(e,t),i="_scroll"+t.p2,o=function s(a,u,l,c,h){var f=s.tween,d=u.onComplete,p={};l=l||r();var v=KG(r,l,function(){f.kill(),s.tween=0});return h=c&&h||0,c=c||a-l,f&&f.kill(),u[i]=a,u.inherit=!1,u.modifiers=p,p[i]=function(){return v(l+c*f.ratio+h*f.ratio*f.ratio)},u.onUpdate=function(){_n.cache++,s.tween&&uc()},u.onComplete=function(){s.tween=0,d&&d.call(f)},f=s.tween=bt.to(e,u),f};return e[i]=r,r.wheelHandler=function(){return o.tween&&o.tween.kill()&&(o.tween=0)},Bi(e,"wheel",r.wheelHandler),bn.isTouch&&Bi(e,"touchmove",r.wheelHandler),o},bn=function(){function n(t,r){fm||n.register(bt)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),aI(this),this.init(t,r)}var e=n.prototype;return e.init=function(r,i){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!I0){this.update=this.refresh=this.kill=Ku;return}r=O5(Gs(r)||k0(r)||r.nodeType?{trigger:r}:r,Dw);var o=r,s=o.onUpdate,a=o.toggleClass,u=o.id,l=o.onToggle,c=o.onRefresh,h=o.scrub,f=o.trigger,d=o.pin,p=o.pinSpacing,v=o.invalidateOnRefresh,g=o.anticipatePin,m=o.onScrubComplete,x=o.onSnapComplete,_=o.once,b=o.snap,S=o.pinReparent,E=o.pinSpacer,C=o.containerAnimation,R=o.fastScrollEnd,T=o.preventOverlaps,A=r.horizontal||r.containerAnimation&&r.horizontal!==!1?Yo:_i,P=!h&&h!==0,k=us(r.scroller||wn),W=bt.core.getCache(k),N=Xd(k),O=("pinType"in r?r.pinType:Nh(k,"pinType")||N&&"fixed")==="fixed",z=[r.onEnter,r.onLeave,r.onEnterBack,r.onLeaveBack],V=P&&r.toggleActions.split(" "),F="markers"in r?r.markers:Dw.markers,U=N?0:parseFloat(ka(k)["border"+A.p2+Gv])||0,L=this,j=r.onRefreshInit&&function(){return r.onRefreshInit(L)},Q=Hhe(k,N,A),K=Ghe(k,N),ie=0,pe=0,we=0,ce=qh(k,A),_e,Oe,Ve,Ne,Z,de,me,Ie,xe,se,Xe,X,$,le,ze,Te,J,be,ke,He,Ue,We,Le,yt,rt,dt,ot,Je,Wt,jt,yn,nt,Ye,ae,Ze,et,Nt,Tt,hn;if(L._startClamp=L._endClamp=!1,L._dir=A,g*=45,L.scroller=k,L.scroll=C?C.time.bind(C):ce,Ne=ce(),L.vars=r,i=i||r.animation,"refreshPriority"in r&&(NG=1,r.refreshPriority===-9999&&(uy=L)),W.tweenScroll=W.tweenScroll||{top:G5(k,_i),left:G5(k,Yo)},L.tweenTo=_e=W.tweenScroll[A.p],L.scrubDuration=function(Ke){Ye=k0(Ke)&&Ke,Ye?nt?nt.duration(Ke):nt=bt.to(i,{ease:"expo",totalProgress:"+=0",inherit:!1,duration:Ye,paused:!0,onComplete:function(){return m&&m(L)}}):(nt&&nt.progress(1).kill(),nt=0)},i&&(i.vars.lazy=!1,i._initted&&!L.isReverted||i.vars.immediateRender!==!1&&r.immediateRender!==!1&&i.duration()&&i.render(0,!0,!0),L.animation=i.pause(),i.scrollTrigger=L,L.scrubDuration(h),jt=0,u||(u=i.vars.id)),b&&((!Yf(b)||b.push)&&(b={snapTo:b}),"scrollBehavior"in Kn.style&&bt.set(N?[Kn,qs]:k,{scrollBehavior:"auto"}),_n.forEach(function(Ke){return Eo(Ke)&&Ke.target===(N?lr.scrollingElement||qs:k)&&(Ke.smooth=!1)}),Ve=Eo(b.snapTo)?b.snapTo:b.snapTo==="labels"?jhe(i):b.snapTo==="labelsDirectional"?Xhe(i):b.directional!==!1?function(Ke,Rt){return Uk(b.snapTo)(Ke,xo()-pe<500?0:Rt.direction)}:bt.utils.snap(b.snapTo),ae=b.duration||{min:.1,max:2},ae=Yf(ae)?ny(ae.min,ae.max):ny(ae,ae),Ze=bt.delayedCall(b.delay||Ye/2||.1,function(){var Ke=ce(),Rt=xo()-pe<500,It=_e.tween;if((Rt||Math.abs(L.getVelocity())<10)&&!It&&!RE&&ie!==Ke){var Gt=(Ke-de)/le,tr=i&&!P?i.totalProgress():Gt,qt=Rt?0:(tr-yn)/(xo()-A0)*1e3||0,qn=bt.utils.clamp(-Gt,1-Gt,em(qt/2)*qt/.185),Sr=Gt+(b.inertia===!1?0:qn),Qn,Yn,Nn=b,mi=Nn.onStart,q=Nn.onInterrupt,ge=Nn.onComplete;if(Qn=Ve(Sr,L),k0(Qn)||(Qn=Sr),Yn=Math.max(0,Math.round(de+Qn*le)),Ke<=me&&Ke>=de&&Yn!==Ke){if(It&&!It._initted&&It.data<=em(Yn-Ke))return;b.inertia===!1&&(qn=Qn-Gt),_e(Yn,{duration:ae(em(Math.max(em(Sr-tr),em(Qn-tr))*.185/qt/.05||0)),ease:b.ease||"power3",data:em(Yn-Ke),onInterrupt:function(){return Ze.restart(!0)&&q&&q(L)},onComplete:function(){L.update(),ie=ce(),i&&!P&&(nt?nt.resetTo("totalProgress",Qn,i._tTime/i._tDur):i.progress(Qn)),jt=yn=i&&!P?i.totalProgress():L.progress,x&&x(L),ge&&ge(L)}},Ke,qn*le,Yn-Ke-qn*le),mi&&mi(L,_e.tween)}}else L.isActive&&ie!==Ke&&Ze.restart(!0)}).pause()),u&&(lI[u]=L),f=L.trigger=us(f||d!==!0&&d),hn=f&&f._gsap&&f._gsap.stRevert,hn&&(hn=hn(L)),d=d===!0?f:us(d),Gs(a)&&(a={targets:f,className:a}),d&&(p===!1||p===Pa||(p=!p&&d.parentNode&&d.parentNode.style&&ka(d.parentNode).display==="flex"?!1:li),L.pin=d,Oe=bt.core.getCache(d),Oe.spacer?ze=Oe.pinState:(E&&(E=us(E),E&&!E.nodeType&&(E=E.current||E.nativeElement),Oe.spacerIsNative=!!E,E&&(Oe.spacerState=Lw(E))),Oe.spacer=be=E||lr.createElement("div"),be.classList.add("pin-spacer"),u&&be.classList.add("pin-spacer-"+u),Oe.pinState=ze=Lw(d)),r.force3D!==!1&&bt.set(d,{force3D:!0}),L.spacer=be=Oe.spacer,Wt=ka(d),yt=Wt[p+A.os2],He=bt.getProperty(d),Ue=bt.quickSetter(d,A.a,gi),kM(d,be,Wt),J=Lw(d)),F){X=Yf(F)?O5(F,B5):B5,se=Nw("scroller-start",u,k,A,X,0),Xe=Nw("scroller-end",u,k,A,X,0,se),ke=se["offset"+A.op.d2];var Sn=us(Nh(k,"content")||k);Ie=this.markerStart=Nw("start",u,Sn,A,X,ke,0,C),xe=this.markerEnd=Nw("end",u,Sn,A,X,ke,0,C),C&&(Tt=bt.quickSetter([Ie,xe],A.a,gi)),!O&&!(pl.length&&Nh(k,"fixedMarkers")===!0)&&($he(N?Kn:k),bt.set([se,Xe],{force3D:!0}),dt=bt.quickSetter(se,A.a,gi),Je=bt.quickSetter(Xe,A.a,gi))}if(C){var mt=C.vars.onUpdate,ft=C.vars.onUpdateParams;C.eventCallback("onUpdate",function(){L.update(0,0,1),mt&&mt.apply(C,ft||[])})}if(L.previous=function(){return gn[gn.indexOf(L)-1]},L.next=function(){return gn[gn.indexOf(L)+1]},L.revert=function(Ke,Rt){if(!Rt)return L.kill(!0);var It=Ke!==!1||!L.enabled,Gt=yo;It!==L.isReverted&&(It&&(et=Math.max(ce(),L.scroll.rec||0),we=L.progress,Nt=i&&i.progress()),Ie&&[Ie,xe,se,Xe].forEach(function(tr){return tr.style.display=It?"none":"block"}),It&&(yo=L,L.update(It)),d&&(!S||!L.isActive)&&(It?Khe(d,be,ze):kM(d,be,ka(d),rt)),It||L.update(It),yo=Gt,L.isReverted=It)},L.refresh=function(Ke,Rt,It,Gt){if(!((yo||!L.enabled)&&!Rt)){if(d&&Ke&&Va){Bi(n,"scrollEnd",$G);return}!Go&&j&&j(L),yo=L,_e.tween&&!It&&(_e.tween.kill(),_e.tween=0),nt&&nt.pause(),v&&i&&(i.revert({kill:!1}).invalidate(),i.getChildren?i.getChildren(!0,!0,!1).forEach(function(ut){return ut.vars.immediateRender&&ut.render(0,!0,!0)}):i.vars.immediateRender&&i.render(0,!0,!0)),L.isReverted||L.revert(!0,!0),L._subPinOffset=!1;var tr=Q(),qt=K(),qn=C?C.duration():sl(k,A),Sr=le<=.01||!le,Qn=0,Yn=Gt||0,Nn=Yf(It)?It.end:r.end,mi=r.endTrigger||f,q=Yf(It)?It.start:r.start||(r.start===0||!f?0:d?"0 0":"0 100%"),ge=L.pinnedContainer=r.pinnedContainer&&us(r.pinnedContainer,L),Re=f&&Math.max(0,gn.indexOf(L))||0,Me=Re,Ee,it,xt,Ht,vt,wt,Ut,Yt,ar,Er,Mn,xr,$t;for(F&&Yf(It)&&(xr=bt.getProperty(se,A.p),$t=bt.getProperty(Xe,A.p));Me-- >0;)wt=gn[Me],wt.end||wt.refresh(0,1)||(yo=L),Ut=wt.pin,Ut&&(Ut===f||Ut===d||Ut===ge)&&!wt.isReverted&&(Er||(Er=[]),Er.unshift(wt),wt.revert(!0,!0)),wt!==gn[Me]&&(Re--,Me--);for(Eo(q)&&(q=q(L)),q=D5(q,"start",L),de=W5(q,f,tr,A,ce(),Ie,se,L,qt,U,O,qn,C,L._startClamp&&"_startClamp")||(d?-.001:0),Eo(Nn)&&(Nn=Nn(L)),Gs(Nn)&&!Nn.indexOf("+=")&&(~Nn.indexOf(" ")?Nn=(Gs(q)?q.split(" ")[0]:"")+Nn:(Qn=B_(Nn.substr(2),tr),Nn=Gs(q)?q:(C?bt.utils.mapRange(0,C.duration(),C.scrollTrigger.start,C.scrollTrigger.end,de):de)+Qn,mi=f)),Nn=D5(Nn,"end",L),me=Math.max(de,W5(Nn||(mi?"100% 0":qn),mi,tr,A,ce()+Qn,xe,Xe,L,qt,U,O,qn,C,L._endClamp&&"_endClamp"))||-.001,Qn=0,Me=Re;Me--;)wt=gn[Me]||{},Ut=wt.pin,Ut&&wt.start-wt._pinPush<=de&&!C&&wt.end>0&&(Ee=wt.end-(L._startClamp?Math.max(0,wt.start):wt.start),(Ut===f&&wt.start-wt._pinPush<de||Ut===ge)&&isNaN(q)&&(Qn+=Ee*(1-wt.progress)),Ut===d&&(Yn+=Ee));if(de+=Qn,me+=Qn,L._startClamp&&(L._startClamp+=Qn),L._endClamp&&!Go&&(L._endClamp=me||-.001,me=Math.min(me,sl(k,A))),le=me-de||(de-=.01)&&.001,Sr&&(we=bt.utils.clamp(0,1,bt.utils.normalize(de,me,et))),L._pinPush=Yn,Ie&&Qn&&(Ee={},Ee[A.a]="+="+Qn,ge&&(Ee[A.p]="-="+ce()),bt.set([Ie,xe],Ee)),d&&!(uI&&L.end>=sl(k,A)))Ee=ka(d),Ht=A===_i,xt=ce(),We=parseFloat(He(A.a))+Yn,!qn&&me>1&&(Mn=(N?lr.scrollingElement||qs:k).style,Mn={style:Mn,value:Mn["overflow"+A.a.toUpperCase()]},N&&ka(Kn)["overflow"+A.a.toUpperCase()]!=="scroll"&&(Mn.style["overflow"+A.a.toUpperCase()]="scroll")),kM(d,be,Ee),J=Lw(d),it=Yl(d,!0),Yt=O&&qh(k,Ht?Yo:_i)(),p?(rt=[p+A.os2,le+Yn+gi],rt.t=be,Me=p===li?Fb(d,A)+le+Yn:0,Me&&(rt.push(A.d,Me+gi),be.style.flexBasis!=="auto"&&(be.style.flexBasis=Me+gi)),hv(rt),ge&&gn.forEach(function(ut){ut.pin===ge&&ut.vars.pinSpacing!==!1&&(ut._subPinOffset=!0)}),O&&ce(et)):(Me=Fb(d,A),Me&&be.style.flexBasis!=="auto"&&(be.style.flexBasis=Me+gi)),O&&(vt={top:it.top+(Ht?xt-de:Yt)+gi,left:it.left+(Ht?Yt:xt-de)+gi,boxSizing:"border-box",position:"fixed"},vt[Id]=vt["max"+Gv]=Math.ceil(it.width)+gi,vt[Pd]=vt["max"+Bk]=Math.ceil(it.height)+gi,vt[Pa]=vt[Pa+sy]=vt[Pa+iy]=vt[Pa+ay]=vt[Pa+oy]="0",vt[li]=Ee[li],vt[li+sy]=Ee[li+sy],vt[li+iy]=Ee[li+iy],vt[li+ay]=Ee[li+ay],vt[li+oy]=Ee[li+oy],Te=Qhe(ze,vt,S),Go&&ce(0)),i?(ar=i._initted,TM(1),i.render(i.duration(),!0,!0),Le=He(A.a)-We+le+Yn,ot=Math.abs(le-Le)>1,O&&ot&&Te.splice(Te.length-2,2),i.render(0,!0,!0),ar||i.invalidate(!0),i.parent||i.totalTime(i.totalTime()),TM(0)):Le=le,Mn&&(Mn.value?Mn.style["overflow"+A.a.toUpperCase()]=Mn.value:Mn.style.removeProperty("overflow-"+A.a));else if(f&&ce()&&!C)for(it=f.parentNode;it&&it!==Kn;)it._pinOffset&&(de-=it._pinOffset,me-=it._pinOffset),it=it.parentNode;Er&&Er.forEach(function(ut){return ut.revert(!1,!0)}),L.start=de,L.end=me,Ne=Z=Go?et:ce(),!C&&!Go&&(Ne<et&&ce(et),L.scroll.rec=0),L.revert(!1,!0),pe=xo(),Ze&&(ie=-1,Ze.restart(!0)),yo=0,i&&P&&(i._initted||Nt)&&i.progress()!==Nt&&i.progress(Nt||0,!0).render(i.time(),!0,!0),(Sr||we!==L.progress||C||v||i&&!i._initted)&&(i&&!P&&(i._initted||we||i.vars.immediateRender!==!1)&&i.totalProgress(C&&de<-.001&&!we?bt.utils.normalize(de,me,0):we,!0),L.progress=Sr||(Ne-de)/le===we?0:we),d&&p&&(be._pinOffset=Math.round(L.progress*Le)),nt&&nt.invalidate(),isNaN(xr)||(xr-=bt.getProperty(se,A.p),$t-=bt.getProperty(Xe,A.p),Fw(se,A,xr),Fw(Ie,A,xr-(Gt||0)),Fw(Xe,A,$t),Fw(xe,A,$t-(Gt||0))),Sr&&!Go&&L.update(),c&&!Go&&!$&&($=!0,c(L),$=!1)}},L.getVelocity=function(){return(ce()-Z)/(xo()-A0)*1e3||0},L.endAnimation=function(){u0(L.callbackAnimation),i&&(nt?nt.progress(1):i.paused()?P||u0(i,L.direction<0,1):u0(i,i.reversed()))},L.labelToScroll=function(Ke){return i&&i.labels&&(de||L.refresh()||de)+i.labels[Ke]/i.duration()*le||0},L.getTrailing=function(Ke){var Rt=gn.indexOf(L),It=L.direction>0?gn.slice(0,Rt).reverse():gn.slice(Rt+1);return(Gs(Ke)?It.filter(function(Gt){return Gt.vars.preventOverlaps===Ke}):It).filter(function(Gt){return L.direction>0?Gt.end<=de:Gt.start>=me})},L.update=function(Ke,Rt,It){if(!(C&&!It&&!Ke)){var Gt=Go===!0?et:L.scroll(),tr=Ke?0:(Gt-de)/le,qt=tr<0?0:tr>1?1:tr||0,qn=L.progress,Sr,Qn,Yn,Nn,mi,q,ge,Re;if(Rt&&(Z=Ne,Ne=C?ce():Gt,b&&(yn=jt,jt=i&&!P?i.totalProgress():qt)),g&&d&&!yo&&!Aw&&Va&&(!qt&&de<Gt+(Gt-Z)/(xo()-A0)*g?qt=1e-4:qt===1&&me>Gt+(Gt-Z)/(xo()-A0)*g&&(qt=.9999)),qt!==qn&&L.enabled){if(Sr=L.isActive=!!qt&&qt<1,Qn=!!qn&&qn<1,q=Sr!==Qn,mi=q||!!qt!=!!qn,L.direction=qt>qn?1:-1,L.progress=qt,mi&&!yo&&(Yn=qt&&!qn?0:qt===1?1:qn===1?2:3,P&&(Nn=!q&&V[Yn+1]!=="none"&&V[Yn+1]||V[Yn],Re=i&&(Nn==="complete"||Nn==="reset"||Nn in i))),T&&(q||Re)&&(Re||h||!i)&&(Eo(T)?T(L):L.getTrailing(T).forEach(function(xt){return xt.endAnimation()})),P||(nt&&!yo&&!Aw?(nt._dp._time-nt._start!==nt._time&&nt.render(nt._dp._time-nt._start),nt.resetTo?nt.resetTo("totalProgress",qt,i._tTime/i._tDur):(nt.vars.totalProgress=qt,nt.invalidate().restart())):i&&i.totalProgress(qt,!!(yo&&(pe||Ke)))),d){if(Ke&&p&&(be.style[p+A.os2]=yt),!O)Ue(P0(We+Le*qt));else if(mi){if(ge=!Ke&&qt>qn&&me+1>Gt&&Gt+1>=sl(k,A),S)if(!Ke&&(Sr||ge)){var Me=Yl(d,!0),Ee=Gt-de;H5(d,Kn,Me.top+(A===_i?Ee:0)+gi,Me.left+(A===_i?0:Ee)+gi)}else H5(d,be);hv(Sr||ge?Te:J),ot&&qt<1&&Sr||Ue(We+(qt===1&&!ge?Le:0))}}b&&!_e.tween&&!yo&&!Aw&&Ze.restart(!0),a&&(q||_&&qt&&(qt<1||!RM))&&h1(a.targets).forEach(function(xt){return xt.classList[Sr||_?"add":"remove"](a.className)}),s&&!P&&!Ke&&s(L),mi&&!yo?(P&&(Re&&(Nn==="complete"?i.pause().totalProgress(1):Nn==="reset"?i.restart(!0).pause():Nn==="restart"?i.restart(!0):i[Nn]()),s&&s(L)),(q||!RM)&&(l&&q&&IM(L,l),z[Yn]&&IM(L,z[Yn]),_&&(qt===1?L.kill(!1,1):z[Yn]=0),q||(Yn=qt===1?1:3,z[Yn]&&IM(L,z[Yn]))),R&&!Sr&&Math.abs(L.getVelocity())>(k0(R)?R:2500)&&(u0(L.callbackAnimation),nt?nt.progress(1):u0(i,Nn==="reverse"?1:!qt,1))):P&&s&&!yo&&s(L)}if(Je){var it=C?Gt/C.duration()*(C._caScrollDist||0):Gt;dt(it+(se._isFlipped?1:0)),Je(it)}Tt&&Tt(-Gt/C.duration()*(C._caScrollDist||0))}},L.enable=function(Ke,Rt){L.enabled||(L.enabled=!0,Bi(k,"resize",D0),N||Bi(k,"scroll",tm),j&&Bi(n,"refreshInit",j),Ke!==!1&&(L.progress=we=0,Ne=Z=ie=ce()),Rt!==!1&&L.refresh())},L.getTween=function(Ke){return Ke&&_e?_e.tween:nt},L.setPositions=function(Ke,Rt,It,Gt){if(C){var tr=C.scrollTrigger,qt=C.duration(),qn=tr.end-tr.start;Ke=tr.start+qn*Ke/qt,Rt=tr.start+qn*Rt/qt}L.refresh(!1,!1,{start:N5(Ke,It&&!!L._startClamp),end:N5(Rt,It&&!!L._endClamp)},Gt),L.update()},L.adjustPinSpacing=function(Ke){if(rt&&Ke){var Rt=rt.indexOf(A.d)+1;rt[Rt]=parseFloat(rt[Rt])+Ke+gi,rt[1]=parseFloat(rt[1])+Ke+gi,hv(rt)}},L.disable=function(Ke,Rt){if(Ke!==!1&&L.revert(!0,!0),L.enabled&&(L.enabled=L.isActive=!1,Rt||nt&&nt.pause(),et=0,Oe&&(Oe.uncache=1),j&&Oi(n,"refreshInit",j),Ze&&(Ze.pause(),_e.tween&&_e.tween.kill()&&(_e.tween=0)),!N)){for(var It=gn.length;It--;)if(gn[It].scroller===k&&gn[It]!==L)return;Oi(k,"resize",D0),N||Oi(k,"scroll",tm)}},L.kill=function(Ke,Rt){L.disable(Ke,Rt),nt&&!Rt&&nt.kill(),u&&delete lI[u];var It=gn.indexOf(L);It>=0&&gn.splice(It,1),It===Ho&&z_>0&&Ho--,It=0,gn.forEach(function(Gt){return Gt.scroller===L.scroller&&(It=1)}),It||Go||(L.scroll.rec=0),i&&(i.scrollTrigger=null,Ke&&i.revert({kill:!1}),Rt||i.kill()),Ie&&[Ie,xe,se,Xe].forEach(function(Gt){return Gt.parentNode&&Gt.parentNode.removeChild(Gt)}),uy===L&&(uy=0),d&&(Oe&&(Oe.uncache=1),It=0,gn.forEach(function(Gt){return Gt.pin===d&&It++}),It||(Oe.spacer=0)),r.onKill&&r.onKill(L)},gn.push(L),L.enable(!1,!1),hn&&hn(L),i&&i.add&&!le){var Mt=L.update;L.update=function(){L.update=Mt,_n.cache++,de||me||L.refresh()},bt.delayedCall(.01,L.update),le=.01,de=me=0}else L.refresh();d&&Yhe()},n.register=function(r){return fm||(bt=r||UG(),BG()&&window.document&&n.enable(),fm=I0),fm},n.defaults=function(r){if(r)for(var i in r)Dw[i]=r[i];return Dw},n.disable=function(r,i){I0=0,gn.forEach(function(s){return s[i?"kill":"disable"](r)}),Oi(wn,"wheel",tm),Oi(lr,"scroll",tm),clearInterval(Rw),Oi(lr,"touchcancel",Ku),Oi(Kn,"touchstart",Ku),Pw(Oi,lr,"pointerdown,touchstart,mousedown",L5),Pw(Oi,lr,"pointerup,touchend,mouseup",F5),Lb.kill(),Iw(Oi);for(var o=0;o<_n.length;o+=3)kw(Oi,_n[o],_n[o+1]),kw(Oi,_n[o],_n[o+2])},n.enable=function(){if(wn=window,lr=document,qs=lr.documentElement,Kn=lr.body,bt&&(h1=bt.utils.toArray,ny=bt.utils.clamp,aI=bt.core.context||Ku,TM=bt.core.suppressOverwrites||Ku,Nk=wn.history.scrollRestoration||"auto",cI=wn.pageYOffset||0,bt.core.globals("ScrollTrigger",n),Kn)){I0=1,cv=document.createElement("div"),cv.style.height="100vh",cv.style.position="absolute",YG(),Whe(),ri.register(bt),n.isTouch=ri.isTouch,eh=ri.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),sI=ri.isTouch===1,Bi(wn,"wheel",tm),Dk=[wn,lr,qs,Kn],bt.matchMedia?(n.matchMedia=function(l){var c=bt.matchMedia(),h;for(h in l)c.add(h,l[h]);return c},bt.addEventListener("matchMediaInit",function(){XG(),zk()}),bt.addEventListener("matchMediaRevert",function(){return jG()}),bt.addEventListener("matchMedia",function(){dd(0,1),Yd("matchMedia")}),bt.matchMedia().add("(orientation: portrait)",function(){return PM(),PM})):console.warn("Requires GSAP 3.11.0 or later"),PM(),Bi(lr,"scroll",tm);var r=Kn.hasAttribute("style"),i=Kn.style,o=i.borderTopStyle,s=bt.core.Animation.prototype,a,u;for(s.revert||Object.defineProperty(s,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",a=Yl(Kn),_i.m=Math.round(a.top+_i.sc())||0,Yo.m=Math.round(a.left+Yo.sc())||0,o?i.borderTopStyle=o:i.removeProperty("border-top-style"),r||(Kn.setAttribute("style",""),Kn.removeAttribute("style")),Rw=setInterval(U5,250),bt.delayedCall(.5,function(){return Aw=0}),Bi(lr,"touchcancel",Ku),Bi(Kn,"touchstart",Ku),Pw(Bi,lr,"pointerdown,touchstart,mousedown",L5),Pw(Bi,lr,"pointerup,touchend,mouseup",F5),oI=bt.utils.checkPrefix("transform"),V_.push(oI),fm=xo(),Lb=bt.delayedCall(.2,dd).pause(),dm=[lr,"visibilitychange",function(){var l=wn.innerWidth,c=wn.innerHeight;lr.hidden?(P5=l,k5=c):(P5!==l||k5!==c)&&D0()},lr,"DOMContentLoaded",dd,wn,"load",dd,wn,"resize",D0],Iw(Bi),gn.forEach(function(l){return l.enable(0,1)}),u=0;u<_n.length;u+=3)kw(Oi,_n[u],_n[u+1]),kw(Oi,_n[u],_n[u+2])}},n.config=function(r){"limitCallbacks"in r&&(RM=!!r.limitCallbacks);var i=r.syncInterval;i&&clearInterval(Rw)||(Rw=i)&&setInterval(U5,i),"ignoreMobileResize"in r&&(sI=n.isTouch===1&&r.ignoreMobileResize),"autoRefreshEvents"in r&&(Iw(Oi)||Iw(Bi,r.autoRefreshEvents||"none"),LG=(r.autoRefreshEvents+"").indexOf("resize")===-1)},n.scrollerProxy=function(r,i){var o=us(r),s=_n.indexOf(o),a=Xd(o);~s&&_n.splice(s,a?6:2),i&&(a?pl.unshift(wn,i,Kn,i,qs,i):pl.unshift(o,i))},n.clearMatchMedia=function(r){gn.forEach(function(i){return i._ctx&&i._ctx.query===r&&i._ctx.kill(!0,!0)})},n.isInViewport=function(r,i,o){var s=(Gs(r)?us(r):r).getBoundingClientRect(),a=s[o?Id:Pd]*i||0;return o?s.right-a>0&&s.left+a<wn.innerWidth:s.bottom-a>0&&s.top+a<wn.innerHeight},n.positionInViewport=function(r,i,o){Gs(r)&&(r=us(r));var s=r.getBoundingClientRect(),a=s[o?Id:Pd],u=i==null?a/2:i in Ob?Ob[i]*a:~i.indexOf("%")?parseFloat(i)*a/100:parseFloat(i)||0;return o?(s.left+u)/wn.innerWidth:(s.top+u)/wn.innerHeight},n.killAll=function(r){if(gn.slice(0).forEach(function(o){return o.vars.id!=="ScrollSmoother"&&o.kill()}),r!==!0){var i=qd.killAll||[];qd={},i.forEach(function(o){return o()})}},n}();bn.version="3.14.2";bn.saveStyles=function(n){return n?h1(n).forEach(function(e){if(e&&e.style){var t=Ws.indexOf(e);t>=0&&Ws.splice(t,5),Ws.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),bt.core.getCache(e),aI())}}):Ws};bn.revert=function(n,e){return zk(!n,e)};bn.create=function(n,e){return new bn(n,e)};bn.refresh=function(n){return n?D0(!0):(fm||bn.register())&&dd(!0)};bn.update=function(n){return++_n.cache&&uc(n===!0?2:0)};bn.clearScrollMemory=qG;bn.maxScroll=function(n,e){return sl(n,e?Yo:_i)};bn.getScrollFunc=function(n,e){return qh(us(n),e?Yo:_i)};bn.getById=function(n){return lI[n]};bn.getAll=function(){return gn.filter(function(n){return n.vars.id!=="ScrollSmoother"})};bn.isScrolling=function(){return!!Va};bn.snapDirectional=Uk;bn.addEventListener=function(n,e){var t=qd[n]||(qd[n]=[]);~t.indexOf(e)||t.push(e)};bn.removeEventListener=function(n,e){var t=qd[n],r=t&&t.indexOf(e);r>=0&&t.splice(r,1)};bn.batch=function(n,e){var t=[],r={},i=e.interval||.016,o=e.batchMax||1e9,s=function(l,c){var h=[],f=[],d=bt.delayedCall(i,function(){c(h,f),h=[],f=[]}).pause();return function(p){h.length||d.restart(!0),h.push(p.trigger),f.push(p),o<=h.length&&d.progress(1)}},a;for(a in e)r[a]=a.substr(0,2)==="on"&&Eo(e[a])&&a!=="onRefreshInit"?s(a,e[a]):e[a];return Eo(o)&&(o=o(),Bi(bn,"refresh",function(){return o=e.batchMax()})),h1(n).forEach(function(u){var l={};for(a in r)l[a]=r[a];l.trigger=u,t.push(bn.create(l))}),t};var $5=function(e,t,r,i){return t>i?e(i):t<0&&e(0),r>i?(i-t)/(r-t):r<0?t/(t-r):1},DM=function n(e,t){t===!0?e.style.removeProperty("touch-action"):e.style.touchAction=t===!0?"auto":t?"pan-"+t+(ri.isTouch?" pinch-zoom":""):"none",e===qs&&n(Kn,t)},Ow={auto:1,scroll:1},efe=function(e){var t=e.event,r=e.target,i=e.axis,o=(t.changedTouches?t.changedTouches[0]:t).target,s=o._gsap||bt.core.getCache(o),a=xo(),u;if(!s._isScrollT||a-s._isScrollT>2e3){for(;o&&o!==Kn&&(o.scrollHeight<=o.clientHeight&&o.scrollWidth<=o.clientWidth||!(Ow[(u=ka(o)).overflowY]||Ow[u.overflowX]));)o=o.parentNode;s._isScroll=o&&o!==r&&!Xd(o)&&(Ow[(u=ka(o)).overflowY]||Ow[u.overflowX]),s._isScrollT=a}(s._isScroll||i==="x")&&(t.stopPropagation(),t._gsapAllow=!0)},ZG=function(e,t,r,i){return ri.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:i=i&&efe,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return r&&Bi(lr,ri.eventTypes[0],X5,!1,!0)},onDisable:function(){return Oi(lr,ri.eventTypes[0],X5,!0)}})},tfe=/(input|label|select|textarea)/i,j5,X5=function(e){var t=tfe.test(e.target.tagName);(t||j5)&&(e._gsapAllow=!0,j5=t)},nfe=function(e){Yf(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t=e,r=t.normalizeScrollX,i=t.momentum,o=t.allowNestedScroll,s=t.onRelease,a,u,l=us(e.target)||qs,c=bt.core.globals().ScrollSmoother,h=c&&c.get(),f=eh&&(e.content&&us(e.content)||h&&e.content!==!1&&!h.smooth()&&h.content()),d=qh(l,_i),p=qh(l,Yo),v=1,g=(ri.isTouch&&wn.visualViewport?wn.visualViewport.scale*wn.visualViewport.width:wn.outerWidth)/wn.innerWidth,m=0,x=Eo(i)?function(){return i(a)}:function(){return i||2.8},_,b,S=ZG(l,e.type,!0,o),E=function(){return b=!1},C=Ku,R=Ku,T=function(){u=sl(l,_i),R=ny(eh?1:0,u),r&&(C=ny(0,sl(l,Yo))),_=kd},A=function(){f._gsap.y=P0(parseFloat(f._gsap.y)+d.offset)+"px",f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(f._gsap.y)+", 0, 1)",d.offset=d.cacheID=0},P=function(){if(b){requestAnimationFrame(E);var F=P0(a.deltaY/2),U=R(d.v-F);if(f&&U!==d.v+d.offset){d.offset=U-d.v;var L=P0((parseFloat(f&&f._gsap.y)||0)-d.offset);f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+L+", 0, 1)",f._gsap.y=L+"px",d.cacheID=_n.cache,uc()}return!0}d.offset&&A(),b=!0},k,W,N,O,z=function(){T(),k.isActive()&&k.vars.scrollY>u&&(d()>u?k.progress(1)&&d(u):k.resetTo("scrollY",u))};return f&&bt.set(f,{y:"+=0"}),e.ignoreCheck=function(V){return eh&&V.type==="touchmove"&&P()||v>1.05&&V.type!=="touchstart"||a.isGesturing||V.touches&&V.touches.length>1},e.onPress=function(){b=!1;var V=v;v=P0((wn.visualViewport&&wn.visualViewport.scale||1)/g),k.pause(),V!==v&&DM(l,v>1.01?!0:r?!1:"x"),W=p(),N=d(),T(),_=kd},e.onRelease=e.onGestureStart=function(V,F){if(d.offset&&A(),!F)O.restart(!0);else{_n.cache++;var U=x(),L,j;r&&(L=p(),j=L+U*.05*-V.velocityX/.227,U*=$5(p,L,j,sl(l,Yo)),k.vars.scrollX=C(j)),L=d(),j=L+U*.05*-V.velocityY/.227,U*=$5(d,L,j,sl(l,_i)),k.vars.scrollY=R(j),k.invalidate().duration(U).play(.01),(eh&&k.vars.scrollY>=u||L>=u-1)&&bt.to({},{onUpdate:z,duration:U})}s&&s(V)},e.onWheel=function(){k._ts&&k.pause(),xo()-m>1e3&&(_=0,m=xo())},e.onChange=function(V,F,U,L,j){if(kd!==_&&T(),F&&r&&p(C(L[2]===F?W+(V.startX-V.x):p()+F-L[1])),U){d.offset&&A();var Q=j[2]===U,K=Q?N+V.startY-V.y:d()+U-j[1],ie=R(K);Q&&K!==ie&&(N+=ie-K),d(ie)}(U||F)&&uc()},e.onEnable=function(){DM(l,r?!1:"x"),bn.addEventListener("refresh",z),Bi(wn,"resize",z),d.smooth&&(d.target.style.scrollBehavior="auto",d.smooth=p.smooth=!1),S.enable()},e.onDisable=function(){DM(l,!0),Oi(wn,"resize",z),bn.removeEventListener("refresh",z),S.kill()},e.lockAxis=e.lockAxis!==!1,a=new ri(e),a.iOS=eh,eh&&!d()&&d(1),eh&&bt.ticker.add(Ku),O=a._dc,k=bt.to(a,{ease:"power4",paused:!0,inherit:!1,scrollX:r?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:KG(d,d(),function(){return k.pause()})},onUpdate:uc,onComplete:O.vars.onComplete}),a};bn.sort=function(n){if(Eo(n))return gn.sort(n);var e=wn.pageYOffset||0;return bn.getAll().forEach(function(t){return t._sortY=t.trigger?e+t.trigger.getBoundingClientRect().top:t.start+wn.innerHeight}),gn.sort(n||function(t,r){return(t.vars.refreshPriority||0)*-1e6+(t.vars.containerAnimation?1e6:t._sortY)-((r.vars.containerAnimation?1e6:r._sortY)+(r.vars.refreshPriority||0)*-1e6)})};bn.observe=function(n){return new ri(n)};bn.normalizeScroll=function(n){if(typeof n>"u")return Vo;if(n===!0&&Vo)return Vo.enable();if(n===!1){Vo&&Vo.kill(),Vo=n;return}var e=n instanceof ri?n:nfe(n);return Vo&&Vo.target===e.target&&Vo.kill(),Xd(e.target)&&(Vo=e),e};bn.core={_getVelocityProp:iI,_inputObserver:ZG,_scrollers:_n,_proxies:pl,bridge:{ss:function(){Va||Yd("scrollStart"),Va=xo()},ref:function(){return yo}}};UG()&&bt.registerPlugin(bn);/*!
 * SplitText 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2025, GreenSock. All rights reserved. Subject to the terms at https://gsap.com/standard-license.
 * @author: Jack Doyle
 */let l0,nm,q5=typeof Symbol=="function"?Symbol():"_split",fI,rfe=()=>fI||Vk.register(window.gsap),Y5=typeof Intl<"u"&&"Segmenter"in Intl?new Intl.Segmenter:0,d1=n=>typeof n=="string"?d1(document.querySelectorAll(n)):"length"in n?Array.from(n).reduce((e,t)=>(typeof t=="string"?e.push(...d1(t)):e.push(t),e),[]):[n],K5=n=>d1(n).filter(e=>e instanceof HTMLElement),dI=[],NM=function(){},ife={add:n=>n()},ofe=/\s+/g,Z5=new RegExp("\\p{RI}\\p{RI}|\\p{Emoji}(\\p{EMod}|\\u{FE0F}\\u{20E3}?|[\\u{E0020}-\\u{E007E}]+\\u{E007F})?(\\u{200D}\\p{Emoji}(\\p{EMod}|\\u{FE0F}\\u{20E3}?|[\\u{E0020}-\\u{E007E}]+\\u{E007F})?)*|.","gu"),Bb={left:0,top:0,width:0,height:0},sfe=(n,e)=>{for(;++e<n.length&&n[e]===Bb;);return n[e]||Bb},Q5=({element:n,html:e,ariaL:t,ariaH:r})=>{n.innerHTML=e,t?n.setAttribute("aria-label",t):n.removeAttribute("aria-label"),r?n.setAttribute("aria-hidden",r):n.removeAttribute("aria-hidden")},J5=(n,e)=>{if(e){let t=new Set(n.join("").match(e)||dI),r=n.length,i,o,s,a;if(t.size)for(;--r>-1;){o=n[r];for(s of t)if(s.startsWith(o)&&s.length>o.length){for(i=0,a=o;s.startsWith(a+=n[r+ ++i])&&a.length<s.length;);if(i&&a.length===s.length){n[r]=s,n.splice(r+1,i);break}}}}return n},eU=n=>window.getComputedStyle(n).display==="inline"&&(n.style.display="inline-block"),rm=(n,e,t)=>e.insertBefore(typeof n=="string"?document.createTextNode(n):n,t),pI=(n,e,t)=>{let r=e[n+"sClass"]||"",{tag:i="div",aria:o="auto",propIndex:s=!1}=e,a=n==="line"?"block":"inline-block",u=r.indexOf("++")>-1,l=c=>{let h=document.createElement(i),f=t.length+1;return r&&(h.className=r+(u?" "+r+f:"")),s&&h.style.setProperty("--"+n,f+""),o!=="none"&&h.setAttribute("aria-hidden","true"),i!=="span"&&(h.style.position="relative",h.style.display=a),h.textContent=c,t.push(h),h};return u&&(r=r.replace("++","")),l.collection=t,l},afe=(n,e,t,r)=>{let i=pI("line",t,r),o=window.getComputedStyle(n).textAlign||"left";return(s,a)=>{let u=i("");for(u.style.textAlign=o,n.insertBefore(u,e[s]);s<a;s++)u.appendChild(e[s]);u.normalize()}},QG=(n,e,t,r,i,o,s,a,u,l)=>{var c;let h=Array.from(n.childNodes),f=0,{wordDelimiter:d,reduceWhiteSpace:p=!0,prepareText:v}=e,g=n.getBoundingClientRect(),m=g,x=!p&&window.getComputedStyle(n).whiteSpace.substring(0,3)==="pre",_=0,b=t.collection,S,E,C,R,T,A,P,k,W,N,O,z,V,F,U,L,j,Q;for(typeof d=="object"?(C=d.delimiter||d,E=d.replaceWith||""):E=d===""?"":d||" ",S=E!==" ";f<h.length;f++)if(R=h[f],R.nodeType===3){for(U=R.textContent||"",p?U=U.replace(ofe," "):x&&(U=U.replace(/\n/g,E+`
`)),v&&(U=v(U,n)),R.textContent=U,T=E||C?U.split(C||E):U.match(a)||dI,j=T[T.length-1],k=S?j.slice(-1)===" ":!j,j||T.pop(),m=g,P=S?T[0].charAt(0)===" ":!T[0],P&&rm(" ",n,R),T[0]||T.shift(),J5(T,u),o&&l||(R.textContent=""),W=1;W<=T.length;W++)if(L=T[W-1],!p&&x&&L.charAt(0)===`
`&&((c=R.previousSibling)==null||c.remove(),rm(document.createElement("br"),n,R),L=L.slice(1)),!p&&L==="")rm(E,n,R);else if(L===" ")n.insertBefore(document.createTextNode(" "),R);else{if(S&&L.charAt(0)===" "&&rm(" ",n,R),_&&W===1&&!P&&b.indexOf(_.parentNode)>-1?(A=b[b.length-1],A.appendChild(document.createTextNode(r?"":L))):(A=t(r?"":L),rm(A,n,R),_&&W===1&&!P&&A.insertBefore(_,A.firstChild)),r)for(O=Y5?J5([...Y5.segment(L)].map(K=>K.segment),u):L.match(a)||dI,Q=0;Q<O.length;Q++)A.appendChild(O[Q]===" "?document.createTextNode(" "):r(O[Q]));if(o&&l){if(U=R.textContent=U.substring(L.length+1,U.length),N=A.getBoundingClientRect(),N.top>m.top&&N.left<=m.left){for(z=n.cloneNode(),V=n.childNodes[0];V&&V!==A;)F=V,V=V.nextSibling,z.appendChild(F);n.parentNode.insertBefore(z,n),i&&eU(z)}m=N}(W<T.length||k)&&rm(W>=T.length?" ":S&&L.slice(-1)===" "?" "+E:E,n,R)}n.removeChild(R),_=0}else R.nodeType===1&&(s&&s.indexOf(R)>-1?(b.indexOf(R.previousSibling)>-1&&b[b.length-1].appendChild(R),_=R):(QG(R,e,t,r,i,o,s,a,u,!0),_=0),i&&eU(R))};const JG=class e${constructor(e,t){this.isSplit=!1,rfe(),this.elements=K5(e),this.chars=[],this.words=[],this.lines=[],this.masks=[],this.vars=t,this.elements.forEach(s=>{var a;t.overwrite!==!1&&((a=s[q5])==null||a._data.orig.filter(({element:u})=>u===s).forEach(Q5)),s[q5]=this}),this._split=()=>this.isSplit&&this.split(this.vars);let r=[],i,o=()=>{let s=r.length,a;for(;s--;){a=r[s];let u=a.element.offsetWidth;if(u!==a.width){a.width=u,this._split();return}}};this._data={orig:r,obs:typeof ResizeObserver<"u"&&new ResizeObserver(()=>{clearTimeout(i),i=setTimeout(o,200)})},NM(this),this.split(t)}split(e){return(this._ctx||ife).add(()=>{this.isSplit&&this.revert(),this.vars=e=e||this.vars||{};let{type:t="chars,words,lines",aria:r="auto",deepSlice:i=!0,smartWrap:o,onSplit:s,autoSplit:a=!1,specialChars:u,mask:l}=this.vars,c=t.indexOf("lines")>-1,h=t.indexOf("chars")>-1,f=t.indexOf("words")>-1,d=h&&!f&&!c,p=u&&("push"in u?new RegExp("(?:"+u.join("|")+")","gu"):u),v=p?new RegExp(p.source+"|"+Z5.source,"gu"):Z5,g=!!e.ignore&&K5(e.ignore),{orig:m,animTime:x,obs:_}=this._data,b;(h||f||c)&&(this.elements.forEach((S,E)=>{m[E]={element:S,html:S.innerHTML,ariaL:S.getAttribute("aria-label"),ariaH:S.getAttribute("aria-hidden")},r==="auto"?S.setAttribute("aria-label",(S.textContent||"").trim()):r==="hidden"&&S.setAttribute("aria-hidden","true");let C=[],R=[],T=[],A=h?pI("char",e,C):null,P=pI("word",e,R),k,W,N,O;if(QG(S,e,P,A,d,i&&(c||d),g,v,p,!1),c){let z=d1(S.childNodes),V=afe(S,z,e,T),F,U=[],L=0,j=z.map(ie=>ie.nodeType===1?ie.getBoundingClientRect():Bb),Q=Bb,K;for(k=0;k<z.length;k++)F=z[k],F.nodeType===1&&(F.nodeName==="BR"?((!k||z[k-1].nodeName!=="BR")&&(U.push(F),V(L,k+1)),L=k+1,Q=sfe(j,k)):(K=j[k],k&&K.top>Q.top&&K.left<Q.left+Q.width-1&&(V(L,k),L=k),Q=K));L<k&&V(L,k),U.forEach(ie=>{var pe;return(pe=ie.parentNode)==null?void 0:pe.removeChild(ie)})}if(!f){for(k=0;k<R.length;k++)if(W=R[k],h||!W.nextSibling||W.nextSibling.nodeType!==3)if(o&&!c){for(N=document.createElement("span"),N.style.whiteSpace="nowrap";W.firstChild;)N.appendChild(W.firstChild);W.replaceWith(N)}else W.replaceWith(...W.childNodes);else O=W.nextSibling,O&&O.nodeType===3&&(O.textContent=(W.textContent||"")+(O.textContent||""),W.remove());R.length=0,S.normalize()}this.lines.push(...T),this.words.push(...R),this.chars.push(...C)}),l&&this[l]&&this.masks.push(...this[l].map(S=>{let E=S.cloneNode();return S.replaceWith(E),E.appendChild(S),S.className&&(E.className=S.className.trim()+"-mask"),E.style.overflow="clip",E}))),this.isSplit=!0,nm&&c&&(a?nm.addEventListener("loadingdone",this._split):nm.status==="loading"&&console.warn("SplitText called before fonts loaded")),(b=s&&s(this))&&b.totalTime&&(this._data.anim=x?b.totalTime(x):b),c&&a&&this.elements.forEach((S,E)=>{m[E].width=S.offsetWidth,_&&_.observe(S)})}),this}kill(){let{obs:e}=this._data;e&&e.disconnect(),nm==null||nm.removeEventListener("loadingdone",this._split)}revert(){var e,t;if(this.isSplit){let{orig:r,anim:i}=this._data;this.kill(),r.forEach(Q5),this.chars.length=this.words.length=this.lines.length=r.length=this.masks.length=0,this.isSplit=!1,i&&(this._data.animTime=i.totalTime(),i.revert()),(t=(e=this.vars).onRevert)==null||t.call(e,this)}return this}static create(e,t){return new e$(e,t)}static register(e){l0=l0||e||window.gsap,l0&&(d1=l0.utils.toArray,NM=l0.core.context||NM),!fI&&window.innerWidth>0&&(nm=document.fonts,fI=!0)}};JG.version="3.14.2";let Vk=JG;/*!
 * @gsap/react 2.1.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/let tU=typeof document<"u"?H.useLayoutEffect:H.useEffect,nU=n=>n&&!Array.isArray(n)&&typeof n=="object",Bw=[],ufe={},t$=en;const AE=(n,e=Bw)=>{let t=ufe;nU(n)?(t=n,n=null,e="dependencies"in t?t.dependencies:Bw):nU(e)&&(t=e,e="dependencies"in t?t.dependencies:Bw),n&&typeof n!="function"&&console.warn("First parameter must be a function or config object");const{scope:r,revertOnUpdate:i}=t,o=H.useRef(!1),s=H.useRef(t$.context(()=>{},r)),a=H.useRef(l=>s.current.add(null,l)),u=e&&e.length&&!i;return u&&tU(()=>(o.current=!0,()=>s.current.revert()),Bw),tU(()=>{if(n&&s.current.add(n,r),!u||!o.current)return()=>s.current.revert()},e),{context:s.current,contextSafe:a.current}};AE.register=n=>{t$=n};AE.headless=!0;en.registerPlugin(bn,Vk,AE);const n$=({text:n,as:e="div",typingSpeed:t=50,initialDelay:r=0,pauseDuration:i=2e3,deletingSpeed:o=30,loop:s=!0,className:a="",showCursor:u=!0,hideCursorWhileTyping:l=!1,cursorCharacter:c="|",cursorClassName:h="",cursorBlinkDuration:f=.5,textColors:d=[],variableSpeed:p,onSentenceComplete:v,startOnVisible:g=!1,reverseMode:m=!1,...x})=>{const[_,b]=H.useState(""),[S,E]=H.useState(0),[C,R]=H.useState(!1),[T,A]=H.useState(0),[P,k]=H.useState(!g),W=H.useRef(null),N=H.useRef(null),O=H.useMemo(()=>Array.isArray(n)?n:[n],[n]),z=H.useCallback(()=>{if(!p)return t;const{min:U,max:L}=p;return Math.random()*(L-U)+U},[p,t]),V=()=>{if(d.length!==0)return d[T%d.length]};H.useEffect(()=>{if(!g||!N.current)return;const U=new IntersectionObserver(L=>{L.forEach(j=>{j.isIntersecting&&k(!0)})},{threshold:.1});return U.observe(N.current),()=>U.disconnect()},[g]),H.useEffect(()=>{u&&W.current&&(en.set(W.current,{opacity:1}),en.to(W.current,{opacity:0,duration:f,repeat:-1,yoyo:!0,ease:"power2.inOut"}))},[u,f]),H.useEffect(()=>{if(!P)return;let U;const L=O[T],j=m?L.split("").reverse().join(""):L,Q=()=>{if(C)if(_===""){if(R(!1),T===O.length-1&&!s)return;v&&v(O[T],T),A(K=>(K+1)%O.length),E(0),U=setTimeout(()=>{},i)}else U=setTimeout(()=>{b(K=>K.slice(0,-1))},o);else if(S<j.length)U=setTimeout(()=>{b(K=>K+j[S]),E(K=>K+1)},p?z():t);else if(O.length>=1){if(!s&&T===O.length-1)return;U=setTimeout(()=>{R(!0)},i)}};return S===0&&!C&&_===""?U=setTimeout(Q,r):Q(),()=>clearTimeout(U)},[S,_,C,t,o,i,O,T,s,r,P,m,p,v]);const F=l&&(S<O[T].length||C);return H.createElement(e,{ref:N,className:`inline-block whitespace-pre-wrap tracking-tight ${a}`,...x},G.jsx("span",{className:"inline",style:{color:V()||"inherit"},children:_}),u&&G.jsx("span",{ref:W,className:`ml-1 inline-block opacity-100 ${F?"hidden":""} ${h}`,children:c}))};en.registerPlugin(bn,Vk,AE);const Wk=H.createContext({});function X1(n){const e=H.useRef(null);return e.current===null&&(e.current=n()),e.current}const Hk=typeof window<"u",Gk=Hk?H.useLayoutEffect:H.useEffect,IE=H.createContext(null);function $k(n,e){n.indexOf(e)===-1&&n.push(e)}function jk(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}const wc=(n,e,t)=>t>e?e:t<n?n:t;let Xk=()=>{};const _c={},r$=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n);function i$(n){return typeof n=="object"&&n!==null}const o$=n=>/^0[^.\s]+$/u.test(n);function qk(n){let e;return()=>(e===void 0&&(e=n()),e)}const Wa=n=>n,lfe=(n,e)=>t=>e(n(t)),q1=(...n)=>n.reduce(lfe),p1=(n,e,t)=>{const r=e-n;return r===0?1:(t-n)/r};class Yk{constructor(){this.subscriptions=[]}add(e){return $k(this.subscriptions,e),()=>jk(this.subscriptions,e)}notify(e,t,r){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,r);else for(let o=0;o<i;o++){const s=this.subscriptions[o];s&&s(e,t,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const ml=n=>n*1e3,Ba=n=>n/1e3;function s$(n,e){return e?n*(1e3/e):0}const a$=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,cfe=1e-7,hfe=12;function ffe(n,e,t,r,i){let o,s,a=0;do s=e+(t-e)/2,o=a$(s,r,i)-n,o>0?t=s:e=s;while(Math.abs(o)>cfe&&++a<hfe);return s}function Y1(n,e,t,r){if(n===e&&t===r)return Wa;const i=o=>ffe(o,0,1,n,t);return o=>o===0||o===1?o:a$(i(o),e,r)}const u$=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,l$=n=>e=>1-n(1-e),c$=Y1(.33,1.53,.69,.99),Kk=l$(c$),h$=u$(Kk),f$=n=>(n*=2)<1?.5*Kk(n):.5*(2-Math.pow(2,-10*(n-1))),Zk=n=>1-Math.sin(Math.acos(n)),d$=l$(Zk),p$=u$(Zk),dfe=Y1(.42,0,1,1),pfe=Y1(0,0,.58,1),m$=Y1(.42,0,.58,1),mfe=n=>Array.isArray(n)&&typeof n[0]!="number",v$=n=>Array.isArray(n)&&typeof n[0]=="number",vfe={linear:Wa,easeIn:dfe,easeInOut:m$,easeOut:pfe,circIn:Zk,circInOut:p$,circOut:d$,backIn:Kk,backInOut:h$,backOut:c$,anticipate:f$},gfe=n=>typeof n=="string",rU=n=>{if(v$(n)){Xk(n.length===4);const[e,t,r,i]=n;return Y1(e,t,r,i)}else if(gfe(n))return vfe[n];return n},Uw=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function yfe(n,e){let t=new Set,r=new Set,i=!1,o=!1;const s=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function u(c){s.has(c)&&(l.schedule(c),n()),c(a)}const l={schedule:(c,h=!1,f=!1)=>{const p=f&&i?t:r;return h&&s.add(c),p.has(c)||p.add(c),c},cancel:c=>{r.delete(c),s.delete(c)},process:c=>{if(a=c,i){o=!0;return}i=!0,[t,r]=[r,t],t.forEach(u),t.clear(),i=!1,o&&(o=!1,l.process(c))}};return l}const xfe=40;function g$(n,e){let t=!1,r=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>t=!0,s=Uw.reduce((_,b)=>(_[b]=yfe(o),_),{}),{setup:a,read:u,resolveKeyframes:l,preUpdate:c,update:h,preRender:f,render:d,postRender:p}=s,v=()=>{const _=_c.useManualTiming?i.timestamp:performance.now();t=!1,_c.useManualTiming||(i.delta=r?1e3/60:Math.max(Math.min(_-i.timestamp,xfe),1)),i.timestamp=_,i.isProcessing=!0,a.process(i),u.process(i),l.process(i),c.process(i),h.process(i),f.process(i),d.process(i),p.process(i),i.isProcessing=!1,t&&e&&(r=!1,n(v))},g=()=>{t=!0,r=!0,i.isProcessing||n(v)};return{schedule:Uw.reduce((_,b)=>{const S=s[b];return _[b]=(E,C=!1,R=!1)=>(t||g(),S.schedule(E,C,R)),_},{}),cancel:_=>{for(let b=0;b<Uw.length;b++)s[Uw[b]].cancel(_)},state:i,steps:s}}const{schedule:fr,cancel:bc,state:Yi,steps:LM}=g$(typeof requestAnimationFrame<"u"?requestAnimationFrame:Wa,!0);let H_;function wfe(){H_=void 0}const gs={now:()=>(H_===void 0&&gs.set(Yi.isProcessing||_c.useManualTiming?Yi.timestamp:performance.now()),H_),set:n=>{H_=n,queueMicrotask(wfe)}},y$=n=>e=>typeof e=="string"&&e.startsWith(n),x$=y$("--"),_fe=y$("var(--"),Qk=n=>_fe(n)?bfe.test(n.split("/*")[0].trim()):!1,bfe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,pg={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},m1={...pg,transform:n=>wc(0,1,n)},zw={...pg,default:1},ly=n=>Math.round(n*1e5)/1e5,Jk=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Sfe(n){return n==null}const Efe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,eD=(n,e)=>t=>!!(typeof t=="string"&&Efe.test(t)&&t.startsWith(n)||e&&!Sfe(t)&&Object.prototype.hasOwnProperty.call(t,e)),w$=(n,e,t)=>r=>{if(typeof r!="string")return r;const[i,o,s,a]=r.match(Jk);return{[n]:parseFloat(i),[e]:parseFloat(o),[t]:parseFloat(s),alpha:a!==void 0?parseFloat(a):1}},Cfe=n=>wc(0,255,n),FM={...pg,transform:n=>Math.round(Cfe(n))},pd={test:eD("rgb","red"),parse:w$("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:r=1})=>"rgba("+FM.transform(n)+", "+FM.transform(e)+", "+FM.transform(t)+", "+ly(m1.transform(r))+")"};function Mfe(n){let e="",t="",r="",i="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),r=n.substring(5,7),i=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),r=n.substring(3,4),i=n.substring(4,5),e+=e,t+=t,r+=r,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(r,16),alpha:i?parseInt(i,16)/255:1}}const mI={test:eD("#"),parse:Mfe,transform:pd.transform},K1=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),th=K1("deg"),vl=K1("%"),Kt=K1("px"),Tfe=K1("vh"),Rfe=K1("vw"),iU={...vl,parse:n=>vl.parse(n)/100,transform:n=>vl.transform(n*100)},jm={test:eD("hsl","hue"),parse:w$("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:r=1})=>"hsla("+Math.round(n)+", "+vl.transform(ly(e))+", "+vl.transform(ly(t))+", "+ly(m1.transform(r))+")"},ci={test:n=>pd.test(n)||mI.test(n)||jm.test(n),parse:n=>pd.test(n)?pd.parse(n):jm.test(n)?jm.parse(n):mI.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?pd.transform(n):jm.transform(n),getAnimatableNone:n=>{const e=ci.parse(n);return e.alpha=0,ci.transform(e)}},Afe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Ife(n){var e,t;return isNaN(n)&&typeof n=="string"&&(((e=n.match(Jk))==null?void 0:e.length)||0)+(((t=n.match(Afe))==null?void 0:t.length)||0)>0}const _$="number",b$="color",Pfe="var",kfe="var(",oU="${}",Dfe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function v1(n){const e=n.toString(),t=[],r={color:[],number:[],var:[]},i=[];let o=0;const a=e.replace(Dfe,u=>(ci.test(u)?(r.color.push(o),i.push(b$),t.push(ci.parse(u))):u.startsWith(kfe)?(r.var.push(o),i.push(Pfe),t.push(u)):(r.number.push(o),i.push(_$),t.push(parseFloat(u))),++o,oU)).split(oU);return{values:t,split:a,indexes:r,types:i}}function S$(n){return v1(n).values}function E$(n){const{split:e,types:t}=v1(n),r=e.length;return i=>{let o="";for(let s=0;s<r;s++)if(o+=e[s],i[s]!==void 0){const a=t[s];a===_$?o+=ly(i[s]):a===b$?o+=ci.transform(i[s]):o+=i[s]}return o}}const Nfe=n=>typeof n=="number"?0:ci.test(n)?ci.getAnimatableNone(n):n;function Lfe(n){const e=S$(n);return E$(n)(e.map(Nfe))}const Yh={test:Ife,parse:S$,createTransformer:E$,getAnimatableNone:Lfe};function OM(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function Ffe({hue:n,saturation:e,lightness:t,alpha:r}){n/=360,e/=100,t/=100;let i=0,o=0,s=0;if(!e)i=o=s=t;else{const a=t<.5?t*(1+e):t+e-t*e,u=2*t-a;i=OM(u,a,n+1/3),o=OM(u,a,n),s=OM(u,a,n-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(s*255),alpha:r}}function Ub(n,e){return t=>t>0?e:n}const kr=(n,e,t)=>n+(e-n)*t,BM=(n,e,t)=>{const r=n*n,i=t*(e*e-r)+r;return i<0?0:Math.sqrt(i)},Ofe=[mI,pd,jm],Bfe=n=>Ofe.find(e=>e.test(n));function sU(n){const e=Bfe(n);if(!e)return!1;let t=e.parse(n);return e===jm&&(t=Ffe(t)),t}const aU=(n,e)=>{const t=sU(n),r=sU(e);if(!t||!r)return Ub(n,e);const i={...t};return o=>(i.red=BM(t.red,r.red,o),i.green=BM(t.green,r.green,o),i.blue=BM(t.blue,r.blue,o),i.alpha=kr(t.alpha,r.alpha,o),pd.transform(i))},vI=new Set(["none","hidden"]);function Ufe(n,e){return vI.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function zfe(n,e){return t=>kr(n,e,t)}function tD(n){return typeof n=="number"?zfe:typeof n=="string"?Qk(n)?Ub:ci.test(n)?aU:Hfe:Array.isArray(n)?C$:typeof n=="object"?ci.test(n)?aU:Vfe:Ub}function C$(n,e){const t=[...n],r=t.length,i=n.map((o,s)=>tD(o)(o,e[s]));return o=>{for(let s=0;s<r;s++)t[s]=i[s](o);return t}}function Vfe(n,e){const t={...n,...e},r={};for(const i in t)n[i]!==void 0&&e[i]!==void 0&&(r[i]=tD(n[i])(n[i],e[i]));return i=>{for(const o in r)t[o]=r[o](i);return t}}function Wfe(n,e){const t=[],r={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const o=e.types[i],s=n.indexes[o][r[o]],a=n.values[s]??0;t[i]=a,r[o]++}return t}const Hfe=(n,e)=>{const t=Yh.createTransformer(e),r=v1(n),i=v1(e);return r.indexes.var.length===i.indexes.var.length&&r.indexes.color.length===i.indexes.color.length&&r.indexes.number.length>=i.indexes.number.length?vI.has(n)&&!i.values.length||vI.has(e)&&!r.values.length?Ufe(n,e):q1(C$(Wfe(r,i),i.values),t):Ub(n,e)};function M$(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?kr(n,e,t):tD(n)(n,e)}const Gfe=n=>{const e=({timestamp:t})=>n(t);return{start:(t=!0)=>fr.update(e,t),stop:()=>bc(e),now:()=>Yi.isProcessing?Yi.timestamp:gs.now()}},T$=(n,e,t=10)=>{let r="";const i=Math.max(Math.round(e/t),2);for(let o=0;o<i;o++)r+=Math.round(n(o/(i-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},zb=2e4;function nD(n){let e=0;const t=50;let r=n.next(e);for(;!r.done&&e<zb;)e+=t,r=n.next(e);return e>=zb?1/0:e}function $fe(n,e=100,t){const r=t({...n,keyframes:[0,e]}),i=Math.min(nD(r),zb);return{type:"keyframes",ease:o=>r.next(i*o).value/e,duration:Ba(i)}}const jfe=5;function R$(n,e,t){const r=Math.max(e-jfe,0);return s$(t-n(r),e-r)}const $r={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},UM=.001;function Xfe({duration:n=$r.duration,bounce:e=$r.bounce,velocity:t=$r.velocity,mass:r=$r.mass}){let i,o,s=1-e;s=wc($r.minDamping,$r.maxDamping,s),n=wc($r.minDuration,$r.maxDuration,Ba(n)),s<1?(i=l=>{const c=l*s,h=c*n,f=c-t,d=gI(l,s),p=Math.exp(-h);return UM-f/d*p},o=l=>{const h=l*s*n,f=h*t+t,d=Math.pow(s,2)*Math.pow(l,2)*n,p=Math.exp(-h),v=gI(Math.pow(l,2),s);return(-i(l)+UM>0?-1:1)*((f-d)*p)/v}):(i=l=>{const c=Math.exp(-l*n),h=(l-t)*n+1;return-UM+c*h},o=l=>{const c=Math.exp(-l*n),h=(t-l)*(n*n);return c*h});const a=5/n,u=Yfe(i,o,a);if(n=ml(n),isNaN(u))return{stiffness:$r.stiffness,damping:$r.damping,duration:n};{const l=Math.pow(u,2)*r;return{stiffness:l,damping:s*2*Math.sqrt(r*l),duration:n}}}const qfe=12;function Yfe(n,e,t){let r=t;for(let i=1;i<qfe;i++)r=r-n(r)/e(r);return r}function gI(n,e){return n*Math.sqrt(1-e*e)}const Kfe=["duration","bounce"],Zfe=["stiffness","damping","mass"];function uU(n,e){return e.some(t=>n[t]!==void 0)}function Qfe(n){let e={velocity:$r.velocity,stiffness:$r.stiffness,damping:$r.damping,mass:$r.mass,isResolvedFromDuration:!1,...n};if(!uU(n,Zfe)&&uU(n,Kfe))if(n.visualDuration){const t=n.visualDuration,r=2*Math.PI/(t*1.2),i=r*r,o=2*wc(.05,1,1-(n.bounce||0))*Math.sqrt(i);e={...e,mass:$r.mass,stiffness:i,damping:o}}else{const t=Xfe(n);e={...e,...t,mass:$r.mass},e.isResolvedFromDuration=!0}return e}function Vb(n=$r.visualDuration,e=$r.bounce){const t=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:r,restDelta:i}=t;const o=t.keyframes[0],s=t.keyframes[t.keyframes.length-1],a={done:!1,value:o},{stiffness:u,damping:l,mass:c,duration:h,velocity:f,isResolvedFromDuration:d}=Qfe({...t,velocity:-Ba(t.velocity||0)}),p=f||0,v=l/(2*Math.sqrt(u*c)),g=s-o,m=Ba(Math.sqrt(u/c)),x=Math.abs(g)<5;r||(r=x?$r.restSpeed.granular:$r.restSpeed.default),i||(i=x?$r.restDelta.granular:$r.restDelta.default);let _;if(v<1){const S=gI(m,v);_=E=>{const C=Math.exp(-v*m*E);return s-C*((p+v*m*g)/S*Math.sin(S*E)+g*Math.cos(S*E))}}else if(v===1)_=S=>s-Math.exp(-m*S)*(g+(p+m*g)*S);else{const S=m*Math.sqrt(v*v-1);_=E=>{const C=Math.exp(-v*m*E),R=Math.min(S*E,300);return s-C*((p+v*m*g)*Math.sinh(R)+S*g*Math.cosh(R))/S}}const b={calculatedDuration:d&&h||null,next:S=>{const E=_(S);if(d)a.done=S>=h;else{let C=S===0?p:0;v<1&&(C=S===0?ml(p):R$(_,S,E));const R=Math.abs(C)<=r,T=Math.abs(s-E)<=i;a.done=R&&T}return a.value=a.done?s:E,a},toString:()=>{const S=Math.min(nD(b),zb),E=T$(C=>b.next(S*C).value,S,30);return S+"ms "+E},toTransition:()=>{}};return b}Vb.applyToOptions=n=>{const e=$fe(n,100,Vb);return n.ease=e.ease,n.duration=ml(e.duration),n.type="keyframes",n};function yI({keyframes:n,velocity:e=0,power:t=.8,timeConstant:r=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:s,min:a,max:u,restDelta:l=.5,restSpeed:c}){const h=n[0],f={done:!1,value:h},d=R=>a!==void 0&&R<a||u!==void 0&&R>u,p=R=>a===void 0?u:u===void 0||Math.abs(a-R)<Math.abs(u-R)?a:u;let v=t*e;const g=h+v,m=s===void 0?g:s(g);m!==g&&(v=m-h);const x=R=>-v*Math.exp(-R/r),_=R=>m+x(R),b=R=>{const T=x(R),A=_(R);f.done=Math.abs(T)<=l,f.value=f.done?m:A};let S,E;const C=R=>{d(f.value)&&(S=R,E=Vb({keyframes:[f.value,p(f.value)],velocity:R$(_,R,f.value),damping:i,stiffness:o,restDelta:l,restSpeed:c}))};return C(0),{calculatedDuration:null,next:R=>{let T=!1;return!E&&S===void 0&&(T=!0,b(R),C(R)),S!==void 0&&R>=S?E.next(R-S):(!T&&b(R),f)}}}function Jfe(n,e,t){const r=[],i=t||_c.mix||M$,o=n.length-1;for(let s=0;s<o;s++){let a=i(n[s],n[s+1]);if(e){const u=Array.isArray(e)?e[s]||Wa:e;a=q1(u,a)}r.push(a)}return r}function A$(n,e,{clamp:t=!0,ease:r,mixer:i}={}){const o=n.length;if(Xk(o===e.length),o===1)return()=>e[0];if(o===2&&e[0]===e[1])return()=>e[1];const s=n[0]===n[1];n[0]>n[o-1]&&(n=[...n].reverse(),e=[...e].reverse());const a=Jfe(e,r,i),u=a.length,l=c=>{if(s&&c<n[0])return e[0];let h=0;if(u>1)for(;h<n.length-2&&!(c<n[h+1]);h++);const f=p1(n[h],n[h+1],c);return a[h](f)};return t?c=>l(wc(n[0],n[o-1],c)):l}function ede(n,e){const t=n[n.length-1];for(let r=1;r<=e;r++){const i=p1(0,e,r);n.push(kr(t,1,i))}}function tde(n){const e=[0];return ede(e,n.length-1),e}function nde(n,e){return n.map(t=>t*e)}function rde(n,e){return n.map(()=>e||m$).splice(0,n.length-1)}function cy({duration:n=300,keyframes:e,times:t,ease:r="easeInOut"}){const i=mfe(r)?r.map(rU):rU(r),o={done:!1,value:e[0]},s=nde(t&&t.length===e.length?t:tde(e),n),a=A$(s,e,{ease:Array.isArray(i)?i:rde(e,i)});return{calculatedDuration:n,next:u=>(o.value=a(u),o.done=u>=n,o)}}const ide=n=>n!==null;function rD(n,{repeat:e,repeatType:t="loop"},r,i=1){const o=n.filter(ide),a=i<0||e&&t!=="loop"&&e%2===1?0:o.length-1;return!a||r===void 0?o[a]:r}const ode={decay:yI,inertia:yI,tween:cy,keyframes:cy,spring:Vb};function I$(n){typeof n.type=="string"&&(n.type=ode[n.type])}class iD{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const sde=n=>n/100;class PE extends iD{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var r,i;const{motionValue:t}=this.options;t&&t.updatedAt!==gs.now()&&this.tick(gs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(i=(r=this.options).onStop)==null||i.call(r))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;I$(e);const{type:t=cy,repeat:r=0,repeatDelay:i=0,repeatType:o,velocity:s=0}=e;let{keyframes:a}=e;const u=t||cy;u!==cy&&typeof a[0]!="number"&&(this.mixKeyframes=q1(sde,M$(a[0],a[1])),a=[0,100]);const l=u({...e,keyframes:a});o==="mirror"&&(this.mirroredGenerator=u({...e,keyframes:[...a].reverse(),velocity:-s})),l.calculatedDuration===null&&(l.calculatedDuration=nD(l));const{calculatedDuration:c}=l;this.calculatedDuration=c,this.resolvedDuration=c+i,this.totalDuration=this.resolvedDuration*(r+1)-i,this.generator=l}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:r,totalDuration:i,mixKeyframes:o,mirroredGenerator:s,resolvedDuration:a,calculatedDuration:u}=this;if(this.startTime===null)return r.next(0);const{delay:l=0,keyframes:c,repeat:h,repeatType:f,repeatDelay:d,type:p,onUpdate:v,finalKeyframe:g}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const m=this.currentTime-l*(this.playbackSpeed>=0?1:-1),x=this.playbackSpeed>=0?m<0:m>i;this.currentTime=Math.max(m,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let _=this.currentTime,b=r;if(h){const R=Math.min(this.currentTime,i)/a;let T=Math.floor(R),A=R%1;!A&&R>=1&&(A=1),A===1&&T--,T=Math.min(T,h+1),!!(T%2)&&(f==="reverse"?(A=1-A,d&&(A-=d/a)):f==="mirror"&&(b=s)),_=wc(0,1,A)*a}const S=x?{done:!1,value:c[0]}:b.next(_);o&&(S.value=o(S.value));let{done:E}=S;!x&&u!==null&&(E=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const C=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&E);return C&&p!==yI&&(S.value=rD(c,this.options,g,this.speed)),v&&v(S.value),C&&this.finish(),S}then(e,t){return this.finished.then(e,t)}get duration(){return Ba(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ba(e)}get time(){return Ba(this.currentTime)}set time(e){var t;e=ml(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(t=this.driver)==null||t.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(gs.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ba(this.currentTime))}play(){var i,o;if(this.isStopped)return;const{driver:e=Gfe,startTime:t}=this.options;this.driver||(this.driver=e(s=>this.tick(s))),(o=(i=this.options).onPlay)==null||o.call(i);const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=t??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(gs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,t;this.notifyFinished(),this.teardown(),this.state="finished",(t=(e=this.options).onComplete)==null||t.call(e)}cancel(){var e,t;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(t=(e=this.options).onCancel)==null||t.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var t;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(t=this.driver)==null||t.stop(),e.observe(this)}}function ade(n){for(let e=1;e<n.length;e++)n[e]??(n[e]=n[e-1])}const md=n=>n*180/Math.PI,xI=n=>{const e=md(Math.atan2(n[1],n[0]));return wI(e)},ude={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:n=>(Math.abs(n[0])+Math.abs(n[3]))/2,rotate:xI,rotateZ:xI,skewX:n=>md(Math.atan(n[1])),skewY:n=>md(Math.atan(n[2])),skew:n=>(Math.abs(n[1])+Math.abs(n[2]))/2},wI=n=>(n=n%360,n<0&&(n+=360),n),lU=xI,cU=n=>Math.sqrt(n[0]*n[0]+n[1]*n[1]),hU=n=>Math.sqrt(n[4]*n[4]+n[5]*n[5]),lde={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:cU,scaleY:hU,scale:n=>(cU(n)+hU(n))/2,rotateX:n=>wI(md(Math.atan2(n[6],n[5]))),rotateY:n=>wI(md(Math.atan2(-n[2],n[0]))),rotateZ:lU,rotate:lU,skewX:n=>md(Math.atan(n[4])),skewY:n=>md(Math.atan(n[1])),skew:n=>(Math.abs(n[1])+Math.abs(n[4]))/2};function _I(n){return n.includes("scale")?1:0}function bI(n,e){if(!n||n==="none")return _I(e);const t=n.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,i;if(t)r=lde,i=t;else{const a=n.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=ude,i=a}if(!i)return _I(e);const o=r[e],s=i[1].split(",").map(hde);return typeof o=="function"?o(s):s[o]}const cde=(n,e)=>{const{transform:t="none"}=getComputedStyle(n);return bI(t,e)};function hde(n){return parseFloat(n.trim())}const mg=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],vg=new Set(mg),fU=n=>n===pg||n===Kt,fde=new Set(["x","y","z"]),dde=mg.filter(n=>!fde.has(n));function pde(n){const e=[];return dde.forEach(t=>{const r=n.getValue(t);r!==void 0&&(e.push([t,r.get()]),r.set(t.startsWith("scale")?1:0))}),e}const Dd={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:(n,{transform:e})=>bI(e,"x"),y:(n,{transform:e})=>bI(e,"y")};Dd.translateX=Dd.x;Dd.translateY=Dd.y;const Nd=new Set;let SI=!1,EI=!1,CI=!1;function P$(){if(EI){const n=Array.from(Nd).filter(r=>r.needsMeasurement),e=new Set(n.map(r=>r.element)),t=new Map;e.forEach(r=>{const i=pde(r);i.length&&(t.set(r,i),r.render())}),n.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const i=t.get(r);i&&i.forEach(([o,s])=>{var a;(a=r.getValue(o))==null||a.set(s)})}),n.forEach(r=>r.measureEndState()),n.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}EI=!1,SI=!1,Nd.forEach(n=>n.complete(CI)),Nd.clear()}function k$(){Nd.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(EI=!0)})}function mde(){CI=!0,k$(),P$(),CI=!1}class oD{constructor(e,t,r,i,o,s=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=r,this.motionValue=i,this.element=o,this.isAsync=s}scheduleResolve(){this.state="scheduled",this.isAsync?(Nd.add(this),SI||(SI=!0,fr.read(k$),fr.resolveKeyframes(P$))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:r,motionValue:i}=this;if(e[0]===null){const o=i==null?void 0:i.get(),s=e[e.length-1];if(o!==void 0)e[0]=o;else if(r&&t){const a=r.readValue(t,s);a!=null&&(e[0]=a)}e[0]===void 0&&(e[0]=s),i&&o===void 0&&i.set(e[0])}ade(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),Nd.delete(this)}cancel(){this.state==="scheduled"&&(Nd.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const vde=n=>n.startsWith("--");function gde(n,e,t){vde(e)?n.style.setProperty(e,t):n.style[e]=t}const yde=qk(()=>window.ScrollTimeline!==void 0),xde={};function wde(n,e){const t=qk(n);return()=>xde[e]??t()}const D$=wde(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),N0=([n,e,t,r])=>`cubic-bezier(${n}, ${e}, ${t}, ${r})`,dU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:N0([0,.65,.55,1]),circOut:N0([.55,0,1,.45]),backIn:N0([.31,.01,.66,-.59]),backOut:N0([.33,1.53,.69,.99])};function N$(n,e){if(n)return typeof n=="function"?D$()?T$(n,e):"ease-out":v$(n)?N0(n):Array.isArray(n)?n.map(t=>N$(t,e)||dU.easeOut):dU[n]}function _de(n,e,t,{delay:r=0,duration:i=300,repeat:o=0,repeatType:s="loop",ease:a="easeOut",times:u}={},l=void 0){const c={[e]:t};u&&(c.offset=u);const h=N$(a,i);Array.isArray(h)&&(c.easing=h);const f={delay:r,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:s==="reverse"?"alternate":"normal"};return l&&(f.pseudoElement=l),n.animate(c,f)}function L$(n){return typeof n=="function"&&"applyToOptions"in n}function bde({type:n,...e}){return L$(n)&&D$()?n.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class Sde extends iD{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:r,keyframes:i,pseudoElement:o,allowFlatten:s=!1,finalKeyframe:a,onComplete:u}=e;this.isPseudoElement=!!o,this.allowFlatten=s,this.options=e,Xk(typeof e.type!="string");const l=bde(e);this.animation=_de(t,r,i,l,o),l.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const c=rD(i,this.options,a,this.speed);this.updateMotionValue?this.updateMotionValue(c):gde(t,r,c),this.animation.cancel()}u==null||u(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,t;(t=(e=this.animation).finish)==null||t.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,t;this.isPseudoElement||(t=(e=this.animation).commitStyles)==null||t.call(e)}get duration(){var t,r;const e=((r=(t=this.animation.effect)==null?void 0:t.getComputedTiming)==null?void 0:r.call(t).duration)||0;return Ba(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ba(e)}get time(){return Ba(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=ml(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){var r;return this.allowFlatten&&((r=this.animation.effect)==null||r.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&yde()?(this.animation.timeline=e,Wa):t(this)}}const F$={anticipate:f$,backInOut:h$,circInOut:p$};function Ede(n){return n in F$}function Cde(n){typeof n.ease=="string"&&Ede(n.ease)&&(n.ease=F$[n.ease])}const pU=10;class Mde extends Sde{constructor(e){Cde(e),I$(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:r,onComplete:i,element:o,...s}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const a=new PE({...s,autoplay:!1}),u=ml(this.finishedTime??this.time);t.setWithVelocity(a.sample(u-pU).value,a.sample(u).value,pU),a.stop()}}const mU=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Yh.test(n)||n==="0")&&!n.startsWith("url("));function Tde(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function Rde(n,e,t,r){const i=n[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const o=n[n.length-1],s=mU(i,e),a=mU(o,e);return!s||!a?!1:Tde(n)||(t==="spring"||L$(t))&&r}function MI(n){n.duration=0,n.type="keyframes"}const Ade=new Set(["opacity","clipPath","filter","transform"]),Ide=qk(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Pde(n){var c;const{motionValue:e,name:t,repeatDelay:r,repeatType:i,damping:o,type:s}=n;if(!(((c=e==null?void 0:e.owner)==null?void 0:c.current)instanceof HTMLElement))return!1;const{onUpdate:u,transformTemplate:l}=e.owner.getProps();return Ide()&&t&&Ade.has(t)&&(t!=="transform"||!l)&&!u&&!r&&i!=="mirror"&&o!==0&&s!=="inertia"}const kde=40;class Dde extends iD{constructor({autoplay:e=!0,delay:t=0,type:r="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:s="loop",keyframes:a,name:u,motionValue:l,element:c,...h}){var p;super(),this.stop=()=>{var v,g;this._animation&&(this._animation.stop(),(v=this.stopTimeline)==null||v.call(this)),(g=this.keyframeResolver)==null||g.cancel()},this.createdAt=gs.now();const f={autoplay:e,delay:t,type:r,repeat:i,repeatDelay:o,repeatType:s,name:u,motionValue:l,element:c,...h},d=(c==null?void 0:c.KeyframeResolver)||oD;this.keyframeResolver=new d(a,(v,g,m)=>this.onKeyframesResolved(v,g,f,!m),u,l,c),(p=this.keyframeResolver)==null||p.scheduleResolve()}onKeyframesResolved(e,t,r,i){this.keyframeResolver=void 0;const{name:o,type:s,velocity:a,delay:u,isHandoff:l,onUpdate:c}=r;this.resolvedAt=gs.now(),Rde(e,o,s,a)||((_c.instantAnimations||!u)&&(c==null||c(rD(e,r,t))),e[0]=e[e.length-1],MI(r),r.repeat=0);const f={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>kde?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...r,keyframes:e},d=!l&&Pde(f)?new Mde({...f,element:f.motionValue.owner.current}):new PE(f);d.finished.then(()=>this.notifyFinished()).catch(Wa),this.pendingTimeline&&(this.stopTimeline=d.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=d}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),mde()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const Nde=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Lde(n){const e=Nde.exec(n);if(!e)return[,];const[,t,r,i]=e;return[`--${t??r}`,i]}function O$(n,e,t=1){const[r,i]=Lde(n);if(!r)return;const o=window.getComputedStyle(e).getPropertyValue(r);if(o){const s=o.trim();return r$(s)?parseFloat(s):s}return Qk(i)?O$(i,e,t+1):i}function sD(n,e){return(n==null?void 0:n[e])??(n==null?void 0:n.default)??n}const B$=new Set(["width","height","top","left","right","bottom",...mg]),Fde={test:n=>n==="auto",parse:n=>n},U$=n=>e=>e.test(n),z$=[pg,Kt,vl,th,Rfe,Tfe,Fde],vU=n=>z$.find(U$(n));function Ode(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||o$(n):!0}const Bde=new Set(["brightness","contrast","saturate","opacity"]);function Ude(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[r]=t.match(Jk)||[];if(!r)return n;const i=t.replace(r,"");let o=Bde.has(e)?1:0;return r!==t&&(o*=100),e+"("+o+i+")"}const zde=/\b([a-z-]*)\(.*?\)/gu,TI={...Yh,getAnimatableNone:n=>{const e=n.match(zde);return e?e.map(Ude).join(" "):n}},gU={...pg,transform:Math.round},Vde={rotate:th,rotateX:th,rotateY:th,rotateZ:th,scale:zw,scaleX:zw,scaleY:zw,scaleZ:zw,skew:th,skewX:th,skewY:th,distance:Kt,translateX:Kt,translateY:Kt,translateZ:Kt,x:Kt,y:Kt,z:Kt,perspective:Kt,transformPerspective:Kt,opacity:m1,originX:iU,originY:iU,originZ:Kt},aD={borderWidth:Kt,borderTopWidth:Kt,borderRightWidth:Kt,borderBottomWidth:Kt,borderLeftWidth:Kt,borderRadius:Kt,radius:Kt,borderTopLeftRadius:Kt,borderTopRightRadius:Kt,borderBottomRightRadius:Kt,borderBottomLeftRadius:Kt,width:Kt,maxWidth:Kt,height:Kt,maxHeight:Kt,top:Kt,right:Kt,bottom:Kt,left:Kt,padding:Kt,paddingTop:Kt,paddingRight:Kt,paddingBottom:Kt,paddingLeft:Kt,margin:Kt,marginTop:Kt,marginRight:Kt,marginBottom:Kt,marginLeft:Kt,backgroundPositionX:Kt,backgroundPositionY:Kt,...Vde,zIndex:gU,fillOpacity:m1,strokeOpacity:m1,numOctaves:gU},Wde={...aD,color:ci,backgroundColor:ci,outlineColor:ci,fill:ci,stroke:ci,borderColor:ci,borderTopColor:ci,borderRightColor:ci,borderBottomColor:ci,borderLeftColor:ci,filter:TI,WebkitFilter:TI},V$=n=>Wde[n];function W$(n,e){let t=V$(n);return t!==TI&&(t=Yh),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const Hde=new Set(["auto","none","0"]);function Gde(n,e,t){let r=0,i;for(;r<n.length&&!i;){const o=n[r];typeof o=="string"&&!Hde.has(o)&&v1(o).values.length&&(i=n[r]),r++}if(i&&t)for(const o of e)n[o]=W$(t,i)}class $de extends oD{constructor(e,t,r,i,o){super(e,t,r,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:r}=this;if(!t||!t.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let l=e[u];if(typeof l=="string"&&(l=l.trim(),Qk(l))){const c=O$(l,t.current);c!==void 0&&(e[u]=c),u===e.length-1&&(this.finalKeyframe=l)}}if(this.resolveNoneKeyframes(),!B$.has(r)||e.length!==2)return;const[i,o]=e,s=vU(i),a=vU(o);if(s!==a)if(fU(s)&&fU(a))for(let u=0;u<e.length;u++){const l=e[u];typeof l=="string"&&(e[u]=parseFloat(l))}else Dd[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,r=[];for(let i=0;i<e.length;i++)(e[i]===null||Ode(e[i]))&&r.push(i);r.length&&Gde(e,r,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Dd[r](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(r,i).jump(i,!1)}measureEndState(){var a;const{element:e,name:t,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const o=r.length-1,s=r[o];r[o]=Dd[t](e.measureViewportBox(),window.getComputedStyle(e.current)),s!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=s),(a=this.removedTransforms)!=null&&a.length&&this.removedTransforms.forEach(([u,l])=>{e.getValue(u).set(l)}),this.resolveNoneKeyframes()}}function jde(n,e,t){if(n instanceof EventTarget)return[n];if(typeof n=="string"){let r=document;const i=(t==null?void 0:t[n])??r.querySelectorAll(n);return i?Array.from(i):[]}return Array.from(n)}const H$=(n,e)=>e&&typeof n=="number"?e.transform(n):n;function G$(n){return i$(n)&&"offsetHeight"in n}const yU=30,Xde=n=>!isNaN(parseFloat(n)),hy={current:void 0};class qde{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{var o;const i=gs.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&((o=this.events.change)==null||o.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=gs.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Xde(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Yk);const r=this.events[e].add(t);return e==="change"?()=>{r(),fr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,r){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return hy.current&&hy.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=gs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>yU)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,yU);return s$(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,t;(e=this.dependents)==null||e.clear(),(t=this.events.destroy)==null||t.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Kd(n,e){return new qde(n,e)}const{schedule:uD}=g$(queueMicrotask,!1),au={x:!1,y:!1};function $$(){return au.x||au.y}function Yde(n){return n==="x"||n==="y"?au[n]?null:(au[n]=!0,()=>{au[n]=!1}):au.x||au.y?null:(au.x=au.y=!0,()=>{au.x=au.y=!1})}function j$(n,e){const t=jde(n),r=new AbortController,i={passive:!0,...e,signal:r.signal};return[t,i,()=>r.abort()]}function xU(n){return!(n.pointerType==="touch"||$$())}function Kde(n,e,t={}){const[r,i,o]=j$(n,t),s=a=>{if(!xU(a))return;const{target:u}=a,l=e(u,a);if(typeof l!="function"||!u)return;const c=h=>{xU(h)&&(l(h),u.removeEventListener("pointerleave",c))};u.addEventListener("pointerleave",c,i)};return r.forEach(a=>{a.addEventListener("pointerenter",s,i)}),o}const X$=(n,e)=>e?n===e?!0:X$(n,e.parentElement):!1,lD=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,Zde=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Qde(n){return Zde.has(n.tagName)||n.tabIndex!==-1}const G_=new WeakSet;function wU(n){return e=>{e.key==="Enter"&&n(e)}}function zM(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Jde=(n,e)=>{const t=n.currentTarget;if(!t)return;const r=wU(()=>{if(G_.has(t))return;zM(t,"down");const i=wU(()=>{zM(t,"up")}),o=()=>zM(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",o,e)});t.addEventListener("keydown",r,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",r),e)};function _U(n){return lD(n)&&!$$()}function epe(n,e,t={}){const[r,i,o]=j$(n,t),s=a=>{const u=a.currentTarget;if(!_U(a))return;G_.add(u);const l=e(u,a),c=(d,p)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",f),G_.has(u)&&G_.delete(u),_U(d)&&typeof l=="function"&&l(d,{success:p})},h=d=>{c(d,u===window||u===document||t.useGlobalTarget||X$(u,d.target))},f=d=>{c(d,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",f,i)};return r.forEach(a=>{(t.useGlobalTarget?window:a).addEventListener("pointerdown",s,i),G$(a)&&(a.addEventListener("focus",l=>Jde(l,i)),!Qde(a)&&!a.hasAttribute("tabindex")&&(a.tabIndex=0))}),o}function q$(n){return i$(n)&&"ownerSVGElement"in n}function tpe(n){return q$(n)&&n.tagName==="svg"}function npe(...n){const e=!Array.isArray(n[0]),t=e?0:-1,r=n[0+t],i=n[1+t],o=n[2+t],s=n[3+t],a=A$(i,o,s);return e?a(r):a}const zi=n=>!!(n&&n.getVelocity);function rpe(n,e,t){const r=n.get();let i=null,o=r,s;const a=typeof r=="string"?r.replace(/[\d.-]/g,""):void 0,u=()=>{i&&(i.stop(),i=null)},l=()=>{u(),i=new PE({keyframes:[SU(n.get()),SU(o)],velocity:n.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...t,onUpdate:s})};if(n.attach((c,h)=>{o=c,s=f=>h(bU(f,a)),fr.postRender(l)},u),zi(e)){const c=e.on("change",f=>n.set(bU(f,a))),h=n.on("destroy",c);return()=>{c(),h()}}return u}function bU(n,e){return e?n+e:n}function SU(n){return typeof n=="number"?n:parseFloat(n)}const ipe=[...z$,ci,Yh],ope=n=>ipe.find(U$(n)),Z1=H.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});function EU(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function spe(...n){return e=>{let t=!1;const r=n.map(i=>{const o=EU(i,e);return!t&&typeof o=="function"&&(t=!0),o});if(t)return()=>{for(let i=0;i<r.length;i++){const o=r[i];typeof o=="function"?o():EU(n[i],null)}}}}function ape(...n){return H.useCallback(spe(...n),n)}class upe extends H.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const r=t.offsetParent,i=G$(r)&&r.offsetWidth||0,o=this.props.sizeRef.current;o.height=t.offsetHeight||0,o.width=t.offsetWidth||0,o.top=t.offsetTop,o.left=t.offsetLeft,o.right=i-o.width-o.left}return null}componentDidUpdate(){}render(){return this.props.children}}function lpe({children:n,isPresent:e,anchorX:t,root:r}){const i=H.useId(),o=H.useRef(null),s=H.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=H.useContext(Z1),u=ape(o,n==null?void 0:n.ref);return H.useInsertionEffect(()=>{const{width:l,height:c,top:h,left:f,right:d}=s.current;if(e||!o.current||!l||!c)return;const p=t==="left"?`left: ${f}`:`right: ${d}`;o.current.dataset.motionPopId=i;const v=document.createElement("style");a&&(v.nonce=a);const g=r??document.head;return g.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${c}px !important;
            ${p}px !important;
            top: ${h}px !important;
          }
        `),()=>{g.contains(v)&&g.removeChild(v)}},[e]),G.jsx(upe,{isPresent:e,childRef:o,sizeRef:s,children:H.cloneElement(n,{ref:u})})}const cpe=({children:n,initial:e,isPresent:t,onExitComplete:r,custom:i,presenceAffectsLayout:o,mode:s,anchorX:a,root:u})=>{const l=X1(hpe),c=H.useId();let h=!0,f=H.useMemo(()=>(h=!1,{id:c,initial:e,isPresent:t,custom:i,onExitComplete:d=>{l.set(d,!0);for(const p of l.values())if(!p)return;r&&r()},register:d=>(l.set(d,!1),()=>l.delete(d))}),[t,l,r]);return o&&h&&(f={...f}),H.useMemo(()=>{l.forEach((d,p)=>l.set(p,!1))},[t]),H.useEffect(()=>{!t&&!l.size&&r&&r()},[t]),s==="popLayout"&&(n=G.jsx(lpe,{isPresent:t,anchorX:a,root:u,children:n})),G.jsx(IE.Provider,{value:f,children:n})};function hpe(){return new Map}function Y$(n=!0){const e=H.useContext(IE);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:i}=e,o=H.useId();H.useEffect(()=>{if(n)return i(o)},[n]);const s=H.useCallback(()=>n&&r&&r(o),[o,r,n]);return!t&&r?[!1,s]:[!0]}const Vw=n=>n.key||"";function CU(n){const e=[];return H.Children.forEach(n,t=>{H.isValidElement(t)&&e.push(t)}),e}const fpe=({children:n,custom:e,initial:t=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:o="sync",propagate:s=!1,anchorX:a="left",root:u})=>{const[l,c]=Y$(s),h=H.useMemo(()=>CU(n),[n]),f=s&&!l?[]:h.map(Vw),d=H.useRef(!0),p=H.useRef(h),v=X1(()=>new Map),[g,m]=H.useState(h),[x,_]=H.useState(h);Gk(()=>{d.current=!1,p.current=h;for(let E=0;E<x.length;E++){const C=Vw(x[E]);f.includes(C)?v.delete(C):v.get(C)!==!0&&v.set(C,!1)}},[x,f.length,f.join("-")]);const b=[];if(h!==g){let E=[...h];for(let C=0;C<x.length;C++){const R=x[C],T=Vw(R);f.includes(T)||(E.splice(C,0,R),b.push(R))}return o==="wait"&&b.length&&(E=b),_(CU(E)),m(h),null}const{forceRender:S}=H.useContext(Wk);return G.jsx(G.Fragment,{children:x.map(E=>{const C=Vw(E),R=s&&!l?!1:h===x||f.includes(C),T=()=>{if(v.has(C))v.set(C,!0);else return;let A=!0;v.forEach(P=>{P||(A=!1)}),A&&(S==null||S(),_(p.current),s&&(c==null||c()),r&&r())};return G.jsx(cpe,{isPresent:R,initial:!d.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:o,root:u,onExitComplete:R?void 0:T,anchorX:a,children:E},C)})})},K$=H.createContext({strict:!1}),MU={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$v={};for(const n in MU)$v[n]={isEnabled:e=>MU[n].some(t=>!!e[t])};function dpe(n){for(const e in n)$v[e]={...$v[e],...n[e]}}const ppe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Wb(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||ppe.has(n)}let Z$=n=>!Wb(n);function mpe(n){typeof n=="function"&&(Z$=e=>e.startsWith("on")?!Wb(e):n(e))}try{mpe(require("@emotion/is-prop-valid").default)}catch{}function vpe(n,e,t){const r={};for(const i in n)i==="values"&&typeof n.values=="object"||(Z$(i)||t===!0&&Wb(i)||!e&&!Wb(i)||n.draggable&&i.startsWith("onDrag"))&&(r[i]=n[i]);return r}const kE=H.createContext({});function DE(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}function g1(n){return typeof n=="string"||Array.isArray(n)}const cD=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],hD=["initial",...cD];function NE(n){return DE(n.animate)||hD.some(e=>g1(n[e]))}function Q$(n){return!!(NE(n)||n.variants)}function gpe(n,e){if(NE(n)){const{initial:t,animate:r}=n;return{initial:t===!1||g1(t)?t:void 0,animate:g1(r)?r:void 0}}return n.inherit!==!1?e:{}}function ype(n){const{initial:e,animate:t}=gpe(n,H.useContext(kE));return H.useMemo(()=>({initial:e,animate:t}),[TU(e),TU(t)])}function TU(n){return Array.isArray(n)?n.join(" "):n}function RU(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const c0={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Kt.test(n))n=parseFloat(n);else return n;const t=RU(n,e.target.x),r=RU(n,e.target.y);return`${t}% ${r}%`}},xpe={correct:(n,{treeScale:e,projectionDelta:t})=>{const r=n,i=Yh.parse(n);if(i.length>5)return r;const o=Yh.createTransformer(n),s=typeof i[0]!="number"?1:0,a=t.x.scale*e.x,u=t.y.scale*e.y;i[0+s]/=a,i[1+s]/=u;const l=kr(a,u,.5);return typeof i[2+s]=="number"&&(i[2+s]/=l),typeof i[3+s]=="number"&&(i[3+s]/=l),o(i)}},RI={borderRadius:{...c0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:c0,borderTopRightRadius:c0,borderBottomLeftRadius:c0,borderBottomRightRadius:c0,boxShadow:xpe};function J$(n,{layout:e,layoutId:t}){return vg.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!RI[n]||n==="opacity")}const wpe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_pe=mg.length;function bpe(n,e,t){let r="",i=!0;for(let o=0;o<_pe;o++){const s=mg[o],a=n[s];if(a===void 0)continue;let u=!0;if(typeof a=="number"?u=a===(s.startsWith("scale")?1:0):u=parseFloat(a)===0,!u||t){const l=H$(a,aD[s]);if(!u){i=!1;const c=wpe[s]||s;r+=`${c}(${l}) `}t&&(e[s]=l)}}return r=r.trim(),t?r=t(e,i?"":r):i&&(r="none"),r}function fD(n,e,t){const{style:r,vars:i,transformOrigin:o}=n;let s=!1,a=!1;for(const u in e){const l=e[u];if(vg.has(u)){s=!0;continue}else if(x$(u)){i[u]=l;continue}else{const c=H$(l,aD[u]);u.startsWith("origin")?(a=!0,o[u]=c):r[u]=c}}if(e.transform||(s||t?r.transform=bpe(e,n.transform,t):r.transform&&(r.transform="none")),a){const{originX:u="50%",originY:l="50%",originZ:c=0}=o;r.transformOrigin=`${u} ${l} ${c}`}}const dD=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function ej(n,e,t){for(const r in e)!zi(e[r])&&!J$(r,t)&&(n[r]=e[r])}function Spe({transformTemplate:n},e){return H.useMemo(()=>{const t=dD();return fD(t,e,n),Object.assign({},t.vars,t.style)},[e])}function Epe(n,e){const t=n.style||{},r={};return ej(r,t,n),Object.assign(r,Spe(n,e)),r}function Cpe(n,e){const t={},r=Epe(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=r,t}const Mpe={offset:"stroke-dashoffset",array:"stroke-dasharray"},Tpe={offset:"strokeDashoffset",array:"strokeDasharray"};function Rpe(n,e,t=1,r=0,i=!0){n.pathLength=1;const o=i?Mpe:Tpe;n[o.offset]=Kt.transform(-r);const s=Kt.transform(e),a=Kt.transform(t);n[o.array]=`${s} ${a}`}function tj(n,{attrX:e,attrY:t,attrScale:r,pathLength:i,pathSpacing:o=1,pathOffset:s=0,...a},u,l,c){if(fD(n,a,l),u){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:h,style:f}=n;h.transform&&(f.transform=h.transform,delete h.transform),(f.transform||h.transformOrigin)&&(f.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),f.transform&&(f.transformBox=(c==null?void 0:c.transformBox)??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),r!==void 0&&(h.scale=r),i!==void 0&&Rpe(h,i,o,s,!1)}const nj=()=>({...dD(),attrs:{}}),rj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Ape(n,e,t,r){const i=H.useMemo(()=>{const o=nj();return tj(o,e,rj(r),n.transformTemplate,n.style),{...o.attrs,style:{...o.style}}},[e]);if(n.style){const o={};ej(o,n.style,n),i.style={...o,...i.style}}return i}const Ipe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function pD(n){return typeof n!="string"||n.includes("-")?!1:!!(Ipe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Ppe(n,e,t,{latestValues:r},i,o=!1){const a=(pD(n)?Ape:Cpe)(e,r,i,n),u=vpe(e,typeof n=="string",o),l=n!==H.Fragment?{...u,...a,ref:t}:{},{children:c}=e,h=H.useMemo(()=>zi(c)?c.get():c,[c]);return H.createElement(n,{...l,children:h})}function AU(n){const e=[{},{}];return n==null||n.values.forEach((t,r)=>{e[0][r]=t.get(),e[1][r]=t.getVelocity()}),e}function mD(n,e,t,r){if(typeof e=="function"){const[i,o]=AU(r);e=e(t!==void 0?t:n.custom,i,o)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[i,o]=AU(r);e=e(t!==void 0?t:n.custom,i,o)}return e}function $_(n){return zi(n)?n.get():n}function kpe({scrapeMotionValuesFromProps:n,createRenderState:e},t,r,i){return{latestValues:Dpe(t,r,i,n),renderState:e()}}function Dpe(n,e,t,r){const i={},o=r(n,{});for(const f in o)i[f]=$_(o[f]);let{initial:s,animate:a}=n;const u=NE(n),l=Q$(n);e&&l&&!u&&n.inherit!==!1&&(s===void 0&&(s=e.initial),a===void 0&&(a=e.animate));let c=t?t.initial===!1:!1;c=c||s===!1;const h=c?a:s;if(h&&typeof h!="boolean"&&!DE(h)){const f=Array.isArray(h)?h:[h];for(let d=0;d<f.length;d++){const p=mD(n,f[d]);if(p){const{transitionEnd:v,transition:g,...m}=p;for(const x in m){let _=m[x];if(Array.isArray(_)){const b=c?_.length-1:0;_=_[b]}_!==null&&(i[x]=_)}for(const x in v)i[x]=v[x]}}}return i}const ij=n=>(e,t)=>{const r=H.useContext(kE),i=H.useContext(IE),o=()=>kpe(n,e,r,i);return t?o():X1(o)};function vD(n,e,t){var o;const{style:r}=n,i={};for(const s in r)(zi(r[s])||e.style&&zi(e.style[s])||J$(s,n)||((o=t==null?void 0:t.getValue(s))==null?void 0:o.liveStyle)!==void 0)&&(i[s]=r[s]);return i}const Npe=ij({scrapeMotionValuesFromProps:vD,createRenderState:dD});function oj(n,e,t){const r=vD(n,e,t);for(const i in n)if(zi(n[i])||zi(e[i])){const o=mg.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;r[o]=n[i]}return r}const Lpe=ij({scrapeMotionValuesFromProps:oj,createRenderState:nj}),Fpe=Symbol.for("motionComponentSymbol");function Xm(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function Ope(n,e,t){return H.useCallback(r=>{r&&n.onMount&&n.onMount(r),e&&(r?e.mount(r):e.unmount()),t&&(typeof t=="function"?t(r):Xm(t)&&(t.current=r))},[e])}const gD=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Bpe="framerAppearId",sj="data-"+gD(Bpe),aj=H.createContext({});function Upe(n,e,t,r,i){var v,g;const{visualElement:o}=H.useContext(kE),s=H.useContext(K$),a=H.useContext(IE),u=H.useContext(Z1).reducedMotion,l=H.useRef(null);r=r||s.renderer,!l.current&&r&&(l.current=r(n,{visualState:e,parent:o,props:t,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:u}));const c=l.current,h=H.useContext(aj);c&&!c.projection&&i&&(c.type==="html"||c.type==="svg")&&zpe(l.current,t,i,h);const f=H.useRef(!1);H.useInsertionEffect(()=>{c&&f.current&&c.update(t,a)});const d=t[sj],p=H.useRef(!!d&&!((v=window.MotionHandoffIsComplete)!=null&&v.call(window,d))&&((g=window.MotionHasOptimisedAnimation)==null?void 0:g.call(window,d)));return Gk(()=>{c&&(f.current=!0,window.MotionIsMounted=!0,c.updateFeatures(),c.scheduleRenderMicrotask(),p.current&&c.animationState&&c.animationState.animateChanges())}),H.useEffect(()=>{c&&(!p.current&&c.animationState&&c.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{var m;(m=window.MotionHandoffMarkAsComplete)==null||m.call(window,d)}),p.current=!1),c.enteringChildren=void 0)}),c}function zpe(n,e,t,r){const{layoutId:i,layout:o,drag:s,dragConstraints:a,layoutScroll:u,layoutRoot:l,layoutCrossfade:c}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:uj(n.parent)),n.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!s||a&&Xm(a),visualElement:n,animationType:typeof o=="string"?o:"both",initialPromotionConfig:r,crossfade:c,layoutScroll:u,layoutRoot:l})}function uj(n){if(n)return n.options.allowProjection!==!1?n.projection:uj(n.parent)}function VM(n,{forwardMotionProps:e=!1}={},t,r){t&&dpe(t);const i=pD(n)?Lpe:Npe;function o(a,u){let l;const c={...H.useContext(Z1),...a,layoutId:Vpe(a)},{isStatic:h}=c,f=ype(a),d=i(a,h);if(!h&&Hk){Wpe();const p=Hpe(c);l=p.MeasureLayout,f.visualElement=Upe(n,d,c,r,p.ProjectionNode)}return G.jsxs(kE.Provider,{value:f,children:[l&&f.visualElement?G.jsx(l,{visualElement:f.visualElement,...c}):null,Ppe(n,a,Ope(d,f.visualElement,u),d,h,e)]})}o.displayName=`motion.${typeof n=="string"?n:`create(${n.displayName??n.name??""})`}`;const s=H.forwardRef(o);return s[Fpe]=n,s}function Vpe({layoutId:n}){const e=H.useContext(Wk).id;return e&&n!==void 0?e+"-"+n:n}function Wpe(n,e){H.useContext(K$).strict}function Hpe(n){const{drag:e,layout:t}=$v;if(!e&&!t)return{};const r={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(n)||t!=null&&t.isEnabled(n)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function Gpe(n,e){if(typeof Proxy>"u")return VM;const t=new Map,r=(o,s)=>VM(o,s,n,e),i=(o,s)=>r(o,s);return new Proxy(i,{get:(o,s)=>s==="create"?r:(t.has(s)||t.set(s,VM(s,void 0,n,e)),t.get(s))})}function lj({top:n,left:e,right:t,bottom:r}){return{x:{min:e,max:t},y:{min:n,max:r}}}function $pe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function jpe(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),r=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:r.y,right:r.x}}function WM(n){return n===void 0||n===1}function AI({scale:n,scaleX:e,scaleY:t}){return!WM(n)||!WM(e)||!WM(t)}function Kf(n){return AI(n)||cj(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function cj(n){return IU(n.x)||IU(n.y)}function IU(n){return n&&n!=="0%"}function Hb(n,e,t){const r=n-t,i=e*r;return t+i}function PU(n,e,t,r,i){return i!==void 0&&(n=Hb(n,i,r)),Hb(n,t,r)+e}function II(n,e=0,t=1,r,i){n.min=PU(n.min,e,t,r,i),n.max=PU(n.max,e,t,r,i)}function hj(n,{x:e,y:t}){II(n.x,e.translate,e.scale,e.originPoint),II(n.y,t.translate,t.scale,t.originPoint)}const kU=.999999999999,DU=1.0000000000001;function Xpe(n,e,t,r=!1){const i=t.length;if(!i)return;e.x=e.y=1;let o,s;for(let a=0;a<i;a++){o=t[a],s=o.projectionDelta;const{visualElement:u}=o.options;u&&u.props.style&&u.props.style.display==="contents"||(r&&o.options.layoutScroll&&o.scroll&&o!==o.root&&Ym(n,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),s&&(e.x*=s.x.scale,e.y*=s.y.scale,hj(n,s)),r&&Kf(o.latestValues)&&Ym(n,o.latestValues))}e.x<DU&&e.x>kU&&(e.x=1),e.y<DU&&e.y>kU&&(e.y=1)}function qm(n,e){n.min=n.min+e,n.max=n.max+e}function NU(n,e,t,r,i=.5){const o=kr(n.min,n.max,i);II(n,e,t,o,r)}function Ym(n,e){NU(n.x,e.x,e.scaleX,e.scale,e.originX),NU(n.y,e.y,e.scaleY,e.scale,e.originY)}function fj(n,e){return lj(jpe(n.getBoundingClientRect(),e))}function qpe(n,e,t){const r=fj(n,t),{scroll:i}=e;return i&&(qm(r.x,i.offset.x),qm(r.y,i.offset.y)),r}const LU=()=>({translate:0,scale:1,origin:0,originPoint:0}),Km=()=>({x:LU(),y:LU()}),FU=()=>({min:0,max:0}),xi=()=>({x:FU(),y:FU()}),PI={current:null},dj={current:!1};function Ype(){if(dj.current=!0,!!Hk)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>PI.current=n.matches;n.addEventListener("change",e),e()}else PI.current=!1}const Kpe=new WeakMap;function Zpe(n,e,t){for(const r in e){const i=e[r],o=t[r];if(zi(i))n.addValue(r,i);else if(zi(o))n.addValue(r,Kd(i,{owner:n}));else if(o!==i)if(n.hasValue(r)){const s=n.getValue(r);s.liveStyle===!0?s.jump(i):s.hasAnimated||s.set(i)}else{const s=n.getStaticValue(r);n.addValue(r,Kd(s!==void 0?s:i,{owner:n}))}}for(const r in t)e[r]===void 0&&n.removeValue(r);return e}const OU=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Qpe{scrapeMotionValuesFromProps(e,t,r){return{}}constructor({parent:e,props:t,presenceContext:r,reducedMotionConfig:i,blockInitialAnimation:o,visualState:s},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=oD,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=gs.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,fr.render(this.render,!1,!0))};const{latestValues:u,renderState:l}=s;this.latestValues=u,this.baseTarget={...u},this.initialValues=t.initial?{...u}:{},this.renderState=l,this.parent=e,this.props=t,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=a,this.blockInitialAnimation=!!o,this.isControllingVariants=NE(t),this.isVariantNode=Q$(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const f in h){const d=h[f];u[f]!==void 0&&zi(d)&&d.set(u[f])}}mount(e){var t;this.current=e,Kpe.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,i)=>this.bindToMotionValue(i,r)),dj.current||Ype(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:PI.current,(t=this.parent)==null||t.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),bc(this.notifyUpdate),bc(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const r=this.features[t];r&&(r.unmount(),r.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=vg.has(e);r&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",s=>{this.latestValues[e]=s,this.props.onUpdate&&fr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),o&&o(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in $v){const t=$v[e];if(!t)continue;const{isEnabled:r,Feature:i}=t;if(!this.features[e]&&i&&r(this.props)&&(this.features[e]=new i(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):xi()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let r=0;r<OU.length;r++){const i=OU[r];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,s=e[o];s&&(this.propEventSubscriptions[i]=this.on(i,s))}this.prevMotionValues=Zpe(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const r=this.values.get(e);t!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&t!==void 0&&(r=Kd(t===null?void 0:t,{owner:this}),this.addValue(e,r)),r}readValue(e,t){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(r$(r)||o$(r))?r=parseFloat(r):!ope(r)&&Yh.test(t)&&(r=W$(e,t)),this.setBaseTarget(e,zi(r)?r.get():r)),zi(r)?r.get():r}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var o;const{initial:t}=this.props;let r;if(typeof t=="string"||typeof t=="object"){const s=mD(this.props,t,(o=this.presenceContext)==null?void 0:o.custom);s&&(r=s[e])}if(t&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!zi(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Yk),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){uD.render(this.render)}}class pj extends Qpe{constructor(){super(...arguments),this.KeyframeResolver=$de}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:r}){delete t[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;zi(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}function mj(n,{style:e,vars:t},r,i){const o=n.style;let s;for(s in e)o[s]=e[s];i==null||i.applyProjectionStyles(o,r);for(s in t)o.setProperty(s,t[s])}function Jpe(n){return window.getComputedStyle(n)}class eme extends pj{constructor(){super(...arguments),this.type="html",this.renderInstance=mj}readValueFromInstance(e,t){var r;if(vg.has(t))return(r=this.projection)!=null&&r.isProjecting?_I(t):cde(e,t);{const i=Jpe(e),o=(x$(t)?i.getPropertyValue(t):i[t])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(e,{transformPagePoint:t}){return fj(e,t)}build(e,t,r){fD(e,t,r.transformTemplate)}scrapeMotionValuesFromProps(e,t,r){return vD(e,t,r)}}const vj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function tme(n,e,t,r){mj(n,e,void 0,r);for(const i in e.attrs)n.setAttribute(vj.has(i)?i:gD(i),e.attrs[i])}class nme extends pj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=xi}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(vg.has(t)){const r=V$(t);return r&&r.default||0}return t=vj.has(t)?t:gD(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,r){return oj(e,t,r)}build(e,t,r){tj(e,t,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,t,r,i){tme(e,t,r,i)}mount(e){this.isSVGTag=rj(e.tagName),super.mount(e)}}const rme=(n,e)=>pD(n)?new nme(e):new eme(e,{allowProjection:n!==H.Fragment});function fv(n,e,t){const r=n.getProps();return mD(r,e,t!==void 0?t:r.custom,n)}const kI=n=>Array.isArray(n);function ime(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,Kd(t))}function ome(n){return kI(n)?n[n.length-1]||0:n}function sme(n,e){const t=fv(n,e);let{transitionEnd:r={},transition:i={},...o}=t||{};o={...o,...r};for(const s in o){const a=ome(o[s]);ime(n,s,a)}}function ame(n){return!!(zi(n)&&n.add)}function DI(n,e){const t=n.getValue("willChange");if(ame(t))return t.add(e);if(!t&&_c.WillChange){const r=new _c.WillChange("auto");n.addValue("willChange",r),r.add(e)}}function gj(n){return n.props[sj]}const ume=n=>n!==null;function lme(n,{repeat:e,repeatType:t="loop"},r){const i=n.filter(ume),o=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[o]}const cme={type:"spring",stiffness:500,damping:25,restSpeed:10},hme=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),fme={type:"keyframes",duration:.8},dme={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},pme=(n,{keyframes:e})=>e.length>2?fme:vg.has(n)?n.startsWith("scale")?hme(e[1]):cme:dme;function mme({when:n,delay:e,delayChildren:t,staggerChildren:r,staggerDirection:i,repeat:o,repeatType:s,repeatDelay:a,from:u,elapsed:l,...c}){return!!Object.keys(c).length}const yD=(n,e,t,r={},i,o)=>s=>{const a=sD(r,n)||{},u=a.delay||r.delay||0;let{elapsed:l=0}=r;l=l-ml(u);const c={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-l,onUpdate:f=>{e.set(f),a.onUpdate&&a.onUpdate(f)},onComplete:()=>{s(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:o?void 0:i};mme(a)||Object.assign(c,pme(n,c)),c.duration&&(c.duration=ml(c.duration)),c.repeatDelay&&(c.repeatDelay=ml(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let h=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(MI(c),c.delay===0&&(h=!0)),(_c.instantAnimations||_c.skipAnimations)&&(h=!0,MI(c),c.delay=0),c.allowFlatten=!a.type&&!a.ease,h&&!o&&e.get()!==void 0){const f=lme(c.keyframes,a);if(f!==void 0){fr.update(()=>{c.onUpdate(f),c.onComplete()});return}}return a.isSync?new PE(c):new Dde(c)};function vme({protectedKeys:n,needsAnimating:e},t){const r=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,r}function yj(n,e,{delay:t=0,transitionOverride:r,type:i}={}){let{transition:o=n.getDefaultTransition(),transitionEnd:s,...a}=e;r&&(o=r);const u=[],l=i&&n.animationState&&n.animationState.getState()[i];for(const c in a){const h=n.getValue(c,n.latestValues[c]??null),f=a[c];if(f===void 0||l&&vme(l,c))continue;const d={delay:t,...sD(o||{},c)},p=h.get();if(p!==void 0&&!h.isAnimating&&!Array.isArray(f)&&f===p&&!d.velocity)continue;let v=!1;if(window.MotionHandoffAnimation){const m=gj(n);if(m){const x=window.MotionHandoffAnimation(m,c,fr);x!==null&&(d.startTime=x,v=!0)}}DI(n,c),h.start(yD(c,h,f,n.shouldReduceMotion&&B$.has(c)?{type:!1}:d,n,v));const g=h.animation;g&&u.push(g)}return s&&Promise.all(u).then(()=>{fr.update(()=>{s&&sme(n,s)})}),u}function xj(n,e,t,r=0,i=1){const o=Array.from(n).sort((l,c)=>l.sortNodePosition(c)).indexOf(e),s=n.size,a=(s-1)*r;return typeof t=="function"?t(o,s):i===1?o*r:a-o*r}function NI(n,e,t={}){var u;const r=fv(n,e,t.type==="exit"?(u=n.presenceContext)==null?void 0:u.custom:void 0);let{transition:i=n.getDefaultTransition()||{}}=r||{};t.transitionOverride&&(i=t.transitionOverride);const o=r?()=>Promise.all(yj(n,r,t)):()=>Promise.resolve(),s=n.variantChildren&&n.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:h,staggerDirection:f}=i;return gme(n,e,l,c,h,f,t)}:()=>Promise.resolve(),{when:a}=i;if(a){const[l,c]=a==="beforeChildren"?[o,s]:[s,o];return l().then(()=>c())}else return Promise.all([o(),s(t.delay)])}function gme(n,e,t=0,r=0,i=0,o=1,s){const a=[];for(const u of n.variantChildren)u.notify("AnimationStart",e),a.push(NI(u,e,{...s,delay:t+(typeof r=="function"?0:r)+xj(n.variantChildren,u,r,i,o)}).then(()=>u.notify("AnimationComplete",e)));return Promise.all(a)}function yme(n,e,t={}){n.notify("AnimationStart",e);let r;if(Array.isArray(e)){const i=e.map(o=>NI(n,o,t));r=Promise.all(i)}else if(typeof e=="string")r=NI(n,e,t);else{const i=typeof e=="function"?fv(n,e,t.custom):e;r=Promise.all(yj(n,i,t))}return r.then(()=>{n.notify("AnimationComplete",e)})}function wj(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let r=0;r<t;r++)if(e[r]!==n[r])return!1;return!0}const xme=hD.length;function _j(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?_j(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<xme;t++){const r=hD[t],i=n.props[r];(g1(i)||i===!1)&&(e[r]=i)}return e}const wme=[...cD].reverse(),_me=cD.length;function bme(n){return e=>Promise.all(e.map(({animation:t,options:r})=>yme(n,t,r)))}function Sme(n){let e=bme(n),t=BU(),r=!0;const i=u=>(l,c)=>{var f;const h=fv(n,c,u==="exit"?(f=n.presenceContext)==null?void 0:f.custom:void 0);if(h){const{transition:d,transitionEnd:p,...v}=h;l={...l,...v,...p}}return l};function o(u){e=u(n)}function s(u){const{props:l}=n,c=_j(n.parent)||{},h=[],f=new Set;let d={},p=1/0;for(let g=0;g<_me;g++){const m=wme[g],x=t[m],_=l[m]!==void 0?l[m]:c[m],b=g1(_),S=m===u?x.isActive:null;S===!1&&(p=g);let E=_===c[m]&&_!==l[m]&&b;if(E&&r&&n.manuallyAnimateOnMount&&(E=!1),x.protectedKeys={...d},!x.isActive&&S===null||!_&&!x.prevProp||DE(_)||typeof _=="boolean")continue;const C=Eme(x.prevProp,_);let R=C||m===u&&x.isActive&&!E&&b||g>p&&b,T=!1;const A=Array.isArray(_)?_:[_];let P=A.reduce(i(m),{});S===!1&&(P={});const{prevResolvedValues:k={}}=x,W={...k,...P},N=V=>{R=!0,f.has(V)&&(T=!0,f.delete(V)),x.needsAnimating[V]=!0;const F=n.getValue(V);F&&(F.liveStyle=!1)};for(const V in W){const F=P[V],U=k[V];if(d.hasOwnProperty(V))continue;let L=!1;kI(F)&&kI(U)?L=!wj(F,U):L=F!==U,L?F!=null?N(V):f.add(V):F!==void 0&&f.has(V)?N(V):x.protectedKeys[V]=!0}x.prevProp=_,x.prevResolvedValues=P,x.isActive&&(d={...d,...P}),r&&n.blockInitialAnimation&&(R=!1);const O=E&&C;R&&(!O||T)&&h.push(...A.map(V=>{const F={type:m};if(typeof V=="string"&&r&&!O&&n.manuallyAnimateOnMount&&n.parent){const{parent:U}=n,L=fv(U,V);if(U.enteringChildren&&L){const{delayChildren:j}=L.transition||{};F.delay=xj(U.enteringChildren,n,j)}}return{animation:V,options:F}}))}if(f.size){const g={};if(typeof l.initial!="boolean"){const m=fv(n,Array.isArray(l.initial)?l.initial[0]:l.initial);m&&m.transition&&(g.transition=m.transition)}f.forEach(m=>{const x=n.getBaseTarget(m),_=n.getValue(m);_&&(_.liveStyle=!0),g[m]=x??null}),h.push({animation:g})}let v=!!h.length;return r&&(l.initial===!1||l.initial===l.animate)&&!n.manuallyAnimateOnMount&&(v=!1),r=!1,v?e(h):Promise.resolve()}function a(u,l){var h;if(t[u].isActive===l)return Promise.resolve();(h=n.variantChildren)==null||h.forEach(f=>{var d;return(d=f.animationState)==null?void 0:d.setActive(u,l)}),t[u].isActive=l;const c=s(u);for(const f in t)t[f].protectedKeys={};return c}return{animateChanges:s,setActive:a,setAnimateFunction:o,getState:()=>t,reset:()=>{t=BU()}}}function Eme(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!wj(e,n):!1}function Uf(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function BU(){return{animate:Uf(!0),whileInView:Uf(),whileHover:Uf(),whileTap:Uf(),whileDrag:Uf(),whileFocus:Uf(),exit:Uf()}}class hf{constructor(e){this.isMounted=!1,this.node=e}update(){}}class Cme extends hf{constructor(e){super(e),e.animationState||(e.animationState=Sme(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();DE(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let Mme=0;class Tme extends hf{constructor(){super(...arguments),this.id=Mme++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Rme={animation:{Feature:Cme},exit:{Feature:Tme}};function y1(n,e,t,r={passive:!0}){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t)}function Q1(n){return{point:{x:n.pageX,y:n.pageY}}}const Ame=n=>e=>lD(e)&&n(e,Q1(e));function fy(n,e,t,r){return y1(n,e,Ame(t),r)}const bj=1e-4,Ime=1-bj,Pme=1+bj,Sj=.01,kme=0-Sj,Dme=0+Sj;function Ko(n){return n.max-n.min}function Nme(n,e,t){return Math.abs(n-e)<=t}function UU(n,e,t,r=.5){n.origin=r,n.originPoint=kr(e.min,e.max,n.origin),n.scale=Ko(t)/Ko(e),n.translate=kr(t.min,t.max,n.origin)-n.originPoint,(n.scale>=Ime&&n.scale<=Pme||isNaN(n.scale))&&(n.scale=1),(n.translate>=kme&&n.translate<=Dme||isNaN(n.translate))&&(n.translate=0)}function dy(n,e,t,r){UU(n.x,e.x,t.x,r?r.originX:void 0),UU(n.y,e.y,t.y,r?r.originY:void 0)}function zU(n,e,t){n.min=t.min+e.min,n.max=n.min+Ko(e)}function Lme(n,e,t){zU(n.x,e.x,t.x),zU(n.y,e.y,t.y)}function VU(n,e,t){n.min=e.min-t.min,n.max=n.min+Ko(e)}function Gb(n,e,t){VU(n.x,e.x,t.x),VU(n.y,e.y,t.y)}function Ta(n){return[n("x"),n("y")]}const Ej=({current:n})=>n?n.ownerDocument.defaultView:null,WU=(n,e)=>Math.abs(n-e);function Fme(n,e){const t=WU(n.x,e.x),r=WU(n.y,e.y);return Math.sqrt(t**2+r**2)}class Cj{constructor(e,t,{transformPagePoint:r,contextWindow:i=window,dragSnapToOrigin:o=!1,distanceThreshold:s=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=GM(this.lastMoveEventInfo,this.history),d=this.startEvent!==null,p=Fme(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!d&&!p)return;const{point:v}=f,{timestamp:g}=Yi;this.history.push({...v,timestamp:g});const{onStart:m,onMove:x}=this.handlers;d||(m&&m(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),x&&x(this.lastMoveEvent,f)},this.handlePointerMove=(f,d)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=HM(d,this.transformPagePoint),fr.update(this.updatePoint,!0)},this.handlePointerUp=(f,d)=>{this.end();const{onEnd:p,onSessionEnd:v,resumeAnimation:g}=this.handlers;if(this.dragSnapToOrigin&&g&&g(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=GM(f.type==="pointercancel"?this.lastMoveEventInfo:HM(d,this.transformPagePoint),this.history);this.startEvent&&p&&p(f,m),v&&v(f,m)},!lD(e))return;this.dragSnapToOrigin=o,this.handlers=t,this.transformPagePoint=r,this.distanceThreshold=s,this.contextWindow=i||window;const a=Q1(e),u=HM(a,this.transformPagePoint),{point:l}=u,{timestamp:c}=Yi;this.history=[{...l,timestamp:c}];const{onSessionStart:h}=t;h&&h(e,GM(u,this.history)),this.removeListeners=q1(fy(this.contextWindow,"pointermove",this.handlePointerMove),fy(this.contextWindow,"pointerup",this.handlePointerUp),fy(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),bc(this.updatePoint)}}function HM(n,e){return e?{point:e(n.point)}:n}function HU(n,e){return{x:n.x-e.x,y:n.y-e.y}}function GM({point:n},e){return{point:n,delta:HU(n,Mj(e)),offset:HU(n,Ome(e)),velocity:Bme(e,.1)}}function Ome(n){return n[0]}function Mj(n){return n[n.length-1]}function Bme(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,r=null;const i=Mj(n);for(;t>=0&&(r=n[t],!(i.timestamp-r.timestamp>ml(e)));)t--;if(!r)return{x:0,y:0};const o=Ba(i.timestamp-r.timestamp);if(o===0)return{x:0,y:0};const s={x:(i.x-r.x)/o,y:(i.y-r.y)/o};return s.x===1/0&&(s.x=0),s.y===1/0&&(s.y=0),s}function Ume(n,{min:e,max:t},r){return e!==void 0&&n<e?n=r?kr(e,n,r.min):Math.max(n,e):t!==void 0&&n>t&&(n=r?kr(t,n,r.max):Math.min(n,t)),n}function GU(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function zme(n,{top:e,left:t,bottom:r,right:i}){return{x:GU(n.x,t,i),y:GU(n.y,e,r)}}function $U(n,e){let t=e.min-n.min,r=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,r]=[r,t]),{min:t,max:r}}function Vme(n,e){return{x:$U(n.x,e.x),y:$U(n.y,e.y)}}function Wme(n,e){let t=.5;const r=Ko(n),i=Ko(e);return i>r?t=p1(e.min,e.max-r,n.min):r>i&&(t=p1(n.min,n.max-i,e.min)),wc(0,1,t)}function Hme(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const LI=.35;function Gme(n=LI){return n===!1?n=0:n===!0&&(n=LI),{x:jU(n,"left","right"),y:jU(n,"top","bottom")}}function jU(n,e,t){return{min:XU(n,e),max:XU(n,t)}}function XU(n,e){return typeof n=="number"?n:n[e]||0}const $me=new WeakMap;class jme{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=xi(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:r}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const o=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(Q1(h).point)},s=(h,f)=>{const{drag:d,dragPropagation:p,onDragStart:v}=this.getProps();if(d&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Yde(d),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=f,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ta(m=>{let x=this.getAxisMotionValue(m).get()||0;if(vl.test(x)){const{projection:_}=this.visualElement;if(_&&_.layout){const b=_.layout.layoutBox[m];b&&(x=Ko(b)*(parseFloat(x)/100))}}this.originPoint[m]=x}),v&&fr.postRender(()=>v(h,f)),DI(this.visualElement,"transform");const{animationState:g}=this.visualElement;g&&g.setActive("whileDrag",!0)},a=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f;const{dragPropagation:d,dragDirectionLock:p,onDirectionLock:v,onDrag:g}=this.getProps();if(!d&&!this.openDragLock)return;const{offset:m}=f;if(p&&this.currentDirection===null){this.currentDirection=Xme(m),this.currentDirection!==null&&v&&v(this.currentDirection);return}this.updateAxis("x",f.point,m),this.updateAxis("y",f.point,m),this.visualElement.render(),g&&g(h,f)},u=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f,this.stop(h,f),this.latestPointerEvent=null,this.latestPanInfo=null},l=()=>Ta(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)==null?void 0:f.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new Cj(e,{onSessionStart:o,onStart:s,onMove:a,onSessionEnd:u,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,distanceThreshold:r,contextWindow:Ej(this.visualElement)})}stop(e,t){const r=e||this.latestPointerEvent,i=t||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!i||!r)return;const{velocity:s}=i;this.startAnimation(s);const{onDragEnd:a}=this.getProps();a&&fr.postRender(()=>a(r,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,r){const{drag:i}=this.getProps();if(!r||!Ww(e,i,this.currentDirection))return;const o=this.getAxisMotionValue(e);let s=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(s=Ume(s,this.constraints[e],this.elastic[e])),o.set(s)}resolveConstraints(){var o;const{dragConstraints:e,dragElastic:t}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)==null?void 0:o.layout,i=this.constraints;e&&Xm(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=zme(r.layoutBox,e):this.constraints=!1,this.elastic=Gme(t),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Ta(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=Hme(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Xm(e))return!1;const r=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=qpe(r,i.root,this.visualElement.getTransformPagePoint());let s=Vme(i.layout.layoutBox,o);if(t){const a=t($pe(s));this.hasMutatedConstraints=!!a,a&&(s=lj(a))}return s}startAnimation(e){const{drag:t,dragMomentum:r,dragElastic:i,dragTransition:o,dragSnapToOrigin:s,onDragTransitionEnd:a}=this.getProps(),u=this.constraints||{},l=Ta(c=>{if(!Ww(c,t,this.currentDirection))return;let h=u&&u[c]||{};s&&(h={min:0,max:0});const f=i?200:1e6,d=i?40:1e7,p={type:"inertia",velocity:r?e[c]:0,bounceStiffness:f,bounceDamping:d,timeConstant:750,restDelta:1,restSpeed:10,...o,...h};return this.startAxisValueAnimation(c,p)});return Promise.all(l).then(a)}startAxisValueAnimation(e,t){const r=this.getAxisMotionValue(e);return DI(this.visualElement,e),r.start(yD(e,r,0,t,this.visualElement,!1))}stopAnimation(){Ta(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Ta(e=>{var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)==null?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),i=r[t];return i||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){Ta(t=>{const{drag:r}=this.getProps();if(!Ww(t,r,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(t);if(i&&i.layout){const{min:s,max:a}=i.layout.layoutBox[t];o.set(e[t]-kr(s,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:r}=this.visualElement;if(!Xm(t)||!r||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Ta(s=>{const a=this.getAxisMotionValue(s);if(a&&this.constraints!==!1){const u=a.get();i[s]=Wme({min:u,max:u},this.constraints[s])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),Ta(s=>{if(!Ww(s,e,null))return;const a=this.getAxisMotionValue(s),{min:u,max:l}=this.constraints[s];a.set(kr(u,l,i[s]))})}addListeners(){if(!this.visualElement.current)return;$me.set(this.visualElement,this);const e=this.visualElement.current,t=fy(e,"pointerdown",u=>{const{drag:l,dragListener:c=!0}=this.getProps();l&&c&&this.start(u)}),r=()=>{const{dragConstraints:u}=this.getProps();Xm(u)&&u.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",r);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),fr.read(r);const s=y1(window,"resize",()=>this.scalePositionWithinConstraints()),a=i.addEventListener("didUpdate",({delta:u,hasLayoutChanged:l})=>{this.isDragging&&l&&(Ta(c=>{const h=this.getAxisMotionValue(c);h&&(this.originPoint[c]+=u[c].translate,h.set(h.get()+u[c].translate))}),this.visualElement.render())});return()=>{s(),t(),o(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:r=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:s=LI,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:r,dragPropagation:i,dragConstraints:o,dragElastic:s,dragMomentum:a}}}function Ww(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Xme(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class qme extends hf{constructor(e){super(e),this.removeGroupControls=Wa,this.removeListeners=Wa,this.controls=new jme(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Wa}unmount(){this.removeGroupControls(),this.removeListeners()}}const qU=n=>(e,t)=>{n&&fr.postRender(()=>n(e,t))};class Yme extends hf{constructor(){super(...arguments),this.removePointerDownListener=Wa}onPointerDown(e){this.session=new Cj(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ej(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:r,onPanEnd:i}=this.node.getProps();return{onSessionStart:qU(e),onStart:qU(t),onMove:r,onEnd:(o,s)=>{delete this.session,i&&fr.postRender(()=>i(o,s))}}}mount(){this.removePointerDownListener=fy(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const j_={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let $M=!1;class Kme extends H.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r,layoutId:i}=this.props,{projection:o}=e;o&&(t.group&&t.group.add(o),r&&r.register&&i&&r.register(o),$M&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),j_.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:r,drag:i,isPresent:o}=this.props,{projection:s}=r;return s&&(s.isPresent=o,$M=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==o?s.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?s.promote():s.relegate()||fr.postRender(()=>{const a=s.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),uD.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:r}=this.props,{projection:i}=e;$M=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),r&&r.deregister&&r.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Tj(n){const[e,t]=Y$(),r=H.useContext(Wk);return G.jsx(Kme,{...n,layoutGroup:r,switchLayoutGroup:H.useContext(aj),isPresent:e,safeToRemove:t})}function Zme(n,e,t){const r=zi(n)?n:Kd(n);return r.start(yD("",r,e,t)),r.animation}const Qme=(n,e)=>n.depth-e.depth;class Jme{constructor(){this.children=[],this.isDirty=!1}add(e){$k(this.children,e),this.isDirty=!0}remove(e){jk(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Qme),this.isDirty=!1,this.children.forEach(e)}}function eve(n,e){const t=gs.now(),r=({timestamp:i})=>{const o=i-t;o>=e&&(bc(r),n(o-e))};return fr.setup(r,!0),()=>bc(r)}const Rj=["TopLeft","TopRight","BottomLeft","BottomRight"],tve=Rj.length,YU=n=>typeof n=="string"?parseFloat(n):n,KU=n=>typeof n=="number"||Kt.test(n);function nve(n,e,t,r,i,o){i?(n.opacity=kr(0,t.opacity??1,rve(r)),n.opacityExit=kr(e.opacity??1,0,ive(r))):o&&(n.opacity=kr(e.opacity??1,t.opacity??1,r));for(let s=0;s<tve;s++){const a=`border${Rj[s]}Radius`;let u=ZU(e,a),l=ZU(t,a);if(u===void 0&&l===void 0)continue;u||(u=0),l||(l=0),u===0||l===0||KU(u)===KU(l)?(n[a]=Math.max(kr(YU(u),YU(l),r),0),(vl.test(l)||vl.test(u))&&(n[a]+="%")):n[a]=l}(e.rotate||t.rotate)&&(n.rotate=kr(e.rotate||0,t.rotate||0,r))}function ZU(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const rve=Aj(0,.5,d$),ive=Aj(.5,.95,Wa);function Aj(n,e,t){return r=>r<n?0:r>e?1:t(p1(n,e,r))}function QU(n,e){n.min=e.min,n.max=e.max}function ou(n,e){QU(n.x,e.x),QU(n.y,e.y)}function JU(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function ez(n,e,t,r,i){return n-=e,n=Hb(n,1/t,r),i!==void 0&&(n=Hb(n,1/i,r)),n}function ove(n,e=0,t=1,r=.5,i,o=n,s=n){if(vl.test(e)&&(e=parseFloat(e),e=kr(s.min,s.max,e/100)-s.min),typeof e!="number")return;let a=kr(o.min,o.max,r);n===o&&(a-=e),n.min=ez(n.min,e,t,a,i),n.max=ez(n.max,e,t,a,i)}function tz(n,e,[t,r,i],o,s){ove(n,e[t],e[r],e[i],e.scale,o,s)}const sve=["x","scaleX","originX"],ave=["y","scaleY","originY"];function nz(n,e,t,r){tz(n.x,e,sve,t?t.x:void 0,r?r.x:void 0),tz(n.y,e,ave,t?t.y:void 0,r?r.y:void 0)}function rz(n){return n.translate===0&&n.scale===1}function Ij(n){return rz(n.x)&&rz(n.y)}function iz(n,e){return n.min===e.min&&n.max===e.max}function uve(n,e){return iz(n.x,e.x)&&iz(n.y,e.y)}function oz(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function Pj(n,e){return oz(n.x,e.x)&&oz(n.y,e.y)}function sz(n){return Ko(n.x)/Ko(n.y)}function az(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class lve{constructor(){this.members=[]}add(e){$k(this.members,e),e.scheduleRender()}remove(e){if(jk(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let r;for(let i=t;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){r=o;break}}return r?(this.promote(r),!0):!1}promote(e,t){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,t&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:r}=e;t.onExitComplete&&t.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function cve(n,e,t){let r="";const i=n.x.translate/e.x,o=n.y.translate/e.y,s=(t==null?void 0:t.z)||0;if((i||o||s)&&(r=`translate3d(${i}px, ${o}px, ${s}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:l,rotate:c,rotateX:h,rotateY:f,skewX:d,skewY:p}=t;l&&(r=`perspective(${l}px) ${r}`),c&&(r+=`rotate(${c}deg) `),h&&(r+=`rotateX(${h}deg) `),f&&(r+=`rotateY(${f}deg) `),d&&(r+=`skewX(${d}deg) `),p&&(r+=`skewY(${p}deg) `)}const a=n.x.scale*e.x,u=n.y.scale*e.y;return(a!==1||u!==1)&&(r+=`scale(${a}, ${u})`),r||"none"}const jM=["","X","Y","Z"],hve=1e3;let fve=0;function XM(n,e,t,r){const{latestValues:i}=e;i[n]&&(t[n]=i[n],e.setStaticValue(n,0),r&&(r[n]=0))}function kj(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=gj(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:o}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",fr,!(i||o))}const{parent:r}=n;r&&!r.hasCheckedOptimisedAppear&&kj(r)}function Dj({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:r,resetTransform:i}){return class{constructor(s={},a=e==null?void 0:e()){this.id=fve++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(mve),this.nodes.forEach(xve),this.nodes.forEach(wve),this.nodes.forEach(vve)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=s,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let u=0;u<this.path.length;u++)this.path[u].shouldResetTransform=!0;this.root===this&&(this.nodes=new Jme)}addEventListener(s,a){return this.eventHandlers.has(s)||this.eventHandlers.set(s,new Yk),this.eventHandlers.get(s).add(a)}notifyListeners(s,...a){const u=this.eventHandlers.get(s);u&&u.notify(...a)}hasListeners(s){return this.eventHandlers.has(s)}mount(s){if(this.instance)return;this.isSVG=q$(s)&&!tpe(s),this.instance=s;const{layoutId:a,layout:u,visualElement:l}=this.options;if(l&&!l.current&&l.mount(s),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(u||a)&&(this.isLayoutDirty=!0),n){let c,h=0;const f=()=>this.root.updateBlockedByResize=!1;fr.read(()=>{h=window.innerWidth}),n(s,()=>{const d=window.innerWidth;d!==h&&(h=d,this.root.updateBlockedByResize=!0,c&&c(),c=eve(f,250),j_.hasAnimatedSinceResize&&(j_.hasAnimatedSinceResize=!1,this.nodes.forEach(cz)))})}a&&this.root.registerSharedNode(a,this),this.options.animate!==!1&&l&&(a||u)&&this.addEventListener("didUpdate",({delta:c,hasLayoutChanged:h,hasRelativeLayoutChanged:f,layout:d})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||l.getDefaultTransition()||Cve,{onLayoutAnimationStart:v,onLayoutAnimationComplete:g}=l.getProps(),m=!this.targetLayout||!Pj(this.targetLayout,d),x=!h&&f;if(this.options.layoutRoot||this.resumeFrom||x||h&&(m||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const _={...sD(p,"layout"),onPlay:v,onComplete:g};(l.shouldReduceMotion||this.options.layoutRoot)&&(_.delay=0,_.type=!1),this.startAnimation(_),this.setAnimationOrigin(c,x)}else h||cz(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=d})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const s=this.getStack();s&&s.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),bc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(_ve),this.animationId++)}getTransformTemplate(){const{visualElement:s}=this.options;return s&&s.getProps().transformTemplate}willUpdate(s=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&kj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const h=this.path[c];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:a,layout:u}=this.options;if(a===void 0&&!u)return;const l=this.getTransformTemplate();this.prevTransformTemplateValue=l?l(this.latestValues,""):void 0,this.updateSnapshot(),s&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(uz);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(lz);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(yve),this.nodes.forEach(dve),this.nodes.forEach(pve)):this.nodes.forEach(lz),this.clearAllSnapshots();const a=gs.now();Yi.delta=wc(0,1e3/60,a-Yi.timestamp),Yi.timestamp=a,Yi.isProcessing=!0,LM.update.process(Yi),LM.preRender.process(Yi),LM.render.process(Yi),Yi.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,uD.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(gve),this.sharedNodes.forEach(bve)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,fr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){fr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ko(this.snapshot.measuredBox.x)&&!Ko(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let u=0;u<this.path.length;u++)this.path[u].updateScroll();const s=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=xi(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,s?s.layoutBox:void 0)}updateScroll(s="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===s&&(a=!1),a&&this.instance){const u=r(this.instance);this.scroll={animationId:this.root.animationId,phase:s,isRoot:u,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:u}}}resetTransform(){if(!i)return;const s=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!Ij(this.projectionDelta),u=this.getTransformTemplate(),l=u?u(this.latestValues,""):void 0,c=l!==this.prevTransformTemplateValue;s&&this.instance&&(a||Kf(this.latestValues)||c)&&(i(this.instance,l),this.shouldResetTransform=!1,this.scheduleRender())}measure(s=!0){const a=this.measurePageBox();let u=this.removeElementScroll(a);return s&&(u=this.removeTransform(u)),Mve(u),{animationId:this.root.animationId,measuredBox:a,layoutBox:u,latestValues:{},source:this.id}}measurePageBox(){var l;const{visualElement:s}=this.options;if(!s)return xi();const a=s.measureViewportBox();if(!(((l=this.scroll)==null?void 0:l.wasRoot)||this.path.some(Tve))){const{scroll:c}=this.root;c&&(qm(a.x,c.offset.x),qm(a.y,c.offset.y))}return a}removeElementScroll(s){var u;const a=xi();if(ou(a,s),(u=this.scroll)!=null&&u.wasRoot)return a;for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:h,options:f}=c;c!==this.root&&h&&f.layoutScroll&&(h.wasRoot&&ou(a,s),qm(a.x,h.offset.x),qm(a.y,h.offset.y))}return a}applyTransform(s,a=!1){const u=xi();ou(u,s);for(let l=0;l<this.path.length;l++){const c=this.path[l];!a&&c.options.layoutScroll&&c.scroll&&c!==c.root&&Ym(u,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),Kf(c.latestValues)&&Ym(u,c.latestValues)}return Kf(this.latestValues)&&Ym(u,this.latestValues),u}removeTransform(s){const a=xi();ou(a,s);for(let u=0;u<this.path.length;u++){const l=this.path[u];if(!l.instance||!Kf(l.latestValues))continue;AI(l.latestValues)&&l.updateSnapshot();const c=xi(),h=l.measurePageBox();ou(c,h),nz(a,l.latestValues,l.snapshot?l.snapshot.layoutBox:void 0,c)}return Kf(this.latestValues)&&nz(a,this.latestValues),a}setTargetDelta(s){this.targetDelta=s,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(s){this.options={...this.options,...s,crossfade:s.crossfade!==void 0?s.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Yi.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(s=!1){var d;const a=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=a.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=a.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=a.isSharedProjectionDirty);const u=!!this.resumingFrom||this!==a;if(!(s||u&&this.isSharedProjectionDirty||this.isProjectionDirty||(d=this.parent)!=null&&d.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:c,layoutId:h}=this.options;if(!this.layout||!(c||h))return;this.resolvedRelativeTargetAt=Yi.timestamp;const f=this.getClosestProjectingParent();f&&this.linkedParentVersion!==f.layoutVersion&&!f.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(f&&f.layout?this.createRelativeTarget(f,this.layout.layoutBox,f.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=xi(),this.targetWithTransforms=xi()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Lme(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ou(this.target,this.layout.layoutBox),hj(this.target,this.targetDelta)):ou(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?this.createRelativeTarget(f,this.target,f.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||AI(this.parent.latestValues)||cj(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(s,a,u){this.relativeParent=s,this.linkedParentVersion=s.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=xi(),this.relativeTargetOrigin=xi(),Gb(this.relativeTargetOrigin,a,u),ou(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var p;const s=this.getLead(),a=!!this.resumingFrom||this!==s;let u=!0;if((this.isProjectionDirty||(p=this.parent)!=null&&p.isProjectionDirty)&&(u=!1),a&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(u=!1),this.resolvedRelativeTargetAt===Yi.timestamp&&(u=!1),u)return;const{layout:l,layoutId:c}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(l||c))return;ou(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;Xpe(this.layoutCorrected,this.treeScale,this.path,a),s.layout&&!s.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(s.target=s.layout.layoutBox,s.targetWithTransforms=xi());const{target:d}=s;if(!d){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(JU(this.prevProjectionDelta.x,this.projectionDelta.x),JU(this.prevProjectionDelta.y,this.projectionDelta.y)),dy(this.projectionDelta,this.layoutCorrected,d,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!az(this.projectionDelta.x,this.prevProjectionDelta.x)||!az(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",d))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(s=!0){var a;if((a=this.options.visualElement)==null||a.scheduleRender(),s){const u=this.getStack();u&&u.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Km(),this.projectionDelta=Km(),this.projectionDeltaWithTransform=Km()}setAnimationOrigin(s,a=!1){const u=this.snapshot,l=u?u.latestValues:{},c={...this.latestValues},h=Km();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const f=xi(),d=u?u.source:void 0,p=this.layout?this.layout.source:void 0,v=d!==p,g=this.getStack(),m=!g||g.members.length<=1,x=!!(v&&!m&&this.options.crossfade===!0&&!this.path.some(Eve));this.animationProgress=0;let _;this.mixTargetDelta=b=>{const S=b/1e3;hz(h.x,s.x,S),hz(h.y,s.y,S),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Gb(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Sve(this.relativeTarget,this.relativeTargetOrigin,f,S),_&&uve(this.relativeTarget,_)&&(this.isProjectionDirty=!1),_||(_=xi()),ou(_,this.relativeTarget)),v&&(this.animationValues=c,nve(c,l,this.latestValues,S,x,m)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(s){var a,u,l;this.notifyListeners("animationStart"),(a=this.currentAnimation)==null||a.stop(),(l=(u=this.resumingFrom)==null?void 0:u.currentAnimation)==null||l.stop(),this.pendingAnimation&&(bc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=fr.update(()=>{j_.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Kd(0)),this.currentAnimation=Zme(this.motionValue,[0,1e3],{...s,velocity:0,isSync:!0,onUpdate:c=>{this.mixTargetDelta(c),s.onUpdate&&s.onUpdate(c)},onStop:()=>{},onComplete:()=>{s.onComplete&&s.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const s=this.getStack();s&&s.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(hve),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const s=this.getLead();let{targetWithTransforms:a,target:u,layout:l,latestValues:c}=s;if(!(!a||!u||!l)){if(this!==s&&this.layout&&l&&Nj(this.options.animationType,this.layout.layoutBox,l.layoutBox)){u=this.target||xi();const h=Ko(this.layout.layoutBox.x);u.x.min=s.target.x.min,u.x.max=u.x.min+h;const f=Ko(this.layout.layoutBox.y);u.y.min=s.target.y.min,u.y.max=u.y.min+f}ou(a,u),Ym(a,c),dy(this.projectionDeltaWithTransform,this.layoutCorrected,a,c)}}registerSharedNode(s,a){this.sharedNodes.has(s)||this.sharedNodes.set(s,new lve),this.sharedNodes.get(s).add(a);const l=a.options.initialPromotionConfig;a.promote({transition:l?l.transition:void 0,preserveFollowOpacity:l&&l.shouldPreserveFollowOpacity?l.shouldPreserveFollowOpacity(a):void 0})}isLead(){const s=this.getStack();return s?s.lead===this:!0}getLead(){var a;const{layoutId:s}=this.options;return s?((a=this.getStack())==null?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:s}=this.options;return s?(a=this.getStack())==null?void 0:a.prevLead:void 0}getStack(){const{layoutId:s}=this.options;if(s)return this.root.sharedNodes.get(s)}promote({needsReset:s,transition:a,preserveFollowOpacity:u}={}){const l=this.getStack();l&&l.promote(this,u),s&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const s=this.getStack();return s?s.relegate(this):!1}resetSkewAndRotation(){const{visualElement:s}=this.options;if(!s)return;let a=!1;const{latestValues:u}=s;if((u.z||u.rotate||u.rotateX||u.rotateY||u.rotateZ||u.skewX||u.skewY)&&(a=!0),!a)return;const l={};u.z&&XM("z",s,l,this.animationValues);for(let c=0;c<jM.length;c++)XM(`rotate${jM[c]}`,s,l,this.animationValues),XM(`skew${jM[c]}`,s,l,this.animationValues);s.render();for(const c in l)s.setStaticValue(c,l[c]),this.animationValues&&(this.animationValues[c]=l[c]);s.scheduleRender()}applyProjectionStyles(s,a){if(!this.instance||this.isSVG)return;if(!this.isVisible){s.visibility="hidden";return}const u=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,s.visibility="",s.opacity="",s.pointerEvents=$_(a==null?void 0:a.pointerEvents)||"",s.transform=u?u(this.latestValues,""):"none";return}const l=this.getLead();if(!this.projectionDelta||!this.layout||!l.target){this.options.layoutId&&(s.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,s.pointerEvents=$_(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Kf(this.latestValues)&&(s.transform=u?u({},""):"none",this.hasProjected=!1);return}s.visibility="";const c=l.animationValues||l.latestValues;this.applyTransformsToTarget();let h=cve(this.projectionDeltaWithTransform,this.treeScale,c);u&&(h=u(c,h)),s.transform=h;const{x:f,y:d}=this.projectionDelta;s.transformOrigin=`${f.origin*100}% ${d.origin*100}% 0`,l.animationValues?s.opacity=l===this?c.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:c.opacityExit:s.opacity=l===this?c.opacity!==void 0?c.opacity:"":c.opacityExit!==void 0?c.opacityExit:0;for(const p in RI){if(c[p]===void 0)continue;const{correct:v,applyTo:g,isCSSVariable:m}=RI[p],x=h==="none"?c[p]:v(c[p],l);if(g){const _=g.length;for(let b=0;b<_;b++)s[g[b]]=x}else m?this.options.visualElement.renderState.vars[p]=x:s[p]=x}this.options.layoutId&&(s.pointerEvents=l===this?$_(a==null?void 0:a.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(s=>{var a;return(a=s.currentAnimation)==null?void 0:a.stop()}),this.root.nodes.forEach(uz),this.root.sharedNodes.clear()}}}function dve(n){n.updateLayout()}function pve(n){var t;const e=((t=n.resumeFrom)==null?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&e&&n.hasListeners("didUpdate")){const{layoutBox:r,measuredBox:i}=n.layout,{animationType:o}=n.options,s=e.source!==n.layout.source;o==="size"?Ta(h=>{const f=s?e.measuredBox[h]:e.layoutBox[h],d=Ko(f);f.min=r[h].min,f.max=f.min+d}):Nj(o,e.layoutBox,r)&&Ta(h=>{const f=s?e.measuredBox[h]:e.layoutBox[h],d=Ko(r[h]);f.max=f.min+d,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[h].max=n.relativeTarget[h].min+d)});const a=Km();dy(a,r,e.layoutBox);const u=Km();s?dy(u,n.applyTransform(i,!0),e.measuredBox):dy(u,r,e.layoutBox);const l=!Ij(a);let c=!1;if(!n.resumeFrom){const h=n.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:d}=h;if(f&&d){const p=xi();Gb(p,e.layoutBox,f.layoutBox);const v=xi();Gb(v,r,d.layoutBox),Pj(p,v)||(c=!0),h.options.layoutRoot&&(n.relativeTarget=v,n.relativeTargetOrigin=p,n.relativeParent=h)}}}n.notifyListeners("didUpdate",{layout:r,snapshot:e,delta:u,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(n.isLead()){const{onExitComplete:r}=n.options;r&&r()}n.options.transition=void 0}function mve(n){n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function vve(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function gve(n){n.clearSnapshot()}function uz(n){n.clearMeasurements()}function lz(n){n.isLayoutDirty=!1}function yve(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function cz(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function xve(n){n.resolveTargetDelta()}function wve(n){n.calcProjection()}function _ve(n){n.resetSkewAndRotation()}function bve(n){n.removeLeadSnapshot()}function hz(n,e,t){n.translate=kr(e.translate,0,t),n.scale=kr(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function fz(n,e,t,r){n.min=kr(e.min,t.min,r),n.max=kr(e.max,t.max,r)}function Sve(n,e,t,r){fz(n.x,e.x,t.x,r),fz(n.y,e.y,t.y,r)}function Eve(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const Cve={duration:.45,ease:[.4,0,.1,1]},dz=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),pz=dz("applewebkit/")&&!dz("chrome/")?Math.round:Wa;function mz(n){n.min=pz(n.min),n.max=pz(n.max)}function Mve(n){mz(n.x),mz(n.y)}function Nj(n,e,t){return n==="position"||n==="preserve-aspect"&&!Nme(sz(e),sz(t),.2)}function Tve(n){var e;return n!==n.root&&((e=n.scroll)==null?void 0:e.wasRoot)}const Rve=Dj({attachResizeListener:(n,e)=>y1(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),qM={current:void 0},Lj=Dj({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!qM.current){const n=new Rve({});n.mount(window),n.setOptions({layoutScroll:!0}),qM.current=n}return qM.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Ave={pan:{Feature:Yme},drag:{Feature:qme,ProjectionNode:Lj,MeasureLayout:Tj}};function vz(n,e,t){const{props:r}=n;n.animationState&&r.whileHover&&n.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,o=r[i];o&&fr.postRender(()=>o(e,Q1(e)))}class Ive extends hf{mount(){const{current:e}=this.node;e&&(this.unmount=Kde(e,(t,r)=>(vz(this.node,r,"Start"),i=>vz(this.node,i,"End"))))}unmount(){}}class Pve extends hf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=q1(y1(this.node.current,"focus",()=>this.onFocus()),y1(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function gz(n,e,t){const{props:r}=n;if(n.current instanceof HTMLButtonElement&&n.current.disabled)return;n.animationState&&r.whileTap&&n.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),o=r[i];o&&fr.postRender(()=>o(e,Q1(e)))}class kve extends hf{mount(){const{current:e}=this.node;e&&(this.unmount=epe(e,(t,r)=>(gz(this.node,r,"Start"),(i,{success:o})=>gz(this.node,i,o?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const FI=new WeakMap,YM=new WeakMap,Dve=n=>{const e=FI.get(n.target);e&&e(n)},Nve=n=>{n.forEach(Dve)};function Lve({root:n,...e}){const t=n||document;YM.has(t)||YM.set(t,{});const r=YM.get(t),i=JSON.stringify(e);return r[i]||(r[i]=new IntersectionObserver(Nve,{root:n,...e})),r[i]}function Fve(n,e,t){const r=Lve(e);return FI.set(n,t),r.observe(n),()=>{FI.delete(n),r.unobserve(n)}}const Ove={some:0,all:1};class Bve extends hf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:r,amount:i="some",once:o}=e,s={root:t?t.current:void 0,rootMargin:r,threshold:typeof i=="number"?i:Ove[i]},a=u=>{const{isIntersecting:l}=u;if(this.isInView===l||(this.isInView=l,o&&!l&&this.hasEnteredView))return;l&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",l);const{onViewportEnter:c,onViewportLeave:h}=this.node.getProps(),f=l?c:h;f&&f(u)};return Fve(this.node.current,s,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(Uve(e,t))&&this.startObserver()}unmount(){}}function Uve({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const zve={inView:{Feature:Bve},tap:{Feature:kve},focus:{Feature:Pve},hover:{Feature:Ive}},Vve={layout:{ProjectionNode:Lj,MeasureLayout:Tj}},Wve={...Rme,...zve,...Ave,...Vve},x1=Gpe(Wve,rme);function w1(n){const e=X1(()=>Kd(n)),{isStatic:t}=H.useContext(Z1);if(t){const[,r]=H.useState(n);H.useEffect(()=>e.on("change",r),[])}return e}function Fj(n,e){const t=w1(e()),r=()=>t.set(e());return r(),Gk(()=>{const i=()=>fr.preRender(r,!1,!0),o=n.map(s=>s.on("change",i));return()=>{o.forEach(s=>s()),bc(r)}}),t}function Hve(n){hy.current=[],n();const e=Fj(hy.current,n);return hy.current=void 0,e}function $b(n,e,t,r){if(typeof n=="function")return Hve(n);const i=typeof e=="function"?e:npe(e,t,r);return Array.isArray(n)?yz(n,i):yz([n],([o])=>i(o))}function yz(n,e){const t=X1(()=>[]);return Fj(n,()=>{t.length=0;const r=n.length;for(let i=0;i<r;i++)t[i]=n[i].get();return e(t)})}function Oj(n,e={}){const{isStatic:t}=H.useContext(Z1),r=()=>zi(n)?n.get():n;if(t)return $b(r);const i=w1(r());return H.useInsertionEffect(()=>rpe(i,n,e),[i,JSON.stringify(e)]),i}function xD({text:n,speed:e=50,maxIterations:t=10,sequential:r=!1,revealDirection:i="start",useOriginalCharsOnly:o=!1,characters:s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()_+",className:a="",parentClassName:u="",encryptedClassName:l="",animateOn:c="hover",...h}){const[f,d]=H.useState(n),[p,v]=H.useState(!1),[g,m]=H.useState(!1),[x,_]=H.useState(new Set),[b,S]=H.useState(!1),E=H.useRef(null);H.useEffect(()=>{let R,T=0;const A=W=>{const N=n.length;switch(i){case"start":return W.size;case"end":return N-1-W.size;case"center":{const O=Math.floor(N/2),z=Math.floor(W.size/2),V=W.size%2===0?O+z:O-z-1;if(V>=0&&V<N&&!W.has(V))return V;for(let F=0;F<N;F++)if(!W.has(F))return F;return 0}default:return W.size}},P=o?Array.from(new Set(n.split(""))).filter(W=>W!==" "):s.split(""),k=(W,N)=>{if(o){const O=W.split("").map((F,U)=>({char:F,isSpace:F===" ",index:U,isRevealed:N.has(U)})),z=O.filter(F=>!F.isSpace&&!F.isRevealed).map(F=>F.char);for(let F=z.length-1;F>0;F--){const U=Math.floor(Math.random()*(F+1));[z[F],z[U]]=[z[U],z[F]]}let V=0;return O.map(F=>F.isSpace?" ":F.isRevealed?W[F.index]:z[V++]).join("")}else return W.split("").map((O,z)=>O===" "?" ":N.has(z)?W[z]:P[Math.floor(Math.random()*P.length)]).join("")};return p?(m(!0),R=setInterval(()=>{_(W=>{if(r)if(W.size<n.length){const N=A(W),O=new Set(W);return O.add(N),d(k(n,O)),O}else return clearInterval(R),m(!1),W;else return d(k(n,W)),T++,T>=t&&(clearInterval(R),m(!1),d(n)),W})},e)):(d(n),_(new Set),m(!1)),()=>{R&&clearInterval(R)}},[p,n,e,t,r,i,s,o]),H.useEffect(()=>{if(c!=="view"&&c!=="both")return;const R=k=>{k.forEach(W=>{W.isIntersecting&&!b&&(v(!0),S(!0))})},T={root:null,rootMargin:"0px",threshold:.1},A=new IntersectionObserver(R,T),P=E.current;return P&&A.observe(P),()=>{P&&A.unobserve(P)}},[c,b]);const C=c==="hover"||c==="both"?{onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1)}:{};return G.jsxs(x1.span,{ref:E,className:`inline-block whitespace-pre-wrap ${u}`,...C,...h,children:[G.jsx("span",{className:"sr-only",children:f}),G.jsx("span",{"aria-hidden":"true",children:f.split("").map((R,T)=>{const A=x.has(T)||!g||!p;return G.jsx("span",{className:A?a:l,children:R},T)})})]})}const Gve="linear-gradient(145deg, #1a1a2e8c 0%, #7c3aed44 100%)",h0={INITIAL_DURATION:1200,INITIAL_X_OFFSET:70,INITIAL_Y_OFFSET:60,DEVICE_BETA_OFFSET:20,ENTER_TRANSITION_MS:180},f0=(n,e=0,t=100)=>Math.min(Math.max(n,e),t),OI=(n,e=3)=>parseFloat(n.toFixed(e)),xz=(n,e,t,r,i)=>OI(r+(i-r)*(n-e)/(t-e)),$ve=({avatarUrl:n="<Placeholder for avatar URL>",iconUrl:e="<Placeholder for icon URL>",grainUrl:t="<Placeholder for grain URL>",innerGradient:r,behindGlowEnabled:i=!0,behindGlowColor:o,behindGlowSize:s,className:a="",enableTilt:u=!0,enableMobileTilt:l=!1,mobileTiltSensitivity:c=5,miniAvatarUrl:h,name:f="Javi A. Torres",title:d="Software Engineer",handle:p="javicodes",status:v="Online",contactText:g="Contact",showUserInfo:m=!0,onContactClick:x})=>{const _=H.useRef(null),b=H.useRef(null),S=H.useRef(null),E=H.useRef(null),C=H.useMemo(()=>{if(!u)return null;let N=null,O=!1,z=0,V=0,F=0,U=0,L=0;const j=.14,Q=.6;let K=0;const ie=(ce,_e)=>{const Oe=b.current,Ve=_.current;if(!Oe||!Ve)return;const Ne=Oe.clientWidth||1,Z=Oe.clientHeight||1,de=f0(100/Ne*ce),me=f0(100/Z*_e),Ie=de-50,xe=me-50,se={"--pointer-x":`${de}%`,"--pointer-y":`${me}%`,"--background-x":`${xz(de,0,100,35,65)}%`,"--background-y":`${xz(me,0,100,35,65)}%`,"--pointer-from-center":`${f0(Math.hypot(me-50,de-50)/50,0,1)}`,"--pointer-from-top":`${me/100}`,"--pointer-from-left":`${de/100}`,"--rotate-x":`${OI(-(Ie/5))}deg`,"--rotate-y":`${OI(xe/4)}deg`};for(const[Xe,X]of Object.entries(se))Ve.style.setProperty(Xe,X)},pe=ce=>{if(!O)return;z===0&&(z=ce);const _e=(ce-z)/1e3;z=ce;const Oe=ce<K?Q:j,Ve=1-Math.exp(-_e/Oe);V+=(U-V)*Ve,F+=(L-F)*Ve,ie(V,F),Math.abs(U-V)>.05||Math.abs(L-F)>.05||document.hasFocus()?N=requestAnimationFrame(pe):(O=!1,z=0,N&&(cancelAnimationFrame(N),N=null))},we=()=>{O||(O=!0,z=0,N=requestAnimationFrame(pe))};return{setImmediate(ce,_e){V=ce,F=_e,ie(V,F)},setTarget(ce,_e){U=ce,L=_e,we()},toCenter(){const ce=b.current;ce&&this.setTarget(ce.clientWidth/2,ce.clientHeight/2)},beginInitial(ce){K=performance.now()+ce,we()},getCurrent(){return{x:V,y:F,tx:U,ty:L}},cancel(){N&&cancelAnimationFrame(N),N=null,O=!1,z=0}}},[u]),R=(N,O)=>{const z=O.getBoundingClientRect();return{x:N.clientX-z.left,y:N.clientY-z.top}},T=H.useCallback(N=>{const O=b.current;if(!O||!C)return;const{x:z,y:V}=R(N,O);C.setTarget(z,V)},[C]),A=H.useCallback(N=>{const O=b.current;if(!O||!C)return;O.classList.add("active"),O.classList.add("entering"),S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{O.classList.remove("entering")},h0.ENTER_TRANSITION_MS);const{x:z,y:V}=R(N,O);C.setTarget(z,V)},[C]),P=H.useCallback(()=>{const N=b.current;if(!N||!C)return;C.toCenter();const O=()=>{const{x:z,y:V,tx:F,ty:U}=C.getCurrent();Math.hypot(F-z,U-V)<.6?(N.classList.remove("active"),E.current=null):E.current=requestAnimationFrame(O)};E.current&&cancelAnimationFrame(E.current),E.current=requestAnimationFrame(O)},[C]),k=H.useCallback(N=>{const O=b.current;if(!O||!C)return;const{beta:z,gamma:V}=N;if(z==null||V==null)return;const F=O.clientWidth/2,U=O.clientHeight/2,L=f0(F+V*c,0,O.clientWidth),j=f0(U+(z-h0.DEVICE_BETA_OFFSET)*c,0,O.clientHeight);C.setTarget(L,j)},[C,c]);H.useEffect(()=>{if(!u||!C)return;const N=b.current;if(!N)return;const O=T,z=A,V=P,F=k;N.addEventListener("pointerenter",z),N.addEventListener("pointermove",O),N.addEventListener("pointerleave",V);const U=()=>{if(!l||location.protocol!=="https:")return;const Q=window.DeviceMotionEvent;Q&&typeof Q.requestPermission=="function"?Q.requestPermission().then(K=>{K==="granted"&&window.addEventListener("deviceorientation",F)}).catch(console.error):window.addEventListener("deviceorientation",F)};N.addEventListener("click",U);const L=(N.clientWidth||0)-h0.INITIAL_X_OFFSET,j=h0.INITIAL_Y_OFFSET;return C.setImmediate(L,j),C.toCenter(),C.beginInitial(h0.INITIAL_DURATION),()=>{N.removeEventListener("pointerenter",z),N.removeEventListener("pointermove",O),N.removeEventListener("pointerleave",V),N.removeEventListener("click",U),window.removeEventListener("deviceorientation",F),S.current&&window.clearTimeout(S.current),E.current&&cancelAnimationFrame(E.current),C.cancel(),N.classList.remove("entering")}},[u,l,C,T,A,P,k]);const W=H.useMemo(()=>({"--icon":e?`url(${e})`:"none","--grain":t?`url(${t})`:"none","--inner-gradient":r??Gve,"--behind-glow-color":o??"rgba(125, 190, 255, 0.67)","--behind-glow-size":s??"50%"}),[e,t,r,o,s]);return H.useCallback(()=>{x==null||x()},[x]),G.jsxs("div",{ref:_,className:`pc-card-wrapper ${a}`.trim(),style:W,children:[i&&G.jsx("div",{className:"pc-behind"}),G.jsx("div",{ref:b,className:"pc-card-shell",children:G.jsx("section",{className:"pc-card",children:G.jsxs("div",{className:"pc-inside",children:[G.jsx("div",{className:"pc-shine"}),G.jsx("div",{className:"pc-glare"}),G.jsx("div",{className:"pc-content pc-avatar-content",children:G.jsx("img",{className:"avatar",src:n,alt:`${f||"User"} avatar`,loading:"lazy",onError:N=>{const O=N.target;O.style.display="none"}})})]})})})]})},jve=q8.memo($ve),Xve="/assets/Hero-FIfd392t.jpg",qve="/assets/My_Image-CFUFERC6.jpg",Yve="/assets/Creative-DOYK7l2Q.gif",Kve="/assets/Technical-CW0xz_gD.gif",Zve="/assets/Innovative-DEi4wfXr.gif",Qve="/assets/Leetcode-CUVm0HGP.jpg",Jve="/assets/Consistent-ruwVwDGy.jpg",ege="/assets/Always-D7wiFFdl.png",tge="/assets/Clean-Dc25J3r-.jpg",nge="/assets/portfolioImage-BsfQnGWi.png",rge="/assets/EMC-BoTs6aDe.png",ige="/assets/DRT-Dkb_QHD5.png",oge="/assets/vm-DFZTDcWE.png",sge="/assets/core-CI_o2XPF.png",Jr={My_Image:qve,Creative:Yve,Technical:Kve,Innovative:Zve,Leetcode:Qve,Consistent:Jve,Always:ege,Clean:tge,portfolioImage:nge,EMC:rge,DRT:ige,core:sge,vm:oge},age=()=>{const n=H.useRef(null),e=qS(),[t,r]=H.useState(window.innerWidth<=768);return H.useEffect(()=>{const i=()=>r(window.innerWidth<=768);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),H.useEffect(()=>{const i=new IntersectionObserver(([o])=>{o.isIntersecting&&o.target.classList.add("hero-visible")},{threshold:.1});return n.current&&i.observe(n.current),()=>{n.current&&i.unobserve(n.current)}},[]),G.jsxs("section",{ref:n,className:"relative min-h-screen w-full flex items-center justify-center overflow-visible opacity-0 translate-y-5 transition-all duration-800 ease-out [&.hero-visible]:opacity-100 [&.hero-visible]:translate-y-0",children:[G.jsx("div",{className:"absolute inset-0 z-[1]",children:G.jsx(xce,{grid:20,mouse:.25,strength:.2,relaxation:.9,imageSrc:Xve})}),t?G.jsxs("div",{className:"relative z-[10] w-full h-full px-4 pt-20 pb-8 flex flex-col items-center justify-start",children:[G.jsx("div",{className:"text-center mb-6 animate-fade-in-up",children:G.jsxs("h1",{className:"flex flex-col gap-2",children:[G.jsx("span",{className:"text-lg font-bold text-gray-500 tracking-wider",children:"Hello there, I'm"}),G.jsx("span",{className:"text-4xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift",children:"Mayank Kumar"})]})}),G.jsxs("div",{className:"text-center mb-6 animate-fade-in-up [animation-delay:300ms]",children:[G.jsx("p",{className:"text-base text-gray-300 mb-3",children:"a Computer Science undergraduate"}),G.jsx("p",{className:"text-sm text-gray-400 leading-relaxed px-2",children:"Currently exploring Data Science, Machine Learning fundamentals, and full-stack development."})]}),G.jsx("div",{className:"mb-8 animate-fade-in-up [animation-delay:500ms]",children:G.jsx("div",{className:"w-48 h-48 rounded-2xl overflow-hidden border-2 border-primary/30 shadow-lg shadow-primary/20",children:G.jsx("img",{src:Jr.My_Image,alt:"Mayank Kumar",className:"w-full h-full object-cover"})})}),G.jsxs("div",{className:"flex flex-col gap-3 w-full max-w-xs animate-fade-in-up [animation-delay:700ms]",children:[G.jsx("button",{onClick:()=>e("/projects"),className:"w-full px-6 py-3.5 text-sm font-semibold rounded-full bg-gradient-to-r from-primary via-secondary to-tertiary text-white shadow-[0_4px_20px_rgba(0,212,255,0.4)] transition-all duration-300 active:scale-95",children:"View My Work"}),G.jsx("button",{onClick:()=>e("/contact"),className:"w-full px-6 py-3.5 text-sm font-semibold rounded-full bg-transparent text-primary border-2 border-primary/50 transition-all duration-300 active:scale-95 active:bg-primary/10",children:"Get In Touch"})]})]}):G.jsxs("div",{className:"relative z-[10] w-full max-w-7xl px-8 flex items-center justify-between gap-12 pointer-events-none",children:[G.jsx("div",{className:"w-1/2 animate-fade-in-up [animation-delay:300ms]",children:G.jsxs("div",{className:"space-y-6",children:[G.jsxs("h1",{className:"flex flex-col gap-2 text-left",children:[G.jsx("span",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-500 tracking-wider text-left",children:"Hello there, I'm"}),G.jsx("span",{className:"text-4xl sm:text-6xl md:text-7xl lg:text-8xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift",children:"Mayank Kumar"})]}),G.jsx("div",{className:"animate-fade-in-up [animation-delay:1200ms]",children:G.jsx(n$,{text:"a Computer Science undergraduate",as:"p",className:"text-xl sm:text-2xl md:text-3xl font-medium text-gray-300 tracking-wide",typingSpeed:60,initialDelay:1200,loop:!1,showCursor:!1,startOnVisible:!1})}),G.jsx("div",{className:"animate-fade-in-up [animation-delay:1200ms]",children:G.jsx(xD,{text:"Currently exploring Data Science, Machine Learning fundamentals, and full-stack development, while strengthening problem-solving and core computer science concepts.",className:"text-base sm:text-lg md:text-xl text-gray-400",parentClassName:"max-w-2xl leading-relaxed mb-10 block",speed:20,maxIterations:15,sequential:!0,revealDirection:"start",animateOn:"view"})}),G.jsxs("div",{className:"flex gap-4 flex-wrap animate-fade-in-up [animation-delay:1800ms]",children:[G.jsx("button",{onClick:()=>e("/projects"),className:"cursor-target px-8 py-4 text-base font-semibold rounded-full bg-gradient-to-r from-primary via-secondary to-tertiary text-white shadow-[0_4px_20px_rgba(0,212,255,0.4)] transition-all duration-300 hover:-translate-y-0.5 hover:shadow-[0_6px_30px_rgba(124,58,237,0.5)] pointer-events-auto",children:"View My Work"}),G.jsx("button",{onClick:()=>e("/contact"),className:"cursor-target px-8 py-4 text-base font-semibold rounded-full bg-transparent text-primary border-2 border-primary/50 transition-all duration-300 hover:bg-primary/10 hover:border-primary hover:-translate-y-0.5 pointer-events-auto",children:"Get In Touch"})]})]})}),G.jsx("div",{className:"w-1/2 flex items-center justify-center animate-fade-in-up [animation-delay:600ms] pointer-events-auto",children:G.jsx(jve,{avatarUrl:Jr.My_Image,miniAvatarUrl:Jr.My_Image,name:"Mayank Kumar",title:"Full Stack Developer",handle:"mayank",status:"Available",contactText:"Contact Me",enableTilt:!0,behindGlowEnabled:!0,behindGlowColor:"rgba(124, 58, 237, 0.6)",onContactClick:()=>{console.log("Contact button clicked")}})})]})]})},uge=({direction:n="right",speed:e=1,borderColor:t="#999",squareSize:r=40,hoverFillColor:i="#222"})=>{const o=H.useRef(null),s=H.useRef(null),a=H.useRef(0),u=H.useRef(0),l=H.useRef({x:0,y:0}),c=H.useRef(null);return H.useEffect(()=>{const h=o.current;if(!h)return;const f=h.getContext("2d"),d=()=>{h.width=h.offsetWidth,h.height=h.offsetHeight,a.current=Math.ceil(h.width/r)+1,u.current=Math.ceil(h.height/r)+1};window.addEventListener("resize",d),d();const p=()=>{if(!f)return;f.clearRect(0,0,h.width,h.height);const x=Math.floor(l.current.x/r)*r,_=Math.floor(l.current.y/r)*r;for(let S=x;S<h.width+r;S+=r)for(let E=_;E<h.height+r;E+=r){const C=S-l.current.x%r,R=E-l.current.y%r;c.current&&Math.floor((S-x)/r)===c.current.x&&Math.floor((E-_)/r)===c.current.y&&(f.fillStyle=i,f.fillRect(C,R,r,r)),f.strokeStyle=t,f.strokeRect(C,R,r,r)}const b=f.createRadialGradient(h.width/2,h.height/2,0,h.width/2,h.height/2,Math.sqrt(h.width**2+h.height**2)/2);b.addColorStop(0,"rgba(0, 0, 0, 0)"),b.addColorStop(1,"#0a0a0f"),f.fillStyle=b,f.fillRect(0,0,h.width,h.height)},v=()=>{const x=Math.max(e,.1);switch(n){case"right":l.current.x=(l.current.x-x+r)%r;break;case"left":l.current.x=(l.current.x+x+r)%r;break;case"up":l.current.y=(l.current.y+x+r)%r;break;case"down":l.current.y=(l.current.y-x+r)%r;break;case"diagonal":l.current.x=(l.current.x-x+r)%r,l.current.y=(l.current.y-x+r)%r;break}p(),s.current=requestAnimationFrame(v)},g=x=>{const _=h.getBoundingClientRect(),b=x.clientX-_.left,S=x.clientY-_.top,E=Math.floor(l.current.x/r)*r,C=Math.floor(l.current.y/r)*r,R=Math.floor((b+l.current.x-E)/r),T=Math.floor((S+l.current.y-C)/r);(!c.current||c.current.x!==R||c.current.y!==T)&&(c.current={x:R,y:T})},m=()=>{c.current=null};return h.addEventListener("mousemove",g),h.addEventListener("mouseleave",m),s.current=requestAnimationFrame(v),()=>{window.removeEventListener("resize",d),s.current&&cancelAnimationFrame(s.current),h.removeEventListener("mousemove",g),h.removeEventListener("mouseleave",m)}},[n,e,t,i,r]),G.jsx("canvas",{ref:o,className:"w-full h-full border-none block"})},pm=H.forwardRef(({customClass:n,...e},t)=>G.jsx("div",{ref:t,...e,className:`absolute top-1/2 left-1/2 rounded-xl border border-white/20 bg-surface [transform-style:preserve-3d] [will-change:transform] [backface-visibility:hidden] ${n??""} ${e.className??""}`.trim()}));pm.displayName="Card";const KM=(n,e,t,r)=>({x:n*e,y:-n*t,z:-n*e*1.5,zIndex:r-n}),lge=(n,e,t)=>en.set(n,{x:e.x,y:e.y,z:e.z,xPercent:-50,yPercent:-50,skewY:t,transformOrigin:"center center",zIndex:e.zIndex,force3D:!0}),cge=({width:n=500,height:e=400,cardDistance:t=60,verticalDistance:r=70,delay:i=5e3,pauseOnHover:o=!1,onCardClick:s,skewAmount:a=6,easing:u="elastic",children:l})=>{const c=u==="elastic"?{ease:"elastic.out(0.6,0.9)",durDrop:2,durMove:2,durReturn:2,promoteOverlap:.9,returnDelay:.05}:{ease:"power1.inOut",durDrop:.8,durMove:.8,durReturn:.8,promoteOverlap:.45,returnDelay:.2},h=H.useMemo(()=>H.Children.toArray(l),[l]),f=H.useMemo(()=>h.map(()=>q8.createRef()),[h.length]),d=H.useRef(Array.from({length:h.length},(x,_)=>_)),p=H.useRef(null),v=H.useRef(),g=H.useRef(null);H.useEffect(()=>{const x=f.length;f.forEach((b,S)=>lge(b.current,KM(S,t,r,x),a));const _=()=>{if(d.current.length<2)return;const[b,...S]=d.current,E=f[b].current,C=en.timeline();p.current=C,C.to(E,{y:"+=500",duration:c.durDrop,ease:c.ease}),C.addLabel("promote",`-=${c.durDrop*c.promoteOverlap}`),S.forEach((T,A)=>{const P=f[T].current,k=KM(A,t,r,f.length);C.set(P,{zIndex:k.zIndex},"promote"),C.to(P,{x:k.x,y:k.y,z:k.z,duration:c.durMove,ease:c.ease},`promote+=${A*.15}`)});const R=KM(f.length-1,t,r,f.length);C.addLabel("return",`promote+=${c.durMove*c.returnDelay}`),C.call(()=>{en.set(E,{zIndex:R.zIndex})},void 0,"return"),C.to(E,{x:R.x,y:R.y,z:R.z,duration:c.durReturn,ease:c.ease},"return"),C.call(()=>{d.current=[...S,b]})};if(_(),v.current=window.setInterval(_,i),o){const b=g.current,S=()=>{var C;(C=p.current)==null||C.pause(),clearInterval(v.current)},E=()=>{var C;(C=p.current)==null||C.play(),v.current=window.setInterval(_,i)};return b.addEventListener("mouseenter",S),b.addEventListener("mouseleave",E),()=>{b.removeEventListener("mouseenter",S),b.removeEventListener("mouseleave",E),clearInterval(v.current)}}return()=>clearInterval(v.current)},[t,r,i,o,a,u]);const m=h.map((x,_)=>H.isValidElement(x)?H.cloneElement(x,{key:_,ref:f[_],style:{width:n,height:e,...x.props.style??{}},onClick:b=>{var S,E;(E=(S=x.props).onClick)==null||E.call(S,b),s==null||s(_)}}):x);return G.jsx("div",{ref:g,className:"absolute bottom-0 right-0 transform translate-x-[5%] translate-y-[20%] origin-bottom-right perspective-[900px] overflow-visible max-[768px]:translate-x-[25%] max-[768px]:translate-y-[25%] max-[768px]:scale-[0.75] max-[480px]:translate-x-[25%] max-[480px]:translate-y-[25%] max-[480px]:scale-[0.55]",style:{width:n,height:e},children:m})},Bj=({children:n,autoPlayInterval:e=4e3,enableSwipe:t=!0,className:r=""})=>{const[i,o]=H.useState(0),[s,a]=H.useState(!1),u=H.useRef(null),l=H.useRef(0),c=H.useRef(0),h=Array.isArray(n)?n:[n],f=h.length;H.useEffect(()=>{const g=setInterval(()=>{s||(a(!0),o(m=>(m+1)%f),setTimeout(()=>a(!1),500))},e);return()=>clearInterval(g)},[f,e,s]);const d=g=>{t&&(l.current=g.touches[0].clientX)},p=g=>{t&&(c.current=g.touches[0].clientX)},v=()=>{if(!t||s)return;const g=l.current-c.current;Math.abs(g)>50&&(a(!0),g>0?o(x=>(x+1)%f):o(x=>(x-1+f)%f),setTimeout(()=>a(!1),500))};return G.jsxs("div",{ref:u,className:`relative w-full overflow-hidden ${r}`,onTouchStart:d,onTouchMove:p,onTouchEnd:v,children:[G.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${i*100}%)`},children:h.map((g,m)=>G.jsx("div",{className:"w-full flex-shrink-0 px-4",children:g},m))}),G.jsx("div",{className:"flex justify-center gap-2 mt-6",children:h.map((g,m)=>G.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${i===m?"w-6 bg-gradient-to-r from-primary via-secondary to-tertiary":"w-1.5 bg-white/20"}`},m))})]})},hge=()=>{const n=H.useRef(null),[e,t]=H.useState(window.innerWidth<=768);return H.useEffect(()=>{const r=()=>t(window.innerWidth<=768);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),H.useEffect(()=>{const r=new IntersectionObserver(i=>{i.forEach(o=>{o.isIntersecting&&o.target.classList.add("about-visible")})},{threshold:.2});return n.current&&r.observe(n.current),()=>{n.current&&r.unobserve(n.current)}},[]),G.jsxs("section",{ref:n,className:"relative min-h-screen w-full flex items-center justify-center overflow-visible opacity-0 translate-y-10 transition-all duration-1000 ease-out [&.about-visible]:opacity-100 [&.about-visible]:translate-y-0",children:[G.jsx("div",{className:"absolute inset-0 z-[1] pointer-events-none",children:G.jsx(uge,{direction:"diagonal",speed:.5,borderColor:"#7c3aed",squareSize:35,hoverFillColor:"rgba(124, 58, 237, 0.15)"})}),e?G.jsxs("div",{className:"relative z-[10] w-full h-full px-4 pt-20 pb-10",children:[G.jsxs("div",{className:"text-center mb-8",children:[G.jsx("h2",{className:"text-4xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift mb-4",children:"About Me"}),G.jsx("p",{className:"text-sm text-gray-300 leading-relaxed px-2",children:"I'm Mayank Kumar, a Computer Science undergraduate who enjoys exploring technology beyond the classroom."})]}),G.jsxs(Bj,{autoPlayInterval:4e3,enableSwipe:!0,children:[G.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-surface/80 backdrop-blur-md border border-primary/40 rounded-2xl p-6 flex flex-col items-center min-h-[320px]",children:[G.jsx("img",{src:Jr.Leetcode,alt:"LeetCode Achievements",className:"w-full h-40 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"LeetCode Journey"}),G.jsx("p",{className:"text-primary/80 text-center text-sm",children:"Problem-solving excellence"})]}),G.jsxs("div",{className:"bg-gradient-to-br from-secondary/20 to-surface/80 backdrop-blur-md border border-secondary/40 rounded-2xl p-6 flex flex-col items-center min-h-[320px]",children:[G.jsx("img",{src:Jr.Clean,alt:"Coding",className:"w-full h-40 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Clean Code"}),G.jsx("p",{className:"text-secondary-light/80 text-center text-sm",children:"Writing elegant solutions"})]}),G.jsxs("div",{className:"bg-gradient-to-br from-tertiary/20 to-surface/80 backdrop-blur-md border border-tertiary/40 rounded-2xl p-6 flex flex-col items-center min-h-[320px]",children:[G.jsx("img",{src:Jr.Consistent,alt:"Streaks",className:"w-full h-40 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Consistency"}),G.jsx("p",{className:"text-tertiary/80 text-center text-sm",children:"Daily coding streaks"})]}),G.jsxs("div",{className:"bg-gradient-to-br from-accent/20 to-surface/80 backdrop-blur-md border border-accent/40 rounded-2xl p-6 flex flex-col items-center min-h-[320px]",children:[G.jsx("img",{src:Jr.A1,alt:"Mayank Kumar",className:"w-full h-40 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Passionate Developer"}),G.jsx("p",{className:"text-accent/80 text-center text-sm",children:"Building the future"})]}),G.jsxs("div",{className:"bg-gradient-to-br from-warm/20 to-surface/80 backdrop-blur-md border border-warm/40 rounded-2xl p-6 flex flex-col items-center min-h-[320px]",children:[G.jsx("img",{src:Jr.Always,alt:"Hello",className:"w-full h-40 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Always Learning"}),G.jsx("p",{className:"text-warm/80 text-center text-sm",children:"Growth mindset"})]})]})]}):G.jsxs("div",{className:"relative z-[10] w-full max-w-7xl px-8 flex items-center justify-between gap-12",children:[G.jsxs("div",{className:"w-1/2 space-y-8",children:[G.jsx("h2",{className:"text-5xl sm:text-6xl md:text-7xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift",children:"About Me"}),G.jsx("div",{className:"text-lg sm:text-xl text-gray-300 leading-relaxed",children:G.jsx(xD,{text:"I'm Mayank Kumar, a Computer Science undergraduate who enjoys exploring technology beyond the classroom.",parentClassName:"max-w-2xl leading-relaxed mb-10 block",speed:20,maxIterations:15,sequential:!0,revealDirection:"start",animateOn:"view"})}),G.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-8",children:[G.jsxs("div",{className:"cursor-target aspect-square rounded-xl backdrop-blur-sm border border-primary/30 bg-gradient-to-br from-primary/10 to-surface/50 hover:border-primary/60 hover:scale-105 hover:shadow-[0_0_30px_rgba(0,212,255,0.4)] transition-all duration-300 flex flex-col justify-center items-center text-center group relative overflow-hidden opacity-0 translate-y-8 [.about-visible_&]:opacity-100 [.about-visible_&]:translate-y-0 [.about-visible_&]:transition-all [.about-visible_&]:duration-700 [.about-visible_&]:delay-300",children:[G.jsx("div",{className:"absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity duration-300",children:G.jsx("img",{src:Jr.Creative,alt:"Creative",className:"w-full h-full object-cover"})}),G.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0f]/95 via-[#0a0a0f]/60 to-transparent"}),G.jsxs("div",{className:"relative z-10",children:[G.jsx("h3",{className:"text-xl font-semibold text-primary mb-1",children:"Creative"}),G.jsx("p",{className:"text-xs text-primary-light/80",children:"Beautiful designs"})]})]}),G.jsxs("div",{className:"cursor-target aspect-square rounded-xl backdrop-blur-sm border border-secondary/30 bg-gradient-to-br from-secondary/10 to-surface/50 hover:border-secondary/60 hover:scale-105 hover:shadow-[0_0_30px_rgba(124,58,237,0.4)] transition-all duration-300 flex flex-col justify-center items-center text-center group relative overflow-hidden opacity-0 translate-y-8 [.about-visible_&]:opacity-100 [.about-visible_&]:translate-y-0 [.about-visible_&]:transition-all [.about-visible_&]:duration-700 [.about-visible_&]:delay-500",children:[G.jsx("div",{className:"absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity duration-300",children:G.jsx("img",{src:Jr.Technical,alt:"Technical",className:"w-full h-full object-cover"})}),G.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0f]/95 via-[#0a0a0f]/60 to-transparent"}),G.jsxs("div",{className:"relative z-10",children:[G.jsx("h3",{className:"text-xl font-semibold text-secondary-light mb-1",children:"Technical"}),G.jsx("p",{className:"text-xs text-secondary/80",children:"Robust solutions"})]})]}),G.jsxs("div",{className:"cursor-target aspect-square rounded-xl backdrop-blur-sm border border-tertiary/30 bg-gradient-to-br from-tertiary/10 to-surface/50 hover:border-tertiary/60 hover:scale-105 hover:shadow-[0_0_30px_rgba(244,114,182,0.4)] transition-all duration-300 flex flex-col justify-center items-center text-center group relative overflow-hidden opacity-0 translate-y-8 [.about-visible_&]:opacity-100 [.about-visible_&]:translate-y-0 [.about-visible_&]:transition-all [.about-visible_&]:duration-700 [.about-visible_&]:delay-700",children:[G.jsx("div",{className:"absolute inset-0 opacity-30 group-hover:opacity-50 transition-opacity duration-300",children:G.jsx("img",{src:Jr.Innovative,alt:"Innovative",className:"w-full h-full object-cover"})}),G.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-[#0a0a0f]/95 via-[#0a0a0f]/60 to-transparent"}),G.jsxs("div",{className:"relative z-10",children:[G.jsx("h3",{className:"text-xl font-semibold text-tertiary mb-1",children:"Innovative"}),G.jsx("p",{className:"text-xs text-tertiary-light/80",children:"New possibilities"})]})]})]})]}),G.jsx("div",{className:"w-1/2 relative h-[600px]",children:G.jsxs(cge,{width:400,height:500,cardDistance:40,verticalDistance:50,delay:4e3,pauseOnHover:!1,skewAmount:5,easing:"elastic",children:[G.jsxs(pm,{className:"bg-gradient-to-br from-primary/20 to-surface/80 backdrop-blur-md border-primary/40 p-8 flex flex-col justify-center items-center",children:[G.jsx("img",{src:Jr.Leetcode,alt:"LeetCode Achievements",className:"w-full h-3/4 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-2xl font-bold text-white",children:"LeetCode Journey"}),G.jsx("p",{className:"text-primary/80 text-center mt-2",children:"Problem-solving excellence"})]}),G.jsxs(pm,{className:"bg-gradient-to-br from-secondary/20 to-surface/80 backdrop-blur-md border-secondary/40 p-8 flex flex-col justify-center items-center",children:[G.jsx("img",{src:Jr.Clean,alt:"Coding",className:"w-full h-3/4 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-2xl font-bold text-white",children:"Clean Code"}),G.jsx("p",{className:"text-secondary-light/80 text-center mt-2",children:"Writing elegant solutions"})]}),G.jsxs(pm,{className:"bg-gradient-to-br from-tertiary/20 to-surface/80 backdrop-blur-md border-tertiary/40 p-8 flex flex-col justify-center items-center",children:[G.jsx("img",{src:Jr.Consistent,alt:"Streaks",className:"w-full h-3/4 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-2xl font-bold text-white",children:"Consistency"}),G.jsx("p",{className:"text-tertiary/80 text-center mt-2",children:"Daily coding streaks"})]}),G.jsxs(pm,{className:"bg-gradient-to-br from-accent/20 to-surface/80 backdrop-blur-md border-accent/40 p-8 flex flex-col justify-center items-center",children:[G.jsx("img",{src:Jr.A1,alt:"Mayank Kumar",className:"w-full h-3/4 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-2xl font-bold text-white",children:"Passionate Developer"}),G.jsx("p",{className:"text-accent/80 text-center mt-2",children:"Building the future"})]}),G.jsxs(pm,{className:"bg-gradient-to-br from-warm/20 to-surface/80 backdrop-blur-md border-warm/40 p-8 flex flex-col justify-center items-center",children:[G.jsx("img",{src:Jr.Always,alt:"Hello",className:"w-full h-3/4 object-cover rounded-lg mb-4"}),G.jsx("h3",{className:"text-2xl font-bold text-white",children:"Always Learning"}),G.jsx("p",{className:"text-warm/80 text-center mt-2",children:"Growth mindset"})]})]})})]})]})};function py(n){let e=n[0],t=n[1],r=n[2];return Math.sqrt(e*e+t*t+r*r)}function BI(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function fge(n,e,t,r){return n[0]=e,n[1]=t,n[2]=r,n}function wz(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function _z(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function dge(n,e,t){return n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n}function pge(n,e,t){return n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n}function ZM(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}function mge(n,e){let t=e[0]-n[0],r=e[1]-n[1],i=e[2]-n[2];return Math.sqrt(t*t+r*r+i*i)}function vge(n,e){let t=e[0]-n[0],r=e[1]-n[1],i=e[2]-n[2];return t*t+r*r+i*i}function bz(n){let e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}function gge(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function yge(n,e){return n[0]=1/e[0],n[1]=1/e[1],n[2]=1/e[2],n}function UI(n,e){let t=e[0],r=e[1],i=e[2],o=t*t+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n}function Uj(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Sz(n,e,t){let r=e[0],i=e[1],o=e[2],s=t[0],a=t[1],u=t[2];return n[0]=i*u-o*a,n[1]=o*s-r*u,n[2]=r*a-i*s,n}function xge(n,e,t,r){let i=e[0],o=e[1],s=e[2];return n[0]=i+r*(t[0]-i),n[1]=o+r*(t[1]-o),n[2]=s+r*(t[2]-s),n}function wge(n,e,t,r,i){const o=Math.exp(-r*i);let s=e[0],a=e[1],u=e[2];return n[0]=t[0]+(s-t[0])*o,n[1]=t[1]+(a-t[1])*o,n[2]=t[2]+(u-t[2])*o,n}function _ge(n,e,t){let r=e[0],i=e[1],o=e[2],s=t[3]*r+t[7]*i+t[11]*o+t[15];return s=s||1,n[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])/s,n[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])/s,n[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])/s,n}function bge(n,e,t){let r=e[0],i=e[1],o=e[2],s=t[3]*r+t[7]*i+t[11]*o+t[15];return s=s||1,n[0]=(t[0]*r+t[4]*i+t[8]*o)/s,n[1]=(t[1]*r+t[5]*i+t[9]*o)/s,n[2]=(t[2]*r+t[6]*i+t[10]*o)/s,n}function Sge(n,e,t){let r=e[0],i=e[1],o=e[2];return n[0]=r*t[0]+i*t[3]+o*t[6],n[1]=r*t[1]+i*t[4]+o*t[7],n[2]=r*t[2]+i*t[5]+o*t[8],n}function Ege(n,e,t){let r=e[0],i=e[1],o=e[2],s=t[0],a=t[1],u=t[2],l=t[3],c=a*o-u*i,h=u*r-s*o,f=s*i-a*r,d=a*f-u*h,p=u*c-s*f,v=s*h-a*c,g=l*2;return c*=g,h*=g,f*=g,d*=2,p*=2,v*=2,n[0]=r+c+d,n[1]=i+h+p,n[2]=o+f+v,n}const Cge=function(){const n=[0,0,0],e=[0,0,0];return function(t,r){BI(n,t),BI(e,r),UI(n,n),UI(e,e);let i=Uj(n,e);return i>1?0:i<-1?Math.PI:Math.acos(i)}}();function Mge(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}class vu extends Array{constructor(e=0,t=e,r=e){return super(e,t,r),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this[0]=e}set y(e){this[1]=e}set z(e){this[2]=e}set(e,t=e,r=e){return e.length?this.copy(e):(fge(this,e,t,r),this)}copy(e){return BI(this,e),this}add(e,t){return t?wz(this,e,t):wz(this,this,e),this}sub(e,t){return t?_z(this,e,t):_z(this,this,e),this}multiply(e){return e.length?dge(this,this,e):ZM(this,this,e),this}divide(e){return e.length?pge(this,this,e):ZM(this,this,1/e),this}inverse(e=this){return yge(this,e),this}len(){return py(this)}distance(e){return e?mge(this,e):py(this)}squaredLen(){return bz(this)}squaredDistance(e){return e?vge(this,e):bz(this)}negate(e=this){return gge(this,e),this}cross(e,t){return t?Sz(this,e,t):Sz(this,this,e),this}scale(e){return ZM(this,this,e),this}normalize(){return UI(this,this),this}dot(e){return Uj(this,e)}equals(e){return Mge(this,e)}applyMatrix3(e){return Sge(this,this,e),this}applyMatrix4(e){return _ge(this,this,e),this}scaleRotateMatrix4(e){return bge(this,this,e),this}applyQuaternion(e){return Ege(this,this,e),this}angle(e){return Cge(this,e)}lerp(e,t){return xge(this,this,e,t),this}smoothLerp(e,t,r){return wge(this,this,e,t,r),this}clone(){return new vu(this[0],this[1],this[2])}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}transformDirection(e){const t=this[0],r=this[1],i=this[2];return this[0]=e[0]*t+e[4]*r+e[8]*i,this[1]=e[1]*t+e[5]*r+e[9]*i,this[2]=e[2]*t+e[6]*r+e[10]*i,this.normalize()}}const Ez=new vu;let Tge=1,Rge=1,Cz=!1;class Age{constructor(e,t={}){e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=t,this.id=Tge++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let r in t)this.addAttribute(r,t[r])}addAttribute(e,t){if(this.attributes[e]=t,t.id=Rge++,t.size=t.size||1,t.type=t.type||(t.data.constructor===Float32Array?this.gl.FLOAT:t.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),t.target=e==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,t.normalized=t.normalized||!1,t.stride=t.stride||0,t.offset=t.offset||0,t.count=t.count||(t.stride?t.data.byteLength/t.stride:t.data.length/t.size),t.divisor=t.instanced||0,t.needsUpdate=!1,t.usage=t.usage||this.gl.STATIC_DRAW,t.buffer||this.updateAttribute(t),t.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==t.count*t.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,t.count*t.divisor);this.instancedCount=t.count*t.divisor}else e==="index"?this.drawRange.count=t.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,t.count))}updateAttribute(e){const t=!e.buffer;t&&(e.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==e.buffer&&(this.gl.bindBuffer(e.target,e.buffer),this.glState.boundBuffer=e.buffer),t?this.gl.bufferData(e.target,e.data,e.usage):this.gl.bufferSubData(e.target,0,e.data),e.needsUpdate=!1}setIndex(e){this.addAttribute("index",e)}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}setInstancedCount(e){this.instancedCount=e}createVAO(e){this.VAOs[e.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.bindAttributes(e)}bindAttributes(e){e.attributeLocations.forEach((t,{name:r,type:i})=>{if(!this.attributes[r]){console.warn(`active attribute ${r} not being supplied`);return}const o=this.attributes[r];this.gl.bindBuffer(o.target,o.buffer),this.glState.boundBuffer=o.buffer;let s=1;i===35674&&(s=2),i===35675&&(s=3),i===35676&&(s=4);const a=o.size/s,u=s===1?0:s*s*4,l=s===1?0:s*4;for(let c=0;c<s;c++)this.gl.vertexAttribPointer(t+c,a,o.type,o.normalized,o.stride+u,o.offset+c*l),this.gl.enableVertexAttribArray(t+c),this.gl.renderer.vertexAttribDivisor(t+c,o.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:e,mode:t=this.gl.TRIANGLES}){var i;this.gl.renderer.currentGeometry!==`${this.id}_${e.attributeOrder}`&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${e.attributeOrder}`),e.attributeLocations.forEach((o,{name:s})=>{const a=this.attributes[s];a.needsUpdate&&this.updateAttribute(a)});let r=2;((i=this.attributes.index)==null?void 0:i.type)===this.gl.UNSIGNED_INT&&(r=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r,this.instancedCount):this.gl.renderer.drawArraysInstanced(t,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(t,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*r):this.gl.drawArrays(t,this.drawRange.start,this.drawRange.count)}getPosition(){const e=this.attributes.position;if(e.data)return e;if(!Cz)return console.warn("No position buffer data found to compute bounds"),Cz=!0}computeBoundingBox(e){e||(e=this.getPosition());const t=e.data,r=e.size;this.bounds||(this.bounds={min:new vu,max:new vu,center:new vu,scale:new vu,radius:1/0});const i=this.bounds.min,o=this.bounds.max,s=this.bounds.center,a=this.bounds.scale;i.set(1/0),o.set(-1/0);for(let u=0,l=t.length;u<l;u+=r){const c=t[u],h=t[u+1],f=t[u+2];i.x=Math.min(c,i.x),i.y=Math.min(h,i.y),i.z=Math.min(f,i.z),o.x=Math.max(c,o.x),o.y=Math.max(h,o.y),o.z=Math.max(f,o.z)}a.sub(o,i),s.add(i,o).divide(2)}computeBoundingSphere(e){e||(e=this.getPosition());const t=e.data,r=e.size;this.bounds||this.computeBoundingBox(e);let i=0;for(let o=0,s=t.length;o<s;o+=r)Ez.fromArray(t,o),i=Math.max(i,this.bounds.center.squaredDistance(Ez));this.bounds.radius=Math.sqrt(i)}remove(){for(let e in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[e]),delete this.VAOs[e];for(let e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}let Ige=1;const Mz={};class Pge{constructor(e,{vertex:t,fragment:r,uniforms:i={},transparent:o=!1,cullFace:s=e.BACK,frontFace:a=e.CCW,depthTest:u=!0,depthWrite:l=!0,depthFunc:c=e.LEQUAL}={}){e.canvas||console.error("gl not passed as first argument to Program"),this.gl=e,this.uniforms=i,this.id=Ige++,t||console.warn("vertex shader not supplied"),r||console.warn("fragment shader not supplied"),this.transparent=o,this.cullFace=s,this.frontFace=a,this.depthTest=u,this.depthWrite=l,this.depthFunc=c,this.blendFunc={},this.blendEquation={},this.stencilFunc={},this.stencilOp={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)),this.vertexShader=e.createShader(e.VERTEX_SHADER),this.fragmentShader=e.createShader(e.FRAGMENT_SHADER),this.program=e.createProgram(),e.attachShader(this.program,this.vertexShader),e.attachShader(this.program,this.fragmentShader),this.setShaders({vertex:t,fragment:r})}setShaders({vertex:e,fragment:t}){if(e&&(this.gl.shaderSource(this.vertexShader,e),this.gl.compileShader(this.vertexShader),this.gl.getShaderInfoLog(this.vertexShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.vertexShader)}
Vertex Shader
${Tz(e)}`)),t&&(this.gl.shaderSource(this.fragmentShader,t),this.gl.compileShader(this.fragmentShader),this.gl.getShaderInfoLog(this.fragmentShader)!==""&&console.warn(`${this.gl.getShaderInfoLog(this.fragmentShader)}
Fragment Shader
${Tz(t)}`)),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return console.warn(this.gl.getProgramInfoLog(this.program));this.uniformLocations=new Map;let r=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let s=0;s<r;s++){let a=this.gl.getActiveUniform(this.program,s);this.uniformLocations.set(a,this.gl.getUniformLocation(this.program,a.name));const u=a.name.match(/(\w+)/g);a.uniformName=u[0],a.nameComponents=u.slice(1)}this.attributeLocations=new Map;const i=[],o=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let s=0;s<o;s++){const a=this.gl.getActiveAttrib(this.program,s),u=this.gl.getAttribLocation(this.program,a.name);u!==-1&&(i[u]=a.name,this.attributeLocations.set(a,u))}this.attributeOrder=i.join("")}setBlendFunc(e,t,r,i){this.blendFunc.src=e,this.blendFunc.dst=t,this.blendFunc.srcAlpha=r,this.blendFunc.dstAlpha=i,e&&(this.transparent=!0)}setBlendEquation(e,t){this.blendEquation.modeRGB=e,this.blendEquation.modeAlpha=t}setStencilFunc(e,t,r){this.stencilRef=t,this.stencilFunc.func=e,this.stencilFunc.ref=t,this.stencilFunc.mask=r}setStencilOp(e,t,r){this.stencilOp.stencilFail=e,this.stencilOp.depthFail=t,this.stencilOp.depthPass=r}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha),this.stencilFunc.func||this.stencilOp.stencilFail?this.gl.renderer.enable(this.gl.STENCIL_TEST):this.gl.renderer.disable(this.gl.STENCIL_TEST),this.gl.renderer.setStencilFunc(this.stencilFunc.func,this.stencilFunc.ref,this.stencilFunc.mask),this.gl.renderer.setStencilOp(this.stencilOp.stencilFail,this.stencilOp.depthFail,this.stencilOp.depthPass)}use({flipFaces:e=!1}={}){let t=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((i,o)=>{let s=this.uniforms[o.uniformName];for(const a of o.nameComponents){if(!s)break;if(a in s)s=s[a];else{if(Array.isArray(s.value))break;s=void 0;break}}if(!s)return Rz(`Active uniform ${o.name} has not been supplied`);if(s&&s.value===void 0)return Rz(`${o.name} uniform is missing a value parameter`);if(s.value.texture)return t=t+1,s.value.update(t),QM(this.gl,o.type,i,t);if(s.value.length&&s.value[0].texture){const a=[];return s.value.forEach(u=>{t=t+1,u.update(t),a.push(t)}),QM(this.gl,o.type,i,a)}QM(this.gl,o.type,i,s.value)}),this.applyState(),e&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function QM(n,e,t,r){r=r.length?kge(r):r;const i=n.renderer.state.uniformLocations.get(t);if(r.length)if(i===void 0||i.length!==r.length)n.renderer.state.uniformLocations.set(t,r.slice(0));else{if(Dge(i,r))return;i.set?i.set(r):Nge(i,r),n.renderer.state.uniformLocations.set(t,i)}else{if(i===r)return;n.renderer.state.uniformLocations.set(t,r)}switch(e){case 5126:return r.length?n.uniform1fv(t,r):n.uniform1f(t,r);case 35664:return n.uniform2fv(t,r);case 35665:return n.uniform3fv(t,r);case 35666:return n.uniform4fv(t,r);case 35670:case 5124:case 35678:case 36306:case 35680:case 36289:return r.length?n.uniform1iv(t,r):n.uniform1i(t,r);case 35671:case 35667:return n.uniform2iv(t,r);case 35672:case 35668:return n.uniform3iv(t,r);case 35673:case 35669:return n.uniform4iv(t,r);case 35674:return n.uniformMatrix2fv(t,!1,r);case 35675:return n.uniformMatrix3fv(t,!1,r);case 35676:return n.uniformMatrix4fv(t,!1,r)}}function Tz(n){let e=n.split(`
`);for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join(`
`)}function kge(n){const e=n.length,t=n[0].length;if(t===void 0)return n;const r=e*t;let i=Mz[r];i||(Mz[r]=i=new Float32Array(r));for(let o=0;o<e;o++)i.set(n[o],o*t);return i}function Dge(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Nge(n,e){for(let t=0,r=n.length;t<r;t++)n[t]=e[t]}let JM=0;function Rz(n){JM>100||(console.warn(n),JM++,JM>100&&console.warn("More than 100 program warnings - stopping logs."))}const eT=new vu;let Lge=1;class Fge{constructor({canvas:e=document.createElement("canvas"),width:t=300,height:r=150,dpr:i=1,alpha:o=!1,depth:s=!0,stencil:a=!1,antialias:u=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:c=!1,powerPreference:h="default",autoClear:f=!0,webgl:d=2}={}){const p={alpha:o,depth:s,stencil:a,antialias:u,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h};this.dpr=i,this.alpha=o,this.color=!0,this.depth=s,this.stencil=a,this.premultipliedAlpha=l,this.autoClear=f,this.id=Lge++,d===2&&(this.gl=e.getContext("webgl2",p)),this.isWebgl2=!!this.gl,this.gl||(this.gl=e.getContext("webgl",p)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(t,r),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LEQUAL,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(e,t){this.width=e,this.height=t,this.gl.canvas.width=e*this.dpr,this.gl.canvas.height=t*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:e+"px",height:t+"px"})}setViewport(e,t,r=0,i=0){this.state.viewport.width===e&&this.state.viewport.height===t||(this.state.viewport.width=e,this.state.viewport.height=t,this.state.viewport.x=r,this.state.viewport.y=i,this.gl.viewport(r,i,e,t))}setScissor(e,t,r=0,i=0){this.gl.scissor(r,i,e,t)}enable(e){this.state[e]!==!0&&(this.gl.enable(e),this.state[e]=!0)}disable(e){this.state[e]!==!1&&(this.gl.disable(e),this.state[e]=!1)}setBlendFunc(e,t,r,i){this.state.blendFunc.src===e&&this.state.blendFunc.dst===t&&this.state.blendFunc.srcAlpha===r&&this.state.blendFunc.dstAlpha===i||(this.state.blendFunc.src=e,this.state.blendFunc.dst=t,this.state.blendFunc.srcAlpha=r,this.state.blendFunc.dstAlpha=i,r!==void 0?this.gl.blendFuncSeparate(e,t,r,i):this.gl.blendFunc(e,t))}setBlendEquation(e,t){e=e||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===e&&this.state.blendEquation.modeAlpha===t)&&(this.state.blendEquation.modeRGB=e,this.state.blendEquation.modeAlpha=t,t!==void 0?this.gl.blendEquationSeparate(e,t):this.gl.blendEquation(e))}setCullFace(e){this.state.cullFace!==e&&(this.state.cullFace=e,this.gl.cullFace(e))}setFrontFace(e){this.state.frontFace!==e&&(this.state.frontFace=e,this.gl.frontFace(e))}setDepthMask(e){this.state.depthMask!==e&&(this.state.depthMask=e,this.gl.depthMask(e))}setDepthFunc(e){this.state.depthFunc!==e&&(this.state.depthFunc=e,this.gl.depthFunc(e))}setStencilMask(e){this.state.stencilMask!==e&&(this.state.stencilMask=e,this.gl.stencilMask(e))}setStencilFunc(e,t,r){this.state.stencilFunc===e&&this.state.stencilRef===t&&this.state.stencilFuncMask===r||(this.state.stencilFunc=e||this.gl.ALWAYS,this.state.stencilRef=t||0,this.state.stencilFuncMask=r||0,this.gl.stencilFunc(e||this.gl.ALWAYS,t||0,r||0))}setStencilOp(e,t,r){this.state.stencilFail===e&&this.state.stencilDepthFail===t&&this.state.stencilDepthPass===r||(this.state.stencilFail=e,this.state.stencilDepthFail=t,this.state.stencilDepthPass=r,this.gl.stencilOp(e,t,r))}activeTexture(e){this.state.activeTextureUnit!==e&&(this.state.activeTextureUnit=e,this.gl.activeTexture(this.gl.TEXTURE0+e))}bindFramebuffer({target:e=this.gl.FRAMEBUFFER,buffer:t=null}={}){this.state.framebuffer!==t&&(this.state.framebuffer=t,this.gl.bindFramebuffer(e,t))}getExtension(e,t,r){return t&&this.gl[t]?this.gl[t].bind(this.gl):(this.extensions[e]||(this.extensions[e]=this.gl.getExtension(e)),t?this.extensions[e]?this.extensions[e][r].bind(this.extensions[e]):null:this.extensions[e])}sortOpaque(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:e.zDepth!==t.zDepth?e.zDepth-t.zDepth:t.id-e.id}sortTransparent(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.zDepth!==t.zDepth?t.zDepth-e.zDepth:t.id-e.id}sortUI(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program.id!==t.program.id?e.program.id-t.program.id:t.id-e.id}getRenderList({scene:e,camera:t,frustumCull:r,sort:i}){let o=[];if(t&&r&&t.updateFrustum(),e.traverse(s=>{if(!s.visible)return!0;s.draw&&(r&&s.frustumCulled&&t&&!t.frustumIntersectsMesh(s)||o.push(s))}),i){const s=[],a=[],u=[];o.forEach(l=>{l.program.transparent?l.program.depthTest?a.push(l):u.push(l):s.push(l),l.zDepth=0,!(l.renderOrder!==0||!l.program.depthTest||!t)&&(l.worldMatrix.getTranslation(eT),eT.applyMatrix4(t.projectionViewMatrix),l.zDepth=eT.z)}),s.sort(this.sortOpaque),a.sort(this.sortTransparent),u.sort(this.sortUI),o=s.concat(a,u)}return o}render({scene:e,camera:t,target:r=null,update:i=!0,sort:o=!0,frustumCull:s=!0,clear:a}){r===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(a||this.autoClear&&a!==!1)&&(this.depth&&(!r||r.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),(this.stencil||!r||r.stencil)&&(this.enable(this.gl.STENCIL_TEST),this.setStencilMask(255)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),i&&e.updateMatrixWorld(),t&&t.updateMatrixWorld(),this.getRenderList({scene:e,camera:t,frustumCull:s,sort:o}).forEach(l=>{l.draw({camera:t})})}}function Oge(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Bge(n,e,t,r,i){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function Uge(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=t*t+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),n[0]=t*s,n[1]=r*s,n[2]=i*s,n[3]=o*s,n}function zge(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]}function Vge(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Wge(n,e,t){t=t*.5;let r=Math.sin(t);return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=Math.cos(t),n}function Az(n,e,t){let r=e[0],i=e[1],o=e[2],s=e[3],a=t[0],u=t[1],l=t[2],c=t[3];return n[0]=r*c+s*a+i*l-o*u,n[1]=i*c+s*u+o*a-r*l,n[2]=o*c+s*l+r*u-i*a,n[3]=s*c-r*a-i*u-o*l,n}function Hge(n,e,t){t*=.5;let r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+s*a,n[1]=i*u+o*a,n[2]=o*u-i*a,n[3]=s*u-r*a,n}function Gge(n,e,t){t*=.5;let r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u-o*a,n[1]=i*u+s*a,n[2]=o*u+r*a,n[3]=s*u-i*a,n}function $ge(n,e,t){t*=.5;let r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(t),u=Math.cos(t);return n[0]=r*u+i*a,n[1]=i*u-r*a,n[2]=o*u+s*a,n[3]=s*u-o*a,n}function jge(n,e,t,r){let i=e[0],o=e[1],s=e[2],a=e[3],u=t[0],l=t[1],c=t[2],h=t[3],f,d,p,v,g;return d=i*u+o*l+s*c+a*h,d<0&&(d=-d,u=-u,l=-l,c=-c,h=-h),1-d>1e-6?(f=Math.acos(d),p=Math.sin(f),v=Math.sin((1-r)*f)/p,g=Math.sin(r*f)/p):(v=1-r,g=r),n[0]=v*i+g*u,n[1]=v*o+g*l,n[2]=v*s+g*c,n[3]=v*a+g*h,n}function Xge(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=t*t+r*r+i*i+o*o,a=s?1/s:0;return n[0]=-t*a,n[1]=-r*a,n[2]=-i*a,n[3]=o*a,n}function qge(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n}function Yge(n,e){let t=e[0]+e[4]+e[8],r;if(t>0)r=Math.sqrt(t+1),n[3]=.5*r,r=.5/r,n[0]=(e[5]-e[7])*r,n[1]=(e[6]-e[2])*r,n[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);let o=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[o*3+o]-e[s*3+s]+1),n[i]=.5*r,r=.5/r,n[3]=(e[o*3+s]-e[s*3+o])*r,n[o]=(e[o*3+i]+e[i*3+o])*r,n[s]=(e[s*3+i]+e[i*3+s])*r}return n}function Kge(n,e,t="YXZ"){let r=Math.sin(e[0]*.5),i=Math.cos(e[0]*.5),o=Math.sin(e[1]*.5),s=Math.cos(e[1]*.5),a=Math.sin(e[2]*.5),u=Math.cos(e[2]*.5);return t==="XYZ"?(n[0]=r*s*u+i*o*a,n[1]=i*o*u-r*s*a,n[2]=i*s*a+r*o*u,n[3]=i*s*u-r*o*a):t==="YXZ"?(n[0]=r*s*u+i*o*a,n[1]=i*o*u-r*s*a,n[2]=i*s*a-r*o*u,n[3]=i*s*u+r*o*a):t==="ZXY"?(n[0]=r*s*u-i*o*a,n[1]=i*o*u+r*s*a,n[2]=i*s*a+r*o*u,n[3]=i*s*u-r*o*a):t==="ZYX"?(n[0]=r*s*u-i*o*a,n[1]=i*o*u+r*s*a,n[2]=i*s*a-r*o*u,n[3]=i*s*u+r*o*a):t==="YZX"?(n[0]=r*s*u+i*o*a,n[1]=i*o*u+r*s*a,n[2]=i*s*a-r*o*u,n[3]=i*s*u-r*o*a):t==="XZY"&&(n[0]=r*s*u-i*o*a,n[1]=i*o*u-r*s*a,n[2]=i*s*a+r*o*u,n[3]=i*s*u+r*o*a),n}const Zge=Oge,Qge=Bge,Jge=zge,e0e=Uge;class t0e extends Array{constructor(e=0,t=0,r=0,i=1){super(e,t,r,i),this.onChange=()=>{},this._target=this;const o=["0","1","2","3"];return new Proxy(this,{set(s,a){const u=Reflect.set(...arguments);return u&&o.includes(a)&&s.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set w(e){this._target[3]=e,this.onChange()}identity(){return Vge(this._target),this.onChange(),this}set(e,t,r,i){return e.length?this.copy(e):(Qge(this._target,e,t,r,i),this.onChange(),this)}rotateX(e){return Hge(this._target,this._target,e),this.onChange(),this}rotateY(e){return Gge(this._target,this._target,e),this.onChange(),this}rotateZ(e){return $ge(this._target,this._target,e),this.onChange(),this}inverse(e=this._target){return Xge(this._target,e),this.onChange(),this}conjugate(e=this._target){return qge(this._target,e),this.onChange(),this}copy(e){return Zge(this._target,e),this.onChange(),this}normalize(e=this._target){return e0e(this._target,e),this.onChange(),this}multiply(e,t){return t?Az(this._target,e,t):Az(this._target,this._target,e),this.onChange(),this}dot(e){return Jge(this._target,e)}fromMatrix3(e){return Yge(this._target,e),this.onChange(),this}fromEuler(e,t){return Kge(this._target,e,e.order),t||this.onChange(),this}fromAxisAngle(e,t){return Wge(this._target,e,t),this.onChange(),this}slerp(e,t){return jge(this._target,this._target,e,t),this.onChange(),this}fromArray(e,t=0){return this._target[0]=e[t],this._target[1]=e[t+1],this._target[2]=e[t+2],this._target[3]=e[t+3],this.onChange(),this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e}}const n0e=1e-6;function r0e(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function i0e(n,e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n[4]=o,n[5]=s,n[6]=a,n[7]=u,n[8]=l,n[9]=c,n[10]=h,n[11]=f,n[12]=d,n[13]=p,n[14]=v,n[15]=g,n}function o0e(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function s0e(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],x=t*a-r*s,_=t*u-i*s,b=t*l-o*s,S=r*u-i*a,E=r*l-o*a,C=i*l-o*u,R=c*v-h*p,T=c*g-f*p,A=c*m-d*p,P=h*g-f*v,k=h*m-d*v,W=f*m-d*g,N=x*W-_*k+b*P+S*A-E*T+C*R;return N?(N=1/N,n[0]=(a*W-u*k+l*P)*N,n[1]=(i*k-r*W-o*P)*N,n[2]=(v*C-g*E+m*S)*N,n[3]=(f*E-h*C-d*S)*N,n[4]=(u*A-s*W-l*T)*N,n[5]=(t*W-i*A+o*T)*N,n[6]=(g*b-p*C-m*_)*N,n[7]=(c*C-f*b+d*_)*N,n[8]=(s*k-a*A+l*R)*N,n[9]=(r*A-t*k-o*R)*N,n[10]=(p*E-v*b+m*x)*N,n[11]=(h*b-c*E-d*x)*N,n[12]=(a*T-s*P-u*R)*N,n[13]=(t*P-r*T+i*R)*N,n[14]=(v*_-p*S-g*x)*N,n[15]=(c*S-h*_+f*x)*N,n):null}function zj(n){let e=n[0],t=n[1],r=n[2],i=n[3],o=n[4],s=n[5],a=n[6],u=n[7],l=n[8],c=n[9],h=n[10],f=n[11],d=n[12],p=n[13],v=n[14],g=n[15],m=e*s-t*o,x=e*a-r*o,_=e*u-i*o,b=t*a-r*s,S=t*u-i*s,E=r*u-i*a,C=l*p-c*d,R=l*v-h*d,T=l*g-f*d,A=c*v-h*p,P=c*g-f*p,k=h*g-f*v;return m*k-x*P+_*A+b*T-S*R+E*C}function Iz(n,e,t){let r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],v=e[12],g=e[13],m=e[14],x=e[15],_=t[0],b=t[1],S=t[2],E=t[3];return n[0]=_*r+b*a+S*h+E*v,n[1]=_*i+b*u+S*f+E*g,n[2]=_*o+b*l+S*d+E*m,n[3]=_*s+b*c+S*p+E*x,_=t[4],b=t[5],S=t[6],E=t[7],n[4]=_*r+b*a+S*h+E*v,n[5]=_*i+b*u+S*f+E*g,n[6]=_*o+b*l+S*d+E*m,n[7]=_*s+b*c+S*p+E*x,_=t[8],b=t[9],S=t[10],E=t[11],n[8]=_*r+b*a+S*h+E*v,n[9]=_*i+b*u+S*f+E*g,n[10]=_*o+b*l+S*d+E*m,n[11]=_*s+b*c+S*p+E*x,_=t[12],b=t[13],S=t[14],E=t[15],n[12]=_*r+b*a+S*h+E*v,n[13]=_*i+b*u+S*f+E*g,n[14]=_*o+b*l+S*d+E*m,n[15]=_*s+b*c+S*p+E*x,n}function a0e(n,e,t){let r=t[0],i=t[1],o=t[2],s,a,u,l,c,h,f,d,p,v,g,m;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*o+e[12],n[13]=e[1]*r+e[5]*i+e[9]*o+e[13],n[14]=e[2]*r+e[6]*i+e[10]*o+e[14],n[15]=e[3]*r+e[7]*i+e[11]*o+e[15]):(s=e[0],a=e[1],u=e[2],l=e[3],c=e[4],h=e[5],f=e[6],d=e[7],p=e[8],v=e[9],g=e[10],m=e[11],n[0]=s,n[1]=a,n[2]=u,n[3]=l,n[4]=c,n[5]=h,n[6]=f,n[7]=d,n[8]=p,n[9]=v,n[10]=g,n[11]=m,n[12]=s*r+c*i+p*o+e[12],n[13]=a*r+h*i+v*o+e[13],n[14]=u*r+f*i+g*o+e[14],n[15]=l*r+d*i+m*o+e[15]),n}function u0e(n,e,t){let r=t[0],i=t[1],o=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function l0e(n,e,t,r){let i=r[0],o=r[1],s=r[2],a=Math.hypot(i,o,s),u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R,T,A,P,k,W,N,O;return Math.abs(a)<n0e?null:(a=1/a,i*=a,o*=a,s*=a,u=Math.sin(t),l=Math.cos(t),c=1-l,h=e[0],f=e[1],d=e[2],p=e[3],v=e[4],g=e[5],m=e[6],x=e[7],_=e[8],b=e[9],S=e[10],E=e[11],C=i*i*c+l,R=o*i*c+s*u,T=s*i*c-o*u,A=i*o*c-s*u,P=o*o*c+l,k=s*o*c+i*u,W=i*s*c+o*u,N=o*s*c-i*u,O=s*s*c+l,n[0]=h*C+v*R+_*T,n[1]=f*C+g*R+b*T,n[2]=d*C+m*R+S*T,n[3]=p*C+x*R+E*T,n[4]=h*A+v*P+_*k,n[5]=f*A+g*P+b*k,n[6]=d*A+m*P+S*k,n[7]=p*A+x*P+E*k,n[8]=h*W+v*N+_*O,n[9]=f*W+g*N+b*O,n[10]=d*W+m*N+S*O,n[11]=p*W+x*N+E*O,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function c0e(n,e){return n[0]=e[12],n[1]=e[13],n[2]=e[14],n}function Vj(n,e){let t=e[0],r=e[1],i=e[2],o=e[4],s=e[5],a=e[6],u=e[8],l=e[9],c=e[10];return n[0]=Math.hypot(t,r,i),n[1]=Math.hypot(o,s,a),n[2]=Math.hypot(u,l,c),n}function h0e(n){let e=n[0],t=n[1],r=n[2],i=n[4],o=n[5],s=n[6],a=n[8],u=n[9],l=n[10];const c=e*e+t*t+r*r,h=i*i+o*o+s*s,f=a*a+u*u+l*l;return Math.sqrt(Math.max(c,h,f))}const Wj=function(){const n=[1,1,1];return function(e,t){let r=n;Vj(r,t);let i=1/r[0],o=1/r[1],s=1/r[2],a=t[0]*i,u=t[1]*o,l=t[2]*s,c=t[4]*i,h=t[5]*o,f=t[6]*s,d=t[8]*i,p=t[9]*o,v=t[10]*s,g=a+h+v,m=0;return g>0?(m=Math.sqrt(g+1)*2,e[3]=.25*m,e[0]=(f-p)/m,e[1]=(d-l)/m,e[2]=(u-c)/m):a>h&&a>v?(m=Math.sqrt(1+a-h-v)*2,e[3]=(f-p)/m,e[0]=.25*m,e[1]=(u+c)/m,e[2]=(d+l)/m):h>v?(m=Math.sqrt(1+h-a-v)*2,e[3]=(d-l)/m,e[0]=(u+c)/m,e[1]=.25*m,e[2]=(f+p)/m):(m=Math.sqrt(1+v-a-h)*2,e[3]=(u-c)/m,e[0]=(d+l)/m,e[1]=(f+p)/m,e[2]=.25*m),e}}();function f0e(n,e,t,r){let i=py([n[0],n[1],n[2]]);const o=py([n[4],n[5],n[6]]),s=py([n[8],n[9],n[10]]);zj(n)<0&&(i=-i),t[0]=n[12],t[1]=n[13],t[2]=n[14];const u=n.slice(),l=1/i,c=1/o,h=1/s;u[0]*=l,u[1]*=l,u[2]*=l,u[4]*=c,u[5]*=c,u[6]*=c,u[8]*=h,u[9]*=h,u[10]*=h,Wj(e,u),r[0]=i,r[1]=o,r[2]=s}function d0e(n,e,t,r){const i=n,o=e[0],s=e[1],a=e[2],u=e[3],l=o+o,c=s+s,h=a+a,f=o*l,d=o*c,p=o*h,v=s*c,g=s*h,m=a*h,x=u*l,_=u*c,b=u*h,S=r[0],E=r[1],C=r[2];return i[0]=(1-(v+m))*S,i[1]=(d+b)*S,i[2]=(p-_)*S,i[3]=0,i[4]=(d-b)*E,i[5]=(1-(f+m))*E,i[6]=(g+x)*E,i[7]=0,i[8]=(p+_)*C,i[9]=(g-x)*C,i[10]=(1-(f+v))*C,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function p0e(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=t+t,a=r+r,u=i+i,l=t*s,c=r*s,h=r*a,f=i*s,d=i*a,p=i*u,v=o*s,g=o*a,m=o*u;return n[0]=1-h-p,n[1]=c+m,n[2]=f-g,n[3]=0,n[4]=c-m,n[5]=1-l-p,n[6]=d+v,n[7]=0,n[8]=f+g,n[9]=d-v,n[10]=1-l-h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function m0e(n,e,t,r,i){let o=1/Math.tan(e/2),s=1/(r-i);return n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+r)*s,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*i*r*s,n[15]=0,n}function v0e(n,e,t,r,i,o,s){let a=1/(e-t),u=1/(r-i),l=1/(o-s);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*u,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*l,n[11]=0,n[12]=(e+t)*a,n[13]=(i+r)*u,n[14]=(s+o)*l,n[15]=1,n}function g0e(n,e,t,r){let i=e[0],o=e[1],s=e[2],a=r[0],u=r[1],l=r[2],c=i-t[0],h=o-t[1],f=s-t[2],d=c*c+h*h+f*f;d===0?f=1:(d=1/Math.sqrt(d),c*=d,h*=d,f*=d);let p=u*f-l*h,v=l*c-a*f,g=a*h-u*c;return d=p*p+v*v+g*g,d===0&&(l?a+=1e-6:u?l+=1e-6:u+=1e-6,p=u*f-l*h,v=l*c-a*f,g=a*h-u*c,d=p*p+v*v+g*g),d=1/Math.sqrt(d),p*=d,v*=d,g*=d,n[0]=p,n[1]=v,n[2]=g,n[3]=0,n[4]=h*g-f*v,n[5]=f*p-c*g,n[6]=c*v-h*p,n[7]=0,n[8]=c,n[9]=h,n[10]=f,n[11]=0,n[12]=i,n[13]=o,n[14]=s,n[15]=1,n}function Pz(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n}function kz(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n}function y0e(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n}class jb extends Array{constructor(e=1,t=0,r=0,i=0,o=0,s=1,a=0,u=0,l=0,c=0,h=1,f=0,d=0,p=0,v=0,g=1){return super(e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(e){this[12]=e}set y(e){this[13]=e}set z(e){this[14]=e}set w(e){this[15]=e}set(e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g){return e.length?this.copy(e):(i0e(this,e,t,r,i,o,s,a,u,l,c,h,f,d,p,v,g),this)}translate(e,t=this){return a0e(this,t,e),this}rotate(e,t,r=this){return l0e(this,r,e,t),this}scale(e,t=this){return u0e(this,t,typeof e=="number"?[e,e,e]:e),this}add(e,t){return t?Pz(this,e,t):Pz(this,this,e),this}sub(e,t){return t?kz(this,e,t):kz(this,this,e),this}multiply(e,t){return e.length?t?Iz(this,e,t):Iz(this,this,e):y0e(this,this,e),this}identity(){return o0e(this),this}copy(e){return r0e(this,e),this}fromPerspective({fov:e,aspect:t,near:r,far:i}={}){return m0e(this,e,t,r,i),this}fromOrthogonal({left:e,right:t,bottom:r,top:i,near:o,far:s}){return v0e(this,e,t,r,i,o,s),this}fromQuaternion(e){return p0e(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}inverse(e=this){return s0e(this,e),this}compose(e,t,r){return d0e(this,e,t,r),this}decompose(e,t,r){return f0e(this,e,t,r),this}getRotation(e){return Wj(e,this),this}getTranslation(e){return c0e(e,this),this}getScaling(e){return Vj(e,this),this}getMaxScaleOnAxis(){return h0e(this)}lookAt(e,t,r){return g0e(this,e,t,r),this}determinant(){return zj(this)}fromArray(e,t=0){return this[0]=e[t],this[1]=e[t+1],this[2]=e[t+2],this[3]=e[t+3],this[4]=e[t+4],this[5]=e[t+5],this[6]=e[t+6],this[7]=e[t+7],this[8]=e[t+8],this[9]=e[t+9],this[10]=e[t+10],this[11]=e[t+11],this[12]=e[t+12],this[13]=e[t+13],this[14]=e[t+14],this[15]=e[t+15],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e[t+3]=this[3],e[t+4]=this[4],e[t+5]=this[5],e[t+6]=this[6],e[t+7]=this[7],e[t+8]=this[8],e[t+9]=this[9],e[t+10]=this[10],e[t+11]=this[11],e[t+12]=this[12],e[t+13]=this[13],e[t+14]=this[14],e[t+15]=this[15],e}}function x0e(n,e,t="YXZ"){return t==="XYZ"?(n[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(n[0]=Math.atan2(-e[9],e[10]),n[2]=Math.atan2(-e[4],e[0])):(n[0]=Math.atan2(e[6],e[5]),n[2]=0)):t==="YXZ"?(n[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(n[1]=Math.atan2(e[8],e[10]),n[2]=Math.atan2(e[1],e[5])):(n[1]=Math.atan2(-e[2],e[0]),n[2]=0)):t==="ZXY"?(n[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(n[1]=Math.atan2(-e[2],e[10]),n[2]=Math.atan2(-e[4],e[5])):(n[1]=0,n[2]=Math.atan2(e[1],e[0]))):t==="ZYX"?(n[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(n[0]=Math.atan2(e[6],e[10]),n[2]=Math.atan2(e[1],e[0])):(n[0]=0,n[2]=Math.atan2(-e[4],e[5]))):t==="YZX"?(n[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(n[0]=Math.atan2(-e[9],e[5]),n[1]=Math.atan2(-e[2],e[0])):(n[0]=0,n[1]=Math.atan2(e[8],e[10]))):t==="XZY"&&(n[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(n[0]=Math.atan2(e[6],e[5]),n[1]=Math.atan2(e[8],e[0])):(n[0]=Math.atan2(-e[9],e[10]),n[1]=0)),n}const Dz=new jb;class w0e extends Array{constructor(e=0,t=e,r=e,i="YXZ"){super(e,t,r),this.order=i,this.onChange=()=>{},this._target=this;const o=["0","1","2"];return new Proxy(this,{set(s,a){const u=Reflect.set(...arguments);return u&&o.includes(a)&&s.onChange(),u}})}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(e){this._target[0]=e,this.onChange()}set y(e){this._target[1]=e,this.onChange()}set z(e){this._target[2]=e,this.onChange()}set(e,t=e,r=e){return e.length?this.copy(e):(this._target[0]=e,this._target[1]=t,this._target[2]=r,this.onChange(),this)}copy(e){return this._target[0]=e[0],this._target[1]=e[1],this._target[2]=e[2],this.onChange(),this}reorder(e){return this._target.order=e,this.onChange(),this}fromRotationMatrix(e,t=this.order){return x0e(this._target,e,t),this.onChange(),this}fromQuaternion(e,t=this.order,r){return Dz.fromQuaternion(e),this._target.fromRotationMatrix(Dz,t),r||this.onChange(),this}fromArray(e,t=0){return this._target[0]=e[t],this._target[1]=e[t+1],this._target[2]=e[t+2],this}toArray(e=[],t=0){return e[t]=this[0],e[t+1]=this[1],e[t+2]=this[2],e}}class _0e{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new jb,this.worldMatrix=new jb,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new vu,this.quaternion=new t0e,this.scale=new vu(1),this.rotation=new w0e,this.up=new vu(0,1,0),this.rotation._target.onChange=()=>this.quaternion.fromEuler(this.rotation,!0),this.quaternion._target.onChange=()=>this.rotation.fromQuaternion(this.quaternion,void 0,!0)}setParent(e,t=!0){this.parent&&e!==this.parent&&this.parent.removeChild(this,!1),this.parent=e,t&&e&&e.addChild(this,!1)}addChild(e,t=!0){~this.children.indexOf(e)||this.children.push(e),t&&e.setParent(this,!1)}removeChild(e,t=!0){~this.children.indexOf(e)&&this.children.splice(this.children.indexOf(e),1),t&&e.setParent(null,!1)}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let t=0,r=this.children.length;t<r;t++)this.children[t].updateMatrixWorld(e)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(e){if(!e(this))for(let t=0,r=this.children.length;t<r;t++)this.children[t].traverse(e)}decompose(){this.matrix.decompose(this.quaternion._target,this.position,this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(e,t=!1){t?this.matrix.lookAt(this.position,e,this.up):this.matrix.lookAt(e,this.position,this.up),this.matrix.getRotation(this.quaternion._target),this.rotation.fromQuaternion(this.quaternion)}}function b0e(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n}function S0e(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=t+t,a=r+r,u=i+i,l=t*s,c=r*s,h=r*a,f=i*s,d=i*a,p=i*u,v=o*s,g=o*a,m=o*u;return n[0]=1-h-p,n[3]=c-m,n[6]=f+g,n[1]=c+m,n[4]=1-l-p,n[7]=d-v,n[2]=f-g,n[5]=d+v,n[8]=1-l-h,n}function E0e(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function C0e(n,e,t,r,i,o,s,a,u,l){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n[4]=o,n[5]=s,n[6]=a,n[7]=u,n[8]=l,n}function M0e(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function T0e(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=c*s-a*l,f=-c*o+a*u,d=l*o-s*u,p=t*h+r*f+i*d;return p?(p=1/p,n[0]=h*p,n[1]=(-c*r+i*l)*p,n[2]=(a*r-i*s)*p,n[3]=f*p,n[4]=(c*t-i*u)*p,n[5]=(-a*t+i*o)*p,n[6]=d*p,n[7]=(-l*t+r*u)*p,n[8]=(s*t-r*o)*p,n):null}function Nz(n,e,t){let r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],d=t[1],p=t[2],v=t[3],g=t[4],m=t[5],x=t[6],_=t[7],b=t[8];return n[0]=f*r+d*s+p*l,n[1]=f*i+d*a+p*c,n[2]=f*o+d*u+p*h,n[3]=v*r+g*s+m*l,n[4]=v*i+g*a+m*c,n[5]=v*o+g*u+m*h,n[6]=x*r+_*s+b*l,n[7]=x*i+_*a+b*c,n[8]=x*o+_*u+b*h,n}function R0e(n,e,t){let r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=t[0],d=t[1];return n[0]=r,n[1]=i,n[2]=o,n[3]=s,n[4]=a,n[5]=u,n[6]=f*r+d*s+l,n[7]=f*i+d*a+c,n[8]=f*o+d*u+h,n}function A0e(n,e,t){let r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=Math.sin(t),d=Math.cos(t);return n[0]=d*r+f*s,n[1]=d*i+f*a,n[2]=d*o+f*u,n[3]=d*s-f*r,n[4]=d*a-f*i,n[5]=d*u-f*o,n[6]=l,n[7]=c,n[8]=h,n}function I0e(n,e,t){let r=t[0],i=t[1];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=i*e[3],n[4]=i*e[4],n[5]=i*e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n}function P0e(n,e){let t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],v=e[13],g=e[14],m=e[15],x=t*a-r*s,_=t*u-i*s,b=t*l-o*s,S=r*u-i*a,E=r*l-o*a,C=i*l-o*u,R=c*v-h*p,T=c*g-f*p,A=c*m-d*p,P=h*g-f*v,k=h*m-d*v,W=f*m-d*g,N=x*W-_*k+b*P+S*A-E*T+C*R;return N?(N=1/N,n[0]=(a*W-u*k+l*P)*N,n[1]=(u*A-s*W-l*T)*N,n[2]=(s*k-a*A+l*R)*N,n[3]=(i*k-r*W-o*P)*N,n[4]=(t*W-i*A+o*T)*N,n[5]=(r*A-t*k-o*R)*N,n[6]=(v*C-g*E+m*S)*N,n[7]=(g*b-p*C-m*_)*N,n[8]=(p*E-v*b+m*x)*N,n):null}class k0e extends Array{constructor(e=1,t=0,r=0,i=0,o=1,s=0,a=0,u=0,l=1){return super(e,t,r,i,o,s,a,u,l),this}set(e,t,r,i,o,s,a,u,l){return e.length?this.copy(e):(C0e(this,e,t,r,i,o,s,a,u,l),this)}translate(e,t=this){return R0e(this,t,e),this}rotate(e,t=this){return A0e(this,t,e),this}scale(e,t=this){return I0e(this,t,e),this}multiply(e,t){return t?Nz(this,e,t):Nz(this,this,e),this}identity(){return M0e(this),this}copy(e){return E0e(this,e),this}fromMatrix4(e){return b0e(this,e),this}fromQuaternion(e){return S0e(this,e),this}fromBasis(e,t,r){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2]),this}inverse(e=this){return T0e(this,e),this}getNormalMatrix(e){return P0e(this,e),this}}let D0e=0;class N0e extends _0e{constructor(e,{geometry:t,program:r,mode:i=e.TRIANGLES,frustumCulled:o=!0,renderOrder:s=0}={}){super(),e.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=e,this.id=D0e++,this.geometry=t,this.program=r,this.mode=i,this.frustumCulled=o,this.renderOrder=s,this.modelViewMatrix=new jb,this.normalMatrix=new k0e,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(e){return this.beforeRenderCallbacks.push(e),this}onAfterRender(e){return this.afterRenderCallbacks.push(e),this}draw({camera:e}={}){e&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=e.projectionMatrix,this.program.uniforms.cameraPosition.value=e.worldPosition,this.program.uniforms.viewMatrix.value=e.viewMatrix,this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}));let t=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:t}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(r=>r&&r({mesh:this,camera:e}))}}class L0e extends Age{constructor(e,{attributes:t={}}={}){Object.assign(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),super(e,t)}}const F0e=n=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return e?[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]:[1,.5,.2]},O0e=`#version 300 es
precision highp float;
in vec2 position;
in vec2 uv;
out vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 0.0, 1.0);
}
`,B0e=`#version 300 es
precision highp float;
uniform vec2 iResolution;
uniform float iTime;
uniform vec3 uCustomColor;
uniform float uUseCustomColor;
uniform float uSpeed;
uniform float uDirection;
uniform float uScale;
uniform float uOpacity;
uniform vec2 uMouse;
uniform float uMouseInteractive;
out vec4 fragColor;

void mainImage(out vec4 o, vec2 C) {
  vec2 center = iResolution.xy * 0.5;
  C = (C - center) / uScale + center;
  
  vec2 mouseOffset = (uMouse - center) * 0.0002;
  C += mouseOffset * length(C - center) * step(0.5, uMouseInteractive);
  
  float i, d, z, T = iTime * uSpeed * uDirection;
  vec3 O, p, S;

  for (vec2 r = iResolution.xy, Q; ++i < 60.; O += o.w/d*o.xyz) {
    p = z*normalize(vec3(C-.5*r,r.y)); 
    p.z -= 4.; 
    S = p;
    d = p.y-T;
    
    p.x += .4*(1.+p.y)*sin(d + p.x*0.1)*cos(.34*d + p.x*0.05); 
    Q = p.xz *= mat2(cos(p.y+vec4(0,11,33,0)-T)); 
    z+= d = abs(sqrt(length(Q*Q)) - .25*(5.+S.y))/3.+8e-4; 
    o = 1.+sin(S.y+p.z*.5+S.z-length(S-p)+vec4(2,1,0,8));
  }
  
  o.xyz = tanh(O/1e4);
}

bool finite1(float x){ return !(isnan(x) || isinf(x)); }
vec3 sanitize(vec3 c){
  return vec3(
    finite1(c.r) ? c.r : 0.0,
    finite1(c.g) ? c.g : 0.0,
    finite1(c.b) ? c.b : 0.0
  );
}

void main() {
  vec4 o = vec4(0.0);
  mainImage(o, gl_FragCoord.xy);
  vec3 rgb = sanitize(o.rgb);
  
  float intensity = (rgb.r + rgb.g + rgb.b) / 3.0;
  vec3 customColor = intensity * uCustomColor;
  vec3 finalColor = mix(rgb, customColor, step(0.5, uUseCustomColor));
  
  float alpha = length(rgb) * uOpacity;
  fragColor = vec4(finalColor, alpha);
}`,U0e=({color:n="#ffffff",speed:e=1,direction:t="forward",scale:r=1,opacity:i=1,mouseInteractive:o=!0})=>{const s=H.useRef(null),a=H.useRef({x:0,y:0});return H.useEffect(()=>{if(!s.current)return;const u=n?1:0,l=n?F0e(n):[1,1,1],c=t==="reverse"?-1:1,h=new Fge({webgl:2,alpha:!0,antialias:!1,dpr:Math.min(window.devicePixelRatio||1,2)}),f=h.gl,d=f.canvas;d.style.display="block",d.style.width="100%",d.style.height="100%",s.current.appendChild(d);const p=new L0e(f),v=new Pge(f,{vertex:O0e,fragment:B0e,uniforms:{iTime:{value:0},iResolution:{value:new Float32Array([1,1])},uCustomColor:{value:new Float32Array(l)},uUseCustomColor:{value:u},uSpeed:{value:e*.4},uDirection:{value:c},uScale:{value:r},uOpacity:{value:i},uMouse:{value:new Float32Array([0,0])},uMouseInteractive:{value:o?1:0}}}),g=new N0e(f,{geometry:p,program:v}),m=C=>{if(!o)return;const R=s.current.getBoundingClientRect();a.current.x=C.clientX-R.left,a.current.y=C.clientY-R.top;const T=v.uniforms.uMouse.value;T[0]=a.current.x,T[1]=a.current.y};o&&s.current.addEventListener("mousemove",m);const x=()=>{const C=s.current.getBoundingClientRect(),R=Math.max(1,Math.floor(C.width)),T=Math.max(1,Math.floor(C.height));h.setSize(R,T);const A=v.uniforms.iResolution.value;A[0]=f.drawingBufferWidth,A[1]=f.drawingBufferHeight},_=new ResizeObserver(x);_.observe(s.current),x();let b=0;const S=performance.now(),E=C=>{let R=(C-S)*.001;if(t==="pingpong"){const A=R%10,P=Math.floor(R/10)%2===0,k=A/10,W=k*k*(3-2*k),N=P?W*10:(1-W)*10;v.uniforms.uDirection.value=1,v.uniforms.iTime.value=N}else v.uniforms.iTime.value=R;h.render({scene:g}),b=requestAnimationFrame(E)};return b=requestAnimationFrame(E),()=>{var C;cancelAnimationFrame(b),_.disconnect(),o&&s.current&&s.current.removeEventListener("mousemove",m);try{(C=s.current)==null||C.removeChild(d)}catch{console.warn("Canvas already removed from container")}}},[n,e,t,r,i,o]),G.jsx("div",{ref:s,className:"w-full h-full overflow-hidden relative"})};class J1{constructor(e=0,t="Network Error"){this.status=e,this.text=t}}const z0e=()=>{if(!(typeof localStorage>"u"))return{get:n=>Promise.resolve(localStorage.getItem(n)),set:(n,e)=>Promise.resolve(localStorage.setItem(n,e)),remove:n=>Promise.resolve(localStorage.removeItem(n))}},Ji={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:z0e()},wD=n=>n?typeof n=="string"?{publicKey:n}:n.toString()==="[object Object]"?n:{}:{},V0e=(n,e="https://api.emailjs.com")=>{if(!n)return;const t=wD(n);Ji.publicKey=t.publicKey,Ji.blockHeadless=t.blockHeadless,Ji.storageProvider=t.storageProvider,Ji.blockList=t.blockList,Ji.limitRate=t.limitRate,Ji.origin=t.origin||e},Hj=async(n,e,t={})=>{const r=await fetch(Ji.origin+n,{method:"POST",headers:t,body:e}),i=await r.text(),o=new J1(r.status,i);if(r.ok)return o;throw o},Gj=(n,e,t)=>{if(!n||typeof n!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!e||typeof e!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},W0e=n=>{if(n&&n.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},$j=n=>n.webdriver||!n.languages||n.languages.length===0,jj=()=>new J1(451,"Unavailable For Headless Browser"),H0e=(n,e)=>{if(!Array.isArray(n))throw"The BlockList list has to be an array";if(typeof e!="string")throw"The BlockList watchVariable has to be a string"},G0e=n=>{var e;return!((e=n.list)!=null&&e.length)||!n.watchVariable},$0e=(n,e)=>n instanceof FormData?n.get(e):n[e],Xj=(n,e)=>{if(G0e(n))return!1;H0e(n.list,n.watchVariable);const t=$0e(e,n.watchVariable);return typeof t!="string"?!1:n.list.includes(t)},qj=()=>new J1(403,"Forbidden"),j0e=(n,e)=>{if(typeof n!="number"||n<0)throw"The LimitRate throttle has to be a positive number";if(e&&typeof e!="string")throw"The LimitRate ID has to be a non-empty string"},X0e=async(n,e,t)=>{const r=Number(await t.get(n)||0);return e-Date.now()+r},Yj=async(n,e,t)=>{if(!e.throttle||!t)return!1;j0e(e.throttle,e.id);const r=e.id||n;return await X0e(r,e.throttle,t)>0?!0:(await t.set(r,Date.now().toString()),!1)},Kj=()=>new J1(429,"Too Many Requests"),q0e=async(n,e,t,r)=>{const i=wD(r),o=i.publicKey||Ji.publicKey,s=i.blockHeadless||Ji.blockHeadless,a=i.storageProvider||Ji.storageProvider,u={...Ji.blockList,...i.blockList},l={...Ji.limitRate,...i.limitRate};return s&&$j(navigator)?Promise.reject(jj()):(Gj(o,n,e),W0e(t),t&&Xj(u,t)?Promise.reject(qj()):await Yj(location.pathname,l,a)?Promise.reject(Kj()):Hj("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:o,service_id:n,template_id:e,template_params:t}),{"Content-type":"application/json"}))},Y0e=n=>{if(!n||n.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},K0e=n=>typeof n=="string"?document.querySelector(n):n,Z0e=async(n,e,t,r)=>{const i=wD(r),o=i.publicKey||Ji.publicKey,s=i.blockHeadless||Ji.blockHeadless,a=Ji.storageProvider||i.storageProvider,u={...Ji.blockList,...i.blockList},l={...Ji.limitRate,...i.limitRate};if(s&&$j(navigator))return Promise.reject(jj());const c=K0e(t);Gj(o,n,e),Y0e(c);const h=new FormData(c);return Xj(u,h)?Promise.reject(qj()):await Yj(location.pathname,l,a)?Promise.reject(Kj()):(h.append("lib_version","4.4.1"),h.append("service_id",n),h.append("template_id",e),h.append("user_id",o),Hj("/api/v1.0/email/send-form",h))},Q0e={init:V0e,send:q0e,sendForm:Z0e,EmailJSResponseStatus:J1},Lz=()=>{const n=H.useRef(),[e,t]=H.useState({name:"",email:"",subject:"",message:""}),[r,i]=H.useState({name:!1,email:!1,subject:!1,message:!1}),[o,s]=H.useState({type:"",message:""}),[a,u]=H.useState(!1),l=d=>{t({...e,[d.target.name]:d.target.value})},c=d=>{i({...r,[d]:!0})},h=d=>{e[d]||i({...r,[d]:!1})},f=async d=>{d.preventDefault(),u(!0),s({type:"",message:""});try{await Q0e.sendForm("service_pqeeaz8","template_jry3q3n",n.current,"H6X5q9F74zm5z3ekm"),s({type:"success",message:"Message sent successfully! I will get back to you soon."}),setTimeout(()=>{s({type:"",message:""})},5e3),t({name:"",email:"",subject:"",message:""}),i({name:!1,email:!1,subject:!1,message:!1})}catch(p){s({type:"error",message:"Failed to send message. Please try again later."}),setTimeout(()=>{s({type:"",message:""})},5e3),console.error("EmailJS Error:",p)}finally{u(!1)}};return G.jsxs("div",{className:"w-full max-w-2xl animate-float relative",children:[o.message&&G.jsx("div",{className:"absolute -top-20 right-0 z-[9999] animate-slide-down",style:{animation:"slideDown 0.5s ease-out forwards"},children:G.jsxs("div",{className:`relative backdrop-blur-xl rounded-lg px-4 py-3 shadow-2xl border-2 flex items-center gap-2 ${o.type==="success"?"bg-gradient-to-r from-green-500/20 via-emerald-500/20 to-green-500/20 border-green-400/50":"bg-gradient-to-r from-red-500/20 via-rose-500/20 to-red-500/20 border-red-400/50"}`,children:[G.jsx("div",{className:`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${o.type==="success"?"bg-green-500/30":"bg-red-500/30"}`,children:o.type==="success"?G.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):G.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),G.jsx("p",{className:`text-sm font-medium ${o.type==="success"?"text-green-300":"text-red-300"}`,children:o.type==="success"?"Message sent!":"Failed to send"}),G.jsx("button",{onClick:()=>s({type:"",message:""}),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors duration-200",children:G.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),G.jsx("div",{className:`absolute inset-0 -z-10 blur-lg opacity-50 ${o.type==="success"?"bg-green-500/30":"bg-red-500/30"}`})]})}),G.jsxs("form",{ref:n,className:"relative bg-surface/30 backdrop-blur-xl rounded-3xl p-8 border border-white/10 shadow-2xl",onSubmit:f,children:[G.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-gradient-to-br from-primary/30 to-secondary/30 rounded-full blur-3xl"}),G.jsx("div",{className:"absolute -bottom-24 -left-24 w-48 h-48 bg-gradient-to-br from-tertiary/30 to-primary/30 rounded-full blur-3xl"}),G.jsxs("div",{className:"relative z-10",children:[G.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent mb-2",children:"Send a Message"}),G.jsx("p",{className:"text-gray-500 text-sm mb-8",children:"Fill out the form below and I'll get back to you soon!"}),G.jsxs("div",{className:"space-y-6",children:[G.jsxs("div",{className:"relative group",children:[G.jsx("input",{type:"text",name:"name",value:e.name,onChange:l,onFocus:()=>c("name"),onBlur:()=>h("name"),required:!0,className:"w-full bg-surface/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-transparent focus:outline-none focus:border-primary/50 focus:bg-surface/50 transition-all duration-300 peer",placeholder:"Your Name"}),G.jsx("label",{className:`absolute left-4 transition-all duration-300 pointer-events-none ${r.name||e.name?"-top-2.5 text-xs bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent font-medium":"top-3 text-gray-500"}`,children:"Your Name"})]}),G.jsxs("div",{className:"relative group",children:[G.jsx("input",{type:"email",name:"email",value:e.email,onChange:l,onFocus:()=>c("email"),onBlur:()=>h("email"),required:!0,className:"w-full bg-surface/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-transparent focus:outline-none focus:border-secondary/50 focus:bg-surface/50 transition-all duration-300 peer",placeholder:"Your Email"}),G.jsx("label",{className:`absolute left-4 transition-all duration-300 pointer-events-none ${r.email||e.email?"-top-2.5 text-xs bg-gradient-to-r from-secondary to-tertiary bg-clip-text text-transparent font-medium":"top-3 text-gray-500"}`,children:"Your Email"})]}),G.jsxs("div",{className:"relative group",children:[G.jsx("input",{type:"text",name:"subject",value:e.subject,onChange:l,onFocus:()=>c("subject"),onBlur:()=>h("subject"),required:!0,className:"w-full bg-surface/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-transparent focus:outline-none focus:border-tertiary/50 focus:bg-surface/50 transition-all duration-300 peer",placeholder:"Subject"}),G.jsx("label",{className:`absolute left-4 transition-all duration-300 pointer-events-none ${r.subject||e.subject?"-top-2.5 text-xs bg-gradient-to-r from-tertiary to-primary bg-clip-text text-transparent font-medium":"top-3 text-gray-500"}`,children:"Subject"})]}),G.jsxs("div",{className:"relative group",children:[G.jsx("textarea",{name:"message",value:e.message,onChange:l,onFocus:()=>c("message"),onBlur:()=>h("message"),required:!0,className:"w-full bg-surface/30 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-transparent focus:outline-none focus:border-primary/50 focus:bg-surface/50 transition-all duration-300 peer resize-none",placeholder:"Your Message",rows:"5"}),G.jsx("label",{className:`absolute left-4 transition-all duration-300 pointer-events-none ${r.message||e.message?"-top-2.5 text-xs bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent font-medium":"top-3 text-gray-500"}`,children:"Your Message"})]})]}),G.jsxs("button",{type:"submit",disabled:a,className:"group relative w-full mt-8 bg-gradient-to-r from-primary via-secondary to-tertiary rounded-xl px-6 py-4 text-white font-semibold overflow-hidden hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-2xl hover:shadow-primary/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",children:[G.jsxs("span",{className:"relative z-10 flex items-center justify-center gap-2",children:[G.jsx("span",{children:a?"Sending...":"Send Message"}),G.jsx("svg",{className:"w-5 h-5 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13"})})]}),G.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500",children:G.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"})})]})]})]})]})};function J0e({children:n,className:e="",onClick:t,mouseX:r,spring:i,distance:o,magnification:s,baseItemSize:a}){const u=H.useRef(null),l=w1(0),c=$b(r,d=>{var v;const p=((v=u.current)==null?void 0:v.getBoundingClientRect())??{x:0};return d-p.x-a/2}),h=$b(c,[-o,0,o],[a,s,a]),f=Oj(h,i);return G.jsx(x1.div,{ref:u,style:{width:f,height:f},onHoverStart:()=>l.set(1),onHoverEnd:()=>l.set(0),onFocus:()=>l.set(1),onBlur:()=>l.set(0),onClick:t,className:`relative inline-flex items-center justify-center rounded-xl bg-surface border-white/10 border-2 shadow-md ${e}`,tabIndex:0,role:"button","aria-haspopup":"true",children:H.Children.map(n,d=>H.cloneElement(d,{isHovered:l}))})}function eye({children:n,className:e="",...t}){const{isHovered:r}=t,[i,o]=H.useState(!1);return H.useEffect(()=>{const s=r.on("change",a=>{o(a===1)});return()=>s()},[r]),G.jsx(fpe,{children:i&&G.jsx(x1.div,{initial:{opacity:0,y:0},animate:{opacity:1,y:-10},exit:{opacity:0,y:0},transition:{duration:.2},className:`${e} absolute -top-6 left-1/2 w-fit whitespace-pre rounded-md border border-white/10 bg-surface px-2 py-0.5 text-xs text-gray-300`,role:"tooltip",style:{x:"-50%"},children:n})})}function tye({children:n,className:e=""}){return G.jsx("div",{className:`flex items-center justify-center ${e}`,children:n})}function nye({items:n,className:e="",spring:t={mass:.1,stiffness:150,damping:12},magnification:r=70,distance:i=200,panelHeight:o=64,dockHeight:s=256,baseItemSize:a=50}){const u=w1(1/0),l=w1(0),c=H.useMemo(()=>Math.max(s,r+r/2+4),[r,s]),h=$b(l,[0,1],[o,c]),f=Oj(h,t);return G.jsx(x1.div,{style:{height:f,scrollbarWidth:"none"},className:"mx-2 flex max-w-full items-center",children:G.jsx(x1.div,{onMouseMove:({pageX:d})=>{l.set(1),u.set(d)},onMouseLeave:()=>{l.set(0),u.set(1/0)},className:`${e} absolute bottom-2 left-1/2 transform -translate-x-1/2 flex items-end w-fit gap-4 rounded-2xl border-primary/30 border-2 pb-2 px-4`,style:{height:o},role:"toolbar","aria-label":"Application dock",children:n.map((d,p)=>G.jsxs(J0e,{onClick:d.onClick,className:d.className,mouseX:u,spring:t,distance:i,magnification:r,baseItemSize:a,children:[G.jsx(tye,{children:d.icon}),G.jsx(eye,{children:d.label})]},p))})})}const rye=()=>{const[n,e]=H.useState(window.innerWidth<=768);H.useEffect(()=>{const i=()=>e(window.innerWidth<=768);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const t=[{label:"Instagram",icon:G.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{d:"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"})}),onClick:()=>window.open("https://www.instagram.com/kumar_mayank.27/","_blank"),className:"bg-gradient-to-r from-tertiary to-rose"},{label:"LinkedIn",icon:G.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),onClick:()=>window.open("https://www.linkedin.com/in/mayankkumarupes/","_blank"),className:"bg-gradient-to-r from-primary to-secondary"},{label:"GitHub",icon:G.jsx("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})}),onClick:()=>window.open("https://github.com/mayank-kumar-27","_blank"),className:"bg-gradient-to-r from-surface to-surface-light"},{label:"Email",icon:G.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),onClick:()=>window.location.href="mailto:mayankkumar.270607@gmail.com",className:"bg-gradient-to-r from-warm to-rose"}],r=t.map(i=>({...i,className:i.className+" border-0"}));return G.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-visible pt-32 pb-20",children:[G.jsx("div",{className:"absolute inset-0 z-[1] pointer-events-none",children:G.jsx(U0e,{color:"#7c3aed",speed:1,opacity:.6,mouseInteractive:!1})}),n?G.jsxs("div",{className:"relative z-[10] w-full px-4 pt-4 pb-8 flex flex-col touch-pan-y",children:[G.jsxs("div",{className:"text-center mb-4",children:[G.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift mb-3",children:"Get In Touch"}),G.jsx("p",{className:"text-sm text-gray-300 leading-relaxed px-2",children:"I'm always open to discussing new projects, creative ideas, or opportunities. Let's create something amazing together!"})]}),G.jsx("div",{className:"flex flex-row items-center justify-center gap-4 mb-6 touch-none",children:t.map((i,o)=>G.jsx("button",{onClick:i.onClick,className:`w-10 h-10 rounded-lg ${i.className} flex items-center justify-center transition-all duration-300 active:scale-95 shadow-md touch-manipulation`,"aria-label":i.label,children:G.jsx("div",{className:"w-5 h-5 flex items-center justify-center [&>svg]:w-5 [&>svg]:h-5",children:i.icon})},o))}),G.jsx("div",{className:"w-full",children:G.jsx(Lz,{})})]}):G.jsxs("div",{className:"relative z-[10] w-full max-w-7xl mx-auto px-8 flex items-center justify-between gap-12",children:[G.jsxs("div",{className:"w-1/2 flex flex-col justify-center items-start",children:[G.jsxs("div",{className:"mb-8",children:[G.jsx("h1",{className:"text-5xl sm:text-6xl md:text-7xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift mb-6",children:"Get In Touch"}),G.jsx(n$,{text:"I'm always open to discussing new projects, creative ideas, or opportunities to be part of your vision. Let's create something amazing together!",as:"p",className:"text-base sm:text-lg md:text-xl text-gray-300 tracking-wide",typingSpeed:20,initialDelay:1200,loop:!1,showCursor:!1,startOnVisible:!1})]}),G.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8 w-full",children:[G.jsx("div",{className:"group relative bg-gradient-to-br from-primary/20 to-surface/50 backdrop-blur-sm border border-primary/30 rounded-xl p-4 hover:from-primary/30 hover:to-surface/60 hover:scale-105 hover:border-primary/50 transition-all duration-300 overflow-hidden shadow-lg shadow-primary/20",children:G.jsxs("div",{className:"relative z-10",children:[G.jsx("svg",{className:"w-8 h-8 text-primary mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),G.jsx("p",{className:"text-sm text-gray-500",children:"Response Time"}),G.jsx("p",{className:"text-white font-semibold",children:"Within 24hrs"})]})}),G.jsx("div",{className:"group relative bg-gradient-to-br from-secondary/20 to-surface/50 backdrop-blur-sm border border-secondary/30 rounded-xl p-4 hover:from-secondary/30 hover:to-surface/60 hover:scale-105 hover:border-secondary/50 transition-all duration-300 overflow-hidden shadow-lg shadow-secondary/20",children:G.jsxs("div",{className:"relative z-10",children:[G.jsx("svg",{className:"w-8 h-8 text-secondary-light mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),G.jsx("p",{className:"text-sm text-gray-500",children:"Location"}),G.jsx("p",{className:"text-white font-semibold",children:"Available Remote"})]})})]}),G.jsx("div",{className:"relative h-24 w-full flex items-center justify-center",children:G.jsx(nye,{items:r})})]}),G.jsxs("div",{className:"w-1/2 flex items-center justify-center relative",children:[G.jsx("div",{className:"absolute -top-6 -left-6 w-32 h-32 border-2 border-primary/30 rounded-xl rotate-6 pointer-events-none"}),G.jsx("div",{className:"absolute -bottom-6 -right-6 w-32 h-32 border-2 border-secondary/30 rounded-xl -rotate-6 pointer-events-none"}),G.jsx(Lz,{})]})]})]})},iye=({items:n=[],gradientColor:e="black"})=>{const t=H.useRef(null),r=H.useRef([]),i=H.useRef(window.innerWidth/2),o=28,s=Array.from({length:o},(u,l)=>`Item ${l+1}`),a=n.length>0?n.slice(0,o):s;return H.useEffect(()=>{en.ticker.lagSmoothing(0);const u=h=>{i.current=h.clientX},l=()=>{const d=[.6,.4,.3,.2];r.current.forEach((p,v)=>{if(p){const g=v%2===0?1:-1,m=(i.current/window.innerWidth*300-300/2)*g;en.to(p,{x:m,duration:.8+d[v%d.length],ease:"power3.out",overwrite:"auto"})}})},c=en.ticker.add(l);return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u),c()}},[]),G.jsx("div",{ref:t,className:"h-full w-full overflow-hidden",children:G.jsxs("section",{className:"w-full h-screen overflow-hidden relative flex items-center justify-center",style:{background:`radial-gradient(circle, ${e} 0%, transparent 100%)`},children:[G.jsx("div",{className:"absolute inset-0 pointer-events-none z-[4] bg-[length:250px]"}),G.jsx("div",{className:"gap-16 flex-none relative w-[140vw] h-[150vh] grid grid-rows-4 grid-cols-1 rotate-[-15deg] origin-center z-[2] p-12",children:[...Array(4)].map((u,l)=>G.jsx("div",{className:"grid gap-4 grid-cols-7",style:{willChange:"transform, filter"},ref:c=>r.current[l]=c,children:[...Array(7)].map((c,h)=>{const f=a[l*7+h];return G.jsx("div",{className:"relative aspect-square pointer-events-auto",children:G.jsx("div",{className:"relative w-full h-full overflow-hidden rounded-xl bg-gradient-to-br from-surface to-background border border-white/10 flex items-center justify-center text-white text-[1.5rem] transition-all duration-300 hover:scale-110 hover:border-secondary/50 hover:shadow-[0_0_20px_rgba(124,58,237,0.5)] hover:z-10 group",children:typeof f=="string"&&f.startsWith("http")?G.jsx("div",{className:"w-full h-full bg-cover bg-center absolute top-0 left-0 transition-transform duration-300 group-hover:scale-110",style:{backgroundImage:`url(${f})`}}):typeof f=="object"&&f.url?G.jsx("div",{className:"w-full h-full flex items-center justify-center p-8",children:G.jsx("img",{src:f.url,alt:f.name||"",className:"max-w-[70%] max-h-[70%] object-contain transition-all duration-300 group-hover:scale-125 drop-shadow-[0_0_10px_rgba(124,58,237,0.3)]"})}):G.jsx("div",{className:"p-4 text-center z-[1] transition-all duration-300 group-hover:text-primary",children:f})})},h)})},l))}),G.jsx("div",{className:"relative w-full h-full top-0 left-0 pointer-events-none"})]})})};function oye({mouseForce:n=20,cursorSize:e=100,isViscous:t=!1,viscous:r=30,iterationsViscous:i=32,iterationsPoisson:o=32,dt:s=.014,BFECC:a=!0,resolution:u=.5,isBounce:l=!1,colors:c=["#00d4ff","#7c3aed","#f472b6"],style:h={},className:f="",autoDemo:d=!0,autoSpeed:p=.5,autoIntensity:v=2.2,takeoverDuration:g=.25,autoResumeDelay:m=1e3,autoRampDuration:x=.6}){const _=H.useRef(null),b=H.useRef(null),S=H.useRef(null),E=H.useRef(null),C=H.useRef(null),R=H.useRef(!0),T=H.useRef(null);return H.useEffect(()=>{if(!_.current)return;function A(Te){let J;Array.isArray(Te)&&Te.length>0?Te.length===1?J=[Te[0],Te[0]]:J=Te:J=["#ffffff","#ffffff"];const be=J.length,ke=new Uint8Array(be*4);for(let Ue=0;Ue<be;Ue++){const We=new ct(J[Ue]);ke[Ue*4+0]=Math.round(We.r*255),ke[Ue*4+1]=Math.round(We.g*255),ke[Ue*4+2]=Math.round(We.b*255),ke[Ue*4+3]=255}const He=new ac(ke,be,1,eo);return He.magFilter=Fn,He.minFilter=Fn,He.wrapS=qr,He.wrapT=qr,He.generateMipmaps=!1,He.needsUpdate=!0,He}const P=A(c),k=new On(0,0,0,0);class W{constructor(){this.width=0,this.height=0,this.aspect=1,this.pixelRatio=1,this.isMobile=!1,this.breakpoint=768,this.fboWidth=null,this.fboHeight=null,this.time=0,this.delta=0,this.container=null,this.renderer=null,this.clock=null}init(J){this.container=J,this.pixelRatio=Math.min(window.devicePixelRatio||1,2),this.resize(),this.renderer=new hg({antialias:!0,alpha:!0}),this.renderer.autoClear=!1,this.renderer.setClearColor(new ct(0),0),this.renderer.setPixelRatio(this.pixelRatio),this.renderer.setSize(this.width,this.height),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.display="block",this.clock=new EE,this.clock.start()}resize(){if(!this.container)return;const J=this.container.getBoundingClientRect();this.width=Math.max(1,Math.floor(J.width)),this.height=Math.max(1,Math.floor(J.height)),this.aspect=this.width/this.height,this.renderer&&this.renderer.setSize(this.width,this.height,!1)}update(){this.delta=this.clock.getDelta(),this.time+=this.delta}}const N=new W;class O{constructor(){this.mouseMoved=!1,this.coords=new De,this.coords_old=new De,this.diff=new De,this.timer=null,this.container=null,this.docTarget=null,this.listenerTarget=null,this.isHoverInside=!1,this.hasUserControl=!1,this.isAutoActive=!1,this.autoIntensity=2,this.takeoverActive=!1,this.takeoverStartTime=0,this.takeoverDuration=.25,this.takeoverFrom=new De,this.takeoverTo=new De,this.onInteract=null,this._onMouseMove=this.onDocumentMouseMove.bind(this),this._onTouchStart=this.onDocumentTouchStart.bind(this),this._onTouchMove=this.onDocumentTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this._onDocumentLeave=this.onDocumentLeave.bind(this)}init(J){this.container=J,this.docTarget=J.ownerDocument||null;const be=this.docTarget&&this.docTarget.defaultView||(typeof window<"u"?window:null);be&&(this.listenerTarget=be,this.listenerTarget.addEventListener("mousemove",this._onMouseMove),this.listenerTarget.addEventListener("touchstart",this._onTouchStart,{passive:!0}),this.listenerTarget.addEventListener("touchmove",this._onTouchMove,{passive:!0}),this.listenerTarget.addEventListener("touchend",this._onTouchEnd),this.docTarget&&this.docTarget.addEventListener("mouseleave",this._onDocumentLeave))}dispose(){this.listenerTarget&&(this.listenerTarget.removeEventListener("mousemove",this._onMouseMove),this.listenerTarget.removeEventListener("touchstart",this._onTouchStart),this.listenerTarget.removeEventListener("touchmove",this._onTouchMove),this.listenerTarget.removeEventListener("touchend",this._onTouchEnd)),this.docTarget&&this.docTarget.removeEventListener("mouseleave",this._onDocumentLeave),this.listenerTarget=null,this.docTarget=null,this.container=null}isPointInside(J,be){if(!this.container)return!1;const ke=this.container.getBoundingClientRect();return ke.width===0||ke.height===0?!1:J>=ke.left&&J<=ke.right&&be>=ke.top&&be<=ke.bottom}updateHoverState(J,be){return this.isHoverInside=this.isPointInside(J,be),this.isHoverInside}setCoords(J,be){if(!this.container)return;this.timer&&window.clearTimeout(this.timer);const ke=this.container.getBoundingClientRect();if(ke.width===0||ke.height===0)return;const He=(J-ke.left)/ke.width,Ue=(be-ke.top)/ke.height;this.coords.set(He*2-1,-(Ue*2-1)),this.mouseMoved=!0,this.timer=window.setTimeout(()=>{this.mouseMoved=!1},100)}setNormalized(J,be){this.coords.set(J,be),this.mouseMoved=!0}onDocumentMouseMove(J){if(this.updateHoverState(J.clientX,J.clientY)){if(this.onInteract&&this.onInteract(),this.isAutoActive&&!this.hasUserControl&&!this.takeoverActive){if(!this.container)return;const be=this.container.getBoundingClientRect();if(be.width===0||be.height===0)return;const ke=(J.clientX-be.left)/be.width,He=(J.clientY-be.top)/be.height;this.takeoverFrom.copy(this.coords),this.takeoverTo.set(ke*2-1,-(He*2-1)),this.takeoverStartTime=performance.now(),this.takeoverActive=!0,this.hasUserControl=!0,this.isAutoActive=!1;return}this.setCoords(J.clientX,J.clientY),this.hasUserControl=!0}}onDocumentTouchStart(J){if(J.touches.length!==1)return;const be=J.touches[0];this.updateHoverState(be.clientX,be.clientY)&&(this.onInteract&&this.onInteract(),this.setCoords(be.clientX,be.clientY),this.hasUserControl=!0)}onDocumentTouchMove(J){if(J.touches.length!==1)return;const be=J.touches[0];this.updateHoverState(be.clientX,be.clientY)&&(this.onInteract&&this.onInteract(),this.setCoords(be.clientX,be.clientY))}onTouchEnd(){this.isHoverInside=!1}onDocumentLeave(){this.isHoverInside=!1}update(){if(this.takeoverActive){const J=(performance.now()-this.takeoverStartTime)/(this.takeoverDuration*1e3);if(J>=1)this.takeoverActive=!1,this.coords.copy(this.takeoverTo),this.coords_old.copy(this.coords),this.diff.set(0,0);else{const be=J*J*(3-2*J);this.coords.copy(this.takeoverFrom).lerp(this.takeoverTo,be)}}this.diff.subVectors(this.coords,this.coords_old),this.coords_old.copy(this.coords),this.coords_old.x===0&&this.coords_old.y===0&&this.diff.set(0,0),this.isAutoActive&&!this.takeoverActive&&this.diff.multiplyScalar(this.autoIntensity)}}const z=new O;class V{constructor(J,be,ke){this.mouse=J,this.manager=be,this.enabled=ke.enabled,this.speed=ke.speed,this.resumeDelay=ke.resumeDelay||3e3,this.rampDurationMs=(ke.rampDuration||0)*1e3,this.active=!1,this.current=new De(0,0),this.target=new De,this.lastTime=performance.now(),this.activationTime=0,this.margin=.2,this._tmpDir=new De,this.pickNewTarget()}pickNewTarget(){const J=Math.random;this.target.set((J()*2-1)*(1-this.margin),(J()*2-1)*(1-this.margin))}forceStop(){this.active=!1,this.mouse.isAutoActive=!1}update(){if(!this.enabled)return;const J=performance.now();if(J-this.manager.lastUserInteraction<this.resumeDelay){this.active&&this.forceStop();return}if(this.mouse.isHoverInside){this.active&&this.forceStop();return}if(this.active||(this.active=!0,this.current.copy(this.mouse.coords),this.lastTime=J,this.activationTime=J),!this.active)return;this.mouse.isAutoActive=!0;let ke=(J-this.lastTime)/1e3;this.lastTime=J,ke>.2&&(ke=.016);const He=this._tmpDir.subVectors(this.target,this.current),Ue=He.length();if(Ue<.01){this.pickNewTarget();return}He.normalize();let We=1;if(this.rampDurationMs>0){const rt=Math.min(1,(J-this.activationTime)/this.rampDurationMs);We=rt*rt*(3-2*rt)}const Le=this.speed*ke*We,yt=Math.min(Le,Ue);this.current.addScaledVector(He,yt),this.mouse.setNormalized(this.current.x,this.current.y)}}const F=`
  attribute vec3 position;
  uniform vec2 px;
  uniform vec2 boundarySpace;
  varying vec2 uv;
  precision highp float;
  void main(){
  vec3 pos = position;
  vec2 scale = 1.0 - boundarySpace * 2.0;
  pos.xy = pos.xy * scale;
  uv = vec2(0.5)+(pos.xy)*0.5;
  gl_Position = vec4(pos, 1.0);
}
`,U=`
  attribute vec3 position;
  uniform vec2 px;
  precision highp float;
  varying vec2 uv;
  void main(){
  vec3 pos = position;
  uv = 0.5 + pos.xy * 0.5;
  vec2 n = sign(pos.xy);
  pos.xy = abs(pos.xy) - px * 1.0;
  pos.xy *= n;
  gl_Position = vec4(pos, 1.0);
}
`,L=`
    precision highp float;
    attribute vec3 position;
    attribute vec2 uv;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 pos = position.xy * scale * 2.0 * px + center;
    vUv = uv;
    gl_Position = vec4(pos, 0.0, 1.0);
}
`,j=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform bool isBFECC;
    uniform vec2 fboSize;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    vec2 ratio = max(fboSize.x, fboSize.y) / fboSize;
    if(isBFECC == false){
        vec2 vel = texture2D(velocity, uv).xy;
        vec2 uv2 = uv - vel * dt * ratio;
        vec2 newVel = texture2D(velocity, uv2).xy;
        gl_FragColor = vec4(newVel, 0.0, 0.0);
    } else {
        vec2 spot_new = uv;
        vec2 vel_old = texture2D(velocity, uv).xy;
        vec2 spot_old = spot_new - vel_old * dt * ratio;
        vec2 vel_new1 = texture2D(velocity, spot_old).xy;
        vec2 spot_new2 = spot_old + vel_new1 * dt * ratio;
        vec2 error = spot_new2 - spot_new;
        vec2 spot_new3 = spot_new - error / 2.0;
        vec2 vel_2 = texture2D(velocity, spot_new3).xy;
        vec2 spot_old2 = spot_new3 - vel_2 * dt * ratio;
        vec2 newVel2 = texture2D(velocity, spot_old2).xy; 
        gl_FragColor = vec4(newVel2, 0.0, 0.0);
    }
}
`,Q=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D palette;
    uniform vec4 bgColor;
    varying vec2 uv;
    void main(){
    vec2 vel = texture2D(velocity, uv).xy;
    float lenv = clamp(length(vel), 0.0, 1.0);
    vec3 c = texture2D(palette, vec2(lenv, 0.5)).rgb;
    vec3 outRGB = mix(bgColor.rgb, c, lenv);
    float outA = mix(bgColor.a, 1.0, lenv);
    gl_FragColor = vec4(outRGB, outA);
}
`,K=`
    precision highp float;
    uniform sampler2D velocity;
    uniform float dt;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float x0 = texture2D(velocity, uv-vec2(px.x, 0.0)).x;
    float x1 = texture2D(velocity, uv+vec2(px.x, 0.0)).x;
    float y0 = texture2D(velocity, uv-vec2(0.0, px.y)).y;
    float y1 = texture2D(velocity, uv+vec2(0.0, px.y)).y;
    float divergence = (x1 - x0 + y1 - y0) / 2.0;
    gl_FragColor = vec4(divergence / dt);
}
`,ie=`
    precision highp float;
    uniform vec2 force;
    uniform vec2 center;
    uniform vec2 scale;
    uniform vec2 px;
    varying vec2 vUv;
    void main(){
    vec2 circle = (vUv - 0.5) * 2.0;
    float d = 1.0 - min(length(circle), 1.0);
    d *= d;
    gl_FragColor = vec4(force * d, 0.0, 1.0);
}
`,pe=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D divergence;
    uniform vec2 px;
    varying vec2 uv;
    void main(){
    float p0 = texture2D(pressure, uv + vec2(px.x * 2.0, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * 2.0, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * 2.0)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * 2.0)).r;
    float div = texture2D(divergence, uv).r;
    float newP = (p0 + p1 + p2 + p3) / 4.0 - div;
    gl_FragColor = vec4(newP);
}
`,we=`
    precision highp float;
    uniform sampler2D pressure;
    uniform sampler2D velocity;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    float step = 1.0;
    float p0 = texture2D(pressure, uv + vec2(px.x * step, 0.0)).r;
    float p1 = texture2D(pressure, uv - vec2(px.x * step, 0.0)).r;
    float p2 = texture2D(pressure, uv + vec2(0.0, px.y * step)).r;
    float p3 = texture2D(pressure, uv - vec2(0.0, px.y * step)).r;
    vec2 v = texture2D(velocity, uv).xy;
    vec2 gradP = vec2(p0 - p1, p2 - p3) * 0.5;
    v = v - gradP * dt;
    gl_FragColor = vec4(v, 0.0, 1.0);
}
`,ce=`
    precision highp float;
    uniform sampler2D velocity;
    uniform sampler2D velocity_new;
    uniform float v;
    uniform vec2 px;
    uniform float dt;
    varying vec2 uv;
    void main(){
    vec2 old = texture2D(velocity, uv).xy;
    vec2 new0 = texture2D(velocity_new, uv + vec2(px.x * 2.0, 0.0)).xy;
    vec2 new1 = texture2D(velocity_new, uv - vec2(px.x * 2.0, 0.0)).xy;
    vec2 new2 = texture2D(velocity_new, uv + vec2(0.0, px.y * 2.0)).xy;
    vec2 new3 = texture2D(velocity_new, uv - vec2(0.0, px.y * 2.0)).xy;
    vec2 newv = 4.0 * old + v * dt * (new0 + new1 + new2 + new3);
    newv /= 4.0 * (1.0 + v * dt);
    gl_FragColor = vec4(newv, 0.0, 0.0);
}
`;class _e{constructor(J){var be;this.props=J||{},this.uniforms=(be=this.props.material)==null?void 0:be.uniforms,this.scene=null,this.camera=null,this.material=null,this.geometry=null,this.plane=null}init(){this.scene=new vc,this.camera=new Gd,this.uniforms&&(this.material=new Wm(this.props.material),this.geometry=new fl(2,2),this.plane=new yr(this.geometry,this.material),this.scene.add(this.plane))}update(){N.renderer.setRenderTarget(this.props.output||null),N.renderer.render(this.scene,this.camera),N.renderer.setRenderTarget(null)}}class Oe extends _e{constructor(J){super({material:{vertexShader:F,fragmentShader:j,uniforms:{boundarySpace:{value:J.cellScale},px:{value:J.cellScale},fboSize:{value:J.fboSize},velocity:{value:J.src.texture},dt:{value:J.dt},isBFECC:{value:!0}}},output:J.dst}),this.uniforms=this.props.material.uniforms,this.init()}init(){super.init(),this.createBoundary()}createBoundary(){const J=new an,be=new Float32Array([-1,-1,0,-1,1,0,-1,1,0,1,1,0,1,1,0,1,-1,0,1,-1,0,-1,-1,0]);J.setAttribute("position",new In(be,3));const ke=new Wm({vertexShader:U,fragmentShader:j,uniforms:this.uniforms});this.line=new Au(J,ke),this.scene.add(this.line)}update({dt:J,isBounce:be,BFECC:ke}){this.uniforms.dt.value=J,this.line.visible=be,this.uniforms.isBFECC.value=ke,super.update()}}class Ve extends _e{constructor(J){super({output:J.dst}),this.init(J)}init(J){super.init();const be=new fl(1,1),ke=new Wm({vertexShader:L,fragmentShader:ie,blending:wb,depthWrite:!1,uniforms:{px:{value:J.cellScale},force:{value:new De(0,0)},center:{value:new De(0,0)},scale:{value:new De(J.cursor_size,J.cursor_size)}}});this.mouse=new yr(be,ke),this.scene.add(this.mouse)}update(J){const be=z.diff.x/2*J.mouse_force,ke=z.diff.y/2*J.mouse_force,He=J.cursor_size*J.cellScale.x,Ue=J.cursor_size*J.cellScale.y,We=Math.min(Math.max(z.coords.x,-1+He+J.cellScale.x*2),1-He-J.cellScale.x*2),Le=Math.min(Math.max(z.coords.y,-1+Ue+J.cellScale.y*2),1-Ue-J.cellScale.y*2),yt=this.mouse.material.uniforms;yt.force.value.set(be,ke),yt.center.value.set(We,Le),yt.scale.value.set(J.cursor_size,J.cursor_size),super.update()}}class Ne extends _e{constructor(J){super({material:{vertexShader:F,fragmentShader:ce,uniforms:{boundarySpace:{value:J.boundarySpace},velocity:{value:J.src.texture},velocity_new:{value:J.dst_.texture},v:{value:J.viscous},px:{value:J.cellScale},dt:{value:J.dt}}},output:J.dst,output0:J.dst_,output1:J.dst}),this.init()}update({viscous:J,iterations:be,dt:ke}){let He,Ue;this.uniforms.v.value=J;for(let We=0;We<be;We++)We%2===0?(He=this.props.output0,Ue=this.props.output1):(He=this.props.output1,Ue=this.props.output0),this.uniforms.velocity_new.value=He.texture,this.props.output=Ue,this.uniforms.dt.value=ke,super.update();return Ue}}class Z extends _e{constructor(J){super({material:{vertexShader:F,fragmentShader:K,uniforms:{boundarySpace:{value:J.boundarySpace},velocity:{value:J.src.texture},px:{value:J.cellScale},dt:{value:J.dt}}},output:J.dst}),this.init()}update({vel:J}){this.uniforms.velocity.value=J.texture,super.update()}}class de extends _e{constructor(J){super({material:{vertexShader:F,fragmentShader:pe,uniforms:{boundarySpace:{value:J.boundarySpace},pressure:{value:J.dst_.texture},divergence:{value:J.src.texture},px:{value:J.cellScale}}},output:J.dst,output0:J.dst_,output1:J.dst}),this.init()}update({iterations:J}){let be,ke;for(let He=0;He<J;He++)He%2===0?(be=this.props.output0,ke=this.props.output1):(be=this.props.output1,ke=this.props.output0),this.uniforms.pressure.value=be.texture,this.props.output=ke,super.update();return ke}}class me extends _e{constructor(J){super({material:{vertexShader:F,fragmentShader:we,uniforms:{boundarySpace:{value:J.boundarySpace},pressure:{value:J.src_p.texture},velocity:{value:J.src_v.texture},px:{value:J.cellScale},dt:{value:J.dt}}},output:J.dst}),this.init()}update({vel:J,pressure:be}){this.uniforms.velocity.value=J.texture,this.uniforms.pressure.value=be.texture,super.update()}}class Ie{constructor(J){this.options={iterations_poisson:32,iterations_viscous:32,mouse_force:20,resolution:.5,cursor_size:100,viscous:30,isBounce:!1,dt:.014,isViscous:!1,BFECC:!0,...J},this.fbos={vel_0:null,vel_1:null,vel_viscous0:null,vel_viscous1:null,div:null,pressure_0:null,pressure_1:null},this.fboSize=new De,this.cellScale=new De,this.boundarySpace=new De,this.init()}init(){this.calcSize(),this.createAllFBO(),this.createShaderPass()}getFloatType(){return/(iPad|iPhone|iPod)/i.test(navigator.userAgent)?Wh:vs}createAllFBO(){const be={type:this.getFloatType(),depthBuffer:!1,stencilBuffer:!1,minFilter:Fn,magFilter:Fn,wrapS:qr,wrapT:qr};for(let ke in this.fbos)this.fbos[ke]=new oi(this.fboSize.x,this.fboSize.y,be)}createShaderPass(){this.advection=new Oe({cellScale:this.cellScale,fboSize:this.fboSize,dt:this.options.dt,src:this.fbos.vel_0,dst:this.fbos.vel_1}),this.externalForce=new Ve({cellScale:this.cellScale,cursor_size:this.options.cursor_size,dst:this.fbos.vel_1}),this.viscous=new Ne({cellScale:this.cellScale,boundarySpace:this.boundarySpace,viscous:this.options.viscous,src:this.fbos.vel_1,dst:this.fbos.vel_viscous1,dst_:this.fbos.vel_viscous0,dt:this.options.dt}),this.divergence=new Z({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.vel_viscous0,dst:this.fbos.div,dt:this.options.dt}),this.poisson=new de({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src:this.fbos.div,dst:this.fbos.pressure_1,dst_:this.fbos.pressure_0}),this.pressure=new me({cellScale:this.cellScale,boundarySpace:this.boundarySpace,src_p:this.fbos.pressure_0,src_v:this.fbos.vel_viscous0,dst:this.fbos.vel_0,dt:this.options.dt})}calcSize(){const J=Math.max(1,Math.round(this.options.resolution*N.width)),be=Math.max(1,Math.round(this.options.resolution*N.height)),ke=1/J,He=1/be;this.cellScale.set(ke,He),this.fboSize.set(J,be)}resize(){this.calcSize();for(let J in this.fbos)this.fbos[J].setSize(this.fboSize.x,this.fboSize.y)}update(){this.options.isBounce?this.boundarySpace.set(0,0):this.boundarySpace.copy(this.cellScale),this.advection.update({dt:this.options.dt,isBounce:this.options.isBounce,BFECC:this.options.BFECC}),this.externalForce.update({cursor_size:this.options.cursor_size,mouse_force:this.options.mouse_force,cellScale:this.cellScale});let J=this.fbos.vel_1;this.options.isViscous&&(J=this.viscous.update({viscous:this.options.viscous,iterations:this.options.iterations_viscous,dt:this.options.dt})),this.divergence.update({vel:J});const be=this.poisson.update({iterations:this.options.iterations_poisson});this.pressure.update({vel:J,pressure:be})}}class xe{constructor(){this.init()}init(){this.simulation=new Ie,this.scene=new vc,this.camera=new Gd,this.output=new yr(new fl(2,2),new Wm({vertexShader:F,fragmentShader:Q,transparent:!0,depthWrite:!1,uniforms:{velocity:{value:this.simulation.fbos.vel_0.texture},boundarySpace:{value:new De},palette:{value:P},bgColor:{value:k}}})),this.scene.add(this.output)}addScene(J){this.scene.add(J)}resize(){this.simulation.resize()}render(){N.renderer.setRenderTarget(null),N.renderer.render(this.scene,this.camera)}update(){this.simulation.update(),this.render()}}class se{constructor(J){this.props=J,N.init(J.$wrapper),z.init(J.$wrapper),z.autoIntensity=J.autoIntensity,z.takeoverDuration=J.takeoverDuration,this.lastUserInteraction=performance.now(),z.onInteract=()=>{this.lastUserInteraction=performance.now(),this.autoDriver&&this.autoDriver.forceStop()},this.autoDriver=new V(z,this,{enabled:J.autoDemo,speed:J.autoSpeed,resumeDelay:J.autoResumeDelay,rampDuration:J.autoRampDuration}),this.init(),this._loop=this.loop.bind(this),this._resize=this.resize.bind(this),window.addEventListener("resize",this._resize),this._onVisibility=()=>{document.hidden?this.pause():R.current&&this.start()},document.addEventListener("visibilitychange",this._onVisibility),this.running=!1}init(){this.props.$wrapper.prepend(N.renderer.domElement),this.output=new xe}resize(){N.resize(),this.output.resize()}render(){this.autoDriver&&this.autoDriver.update(),z.update(),N.update(),this.output.update()}loop(){this.running&&(this.render(),E.current=requestAnimationFrame(this._loop))}start(){this.running||(this.running=!0,this._loop())}pause(){this.running=!1,E.current&&(cancelAnimationFrame(E.current),E.current=null)}dispose(){try{if(window.removeEventListener("resize",this._resize),document.removeEventListener("visibilitychange",this._onVisibility),z.dispose(),N.renderer){const J=N.renderer.domElement;J&&J.parentNode&&J.parentNode.removeChild(J),N.renderer.dispose()}}catch{}}}const Xe=_.current;Xe.style.position=Xe.style.position||"relative",Xe.style.overflow=Xe.style.overflow||"hidden";const X=new se({$wrapper:Xe,autoDemo:d,autoSpeed:p,autoIntensity:v,takeoverDuration:g,autoResumeDelay:m,autoRampDuration:x});b.current=X,(()=>{var be;if(!b.current)return;const Te=(be=b.current.output)==null?void 0:be.simulation;if(!Te)return;const J=Te.options.resolution;Object.assign(Te.options,{mouse_force:n,cursor_size:e,isViscous:t,viscous:r,iterations_viscous:i,iterations_poisson:o,dt:s,BFECC:a,resolution:u,isBounce:l}),u!==J&&Te.resize()})(),X.start();const le=new IntersectionObserver(Te=>{const J=Te[0],be=J.isIntersecting&&J.intersectionRatio>0;R.current=be,b.current&&(be&&!document.hidden?b.current.start():b.current.pause())},{threshold:[0,.01,.1]});le.observe(Xe),C.current=le;const ze=new ResizeObserver(()=>{b.current&&(T.current&&cancelAnimationFrame(T.current),T.current=requestAnimationFrame(()=>{b.current&&b.current.resize()}))});return ze.observe(Xe),S.current=ze,()=>{if(E.current&&cancelAnimationFrame(E.current),S.current)try{S.current.disconnect()}catch{}if(C.current)try{C.current.disconnect()}catch{}b.current&&b.current.dispose(),b.current=null}},[a,e,s,l,t,o,i,n,u,r,c,d,p,v,g,m,x]),H.useEffect(()=>{var W;const A=b.current;if(!A)return;const P=(W=A.output)==null?void 0:W.simulation;if(!P)return;const k=P.options.resolution;Object.assign(P.options,{mouse_force:n,cursor_size:e,isViscous:t,viscous:r,iterations_viscous:i,iterations_poisson:o,dt:s,BFECC:a,resolution:u,isBounce:l}),A.autoDriver&&(A.autoDriver.enabled=d,A.autoDriver.speed=p,A.autoDriver.resumeDelay=m,A.autoDriver.rampDurationMs=x*1e3,A.autoDriver.mouse&&(A.autoDriver.mouse.autoIntensity=v,A.autoDriver.mouse.takeoverDuration=g)),u!==k&&P.resize()},[n,e,t,r,i,o,s,a,u,l,d,p,v,g,m,x]),G.jsx("div",{ref:_,className:`w-full h-full relative overflow-hidden pointer-events-none touch-none ${f||""}`,style:h})}const sye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23a9bacd'%20d='M125%2050c-4-32-24-50-62-50C29%200%203%2024%203%2064c0%2039%2024%2064%2064%2064%2032%200%2055-19%2058-50H87c-2%2011-8%2020-20%2020-21%200-24-16-24-33%200-23%208-35%2022-35%2013%200%2020%207%2022%2020z'%20/%3e%3c/svg%3e",aye="data:image/svg+xml,%3csvg%20viewBox='0%200%20128%20128'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='%2300599c'%20d='M118.766%2095.82c.89-1.543%201.441-3.28%201.441-4.843V36.78c0-1.558-.55-3.297-1.441-4.84l-55.32%2031.94Zm0%200'/%3e%3cpath%20fill='%23004482'%20d='m68.36%20126.586%2046.933-27.094c1.352-.781%202.582-2.129%203.473-3.672l-55.32-31.94L8.12%2095.82c.89%201.543%202.121%202.89%203.473%203.672l46.933%2027.094c2.703%201.562%207.13%201.562%209.832%200Zm0%200'/%3e%3cpath%20fill='%23659ad2'%20d='M118.766%2031.941c-.891-1.546-2.121-2.894-3.473-3.671L68.359%201.172c-2.703-1.563-7.129-1.563-9.832%200L11.594%2028.27C8.89%2029.828%206.68%2033.66%206.68%2036.78v54.196c0%201.562.55%203.3%201.441%204.843L63.445%2063.88Zm0%200'/%3e%3cpath%20fill='%23fff'%20d='M63.445%2026.035c-20.867%200-37.843%2016.977-37.843%2037.844s16.976%2037.844%2037.843%2037.844c13.465%200%2026.024-7.247%2032.77-18.91L79.84%2073.335c-3.38%205.84-9.66%209.465-16.395%209.465-10.433%200-18.922-8.488-18.922-18.922%200-10.434%208.49-18.922%2018.922-18.922%206.73%200%2013.017%203.629%2016.39%209.465l16.38-9.477c-6.75-11.664-19.305-18.91-32.77-18.91zM92.88%2057.57v4.207h-4.207v4.203h4.207v4.207h4.203V65.98h4.203v-4.203h-4.203V57.57H92.88zm15.766%200v4.207h-4.204v4.203h4.204v4.207h4.207V65.98h4.203v-4.203h-4.203V57.57h-4.207z'/%3e%3c/svg%3e",uye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cg%20fill='%2300c4cc'%3e%3cpath%20d='M59.39.152c-.484.051-1.995.23-3.328.387-5.374.613-11.468%202.227-16.816%204.48C19.891%2013.106%205.324%2030.849%201.305%2051.2.359%2056.04.129%2058.418.129%2064c0%207.195.715%2012.16%202.61%2018.434%206.195%2020.53%2022.323%2036.632%2042.906%2042.851%206.195%201.871%2011.187%202.586%2018.355%202.586%207.195%200%2012.16-.715%2018.434-2.61%2020.53-6.195%2036.632-22.323%2042.851-42.906%201.871-6.195%202.586-11.187%202.586-18.355%200-3.047-.152-6.527-.332-7.809-2.074-14.796-8.168-27.238-18.328-37.402C99.07%208.703%2086.68%202.586%2072.19.512c-1.996-.282-11.238-.54-12.8-.36zm-20.863%2040.32c1.36.41%201.996.794%202.918%201.715%201.793%201.82%202.203%202.817%202.203%205.555%200%202.051-.078%202.434-.691%203.508-1.18%201.996-3.918%203.84-5.812%203.89-1.333.028-1.278-.562.18-2.097%201.945-2.023%202.226-2.79%202.226-5.813-.024-2.917-.383-3.914-1.739-4.734-1.128-.691-2.355-.64-4.148.203-4.66%202.23-9.703%209.653-11.672%2017.258-2.613%2010.137%202.02%2018.25%209.649%2016.867%202.226-.41%206.425-2.558%208.246-4.25%201.508-1.379%201.508-1.406%201.66-3.12.336-3.587%202.867-7.169%206.25-8.833%201.558-.77%201.945-.844%204.043-.844%201.996%200%202.457.102%203.43.637%203.097%201.77%202.457%205.89-.895%205.89-1.945%200-2.945-1-1.535-1.534%201.383-.512.867-2.434-.742-2.868-1.895-.488-4.047.793-5.403%203.25-1.64%202.97-1.715%206.504-.156%208.114%201.512%201.613%203.406.336%204.867-3.329.766-1.867%201.867-2.867%203.149-2.867%201.125%200%201.332.692.843%202.793-.718%203.25-.23%204.094%201.793%203.098.664-.309%201.766-1.023%202.43-1.535l1.254-1%20.848-4.43c.922-4.965%201.277-5.633%203.172-5.988%201.82-.336%202.23.562%201.562%203.402l-.36%201.59%201.333-1.36c3.148-3.226%207.015-4.812%208.347-3.48.715.715.637%201.613-.386%204.785-.485%201.512-1.153%203.895-1.457%205.25-.461%202.047-.489%202.535-.23%202.868.82.972%203.327-.028%205.554-2.204l1.305-1.277.156-2.844c.152-3.277.457-4.453%201.328-5.504.82-.972%202.305-1.687%203.098-1.484.793.207.793.973.078%203.227-1%203.097-.895%2010.238.129%2010.238.41%200%202.507-2.2%203.84-4.043l.996-1.36-.793-.816c-1.383-1.46-1.715-2.406-1.715-4.789%200-1.738.129-2.379.562-3.227.719-1.328%201.844-2.3%203.176-2.687%201.406-.434%203.148.281%203.863%201.562.719%201.305.54%204.223-.383%206.223l-.664%201.457h.895c1.23%200%201.715-.305%203.918-2.379%201.152-1.101%202.484-2.05%203.48-2.511%203.918-1.84%208.528-.895%209.293%201.921.64%202.254-.765%203.84-3.226%203.66-1.766-.128-2.098-.59-1.074-1.456%201.843-1.54%200-3.508-2.637-2.793-1.434.386-3.047%201.996-3.89%203.867-1.692%203.738-.794%208.14%201.636%208.14.973%200%202.691-1.921%203.355-3.789.793-2.152%202.457-3.507%203.711-3.02.692.255.743.946.309%203.122-.488%202.383-.563%204.61-.18%205.633.153.382.614%201.101%201.051%201.586.816.921.844%201.254.152%201.691-.332.23-.77.129-1.843-.46-1.485-.77-2.766-2.153-3.227-3.458l-.281-.766-1.024.766c-.59.41-1.511.871-2.047%201.023-2.125.563-4.738-.894-5.964-3.351-.489-.95-.641-3.738-.282-4.813.204-.59.204-.59-.617-.18-.433.231-1.355.485-2.07.563-1.18.13-1.36.258-2.535%201.742-1.664%202.07-4.61%204.864-5.813%205.454-2.558%201.277-3.402.918-4.07-1.72l-.461-1.765-1.102.973c-1.406%201.23-4.222%202.715-5.836%203.074-1.535.332-3.175-.156-3.84-1.18-.995-1.535-.663-4.785.922-9.164%201.176-3.25.333-3.3-2.636-.203-2.203%202.328-3.149%203.992-3.762%206.578-.64%202.688-1.41%203.66-3.148%204.07-1.051.231-1.54-.41-1.332-1.816l.152-1.129-.973.668c-1.383.946-3.125%201.817-4.328%202.149-1.203.332-2.789-.024-3.172-.692-.691-1.175-.691-1.175-1.765-.332-2.332%201.895-5.66%201.356-7.348-1.152l-.54-.793-1.687%201.562c-4.867%204.454-10.957%206.45-15.464%205.067-5.735-1.738-8.907-6.656-8.856-13.746.024-7.117%203.172-14.617%208.473-20.172%202.996-3.125%205.812-4.969%208.68-5.66%202.07-.512%203.328-.485%205.296.129zm0%200'/%3e%3cpath%20d='M90.418%2058.676c-.563.562-.356%202.816.36%204.25.359.742.742%201.332.87%201.332.102%200%20.332-.59.512-1.309.64-2.66-.512-5.504-1.742-4.273zm0%200'/%3e%3c/g%3e%3c/svg%3e",lye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%231572B6'%20d='M18.814%20114.123L8.76%201.352h110.48l-10.064%20112.754-45.243%2012.543-45.119-12.526z'/%3e%3cpath%20fill='%2333A9DC'%20d='M64.001%20117.062l36.559-10.136%208.601-96.354h-45.16v106.49z'/%3e%3cpath%20fill='%23fff'%20d='M64.001%2051.429h18.302l1.264-14.163H64.001V23.435h34.682l-.332%203.711-3.4%2038.114h-30.95V51.429z'/%3e%3cpath%20fill='%23EBEBEB'%20d='M64.083%2087.349l-.061.018-15.403-4.159-.985-11.031H33.752l1.937%2021.717%2028.331%207.863.063-.018v-14.39z'/%3e%3cpath%20fill='%23fff'%20d='M81.127%2064.675l-1.666%2018.522-15.426%204.164v14.39l28.354-7.858.208-2.337%202.406-26.881H81.127z'/%3e%3cpath%20fill='%23EBEBEB'%20d='M64.048%2023.435v13.831H30.64l-.277-3.108-.63-7.012-.331-3.711h34.646zm-.047%2027.996v13.831H48.792l-.277-3.108-.631-7.012-.33-3.711h16.447z'/%3e%3c/svg%3e",cye="/assets/docker-DLqjD3tf.svg",hye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20d='M126.67%2098.44c-4.56%201.16-7.38.05-9.91-3.75-5.68-8.51-11.95-16.63-18-24.9-.78-1.07-1.59-2.12-2.6-3.45C89%2076%2081.85%2085.2%2075.14%2094.77c-2.4%203.42-4.92%204.91-9.4%203.7l26.92-36.13L67.6%2029.71c4.31-.84%207.29-.41%209.93%203.45%205.83%208.52%2012.26%2016.63%2018.67%2025.21%206.45-8.55%2012.8-16.67%2018.8-25.11%202.41-3.42%205-4.72%209.33-3.46-3.28%204.35-6.49%208.63-9.72%2012.88-4.36%205.73-8.64%2011.53-13.16%2017.14-1.61%202-1.35%203.3.09%205.19C109.9%2076%20118.16%2087.1%20126.67%2098.44zM1.33%2061.74c.72-3.61%201.2-7.29%202.2-10.83%206-21.43%2030.6-30.34%2047.5-17.06C60.93%2041.64%2063.39%2052.62%2062.9%2065H7.1c-.84%2022.21%2015.15%2035.62%2035.53%2028.78%207.15-2.4%2011.36-8%2013.47-15%201.07-3.51%202.84-4.06%206.14-3.06-1.69%208.76-5.52%2016.08-13.52%2020.66-12%206.86-29.13%204.64-38.14-4.89C5.26%2085.89%203%2078.92%202%2071.39c-.15-1.2-.46-2.38-.7-3.57q.03-3.04.03-6.08zm5.87-1.49h50.43c-.33-16.06-10.33-27.47-24-27.57-15-.12-25.78%2011.02-26.43%2027.57z'/%3e%3c/svg%3e",fye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%230acf83'%20d='M45.5%20129c11.9%200%2021.5-9.6%2021.5-21.5V86H45.5C33.6%2086%2024%2095.6%2024%20107.5S33.6%20129%2045.5%20129zm0%200'/%3e%3cpath%20fill='%23a259ff'%20d='M24%2064.5C24%2052.6%2033.6%2043%2045.5%2043H67v43H45.5C33.6%2086%2024%2076.4%2024%2064.5zm0%200'/%3e%3cpath%20fill='%23f24e1e'%20d='M24%2021.5C24%209.6%2033.6%200%2045.5%200H67v43H45.5C33.6%2043%2024%2033.4%2024%2021.5zm0%200'/%3e%3cpath%20fill='%23ff7262'%20d='M67%200h21.5C100.4%200%20110%209.6%20110%2021.5S100.4%2043%2088.5%2043H67zm0%200'/%3e%3cpath%20fill='%231abcfe'%20d='M110%2064.5c0%2011.9-9.6%2021.5-21.5%2021.5S67%2076.4%2067%2064.5%2076.6%2043%2088.5%2043%20110%2052.6%20110%2064.5zm0%200'/%3e%3c/svg%3e",dye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23F34F29'%20d='M124.737%2058.378L69.621%203.264c-3.172-3.174-8.32-3.174-11.497%200L46.68%2014.71l14.518%2014.518c3.375-1.139%207.243-.375%209.932%202.314%202.703%202.706%203.461%206.607%202.294%209.993l13.992%2013.993c3.385-1.167%207.292-.413%209.994%202.295%203.78%203.777%203.78%209.9%200%2013.679a9.673%209.673%200%2001-13.683%200%209.677%209.677%200%2001-2.105-10.521L68.574%2047.933l-.002%2034.341a9.708%209.708%200%20012.559%201.828c3.778%203.777%203.778%209.898%200%2013.683-3.779%203.777-9.904%203.777-13.679%200-3.778-3.784-3.778-9.905%200-13.683a9.65%209.65%200%20013.167-2.11V47.333a9.581%209.581%200%2001-3.167-2.111c-2.862-2.86-3.551-7.06-2.083-10.576L41.056%2020.333%203.264%2058.123a8.133%208.133%200%20000%2011.5l55.117%2055.114c3.174%203.174%208.32%203.174%2011.499%200l54.858-54.858a8.135%208.135%200%2000-.001-11.501z'/%3e%3c/svg%3e",pye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cg%20fill='%23181616'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M64%205.103c-33.347%200-60.388%2027.035-60.388%2060.388%200%2026.682%2017.303%2049.317%2041.297%2057.303%203.017.56%204.125-1.31%204.125-2.905%200-1.44-.056-6.197-.082-11.243-16.8%203.653-20.345-7.125-20.345-7.125-2.747-6.98-6.705-8.836-6.705-8.836-5.48-3.748.413-3.67.413-3.67%206.063.425%209.257%206.223%209.257%206.223%205.386%209.23%2014.127%206.562%2017.573%205.02.542-3.903%202.107-6.568%203.834-8.076-13.413-1.525-27.514-6.704-27.514-29.843%200-6.593%202.36-11.98%206.223-16.21-.628-1.52-2.695-7.662.584-15.98%200%200%205.07-1.623%2016.61%206.19C53.7%2035%2058.867%2034.327%2064%2034.304c5.13.023%2010.3.694%2015.127%202.033%2011.526-7.813%2016.59-6.19%2016.59-6.19%203.287%208.317%201.22%2014.46.593%2015.98%203.872%204.23%206.215%209.617%206.215%2016.21%200%2023.194-14.127%2028.3-27.574%2029.796%202.167%201.874%204.097%205.55%204.097%2011.183%200%208.08-.07%2014.583-.07%2016.572%200%201.607%201.088%203.49%204.148%202.897%2023.98-7.994%2041.263-30.622%2041.263-57.294C124.388%2032.14%2097.35%205.104%2064%205.104z'/%3e%3cpath%20d='M26.484%2091.806c-.133.3-.605.39-1.035.185-.44-.196-.685-.605-.543-.906.13-.31.603-.395%201.04-.188.44.197.69.61.537.91zm2.446%202.729c-.287.267-.85.143-1.232-.28-.396-.42-.47-.983-.177-1.254.298-.266.844-.14%201.24.28.394.426.472.984.17%201.255zM31.312%2098.012c-.37.258-.976.017-1.35-.52-.37-.538-.37-1.183.01-1.44.373-.258.97-.025%201.35.507.368.545.368%201.19-.01%201.452zm3.261%203.361c-.33.365-1.036.267-1.552-.23-.527-.487-.674-1.18-.343-1.544.336-.366%201.045-.264%201.564.23.527.486.686%201.18.333%201.543zm4.5%201.951c-.147.473-.825.688-1.51.486-.683-.207-1.13-.76-.99-1.238.14-.477.823-.7%201.512-.485.683.206%201.13.756.988%201.237zm4.943.361c.017.498-.563.91-1.28.92-.723.017-1.308-.387-1.315-.877%200-.503.568-.91%201.29-.924.717-.013%201.306.387%201.306.88zm4.598-.782c.086.485-.413.984-1.126%201.117-.7.13-1.35-.172-1.44-.653-.086-.498.422-.997%201.122-1.126.714-.123%201.354.17%201.444.663zm0%200'/%3e%3c/g%3e%3c/svg%3e",mye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23E44D26'%20d='M19.037%20113.876L9.032%201.661h109.936l-10.016%20112.198-45.019%2012.48z'/%3e%3cpath%20fill='%23F16529'%20d='M64%20116.8l36.378-10.086%208.559-95.878H64z'/%3e%3cpath%20fill='%23EBEBEB'%20d='M64%2052.455H45.788L44.53%2038.361H64V24.599H29.489l.33%203.692%203.382%2037.927H64zm0%2035.743l-.061.017-15.327-4.14-.979-10.975H33.816l1.928%2021.609%2028.193%207.826.063-.017z'/%3e%3cpath%20fill='%23fff'%20d='M63.952%2052.455v13.763h16.947l-1.597%2017.849-15.35%204.143v14.319l28.215-7.82.207-2.325%203.234-36.233.335-3.696h-3.708zm0-27.856v13.762h33.244l.276-3.092.628-6.978.329-3.692z'/%3e%3c/svg%3e",vye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%230074BD'%20d='M47.617%2098.12s-4.767%202.774%203.397%203.71c9.892%201.13%2014.947.968%2025.845-1.092%200%200%202.871%201.795%206.873%203.351-24.439%2010.47-55.308-.607-36.115-5.969zm-2.988-13.665s-5.348%203.959%202.823%204.805c10.567%201.091%2018.91%201.18%2033.354-1.6%200%200%201.993%202.025%205.132%203.131-29.542%208.64-62.446.68-41.309-6.336z'/%3e%3cpath%20fill='%23EA2D2E'%20d='M69.802%2061.271c6.025%206.935-1.58%2013.17-1.58%2013.17s15.289-7.891%208.269-17.777c-6.559-9.215-11.587-13.792%2015.635-29.58%200%20.001-42.731%2010.67-22.324%2034.187z'/%3e%3cpath%20fill='%230074BD'%20d='M102.123%20108.229s3.529%202.91-3.888%205.159c-14.102%204.272-58.706%205.56-71.094.171-4.451-1.938%203.899-4.625%206.526-5.192%202.739-.593%204.303-.485%204.303-.485-4.953-3.487-32.013%206.85-13.743%209.815%2049.821%208.076%2090.817-3.637%2077.896-9.468zM49.912%2070.294s-22.686%205.389-8.033%207.348c6.188.828%2018.518.638%2030.011-.326%209.39-.789%2018.813-2.474%2018.813-2.474s-3.308%201.419-5.704%203.053c-23.042%206.061-67.544%203.238-54.731-2.958%2010.832-5.239%2019.644-4.643%2019.644-4.643zm40.697%2022.747c23.421-12.167%2012.591-23.86%205.032-22.285-1.848.385-2.677.72-2.677.72s.688-1.079%202-1.543c14.953-5.255%2026.451%2015.503-4.823%2023.725%200-.002.359-.327.468-.617z'/%3e%3cpath%20fill='%23EA2D2E'%20d='M76.491%201.587S89.459%2014.563%2064.188%2034.51c-20.266%2016.006-4.621%2025.13-.007%2035.559-11.831-10.673-20.509-20.07-14.688-28.815C58.041%2028.42%2081.722%2022.195%2076.491%201.587z'/%3e%3cpath%20fill='%230074BD'%20d='M52.214%20126.021c22.476%201.437%2057-.8%2057.817-11.436%200%200-1.571%204.032-18.577%207.231-19.186%203.612-42.854%203.191-56.887.874%200%20.001%202.875%202.381%2017.647%203.331z'/%3e%3c/svg%3e",gye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23F0DB4F'%20d='M1.408%201.408h125.184v125.185H1.408z'/%3e%3cpath%20fill='%23323330'%20d='M116.347%2096.736c-.917-5.711-4.641-10.508-15.672-14.981-3.832-1.761-8.104-3.022-9.377-5.926-.452-1.69-.512-2.642-.226-3.665.821-3.32%204.784-4.355%207.925-3.403%202.023.678%203.938%202.237%205.093%204.724%205.402-3.498%205.391-3.475%209.163-5.879-1.381-2.141-2.118-3.129-3.022-4.045-3.249-3.629-7.676-5.498-14.756-5.355l-3.688.477c-3.534.893-6.902%202.748-8.877%205.235-5.926%206.724-4.236%2018.492%202.975%2023.335%207.104%205.332%2017.54%206.545%2018.873%2011.531%201.297%206.104-4.486%208.08-10.234%207.378-4.236-.881-6.592-3.034-9.139-6.949-4.688%202.713-4.688%202.713-9.508%205.485%201.143%202.499%202.344%203.63%204.26%205.795%209.068%209.198%2031.76%208.746%2035.83-5.176.165-.478%201.261-3.666.38-8.581zM69.462%2058.943H57.753l-.048%2030.272c0%206.438.333%2012.34-.714%2014.149-1.713%203.558-6.152%203.117-8.175%202.427-2.059-1.012-3.106-2.451-4.319-4.485-.333-.584-.583-1.036-.667-1.071l-9.52%205.83c1.583%203.249%203.915%206.069%206.902%207.901%204.462%202.678%2010.459%203.499%2016.731%202.059%204.082-1.189%207.604-3.652%209.448-7.401%202.666-4.915%202.094-10.864%202.07-17.444.06-10.735.001-21.468.001-32.237z'/%3e%3c/svg%3e",yye="/assets/linux-BsaQAsRn.svg",xye="/assets/matplotlib-HPIvE-Qa.svg",wye="/assets/mongodb-Dijo5B3J.svg",_ye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='url(%23a)'%20d='M66.958.825a6.07%206.07%200%200%200-6.035%200L11.103%2029.76c-1.895%201.072-2.96%203.095-2.96%205.24v57.988c0%202.143%201.183%204.167%202.958%205.24l49.82%2028.934a6.07%206.07%200%200%200%206.036%200l49.82-28.935c1.894-1.072%202.958-3.096%202.958-5.24V35c0-2.144-1.183-4.167-2.958-5.24z'/%3e%3cpath%20fill='url(%23b)'%20d='M116.897%2029.76%2066.841.825A8.161%208.161%200%200%200%2065.302.23L9.21%2096.798a6.251%206.251%200%200%200%201.657%201.43l50.057%2028.934c1.42.833%203.076%201.072%204.615.595l52.66-96.925a3.702%203.702%200%200%200-1.302-1.072z'/%3e%3cpath%20fill='url(%23c)'%20d='M116.898%2098.225c1.42-.833%202.485-2.262%202.958-3.81L65.066.108c-1.42-.238-2.959-.119-4.26.715L11.104%2029.639l53.606%2098.355c.71-.12%201.54-.358%202.25-.715z'/%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='34.513'%20x2='27.157'%20y1='15.535'%20y2='30.448'%20gradientTransform='translate(-129.242%20-73.715)%20scale(6.18523)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%233F873F'/%3e%3cstop%20offset='.33'%20stop-color='%233F8B3D'/%3e%3cstop%20offset='.637'%20stop-color='%233E9638'/%3e%3cstop%20offset='.934'%20stop-color='%233DA92E'/%3e%3cstop%20offset='1'%20stop-color='%233DAE2B'/%3e%3c/linearGradient%3e%3clinearGradient%20id='b'%20x1='30.009'%20x2='50.533'%20y1='23.359'%20y2='8.288'%20gradientTransform='translate(-129.242%20-73.715)%20scale(6.18523)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='.138'%20stop-color='%233F873F'/%3e%3cstop%20offset='.402'%20stop-color='%2352A044'/%3e%3cstop%20offset='.713'%20stop-color='%2364B749'/%3e%3cstop%20offset='.908'%20stop-color='%236ABF4B'/%3e%3c/linearGradient%3e%3clinearGradient%20id='c'%20x1='21.917'%20x2='40.555'%20y1='22.261'%20y2='22.261'%20gradientTransform='translate(-129.242%20-73.715)%20scale(6.18523)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='.092'%20stop-color='%236ABF4B'/%3e%3cstop%20offset='.287'%20stop-color='%2364B749'/%3e%3cstop%20offset='.598'%20stop-color='%2352A044'/%3e%3cstop%20offset='.862'%20stop-color='%233F873F'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",bye="/assets/notion-CikWTPeg.svg",Sye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%234DABCF'%20d='m55.012%2026.006-21.38-10.789L10.154%2026.93l21.969%2011.027Zm9.808%204.951L87.241%2042.28%2063.982%2053.955l-22-11.043Zm29.948-15.581%2023.037%2011.552L97.2%2037.272%2074.735%2025.938ZM84.853%2010.4%2064.113%200%2043.598%2010.24%2064.97%2021.014ZM68.64%2099.702V128l25.122-12.537-.023-28.31ZM93.727%2077.27l-.028-28.012-25.06%2012.458V89.74Zm30.158-5.246v28.41l-21.43%2010.69-.017-28.279zm0-9.935V34.25l-21.47%2010.673.016%2028.068z'/%3e%3cpath%20fill='%234c75cf'%20d='m59.77%2061.716-16.918-8.512V89.97s-20.7-44.033-22.612-47.99c-.246-.513-1.263-1.07-1.522-1.209-3.731-1.947-14.603-7.45-14.603-7.45v64.977l15.04%208.063V72.382s20.478%2039.346%2020.689%2039.78c.214.429%202.257%204.57%204.459%206.028%202.92%201.939%2015.458%209.477%2015.458%209.477z'%20/%3e%3c/svg%3e",Eye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23130754'%20d='M46.236%207.567h13.99v29.047h-13.99Zm0%2059.668h13.99V96.28h-13.99Z'/%3e%3cpath%20fill='%23ffca00'%20d='M46.236%2045.092h13.99v13.705h-13.99Z'/%3e%3cpath%20fill='%23130754'%20d='M23.763%2031.446h13.989V128h-13.99ZM68.245%2091.2h13.99v29.046h-13.99Zm0-59.72h13.99v29.047h-13.99Z'/%3e%3cpath%20fill='%23e70488'%20d='M68.245%2069.011h13.99v13.705h-13.99Z'/%3e%3cpath%20fill='%23130754'%20d='M90.248%200h13.99v96.554h-13.99Z'/%3e%3c/svg%3e",Cye="/assets/postgresql-CTql7Pj9.svg",Mye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3clinearGradient%20id='python-original-a'%20gradientUnits='userSpaceOnUse'%20x1='70.252'%20y1='1237.476'%20x2='170.659'%20y2='1151.089'%20gradientTransform='matrix(.563%200%200%20-.568%20-29.215%20707.817)'%3e%3cstop%20offset='0'%20stop-color='%235A9FD4'/%3e%3cstop%20offset='1'%20stop-color='%23306998'/%3e%3c/linearGradient%3e%3clinearGradient%20id='python-original-b'%20gradientUnits='userSpaceOnUse'%20x1='209.474'%20y1='1098.811'%20x2='173.62'%20y2='1149.537'%20gradientTransform='matrix(.563%200%200%20-.568%20-29.215%20707.817)'%3e%3cstop%20offset='0'%20stop-color='%23FFD43B'/%3e%3cstop%20offset='1'%20stop-color='%23FFE873'/%3e%3c/linearGradient%3e%3cpath%20fill='url(%23python-original-a)'%20d='M63.391%201.988c-4.222.02-8.252.379-11.8%201.007-10.45%201.846-12.346%205.71-12.346%2012.837v9.411h24.693v3.137H29.977c-7.176%200-13.46%204.313-15.426%2012.521-2.268%209.405-2.368%2015.275%200%2025.096%201.755%207.311%205.947%2012.519%2013.124%2012.519h8.491V67.234c0-8.151%207.051-15.34%2015.426-15.34h24.665c6.866%200%2012.346-5.654%2012.346-12.548V15.833c0-6.693-5.646-11.72-12.346-12.837-4.244-.706-8.645-1.027-12.866-1.008zM50.037%209.557c2.55%200%204.634%202.117%204.634%204.721%200%202.593-2.083%204.69-4.634%204.69-2.56%200-4.633-2.097-4.633-4.69-.001-2.604%202.073-4.721%204.633-4.721z'%20transform='translate(0%2010.26)'/%3e%3cpath%20fill='url(%23python-original-b)'%20d='M91.682%2028.38v10.966c0%208.5-7.208%2015.655-15.426%2015.655H51.591c-6.756%200-12.346%205.783-12.346%2012.549v23.515c0%206.691%205.818%2010.628%2012.346%2012.547%207.816%202.297%2015.312%202.713%2024.665%200%206.216-1.801%2012.346-5.423%2012.346-12.547v-9.412H63.938v-3.138h37.012c7.176%200%209.852-5.005%2012.348-12.519%202.578-7.735%202.467-15.174%200-25.096-1.774-7.145-5.161-12.521-12.348-12.521h-9.268zM77.809%2087.927c2.561%200%204.634%202.097%204.634%204.692%200%202.602-2.074%204.719-4.634%204.719-2.55%200-4.633-2.117-4.633-4.719%200-2.595%202.083-4.692%204.633-4.692z'%20transform='translate(0%2010.26)'/%3e%3cradialGradient%20id='python-original-c'%20cx='1825.678'%20cy='444.45'%20r='26.743'%20gradientTransform='matrix(0%20-.24%20-1.055%200%20532.979%20557.576)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23B8B8B8'%20stop-opacity='.498'/%3e%3cstop%20offset='1'%20stop-color='%237F7F7F'%20stop-opacity='0'/%3e%3c/radialGradient%3e%3cpath%20opacity='.444'%20fill='url(%23python-original-c)'%20d='M97.309%20119.597c0%203.543-14.816%206.416-33.091%206.416-18.276%200-33.092-2.873-33.092-6.416%200-3.544%2014.815-6.417%2033.092-6.417%2018.275%200%2033.091%202.872%2033.091%206.417z'/%3e%3c/svg%3e",Tye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cg%20fill='%2361DAFB'%3e%3ccircle%20cx='64'%20cy='64'%20r='11.4'/%3e%3cpath%20d='M107.3%2045.2c-2.2-.8-4.5-1.6-6.9-2.3.6-2.4%201.1-4.8%201.5-7.1%202.1-13.2-.2-22.5-6.6-26.1-1.9-1.1-4-1.6-6.4-1.6-7%200-15.9%205.2-24.9%2013.9-9-8.7-17.9-13.9-24.9-13.9-2.4%200-4.5.5-6.4%201.6-6.4%203.7-8.7%2013-6.6%2026.1.4%202.3.9%204.7%201.5%207.1-2.4.7-4.7%201.4-6.9%202.3C8.2%2050%201.4%2056.6%201.4%2064s6.9%2014%2019.3%2018.8c2.2.8%204.5%201.6%206.9%202.3-.6%202.4-1.1%204.8-1.5%207.1-2.1%2013.2.2%2022.5%206.6%2026.1%201.9%201.1%204%201.6%206.4%201.6%207.1%200%2016-5.2%2024.9-13.9%209%208.7%2017.9%2013.9%2024.9%2013.9%202.4%200%204.5-.5%206.4-1.6%206.4-3.7%208.7-13%206.6-26.1-.4-2.3-.9-4.7-1.5-7.1%202.4-.7%204.7-1.4%206.9-2.3%2012.5-4.8%2019.3-11.4%2019.3-18.8s-6.8-14-19.3-18.8zM92.5%2014.7c4.1%202.4%205.5%209.8%203.8%2020.3-.3%202.1-.8%204.3-1.4%206.6-5.2-1.2-10.7-2-16.5-2.5-3.4-4.8-6.9-9.1-10.4-13%207.4-7.3%2014.9-12.3%2021-12.3%201.3%200%202.5.3%203.5.9zM81.3%2074c-1.8%203.2-3.9%206.4-6.1%209.6-3.7.3-7.4.4-11.2.4-3.9%200-7.6-.1-11.2-.4-2.2-3.2-4.2-6.4-6-9.6-1.9-3.3-3.7-6.7-5.3-10%201.6-3.3%203.4-6.7%205.3-10%201.8-3.2%203.9-6.4%206.1-9.6%203.7-.3%207.4-.4%2011.2-.4%203.9%200%207.6.1%2011.2.4%202.2%203.2%204.2%206.4%206%209.6%201.9%203.3%203.7%206.7%205.3%2010-1.7%203.3-3.4%206.6-5.3%2010zm8.3-3.3c1.5%203.5%202.7%206.9%203.8%2010.3-3.4.8-7%201.4-10.8%201.9%201.2-1.9%202.5-3.9%203.6-6%201.2-2.1%202.3-4.2%203.4-6.2zM64%2097.8c-2.4-2.6-4.7-5.4-6.9-8.3%202.3.1%204.6.2%206.9.2%202.3%200%204.6-.1%206.9-.2-2.2%202.9-4.5%205.7-6.9%208.3zm-18.6-15c-3.8-.5-7.4-1.1-10.8-1.9%201.1-3.3%202.3-6.8%203.8-10.3%201.1%202%202.2%204.1%203.4%206.1%201.2%202.2%202.4%204.1%203.6%206.1zm-7-25.5c-1.5-3.5-2.7-6.9-3.8-10.3%203.4-.8%207-1.4%2010.8-1.9-1.2%201.9-2.5%203.9-3.6%206-1.2%202.1-2.3%204.2-3.4%206.2zM64%2030.2c2.4%202.6%204.7%205.4%206.9%208.3-2.3-.1-4.6-.2-6.9-.2-2.3%200-4.6.1-6.9.2%202.2-2.9%204.5-5.7%206.9-8.3zm22.2%2021l-3.6-6c3.8.5%207.4%201.1%2010.8%201.9-1.1%203.3-2.3%206.8-3.8%2010.3-1.1-2.1-2.2-4.2-3.4-6.2zM31.7%2035c-1.7-10.5-.3-17.9%203.8-20.3%201-.6%202.2-.9%203.5-.9%206%200%2013.5%204.9%2021%2012.3-3.5%203.8-7%208.2-10.4%2013-5.8.5-11.3%201.4-16.5%202.5-.6-2.3-1-4.5-1.4-6.6zM7%2064c0-4.7%205.7-9.7%2015.7-13.4%202-.8%204.2-1.5%206.4-2.1%201.6%205%203.6%2010.3%206%2015.6-2.4%205.3-4.5%2010.5-6%2015.5C15.3%2075.6%207%2069.6%207%2064zm28.5%2049.3c-4.1-2.4-5.5-9.8-3.8-20.3.3-2.1.8-4.3%201.4-6.6%205.2%201.2%2010.7%202%2016.5%202.5%203.4%204.8%206.9%209.1%2010.4%2013-7.4%207.3-14.9%2012.3-21%2012.3-1.3%200-2.5-.3-3.5-.9zM96.3%2093c1.7%2010.5.3%2017.9-3.8%2020.3-1%20.6-2.2.9-3.5.9-6%200-13.5-4.9-21-12.3%203.5-3.8%207-8.2%2010.4-13%205.8-.5%2011.3-1.4%2016.5-2.5.6%202.3%201%204.5%201.4%206.6zm9-15.6c-2%20.8-4.2%201.5-6.4%202.1-1.6-5-3.6-10.3-6-15.6%202.4-5.3%204.5-10.5%206-15.5%2013.8%204%2022.1%2010%2022.1%2015.6%200%204.7-5.8%209.7-15.7%2013.4z'/%3e%3c/g%3e%3c/svg%3e",Rye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%2300618A'%20d='M117.688%2098.242c-6.973-.191-12.297.461-16.852%202.379-1.293.547-3.355.559-3.566%202.18.711.746.82%201.859%201.387%202.777%201.086%201.754%202.922%204.113%204.559%205.352%201.789%201.348%203.633%202.793%205.551%203.961%203.414%202.082%207.223%203.27%2010.504%205.352%201.938%201.23%203.859%202.777%205.75%204.164.934.684%201.563%201.75%202.773%202.18v-.195c-.637-.812-.801-1.93-1.387-2.777l-2.578-2.578c-2.52-3.344-5.719-6.281-9.117-8.719-2.711-1.949-8.781-4.578-9.91-7.73l-.199-.199c1.922-.219%204.172-.914%205.949-1.391%202.98-.797%205.645-.59%208.719-1.387l4.164-1.187v-.793c-1.555-1.594-2.664-3.707-4.359-5.152-4.441-3.781-9.285-7.555-14.273-10.703-2.766-1.746-6.184-2.883-9.117-4.363-.988-.496-2.719-.758-3.371-1.586-1.539-1.961-2.379-4.449-3.566-6.738-2.488-4.793-4.93-10.023-7.137-15.066-1.504-3.437-2.484-6.828-4.359-9.91-9-14.797-18.687-23.73-33.695-32.508-3.195-1.867-7.039-2.605-11.102-3.57l-6.543-.395c-1.332-.555-2.715-2.184-3.965-2.977C16.977%203.52%204.223-3.312.539%205.672-1.785%2011.34%204.016%2016.871%206.09%2019.746c1.457%202.012%203.32%204.273%204.359%206.539.688%201.492.805%202.984%201.391%204.559%201.438%203.883%202.695%208.109%204.559%2011.695.941%201.816%201.98%203.727%203.172%205.352.727.996%201.98%201.438%202.18%202.973-1.227%201.715-1.297%204.375-1.984%206.543-3.098%209.77-1.926%2021.91%202.578%2029.137%201.383%202.223%204.641%206.98%209.117%205.156%203.918-1.598%203.043-6.539%204.164-10.902.254-.988.098-1.715.594-2.379v.199l3.57%207.133c2.641%204.254%207.324%208.699%2011.297%2011.699%202.059%201.555%203.68%204.242%206.344%205.152v-.199h-.199c-.516-.805-1.324-1.137-1.98-1.781-1.551-1.523-3.277-3.414-4.559-5.156-3.613-4.902-6.805-10.27-9.711-15.855-1.391-2.668-2.598-5.609-3.77-8.324-.453-1.047-.445-2.633-1.387-3.172-1.281%201.988-3.172%203.598-4.164%205.945-1.582%203.754-1.789%208.336-2.375%2013.082-.348.125-.195.039-.398.199-2.762-.668-3.73-3.508-4.758-5.949-2.594-6.164-3.078-16.09-.793-23.191.59-1.836%203.262-7.617%202.18-9.316-.516-1.691-2.219-2.672-3.172-3.965-1.18-1.598-2.355-3.703-3.172-5.551-2.125-4.805-3.113-10.203-5.352-15.062-1.07-2.324-2.875-4.676-4.359-6.738-1.645-2.289-3.484-3.977-4.758-6.742-.453-.984-1.066-2.559-.398-3.566.215-.684.516-.969%201.191-1.191%201.148-.887%204.352.297%205.547.793%203.18%201.32%205.832%202.578%208.527%204.363%201.289.855%202.598%202.512%204.16%202.973h1.785c2.789.641%205.914.195%208.523.988%204.609%201.402%208.738%203.582%2012.488%205.949%2011.422%207.215%2020.766%2017.48%2027.156%2029.734%201.027%201.973%201.473%203.852%202.379%205.945%201.824%204.219%204.125%208.559%205.941%2012.688%201.816%204.113%203.582%208.27%206.148%2011.695%201.348%201.801%206.551%202.766%208.918%203.766%201.66.699%204.379%201.43%205.949%202.379%203%201.809%205.906%203.965%208.723%205.945%201.402.992%205.73%203.168%205.945%204.957zm-88.605-75.52c-1.453-.027-2.48.156-3.566.395v.199h.195c.695%201.422%201.918%202.34%202.777%203.566l1.98%204.164.199-.195c1.227-.867%201.789-2.25%201.781-4.363-.492-.52-.562-1.164-.992-1.785-.562-.824-1.66-1.289-2.375-1.98zm0%200'/%3e%3c/svg%3e",Aye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20d='M64.004%2025.602c-17.067%200-27.73%208.53-32%2025.597%206.398-8.531%2013.867-11.73%2022.398-9.597%204.871%201.214%208.352%204.746%2012.207%208.66C72.883%2056.629%2080.145%2064%2096.004%2064c17.066%200%2027.73-8.531%2032-25.602-6.399%208.536-13.867%2011.735-22.399%209.602-4.87-1.215-8.347-4.746-12.207-8.66-6.27-6.367-13.53-13.738-29.394-13.738zM32.004%2064c-17.066%200-27.73%208.531-32%2025.602C6.402%2081.066%2013.87%2077.867%2022.402%2080c4.871%201.215%208.352%204.746%2012.207%208.66%206.274%206.367%2013.536%2013.738%2029.395%2013.738%2017.066%200%2027.73-8.53%2032-25.597-6.399%208.531-13.867%2011.73-22.399%209.597-4.87-1.214-8.347-4.746-12.207-8.66C55.128%2071.371%2047.868%2064%2032.004%2064zm0%200'%20fill='%2338bdf8'/%3e%3c/svg%3e",Iye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%20128%20128'%3e%3cpath%20d='m61.55%20128-21.84-12.68V40.55L6.81%2059.56l.08-28.32L61.55%200zM66.46%200v128l21.84-12.68V79.31l16.49%209.53-.1-24.63-16.39-9.36v-14.3l32.89%2019.01-.08-28.32z'%20fill='%23ff6f00'%20/%3e%3c/svg%3e",Pye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%23fff'%20d='M22.67%2047h99.67v73.67H22.67z'/%3e%3cpath%20data-name='original'%20fill='%23007acc'%20d='M1.5%2063.91v62.5h125v-125H1.5zm100.73-5a15.56%2015.56%200%20017.82%204.5%2020.58%2020.58%200%20013%204c0%20.16-5.4%203.81-8.69%205.85-.12.08-.6-.44-1.13-1.23a7.09%207.09%200%2000-5.87-3.53c-3.79-.26-6.23%201.73-6.21%205a4.58%204.58%200%2000.54%202.34c.83%201.73%202.38%202.76%207.24%204.86%208.95%203.85%2012.78%206.39%2015.16%2010%202.66%204%203.25%2010.46%201.45%2015.24-2%205.2-6.9%208.73-13.83%209.9a38.32%2038.32%200%2001-9.52-.1%2023%2023%200%2001-12.72-6.63c-1.15-1.27-3.39-4.58-3.25-4.82a9.34%209.34%200%20011.15-.73L82%20101l3.59-2.08.75%201.11a16.78%2016.78%200%20004.74%204.54c4%202.1%209.46%201.81%2012.16-.62a5.43%205.43%200%2000.69-6.92c-1-1.39-3-2.56-8.59-5-6.45-2.78-9.23-4.5-11.77-7.24a16.48%2016.48%200%2001-3.43-6.25%2025%2025%200%2001-.22-8c1.33-6.23%206-10.58%2012.82-11.87a31.66%2031.66%200%20019.49.26zm-29.34%205.24v5.12H56.66v46.23H45.15V69.26H28.88v-5a49.19%2049.19%200%2001.12-5.17C29.08%2059%2039%2059%2051%2059h21.83z'/%3e%3c/svg%3e",kye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cmask%20id='a'%20width='128'%20height='128'%20x='0'%20y='0'%20maskUnits='userSpaceOnUse'%20style='mask-type:alpha'%3e%3cpath%20fill='%23fff'%20fill-rule='evenodd'%20d='M90.767%20127.126a7.968%207.968%200%200%200%206.35-.244l26.353-12.681a8%208%200%200%200%204.53-7.209V21.009a8%208%200%200%200-4.53-7.21L97.117%201.12a7.97%207.97%200%200%200-9.093%201.548l-50.45%2046.026L15.6%2032.013a5.328%205.328%200%200%200-6.807.302l-7.048%206.411a5.335%205.335%200%200%200-.006%207.888L20.796%2064%201.74%2081.387a5.336%205.336%200%200%200%20.006%207.887l7.048%206.411a5.327%205.327%200%200%200%206.807.303l21.974-16.68%2050.45%2046.025a7.96%207.96%200%200%200%202.743%201.793Zm5.252-92.183L57.74%2064l38.28%2029.058V34.943Z'%20clip-rule='evenodd'/%3e%3c/mask%3e%3cg%20mask='url(%23a)'%3e%3cpath%20fill='%230065A9'%20d='M123.471%2013.82%2097.097%201.12A7.973%207.973%200%200%200%2088%202.668L1.662%2081.387a5.333%205.333%200%200%200%20.006%207.887l7.052%206.411a5.333%205.333%200%200%200%206.811.303l103.971-78.875c3.488-2.646%208.498-.158%208.498%204.22v-.306a8.001%208.001%200%200%200-4.529-7.208Z'/%3e%3cg%20filter='url(%23b)'%3e%3cpath%20fill='%23007ACC'%20d='m123.471%20114.181-26.374%2012.698A7.973%207.973%200%200%201%2088%20125.333L1.662%2046.613a5.333%205.333%200%200%201%20.006-7.887l7.052-6.411a5.333%205.333%200%200%201%206.811-.303l103.971%2078.874c3.488%202.647%208.498.159%208.498-4.219v.306a8.001%208.001%200%200%201-4.529%207.208Z'/%3e%3c/g%3e%3cg%20filter='url(%23c)'%3e%3cpath%20fill='%231F9CF0'%20d='M97.098%20126.882A7.977%207.977%200%200%201%2088%20125.333c2.952%202.952%208%20.861%208-3.314V5.98c0-4.175-5.048-6.266-8-3.313a7.977%207.977%200%200%201%209.098-1.549L123.467%2013.8A8%208%200%200%201%20128%2021.01v85.982a8%208%200%200%201-4.533%207.21l-26.369%2012.681Z'/%3e%3c/g%3e%3cpath%20fill='url(%23d)'%20fill-rule='evenodd'%20d='M90.69%20127.126a7.968%207.968%200%200%200%206.349-.244l26.353-12.681a8%208%200%200%200%204.53-7.21V21.009a8%208%200%200%200-4.53-7.21L97.039%201.12a7.97%207.97%200%200%200-9.093%201.548l-50.45%2046.026-21.974-16.68a5.328%205.328%200%200%200-6.807.302l-7.048%206.411a5.336%205.336%200%200%200-.006%207.888L20.718%2064%201.662%2081.386a5.335%205.335%200%200%200%20.006%207.888l7.048%206.411a5.328%205.328%200%200%200%206.807.303l21.975-16.681%2050.45%2046.026a7.959%207.959%200%200%200%202.742%201.793Zm5.252-92.184L57.662%2064l38.28%2029.057V34.943Z'%20clip-rule='evenodd'%20opacity='0.25'%20style='mix-blend-mode:overlay'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='b'%20width='144.744'%20height='113.408'%20x='-8.41115'%20y='22.5944'%20color-interpolation-filters='sRGB'%20filterUnits='userSpaceOnUse'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20result='hardAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'/%3e%3cfeOffset/%3e%3cfeGaussianBlur%20stdDeviation='4.16667'/%3e%3cfeColorMatrix%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200.25%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20mode='overlay'%20result='effect1_dropShadow_1_36'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect1_dropShadow_1_36'%20result='shape'/%3e%3c/filter%3e%3cfilter%20id='c'%20width='56.6667'%20height='144.007'%20x='79.6667'%20y='-8.0035'%20color-interpolation-filters='sRGB'%20filterUnits='userSpaceOnUse'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20result='hardAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'/%3e%3cfeOffset/%3e%3cfeGaussianBlur%20stdDeviation='4.16667'/%3e%3cfeColorMatrix%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200.25%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20mode='overlay'%20result='effect1_dropShadow_1_36'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect1_dropShadow_1_36'%20result='shape'/%3e%3c/filter%3e%3clinearGradient%20id='d'%20x1='63.9222'%20x2='63.9222'%20y1='0.329902'%20y2='127.67'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23fff'/%3e%3cstop%20offset='1'%20stop-color='%23fff'%20stop-opacity='0'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",Dye="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20128%20128'%3e%3cpath%20fill='%2300ADEF'%20d='M126%201.637l-67%209.834v49.831l67-.534zM1.647%2066.709l.003%2042.404%2050.791%206.983-.04-49.057zm56.82.68l.094%2049.465%2067.376%209.509.016-58.863zM1.61%2019.297l.047%2042.383%2050.791-.289-.023-49.016z'/%3e%3c/svg%3e",nr={c:sye,cpp:aye,canva:uye,css:lye,docker:cye,express:hye,figma:fye,git:dye,github:pye,html:mye,java:vye,javascript:gye,linux:yye,matplotlib:xye,mongodb:wye,nodejs:_ye,notion:bye,numpy:Sye,pandas:Eye,postgresql:Cye,python:Mye,react:Tye,sql:Rye,tailwindcss:Aye,tensorflow:Iye,typescript:Pye,vscode:kye,windows:Dye},Nye=()=>{const[n,e]=H.useState(window.innerWidth<=768),t=H.useRef(null),[r,i]=H.useState(0);H.useEffect(()=>{const a=()=>e(window.innerWidth<=768);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),H.useEffect(()=>{if(!n)return;const a=()=>{t.current&&i(t.current.scrollTop)},u=t.current;if(u)return u.addEventListener("scroll",a),()=>u.removeEventListener("scroll",a)},[n]);const o=[{name:"HTML",url:nr.html},{name:"CSS",url:nr.css},{name:"React",url:nr.react},{name:"Git",url:nr.git},{name:"GitHub",url:nr.github},{name:"VS Code",url:nr.vscode},{name:"Linux",url:nr.linux},{name:"C",url:nr.c},{name:"C++",url:nr.cpp},{name:"Python",url:nr.python},{name:"Java",url:nr.java},{name:"JavaScript",url:nr.javascript},{name:"Pandas",url:nr.pandas},{name:"NumPy",url:nr.numpy},{name:"Matplotlib",url:nr.matplotlib},{name:"SQL",url:nr.sql},{name:"MongoDB",url:nr.mongodb},{name:"Canva",url:nr.canva},{name:"Notion",url:nr.notion},{name:"Node.js",url:nr.nodejs},{name:"TypeScript",url:nr.typescript},{name:"Docker",url:nr.docker},{name:"TensorFlow",url:nr.tensorflow},{name:"Figma",url:nr.figma},{name:"Express",url:nr.express},{name:"PostgreSQL",url:nr.postgresql},{name:"Windows",url:nr.windows},{name:"Tailwind CSS",url:nr.tailwindcss}],s=({skill:a,index:u})=>{const l=Math.sin(r*.01+u*.5)*8;return G.jsxs("div",{className:"relative w-full aspect-square rounded-xl bg-gradient-to-br from-surface to-background border border-white/10 flex flex-col items-center justify-center transition-all duration-300",style:{transform:`translateY(${l}px)`},children:[a.url&&G.jsx("img",{src:a.url,alt:a.name,className:"w-12 h-12 object-contain mb-2 drop-shadow-[0_0_8px_rgba(124,58,237,0.3)]"}),G.jsx("span",{className:"text-sm font-medium text-white text-center px-2",children:a.name})]})};return G.jsxs("section",{className:"relative min-h-screen w-full overflow-visible",children:[G.jsx("div",{className:"absolute inset-0 z-[1]",children:G.jsx(oye,{})}),n?G.jsxs("div",{ref:t,className:"relative z-[10] w-full h-full pt-20 pb-10 px-4",children:[G.jsx("div",{className:"text-center mb-8",children:G.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift",children:"Skills"})}),G.jsx("div",{className:"grid grid-cols-3 gap-3 w-full",children:o.map((a,u)=>G.jsx(s,{skill:a,index:u},u))})]}):G.jsxs(G.Fragment,{children:[G.jsx("div",{className:"absolute inset-0 z-[2] pointer-events-none",children:G.jsx(iye,{items:o,gradientColor:"transparent"})}),G.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[10]",children:G.jsx("h1",{className:"text-7xl sm:text-8xl md:text-9xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift",children:"Skills"})})]})]})};var Zj={exports:{}},sp={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */sp.ConcurrentRoot=1;sp.ContinuousEventPriority=4;sp.DefaultEventPriority=16;sp.DiscreteEventPriority=1;sp.IdleEventPriority=536870912;sp.LegacyRoot=0;Zj.exports=sp;var Zm=Zj.exports;function Lye(n){let e;const t=new Set,r=(l,c)=>{const h=typeof l=="function"?l(e):l;if(h!==e){const f=e;e=c?h:Object.assign({},e,h),t.forEach(d=>d(e,f))}},i=()=>e,o=(l,c=i,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let f=c(e);function d(){const p=c(e);if(!h(f,p)){const v=f;l(f=p,v)}}return t.add(d),()=>t.delete(d)},u={setState:r,getState:i,subscribe:(l,c,h)=>c||h?o(l,c,h):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=n(r,i,u),u}const Fye=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Fz=Fye?H.useEffect:H.useLayoutEffect;function Oye(n){const e=typeof n=="function"?Lye(n):n,t=(r=e.getState,i=Object.is)=>{const[,o]=H.useReducer(g=>g+1,0),s=e.getState(),a=H.useRef(s),u=H.useRef(r),l=H.useRef(i),c=H.useRef(!1),h=H.useRef();h.current===void 0&&(h.current=r(s));let f,d=!1;(a.current!==s||u.current!==r||l.current!==i||c.current)&&(f=r(s),d=!i(h.current,f)),Fz(()=>{d&&(h.current=f),a.current=s,u.current=r,l.current=i,c.current=!1});const p=H.useRef(s);Fz(()=>{const g=()=>{try{const x=e.getState(),_=u.current(x);l.current(h.current,_)||(a.current=x,h.current=_,o())}catch{c.current=!0,o()}},m=e.subscribe(g);return e.getState()!==p.current&&g(),m},[]);const v=d?f:h.current;return H.useDebugValue(v),v};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[t,e];return{next(){const i=r.length<=0;return{value:r.shift(),done:i}}}},t}var Qj={exports:{}},Jj={exports:{}},eX={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(F,U){var L=F.length;F.push(U);e:for(;0<L;){var j=L-1>>>1,Q=F[j];if(0<i(Q,U))F[j]=U,F[L]=Q,L=j;else break e}}function t(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var U=F[0],L=F.pop();if(L!==U){F[0]=L;e:for(var j=0,Q=F.length,K=Q>>>1;j<K;){var ie=2*(j+1)-1,pe=F[ie],we=ie+1,ce=F[we];if(0>i(pe,L))we<Q&&0>i(ce,pe)?(F[j]=ce,F[we]=L,j=we):(F[j]=pe,F[ie]=L,j=ie);else if(we<Q&&0>i(ce,L))F[j]=ce,F[we]=L,j=we;else break e}}return U}function i(F,U){var L=F.sortIndex-U.sortIndex;return L!==0?L:F.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var u=[],l=[],c=1,h=null,f=3,d=!1,p=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(F){for(var U=t(l);U!==null;){if(U.callback===null)r(l);else if(U.startTime<=F)r(l),U.sortIndex=U.expirationTime,e(u,U);else break;U=t(l)}}function b(F){if(v=!1,_(F),!p)if(t(u)!==null)p=!0,z(S);else{var U=t(l);U!==null&&V(b,U.startTime-F)}}function S(F,U){p=!1,v&&(v=!1,m(R),R=-1),d=!0;var L=f;try{for(_(U),h=t(u);h!==null&&(!(h.expirationTime>U)||F&&!P());){var j=h.callback;if(typeof j=="function"){h.callback=null,f=h.priorityLevel;var Q=j(h.expirationTime<=U);U=n.unstable_now(),typeof Q=="function"?h.callback=Q:h===t(u)&&r(u),_(U)}else r(u);h=t(u)}if(h!==null)var K=!0;else{var ie=t(l);ie!==null&&V(b,ie.startTime-U),K=!1}return K}finally{h=null,f=L,d=!1}}var E=!1,C=null,R=-1,T=5,A=-1;function P(){return!(n.unstable_now()-A<T)}function k(){if(C!==null){var F=n.unstable_now();A=F;var U=!0;try{U=C(!0,F)}finally{U?W():(E=!1,C=null)}}else E=!1}var W;if(typeof x=="function")W=function(){x(k)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,O=N.port2;N.port1.onmessage=k,W=function(){O.postMessage(null)}}else W=function(){g(k,0)};function z(F){C=F,E||(E=!0,W())}function V(F,U){R=g(function(){F(n.unstable_now())},U)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_continueExecution=function(){p||d||(p=!0,z(S))},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(F){switch(f){case 1:case 2:case 3:var U=3;break;default:U=f}var L=f;f=U;try{return F()}finally{f=L}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(F,U){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var L=f;f=F;try{return U()}finally{f=L}},n.unstable_scheduleCallback=function(F,U,L){var j=n.unstable_now();switch(typeof L=="object"&&L!==null?(L=L.delay,L=typeof L=="number"&&0<L?j+L:j):L=j,F){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=L+Q,F={id:c++,callback:U,priorityLevel:F,startTime:L,expirationTime:Q,sortIndex:-1},L>j?(F.sortIndex=L,e(l,F),t(u)===null&&F===t(l)&&(v?(m(R),R=-1):v=!0,V(b,L-j))):(F.sortIndex=Q,e(u,F),p||d||(p=!0,z(S))),F},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(F){var U=f;return function(){var L=f;f=U;try{return F.apply(this,arguments)}finally{f=L}}}})(eX);Jj.exports=eX;var zI=Jj.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bye=function(e){var t={},r=H,i=zI,o=Object.assign;function s(y){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+y,M=1;M<arguments.length;M++)w+="&args[]="+encodeURIComponent(arguments[M]);return"Minified React error #"+y+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),l=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),b=Symbol.for("react.offscreen"),S=Symbol.iterator;function E(y){return y===null||typeof y!="object"?null:(y=S&&y[S]||y["@@iterator"],typeof y=="function"?y:null)}function C(y){if(y==null)return null;if(typeof y=="function")return y.displayName||y.name||null;if(typeof y=="string")return y;switch(y){case c:return"Fragment";case l:return"Portal";case f:return"Profiler";case h:return"StrictMode";case g:return"Suspense";case m:return"SuspenseList"}if(typeof y=="object")switch(y.$$typeof){case p:return(y.displayName||"Context")+".Consumer";case d:return(y._context.displayName||"Context")+".Provider";case v:var w=y.render;return y=y.displayName,y||(y=w.displayName||w.name||"",y=y!==""?"ForwardRef("+y+")":"ForwardRef"),y;case x:return w=y.displayName||null,w!==null?w:C(y.type)||"Memo";case _:w=y._payload,y=y._init;try{return C(y(w))}catch{}}return null}function R(y){var w=y.type;switch(y.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return y=w.render,y=y.displayName||y.name||"",w.displayName||(y!==""?"ForwardRef("+y+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return C(w);case 8:return w===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function T(y){var w=y,M=y;if(y.alternate)for(;w.return;)w=w.return;else{y=w;do w=y,w.flags&4098&&(M=w.return),y=w.return;while(y)}return w.tag===3?M:null}function A(y){if(T(y)!==y)throw Error(s(188))}function P(y){var w=y.alternate;if(!w){if(w=T(y),w===null)throw Error(s(188));return w!==y?null:y}for(var M=y,I=w;;){var D=M.return;if(D===null)break;var B=D.alternate;if(B===null){if(I=D.return,I!==null){M=I;continue}break}if(D.child===B.child){for(B=D.child;B;){if(B===M)return A(D),y;if(B===I)return A(D),w;B=B.sibling}throw Error(s(188))}if(M.return!==I.return)M=D,I=B;else{for(var re=!1,ve=D.child;ve;){if(ve===M){re=!0,M=D,I=B;break}if(ve===I){re=!0,I=D,M=B;break}ve=ve.sibling}if(!re){for(ve=B.child;ve;){if(ve===M){re=!0,M=B,I=D;break}if(ve===I){re=!0,I=B,M=D;break}ve=ve.sibling}if(!re)throw Error(s(189))}}if(M.alternate!==I)throw Error(s(190))}if(M.tag!==3)throw Error(s(188));return M.stateNode.current===M?y:w}function k(y){return y=P(y),y!==null?W(y):null}function W(y){if(y.tag===5||y.tag===6)return y;for(y=y.child;y!==null;){var w=W(y);if(w!==null)return w;y=y.sibling}return null}function N(y){if(y.tag===5||y.tag===6)return y;for(y=y.child;y!==null;){if(y.tag!==4){var w=N(y);if(w!==null)return w}y=y.sibling}return null}var O=Array.isArray,z=e.getPublicInstance,V=e.getRootHostContext,F=e.getChildHostContext,U=e.prepareForCommit,L=e.resetAfterCommit,j=e.createInstance,Q=e.appendInitialChild,K=e.finalizeInitialChildren,ie=e.prepareUpdate,pe=e.shouldSetTextContent,we=e.createTextInstance,ce=e.scheduleTimeout,_e=e.cancelTimeout,Oe=e.noTimeout,Ve=e.isPrimaryRenderer,Ne=e.supportsMutation,Z=e.supportsPersistence,de=e.supportsHydration,me=e.getInstanceFromNode,Ie=e.preparePortalMount,xe=e.getCurrentEventPriority,se=e.detachDeletedInstance,Xe=e.supportsMicrotasks,X=e.scheduleMicrotask,$=e.supportsTestSelectors,le=e.findFiberRoot,ze=e.getBoundingRect,Te=e.getTextContent,J=e.isHiddenSubtree,be=e.matchAccessibilityRole,ke=e.setFocusIfFocusable,He=e.setupIntersectionObserver,Ue=e.appendChild,We=e.appendChildToContainer,Le=e.commitTextUpdate,yt=e.commitMount,rt=e.commitUpdate,dt=e.insertBefore,ot=e.insertInContainerBefore,Je=e.removeChild,Wt=e.removeChildFromContainer,jt=e.resetTextContent,yn=e.hideInstance,nt=e.hideTextInstance,Ye=e.unhideInstance,ae=e.unhideTextInstance,Ze=e.clearContainer,et=e.cloneInstance,Nt=e.createContainerChildSet,Tt=e.appendChildToContainerChildSet,hn=e.finalizeContainerChildren,Sn=e.replaceContainerChildren,mt=e.cloneHiddenInstance,ft=e.cloneHiddenTextInstance,Mt=e.canHydrateInstance,Ke=e.canHydrateTextInstance,Rt=e.canHydrateSuspenseInstance,It=e.isSuspenseInstancePending,Gt=e.isSuspenseInstanceFallback,tr=e.registerSuspenseInstanceRetry,qt=e.getNextHydratableSibling,qn=e.getFirstHydratableChild,Sr=e.getFirstHydratableChildWithinContainer,Qn=e.getFirstHydratableChildWithinSuspenseInstance,Yn=e.hydrateInstance,Nn=e.hydrateTextInstance,mi=e.hydrateSuspenseInstance,q=e.getNextHydratableInstanceAfterSuspenseInstance,ge=e.commitHydratedContainer,Re=e.commitHydratedSuspenseInstance,Me=e.clearSuspenseBoundary,Ee=e.clearSuspenseBoundaryFromContainer,it=e.shouldDeleteUnhydratedTailInstances,xt=e.didNotMatchHydratedContainerTextInstance,Ht=e.didNotMatchHydratedTextInstance,vt;function wt(y){if(vt===void 0)try{throw Error()}catch(M){var w=M.stack.trim().match(/\n( *(at )?)/);vt=w&&w[1]||""}return`
`+vt+y}var Ut=!1;function Yt(y,w){if(!y||Ut)return"";Ut=!0;var M=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(tt){var I=tt}Reflect.construct(y,[],w)}else{try{w.call()}catch(tt){I=tt}y.call(w.prototype)}else{try{throw Error()}catch(tt){I=tt}y()}}catch(tt){if(tt&&I&&typeof tt.stack=="string"){for(var D=tt.stack.split(`
`),B=I.stack.split(`
`),re=D.length-1,ve=B.length-1;1<=re&&0<=ve&&D[re]!==B[ve];)ve--;for(;1<=re&&0<=ve;re--,ve--)if(D[re]!==B[ve]){if(re!==1||ve!==1)do if(re--,ve--,0>ve||D[re]!==B[ve]){var $e=`
`+D[re].replace(" at new "," at ");return y.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",y.displayName)),$e}while(1<=re&&0<=ve);break}}}finally{Ut=!1,Error.prepareStackTrace=M}return(y=y?y.displayName||y.name:"")?wt(y):""}var ar=Object.prototype.hasOwnProperty,Er=[],Mn=-1;function xr(y){return{current:y}}function $t(y){0>Mn||(y.current=Er[Mn],Er[Mn]=null,Mn--)}function ut(y,w){Mn++,Er[Mn]=y.current,y.current=w}var ma={},mn=xr(ma),Br=xr(!1),Lu=ma;function va(y,w){var M=y.type.contextTypes;if(!M)return ma;var I=y.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===w)return I.__reactInternalMemoizedMaskedChildContext;var D={},B;for(B in M)D[B]=w[B];return I&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=w,y.__reactInternalMemoizedMaskedChildContext=D),D}function ki(y){return y=y.childContextTypes,y!=null}function Kr(){$t(Br),$t(mn)}function Fu(y,w,M){if(mn.current!==ma)throw Error(s(168));ut(mn,w),ut(Br,M)}function gp(y,w,M){var I=y.stateNode;if(w=w.childContextTypes,typeof I.getChildContext!="function")return M;I=I.getChildContext();for(var D in I)if(!(D in w))throw Error(s(108,R(y)||"Unknown",D));return o({},M,I)}function ji(y){return y=(y=y.stateNode)&&y.__reactInternalMemoizedMergedChildContext||ma,Lu=mn.current,ut(mn,y),ut(Br,Br.current),!0}function yp(y,w,M){var I=y.stateNode;if(!I)throw Error(s(169));M?(y=gp(y,w,Lu),I.__reactInternalMemoizedMergedChildContext=y,$t(Br),$t(mn),ut(mn,y)):$t(Br),ut(Br,M)}var Ds=Math.clz32?Math.clz32:kZ,bx=Math.log,PZ=Math.LN2;function kZ(y){return y>>>=0,y===0?32:31-(bx(y)/PZ|0)|0}var Sx=64,Ex=4194304;function _g(y){switch(y&-y){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return y&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return y}}function Cx(y,w){var M=y.pendingLanes;if(M===0)return 0;var I=0,D=y.suspendedLanes,B=y.pingedLanes,re=M&268435455;if(re!==0){var ve=re&~D;ve!==0?I=_g(ve):(B&=re,B!==0&&(I=_g(B)))}else re=M&~D,re!==0?I=_g(re):B!==0&&(I=_g(B));if(I===0)return 0;if(w!==0&&w!==I&&!(w&D)&&(D=I&-I,B=w&-w,D>=B||D===16&&(B&4194240)!==0))return w;if(I&4&&(I|=M&16),w=y.entangledLanes,w!==0)for(y=y.entanglements,w&=I;0<w;)M=31-Ds(w),D=1<<M,I|=y[M],w&=~D;return I}function DZ(y,w){switch(y){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function NZ(y,w){for(var M=y.suspendedLanes,I=y.pingedLanes,D=y.expirationTimes,B=y.pendingLanes;0<B;){var re=31-Ds(B),ve=1<<re,$e=D[re];$e===-1?(!(ve&M)||ve&I)&&(D[re]=DZ(ve,w)):$e<=w&&(y.expiredLanes|=ve),B&=~ve}}function rC(y){return y=y.pendingLanes&-1073741825,y!==0?y:y&1073741824?1073741824:0}function iC(y){for(var w=[],M=0;31>M;M++)w.push(y);return w}function bg(y,w,M){y.pendingLanes|=w,w!==536870912&&(y.suspendedLanes=0,y.pingedLanes=0),y=y.eventTimes,w=31-Ds(w),y[w]=M}function LZ(y,w){var M=y.pendingLanes&~w;y.pendingLanes=w,y.suspendedLanes=0,y.pingedLanes=0,y.expiredLanes&=w,y.mutableReadLanes&=w,y.entangledLanes&=w,w=y.entanglements;var I=y.eventTimes;for(y=y.expirationTimes;0<M;){var D=31-Ds(M),B=1<<D;w[D]=0,I[D]=-1,y[D]=-1,M&=~B}}function oC(y,w){var M=y.entangledLanes|=w;for(y=y.entanglements;M;){var I=31-Ds(M),D=1<<I;D&w|y[I]&w&&(y[I]|=w),M&=~D}}var zn=0;function $N(y){return y&=-y,1<y?4<y?y&268435455?16:536870912:4:1}var sC=i.unstable_scheduleCallback,jN=i.unstable_cancelCallback,FZ=i.unstable_shouldYield,OZ=i.unstable_requestPaint,Di=i.unstable_now,aC=i.unstable_ImmediatePriority,BZ=i.unstable_UserBlockingPriority,uC=i.unstable_NormalPriority,UZ=i.unstable_IdlePriority,Mx=null,Ou=null;function zZ(y){if(Ou&&typeof Ou.onCommitFiberRoot=="function")try{Ou.onCommitFiberRoot(Mx,y,void 0,(y.current.flags&128)===128)}catch{}}function VZ(y,w){return y===w&&(y!==0||1/y===1/w)||y!==y&&w!==w}var Bu=typeof Object.is=="function"?Object.is:VZ,Al=null,Tx=!1,lC=!1;function XN(y){Al===null?Al=[y]:Al.push(y)}function WZ(y){Tx=!0,XN(y)}function Uu(){if(!lC&&Al!==null){lC=!0;var y=0,w=zn;try{var M=Al;for(zn=1;y<M.length;y++){var I=M[y];do I=I(!0);while(I!==null)}Al=null,Tx=!1}catch(D){throw Al!==null&&(Al=Al.slice(y+1)),sC(aC,Uu),D}finally{zn=w,lC=!1}}return null}var HZ=a.ReactCurrentBatchConfig;function Rx(y,w){if(Bu(y,w))return!0;if(typeof y!="object"||y===null||typeof w!="object"||w===null)return!1;var M=Object.keys(y),I=Object.keys(w);if(M.length!==I.length)return!1;for(I=0;I<M.length;I++){var D=M[I];if(!ar.call(w,D)||!Bu(y[D],w[D]))return!1}return!0}function GZ(y){switch(y.tag){case 5:return wt(y.type);case 16:return wt("Lazy");case 13:return wt("Suspense");case 19:return wt("SuspenseList");case 0:case 2:case 15:return y=Yt(y.type,!1),y;case 11:return y=Yt(y.type.render,!1),y;case 1:return y=Yt(y.type,!0),y;default:return""}}function Ja(y,w){if(y&&y.defaultProps){w=o({},w),y=y.defaultProps;for(var M in y)w[M]===void 0&&(w[M]=y[M]);return w}return w}var Ax=xr(null),Ix=null,xp=null,cC=null;function hC(){cC=xp=Ix=null}function qN(y,w,M){Ve?(ut(Ax,w._currentValue),w._currentValue=M):(ut(Ax,w._currentValue2),w._currentValue2=M)}function fC(y){var w=Ax.current;$t(Ax),Ve?y._currentValue=w:y._currentValue2=w}function dC(y,w,M){for(;y!==null;){var I=y.alternate;if((y.childLanes&w)!==w?(y.childLanes|=w,I!==null&&(I.childLanes|=w)):I!==null&&(I.childLanes&w)!==w&&(I.childLanes|=w),y===M)break;y=y.return}}function wp(y,w){Ix=y,cC=xp=null,y=y.dependencies,y!==null&&y.firstContext!==null&&(y.lanes&w&&(Fs=!0),y.firstContext=null)}function ga(y){var w=Ve?y._currentValue:y._currentValue2;if(cC!==y)if(y={context:y,memoizedValue:w,next:null},xp===null){if(Ix===null)throw Error(s(308));xp=y,Ix.dependencies={lanes:0,firstContext:y}}else xp=xp.next=y;return w}var zu=null,Lc=!1;function pC(y){y.updateQueue={baseState:y.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function YN(y,w){y=y.updateQueue,w.updateQueue===y&&(w.updateQueue={baseState:y.baseState,firstBaseUpdate:y.firstBaseUpdate,lastBaseUpdate:y.lastBaseUpdate,shared:y.shared,effects:y.effects})}function Il(y,w){return{eventTime:y,lane:w,tag:0,payload:null,callback:null,next:null}}function Fc(y,w){var M=y.updateQueue;M!==null&&(M=M.shared,si!==null&&y.mode&1&&!(vn&2)?(y=M.interleaved,y===null?(w.next=w,zu===null?zu=[M]:zu.push(M)):(w.next=y.next,y.next=w),M.interleaved=w):(y=M.pending,y===null?w.next=w:(w.next=y.next,y.next=w),M.pending=w))}function Px(y,w,M){if(w=w.updateQueue,w!==null&&(w=w.shared,(M&4194240)!==0)){var I=w.lanes;I&=y.pendingLanes,M|=I,w.lanes=M,oC(y,M)}}function KN(y,w){var M=y.updateQueue,I=y.alternate;if(I!==null&&(I=I.updateQueue,M===I)){var D=null,B=null;if(M=M.firstBaseUpdate,M!==null){do{var re={eventTime:M.eventTime,lane:M.lane,tag:M.tag,payload:M.payload,callback:M.callback,next:null};B===null?D=B=re:B=B.next=re,M=M.next}while(M!==null);B===null?D=B=w:B=B.next=w}else D=B=w;M={baseState:I.baseState,firstBaseUpdate:D,lastBaseUpdate:B,shared:I.shared,effects:I.effects},y.updateQueue=M;return}y=M.lastBaseUpdate,y===null?M.firstBaseUpdate=w:y.next=w,M.lastBaseUpdate=w}function kx(y,w,M,I){var D=y.updateQueue;Lc=!1;var B=D.firstBaseUpdate,re=D.lastBaseUpdate,ve=D.shared.pending;if(ve!==null){D.shared.pending=null;var $e=ve,tt=$e.next;$e.next=null,re===null?B=tt:re.next=tt,re=$e;var _t=y.alternate;_t!==null&&(_t=_t.updateQueue,ve=_t.lastBaseUpdate,ve!==re&&(ve===null?_t.firstBaseUpdate=tt:ve.next=tt,_t.lastBaseUpdate=$e))}if(B!==null){var on=D.baseState;re=0,_t=tt=$e=null,ve=B;do{var Xt=ve.lane,ir=ve.eventTime;if((I&Xt)===Xt){_t!==null&&(_t=_t.next={eventTime:ir,lane:0,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null});e:{var zt=y,ho=ve;switch(Xt=w,ir=M,ho.tag){case 1:if(zt=ho.payload,typeof zt=="function"){on=zt.call(ir,on,Xt);break e}on=zt;break e;case 3:zt.flags=zt.flags&-65537|128;case 0:if(zt=ho.payload,Xt=typeof zt=="function"?zt.call(ir,on,Xt):zt,Xt==null)break e;on=o({},on,Xt);break e;case 2:Lc=!0}}ve.callback!==null&&ve.lane!==0&&(y.flags|=64,Xt=D.effects,Xt===null?D.effects=[ve]:Xt.push(ve))}else ir={eventTime:ir,lane:Xt,tag:ve.tag,payload:ve.payload,callback:ve.callback,next:null},_t===null?(tt=_t=ir,$e=on):_t=_t.next=ir,re|=Xt;if(ve=ve.next,ve===null){if(ve=D.shared.pending,ve===null)break;Xt=ve,ve=Xt.next,Xt.next=null,D.lastBaseUpdate=Xt,D.shared.pending=null}}while(!0);if(_t===null&&($e=on),D.baseState=$e,D.firstBaseUpdate=tt,D.lastBaseUpdate=_t,w=D.shared.interleaved,w!==null){D=w;do re|=D.lane,D=D.next;while(D!==w)}else B===null&&(D.shared.lanes=0);Ap|=re,y.lanes=re,y.memoizedState=on}}function ZN(y,w,M){if(y=w.effects,w.effects=null,y!==null)for(w=0;w<y.length;w++){var I=y[w],D=I.callback;if(D!==null){if(I.callback=null,I=M,typeof D!="function")throw Error(s(191,D));D.call(I)}}}var QN=new r.Component().refs;function mC(y,w,M,I){w=y.memoizedState,M=M(I,w),M=M==null?w:o({},w,M),y.memoizedState=M,y.lanes===0&&(y.updateQueue.baseState=M)}var Dx={isMounted:function(y){return(y=y._reactInternals)?T(y)===y:!1},enqueueSetState:function(y,w,M){y=y._reactInternals;var I=Fo(),D=Uc(y),B=Il(I,D);B.payload=w,M!=null&&(B.callback=M),Fc(y,B),w=ba(y,D,I),w!==null&&Px(w,y,D)},enqueueReplaceState:function(y,w,M){y=y._reactInternals;var I=Fo(),D=Uc(y),B=Il(I,D);B.tag=1,B.payload=w,M!=null&&(B.callback=M),Fc(y,B),w=ba(y,D,I),w!==null&&Px(w,y,D)},enqueueForceUpdate:function(y,w){y=y._reactInternals;var M=Fo(),I=Uc(y),D=Il(M,I);D.tag=2,w!=null&&(D.callback=w),Fc(y,D),w=ba(y,I,M),w!==null&&Px(w,y,I)}};function JN(y,w,M,I,D,B,re){return y=y.stateNode,typeof y.shouldComponentUpdate=="function"?y.shouldComponentUpdate(I,B,re):w.prototype&&w.prototype.isPureReactComponent?!Rx(M,I)||!Rx(D,B):!0}function eL(y,w,M){var I=!1,D=ma,B=w.contextType;return typeof B=="object"&&B!==null?B=ga(B):(D=ki(w)?Lu:mn.current,I=w.contextTypes,B=(I=I!=null)?va(y,D):ma),w=new w(M,B),y.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Dx,y.stateNode=w,w._reactInternals=y,I&&(y=y.stateNode,y.__reactInternalMemoizedUnmaskedChildContext=D,y.__reactInternalMemoizedMaskedChildContext=B),w}function tL(y,w,M,I){y=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(M,I),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(M,I),w.state!==y&&Dx.enqueueReplaceState(w,w.state,null)}function vC(y,w,M,I){var D=y.stateNode;D.props=M,D.state=y.memoizedState,D.refs=QN,pC(y);var B=w.contextType;typeof B=="object"&&B!==null?D.context=ga(B):(B=ki(w)?Lu:mn.current,D.context=va(y,B)),D.state=y.memoizedState,B=w.getDerivedStateFromProps,typeof B=="function"&&(mC(y,w,B,M),D.state=y.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(w=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),w!==D.state&&Dx.enqueueReplaceState(D,D.state,null),kx(y,M,D,I),D.state=y.memoizedState),typeof D.componentDidMount=="function"&&(y.flags|=4194308)}var _p=[],bp=0,Nx=null,Lx=0,ya=[],xa=0,yf=null,Pl=1,kl="";function xf(y,w){_p[bp++]=Lx,_p[bp++]=Nx,Nx=y,Lx=w}function nL(y,w,M){ya[xa++]=Pl,ya[xa++]=kl,ya[xa++]=yf,yf=y;var I=Pl;y=kl;var D=32-Ds(I)-1;I&=~(1<<D),M+=1;var B=32-Ds(w)+D;if(30<B){var re=D-D%5;B=(I&(1<<re)-1).toString(32),I>>=re,D-=re,Pl=1<<32-Ds(w)+D|M<<D|I,kl=B+y}else Pl=1<<B|M<<D|I,kl=y}function gC(y){y.return!==null&&(xf(y,1),nL(y,1,0))}function yC(y){for(;y===Nx;)Nx=_p[--bp],_p[bp]=null,Lx=_p[--bp],_p[bp]=null;for(;y===yf;)yf=ya[--xa],ya[xa]=null,kl=ya[--xa],ya[xa]=null,Pl=ya[--xa],ya[xa]=null}var Ns=null,Ls=null,wr=!1,Sg=!1,eu=null;function rL(y,w){var M=Sa(5,null,null,0);M.elementType="DELETED",M.stateNode=w,M.return=y,w=y.deletions,w===null?(y.deletions=[M],y.flags|=16):w.push(M)}function iL(y,w){switch(y.tag){case 5:return w=Mt(w,y.type,y.pendingProps),w!==null?(y.stateNode=w,Ns=y,Ls=qn(w),!0):!1;case 6:return w=Ke(w,y.pendingProps),w!==null?(y.stateNode=w,Ns=y,Ls=null,!0):!1;case 13:if(w=Rt(w),w!==null){var M=yf!==null?{id:Pl,overflow:kl}:null;return y.memoizedState={dehydrated:w,treeContext:M,retryLane:1073741824},M=Sa(18,null,null,0),M.stateNode=w,M.return=y,y.child=M,Ns=y,Ls=null,!0}return!1;default:return!1}}function xC(y){return(y.mode&1)!==0&&(y.flags&128)===0}function wC(y){if(wr){var w=Ls;if(w){var M=w;if(!iL(y,w)){if(xC(y))throw Error(s(418));w=qt(M);var I=Ns;w&&iL(y,w)?rL(I,M):(y.flags=y.flags&-4097|2,wr=!1,Ns=y)}}else{if(xC(y))throw Error(s(418));y.flags=y.flags&-4097|2,wr=!1,Ns=y}}}function oL(y){for(y=y.return;y!==null&&y.tag!==5&&y.tag!==3&&y.tag!==13;)y=y.return;Ns=y}function Eg(y){if(!de||y!==Ns)return!1;if(!wr)return oL(y),wr=!0,!1;if(y.tag!==3&&(y.tag!==5||it(y.type)&&!pe(y.type,y.memoizedProps))){var w=Ls;if(w){if(xC(y)){for(y=Ls;y;)y=qt(y);throw Error(s(418))}for(;w;)rL(y,w),w=qt(w)}}if(oL(y),y.tag===13){if(!de)throw Error(s(316));if(y=y.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(s(317));Ls=q(y)}else Ls=Ns?qt(y.stateNode):null;return!0}function Sp(){de&&(Ls=Ns=null,Sg=wr=!1)}function _C(y){eu===null?eu=[y]:eu.push(y)}function Cg(y,w,M){if(y=M.ref,y!==null&&typeof y!="function"&&typeof y!="object"){if(M._owner){if(M=M._owner,M){if(M.tag!==1)throw Error(s(309));var I=M.stateNode}if(!I)throw Error(s(147,y));var D=I,B=""+y;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===B?w.ref:(w=function(re){var ve=D.refs;ve===QN&&(ve=D.refs={}),re===null?delete ve[B]:ve[B]=re},w._stringRef=B,w)}if(typeof y!="string")throw Error(s(284));if(!M._owner)throw Error(s(290,y))}return y}function Fx(y,w){throw y=Object.prototype.toString.call(w),Error(s(31,y==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":y))}function sL(y){var w=y._init;return w(y._payload)}function aL(y){function w(Ae,ye){if(y){var Be=Ae.deletions;Be===null?(Ae.deletions=[ye],Ae.flags|=16):Be.push(ye)}}function M(Ae,ye){if(!y)return null;for(;ye!==null;)w(Ae,ye),ye=ye.sibling;return null}function I(Ae,ye){for(Ae=new Map;ye!==null;)ye.key!==null?Ae.set(ye.key,ye):Ae.set(ye.index,ye),ye=ye.sibling;return Ae}function D(Ae,ye){return Ae=Vc(Ae,ye),Ae.index=0,Ae.sibling=null,Ae}function B(Ae,ye,Be){return Ae.index=Be,y?(Be=Ae.alternate,Be!==null?(Be=Be.index,Be<ye?(Ae.flags|=2,ye):Be):(Ae.flags|=2,ye)):(Ae.flags|=1048576,ye)}function re(Ae){return y&&Ae.alternate===null&&(Ae.flags|=2),Ae}function ve(Ae,ye,Be,ht){return ye===null||ye.tag!==6?(ye=i3(Be,Ae.mode,ht),ye.return=Ae,ye):(ye=D(ye,Be),ye.return=Ae,ye)}function $e(Ae,ye,Be,ht){var Lt=Be.type;return Lt===c?_t(Ae,ye,Be.props.children,ht,Be.key):ye!==null&&(ye.elementType===Lt||typeof Lt=="object"&&Lt!==null&&Lt.$$typeof===_&&sL(Lt)===ye.type)?(ht=D(ye,Be.props),ht.ref=Cg(Ae,ye,Be),ht.return=Ae,ht):(ht=d2(Be.type,Be.key,Be.props,null,Ae.mode,ht),ht.ref=Cg(Ae,ye,Be),ht.return=Ae,ht)}function tt(Ae,ye,Be,ht){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==Be.containerInfo||ye.stateNode.implementation!==Be.implementation?(ye=o3(Be,Ae.mode,ht),ye.return=Ae,ye):(ye=D(ye,Be.children||[]),ye.return=Ae,ye)}function _t(Ae,ye,Be,ht,Lt){return ye===null||ye.tag!==7?(ye=Mf(Be,Ae.mode,ht,Lt),ye.return=Ae,ye):(ye=D(ye,Be),ye.return=Ae,ye)}function on(Ae,ye,Be){if(typeof ye=="string"&&ye!==""||typeof ye=="number")return ye=i3(""+ye,Ae.mode,Be),ye.return=Ae,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case u:return Be=d2(ye.type,ye.key,ye.props,null,Ae.mode,Be),Be.ref=Cg(Ae,null,ye),Be.return=Ae,Be;case l:return ye=o3(ye,Ae.mode,Be),ye.return=Ae,ye;case _:var ht=ye._init;return on(Ae,ht(ye._payload),Be)}if(O(ye)||E(ye))return ye=Mf(ye,Ae.mode,Be,null),ye.return=Ae,ye;Fx(Ae,ye)}return null}function Xt(Ae,ye,Be,ht){var Lt=ye!==null?ye.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Lt!==null?null:ve(Ae,ye,""+Be,ht);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case u:return Be.key===Lt?$e(Ae,ye,Be,ht):null;case l:return Be.key===Lt?tt(Ae,ye,Be,ht):null;case _:return Lt=Be._init,Xt(Ae,ye,Lt(Be._payload),ht)}if(O(Be)||E(Be))return Lt!==null?null:_t(Ae,ye,Be,ht,null);Fx(Ae,Be)}return null}function ir(Ae,ye,Be,ht,Lt){if(typeof ht=="string"&&ht!==""||typeof ht=="number")return Ae=Ae.get(Be)||null,ve(ye,Ae,""+ht,Lt);if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case u:return Ae=Ae.get(ht.key===null?Be:ht.key)||null,$e(ye,Ae,ht,Lt);case l:return Ae=Ae.get(ht.key===null?Be:ht.key)||null,tt(ye,Ae,ht,Lt);case _:var fn=ht._init;return ir(Ae,ye,Be,fn(ht._payload),Lt)}if(O(ht)||E(ht))return Ae=Ae.get(Be)||null,_t(ye,Ae,ht,Lt,null);Fx(ye,ht)}return null}function zt(Ae,ye,Be,ht){for(var Lt=null,fn=null,sn=ye,Vn=ye=0,Li=null;sn!==null&&Vn<Be.length;Vn++){sn.index>Vn?(Li=sn,sn=null):Li=sn.sibling;var Wn=Xt(Ae,sn,Be[Vn],ht);if(Wn===null){sn===null&&(sn=Li);break}y&&sn&&Wn.alternate===null&&w(Ae,sn),ye=B(Wn,ye,Vn),fn===null?Lt=Wn:fn.sibling=Wn,fn=Wn,sn=Li}if(Vn===Be.length)return M(Ae,sn),wr&&xf(Ae,Vn),Lt;if(sn===null){for(;Vn<Be.length;Vn++)sn=on(Ae,Be[Vn],ht),sn!==null&&(ye=B(sn,ye,Vn),fn===null?Lt=sn:fn.sibling=sn,fn=sn);return wr&&xf(Ae,Vn),Lt}for(sn=I(Ae,sn);Vn<Be.length;Vn++)Li=ir(sn,Ae,Vn,Be[Vn],ht),Li!==null&&(y&&Li.alternate!==null&&sn.delete(Li.key===null?Vn:Li.key),ye=B(Li,ye,Vn),fn===null?Lt=Li:fn.sibling=Li,fn=Li);return y&&sn.forEach(function(Wc){return w(Ae,Wc)}),wr&&xf(Ae,Vn),Lt}function ho(Ae,ye,Be,ht){var Lt=E(Be);if(typeof Lt!="function")throw Error(s(150));if(Be=Lt.call(Be),Be==null)throw Error(s(151));for(var fn=Lt=null,sn=ye,Vn=ye=0,Li=null,Wn=Be.next();sn!==null&&!Wn.done;Vn++,Wn=Be.next()){sn.index>Vn?(Li=sn,sn=null):Li=sn.sibling;var Wc=Xt(Ae,sn,Wn.value,ht);if(Wc===null){sn===null&&(sn=Li);break}y&&sn&&Wc.alternate===null&&w(Ae,sn),ye=B(Wc,ye,Vn),fn===null?Lt=Wc:fn.sibling=Wc,fn=Wc,sn=Li}if(Wn.done)return M(Ae,sn),wr&&xf(Ae,Vn),Lt;if(sn===null){for(;!Wn.done;Vn++,Wn=Be.next())Wn=on(Ae,Wn.value,ht),Wn!==null&&(ye=B(Wn,ye,Vn),fn===null?Lt=Wn:fn.sibling=Wn,fn=Wn);return wr&&xf(Ae,Vn),Lt}for(sn=I(Ae,sn);!Wn.done;Vn++,Wn=Be.next())Wn=ir(sn,Ae,Vn,Wn.value,ht),Wn!==null&&(y&&Wn.alternate!==null&&sn.delete(Wn.key===null?Vn:Wn.key),ye=B(Wn,ye,Vn),fn===null?Lt=Wn:fn.sibling=Wn,fn=Wn);return y&&sn.forEach(function(wQ){return w(Ae,wQ)}),wr&&xf(Ae,Vn),Lt}function Ea(Ae,ye,Be,ht){if(typeof Be=="object"&&Be!==null&&Be.type===c&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case u:e:{for(var Lt=Be.key,fn=ye;fn!==null;){if(fn.key===Lt){if(Lt=Be.type,Lt===c){if(fn.tag===7){M(Ae,fn.sibling),ye=D(fn,Be.props.children),ye.return=Ae,Ae=ye;break e}}else if(fn.elementType===Lt||typeof Lt=="object"&&Lt!==null&&Lt.$$typeof===_&&sL(Lt)===fn.type){M(Ae,fn.sibling),ye=D(fn,Be.props),ye.ref=Cg(Ae,fn,Be),ye.return=Ae,Ae=ye;break e}M(Ae,fn);break}else w(Ae,fn);fn=fn.sibling}Be.type===c?(ye=Mf(Be.props.children,Ae.mode,ht,Be.key),ye.return=Ae,Ae=ye):(ht=d2(Be.type,Be.key,Be.props,null,Ae.mode,ht),ht.ref=Cg(Ae,ye,Be),ht.return=Ae,Ae=ht)}return re(Ae);case l:e:{for(fn=Be.key;ye!==null;){if(ye.key===fn)if(ye.tag===4&&ye.stateNode.containerInfo===Be.containerInfo&&ye.stateNode.implementation===Be.implementation){M(Ae,ye.sibling),ye=D(ye,Be.children||[]),ye.return=Ae,Ae=ye;break e}else{M(Ae,ye);break}else w(Ae,ye);ye=ye.sibling}ye=o3(Be,Ae.mode,ht),ye.return=Ae,Ae=ye}return re(Ae);case _:return fn=Be._init,Ea(Ae,ye,fn(Be._payload),ht)}if(O(Be))return zt(Ae,ye,Be,ht);if(E(Be))return ho(Ae,ye,Be,ht);Fx(Ae,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"?(Be=""+Be,ye!==null&&ye.tag===6?(M(Ae,ye.sibling),ye=D(ye,Be),ye.return=Ae,Ae=ye):(M(Ae,ye),ye=i3(Be,Ae.mode,ht),ye.return=Ae,Ae=ye),re(Ae)):M(Ae,ye)}return Ea}var Ep=aL(!0),uL=aL(!1),Mg={},wa=xr(Mg),Tg=xr(Mg),Cp=xr(Mg);function Vu(y){if(y===Mg)throw Error(s(174));return y}function bC(y,w){ut(Cp,w),ut(Tg,y),ut(wa,Mg),y=V(w),$t(wa),ut(wa,y)}function Mp(){$t(wa),$t(Tg),$t(Cp)}function lL(y){var w=Vu(Cp.current),M=Vu(wa.current);w=F(M,y.type,w),M!==w&&(ut(Tg,y),ut(wa,w))}function SC(y){Tg.current===y&&($t(wa),$t(Tg))}var Cr=xr(0);function Ox(y){for(var w=y;w!==null;){if(w.tag===13){var M=w.memoizedState;if(M!==null&&(M=M.dehydrated,M===null||It(M)||Gt(M)))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if(w.flags&128)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===y)break;for(;w.sibling===null;){if(w.return===null||w.return===y)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var EC=[];function CC(){for(var y=0;y<EC.length;y++){var w=EC[y];Ve?w._workInProgressVersionPrimary=null:w._workInProgressVersionSecondary=null}EC.length=0}var Bx=a.ReactCurrentDispatcher,_a=a.ReactCurrentBatchConfig,Tp=0,Ur=null,uo=null,Ni=null,Ux=!1,Rg=!1,Ag=0,$Z=0;function lo(){throw Error(s(321))}function MC(y,w){if(w===null)return!1;for(var M=0;M<w.length&&M<y.length;M++)if(!Bu(y[M],w[M]))return!1;return!0}function TC(y,w,M,I,D,B){if(Tp=B,Ur=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,Bx.current=y===null||y.memoizedState===null?YZ:KZ,y=M(I,D),Rg){B=0;do{if(Rg=!1,Ag=0,25<=B)throw Error(s(301));B+=1,Ni=uo=null,w.updateQueue=null,Bx.current=ZZ,y=M(I,D)}while(Rg)}if(Bx.current=Gx,w=uo!==null&&uo.next!==null,Tp=0,Ni=uo=Ur=null,Ux=!1,w)throw Error(s(300));return y}function RC(){var y=Ag!==0;return Ag=0,y}function Dl(){var y={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ni===null?Ur.memoizedState=Ni=y:Ni=Ni.next=y,Ni}function Wu(){if(uo===null){var y=Ur.alternate;y=y!==null?y.memoizedState:null}else y=uo.next;var w=Ni===null?Ur.memoizedState:Ni.next;if(w!==null)Ni=w,uo=y;else{if(y===null)throw Error(s(310));uo=y,y={memoizedState:uo.memoizedState,baseState:uo.baseState,baseQueue:uo.baseQueue,queue:uo.queue,next:null},Ni===null?Ur.memoizedState=Ni=y:Ni=Ni.next=y}return Ni}function wf(y,w){return typeof w=="function"?w(y):w}function zx(y){var w=Wu(),M=w.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=y;var I=uo,D=I.baseQueue,B=M.pending;if(B!==null){if(D!==null){var re=D.next;D.next=B.next,B.next=re}I.baseQueue=D=B,M.pending=null}if(D!==null){B=D.next,I=I.baseState;var ve=re=null,$e=null,tt=B;do{var _t=tt.lane;if((Tp&_t)===_t)$e!==null&&($e=$e.next={lane:0,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null}),I=tt.hasEagerState?tt.eagerState:y(I,tt.action);else{var on={lane:_t,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null};$e===null?(ve=$e=on,re=I):$e=$e.next=on,Ur.lanes|=_t,Ap|=_t}tt=tt.next}while(tt!==null&&tt!==B);$e===null?re=I:$e.next=ve,Bu(I,w.memoizedState)||(Fs=!0),w.memoizedState=I,w.baseState=re,w.baseQueue=$e,M.lastRenderedState=I}if(y=M.interleaved,y!==null){D=y;do B=D.lane,Ur.lanes|=B,Ap|=B,D=D.next;while(D!==y)}else D===null&&(M.lanes=0);return[w.memoizedState,M.dispatch]}function Vx(y){var w=Wu(),M=w.queue;if(M===null)throw Error(s(311));M.lastRenderedReducer=y;var I=M.dispatch,D=M.pending,B=w.memoizedState;if(D!==null){M.pending=null;var re=D=D.next;do B=y(B,re.action),re=re.next;while(re!==D);Bu(B,w.memoizedState)||(Fs=!0),w.memoizedState=B,w.baseQueue===null&&(w.baseState=B),M.lastRenderedState=B}return[B,I]}function cL(){}function hL(y,w){var M=Ur,I=Wu(),D=w(),B=!Bu(I.memoizedState,D);if(B&&(I.memoizedState=D,Fs=!0),I=I.queue,Pg(pL.bind(null,M,I,y),[y]),I.getSnapshot!==w||B||Ni!==null&&Ni.memoizedState.tag&1){if(M.flags|=2048,Ig(9,dL.bind(null,M,I,D,w),void 0,null),si===null)throw Error(s(349));Tp&30||fL(M,w,D)}return D}function fL(y,w,M){y.flags|=16384,y={getSnapshot:w,value:M},w=Ur.updateQueue,w===null?(w={lastEffect:null,stores:null},Ur.updateQueue=w,w.stores=[y]):(M=w.stores,M===null?w.stores=[y]:M.push(y))}function dL(y,w,M,I){w.value=M,w.getSnapshot=I,mL(w)&&ba(y,1,-1)}function pL(y,w,M){return M(function(){mL(w)&&ba(y,1,-1)})}function mL(y){var w=y.getSnapshot;y=y.value;try{var M=w();return!Bu(y,M)}catch{return!0}}function AC(y){var w=Dl();return typeof y=="function"&&(y=y()),w.memoizedState=w.baseState=y,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wf,lastRenderedState:y},w.queue=y,y=y.dispatch=qZ.bind(null,Ur,y),[w.memoizedState,y]}function Ig(y,w,M,I){return y={tag:y,create:w,destroy:M,deps:I,next:null},w=Ur.updateQueue,w===null?(w={lastEffect:null,stores:null},Ur.updateQueue=w,w.lastEffect=y.next=y):(M=w.lastEffect,M===null?w.lastEffect=y.next=y:(I=M.next,M.next=y,y.next=I,w.lastEffect=y)),y}function vL(){return Wu().memoizedState}function Wx(y,w,M,I){var D=Dl();Ur.flags|=y,D.memoizedState=Ig(1|w,M,void 0,I===void 0?null:I)}function Hx(y,w,M,I){var D=Wu();I=I===void 0?null:I;var B=void 0;if(uo!==null){var re=uo.memoizedState;if(B=re.destroy,I!==null&&MC(I,re.deps)){D.memoizedState=Ig(w,M,B,I);return}}Ur.flags|=y,D.memoizedState=Ig(1|w,M,B,I)}function IC(y,w){return Wx(8390656,8,y,w)}function Pg(y,w){return Hx(2048,8,y,w)}function gL(y,w){return Hx(4,2,y,w)}function yL(y,w){return Hx(4,4,y,w)}function xL(y,w){if(typeof w=="function")return y=y(),w(y),function(){w(null)};if(w!=null)return y=y(),w.current=y,function(){w.current=null}}function wL(y,w,M){return M=M!=null?M.concat([y]):null,Hx(4,4,xL.bind(null,w,y),M)}function PC(){}function _L(y,w){var M=Wu();w=w===void 0?null:w;var I=M.memoizedState;return I!==null&&w!==null&&MC(w,I[1])?I[0]:(M.memoizedState=[y,w],y)}function bL(y,w){var M=Wu();w=w===void 0?null:w;var I=M.memoizedState;return I!==null&&w!==null&&MC(w,I[1])?I[0]:(y=y(),M.memoizedState=[y,w],y)}function jZ(y,w){var M=zn;zn=M!==0&&4>M?M:4,y(!0);var I=_a.transition;_a.transition={};try{y(!1),w()}finally{zn=M,_a.transition=I}}function SL(){return Wu().memoizedState}function XZ(y,w,M){var I=Uc(y);M={lane:I,action:M,hasEagerState:!1,eagerState:null,next:null},EL(y)?CL(w,M):(ML(y,w,M),M=Fo(),y=ba(y,I,M),y!==null&&TL(y,w,I))}function qZ(y,w,M){var I=Uc(y),D={lane:I,action:M,hasEagerState:!1,eagerState:null,next:null};if(EL(y))CL(w,D);else{ML(y,w,D);var B=y.alternate;if(y.lanes===0&&(B===null||B.lanes===0)&&(B=w.lastRenderedReducer,B!==null))try{var re=w.lastRenderedState,ve=B(re,M);if(D.hasEagerState=!0,D.eagerState=ve,Bu(ve,re))return}catch{}finally{}M=Fo(),y=ba(y,I,M),y!==null&&TL(y,w,I)}}function EL(y){var w=y.alternate;return y===Ur||w!==null&&w===Ur}function CL(y,w){Rg=Ux=!0;var M=y.pending;M===null?w.next=w:(w.next=M.next,M.next=w),y.pending=w}function ML(y,w,M){si!==null&&y.mode&1&&!(vn&2)?(y=w.interleaved,y===null?(M.next=M,zu===null?zu=[w]:zu.push(w)):(M.next=y.next,y.next=M),w.interleaved=M):(y=w.pending,y===null?M.next=M:(M.next=y.next,y.next=M),w.pending=M)}function TL(y,w,M){if(M&4194240){var I=w.lanes;I&=y.pendingLanes,M|=I,w.lanes=M,oC(y,M)}}var Gx={readContext:ga,useCallback:lo,useContext:lo,useEffect:lo,useImperativeHandle:lo,useInsertionEffect:lo,useLayoutEffect:lo,useMemo:lo,useReducer:lo,useRef:lo,useState:lo,useDebugValue:lo,useDeferredValue:lo,useTransition:lo,useMutableSource:lo,useSyncExternalStore:lo,useId:lo,unstable_isNewReconciler:!1},YZ={readContext:ga,useCallback:function(y,w){return Dl().memoizedState=[y,w===void 0?null:w],y},useContext:ga,useEffect:IC,useImperativeHandle:function(y,w,M){return M=M!=null?M.concat([y]):null,Wx(4194308,4,xL.bind(null,w,y),M)},useLayoutEffect:function(y,w){return Wx(4194308,4,y,w)},useInsertionEffect:function(y,w){return Wx(4,2,y,w)},useMemo:function(y,w){var M=Dl();return w=w===void 0?null:w,y=y(),M.memoizedState=[y,w],y},useReducer:function(y,w,M){var I=Dl();return w=M!==void 0?M(w):w,I.memoizedState=I.baseState=w,y={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:y,lastRenderedState:w},I.queue=y,y=y.dispatch=XZ.bind(null,Ur,y),[I.memoizedState,y]},useRef:function(y){var w=Dl();return y={current:y},w.memoizedState=y},useState:AC,useDebugValue:PC,useDeferredValue:function(y){var w=AC(y),M=w[0],I=w[1];return IC(function(){var D=_a.transition;_a.transition={};try{I(y)}finally{_a.transition=D}},[y]),M},useTransition:function(){var y=AC(!1),w=y[0];return y=jZ.bind(null,y[1]),Dl().memoizedState=y,[w,y]},useMutableSource:function(){},useSyncExternalStore:function(y,w,M){var I=Ur,D=Dl();if(wr){if(M===void 0)throw Error(s(407));M=M()}else{if(M=w(),si===null)throw Error(s(349));Tp&30||fL(I,w,M)}D.memoizedState=M;var B={value:M,getSnapshot:w};return D.queue=B,IC(pL.bind(null,I,B,y),[y]),I.flags|=2048,Ig(9,dL.bind(null,I,B,M,w),void 0,null),M},useId:function(){var y=Dl(),w=si.identifierPrefix;if(wr){var M=kl,I=Pl;M=(I&~(1<<32-Ds(I)-1)).toString(32)+M,w=":"+w+"R"+M,M=Ag++,0<M&&(w+="H"+M.toString(32)),w+=":"}else M=$Z++,w=":"+w+"r"+M.toString(32)+":";return y.memoizedState=w},unstable_isNewReconciler:!1},KZ={readContext:ga,useCallback:_L,useContext:ga,useEffect:Pg,useImperativeHandle:wL,useInsertionEffect:gL,useLayoutEffect:yL,useMemo:bL,useReducer:zx,useRef:vL,useState:function(){return zx(wf)},useDebugValue:PC,useDeferredValue:function(y){var w=zx(wf),M=w[0],I=w[1];return Pg(function(){var D=_a.transition;_a.transition={};try{I(y)}finally{_a.transition=D}},[y]),M},useTransition:function(){var y=zx(wf)[0],w=Wu().memoizedState;return[y,w]},useMutableSource:cL,useSyncExternalStore:hL,useId:SL,unstable_isNewReconciler:!1},ZZ={readContext:ga,useCallback:_L,useContext:ga,useEffect:Pg,useImperativeHandle:wL,useInsertionEffect:gL,useLayoutEffect:yL,useMemo:bL,useReducer:Vx,useRef:vL,useState:function(){return Vx(wf)},useDebugValue:PC,useDeferredValue:function(y){var w=Vx(wf),M=w[0],I=w[1];return Pg(function(){var D=_a.transition;_a.transition={};try{I(y)}finally{_a.transition=D}},[y]),M},useTransition:function(){var y=Vx(wf)[0],w=Wu().memoizedState;return[y,w]},useMutableSource:cL,useSyncExternalStore:hL,useId:SL,unstable_isNewReconciler:!1};function kC(y,w){try{var M="",I=w;do M+=GZ(I),I=I.return;while(I);var D=M}catch(B){D=`
Error generating stack: `+B.message+`
`+B.stack}return{value:y,source:w,stack:D}}function DC(y,w){try{console.error(w.value)}catch(M){setTimeout(function(){throw M})}}var QZ=typeof WeakMap=="function"?WeakMap:Map;function RL(y,w,M){M=Il(-1,M),M.tag=3,M.payload={element:null};var I=w.value;return M.callback=function(){s2||(s2=!0,ZC=I),DC(y,w)},M}function AL(y,w,M){M=Il(-1,M),M.tag=3;var I=y.type.getDerivedStateFromError;if(typeof I=="function"){var D=w.value;M.payload=function(){return I(D)},M.callback=function(){DC(y,w)}}var B=y.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(M.callback=function(){DC(y,w),typeof I!="function"&&(Oc===null?Oc=new Set([this]):Oc.add(this));var re=w.stack;this.componentDidCatch(w.value,{componentStack:re!==null?re:""})}),M}function IL(y,w,M){var I=y.pingCache;if(I===null){I=y.pingCache=new QZ;var D=new Set;I.set(w,D)}else D=I.get(w),D===void 0&&(D=new Set,I.set(w,D));D.has(M)||(D.add(M),y=fQ.bind(null,y,w,M),w.then(y,y))}function PL(y){do{var w;if((w=y.tag===13)&&(w=y.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return y;y=y.return}while(y!==null);return null}function kL(y,w,M,I,D){return y.mode&1?(y.flags|=65536,y.lanes=D,y):(y===w?y.flags|=65536:(y.flags|=128,M.flags|=131072,M.flags&=-52805,M.tag===1&&(M.alternate===null?M.tag=17:(w=Il(-1,1),w.tag=2,Fc(M,w))),M.lanes|=1),y)}function Hu(y){y.flags|=4}function DL(y,w){if(y!==null&&y.child===w.child)return!0;if(w.flags&16)return!1;for(y=w.child;y!==null;){if(y.flags&12854||y.subtreeFlags&12854)return!1;y=y.sibling}return!0}var kg,Dg,$x,jx;if(Ne)kg=function(y,w){for(var M=w.child;M!==null;){if(M.tag===5||M.tag===6)Q(y,M.stateNode);else if(M.tag!==4&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===w)break;for(;M.sibling===null;){if(M.return===null||M.return===w)return;M=M.return}M.sibling.return=M.return,M=M.sibling}},Dg=function(){},$x=function(y,w,M,I,D){if(y=y.memoizedProps,y!==I){var B=w.stateNode,re=Vu(wa.current);M=ie(B,M,y,I,D,re),(w.updateQueue=M)&&Hu(w)}},jx=function(y,w,M,I){M!==I&&Hu(w)};else if(Z){kg=function(y,w,M,I){for(var D=w.child;D!==null;){if(D.tag===5){var B=D.stateNode;M&&I&&(B=mt(B,D.type,D.memoizedProps,D)),Q(y,B)}else if(D.tag===6)B=D.stateNode,M&&I&&(B=ft(B,D.memoizedProps,D)),Q(y,B);else if(D.tag!==4){if(D.tag===22&&D.memoizedState!==null)B=D.child,B!==null&&(B.return=D),kg(y,D,!0,!0);else if(D.child!==null){D.child.return=D,D=D.child;continue}}if(D===w)break;for(;D.sibling===null;){if(D.return===null||D.return===w)return;D=D.return}D.sibling.return=D.return,D=D.sibling}};var NL=function(y,w,M,I){for(var D=w.child;D!==null;){if(D.tag===5){var B=D.stateNode;M&&I&&(B=mt(B,D.type,D.memoizedProps,D)),Tt(y,B)}else if(D.tag===6)B=D.stateNode,M&&I&&(B=ft(B,D.memoizedProps,D)),Tt(y,B);else if(D.tag!==4){if(D.tag===22&&D.memoizedState!==null)B=D.child,B!==null&&(B.return=D),NL(y,D,!0,!0);else if(D.child!==null){D.child.return=D,D=D.child;continue}}if(D===w)break;for(;D.sibling===null;){if(D.return===null||D.return===w)return;D=D.return}D.sibling.return=D.return,D=D.sibling}};Dg=function(y,w){var M=w.stateNode;if(!DL(y,w)){y=M.containerInfo;var I=Nt(y);NL(I,w,!1,!1),M.pendingChildren=I,Hu(w),hn(y,I)}},$x=function(y,w,M,I,D){var B=y.stateNode,re=y.memoizedProps;if((y=DL(y,w))&&re===I)w.stateNode=B;else{var ve=w.stateNode,$e=Vu(wa.current),tt=null;re!==I&&(tt=ie(ve,M,re,I,D,$e)),y&&tt===null?w.stateNode=B:(B=et(B,tt,M,re,I,w,y,ve),K(B,M,I,D,$e)&&Hu(w),w.stateNode=B,y?Hu(w):kg(B,w,!1,!1))}},jx=function(y,w,M,I){M!==I?(y=Vu(Cp.current),M=Vu(wa.current),w.stateNode=we(I,y,M,w),Hu(w)):w.stateNode=y.stateNode}}else Dg=function(){},$x=function(){},jx=function(){};function Ng(y,w){if(!wr)switch(y.tailMode){case"hidden":w=y.tail;for(var M=null;w!==null;)w.alternate!==null&&(M=w),w=w.sibling;M===null?y.tail=null:M.sibling=null;break;case"collapsed":M=y.tail;for(var I=null;M!==null;)M.alternate!==null&&(I=M),M=M.sibling;I===null?w||y.tail===null?y.tail=null:y.tail.sibling=null:I.sibling=null}}function co(y){var w=y.alternate!==null&&y.alternate.child===y.child,M=0,I=0;if(w)for(var D=y.child;D!==null;)M|=D.lanes|D.childLanes,I|=D.subtreeFlags&14680064,I|=D.flags&14680064,D.return=y,D=D.sibling;else for(D=y.child;D!==null;)M|=D.lanes|D.childLanes,I|=D.subtreeFlags,I|=D.flags,D.return=y,D=D.sibling;return y.subtreeFlags|=I,y.childLanes=M,w}function JZ(y,w,M){var I=w.pendingProps;switch(yC(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return co(w),null;case 1:return ki(w.type)&&Kr(),co(w),null;case 3:return I=w.stateNode,Mp(),$t(Br),$t(mn),CC(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(y===null||y.child===null)&&(Eg(w)?Hu(w):y===null||y.memoizedState.isDehydrated&&!(w.flags&256)||(w.flags|=1024,eu!==null&&(e3(eu),eu=null))),Dg(y,w),co(w),null;case 5:SC(w),M=Vu(Cp.current);var D=w.type;if(y!==null&&w.stateNode!=null)$x(y,w,D,I,M),y.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!I){if(w.stateNode===null)throw Error(s(166));return co(w),null}if(y=Vu(wa.current),Eg(w)){if(!de)throw Error(s(175));y=Yn(w.stateNode,w.type,w.memoizedProps,M,y,w,!Sg),w.updateQueue=y,y!==null&&Hu(w)}else{var B=j(D,I,M,y,w);kg(B,w,!1,!1),w.stateNode=B,K(B,D,I,M,y)&&Hu(w)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return co(w),null;case 6:if(y&&w.stateNode!=null)jx(y,w,y.memoizedProps,I);else{if(typeof I!="string"&&w.stateNode===null)throw Error(s(166));if(y=Vu(Cp.current),M=Vu(wa.current),Eg(w)){if(!de)throw Error(s(176));if(y=w.stateNode,I=w.memoizedProps,(M=Nn(y,I,w,!Sg))&&(D=Ns,D!==null))switch(B=(D.mode&1)!==0,D.tag){case 3:xt(D.stateNode.containerInfo,y,I,B);break;case 5:Ht(D.type,D.memoizedProps,D.stateNode,y,I,B)}M&&Hu(w)}else w.stateNode=we(I,y,M,w)}return co(w),null;case 13:if($t(Cr),I=w.memoizedState,wr&&Ls!==null&&w.mode&1&&!(w.flags&128)){for(y=Ls;y;)y=qt(y);return Sp(),w.flags|=98560,w}if(I!==null&&I.dehydrated!==null){if(I=Eg(w),y===null){if(!I)throw Error(s(318));if(!de)throw Error(s(344));if(y=w.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(s(317));mi(y,w)}else Sp(),!(w.flags&128)&&(w.memoizedState=null),w.flags|=4;return co(w),null}return eu!==null&&(e3(eu),eu=null),w.flags&128?(w.lanes=M,w):(I=I!==null,M=!1,y===null?Eg(w):M=y.memoizedState!==null,I&&!M&&(w.child.flags|=8192,w.mode&1&&(y===null||Cr.current&1?vi===0&&(vi=3):n3())),w.updateQueue!==null&&(w.flags|=4),co(w),null);case 4:return Mp(),Dg(y,w),y===null&&Ie(w.stateNode.containerInfo),co(w),null;case 10:return fC(w.type._context),co(w),null;case 17:return ki(w.type)&&Kr(),co(w),null;case 19:if($t(Cr),D=w.memoizedState,D===null)return co(w),null;if(I=(w.flags&128)!==0,B=D.rendering,B===null)if(I)Ng(D,!1);else{if(vi!==0||y!==null&&y.flags&128)for(y=w.child;y!==null;){if(B=Ox(y),B!==null){for(w.flags|=128,Ng(D,!1),y=B.updateQueue,y!==null&&(w.updateQueue=y,w.flags|=4),w.subtreeFlags=0,y=M,I=w.child;I!==null;)M=I,D=y,M.flags&=14680066,B=M.alternate,B===null?(M.childLanes=0,M.lanes=D,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=B.childLanes,M.lanes=B.lanes,M.child=B.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=B.memoizedProps,M.memoizedState=B.memoizedState,M.updateQueue=B.updateQueue,M.type=B.type,D=B.dependencies,M.dependencies=D===null?null:{lanes:D.lanes,firstContext:D.firstContext}),I=I.sibling;return ut(Cr,Cr.current&1|2),w.child}y=y.sibling}D.tail!==null&&Di()>KC&&(w.flags|=128,I=!0,Ng(D,!1),w.lanes=4194304)}else{if(!I)if(y=Ox(B),y!==null){if(w.flags|=128,I=!0,y=y.updateQueue,y!==null&&(w.updateQueue=y,w.flags|=4),Ng(D,!0),D.tail===null&&D.tailMode==="hidden"&&!B.alternate&&!wr)return co(w),null}else 2*Di()-D.renderingStartTime>KC&&M!==1073741824&&(w.flags|=128,I=!0,Ng(D,!1),w.lanes=4194304);D.isBackwards?(B.sibling=w.child,w.child=B):(y=D.last,y!==null?y.sibling=B:w.child=B,D.last=B)}return D.tail!==null?(w=D.tail,D.rendering=w,D.tail=w.sibling,D.renderingStartTime=Di(),w.sibling=null,y=Cr.current,ut(Cr,I?y&1|2:y&1),w):(co(w),null);case 22:case 23:return t3(),I=w.memoizedState!==null,y!==null&&y.memoizedState!==null!==I&&(w.flags|=8192),I&&w.mode&1?Os&1073741824&&(co(w),Ne&&w.subtreeFlags&6&&(w.flags|=8192)):co(w),null;case 24:return null;case 25:return null}throw Error(s(156,w.tag))}var eQ=a.ReactCurrentOwner,Fs=!1;function Lo(y,w,M,I){w.child=y===null?uL(w,null,M,I):Ep(w,y.child,M,I)}function LL(y,w,M,I,D){M=M.render;var B=w.ref;return wp(w,D),I=TC(y,w,M,I,B,D),M=RC(),y!==null&&!Fs?(w.updateQueue=y.updateQueue,w.flags&=-2053,y.lanes&=~D,Nl(y,w,D)):(wr&&M&&gC(w),w.flags|=1,Lo(y,w,I,D),w.child)}function FL(y,w,M,I,D){if(y===null){var B=M.type;return typeof B=="function"&&!r3(B)&&B.defaultProps===void 0&&M.compare===null&&M.defaultProps===void 0?(w.tag=15,w.type=B,OL(y,w,B,I,D)):(y=d2(M.type,null,I,w,w.mode,D),y.ref=w.ref,y.return=w,w.child=y)}if(B=y.child,!(y.lanes&D)){var re=B.memoizedProps;if(M=M.compare,M=M!==null?M:Rx,M(re,I)&&y.ref===w.ref)return Nl(y,w,D)}return w.flags|=1,y=Vc(B,I),y.ref=w.ref,y.return=w,w.child=y}function OL(y,w,M,I,D){if(y!==null&&Rx(y.memoizedProps,I)&&y.ref===w.ref)if(Fs=!1,(y.lanes&D)!==0)y.flags&131072&&(Fs=!0);else return w.lanes=y.lanes,Nl(y,w,D);return NC(y,w,M,I,D)}function BL(y,w,M){var I=w.pendingProps,D=I.children,B=y!==null?y.memoizedState:null;if(I.mode==="hidden")if(!(w.mode&1))w.memoizedState={baseLanes:0,cachePool:null},ut(Rp,Os),Os|=M;else if(M&1073741824)w.memoizedState={baseLanes:0,cachePool:null},I=B!==null?B.baseLanes:M,ut(Rp,Os),Os|=I;else return y=B!==null?B.baseLanes|M:M,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:y,cachePool:null},w.updateQueue=null,ut(Rp,Os),Os|=y,null;else B!==null?(I=B.baseLanes|M,w.memoizedState=null):I=M,ut(Rp,Os),Os|=I;return Lo(y,w,D,M),w.child}function UL(y,w){var M=w.ref;(y===null&&M!==null||y!==null&&y.ref!==M)&&(w.flags|=512,w.flags|=2097152)}function NC(y,w,M,I,D){var B=ki(M)?Lu:mn.current;return B=va(w,B),wp(w,D),M=TC(y,w,M,I,B,D),I=RC(),y!==null&&!Fs?(w.updateQueue=y.updateQueue,w.flags&=-2053,y.lanes&=~D,Nl(y,w,D)):(wr&&I&&gC(w),w.flags|=1,Lo(y,w,M,D),w.child)}function zL(y,w,M,I,D){if(ki(M)){var B=!0;ji(w)}else B=!1;if(wp(w,D),w.stateNode===null)y!==null&&(y.alternate=null,w.alternate=null,w.flags|=2),eL(w,M,I),vC(w,M,I,D),I=!0;else if(y===null){var re=w.stateNode,ve=w.memoizedProps;re.props=ve;var $e=re.context,tt=M.contextType;typeof tt=="object"&&tt!==null?tt=ga(tt):(tt=ki(M)?Lu:mn.current,tt=va(w,tt));var _t=M.getDerivedStateFromProps,on=typeof _t=="function"||typeof re.getSnapshotBeforeUpdate=="function";on||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(ve!==I||$e!==tt)&&tL(w,re,I,tt),Lc=!1;var Xt=w.memoizedState;re.state=Xt,kx(w,I,re,D),$e=w.memoizedState,ve!==I||Xt!==$e||Br.current||Lc?(typeof _t=="function"&&(mC(w,M,_t,I),$e=w.memoizedState),(ve=Lc||JN(w,M,ve,I,Xt,$e,tt))?(on||typeof re.UNSAFE_componentWillMount!="function"&&typeof re.componentWillMount!="function"||(typeof re.componentWillMount=="function"&&re.componentWillMount(),typeof re.UNSAFE_componentWillMount=="function"&&re.UNSAFE_componentWillMount()),typeof re.componentDidMount=="function"&&(w.flags|=4194308)):(typeof re.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=I,w.memoizedState=$e),re.props=I,re.state=$e,re.context=tt,I=ve):(typeof re.componentDidMount=="function"&&(w.flags|=4194308),I=!1)}else{re=w.stateNode,YN(y,w),ve=w.memoizedProps,tt=w.type===w.elementType?ve:Ja(w.type,ve),re.props=tt,on=w.pendingProps,Xt=re.context,$e=M.contextType,typeof $e=="object"&&$e!==null?$e=ga($e):($e=ki(M)?Lu:mn.current,$e=va(w,$e));var ir=M.getDerivedStateFromProps;(_t=typeof ir=="function"||typeof re.getSnapshotBeforeUpdate=="function")||typeof re.UNSAFE_componentWillReceiveProps!="function"&&typeof re.componentWillReceiveProps!="function"||(ve!==on||Xt!==$e)&&tL(w,re,I,$e),Lc=!1,Xt=w.memoizedState,re.state=Xt,kx(w,I,re,D);var zt=w.memoizedState;ve!==on||Xt!==zt||Br.current||Lc?(typeof ir=="function"&&(mC(w,M,ir,I),zt=w.memoizedState),(tt=Lc||JN(w,M,tt,I,Xt,zt,$e)||!1)?(_t||typeof re.UNSAFE_componentWillUpdate!="function"&&typeof re.componentWillUpdate!="function"||(typeof re.componentWillUpdate=="function"&&re.componentWillUpdate(I,zt,$e),typeof re.UNSAFE_componentWillUpdate=="function"&&re.UNSAFE_componentWillUpdate(I,zt,$e)),typeof re.componentDidUpdate=="function"&&(w.flags|=4),typeof re.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof re.componentDidUpdate!="function"||ve===y.memoizedProps&&Xt===y.memoizedState||(w.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||ve===y.memoizedProps&&Xt===y.memoizedState||(w.flags|=1024),w.memoizedProps=I,w.memoizedState=zt),re.props=I,re.state=zt,re.context=$e,I=tt):(typeof re.componentDidUpdate!="function"||ve===y.memoizedProps&&Xt===y.memoizedState||(w.flags|=4),typeof re.getSnapshotBeforeUpdate!="function"||ve===y.memoizedProps&&Xt===y.memoizedState||(w.flags|=1024),I=!1)}return LC(y,w,M,I,B,D)}function LC(y,w,M,I,D,B){UL(y,w);var re=(w.flags&128)!==0;if(!I&&!re)return D&&yp(w,M,!1),Nl(y,w,B);I=w.stateNode,eQ.current=w;var ve=re&&typeof M.getDerivedStateFromError!="function"?null:I.render();return w.flags|=1,y!==null&&re?(w.child=Ep(w,y.child,null,B),w.child=Ep(w,null,ve,B)):Lo(y,w,ve,B),w.memoizedState=I.state,D&&yp(w,M,!0),w.child}function VL(y){var w=y.stateNode;w.pendingContext?Fu(y,w.pendingContext,w.pendingContext!==w.context):w.context&&Fu(y,w.context,!1),bC(y,w.containerInfo)}function WL(y,w,M,I,D){return Sp(),_C(D),w.flags|=256,Lo(y,w,M,I),w.child}var Xx={dehydrated:null,treeContext:null,retryLane:0};function qx(y){return{baseLanes:y,cachePool:null}}function HL(y,w,M){var I=w.pendingProps,D=Cr.current,B=!1,re=(w.flags&128)!==0,ve;if((ve=re)||(ve=y!==null&&y.memoizedState===null?!1:(D&2)!==0),ve?(B=!0,w.flags&=-129):(y===null||y.memoizedState!==null)&&(D|=1),ut(Cr,D&1),y===null)return wC(w),y=w.memoizedState,y!==null&&(y=y.dehydrated,y!==null)?(w.mode&1?Gt(y)?w.lanes=8:w.lanes=1073741824:w.lanes=1,null):(D=I.children,y=I.fallback,B?(I=w.mode,B=w.child,D={mode:"hidden",children:D},!(I&1)&&B!==null?(B.childLanes=0,B.pendingProps=D):B=p2(D,I,0,null),y=Mf(y,I,M,null),B.return=w,y.return=w,B.sibling=y,w.child=B,w.child.memoizedState=qx(M),w.memoizedState=Xx,y):FC(w,D));if(D=y.memoizedState,D!==null){if(ve=D.dehydrated,ve!==null){if(re)return w.flags&256?(w.flags&=-257,Yx(y,w,M,Error(s(422)))):w.memoizedState!==null?(w.child=y.child,w.flags|=128,null):(B=I.fallback,D=w.mode,I=p2({mode:"visible",children:I.children},D,0,null),B=Mf(B,D,M,null),B.flags|=2,I.return=w,B.return=w,I.sibling=B,w.child=I,w.mode&1&&Ep(w,y.child,null,M),w.child.memoizedState=qx(M),w.memoizedState=Xx,B);if(!(w.mode&1))w=Yx(y,w,M,null);else if(Gt(ve))w=Yx(y,w,M,Error(s(419)));else if(I=(M&y.childLanes)!==0,Fs||I){if(I=si,I!==null){switch(M&-M){case 4:B=2;break;case 16:B=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:B=32;break;case 536870912:B=268435456;break;default:B=0}I=B&(I.suspendedLanes|M)?0:B,I!==0&&I!==D.retryLane&&(D.retryLane=I,ba(y,I,-1))}n3(),w=Yx(y,w,M,Error(s(421)))}else It(ve)?(w.flags|=128,w.child=y.child,w=dQ.bind(null,y),tr(ve,w),w=null):(M=D.treeContext,de&&(Ls=Qn(ve),Ns=w,wr=!0,eu=null,Sg=!1,M!==null&&(ya[xa++]=Pl,ya[xa++]=kl,ya[xa++]=yf,Pl=M.id,kl=M.overflow,yf=w)),w=FC(w,w.pendingProps.children),w.flags|=4096);return w}return B?(I=$L(y,w,I.children,I.fallback,M),B=w.child,D=y.child.memoizedState,B.memoizedState=D===null?qx(M):{baseLanes:D.baseLanes|M,cachePool:null},B.childLanes=y.childLanes&~M,w.memoizedState=Xx,I):(M=GL(y,w,I.children,M),w.memoizedState=null,M)}return B?(I=$L(y,w,I.children,I.fallback,M),B=w.child,D=y.child.memoizedState,B.memoizedState=D===null?qx(M):{baseLanes:D.baseLanes|M,cachePool:null},B.childLanes=y.childLanes&~M,w.memoizedState=Xx,I):(M=GL(y,w,I.children,M),w.memoizedState=null,M)}function FC(y,w){return w=p2({mode:"visible",children:w},y.mode,0,null),w.return=y,y.child=w}function GL(y,w,M,I){var D=y.child;return y=D.sibling,M=Vc(D,{mode:"visible",children:M}),!(w.mode&1)&&(M.lanes=I),M.return=w,M.sibling=null,y!==null&&(I=w.deletions,I===null?(w.deletions=[y],w.flags|=16):I.push(y)),w.child=M}function $L(y,w,M,I,D){var B=w.mode;y=y.child;var re=y.sibling,ve={mode:"hidden",children:M};return!(B&1)&&w.child!==y?(M=w.child,M.childLanes=0,M.pendingProps=ve,w.deletions=null):(M=Vc(y,ve),M.subtreeFlags=y.subtreeFlags&14680064),re!==null?I=Vc(re,I):(I=Mf(I,B,D,null),I.flags|=2),I.return=w,M.return=w,M.sibling=I,w.child=M,I}function Yx(y,w,M,I){return I!==null&&_C(I),Ep(w,y.child,null,M),y=FC(w,w.pendingProps.children),y.flags|=2,w.memoizedState=null,y}function jL(y,w,M){y.lanes|=w;var I=y.alternate;I!==null&&(I.lanes|=w),dC(y.return,w,M)}function OC(y,w,M,I,D){var B=y.memoizedState;B===null?y.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:I,tail:M,tailMode:D}:(B.isBackwards=w,B.rendering=null,B.renderingStartTime=0,B.last=I,B.tail=M,B.tailMode=D)}function XL(y,w,M){var I=w.pendingProps,D=I.revealOrder,B=I.tail;if(Lo(y,w,I.children,M),I=Cr.current,I&2)I=I&1|2,w.flags|=128;else{if(y!==null&&y.flags&128)e:for(y=w.child;y!==null;){if(y.tag===13)y.memoizedState!==null&&jL(y,M,w);else if(y.tag===19)jL(y,M,w);else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===w)break e;for(;y.sibling===null;){if(y.return===null||y.return===w)break e;y=y.return}y.sibling.return=y.return,y=y.sibling}I&=1}if(ut(Cr,I),!(w.mode&1))w.memoizedState=null;else switch(D){case"forwards":for(M=w.child,D=null;M!==null;)y=M.alternate,y!==null&&Ox(y)===null&&(D=M),M=M.sibling;M=D,M===null?(D=w.child,w.child=null):(D=M.sibling,M.sibling=null),OC(w,!1,D,M,B);break;case"backwards":for(M=null,D=w.child,w.child=null;D!==null;){if(y=D.alternate,y!==null&&Ox(y)===null){w.child=D;break}y=D.sibling,D.sibling=M,M=D,D=y}OC(w,!0,M,null,B);break;case"together":OC(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function Nl(y,w,M){if(y!==null&&(w.dependencies=y.dependencies),Ap|=w.lanes,!(M&w.childLanes))return null;if(y!==null&&w.child!==y.child)throw Error(s(153));if(w.child!==null){for(y=w.child,M=Vc(y,y.pendingProps),w.child=M,M.return=w;y.sibling!==null;)y=y.sibling,M=M.sibling=Vc(y,y.pendingProps),M.return=w;M.sibling=null}return w.child}function tQ(y,w,M){switch(w.tag){case 3:VL(w),Sp();break;case 5:lL(w);break;case 1:ki(w.type)&&ji(w);break;case 4:bC(w,w.stateNode.containerInfo);break;case 10:qN(w,w.type._context,w.memoizedProps.value);break;case 13:var I=w.memoizedState;if(I!==null)return I.dehydrated!==null?(ut(Cr,Cr.current&1),w.flags|=128,null):M&w.child.childLanes?HL(y,w,M):(ut(Cr,Cr.current&1),y=Nl(y,w,M),y!==null?y.sibling:null);ut(Cr,Cr.current&1);break;case 19:if(I=(M&w.childLanes)!==0,y.flags&128){if(I)return XL(y,w,M);w.flags|=128}var D=w.memoizedState;if(D!==null&&(D.rendering=null,D.tail=null,D.lastEffect=null),ut(Cr,Cr.current),I)break;return null;case 22:case 23:return w.lanes=0,BL(y,w,M)}return Nl(y,w,M)}function nQ(y,w){switch(yC(w),w.tag){case 1:return ki(w.type)&&Kr(),y=w.flags,y&65536?(w.flags=y&-65537|128,w):null;case 3:return Mp(),$t(Br),$t(mn),CC(),y=w.flags,y&65536&&!(y&128)?(w.flags=y&-65537|128,w):null;case 5:return SC(w),null;case 13:if($t(Cr),y=w.memoizedState,y!==null&&y.dehydrated!==null){if(w.alternate===null)throw Error(s(340));Sp()}return y=w.flags,y&65536?(w.flags=y&-65537|128,w):null;case 19:return $t(Cr),null;case 4:return Mp(),null;case 10:return fC(w.type._context),null;case 22:case 23:return t3(),null;case 24:return null;default:return null}}var Kx=!1,_f=!1,rQ=typeof WeakSet=="function"?WeakSet:Set,lt=null;function Zx(y,w){var M=y.ref;if(M!==null)if(typeof M=="function")try{M(null)}catch(I){ss(y,w,I)}else M.current=null}function BC(y,w,M){try{M()}catch(I){ss(y,w,I)}}var qL=!1;function iQ(y,w){for(U(y.containerInfo),lt=w;lt!==null;)if(y=lt,w=y.child,(y.subtreeFlags&1028)!==0&&w!==null)w.return=y,lt=w;else for(;lt!==null;){y=lt;try{var M=y.alternate;if(y.flags&1024)switch(y.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var I=M.memoizedProps,D=M.memoizedState,B=y.stateNode,re=B.getSnapshotBeforeUpdate(y.elementType===y.type?I:Ja(y.type,I),D);B.__reactInternalSnapshotBeforeUpdate=re}break;case 3:Ne&&Ze(y.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(ve){ss(y,y.return,ve)}if(w=y.sibling,w!==null){w.return=y.return,lt=w;break}lt=y.return}return M=qL,qL=!1,M}function bf(y,w,M){var I=w.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var D=I=I.next;do{if((D.tag&y)===y){var B=D.destroy;D.destroy=void 0,B!==void 0&&BC(w,M,B)}D=D.next}while(D!==I)}}function Lg(y,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var M=w=w.next;do{if((M.tag&y)===y){var I=M.create;M.destroy=I()}M=M.next}while(M!==w)}}function UC(y){var w=y.ref;if(w!==null){var M=y.stateNode;switch(y.tag){case 5:y=z(M);break;default:y=M}typeof w=="function"?w(y):w.current=y}}function YL(y,w,M){if(Ou&&typeof Ou.onCommitFiberUnmount=="function")try{Ou.onCommitFiberUnmount(Mx,w)}catch{}switch(w.tag){case 0:case 11:case 14:case 15:if(y=w.updateQueue,y!==null&&(y=y.lastEffect,y!==null)){var I=y=y.next;do{var D=I,B=D.destroy;D=D.tag,B!==void 0&&(D&2||D&4)&&BC(w,M,B),I=I.next}while(I!==y)}break;case 1:if(Zx(w,M),y=w.stateNode,typeof y.componentWillUnmount=="function")try{y.props=w.memoizedProps,y.state=w.memoizedState,y.componentWillUnmount()}catch(re){ss(w,M,re)}break;case 5:Zx(w,M);break;case 4:Ne?tF(y,w,M):Z&&Z&&(w=w.stateNode.containerInfo,M=Nt(w),Sn(w,M))}}function KL(y,w,M){for(var I=w;;)if(YL(y,I,M),I.child===null||Ne&&I.tag===4){if(I===w)break;for(;I.sibling===null;){if(I.return===null||I.return===w)return;I=I.return}I.sibling.return=I.return,I=I.sibling}else I.child.return=I,I=I.child}function ZL(y){var w=y.alternate;w!==null&&(y.alternate=null,ZL(w)),y.child=null,y.deletions=null,y.sibling=null,y.tag===5&&(w=y.stateNode,w!==null&&se(w)),y.stateNode=null,y.return=null,y.dependencies=null,y.memoizedProps=null,y.memoizedState=null,y.pendingProps=null,y.stateNode=null,y.updateQueue=null}function QL(y){return y.tag===5||y.tag===3||y.tag===4}function JL(y){e:for(;;){for(;y.sibling===null;){if(y.return===null||QL(y.return))return null;y=y.return}for(y.sibling.return=y.return,y=y.sibling;y.tag!==5&&y.tag!==6&&y.tag!==18;){if(y.flags&2||y.child===null||y.tag===4)continue e;y.child.return=y,y=y.child}if(!(y.flags&2))return y.stateNode}}function eF(y){if(Ne){e:{for(var w=y.return;w!==null;){if(QL(w))break e;w=w.return}throw Error(s(160))}var M=w;switch(M.tag){case 5:w=M.stateNode,M.flags&32&&(jt(w),M.flags&=-33),M=JL(y),VC(y,M,w);break;case 3:case 4:w=M.stateNode.containerInfo,M=JL(y),zC(y,M,w);break;default:throw Error(s(161))}}}function zC(y,w,M){var I=y.tag;if(I===5||I===6)y=y.stateNode,w?ot(M,y,w):We(M,y);else if(I!==4&&(y=y.child,y!==null))for(zC(y,w,M),y=y.sibling;y!==null;)zC(y,w,M),y=y.sibling}function VC(y,w,M){var I=y.tag;if(I===5||I===6)y=y.stateNode,w?dt(M,y,w):Ue(M,y);else if(I!==4&&(y=y.child,y!==null))for(VC(y,w,M),y=y.sibling;y!==null;)VC(y,w,M),y=y.sibling}function tF(y,w,M){for(var I=w,D=!1,B,re;;){if(!D){D=I.return;e:for(;;){if(D===null)throw Error(s(160));switch(B=D.stateNode,D.tag){case 5:re=!1;break e;case 3:B=B.containerInfo,re=!0;break e;case 4:B=B.containerInfo,re=!0;break e}D=D.return}D=!0}if(I.tag===5||I.tag===6)KL(y,I,M),re?Wt(B,I.stateNode):Je(B,I.stateNode);else if(I.tag===18)re?Ee(B,I.stateNode):Me(B,I.stateNode);else if(I.tag===4){if(I.child!==null){B=I.stateNode.containerInfo,re=!0,I.child.return=I,I=I.child;continue}}else if(YL(y,I,M),I.child!==null){I.child.return=I,I=I.child;continue}if(I===w)break;for(;I.sibling===null;){if(I.return===null||I.return===w)return;I=I.return,I.tag===4&&(D=!1)}I.sibling.return=I.return,I=I.sibling}}function WC(y,w){if(Ne){switch(w.tag){case 0:case 11:case 14:case 15:bf(3,w,w.return),Lg(3,w),bf(5,w,w.return);return;case 1:return;case 5:var M=w.stateNode;if(M!=null){var I=w.memoizedProps;y=y!==null?y.memoizedProps:I;var D=w.type,B=w.updateQueue;w.updateQueue=null,B!==null&&rt(M,B,D,y,I,w)}return;case 6:if(w.stateNode===null)throw Error(s(162));M=w.memoizedProps,Le(w.stateNode,y!==null?y.memoizedProps:M,M);return;case 3:de&&y!==null&&y.memoizedState.isDehydrated&&ge(w.stateNode.containerInfo);return;case 12:return;case 13:Qx(w);return;case 19:Qx(w);return;case 17:return}throw Error(s(163))}switch(w.tag){case 0:case 11:case 14:case 15:bf(3,w,w.return),Lg(3,w),bf(5,w,w.return);return;case 12:return;case 13:Qx(w);return;case 19:Qx(w);return;case 3:de&&y!==null&&y.memoizedState.isDehydrated&&ge(w.stateNode.containerInfo);break;case 22:case 23:return}e:if(Z){switch(w.tag){case 1:case 5:case 6:break e;case 3:case 4:w=w.stateNode,Sn(w.containerInfo,w.pendingChildren);break e}throw Error(s(163))}}function Qx(y){var w=y.updateQueue;if(w!==null){y.updateQueue=null;var M=y.stateNode;M===null&&(M=y.stateNode=new rQ),w.forEach(function(I){var D=pQ.bind(null,y,I);M.has(I)||(M.add(I),I.then(D,D))})}}function oQ(y,w){for(lt=w;lt!==null;){w=lt;var M=w.deletions;if(M!==null)for(var I=0;I<M.length;I++){var D=M[I];try{var B=y;Ne?tF(B,D,w):KL(B,D,w);var re=D.alternate;re!==null&&(re.return=null),D.return=null}catch(Lt){ss(D,w,Lt)}}if(M=w.child,w.subtreeFlags&12854&&M!==null)M.return=w,lt=M;else for(;lt!==null;){w=lt;try{var ve=w.flags;if(ve&32&&Ne&&jt(w.stateNode),ve&512){var $e=w.alternate;if($e!==null){var tt=$e.ref;tt!==null&&(typeof tt=="function"?tt(null):tt.current=null)}}if(ve&8192)switch(w.tag){case 13:if(w.memoizedState!==null){var _t=w.alternate;(_t===null||_t.memoizedState===null)&&(YC=Di())}break;case 22:var on=w.memoizedState!==null,Xt=w.alternate,ir=Xt!==null&&Xt.memoizedState!==null;if(M=w,Ne){e:if(I=M,D=on,B=null,Ne)for(var zt=I;;){if(zt.tag===5){if(B===null){B=zt;var ho=zt.stateNode;D?yn(ho):Ye(zt.stateNode,zt.memoizedProps)}}else if(zt.tag===6){if(B===null){var Ea=zt.stateNode;D?nt(Ea):ae(Ea,zt.memoizedProps)}}else if((zt.tag!==22&&zt.tag!==23||zt.memoizedState===null||zt===I)&&zt.child!==null){zt.child.return=zt,zt=zt.child;continue}if(zt===I)break;for(;zt.sibling===null;){if(zt.return===null||zt.return===I)break e;B===zt&&(B=null),zt=zt.return}B===zt&&(B=null),zt.sibling.return=zt.return,zt=zt.sibling}}if(on&&!ir&&M.mode&1){lt=M;for(var Ae=M.child;Ae!==null;){for(M=lt=Ae;lt!==null;){I=lt;var ye=I.child;switch(I.tag){case 0:case 11:case 14:case 15:bf(4,I,I.return);break;case 1:Zx(I,I.return);var Be=I.stateNode;if(typeof Be.componentWillUnmount=="function"){var ht=I.return;try{Be.props=I.memoizedProps,Be.state=I.memoizedState,Be.componentWillUnmount()}catch(Lt){ss(I,ht,Lt)}}break;case 5:Zx(I,I.return);break;case 22:if(I.memoizedState!==null){iF(M);continue}}ye!==null?(ye.return=I,lt=ye):iF(M)}Ae=Ae.sibling}}}switch(ve&4102){case 2:eF(w),w.flags&=-3;break;case 6:eF(w),w.flags&=-3,WC(w.alternate,w);break;case 4096:w.flags&=-4097;break;case 4100:w.flags&=-4097,WC(w.alternate,w);break;case 4:WC(w.alternate,w)}}catch(Lt){ss(w,w.return,Lt)}if(M=w.sibling,M!==null){M.return=w.return,lt=M;break}lt=w.return}}}function sQ(y,w,M){lt=y,nF(y)}function nF(y,w,M){for(var I=(y.mode&1)!==0;lt!==null;){var D=lt,B=D.child;if(D.tag===22&&I){var re=D.memoizedState!==null||Kx;if(!re){var ve=D.alternate,$e=ve!==null&&ve.memoizedState!==null||_f;ve=Kx;var tt=_f;if(Kx=re,(_f=$e)&&!tt)for(lt=D;lt!==null;)re=lt,$e=re.child,re.tag===22&&re.memoizedState!==null?oF(D):$e!==null?($e.return=re,lt=$e):oF(D);for(;B!==null;)lt=B,nF(B),B=B.sibling;lt=D,Kx=ve,_f=tt}rF(y)}else D.subtreeFlags&8772&&B!==null?(B.return=D,lt=B):rF(y)}}function rF(y){for(;lt!==null;){var w=lt;if(w.flags&8772){var M=w.alternate;try{if(w.flags&8772)switch(w.tag){case 0:case 11:case 15:_f||Lg(5,w);break;case 1:var I=w.stateNode;if(w.flags&4&&!_f)if(M===null)I.componentDidMount();else{var D=w.elementType===w.type?M.memoizedProps:Ja(w.type,M.memoizedProps);I.componentDidUpdate(D,M.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var B=w.updateQueue;B!==null&&ZN(w,B,I);break;case 3:var re=w.updateQueue;if(re!==null){if(M=null,w.child!==null)switch(w.child.tag){case 5:M=z(w.child.stateNode);break;case 1:M=w.child.stateNode}ZN(w,re,M)}break;case 5:var ve=w.stateNode;M===null&&w.flags&4&&yt(ve,w.type,w.memoizedProps,w);break;case 6:break;case 4:break;case 12:break;case 13:if(de&&w.memoizedState===null){var $e=w.alternate;if($e!==null){var tt=$e.memoizedState;if(tt!==null){var _t=tt.dehydrated;_t!==null&&Re(_t)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(s(163))}_f||w.flags&512&&UC(w)}catch(on){ss(w,w.return,on)}}if(w===y){lt=null;break}if(M=w.sibling,M!==null){M.return=w.return,lt=M;break}lt=w.return}}function iF(y){for(;lt!==null;){var w=lt;if(w===y){lt=null;break}var M=w.sibling;if(M!==null){M.return=w.return,lt=M;break}lt=w.return}}function oF(y){for(;lt!==null;){var w=lt;try{switch(w.tag){case 0:case 11:case 15:var M=w.return;try{Lg(4,w)}catch($e){ss(w,M,$e)}break;case 1:var I=w.stateNode;if(typeof I.componentDidMount=="function"){var D=w.return;try{I.componentDidMount()}catch($e){ss(w,D,$e)}}var B=w.return;try{UC(w)}catch($e){ss(w,B,$e)}break;case 5:var re=w.return;try{UC(w)}catch($e){ss(w,re,$e)}}}catch($e){ss(w,w.return,$e)}if(w===y){lt=null;break}var ve=w.sibling;if(ve!==null){ve.return=w.return,lt=ve;break}lt=w.return}}var Jx=0,e2=1,t2=2,n2=3,r2=4;if(typeof Symbol=="function"&&Symbol.for){var Fg=Symbol.for;Jx=Fg("selector.component"),e2=Fg("selector.has_pseudo_class"),t2=Fg("selector.role"),n2=Fg("selector.test_id"),r2=Fg("selector.text")}function HC(y){var w=me(y);if(w!=null){if(typeof w.memoizedProps["data-testname"]!="string")throw Error(s(364));return w}if(y=le(y),y===null)throw Error(s(362));return y.stateNode.current}function GC(y,w){switch(w.$$typeof){case Jx:if(y.type===w.value)return!0;break;case e2:e:{w=w.value,y=[y,0];for(var M=0;M<y.length;){var I=y[M++],D=y[M++],B=w[D];if(I.tag!==5||!J(I)){for(;B!=null&&GC(I,B);)D++,B=w[D];if(D===w.length){w=!0;break e}else for(I=I.child;I!==null;)y.push(I,D),I=I.sibling}}w=!1}return w;case t2:if(y.tag===5&&be(y.stateNode,w.value))return!0;break;case r2:if((y.tag===5||y.tag===6)&&(y=Te(y),y!==null&&0<=y.indexOf(w.value)))return!0;break;case n2:if(y.tag===5&&(y=y.memoizedProps["data-testname"],typeof y=="string"&&y.toLowerCase()===w.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function $C(y){switch(y.$$typeof){case Jx:return"<"+(C(y.value)||"Unknown")+">";case e2:return":has("+($C(y)||"")+")";case t2:return'[role="'+y.value+'"]';case r2:return'"'+y.value+'"';case n2:return'[data-testname="'+y.value+'"]';default:throw Error(s(365))}}function sF(y,w){var M=[];y=[y,0];for(var I=0;I<y.length;){var D=y[I++],B=y[I++],re=w[B];if(D.tag!==5||!J(D)){for(;re!=null&&GC(D,re);)B++,re=w[B];if(B===w.length)M.push(D);else for(D=D.child;D!==null;)y.push(D,B),D=D.sibling}}return M}function jC(y,w){if(!$)throw Error(s(363));y=HC(y),y=sF(y,w),w=[],y=Array.from(y);for(var M=0;M<y.length;){var I=y[M++];if(I.tag===5)J(I)||w.push(I.stateNode);else for(I=I.child;I!==null;)y.push(I),I=I.sibling}return w}var aQ=Math.ceil,i2=a.ReactCurrentDispatcher,XC=a.ReactCurrentOwner,Zr=a.ReactCurrentBatchConfig,vn=0,si=null,ai=null,Xi=0,Os=0,Rp=xr(0),vi=0,Og=null,Ap=0,o2=0,qC=0,Bg=null,is=null,YC=0,KC=1/0;function Ip(){KC=Di()+500}var s2=!1,ZC=null,Oc=null,a2=!1,Bc=null,u2=0,Ug=0,QC=null,l2=-1,c2=0;function Fo(){return vn&6?Di():l2!==-1?l2:l2=Di()}function Uc(y){return y.mode&1?vn&2&&Xi!==0?Xi&-Xi:HZ.transition!==null?(c2===0&&(y=Sx,Sx<<=1,!(Sx&4194240)&&(Sx=64),c2=y),c2):(y=zn,y!==0?y:xe()):1}function ba(y,w,M){if(50<Ug)throw Ug=0,QC=null,Error(s(185));var I=h2(y,w);return I===null?null:(bg(I,w,M),(!(vn&2)||I!==si)&&(I===si&&(!(vn&2)&&(o2|=w),vi===4&&zc(I,Xi)),os(I,M),w===1&&vn===0&&!(y.mode&1)&&(Ip(),Tx&&Uu())),I)}function h2(y,w){y.lanes|=w;var M=y.alternate;for(M!==null&&(M.lanes|=w),M=y,y=y.return;y!==null;)y.childLanes|=w,M=y.alternate,M!==null&&(M.childLanes|=w),M=y,y=y.return;return M.tag===3?M.stateNode:null}function os(y,w){var M=y.callbackNode;NZ(y,w);var I=Cx(y,y===si?Xi:0);if(I===0)M!==null&&jN(M),y.callbackNode=null,y.callbackPriority=0;else if(w=I&-I,y.callbackPriority!==w){if(M!=null&&jN(M),w===1)y.tag===0?WZ(uF.bind(null,y)):XN(uF.bind(null,y)),Xe?X(function(){vn===0&&Uu()}):sC(aC,Uu),M=null;else{switch($N(I)){case 1:M=aC;break;case 4:M=BZ;break;case 16:M=uC;break;case 536870912:M=UZ;break;default:M=uC}M=gF(M,aF.bind(null,y))}y.callbackPriority=w,y.callbackNode=M}}function aF(y,w){if(l2=-1,c2=0,vn&6)throw Error(s(327));var M=y.callbackNode;if(Cf()&&y.callbackNode!==M)return null;var I=Cx(y,y===si?Xi:0);if(I===0)return null;if(I&30||I&y.expiredLanes||w)w=f2(y,I);else{w=I;var D=vn;vn|=2;var B=hF();(si!==y||Xi!==w)&&(Ip(),Sf(y,w));do try{cQ();break}catch(ve){cF(y,ve)}while(!0);hC(),i2.current=B,vn=D,ai!==null?w=0:(si=null,Xi=0,w=vi)}if(w!==0){if(w===2&&(D=rC(y),D!==0&&(I=D,w=JC(y,D))),w===1)throw M=Og,Sf(y,0),zc(y,I),os(y,Di()),M;if(w===6)zc(y,I);else{if(D=y.current.alternate,!(I&30)&&!uQ(D)&&(w=f2(y,I),w===2&&(B=rC(y),B!==0&&(I=B,w=JC(y,B))),w===1))throw M=Og,Sf(y,0),zc(y,I),os(y,Di()),M;switch(y.finishedWork=D,y.finishedLanes=I,w){case 0:case 1:throw Error(s(345));case 2:Ef(y,is);break;case 3:if(zc(y,I),(I&130023424)===I&&(w=YC+500-Di(),10<w)){if(Cx(y,0)!==0)break;if(D=y.suspendedLanes,(D&I)!==I){Fo(),y.pingedLanes|=y.suspendedLanes&D;break}y.timeoutHandle=ce(Ef.bind(null,y,is),w);break}Ef(y,is);break;case 4:if(zc(y,I),(I&4194240)===I)break;for(w=y.eventTimes,D=-1;0<I;){var re=31-Ds(I);B=1<<re,re=w[re],re>D&&(D=re),I&=~B}if(I=D,I=Di()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*aQ(I/1960))-I,10<I){y.timeoutHandle=ce(Ef.bind(null,y,is),I);break}Ef(y,is);break;case 5:Ef(y,is);break;default:throw Error(s(329))}}}return os(y,Di()),y.callbackNode===M?aF.bind(null,y):null}function JC(y,w){var M=Bg;return y.current.memoizedState.isDehydrated&&(Sf(y,w).flags|=256),y=f2(y,w),y!==2&&(w=is,is=M,w!==null&&e3(w)),y}function e3(y){is===null?is=y:is.push.apply(is,y)}function uQ(y){for(var w=y;;){if(w.flags&16384){var M=w.updateQueue;if(M!==null&&(M=M.stores,M!==null))for(var I=0;I<M.length;I++){var D=M[I],B=D.getSnapshot;D=D.value;try{if(!Bu(B(),D))return!1}catch{return!1}}}if(M=w.child,w.subtreeFlags&16384&&M!==null)M.return=w,w=M;else{if(w===y)break;for(;w.sibling===null;){if(w.return===null||w.return===y)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function zc(y,w){for(w&=~qC,w&=~o2,y.suspendedLanes|=w,y.pingedLanes&=~w,y=y.expirationTimes;0<w;){var M=31-Ds(w),I=1<<M;y[M]=-1,w&=~I}}function uF(y){if(vn&6)throw Error(s(327));Cf();var w=Cx(y,0);if(!(w&1))return os(y,Di()),null;var M=f2(y,w);if(y.tag!==0&&M===2){var I=rC(y);I!==0&&(w=I,M=JC(y,I))}if(M===1)throw M=Og,Sf(y,0),zc(y,w),os(y,Di()),M;if(M===6)throw Error(s(345));return y.finishedWork=y.current.alternate,y.finishedLanes=w,Ef(y,is),os(y,Di()),null}function lF(y){Bc!==null&&Bc.tag===0&&!(vn&6)&&Cf();var w=vn;vn|=1;var M=Zr.transition,I=zn;try{if(Zr.transition=null,zn=1,y)return y()}finally{zn=I,Zr.transition=M,vn=w,!(vn&6)&&Uu()}}function t3(){Os=Rp.current,$t(Rp)}function Sf(y,w){y.finishedWork=null,y.finishedLanes=0;var M=y.timeoutHandle;if(M!==Oe&&(y.timeoutHandle=Oe,_e(M)),ai!==null)for(M=ai.return;M!==null;){var I=M;switch(yC(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Kr();break;case 3:Mp(),$t(Br),$t(mn),CC();break;case 5:SC(I);break;case 4:Mp();break;case 13:$t(Cr);break;case 19:$t(Cr);break;case 10:fC(I.type._context);break;case 22:case 23:t3()}M=M.return}if(si=y,ai=y=Vc(y.current,null),Xi=Os=w,vi=0,Og=null,qC=o2=Ap=0,is=Bg=null,zu!==null){for(w=0;w<zu.length;w++)if(M=zu[w],I=M.interleaved,I!==null){M.interleaved=null;var D=I.next,B=M.pending;if(B!==null){var re=B.next;B.next=D,I.next=re}M.pending=I}zu=null}return y}function cF(y,w){do{var M=ai;try{if(hC(),Bx.current=Gx,Ux){for(var I=Ur.memoizedState;I!==null;){var D=I.queue;D!==null&&(D.pending=null),I=I.next}Ux=!1}if(Tp=0,Ni=uo=Ur=null,Rg=!1,Ag=0,XC.current=null,M===null||M.return===null){vi=1,Og=w,ai=null;break}e:{var B=y,re=M.return,ve=M,$e=w;if(w=Xi,ve.flags|=32768,$e!==null&&typeof $e=="object"&&typeof $e.then=="function"){var tt=$e,_t=ve,on=_t.tag;if(!(_t.mode&1)&&(on===0||on===11||on===15)){var Xt=_t.alternate;Xt?(_t.updateQueue=Xt.updateQueue,_t.memoizedState=Xt.memoizedState,_t.lanes=Xt.lanes):(_t.updateQueue=null,_t.memoizedState=null)}var ir=PL(re);if(ir!==null){ir.flags&=-257,kL(ir,re,ve,B,w),ir.mode&1&&IL(B,tt,w),w=ir,$e=tt;var zt=w.updateQueue;if(zt===null){var ho=new Set;ho.add($e),w.updateQueue=ho}else zt.add($e);break e}else{if(!(w&1)){IL(B,tt,w),n3();break e}$e=Error(s(426))}}else if(wr&&ve.mode&1){var Ea=PL(re);if(Ea!==null){!(Ea.flags&65536)&&(Ea.flags|=256),kL(Ea,re,ve,B,w),_C($e);break e}}B=$e,vi!==4&&(vi=2),Bg===null?Bg=[B]:Bg.push(B),$e=kC($e,ve),ve=re;do{switch(ve.tag){case 3:ve.flags|=65536,w&=-w,ve.lanes|=w;var Ae=RL(ve,$e,w);KN(ve,Ae);break e;case 1:B=$e;var ye=ve.type,Be=ve.stateNode;if(!(ve.flags&128)&&(typeof ye.getDerivedStateFromError=="function"||Be!==null&&typeof Be.componentDidCatch=="function"&&(Oc===null||!Oc.has(Be)))){ve.flags|=65536,w&=-w,ve.lanes|=w;var ht=AL(ve,B,w);KN(ve,ht);break e}}ve=ve.return}while(ve!==null)}dF(M)}catch(Lt){w=Lt,ai===M&&M!==null&&(ai=M=M.return);continue}break}while(!0)}function hF(){var y=i2.current;return i2.current=Gx,y===null?Gx:y}function n3(){(vi===0||vi===3||vi===2)&&(vi=4),si===null||!(Ap&268435455)&&!(o2&268435455)||zc(si,Xi)}function f2(y,w){var M=vn;vn|=2;var I=hF();si===y&&Xi===w||Sf(y,w);do try{lQ();break}catch(D){cF(y,D)}while(!0);if(hC(),vn=M,i2.current=I,ai!==null)throw Error(s(261));return si=null,Xi=0,vi}function lQ(){for(;ai!==null;)fF(ai)}function cQ(){for(;ai!==null&&!FZ();)fF(ai)}function fF(y){var w=vF(y.alternate,y,Os);y.memoizedProps=y.pendingProps,w===null?dF(y):ai=w,XC.current=null}function dF(y){var w=y;do{var M=w.alternate;if(y=w.return,w.flags&32768){if(M=nQ(M,w),M!==null){M.flags&=32767,ai=M;return}if(y!==null)y.flags|=32768,y.subtreeFlags=0,y.deletions=null;else{vi=6,ai=null;return}}else if(M=JZ(M,w,Os),M!==null){ai=M;return}if(w=w.sibling,w!==null){ai=w;return}ai=w=y}while(w!==null);vi===0&&(vi=5)}function Ef(y,w){var M=zn,I=Zr.transition;try{Zr.transition=null,zn=1,hQ(y,w,M)}finally{Zr.transition=I,zn=M}return null}function hQ(y,w,M){do Cf();while(Bc!==null);if(vn&6)throw Error(s(327));var I=y.finishedWork,D=y.finishedLanes;if(I===null)return null;if(y.finishedWork=null,y.finishedLanes=0,I===y.current)throw Error(s(177));y.callbackNode=null,y.callbackPriority=0;var B=I.lanes|I.childLanes;if(LZ(y,B),y===si&&(ai=si=null,Xi=0),!(I.subtreeFlags&2064)&&!(I.flags&2064)||a2||(a2=!0,gF(uC,function(){return Cf(),null})),B=(I.flags&15990)!==0,I.subtreeFlags&15990||B){B=Zr.transition,Zr.transition=null;var re=zn;zn=1;var ve=vn;vn|=4,XC.current=null,iQ(y,I),oQ(y,I),L(y.containerInfo),y.current=I,sQ(I),OZ(),vn=ve,zn=re,Zr.transition=B}else y.current=I;if(a2&&(a2=!1,Bc=y,u2=D),B=y.pendingLanes,B===0&&(Oc=null),zZ(I.stateNode),os(y,Di()),w!==null)for(M=y.onRecoverableError,I=0;I<w.length;I++)M(w[I]);if(s2)throw s2=!1,y=ZC,ZC=null,y;return u2&1&&y.tag!==0&&Cf(),B=y.pendingLanes,B&1?y===QC?Ug++:(Ug=0,QC=y):Ug=0,Uu(),null}function Cf(){if(Bc!==null){var y=$N(u2),w=Zr.transition,M=zn;try{if(Zr.transition=null,zn=16>y?16:y,Bc===null)var I=!1;else{if(y=Bc,Bc=null,u2=0,vn&6)throw Error(s(331));var D=vn;for(vn|=4,lt=y.current;lt!==null;){var B=lt,re=B.child;if(lt.flags&16){var ve=B.deletions;if(ve!==null){for(var $e=0;$e<ve.length;$e++){var tt=ve[$e];for(lt=tt;lt!==null;){var _t=lt;switch(_t.tag){case 0:case 11:case 15:bf(8,_t,B)}var on=_t.child;if(on!==null)on.return=_t,lt=on;else for(;lt!==null;){_t=lt;var Xt=_t.sibling,ir=_t.return;if(ZL(_t),_t===tt){lt=null;break}if(Xt!==null){Xt.return=ir,lt=Xt;break}lt=ir}}}var zt=B.alternate;if(zt!==null){var ho=zt.child;if(ho!==null){zt.child=null;do{var Ea=ho.sibling;ho.sibling=null,ho=Ea}while(ho!==null)}}lt=B}}if(B.subtreeFlags&2064&&re!==null)re.return=B,lt=re;else e:for(;lt!==null;){if(B=lt,B.flags&2048)switch(B.tag){case 0:case 11:case 15:bf(9,B,B.return)}var Ae=B.sibling;if(Ae!==null){Ae.return=B.return,lt=Ae;break e}lt=B.return}}var ye=y.current;for(lt=ye;lt!==null;){re=lt;var Be=re.child;if(re.subtreeFlags&2064&&Be!==null)Be.return=re,lt=Be;else e:for(re=ye;lt!==null;){if(ve=lt,ve.flags&2048)try{switch(ve.tag){case 0:case 11:case 15:Lg(9,ve)}}catch(Lt){ss(ve,ve.return,Lt)}if(ve===re){lt=null;break e}var ht=ve.sibling;if(ht!==null){ht.return=ve.return,lt=ht;break e}lt=ve.return}}if(vn=D,Uu(),Ou&&typeof Ou.onPostCommitFiberRoot=="function")try{Ou.onPostCommitFiberRoot(Mx,y)}catch{}I=!0}return I}finally{zn=M,Zr.transition=w}}return!1}function pF(y,w,M){w=kC(M,w),w=RL(y,w,1),Fc(y,w),w=Fo(),y=h2(y,1),y!==null&&(bg(y,1,w),os(y,w))}function ss(y,w,M){if(y.tag===3)pF(y,y,M);else for(;w!==null;){if(w.tag===3){pF(w,y,M);break}else if(w.tag===1){var I=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Oc===null||!Oc.has(I))){y=kC(M,y),y=AL(w,y,1),Fc(w,y),y=Fo(),w=h2(w,1),w!==null&&(bg(w,1,y),os(w,y));break}}w=w.return}}function fQ(y,w,M){var I=y.pingCache;I!==null&&I.delete(w),w=Fo(),y.pingedLanes|=y.suspendedLanes&M,si===y&&(Xi&M)===M&&(vi===4||vi===3&&(Xi&130023424)===Xi&&500>Di()-YC?Sf(y,0):qC|=M),os(y,w)}function mF(y,w){w===0&&(y.mode&1?(w=Ex,Ex<<=1,!(Ex&130023424)&&(Ex=4194304)):w=1);var M=Fo();y=h2(y,w),y!==null&&(bg(y,w,M),os(y,M))}function dQ(y){var w=y.memoizedState,M=0;w!==null&&(M=w.retryLane),mF(y,M)}function pQ(y,w){var M=0;switch(y.tag){case 13:var I=y.stateNode,D=y.memoizedState;D!==null&&(M=D.retryLane);break;case 19:I=y.stateNode;break;default:throw Error(s(314))}I!==null&&I.delete(w),mF(y,M)}var vF;vF=function(y,w,M){if(y!==null)if(y.memoizedProps!==w.pendingProps||Br.current)Fs=!0;else{if(!(y.lanes&M)&&!(w.flags&128))return Fs=!1,tQ(y,w,M);Fs=!!(y.flags&131072)}else Fs=!1,wr&&w.flags&1048576&&nL(w,Lx,w.index);switch(w.lanes=0,w.tag){case 2:var I=w.type;y!==null&&(y.alternate=null,w.alternate=null,w.flags|=2),y=w.pendingProps;var D=va(w,mn.current);wp(w,M),D=TC(null,w,I,y,D,M);var B=RC();return w.flags|=1,typeof D=="object"&&D!==null&&typeof D.render=="function"&&D.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,ki(I)?(B=!0,ji(w)):B=!1,w.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,pC(w),D.updater=Dx,w.stateNode=D,D._reactInternals=w,vC(w,I,y,M),w=LC(null,w,I,!0,B,M)):(w.tag=0,wr&&B&&gC(w),Lo(null,w,D,M),w=w.child),w;case 16:I=w.elementType;e:{switch(y!==null&&(y.alternate=null,w.alternate=null,w.flags|=2),y=w.pendingProps,D=I._init,I=D(I._payload),w.type=I,D=w.tag=vQ(I),y=Ja(I,y),D){case 0:w=NC(null,w,I,y,M);break e;case 1:w=zL(null,w,I,y,M);break e;case 11:w=LL(null,w,I,y,M);break e;case 14:w=FL(null,w,I,Ja(I.type,y),M);break e}throw Error(s(306,I,""))}return w;case 0:return I=w.type,D=w.pendingProps,D=w.elementType===I?D:Ja(I,D),NC(y,w,I,D,M);case 1:return I=w.type,D=w.pendingProps,D=w.elementType===I?D:Ja(I,D),zL(y,w,I,D,M);case 3:e:{if(VL(w),y===null)throw Error(s(387));I=w.pendingProps,B=w.memoizedState,D=B.element,YN(y,w),kx(w,I,null,M);var re=w.memoizedState;if(I=re.element,de&&B.isDehydrated)if(B={element:I,isDehydrated:!1,cache:re.cache,transitions:re.transitions},w.updateQueue.baseState=B,w.memoizedState=B,w.flags&256){D=Error(s(423)),w=WL(y,w,I,M,D);break e}else if(I!==D){D=Error(s(424)),w=WL(y,w,I,M,D);break e}else for(de&&(Ls=Sr(w.stateNode.containerInfo),Ns=w,wr=!0,eu=null,Sg=!1),M=uL(w,null,I,M),w.child=M;M;)M.flags=M.flags&-3|4096,M=M.sibling;else{if(Sp(),I===D){w=Nl(y,w,M);break e}Lo(y,w,I,M)}w=w.child}return w;case 5:return lL(w),y===null&&wC(w),I=w.type,D=w.pendingProps,B=y!==null?y.memoizedProps:null,re=D.children,pe(I,D)?re=null:B!==null&&pe(I,B)&&(w.flags|=32),UL(y,w),Lo(y,w,re,M),w.child;case 6:return y===null&&wC(w),null;case 13:return HL(y,w,M);case 4:return bC(w,w.stateNode.containerInfo),I=w.pendingProps,y===null?w.child=Ep(w,null,I,M):Lo(y,w,I,M),w.child;case 11:return I=w.type,D=w.pendingProps,D=w.elementType===I?D:Ja(I,D),LL(y,w,I,D,M);case 7:return Lo(y,w,w.pendingProps,M),w.child;case 8:return Lo(y,w,w.pendingProps.children,M),w.child;case 12:return Lo(y,w,w.pendingProps.children,M),w.child;case 10:e:{if(I=w.type._context,D=w.pendingProps,B=w.memoizedProps,re=D.value,qN(w,I,re),B!==null)if(Bu(B.value,re)){if(B.children===D.children&&!Br.current){w=Nl(y,w,M);break e}}else for(B=w.child,B!==null&&(B.return=w);B!==null;){var ve=B.dependencies;if(ve!==null){re=B.child;for(var $e=ve.firstContext;$e!==null;){if($e.context===I){if(B.tag===1){$e=Il(-1,M&-M),$e.tag=2;var tt=B.updateQueue;if(tt!==null){tt=tt.shared;var _t=tt.pending;_t===null?$e.next=$e:($e.next=_t.next,_t.next=$e),tt.pending=$e}}B.lanes|=M,$e=B.alternate,$e!==null&&($e.lanes|=M),dC(B.return,M,w),ve.lanes|=M;break}$e=$e.next}}else if(B.tag===10)re=B.type===w.type?null:B.child;else if(B.tag===18){if(re=B.return,re===null)throw Error(s(341));re.lanes|=M,ve=re.alternate,ve!==null&&(ve.lanes|=M),dC(re,M,w),re=B.sibling}else re=B.child;if(re!==null)re.return=B;else for(re=B;re!==null;){if(re===w){re=null;break}if(B=re.sibling,B!==null){B.return=re.return,re=B;break}re=re.return}B=re}Lo(y,w,D.children,M),w=w.child}return w;case 9:return D=w.type,I=w.pendingProps.children,wp(w,M),D=ga(D),I=I(D),w.flags|=1,Lo(y,w,I,M),w.child;case 14:return I=w.type,D=Ja(I,w.pendingProps),D=Ja(I.type,D),FL(y,w,I,D,M);case 15:return OL(y,w,w.type,w.pendingProps,M);case 17:return I=w.type,D=w.pendingProps,D=w.elementType===I?D:Ja(I,D),y!==null&&(y.alternate=null,w.alternate=null,w.flags|=2),w.tag=1,ki(I)?(y=!0,ji(w)):y=!1,wp(w,M),eL(w,I,D),vC(w,I,D,M),LC(null,w,I,!0,y,M);case 19:return XL(y,w,M);case 22:return BL(y,w,M)}throw Error(s(156,w.tag))};function gF(y,w){return sC(y,w)}function mQ(y,w,M,I){this.tag=y,this.key=M,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sa(y,w,M,I){return new mQ(y,w,M,I)}function r3(y){return y=y.prototype,!(!y||!y.isReactComponent)}function vQ(y){if(typeof y=="function")return r3(y)?1:0;if(y!=null){if(y=y.$$typeof,y===v)return 11;if(y===x)return 14}return 2}function Vc(y,w){var M=y.alternate;return M===null?(M=Sa(y.tag,w,y.key,y.mode),M.elementType=y.elementType,M.type=y.type,M.stateNode=y.stateNode,M.alternate=y,y.alternate=M):(M.pendingProps=w,M.type=y.type,M.flags=0,M.subtreeFlags=0,M.deletions=null),M.flags=y.flags&14680064,M.childLanes=y.childLanes,M.lanes=y.lanes,M.child=y.child,M.memoizedProps=y.memoizedProps,M.memoizedState=y.memoizedState,M.updateQueue=y.updateQueue,w=y.dependencies,M.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},M.sibling=y.sibling,M.index=y.index,M.ref=y.ref,M}function d2(y,w,M,I,D,B){var re=2;if(I=y,typeof y=="function")r3(y)&&(re=1);else if(typeof y=="string")re=5;else e:switch(y){case c:return Mf(M.children,D,B,w);case h:re=8,D|=8;break;case f:return y=Sa(12,M,w,D|2),y.elementType=f,y.lanes=B,y;case g:return y=Sa(13,M,w,D),y.elementType=g,y.lanes=B,y;case m:return y=Sa(19,M,w,D),y.elementType=m,y.lanes=B,y;case b:return p2(M,D,B,w);default:if(typeof y=="object"&&y!==null)switch(y.$$typeof){case d:re=10;break e;case p:re=9;break e;case v:re=11;break e;case x:re=14;break e;case _:re=16,I=null;break e}throw Error(s(130,y==null?y:typeof y,""))}return w=Sa(re,M,w,D),w.elementType=y,w.type=I,w.lanes=B,w}function Mf(y,w,M,I){return y=Sa(7,y,I,w),y.lanes=M,y}function p2(y,w,M,I){return y=Sa(22,y,I,w),y.elementType=b,y.lanes=M,y.stateNode={},y}function i3(y,w,M){return y=Sa(6,y,null,w),y.lanes=M,y}function o3(y,w,M){return w=Sa(4,y.children!==null?y.children:[],y.key,w),w.lanes=M,w.stateNode={containerInfo:y.containerInfo,pendingChildren:null,implementation:y.implementation},w}function gQ(y,w,M,I,D){this.tag=w,this.containerInfo=y,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Oe,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=iC(0),this.expirationTimes=iC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iC(0),this.identifierPrefix=I,this.onRecoverableError=D,de&&(this.mutableSourceEagerHydrationData=null)}function yF(y,w,M,I,D,B,re,ve,$e){return y=new gQ(y,w,M,ve,$e),w===1?(w=1,B===!0&&(w|=8)):w=0,B=Sa(3,null,null,w),y.current=B,B.stateNode=y,B.memoizedState={element:I,isDehydrated:M,cache:null,transitions:null},pC(B),y}function xF(y){if(!y)return ma;y=y._reactInternals;e:{if(T(y)!==y||y.tag!==1)throw Error(s(170));var w=y;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(ki(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(s(171))}if(y.tag===1){var M=y.type;if(ki(M))return gp(y,M,w)}return w}function wF(y){var w=y._reactInternals;if(w===void 0)throw typeof y.render=="function"?Error(s(188)):(y=Object.keys(y).join(","),Error(s(268,y)));return y=k(w),y===null?null:y.stateNode}function _F(y,w){if(y=y.memoizedState,y!==null&&y.dehydrated!==null){var M=y.retryLane;y.retryLane=M!==0&&M<w?M:w}}function s3(y,w){_F(y,w),(y=y.alternate)&&_F(y,w)}function yQ(y){return y=k(y),y===null?null:y.stateNode}function xQ(){return null}return t.attemptContinuousHydration=function(y){if(y.tag===13){var w=Fo();ba(y,134217728,w),s3(y,134217728)}},t.attemptHydrationAtCurrentPriority=function(y){if(y.tag===13){var w=Fo(),M=Uc(y);ba(y,M,w),s3(y,M)}},t.attemptSynchronousHydration=function(y){switch(y.tag){case 3:var w=y.stateNode;if(w.current.memoizedState.isDehydrated){var M=_g(w.pendingLanes);M!==0&&(oC(w,M|1),os(w,Di()),!(vn&6)&&(Ip(),Uu()))}break;case 13:var I=Fo();lF(function(){return ba(y,1,I)}),s3(y,1)}},t.batchedUpdates=function(y,w){var M=vn;vn|=1;try{return y(w)}finally{vn=M,vn===0&&(Ip(),Tx&&Uu())}},t.createComponentSelector=function(y){return{$$typeof:Jx,value:y}},t.createContainer=function(y,w,M,I,D,B,re){return yF(y,w,!1,null,M,I,D,B,re)},t.createHasPseudoClassSelector=function(y){return{$$typeof:e2,value:y}},t.createHydrationContainer=function(y,w,M,I,D,B,re,ve,$e){return y=yF(M,I,!0,y,D,B,re,ve,$e),y.context=xF(null),M=y.current,I=Fo(),D=Uc(M),B=Il(I,D),B.callback=w??null,Fc(M,B),y.current.lanes=D,bg(y,D,I),os(y,I),y},t.createPortal=function(y,w,M){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:l,key:I==null?null:""+I,children:y,containerInfo:w,implementation:M}},t.createRoleSelector=function(y){return{$$typeof:t2,value:y}},t.createTestNameSelector=function(y){return{$$typeof:n2,value:y}},t.createTextSelector=function(y){return{$$typeof:r2,value:y}},t.deferredUpdates=function(y){var w=zn,M=Zr.transition;try{return Zr.transition=null,zn=16,y()}finally{zn=w,Zr.transition=M}},t.discreteUpdates=function(y,w,M,I,D){var B=zn,re=Zr.transition;try{return Zr.transition=null,zn=1,y(w,M,I,D)}finally{zn=B,Zr.transition=re,vn===0&&Ip()}},t.findAllNodes=jC,t.findBoundingRects=function(y,w){if(!$)throw Error(s(363));w=jC(y,w),y=[];for(var M=0;M<w.length;M++)y.push(ze(w[M]));for(w=y.length-1;0<w;w--){M=y[w];for(var I=M.x,D=I+M.width,B=M.y,re=B+M.height,ve=w-1;0<=ve;ve--)if(w!==ve){var $e=y[ve],tt=$e.x,_t=tt+$e.width,on=$e.y,Xt=on+$e.height;if(I>=tt&&B>=on&&D<=_t&&re<=Xt){y.splice(w,1);break}else if(I!==tt||M.width!==$e.width||Xt<B||on>re){if(!(B!==on||M.height!==$e.height||_t<I||tt>D)){tt>I&&($e.width+=tt-I,$e.x=I),_t<D&&($e.width=D-tt),y.splice(w,1);break}}else{on>B&&($e.height+=on-B,$e.y=B),Xt<re&&($e.height=re-on),y.splice(w,1);break}}}return y},t.findHostInstance=wF,t.findHostInstanceWithNoPortals=function(y){return y=P(y),y=y!==null?N(y):null,y===null?null:y.stateNode},t.findHostInstanceWithWarning=function(y){return wF(y)},t.flushControlled=function(y){var w=vn;vn|=1;var M=Zr.transition,I=zn;try{Zr.transition=null,zn=1,y()}finally{zn=I,Zr.transition=M,vn=w,vn===0&&(Ip(),Uu())}},t.flushPassiveEffects=Cf,t.flushSync=lF,t.focusWithin=function(y,w){if(!$)throw Error(s(363));for(y=HC(y),w=sF(y,w),w=Array.from(w),y=0;y<w.length;){var M=w[y++];if(!J(M)){if(M.tag===5&&ke(M.stateNode))return!0;for(M=M.child;M!==null;)w.push(M),M=M.sibling}}return!1},t.getCurrentUpdatePriority=function(){return zn},t.getFindAllNodesFailureDescription=function(y,w){if(!$)throw Error(s(363));var M=0,I=[];y=[HC(y),0];for(var D=0;D<y.length;){var B=y[D++],re=y[D++],ve=w[re];if((B.tag!==5||!J(B))&&(GC(B,ve)&&(I.push($C(ve)),re++,re>M&&(M=re)),re<w.length))for(B=B.child;B!==null;)y.push(B,re),B=B.sibling}if(M<w.length){for(y=[];M<w.length;M++)y.push($C(w[M]));return`findAllNodes was able to match part of the selector:
  `+(I.join(" > ")+`

No matching component was found for:
  `)+y.join(" > ")}return null},t.getPublicRootInstance=function(y){if(y=y.current,!y.child)return null;switch(y.child.tag){case 5:return z(y.child.stateNode);default:return y.child.stateNode}},t.injectIntoDevTools=function(y){if(y={bundleType:y.bundleType,version:y.version,rendererPackageName:y.rendererPackageName,rendererConfig:y.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:yQ,findFiberByHostInstance:y.findFiberByHostInstance||xQ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")y=!1;else{var w=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(w.isDisabled||!w.supportsFiber)y=!0;else{try{Mx=w.inject(y),Ou=w}catch{}y=!!w.checkDCE}}return y},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(y,w,M,I){if(!$)throw Error(s(363));y=jC(y,w);var D=He(y,M,I).disconnect;return{disconnect:function(){D()}}},t.registerMutableSourceForHydration=function(y,w){var M=w._getVersion;M=M(w._source),y.mutableSourceEagerHydrationData==null?y.mutableSourceEagerHydrationData=[w,M]:y.mutableSourceEagerHydrationData.push(w,M)},t.runWithPriority=function(y,w){var M=zn;try{return zn=y,w()}finally{zn=M}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(y,w,M,I){var D=w.current,B=Fo(),re=Uc(D);return M=xF(M),w.context===null?w.context=M:w.pendingContext=M,w=Il(B,re),w.payload={element:y},I=I===void 0?null:I,I!==null&&(w.callback=I),Fc(D,w),y=ba(D,re,B),y!==null&&Px(y,D,re),re},t};Qj.exports=Bye;var Uye=Qj.exports;const zye=O8(Uye),_D={},Vye=n=>void Object.assign(_D,n);function Wye(n,e){function t(c,{args:h=[],attach:f,...d},p){let v=`${c[0].toUpperCase()}${c.slice(1)}`,g;if(c==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const m=d.object;g=mm(m,{type:c,root:p,attach:f,primitive:!0})}else{const m=_D[v];if(!m)throw new Error(`R3F: ${v} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");g=mm(new m(...h),{type:c,root:p,attach:f,memoizedProps:{args:h}})}return g.__r3f.attach===void 0&&(g.isBufferGeometry?g.__r3f.attach="geometry":g.isMaterial&&(g.__r3f.attach="material")),v!=="inject"&&rT(g,d),g}function r(c,h){let f=!1;if(h){var d,p;(d=h.__r3f)!=null&&d.attach?nT(c,h,h.__r3f.attach):h.isObject3D&&c.isObject3D&&(c.add(h),f=!0),f||(p=c.__r3f)==null||p.objects.push(h),h.__r3f||mm(h,{}),h.__r3f.parent=c,WI(h),vm(h)}}function i(c,h,f){let d=!1;if(h){var p,v;if((p=h.__r3f)!=null&&p.attach)nT(c,h,h.__r3f.attach);else if(h.isObject3D&&c.isObject3D){h.parent=c,h.dispatchEvent({type:"added"}),c.dispatchEvent({type:"childadded",child:h});const g=c.children.filter(x=>x!==h),m=g.indexOf(f);c.children=[...g.slice(0,m),h,...g.slice(m)],d=!0}d||(v=c.__r3f)==null||v.objects.push(h),h.__r3f||mm(h,{}),h.__r3f.parent=c,WI(h),vm(h)}}function o(c,h,f=!1){c&&[...c].forEach(d=>s(h,d,f))}function s(c,h,f){if(h){var d,p,v;if(h.__r3f&&(h.__r3f.parent=null),(d=c.__r3f)!=null&&d.objects&&(c.__r3f.objects=c.__r3f.objects.filter(b=>b!==h)),(p=h.__r3f)!=null&&p.attach)Vz(c,h,h.__r3f.attach);else if(h.isObject3D&&c.isObject3D){var g;c.remove(h),(g=h.__r3f)!=null&&g.root&&Yye(X_(h),h)}const x=(v=h.__r3f)==null?void 0:v.primitive,_=!x&&(f===void 0?h.dispose!==null:f);if(!x){var m;o((m=h.__r3f)==null?void 0:m.objects,h,_),o(h.children,h,_)}if(delete h.__r3f,_&&h.dispose&&h.type!=="Scene"){const b=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?zI.unstable_scheduleCallback(zI.unstable_IdlePriority,b):b()}vm(c)}}function a(c,h,f,d){var p;const v=(p=c.__r3f)==null?void 0:p.parent;if(!v)return;const g=t(h,f,c.__r3f.root);if(c.children){for(const m of c.children)m.__r3f&&r(g,m);c.children=c.children.filter(m=>!m.__r3f)}c.__r3f.objects.forEach(m=>r(g,m)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||s(v,c),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),r(v,g),g.raycast&&g.__r3f.eventCount&&X_(g).getState().internal.interaction.push(g),[d,d.alternate].forEach(m=>{m!==null&&(m.stateNode=g,m.ref&&(typeof m.ref=="function"?m.ref(g):m.ref.current=g))})}const u=()=>{};return{reconciler:zye({createInstance:t,removeChild:s,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,h)=>{if(!h)return;const f=c.getState().scene;f.__r3f&&(f.__r3f.root=c,r(f,h))},removeChildFromContainer:(c,h)=>{h&&s(c.getState().scene,h)},insertInContainerBefore:(c,h,f)=>{if(!h||!f)return;const d=c.getState().scene;d.__r3f&&i(d,h,f)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var h;return!!((h=c==null?void 0:c.__r3f)!=null?h:{}).handlers},prepareUpdate(c,h,f,d){var p;if(((p=c==null?void 0:c.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==c)return[!0];{const{args:g=[],children:m,...x}=d,{args:_=[],children:b,...S}=f;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((C,R)=>C!==_[R]))return[!0];const E=aX(c,x,S,!0);return E.changes.length?[!1,E]:null}},commitUpdate(c,[h,f],d,p,v,g){h?a(c,d,v,g):rT(c,f)},commitMount(c,h,f,d){var p;const v=(p=c.__r3f)!=null?p:{};c.raycast&&v.handlers&&v.eventCount&&X_(c).getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>mm(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var h;const{attach:f,parent:d}=(h=c.__r3f)!=null?h:{};f&&d&&Vz(d,c,f),c.isObject3D&&(c.visible=!1),vm(c)},unhideInstance(c,h){var f;const{attach:d,parent:p}=(f=c.__r3f)!=null?f:{};d&&p&&nT(p,c,d),(c.isObject3D&&h.visible==null||h.visible)&&(c.visible=!0),vm(c)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>e?e():Zm.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&vr.fun(performance.now)?performance.now:vr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:vr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:vr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:rT}}var Oz,Bz;const tT=n=>"colorSpace"in n||"outputColorSpace"in n,tX=()=>{var n;return(n=_D.ColorManagement)!=null?n:null},nX=n=>n&&n.isOrthographicCamera,Hye=n=>n&&n.hasOwnProperty("current"),ex=typeof window<"u"&&((Oz=window.document)!=null&&Oz.createElement||((Bz=window.navigator)==null?void 0:Bz.product)==="ReactNative")?H.useLayoutEffect:H.useEffect;function rX(n){const e=H.useRef(n);return ex(()=>void(e.current=n),[n]),e}function Gye({set:n}){return ex(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class iX extends H.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}iX.getDerivedStateFromError=()=>({error:!0});const oX="__default",Uz=new Map,$ye=n=>n&&!!n.memoized&&!!n.changes;function sX(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const d0=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()};function X_(n){let e=n.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const vr={obj:n=>n===Object(n)&&!vr.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(vr.str(n)||vr.num(n)||vr.boo(n))return n===e;const o=vr.obj(n);if(o&&r==="reference")return n===e;const s=vr.arr(n);if(s&&t==="reference")return n===e;if((s||o)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(o&&t==="shallow"&&r==="shallow"){for(a in i?e:n)if(!vr.equ(n[a],e[a],{strict:i,objects:"reference"}))return!1}else for(a in i?e:n)if(n[a]!==e[a])return!1;if(vr.und(a)){if(s&&n.length===0&&e.length===0||o&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function jye(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function mm(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function VI(n,e){let t=n;if(e.includes("-")){const r=e.split("-"),i=r.pop();return t=r.reduce((o,s)=>o[s],n),{target:t,key:i}}else return{target:t,key:e}}const zz=/-\d+$/;function nT(n,e,t){if(vr.str(t)){if(zz.test(t)){const o=t.replace(zz,""),{target:s,key:a}=VI(n,o);Array.isArray(s[a])||(s[a]=[])}const{target:r,key:i}=VI(n,t);e.__r3f.previousAttach=r[i],r[i]=e}else e.__r3f.previousAttach=t(n,e)}function Vz(n,e,t){var r,i;if(vr.str(t)){const{target:o,key:s}=VI(n,t),a=e.__r3f.previousAttach;a===void 0?delete o[s]:o[s]=a}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(n,e);(i=e.__r3f)==null||delete i.previousAttach}function aX(n,{children:e,key:t,ref:r,...i},{children:o,key:s,ref:a,...u}={},l=!1){const c=n.__r3f,h=Object.entries(i),f=[];if(l){const p=Object.keys(u);for(let v=0;v<p.length;v++)i.hasOwnProperty(p[v])||h.unshift([p[v],oX+"remove"])}h.forEach(([p,v])=>{var g;if((g=n.__r3f)!=null&&g.primitive&&p==="object"||vr.equ(v,u[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return f.push([p,v,!0,[]]);let m=[];p.includes("-")&&(m=p.split("-")),f.push([p,v,!1,m]);for(const x in i){const _=i[x];x.startsWith(`${p}-`)&&f.push([x,_,!1,x.split("-")])}});const d={...i};return c!=null&&c.memoizedProps&&c!=null&&c.memoizedProps.args&&(d.args=c.memoizedProps.args),c!=null&&c.memoizedProps&&c!=null&&c.memoizedProps.attach&&(d.attach=c.memoizedProps.attach),{memoized:d,changes:f}}function rT(n,e){var t;const r=n.__r3f,i=r==null?void 0:r.root,o=i==null||i.getState==null?void 0:i.getState(),{memoized:s,changes:a}=$ye(e)?e:aX(n,e),u=r==null?void 0:r.eventCount;n.__r3f&&(n.__r3f.memoizedProps=s);for(let f=0;f<a.length;f++){let[d,p,v,g]=a[f];if(tT(n)){const b="srgb",S="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?b:S):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?b:S)}let m=n,x=m[d];if(g.length&&(x=g.reduce((_,b)=>_[b],n),!(x&&x.set))){const[_,...b]=g.reverse();m=b.reverse().reduce((S,E)=>S[E],n),d=_}if(p===oX+"remove")if(m.constructor){let _=Uz.get(m.constructor);_||(_=new m.constructor,Uz.set(m.constructor,_)),p=_[d]}else p=0;if(v&&r)p?r.handlers[d]=p:delete r.handlers[d],r.eventCount=Object.keys(r.handlers).length;else if(x&&x.set&&(x.copy||x instanceof Ed)){if(Array.isArray(p))x.fromArray?x.fromArray(p):x.set(...p);else if(x.copy&&p&&p.constructor&&x.constructor===p.constructor)x.copy(p);else if(p!==void 0){var l;const _=(l=x)==null?void 0:l.isColor;!_&&x.setScalar?x.setScalar(p):x instanceof Ed&&p instanceof Ed?x.mask=p.mask:x.set(p),!tX()&&o&&!o.linear&&_&&x.convertSRGBToLinear()}}else{var c;if(m[d]=p,(c=m[d])!=null&&c.isTexture&&m[d].format===eo&&m[d].type===ro&&o){const _=m[d];tT(_)&&tT(o.gl)?_.colorSpace=o.gl.outputColorSpace:_.encoding=o.gl.outputEncoding}}vm(n)}if(r&&r.parent&&n.raycast&&u!==r.eventCount){const f=X_(n).getState().internal,d=f.interaction.indexOf(n);d>-1&&f.interaction.splice(d,1),r.eventCount&&f.interaction.push(n)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=n.__r3f)!=null&&t.parent&&WI(n),n}function vm(n){var e,t;const r=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();r&&r.internal.frames===0&&r.invalidate()}function WI(n){n.onUpdate==null||n.onUpdate(n)}function Xye(n,e){n.manual||(nX(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function Hw(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function qye(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return Zm.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Zm.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Zm.ContinuousEventPriority;default:return Zm.DefaultEventPriority}}function uX(n,e,t,r){const i=t.get(e);i&&(t.delete(e),t.size===0&&(n.delete(r),i.target.releasePointerCapture(r)))}function Yye(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{uX(t.capturedMap,e,r,i)})}function Kye(n){function e(u){const{internal:l}=n.getState(),c=u.offsetX-l.initialClick[0],h=u.offsetY-l.initialClick[1];return Math.round(Math.sqrt(c*c+h*h))}function t(u){return u.filter(l=>["Move","Over","Enter","Out","Leave"].some(c=>{var h;return(h=l.__r3f)==null?void 0:h.handlers["onPointer"+c]}))}function r(u,l){const c=n.getState(),h=new Set,f=[],d=l?l(c.internal.interaction):c.internal.interaction;for(let m=0;m<d.length;m++){const x=d0(d[m]);x&&(x.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(u,c);function p(m){const x=d0(m);if(!x||!x.events.enabled||x.raycaster.camera===null)return[];if(x.raycaster.camera===void 0){var _;x.events.compute==null||x.events.compute(u,x,(_=x.previousRoot)==null?void 0:_.getState()),x.raycaster.camera===void 0&&(x.raycaster.camera=null)}return x.raycaster.camera?x.raycaster.intersectObject(m,!0):[]}let v=d.flatMap(p).sort((m,x)=>{const _=d0(m.object),b=d0(x.object);return!_||!b?m.distance-x.distance:b.events.priority-_.events.priority||m.distance-x.distance}).filter(m=>{const x=Hw(m);return h.has(x)?!1:(h.add(x),!0)});c.events.filter&&(v=c.events.filter(v,c));for(const m of v){let x=m.object;for(;x;){var g;(g=x.__r3f)!=null&&g.eventCount&&f.push({...m,eventObject:x}),x=x.parent}}if("pointerId"in u&&c.internal.capturedMap.has(u.pointerId))for(let m of c.internal.capturedMap.get(u.pointerId).values())h.has(Hw(m.intersection))||f.push(m.intersection);return f}function i(u,l,c,h){const f=n.getState();if(u.length){const d={stopped:!1};for(const p of u){const v=d0(p.object)||f,{raycaster:g,pointer:m,camera:x,internal:_}=v,b=new ne(m.x,m.y,0).unproject(x),S=A=>{var P,k;return(P=(k=_.capturedMap.get(A))==null?void 0:k.has(p.eventObject))!=null?P:!1},E=A=>{const P={intersection:p,target:l.target};_.capturedMap.has(A)?_.capturedMap.get(A).set(p.eventObject,P):_.capturedMap.set(A,new Map([[p.eventObject,P]])),l.target.setPointerCapture(A)},C=A=>{const P=_.capturedMap.get(A);P&&uX(_.capturedMap,p.eventObject,P,A)};let R={};for(let A in l){let P=l[A];typeof P!="function"&&(R[A]=P)}let T={...p,...R,pointer:m,intersections:u,stopped:d.stopped,delta:c,unprojectedPoint:b,ray:g.ray,camera:x,stopPropagation(){const A="pointerId"in l&&_.capturedMap.get(l.pointerId);if((!A||A.has(p.eventObject))&&(T.stopped=d.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(P=>P.eventObject===p.eventObject))){const P=u.slice(0,u.indexOf(p));o([...P,p])}},target:{hasPointerCapture:S,setPointerCapture:E,releasePointerCapture:C},currentTarget:{hasPointerCapture:S,setPointerCapture:E,releasePointerCapture:C},nativeEvent:l};if(h(T),d.stopped===!0)break}}return u}function o(u){const{internal:l}=n.getState();for(const c of l.hovered.values())if(!u.length||!u.find(h=>h.object===c.object&&h.index===c.index&&h.instanceId===c.instanceId)){const f=c.eventObject.__r3f,d=f==null?void 0:f.handlers;if(l.hovered.delete(Hw(c)),f!=null&&f.eventCount){const p={...c,intersections:u};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function s(u,l){for(let c=0;c<l.length;c++){const h=l[c].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(u)}}function a(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return l=>{const{internal:c}=n.getState();"pointerId"in l&&c.capturedMap.has(l.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(l.pointerId)&&(c.capturedMap.delete(l.pointerId),o([]))})}}return function(c){const{onPointerMissed:h,internal:f}=n.getState();f.lastEvent.current=c;const d=u==="onPointerMove",p=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",g=r(c,d?t:void 0),m=p?e(c):0;u==="onPointerDown"&&(f.initialClick=[c.offsetX,c.offsetY],f.initialHits=g.map(_=>_.eventObject)),p&&!g.length&&m<=2&&(s(c,f.interaction),h&&h(c)),d&&o(g);function x(_){const b=_.eventObject,S=b.__r3f,E=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(d){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const C=Hw(_),R=f.hovered.get(C);R?R.stopped&&_.stopPropagation():(f.hovered.set(C,_),E.onPointerOver==null||E.onPointerOver(_),E.onPointerEnter==null||E.onPointerEnter(_))}E.onPointerMove==null||E.onPointerMove(_)}else{const C=E[u];C?(!p||f.initialHits.includes(b))&&(s(c,f.interaction.filter(R=>!f.initialHits.includes(R))),C(_)):p&&f.initialHits.includes(b)&&s(c,f.interaction.filter(R=>!f.initialHits.includes(R)))}}i(g,c,m,x)}}return{handlePointer:a}}const lX=n=>!!(n!=null&&n.render),cX=H.createContext(null),Zye=(n,e)=>{const t=Oye((a,u)=>{const l=new ne,c=new ne,h=new ne;function f(m=u().camera,x=c,_=u().size){const{width:b,height:S,top:E,left:C}=_,R=b/S;x.isVector3?h.copy(x):h.set(...x);const T=m.getWorldPosition(l).distanceTo(h);if(nX(m))return{width:b/m.zoom,height:S/m.zoom,top:E,left:C,factor:1,distance:T,aspect:R};{const A=m.fov*Math.PI/180,P=2*Math.tan(A/2)*T,k=P*(b/S);return{width:k,height:P,top:E,left:C,factor:b/k,distance:T,aspect:R}}}let d;const p=m=>a(x=>({performance:{...x.performance,current:m}})),v=new De;return{set:a,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(m=1)=>n(u(),m),advance:(m,x)=>e(m,x,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new EE,pointer:v,mouse:v,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const m=u();d&&clearTimeout(d),m.performance.current!==m.performance.min&&p(m.performance.min),d=setTimeout(()=>p(u().performance.max),m.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:m=>a(x=>({...x,events:{...x.events,...m}})),setSize:(m,x,_,b,S)=>{const E=u().camera,C={width:m,height:x,top:b||0,left:S||0,updateStyle:_};a(R=>({size:C,viewport:{...R.viewport,...f(E,c,C)}}))},setDpr:m=>a(x=>{const _=sX(m);return{viewport:{...x.viewport,dpr:_,initialDpr:x.viewport.initialDpr||_}}}),setFrameloop:(m="always")=>{const x=u().clock;x.stop(),x.elapsedTime=0,m!=="never"&&(x.start(),x.elapsedTime=0),a(()=>({frameloop:m}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:H.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(m,x,_)=>{const b=u().internal;return b.priority=b.priority+(x>0?1:0),b.subscribers.push({ref:m,priority:x,store:_}),b.subscribers=b.subscribers.sort((S,E)=>S.priority-E.priority),()=>{const S=u().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(x>0?1:0),S.subscribers=S.subscribers.filter(E=>E.ref!==m))}}}}}),r=t.getState();let i=r.size,o=r.viewport.dpr,s=r.camera;return t.subscribe(()=>{const{camera:a,size:u,viewport:l,gl:c,set:h}=t.getState();if(u.width!==i.width||u.height!==i.height||l.dpr!==o){var f;i=u,o=l.dpr,Xye(a,u),c.setPixelRatio(l.dpr);const d=(f=u.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(u.width,u.height,d)}a!==s&&(s=a,h(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};let Gw,Qye=new Set,Jye=new Set,e1e=new Set;function iT(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function p0(n,e){switch(n){case"before":return iT(Qye,e);case"after":return iT(Jye,e);case"tail":return iT(e1e,e)}}let oT,sT;function aT(n,e,t){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(r=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),oT=e.internal.subscribers,Gw=0;Gw<oT.length;Gw++)sT=oT[Gw],sT.ref.current(sT.store.getState(),r,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function t1e(n){let e=!1,t=!1,r,i,o;function s(l){i=requestAnimationFrame(s),e=!0,r=0,p0("before",l),t=!0;for(const h of n.values()){var c;o=h.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((c=o.gl.xr)!=null&&c.isPresenting)&&(r+=aT(l,o))}if(t=!1,p0("after",l),r===0)return p0("tail",l),e=!1,cancelAnimationFrame(i)}function a(l,c=1){var h;if(!l)return n.forEach(f=>a(f.store.getState(),c));(h=l.gl.xr)!=null&&h.isPresenting||!l.internal.active||l.frameloop==="never"||(c>1?l.internal.frames=Math.min(60,l.internal.frames+c):t?l.internal.frames=2:l.internal.frames=1,e||(e=!0,requestAnimationFrame(s)))}function u(l,c=!0,h,f){if(c&&p0("before",l),h)aT(l,h,f);else for(const d of n.values())aT(l,d.store.getState());c&&p0("after",l)}return{loop:s,invalidate:a,advance:u}}function hX(){const n=H.useContext(cX);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function my(n=t=>t,e){return hX()(n,e)}function fX(n,e=0){const t=hX(),r=t.getState().internal.subscribe,i=rX(n);return ex(()=>r(i,e,t),[e,r,t]),null}const jv=new Map,{invalidate:Wz,advance:Hz}=t1e(jv),{reconciler:Xb,applyProps:im}=Wye(jv,qye),om={objects:"shallow",strict:!1},n1e=(n,e)=>{const t=typeof n=="function"?n(e):n;return lX(t)?t:new hg({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function r1e(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:r,height:i,top:o,left:s,updateStyle:a=t}=e;return{width:r,height:i,top:o,left:s,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:r,height:i,top:o,left:s}=n.parentElement.getBoundingClientRect();return{width:r,height:i,top:o,left:s,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function i1e(n){const e=jv.get(n),t=e==null?void 0:e.fiber,r=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,o=r||Zye(Wz,Hz),s=t||Xb.createContainer(o,Zm.ConcurrentRoot,null,!1,null,"",i,null);e||jv.set(n,{fiber:s,store:o});let a,u=!1,l;return{configure(c={}){let{gl:h,size:f,scene:d,events:p,onCreated:v,shadows:g=!1,linear:m=!1,flat:x=!1,legacy:_=!1,orthographic:b=!1,frameloop:S="always",dpr:E=[1,2],performance:C,raycaster:R,camera:T,onPointerMissed:A}=c,P=o.getState(),k=P.gl;P.gl||P.set({gl:k=n1e(h,n)});let W=P.raycaster;W||P.set({raycaster:W=new TH});const{params:N,...O}=R||{};if(vr.equ(O,W,om)||im(W,{...O}),vr.equ(N,W.params,om)||im(W,{params:{...W.params,...N}}),!P.camera||P.camera===l&&!vr.equ(l,T,om)){l=T;const L=T instanceof Gd,j=L?T:b?new af(0,0,0,0,.1,1e3):new Si(75,0,.1,1e3);L||(j.position.z=5,T&&(im(j,T),("aspect"in T||"left"in T||"right"in T||"bottom"in T||"top"in T)&&(j.manual=!0,j.updateProjectionMatrix())),!P.camera&&!(T!=null&&T.rotation)&&j.lookAt(0,0,0)),P.set({camera:j}),W.camera=j}if(!P.scene){let L;d!=null&&d.isScene?L=d:(L=new vc,d&&im(L,d)),P.set({scene:mm(L)})}if(!P.xr){var z;const L=(K,ie)=>{const pe=o.getState();pe.frameloop!=="never"&&Hz(K,!0,pe,ie)},j=()=>{const K=o.getState();K.gl.xr.enabled=K.gl.xr.isPresenting,K.gl.xr.setAnimationLoop(K.gl.xr.isPresenting?L:null),K.gl.xr.isPresenting||Wz(K)},Q={connect(){const K=o.getState().gl;K.xr.addEventListener("sessionstart",j),K.xr.addEventListener("sessionend",j)},disconnect(){const K=o.getState().gl;K.xr.removeEventListener("sessionstart",j),K.xr.removeEventListener("sessionend",j)}};typeof((z=k.xr)==null?void 0:z.addEventListener)=="function"&&Q.connect(),P.set({xr:Q})}if(k.shadowMap){const L=k.shadowMap.enabled,j=k.shadowMap.type;if(k.shadowMap.enabled=!!g,vr.boo(g))k.shadowMap.type=G0;else if(vr.str(g)){var V;const Q={basic:_7,percentage:KS,soft:G0,variance:lu};k.shadowMap.type=(V=Q[g])!=null?V:G0}else vr.obj(g)&&Object.assign(k.shadowMap,g);(L!==k.shadowMap.enabled||j!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}const F=tX();F&&("enabled"in F?F.enabled=!_:"legacyMode"in F&&(F.legacyMode=_)),u||im(k,{outputEncoding:m?3e3:3001,toneMapping:x?wu:IP}),P.legacy!==_&&P.set(()=>({legacy:_})),P.linear!==m&&P.set(()=>({linear:m})),P.flat!==x&&P.set(()=>({flat:x})),h&&!vr.fun(h)&&!lX(h)&&!vr.equ(h,k,om)&&im(k,h),p&&!P.events.handlers&&P.set({events:p(o)});const U=r1e(n,f);return vr.equ(U,P.size,om)||P.setSize(U.width,U.height,U.updateStyle,U.top,U.left),E&&P.viewport.dpr!==sX(E)&&P.setDpr(E),P.frameloop!==S&&P.setFrameloop(S),P.onPointerMissed||P.set({onPointerMissed:A}),C&&!vr.equ(C,P.performance,om)&&P.set(L=>({performance:{...L.performance,...C}})),a=v,u=!0,this},render(c){return u||this.configure(),Xb.updateContainer(G.jsx(o1e,{store:o,children:c,onCreated:a,rootElement:n}),s,null,()=>{}),o},unmount(){dX(n)}}}function o1e({store:n,children:e,onCreated:t,rootElement:r}){return ex(()=>{const i=n.getState();i.set(o=>({internal:{...o.internal,active:!0}})),t&&t(i),n.getState().events.connected||i.events.connect==null||i.events.connect(r)},[]),G.jsx(cX.Provider,{value:n,children:e})}function dX(n,e){const t=jv.get(n),r=t==null?void 0:t.fiber;if(r){const i=t==null?void 0:t.store.getState();i&&(i.internal.active=!1),Xb.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var o,s,a,u;i.events.disconnect==null||i.events.disconnect(),(o=i.gl)==null||(s=o.renderLists)==null||s.dispose==null||s.dispose(),(a=i.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(u=i.gl)!=null&&u.xr&&i.xr.disconnect(),jye(i),jv.delete(n)}catch{}},500)})}}Xb.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:H.version});const uT={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function s1e(n){const{handlePointer:e}=Kye(n);return{priority:1,enabled:!0,compute(t,r,i){r.pointer.set(t.offsetX/r.size.width*2-1,-(t.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(uT).reduce((t,r)=>({...t,[r]:e(r)}),{}),update:()=>{var t;const{events:r,internal:i}=n.getState();(t=i.lastEvent)!=null&&t.current&&r.handlers&&r.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{var r;const{set:i,events:o}=n.getState();o.disconnect==null||o.disconnect(),i(s=>({events:{...s.events,connected:t}})),Object.entries((r=o.handlers)!=null?r:[]).forEach(([s,a])=>{const[u,l]=uT[s];t.addEventListener(u,a,{passive:l})})},disconnect:()=>{const{set:t,events:r}=n.getState();if(r.connected){var i;Object.entries((i=r.handlers)!=null?i:[]).forEach(([o,s])=>{if(r&&r.connected instanceof HTMLElement){const[a]=uT[o];r.connected.removeEventListener(a,s)}}),t(o=>({events:{...o.events,connected:void 0}}))}}}}function Gz(n,e){let t;return(...r)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...r),e)}}function a1e({debounce:n,scroll:e,polyfill:t,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[o,s]=H.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=H.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),u=n?typeof n=="number"?n:n.scroll:null,l=n?typeof n=="number"?n:n.resize:null,c=H.useRef(!1);H.useEffect(()=>(c.current=!0,()=>void(c.current=!1)));const[h,f,d]=H.useMemo(()=>{const m=()=>{if(!a.current.element)return;const{left:x,top:_,width:b,height:S,bottom:E,right:C,x:R,y:T}=a.current.element.getBoundingClientRect(),A={left:x,top:_,width:b,height:S,bottom:E,right:C,x:R,y:T};a.current.element instanceof HTMLElement&&r&&(A.height=a.current.element.offsetHeight,A.width=a.current.element.offsetWidth),Object.freeze(A),c.current&&!h1e(a.current.lastBounds,A)&&s(a.current.lastBounds=A)};return[m,l?Gz(m,l):m,u?Gz(m,u):m]},[s,r,u,l]);function p(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(m=>m.removeEventListener("scroll",d,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function v(){a.current.element&&(a.current.resizeObserver=new i(d),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(m=>m.addEventListener("scroll",d,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{d()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const g=m=>{!m||m===a.current.element||(p(),a.current.element=m,a.current.scrollContainers=pX(m),v())};return l1e(d,!!e),u1e(f),H.useEffect(()=>{p(),v()},[e,d,f]),H.useEffect(()=>p,[]),[g,o,h]}function u1e(n){H.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function l1e(n,e){H.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function pX(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:r,overflowY:i}=window.getComputedStyle(n);return[t,r,i].some(o=>o==="auto"||o==="scroll")&&e.push(n),[...e,...pX(n.parentElement)]}const c1e=["x","y","top","bottom","left","right","width","height"],h1e=(n,e)=>c1e.every(t=>n[t]===e[t]);var f1e=Object.defineProperty,d1e=Object.defineProperties,p1e=Object.getOwnPropertyDescriptors,$z=Object.getOwnPropertySymbols,m1e=Object.prototype.hasOwnProperty,v1e=Object.prototype.propertyIsEnumerable,jz=(n,e,t)=>e in n?f1e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xz=(n,e)=>{for(var t in e||(e={}))m1e.call(e,t)&&jz(n,t,e[t]);if($z)for(var t of $z(e))v1e.call(e,t)&&jz(n,t,e[t]);return n},g1e=(n,e)=>d1e(n,p1e(e)),qz,Yz;typeof window<"u"&&((qz=window.document)!=null&&qz.createElement||((Yz=window.navigator)==null?void 0:Yz.product)==="ReactNative")?H.useLayoutEffect:H.useEffect;function mX(n,e,t){if(!n)return;if(t(n)===!0)return n;let r=n.child;for(;r;){const i=mX(r,e,t);if(i)return i;r=r.sibling}}function vX(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const Kz=console.error;console.error=function(){const n=[...arguments].join("");if(n!=null&&n.startsWith("Warning:")&&n.includes("useContext")){console.error=Kz;return}return Kz.apply(this,arguments)};const bD=vX(H.createContext(null));class gX extends H.Component{render(){return H.createElement(bD.Provider,{value:this._reactInternals},this.props.children)}}function y1e(){const n=H.useContext(bD);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=H.useId();return H.useMemo(()=>{for(const r of[n,n==null?void 0:n.alternate]){if(!r)continue;const i=mX(r,!1,o=>{let s=o.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(i)return i}},[n,e])}function x1e(){const n=y1e(),[e]=H.useState(()=>new Map);e.clear();let t=n;for(;t;){if(t.type&&typeof t.type=="object"){const i=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;i&&i!==bD&&!e.has(i)&&e.set(i,H.useContext(vX(i)))}t=t.return}return e}function w1e(){const n=x1e();return H.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>r=>H.createElement(e,null,H.createElement(t.Provider,g1e(Xz({},r),{value:n.get(t)}))),e=>H.createElement(gX,Xz({},e))),[n])}const _1e=H.forwardRef(function({children:e,fallback:t,resize:r,style:i,gl:o,events:s=s1e,eventSource:a,eventPrefix:u,shadows:l,linear:c,flat:h,legacy:f,orthographic:d,frameloop:p,dpr:v,performance:g,raycaster:m,camera:x,scene:_,onPointerMissed:b,onCreated:S,...E},C){H.useMemo(()=>Vye(vce),[]);const R=w1e(),[T,A]=a1e({scroll:!0,debounce:{scroll:50,resize:0},...r}),P=H.useRef(null),k=H.useRef(null);H.useImperativeHandle(C,()=>P.current);const W=rX(b),[N,O]=H.useState(!1),[z,V]=H.useState(!1);if(N)throw N;if(z)throw z;const F=H.useRef(null);ex(()=>{const L=P.current;A.width>0&&A.height>0&&L&&(F.current||(F.current=i1e(L)),F.current.configure({gl:o,events:s,shadows:l,linear:c,flat:h,legacy:f,orthographic:d,frameloop:p,dpr:v,performance:g,raycaster:m,camera:x,scene:_,size:A,onPointerMissed:(...j)=>W.current==null?void 0:W.current(...j),onCreated:j=>{j.events.connect==null||j.events.connect(a?Hye(a)?a.current:a:k.current),u&&j.setEvents({compute:(Q,K)=>{const ie=Q[u+"X"],pe=Q[u+"Y"];K.pointer.set(ie/K.size.width*2-1,-(pe/K.size.height)*2+1),K.raycaster.setFromCamera(K.pointer,K.camera)}}),S==null||S(j)}}),F.current.render(G.jsx(R,{children:G.jsx(iX,{set:V,children:G.jsx(H.Suspense,{fallback:G.jsx(Gye,{set:O}),children:e??null})})})))}),H.useEffect(()=>{const L=P.current;if(L)return()=>dX(L)},[]);const U=a?"none":"auto";return G.jsx("div",{ref:k,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:U,...i},...E,children:G.jsx("div",{ref:T,style:{width:"100%",height:"100%"},children:G.jsx("canvas",{ref:P,style:{display:"block"},children:t})})})}),b1e=H.forwardRef(function(e,t){return G.jsx(gX,{children:G.jsx(_1e,{...e,ref:t})})});function HI(){return HI=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},HI.apply(null,arguments)}function S1e(n,e,t){const r=my(f=>f.size),i=my(f=>f.viewport),o=typeof n=="number"?n:r.width*i.dpr,s=r.height*i.dpr,a=(typeof n=="number"?t:n)||{},{samples:u=0,depth:l,...c}=a,h=H.useMemo(()=>{const f=new oi(o,s,{minFilter:Fn,magFilter:Fn,type:Wh,...c});return l&&(f.depthTexture=new V1(o,s,vs)),f.samples=u,f},[]);return H.useLayoutEffect(()=>{h.setSize(o,s),u&&(h.samples=u)},[u,h,o,s]),H.useEffect(()=>()=>h.dispose(),[]),h}const E1e=n=>typeof n=="function",C1e=H.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:r,children:i,...o},s)=>{const a=my(({set:g})=>g),u=my(({camera:g})=>g),l=my(({size:g})=>g),c=H.useRef(null);H.useImperativeHandle(s,()=>c.current,[]);const h=H.useRef(null),f=S1e(e);H.useLayoutEffect(()=>{o.manual||(c.current.aspect=l.width/l.height)},[l,o]),H.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let d=0,p=null;const v=E1e(i);return fX(g=>{v&&(t===1/0||d<t)&&(h.current.visible=!1,g.gl.setRenderTarget(f),p=g.scene.background,n&&(g.scene.background=n),g.gl.render(g.scene,c.current),g.scene.background=p,g.gl.setRenderTarget(null),h.current.visible=!0,d++)}),H.useLayoutEffect(()=>{if(r){const g=u;return a(()=>({camera:c.current})),()=>a(()=>({camera:g}))}},[c,r,a]),H.createElement(H.Fragment,null,H.createElement("perspectiveCamera",HI({ref:c},o),!v&&i),H.createElement("group",{ref:h},v&&i(f.texture)))}),M1e=Math.PI/180;function T1e(n){return n*M1e}function R1e(n,e){var f;const t=Ia.physical,{vertexShader:r,fragmentShader:i,uniforms:o}=t,s=t.defines??{},a=qP.clone(o),u=new n(e.material||{});u.color&&(a.diffuse.value=u.color),"roughness"in u&&(a.roughness.value=u.roughness),"metalness"in u&&(a.metalness.value=u.metalness),"envMap"in u&&(a.envMap.value=u.envMap),"envMapIntensity"in u&&(a.envMapIntensity.value=u.envMapIntensity),Object.entries(e.uniforms??{}).forEach(([d,p])=>{a[d]=p!==null&&typeof p=="object"&&"value"in p?p:{value:p}});let l=`${e.header}
${e.vertexHeader??""}
${r}`,c=`${e.header}
${e.fragmentHeader??""}
${i}`;for(const[d,p]of Object.entries(e.vertex??{}))l=l.replace(d,`${d}
${p}`);for(const[d,p]of Object.entries(e.fragment??{}))c=c.replace(d,`${d}
${p}`);return new pi({defines:{...s},uniforms:a,vertexShader:l,fragmentShader:c,lights:!0,fog:!!((f=e.material)!=null&&f.fog)})}const A1e=({children:n})=>G.jsx(b1e,{dpr:[1,2],frameloop:"always",className:"w-full h-full relative",children:n}),I1e=n=>{const e=n.replace("#",""),t=parseInt(e.substring(0,2),16),r=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return[t/255,r/255,i/255]},P1e=`
float random (in vec2 st) {
    return fract(sin(dot(st.xy,
                         vec2(12.9898,78.233)))*
        43758.5453123);
}
float noise (in vec2 st) {
    vec2 i = floor(st);
    vec2 f = fract(st);
    float a = random(i);
    float b = random(i + vec2(1.0, 0.0));
    float c = random(i + vec2(0.0, 1.0));
    float d = random(i + vec2(1.0, 1.0));
    vec2 u = f * f * (3.0 - 2.0 * f);
    return mix(a, b, u.x) +
           (c - a)* u.y * (1.0 - u.x) +
           (d - b) * u.x * u.y;
}
vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}
vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}
float cnoise(vec3 P){
  vec3 Pi0 = floor(P);
  vec3 Pi1 = Pi0 + vec3(1.0);
  Pi0 = mod(Pi0, 289.0);
  Pi1 = mod(Pi1, 289.0);
  vec3 Pf0 = fract(P);
  vec3 Pf1 = Pf0 - vec3(1.0);
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;
  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);
  vec4 gx0 = ixy0 / 7.0;
  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
  vec4 gx1 = ixy1 / 7.0;
  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
  vec4 norm0 = taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));
  g000 *= norm0.x; g010 *= norm0.y; g100 *= norm0.z; g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));
  g001 *= norm1.x; g011 *= norm1.y; g101 *= norm1.z; g111 *= norm1.w;
  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x,Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x,Pf1.y,Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy,Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy,Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x,Pf0.y,Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x,Pf1.yz));
  float n111 = dot(g111, Pf1);
  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);
  vec2 n_yz = mix(n_z.xy,n_z.zw,fade_xyz.y);
  float n_xyz = mix(n_yz.x,n_yz.y,fade_xyz.x);
  return 2.2 * n_xyz;
}
`,k1e=({beamWidth:n=2,beamHeight:e=15,beamNumber:t=12,lightColor:r="#ffffff",speed:i=2,noiseIntensity:o=1.75,scale:s=.2,rotation:a=0})=>{const u=H.useRef(null),l=H.useMemo(()=>R1e(bE,{header:`
  varying vec3 vEye;
  varying float vNoise;
  varying vec2 vUv;
  varying vec3 vPosition;
  uniform float time;
  uniform float uSpeed;
  uniform float uNoiseIntensity;
  uniform float uScale;
  ${P1e}`,vertexHeader:`
  float getPos(vec3 pos) {
    vec3 noisePos =
      vec3(pos.x * 0., pos.y - uv.y, pos.z + time * uSpeed * 3.) * uScale;
    return cnoise(noisePos);
  }
  vec3 getCurrentPos(vec3 pos) {
    vec3 newpos = pos;
    newpos.z += getPos(pos);
    return newpos;
  }
  vec3 getNormal(vec3 pos) {
    vec3 curpos = getCurrentPos(pos);
    vec3 nextposX = getCurrentPos(pos + vec3(0.01, 0.0, 0.0));
    vec3 nextposZ = getCurrentPos(pos + vec3(0.0, -0.01, 0.0));
    vec3 tangentX = normalize(nextposX - curpos);
    vec3 tangentZ = normalize(nextposZ - curpos);
    return normalize(cross(tangentZ, tangentX));
  }`,fragmentHeader:"",vertex:{"#include <begin_vertex>":"transformed.z += getPos(transformed.xyz);","#include <beginnormal_vertex>":"objectNormal = getNormal(position.xyz);"},fragment:{"#include <dithering_fragment>":`
    float randomNoise = noise(gl_FragCoord.xy);
    gl_FragColor.rgb -= randomNoise / 15. * uNoiseIntensity;`},material:{fog:!0},uniforms:{diffuse:new ct(...I1e("#000000")),time:{shared:!0,mixed:!0,linked:!0,value:0},roughness:.3,metalness:.3,uSpeed:{shared:!0,mixed:!0,linked:!0,value:i},envMapIntensity:10,uNoiseIntensity:o,uScale:s}}),[i,o,s]);return G.jsxs(A1e,{children:[G.jsxs("group",{rotation:[0,0,T1e(a)],children:[G.jsx(xX,{ref:u,material:l,count:t,width:n,height:e}),G.jsx(N1e,{color:r,position:[0,3,10]})]}),G.jsx("ambientLight",{intensity:1}),G.jsx("color",{attach:"background",args:["#000000"]}),G.jsx(C1e,{makeDefault:!0,position:[0,0,20],fov:30})]})};function D1e(n,e,t,r,i){const o=new an,s=n*(i+1)*2,a=n*i*2,u=new Float32Array(s*3),l=new Uint32Array(a*3),c=new Float32Array(s*2);let h=0,f=0,d=0;const v=-(n*e+(n-1)*r)/2;for(let g=0;g<n;g++){const m=v+g*(e+r),x=Math.random()*300,_=Math.random()*300;for(let b=0;b<=i;b++){const S=t*(b/i-.5),E=[m,S,0],C=[m+e,S,0];u.set([...E,...C],h*3);const R=b/i;if(c.set([x,R+_,x+1,R+_],d),b<i){const T=h,A=h+1,P=h+2,k=h+3;l.set([T,A,P,P,A,k],f),f+=6}h+=2,d+=4}}return o.setAttribute("position",new In(u,3)),o.setAttribute("uv",new In(c,2)),o.setIndex(new In(l,1)),o.computeVertexNormals(),o}const yX=H.forwardRef(({material:n,width:e,count:t,height:r},i)=>{const o=H.useRef(null);H.useImperativeHandle(i,()=>o.current);const s=H.useMemo(()=>D1e(t,e,r,0,100),[t,e,r]);return fX((a,u)=>{o.current.material.uniforms.time.value+=.1*u}),G.jsx("mesh",{ref:o,geometry:s,material:n})});yX.displayName="MergedPlanes";const xX=H.forwardRef((n,e)=>G.jsx(yX,{ref:e,material:n.material,width:n.width,count:n.count,height:n.height}));xX.displayName="PlaneNoise";const N1e=({position:n,color:e})=>{const t=H.useRef(null);return H.useEffect(()=>{if(!t.current)return;const r=t.current.shadow.camera;r&&(r.top=24,r.bottom=-24,r.left=-24,r.right=24,r.far=64,t.current.shadow.bias=-.004)},[]),G.jsx("directionalLight",{ref:t,color:e,intensity:1,position:n})},L1e=()=>{const[n,e]=H.useState(0),t=H.useRef(null),[r,i]=H.useState(window.innerWidth<=768);H.useEffect(()=>{const u=()=>i(window.innerWidth<=768);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const o=[{title:"Portfolio Website",description:"A modern, interactive portfolio website built with React and Vite. Features smooth animations, 3D effects, and responsive design.",image:Jr.portfolioImage,demoLink:"https://mayank-kumar-portfolio.vercel.app/",technologies:["React","Vite","Tailwind CSS","Three.js","GSAP"],colorScheme:"cyan"},{title:"EMC",description:"Interactive Educational Calculator for Class 10 Mathematics",image:Jr.EMC,demoLink:"https://emc-calculator.vercel.app/",technologies:["React 18","Tailwind CSS","Framer Motion","EmailJS","React Router"],colorScheme:"violet"},{title:"Disaster Response Training Tool",description:"The Disaster Response Training Tool is an interactive web-based platform designed to enhance disaster preparedness and response training",image:Jr.DRT,demoLink:"https://disaster-response-traning-tool.vercel.app/",technologies:["HTML","CSS","JS","API"],colorScheme:"rose"},{title:"CoreX-OS",description:"CoreX OS is a web-based OS simulator with an interactive React frontend that demonstrates core operating system concepts like file systems, memory management, CPU scheduling, and process synchronization.",image:Jr.core,demoLink:"https://github.com/mayank-kumar-27/CoreX-OS",technologies:["React","Python","Bootstrap","Chart.js","Context API"],colorScheme:"emerald"},{title:"Voting Simulation Systems",description:"Voting Simulation System is a C-based command-line program that simulates voting for six parties, allowing users to cast votes, securely view results with a PIN, and demonstrating basic real-world voting logic.",image:Jr.vm,demoLink:"https://github.com/mayank-kumar-27/Voting-Machine",technologies:["C","CLI","Voting Simulation"],colorScheme:"amber"}];H.useEffect(()=>{if(!r){const u=setInterval(()=>{e(l=>(l+1)%o.length)},3e3);return()=>clearInterval(u)}},[o.length,r]);const s={cyan:{bg:"from-primary/20 to-surface/50",border:"border-primary/40",gradient:"from-primary to-primary-light",text:"text-primary",glow:"rgba(0, 212, 255, 0.3)"},violet:{bg:"from-secondary/20 to-surface/50",border:"border-secondary/40",gradient:"from-secondary to-secondary-light",text:"text-secondary-light",glow:"rgba(124, 58, 237, 0.3)"},rose:{bg:"from-tertiary/20 to-surface/50",border:"border-tertiary/40",gradient:"from-tertiary to-tertiary-light",text:"text-tertiary",glow:"rgba(244, 114, 182, 0.3)"},emerald:{bg:"from-accent/20 to-surface/50",border:"border-accent/40",gradient:"from-accent to-accent-light",text:"text-accent",glow:"rgba(16, 185, 129, 0.3)"},amber:{bg:"from-warm/20 to-surface/50",border:"border-warm/40",gradient:"from-warm to-warm-light",text:"text-warm",glow:"rgba(245, 158, 11, 0.3)"}},a=({project:u})=>{const l=s[u.colorScheme];return G.jsxs("div",{className:`bg-gradient-to-br ${l.bg} backdrop-blur-md border ${l.border} rounded-2xl p-5 flex flex-col min-h-[380px] w-full`,children:[G.jsx("div",{className:`w-full h-32 rounded-xl overflow-hidden mb-4 ring-2 ${l.border.replace("border-","ring-")}`,children:G.jsx("img",{src:u.image,alt:u.title,className:"w-full h-full object-cover"})}),G.jsx("h3",{className:"text-lg font-bold text-white mb-2 text-center",children:u.title}),G.jsx("p",{className:"text-gray-400 text-xs leading-relaxed text-center mb-4 flex-1",children:u.description}),G.jsx("div",{className:"flex flex-wrap justify-center gap-1.5 mb-4",children:u.technologies.slice(0,4).map((c,h)=>G.jsx("span",{className:`px-2 py-1 text-xs font-medium bg-gradient-to-r ${l.gradient} bg-opacity-10 text-white rounded-full border ${l.border}`,children:c},h))}),G.jsxs("a",{href:u.demoLink,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center justify-center gap-2 px-5 py-2.5 bg-gradient-to-r ${l.gradient} rounded-full text-white text-sm font-semibold active:scale-95 transition-transform`,children:[G.jsx("span",{children:"View Demo"}),G.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]})};return G.jsxs("section",{className:"relative min-h-screen w-full flex items-center overflow-visible bg-gradient-to-br from-[#0a0a0f] via-surface/20 to-[#0a0a0f] py-20",children:[G.jsx("div",{className:"absolute inset-0 z-[1]",children:G.jsx(k1e,{beamWidth:3,beamHeight:30,beamNumber:20,lightColor:"#7c3aed",speed:2,noiseIntensity:1.75,scale:.2,rotation:45})}),G.jsxs("div",{className:"absolute inset-0 overflow-hidden z-[2] pointer-events-none",children:[G.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/10 rounded-full blur-3xl animate-pulse"}),G.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-secondary/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),G.jsx("div",{className:"absolute top-1/2 right-1/3 w-64 h-64 bg-tertiary/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"2s"}})]}),r?G.jsxs("div",{className:"relative z-10 w-full h-full px-4 pt-16 pb-8",children:[G.jsxs("div",{className:"text-center mb-8",children:[G.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift mb-4",children:"My Projects"}),G.jsx("p",{className:"text-sm text-gray-400 leading-relaxed px-2",children:"Explore my latest work and creative solutions. Each project showcases my passion for building innovative applications."})]}),G.jsx(Bj,{autoPlayInterval:4e3,enableSwipe:!0,children:o.map((u,l)=>G.jsx(a,{project:u},l))})]}):G.jsxs("div",{className:"relative z-10 w-full max-w-[1400px] mx-auto px-8 lg:px-16 flex flex-col lg:flex-row items-center gap-16 pointer-events-none",children:[G.jsxs("div",{className:"w-full lg:w-1/3 space-y-6 pointer-events-auto",children:[G.jsxs("div",{children:[G.jsx("h1",{className:"text-6xl md:text-7xl lg:text-8xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent animate-gradient-shift mb-4",children:"My Projects"}),G.jsx("p",{className:"text-gray-400 text-lg md:text-xl leading-relaxed",children:G.jsx(xD,{text:"Explore my latest work and creative solutions. Each project showcases my passion for building innovative and functional applications.",className:"text-base sm:text-lg md:text-xl text-gray-400",parentClassName:"max-w-2xl leading-relaxed mb-10 block",speed:20,maxIterations:15,sequential:!0,revealDirection:"start",animateOn:"view"})})]}),G.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[G.jsxs("span",{className:"text-gray-500 text-sm font-medium",children:[n+1," / ",o.length]}),G.jsx("div",{className:"flex gap-2",children:o.map((u,l)=>G.jsx("div",{className:`h-1 rounded-full transition-all duration-500 ${n===l?"w-12 bg-gradient-to-r from-primary via-secondary to-tertiary":"w-6 bg-white/20"}`},l))})]})]}),G.jsx("div",{ref:t,className:"w-full lg:w-2/3 relative h-[650px] flex items-center justify-end",children:G.jsx("div",{className:"relative w-full max-w-[500px] h-full flex items-center justify-end pr-8",children:o.map((u,l)=>{const c=(l-n+o.length)%o.length,h=c===0,f=s[u.colorScheme],d=p=>p===0?"translate(-50%, -50%) translateX(0px)":p===1?"translate(-50%, -50%) translateX(180px)":p===2?"translate(-50%, -50%) translateX(360px)":p===3?"translate(-50%, -50%) translateX(540px)":p===4?"translate(-50%, -50%) translateX(720px)":"translate(-50%, -50%) translateX(900px)";return G.jsxs("div",{className:`group absolute top-1/2 left-0 w-[400px] transition-all duration-700 ease-out rounded-3xl overflow-hidden border ${f.border} bg-gradient-to-br ${f.bg} backdrop-blur-md shadow-2xl`,style:{zIndex:o.length-c,transform:d(c)+` scale(${c===0?1:.85-c*.05})`,opacity:c<5?c===0?1:.6-c*.1:0,filter:c>0?`blur(${c*1.2}px)`:"blur(0px)",pointerEvents:h?"auto":"none",boxShadow:h?`0 0 40px ${f.glow}`:"none"},children:[G.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-gradient-to-br from-secondary/20 to-primary/20 rounded-full blur-2xl"}),G.jsx("div",{className:"absolute -bottom-4 -left-4 w-32 h-32 bg-gradient-to-tr from-tertiary/10 to-warm/10 rounded-full blur-2xl"}),G.jsxs("div",{className:"relative flex flex-col items-center h-full p-6 min-h-[580px]",children:[G.jsx("div",{className:"flex justify-center mb-4",children:G.jsxs("div",{className:`relative w-28 h-28 rounded-2xl overflow-hidden ring-2 ${f.border.replace("border-","ring-")} transition-all duration-500 ${h?"scale-100":"scale-90"}`,style:{transitionDelay:h?"200ms":"0ms"},children:[G.jsx("img",{src:u.image,alt:u.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),G.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"})]})}),G.jsx("div",{className:"flex justify-center mb-4",children:G.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${f.gradient} rounded-full flex items-center justify-center transition-all duration-500 shadow-lg ${h?"rotate-0 scale-100":"rotate-12 scale-90"}`,children:G.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})})})}),G.jsx("div",{className:"text-center mb-4 flex-1 flex items-center justify-center px-3",children:G.jsx("p",{className:"text-gray-400 text-sm leading-relaxed italic",children:u.description})}),G.jsx("div",{className:"text-center mb-3",children:G.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:u.title})}),G.jsx("div",{className:"w-full mb-4 px-4",children:G.jsx("div",{className:"flex flex-wrap justify-center gap-2",children:u.technologies.map((p,v)=>G.jsx("span",{className:`px-3 py-1.5 text-xs font-bold bg-gradient-to-r ${f.gradient} bg-opacity-10 text-white rounded-full border ${f.border} transition-transform duration-300`,style:{textShadow:"0 1px 4px rgba(0,0,0,0.25)"},children:p},v))})}),G.jsxs("div",{className:"flex items-center justify-center gap-4 mb-4 text-gray-500 text-xs",children:[G.jsxs("div",{className:"flex items-center gap-1.5 group-hover:text-gray-400 transition-colors",children:[G.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:G.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),G.jsx("span",{className:"font-medium",children:"Featured"})]}),G.jsx("div",{className:"w-px h-4 bg-surface"}),G.jsxs("div",{className:"flex items-center gap-1.5 group-hover:text-gray-400 transition-colors",children:[G.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),G.jsx("span",{className:"font-medium",children:"2025"})]})]}),h&&G.jsxs("a",{href:u.demoLink,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center justify-center gap-2 px-6 py-2.5 bg-gradient-to-r ${f.gradient} rounded-full text-white text-sm font-semibold hover:scale-105 transition-all duration-300 shadow-lg hover:shadow-xl`,children:[G.jsx("span",{children:"View Demo"}),G.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]}),G.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-700 rounded-3xl overflow-hidden pointer-events-none",children:G.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1500"})})]},l)})})})]})]})},F1e=()=>{const n=qS(),e=Ru(),t=[{name:"Home",path:"/"},{name:"About",path:"/about"},{name:"Projects",path:"/projects"},{name:"Skills",path:"/skills"},{name:"Contact",path:"/contact"}],r=i=>e.pathname===i;return G.jsx("nav",{className:"fixed top-6 left-1/2 -translate-x-1/2 z-50",children:G.jsx("div",{className:"flex items-center gap-2 bg-surface/30 backdrop-blur-xl rounded-full px-4 py-2 border border-white/5",children:t.map(i=>G.jsxs("button",{onClick:()=>n(i.path),className:`
              cursor-target
              relative flex items-center gap-2 px-6 py-2.5 rounded-full font-medium text-base
              transition-all duration-300 ease-out overflow-hidden
              group
              ${r(i.path)?"bg-gradient-to-r from-primary via-secondary to-tertiary text-white shadow-lg shadow-primary/30 scale-105":"text-gray-400 hover:text-white hover:bg-white/5 hover:scale-105"}
            `,children:[!r(i.path)&&G.jsx("span",{className:"absolute inset-0 -translate-x-full group-hover:translate-x-full transition-transform duration-700 ease-out bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12"}),r(i.path)&&G.jsx("span",{className:"w-2 h-2 rounded-full bg-white animate-pulse relative z-10"}),G.jsx("span",{className:"relative z-10",children:i.name})]},i.name))})})},O1e=()=>{const[n,e]=H.useState(!1),t=qS(),r=Ru(),i=H.useRef(null),o=[{name:"Home",path:"/"},{name:"About",path:"/about"},{name:"Projects",path:"/projects"},{name:"Skills",path:"/skills"},{name:"Contact",path:"/contact"}],s=o.find(l=>l.path===r.pathname)||o[0],a=o.filter(l=>l.path!==r.pathname);H.useEffect(()=>{const l=c=>{i.current&&!i.current.contains(c.target)&&e(!1)};return n&&(document.addEventListener("touchstart",l),document.addEventListener("mousedown",l)),()=>{document.removeEventListener("touchstart",l),document.removeEventListener("mousedown",l)}},[n]);const u=l=>{t(l),e(!1)};return G.jsxs("nav",{ref:i,className:"fixed top-4 left-1/2 -translate-x-1/2 z-50",children:[G.jsxs("button",{onClick:()=>e(!n),className:`
          flex items-center gap-2 px-5 py-2.5 rounded-full
          bg-surface/60 backdrop-blur-xl border border-white/10
          transition-all duration-300
          ${n?"border-primary/40 shadow-lg shadow-primary/10":""}
        `,children:[G.jsx("span",{className:"w-2 h-2 rounded-full bg-gradient-to-r from-primary to-secondary animate-pulse"}),G.jsx("span",{className:"text-sm font-medium text-white",children:s.name}),G.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-300 ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),G.jsx("div",{className:`
          absolute top-full left-1/2 -translate-x-1/2 mt-2 min-w-[140px]
          bg-surface/90 backdrop-blur-xl rounded-2xl border border-white/10
          overflow-hidden shadow-xl shadow-black/30
          transition-all duration-300 origin-top
          ${n?"opacity-100 scale-100 translate-y-0":"opacity-0 scale-95 -translate-y-2 pointer-events-none"}
        `,children:a.map((l,c)=>G.jsx("button",{onClick:()=>u(l.path),className:`
              w-full px-5 py-3 text-left text-sm font-medium text-gray-300
              hover:bg-white/5 hover:text-white transition-colors duration-200
              ${c!==a.length-1?"border-b border-white/5":""}
            `,children:l.name},l.name))})]})},B1e=({targetSelector:n=".cursor-target",spinDuration:e=2,hideDefaultCursor:t=!0,hoverDuration:r=.2,parallaxOn:i=!0})=>{const o=Ru(),s=H.useRef(null),a=H.useRef(null),u=H.useRef(null),l=H.useRef(null),c=H.useRef(!1),h=H.useRef(null),f=H.useRef(null),d=H.useRef(0),p=H.useMemo(()=>{const m="ontouchstart"in window||navigator.maxTouchPoints>0,x=window.innerWidth<=768,_=navigator.userAgent||navigator.vendor||window.opera,S=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(_.toLowerCase());return m&&x||S},[]),v=H.useMemo(()=>({borderWidth:3,cornerSize:12}),[]),g=H.useCallback((m,x)=>{s.current&&en.to(s.current,{x:m,y:x,duration:.1,ease:"power3.out"})},[]);return H.useEffect(()=>{if(p||!s.current)return;const m=document.body.style.cursor;t&&(document.body.style.cursor="none");const x=s.current;a.current=x.querySelectorAll(".target-cursor-corner");let _=null,b=null,S=null;const E=N=>{b&&N.removeEventListener("mouseleave",b),b=null};en.set(x,{xPercent:-50,yPercent:-50,x:window.innerWidth/2,y:window.innerHeight/2}),(()=>{u.current&&u.current.kill(),u.current=en.timeline({repeat:-1}).to(x,{rotation:"+=360",duration:e,ease:"none"})})();const R=()=>{if(!h.current||!s.current||!a.current)return;const N=d.current;if(N===0)return;const O=en.getProperty(s.current,"x"),z=en.getProperty(s.current,"y");Array.from(a.current).forEach((F,U)=>{const L=en.getProperty(F,"x"),j=en.getProperty(F,"y"),Q=h.current[U].x-O,K=h.current[U].y-z,ie=L+(Q-L)*N,pe=j+(K-j)*N,we=N>=.99?i?.2:0:.05;en.to(F,{x:ie,y:pe,duration:we,ease:we===0?"none":"power1.out",overwrite:"auto"})})};f.current=R;const T=N=>g(N.clientX,N.clientY);window.addEventListener("mousemove",T);const A=()=>{if(!_||!s.current)return;const N=en.getProperty(s.current,"x"),O=en.getProperty(s.current,"y"),z=document.elementFromPoint(N,O);z&&(z===_||z.closest(n)===_)||b&&b()};window.addEventListener("scroll",A,{passive:!0});const P=()=>{l.current&&(en.to(l.current,{scale:.7,duration:.3}),en.to(s.current,{scale:.9,duration:.2}))},k=()=>{l.current&&(en.to(l.current,{scale:1,duration:.3}),en.to(s.current,{scale:1,duration:.2}))};window.addEventListener("mousedown",P),window.addEventListener("mouseup",k);const W=N=>{var we;const O=N.target,z=[];let V=O;for(;V&&V!==document.body;)V.matches(n)&&z.push(V),V=V.parentElement;const F=z[0]||null;if(!F||!s.current||!a.current||_===F)return;_&&E(_),S&&(clearTimeout(S),S=null),_=F;const U=Array.from(a.current);U.forEach(ce=>en.killTweensOf(ce)),en.killTweensOf(s.current,"rotation"),(we=u.current)==null||we.pause(),en.set(s.current,{rotation:0});const L=F.getBoundingClientRect(),{borderWidth:j,cornerSize:Q}=v,K=en.getProperty(s.current,"x"),ie=en.getProperty(s.current,"y");h.current=[{x:L.left-j,y:L.top-j},{x:L.right+j-Q,y:L.top-j},{x:L.right+j-Q,y:L.bottom+j-Q},{x:L.left-j,y:L.bottom+j-Q}],c.current=!0,en.ticker.add(f.current),en.to(d,{current:1,duration:r,ease:"power2.out"}),U.forEach((ce,_e)=>{en.to(ce,{x:h.current[_e].x-K,y:h.current[_e].y-ie,duration:.2,ease:"power2.out"})});const pe=()=>{if(en.ticker.remove(f.current),c.current=!1,h.current=null,en.set(d,{current:0,overwrite:!0}),_=null,a.current){const ce=Array.from(a.current);en.killTweensOf(ce);const{cornerSize:_e}=v,Oe=[{x:-_e*1.5,y:-_e*1.5},{x:_e*.5,y:-_e*1.5},{x:_e*.5,y:_e*.5},{x:-_e*1.5,y:_e*.5}],Ve=en.timeline();ce.forEach((Ne,Z)=>{Ve.to(Ne,{x:Oe[Z].x,y:Oe[Z].y,duration:.3,ease:"power3.out"},0)})}S=setTimeout(()=>{if(!_&&s.current&&u.current){const _e=en.getProperty(s.current,"rotation")%360;u.current.kill(),u.current=en.timeline({repeat:-1}).to(s.current,{rotation:"+=360",duration:e,ease:"none"}),en.to(s.current,{rotation:_e+360,duration:e*(1-_e/360),ease:"none",onComplete:()=>{var Oe;(Oe=u.current)==null||Oe.restart()}})}S=null},50),E(F)};b=pe,F.addEventListener("mouseleave",pe)};return window.addEventListener("mouseover",W,{passive:!0}),()=>{var N;f.current&&en.ticker.remove(f.current),window.removeEventListener("mousemove",T),window.removeEventListener("mouseover",W),window.removeEventListener("scroll",A),window.removeEventListener("mousedown",P),window.removeEventListener("mouseup",k),_&&E(_),(N=u.current)==null||N.kill(),document.body.style.cursor=m,c.current=!1,h.current=null,d.current=0}},[n,e,g,v,t,p,r,i]),H.useEffect(()=>{p||!s.current||!u.current||u.current.isActive()&&(u.current.kill(),u.current=en.timeline({repeat:-1}).to(s.current,{rotation:"+=360",duration:e,ease:"none"}))},[e,p]),H.useEffect(()=>{if(p||!s.current||!a.current)return;const m=Array.from(a.current);en.killTweensOf(m);const{cornerSize:x}=v,_=[{x:-x*1.5,y:-x*1.5},{x:x*.5,y:-x*1.5},{x:x*.5,y:x*.5},{x:-x*1.5,y:x*.5}];m.forEach((b,S)=>{en.to(b,{x:_[S].x,y:_[S].y,duration:.3,ease:"power3.out"})}),c.current=!1,h.current=null,en.set(d,{current:0}),u.current&&(u.current.kill(),u.current=en.timeline({repeat:-1}).to(s.current,{rotation:"+=360",duration:e,ease:"none"}))},[o.pathname,p,v,e]),p?null:G.jsxs("div",{ref:s,className:"fixed top-0 left-0 w-0 h-0 pointer-events-none z-[9999]",style:{willChange:"transform"},children:[G.jsx("div",{ref:l,className:"absolute top-1/2 left-1/2 w-1 h-1 bg-white rounded-full -translate-x-1/2 -translate-y-1/2",style:{willChange:"transform"}}),G.jsx("div",{className:"target-cursor-corner absolute top-1/2 left-1/2 w-3 h-3 border-[3px] border-white -translate-x-[150%] -translate-y-[150%] border-r-0 border-b-0",style:{willChange:"transform"}}),G.jsx("div",{className:"target-cursor-corner absolute top-1/2 left-1/2 w-3 h-3 border-[3px] border-white translate-x-1/2 -translate-y-[150%] border-l-0 border-b-0",style:{willChange:"transform"}}),G.jsx("div",{className:"target-cursor-corner absolute top-1/2 left-1/2 w-3 h-3 border-[3px] border-white translate-x-1/2 translate-y-1/2 border-l-0 border-t-0",style:{willChange:"transform"}}),G.jsx("div",{className:"target-cursor-corner absolute top-1/2 left-1/2 w-3 h-3 border-[3px] border-white -translate-x-[150%] translate-y-1/2 border-r-0 border-t-0",style:{willChange:"transform"}})]})};/**
 * postprocessing v6.38.2 build Mon Dec 22 2025
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2025 Raoul van Rschen
 * @license Zlib
 */var lT=1/1e3,U1e=1e3,z1e=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*lT}get fixedDelta(){return this._fixedDelta*lT}set fixedDelta(n){this._fixedDelta=n*U1e}get elapsed(){return this._elapsed*lT}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},V1e=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new an;return t.setAttribute("position",new In(n,3)),t.setAttribute("uv",new In(e,2)),t})(),ku=class GI{static get fullscreenGeometry(){return V1e}constructor(e="Pass",t=new vc,r=new af){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new yr(GI.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new vc),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=ug){}render(e,t,r,i,o){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof oi||t instanceof $i||t instanceof Lr||t instanceof GI)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},W1e=class extends ku{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,r,i){const o=n.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},H1e=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,wX="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",_X=class extends pi{constructor(){super({name:"CopyMaterial",defines:{COLOR_SPACE_CONVERSION:"1",DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new Pn(null),depthBuffer:new Pn(null),channelWeights:new Pn(null),opacity:new Pn(1)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:H1e,vertexShader:wX}),this.depthFunc=AP}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const e=n!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const e=n!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get colorSpaceConversion(){return this.defines.COLOR_SPACE_CONVERSION!==void 0}set colorSpaceConversion(n){this.colorSpaceConversion!==n&&(n?this.defines.COLOR_SPACE_CONVERSION=!0:delete this.defines.COLOR_SPACE_CONVERSION,this.needsUpdate=!0)}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},G1e=class extends ku{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new _X,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new oi(1,1,{minFilter:Fn,magFilter:Fn,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,r,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==ro?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Rn&&(this.renderTarget.texture.colorSpace=Rn))}},Zz=new ct,bX=class extends ku{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,r,i){const o=this.overrideClearColor,s=this.overrideClearAlpha,a=n.getClearAlpha(),u=o!==null,l=s>=0;u?(n.getClearColor(Zz),n.setClearColor(o,l?s:a)):l&&n.setClearAlpha(s),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),u?n.setClearColor(Zz,a):l&&n.setClearAlpha(a)}},$1e=class extends ku{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new bX(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,r,i){const o=n.getContext(),s=n.state.buffers,a=this.scene,u=this.camera,l=this.clearPass,c=this.inverted?0:1,h=1-c;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),s.stencil.setFunc(o.ALWAYS,c,4294967295),s.stencil.setClear(h),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(a,u)):(n.setRenderTarget(e),n.render(a,u),n.setRenderTarget(t),n.render(a,u)),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(o.EQUAL,1,4294967295),s.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),s.stencil.setLocked(!0)}},j1e=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:r=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,i,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new G1e,this.depthTexture=null,this.passes=[],this.timer=new z1e,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,t=this.multisampling;t>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new De),t=n.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===ro&&n.outputColorSpace===Rn&&(this.inputBuffer.texture.colorSpace=Rn,this.outputBuffer.texture.colorSpace=Rn,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const i of this.passes)i.initialize(n,t,r)}}replaceRenderer(n,e=!0){const t=this.renderer,r=t.domElement.parentNode;return this.setRenderer(n),e&&r!==null&&(r.removeChild(t.domElement),r.appendChild(n.domElement)),t}createDepthTexture(){const n=this.depthTexture=new V1;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Hh,n.type=sc):n.type=il,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,t,r){const i=this.renderer,o=i===null?new De:i.getDrawingBufferSize(new De),s={minFilter:Fn,magFilter:Fn,stencilBuffer:e,depthBuffer:n,type:t},a=new oi(o.width,o.height,s);return r>0&&(a.samples=r),t===ro&&i!==null&&i.outputColorSpace===Rn&&(a.texture.colorSpace=Rn),a.texture.name="EffectComposer.Buffer",a.texture.generateMipmaps=!1,a}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const t=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new De),o=r.getContext().getContextAttributes().alpha,s=this.inputBuffer.texture.type;if(n.setRenderer(r),n.setSize(i.width,i.height),n.initialize(r,o,s),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,n):t.push(n),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const a=this.createDepthTexture();for(n of t)n.setDepthTexture(a)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,t=e.indexOf(n);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const o=(a,u)=>a||u.needsDepthTexture;e.reduce(o,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,t=this.copyPass;let r=this.inputBuffer,i=this.outputBuffer,o=!1,s,a,u;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(e,r,i,n,o),l.needsSwap&&(o&&(t.renderToScreen=l.renderToScreen,s=e.getContext(),a=e.state.buffers.stencil,a.setFunc(s.NOTEQUAL,1,4294967295),t.render(e,r,i,n,o),a.setFunc(s.EQUAL,1,4294967295)),u=r,r=i,i=u),l instanceof $1e?o=!0:l instanceof W1e&&(o=!1))}setSize(n,e,t){const r=this.renderer,i=r.getSize(new De);(n===void 0||e===void 0)&&(n=i.width,e=i.height),(i.width!==n||i.height!==e)&&r.setSize(n,e,t);const o=r.getDrawingBufferSize(new De);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const s of this.passes)s.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),ku.fullscreenGeometry.dispose()}},Lh={NONE:0,DEPTH:1,CONVOLUTION:2},Hn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},X1e=class{constructor(){this.shaderParts=new Map([[Hn.FRAGMENT_HEAD,null],[Hn.FRAGMENT_MAIN_UV,null],[Hn.FRAGMENT_MAIN_IMAGE,null],[Hn.VERTEX_HEAD,null],[Hn.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Lh.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=$a}},cT=!1,Qz=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case jo:t=this.materialsFlatShadedDoubleSide;break;case Mi:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case jo:t=this.materialsDoubleSide;break;case Mi:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof pi))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const o=e[i].value;o.isRenderTargetTexture&&(e[i].value=null,t.set(i,o))}const r=n.clone();for(const i of t)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=yl;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Mi,r}),this.materialsDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=jo,r}),this.materialsFlatShaded=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Mi,r}),this.materialsFlatShadedDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=jo,r})}}render(n,e,t){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,cT){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const o of i)o[0].material=o[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return cT}static set workaroundEnabled(n){cT=n}},Zc=-1,al=class extends Qa{constructor(n,e=Zc,t=Zc,r=1){super(),this.resizable=n,this.baseSize=new De(1,1),this.preferredSize=new De(e,t),this.target=this.preferredSize,this.s=r,this.effectiveSize=new De,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,r=this.scale;e.width!==Zc?t.width=e.width:e.height!==Zc?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*r),e.height!==Zc?t.height=e.height:e.width!==Zc?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Zc),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Zc}},Tn={ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},q1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Y1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,src.a*opacity);}",K1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=(dst.rgb+src.rgb)*0.5;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Z1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.xy,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Q1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/max(b,1e-9))),vec3(1.0),step(1.0,a));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",J1e="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=dst.rgb,b=src.rgb;vec3 c=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",exe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",txe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=abs(dst.rgb-src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",nxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb/max(src.rgb,1e-9);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",rxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-2.0*dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",ixe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb,1.0);vec3 b=min(src.rgb,1.0);vec3 c=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",oxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=step(1.0,dst.rgb+src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",sxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(b.x,a.yz));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",axe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",uxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=src.rgb*max(1.0-dst.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",lxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb,src.rgb);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",cxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",hxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=min(dst.rgb+src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",fxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=clamp(2.0*src.rgb+dst.rgb-1.0,0.0,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",dxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.xy,b.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",pxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb*src.rgb;return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",mxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(1.0-abs(1.0-dst.rgb-src.rgb),0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",vxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return mix(dst,src,opacity);}",gxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=2.0*src.rgb*dst.rgb;vec3 b=1.0-2.0*(1.0-src.rgb)*(1.0-dst.rgb);vec3 c=mix(a,b,step(0.5,dst.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",yxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 c=mix(mix(src2,dst.rgb,step(0.5*dst.rgb,src.rgb)),max(src2-1.0,vec3(0.0)),step(dst.rgb,src2-1.0));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",xxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=min(dst.rgb*dst.rgb/max(1.0-src.rgb,1e-9),1.0);vec3 c=mix(a,src.rgb,step(1.0,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",wxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 a=RGBToHSL(dst.rgb);vec3 b=RGBToHSL(src.rgb);vec3 c=HSLToRGB(vec3(a.x,b.y,a.z));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",_xe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=dst.rgb+src.rgb-min(dst.rgb*src.rgb,1.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",bxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 src2=2.0*src.rgb;vec3 d=dst.rgb+(src2-1.0);vec3 w=step(0.5,src.rgb);vec3 a=dst.rgb-(1.0-src2)*dst.rgb*(1.0-dst.rgb);vec3 b=mix(d*(sqrt(dst.rgb)-dst.rgb),d*dst.rgb*((16.0*dst.rgb-12.0)*dst.rgb+3.0),w*(1.0-step(0.25,dst.rgb)));vec3 c=mix(a,b,w);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Sxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){return src;}",Exe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=max(dst.rgb-src.rgb,0.0);return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Cxe="vec4 blend(const in vec4 dst,const in vec4 src,const in float opacity){vec3 c=mix(max(1.0-min((1.0-dst.rgb)/(2.0*src.rgb),1.0),0.0),min(dst.rgb/(2.0*(1.0-src.rgb)),1.0),step(0.5,src.rgb));return mix(dst,vec4(c,max(dst.a,src.a)),opacity);}",Mxe=new Map([[Tn.ADD,q1e],[Tn.ALPHA,Y1e],[Tn.AVERAGE,K1e],[Tn.COLOR,Z1e],[Tn.COLOR_BURN,Q1e],[Tn.COLOR_DODGE,J1e],[Tn.DARKEN,exe],[Tn.DIFFERENCE,txe],[Tn.DIVIDE,nxe],[Tn.DST,null],[Tn.EXCLUSION,rxe],[Tn.HARD_LIGHT,ixe],[Tn.HARD_MIX,oxe],[Tn.HUE,sxe],[Tn.INVERT,axe],[Tn.INVERT_RGB,uxe],[Tn.LIGHTEN,lxe],[Tn.LINEAR_BURN,cxe],[Tn.LINEAR_DODGE,hxe],[Tn.LINEAR_LIGHT,fxe],[Tn.LUMINOSITY,dxe],[Tn.MULTIPLY,pxe],[Tn.NEGATION,mxe],[Tn.NORMAL,vxe],[Tn.OVERLAY,gxe],[Tn.PIN_LIGHT,yxe],[Tn.REFLECT,xxe],[Tn.SATURATION,wxe],[Tn.SCREEN,_xe],[Tn.SOFT_LIGHT,bxe],[Tn.SRC,Sxe],[Tn.SUBTRACT,Exe],[Tn.VIVID_LIGHT,Cxe]]),Txe=class extends Qa{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new Pn(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return Mxe.get(this.blendFunction)}},SX=class extends Qa{constructor(n,e,{attributes:t=Lh.NONE,blendFunction:r=Tn.NORMAL,defines:i=new Map,uniforms:o=new Map,extensions:s=null,vertexShader:a=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=a,this.defines=i,this.uniforms=o,this.extensions=s,this.blendMode=new Txe(r),this.blendMode.addEventListener("change",u=>this.setChanged()),this._inputColorSpace=$a,this._outputColorSpace=Xo}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=ug){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof oi||e instanceof $i||e instanceof Lr||e instanceof ku)&&this[n].dispose()}}},SD={MEDIUM:2,LARGE:3},Rxe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,Axe="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",Ixe=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],Pxe=class extends pi{constructor(n=new On){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Pn(null),texelSize:new Pn(new On),scale:new Pn(1),kernel:new Pn(0)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Rxe,vertexShader:Axe}),this.setTexelSize(n.x,n.y),this.kernelSize=SD.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return Ixe[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,r=1/e;this.uniforms.texelSize.value.set(t,r,t*.5,r*.5)}},kxe=class extends ku{constructor({kernelSize:n=SD.MEDIUM,resolutionScale:e=.5,width:t=al.AUTO_SIZE,height:r=al.AUTO_SIZE,resolutionX:i=t,resolutionY:o=r}={}){super("KawaseBlurPass"),this.renderTargetA=new oi(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const s=this.resolution=new al(this,i,o,e);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight)),this._blurMaterial=new Pxe,this._blurMaterial.kernelSize=n,this.copyMaterial=new _X}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,r,i){const o=this.scene,s=this.camera,a=this.renderTargetA,u=this.renderTargetB,l=this.blurMaterial,c=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,d=c.length;f<d;++f){const p=f&1?u:a;l.kernel=c[f],l.inputBuffer=h.texture,n.setRenderTarget(p),n.render(o,s),h=p}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(o,s)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==ro?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Rn&&(this.renderTargetA.texture.colorSpace=Rn,this.renderTargetB.texture.colorSpace=Rn))}static get AUTO_SIZE(){return al.AUTO_SIZE}},Dxe=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,Nxe=class extends pi{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:sg.replace(/\D+/g,"")},uniforms:{inputBuffer:new Pn(null),threshold:new Pn(0),smoothing:new Pn(1),range:new Pn(null)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Dxe,vertexShader:wX}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},Lxe=class extends ku{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:r=1,width:i=al.AUTO_SIZE,height:o=al.AUTO_SIZE,resolutionX:s=i,resolutionY:a=o}={}){super("LuminancePass"),this.fullscreenMaterial=new Nxe(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new oi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const u=this.resolution=new al(this,s,a,r);u.addEventListener("change",l=>this.setSize(u.baseWidth,u.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,r,i){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==ro&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},Fxe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,Oxe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",Bxe=class extends pi{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Pn(null),texelSize:new Pn(new De)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Fxe,vertexShader:Oxe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Uxe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,zxe="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",Vxe=class extends pi{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Pn(null),supportBuffer:new Pn(null),texelSize:new Pn(new De),radius:new Pn(.85)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:Uxe,vertexShader:zxe})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},Wxe=class extends ku{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new oi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new Bxe,this.upsamplingMaterial=new Vxe,this.resolution=new De}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const r=e.clone();r.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let t=1,r=n-1;t<r;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,r,i){const{scene:o,camera:s}=this,{downsamplingMaterial:a,upsamplingMaterial:u}=this,{downsamplingMipmaps:l,upsamplingMipmaps:c}=this;let h=e;this.fullscreenMaterial=a;for(let f=0,d=l.length;f<d;++f){const p=l[f];a.setSize(h.width,h.height),a.inputBuffer=h.texture,n.setRenderTarget(p),n.render(o,s),h=p}this.fullscreenMaterial=u;for(let f=c.length-1;f>=0;--f){const d=c[f];u.setSize(h.width,h.height),u.inputBuffer=h.texture,u.supportBuffer=l[f].texture,n.setRenderTarget(d),n.render(o,s),h=d}}setSize(n,e){const t=this.resolution;t.set(n,e);let r=t.width,i=t.height;for(let o=0,s=this.downsamplingMipmaps.length;o<s;++o)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[o].setSize(r,i),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(r,i)}initialize(n,e,t){if(t!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=t;if(t!==ro)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Rn)for(const i of r)i.texture.colorSpace=Rn}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},Hxe=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv)*intensity;}`,Gxe=class extends SX{constructor({blendFunction:n=Tn.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:r=!0,intensity:i=1,radius:o=.85,levels:s=8,kernelSize:a=SD.LARGE,resolutionScale:u=.5,width:l=al.AUTO_SIZE,height:c=al.AUTO_SIZE,resolutionX:h=l,resolutionY:f=c}={}){super("BloomEffect",Hxe,{blendFunction:n,uniforms:new Map([["map",new Pn(null)],["intensity",new Pn(i)]])}),this.renderTarget=new oi(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new kxe({kernelSize:a}),this.luminancePass=new Lxe({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new Wxe,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=s,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const d=this.resolution=new al(this,h,f,u);d.addEventListener("change",p=>this.setSize(d.baseWidth,d.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,n!==null&&n.outputColorSpace===Rn&&(this.renderTarget.texture.colorSpace=Rn))}},$xe=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,jxe="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",Xxe=class extends SX{constructor({offset:n=new De(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",$xe,{vertexShader:jxe,attributes:Lh.CONVOLUTION,uniforms:new Map([["offset",new Pn(n)],["modulationOffset",new Pn(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},qxe=class extends ku{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new bX,this.overrideMaterialManager=t===null?null:new Qz(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Qz(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,r,i){const o=this.scene,s=this.camera,a=this.selection,u=s.layers.mask,l=o.background,c=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;a!==null&&s.layers.set(a.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,o,s):n.render(o,s),s.layers.mask=u,o.background=l,n.shadowMap.autoUpdate=c}},Yxe=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,Kxe="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",Zxe=class extends pi{constructor(n,e,t,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:sg.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Pn(null),depthBuffer:new Pn(null),resolution:new Pn(new De),texelSize:new Pn(new De),cameraNear:new Pn(.3),cameraFar:new Pn(1e3),aspect:new Pn(1),time:new Pn(0)},blending:Qo,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=ug){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=Yxe.replace(Hn.FRAGMENT_HEAD,n.get(Hn.FRAGMENT_HEAD)||"").replace(Hn.FRAGMENT_MAIN_UV,n.get(Hn.FRAGMENT_MAIN_UV)||"").replace(Hn.FRAGMENT_MAIN_IMAGE,n.get(Hn.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=Kxe.replace(Hn.VERTEX_HEAD,n.get(Hn.VERTEX_HEAD)||"").replace(Hn.VERTEX_MAIN_SUPPORT,n.get(Hn.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof Si?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return Hn}};function Jz(n,e,t){for(const r of e){const i="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),o=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const s of t.entries())s[1]!==null&&t.set(s[0],s[1].replace(o,i))}}function Qxe(n,e,t){let r=e.getFragmentShader(),i=e.getVertexShader();const o=r!==void 0&&/mainImage/.test(r),s=r!==void 0&&/mainUv/.test(r);if(t.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(s&&t.attributes&Lh.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!s)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const a=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,u=t.shaderParts;let l=u.get(Hn.FRAGMENT_HEAD)||"",c=u.get(Hn.FRAGMENT_MAIN_UV)||"",h=u.get(Hn.FRAGMENT_MAIN_IMAGE)||"",f=u.get(Hn.VERTEX_HEAD)||"",d=u.get(Hn.VERTEX_MAIN_SUPPORT)||"";const p=new Set,v=new Set;if(s&&(c+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const x=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);d+=`	${n}MainSupport(`,d+=x?`vUv);
`:`);
`;for(const _ of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const b of _[1].split(/\s*,\s*/))t.varyings.add(b),p.add(b),v.add(b);for(const _ of i.matchAll(a))v.add(_[1])}for(const x of r.matchAll(a))v.add(x[1]);for(const x of e.defines.keys())v.add(x.replace(/\([\w\s,]*\)/g,""));for(const x of e.uniforms.keys())v.add(x);v.delete("while"),v.delete("for"),v.delete("if"),e.uniforms.forEach((x,_)=>t.uniforms.set(n+_.charAt(0).toUpperCase()+_.slice(1),x)),e.defines.forEach((x,_)=>t.defines.set(n+_.charAt(0).toUpperCase()+_.slice(1),x));const g=new Map([["fragment",r],["vertex",i]]);Jz(n,v,t.defines),Jz(n,v,g),r=g.get("fragment"),i=g.get("vertex");const m=e.blendMode;if(t.blendModes.set(m.blendFunction,m),o){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Rn?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==Xo?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,t.attributes&Lh.DEPTH&&x.test(r)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const _=n+"BlendOpacity";t.uniforms.set(_,m.opacity),h+=`color0 = blend${m.blendFunction}(color0, color1, ${_});

	`,l+=`uniform float ${_};

`}if(l+=r+`
`,i!==null&&(f+=i+`
`),u.set(Hn.FRAGMENT_HEAD,l),u.set(Hn.FRAGMENT_MAIN_UV,c),u.set(Hn.FRAGMENT_MAIN_IMAGE,h),u.set(Hn.VERTEX_HEAD,f),u.set(Hn.VERTEX_MAIN_SUPPORT,d),e.extensions!==null)for(const x of e.extensions)t.extensions.add(x)}}var Jxe=class extends ku{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new Zxe(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new X1e;let e=0;for(const s of this.effects)if(s.blendMode.blendFunction===Tn.DST)n.attributes|=s.getAttributes()&Lh.DEPTH;else{if(n.attributes&s.getAttributes()&Lh.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${s.name})`);Qxe("e"+e++,s,n)}let t=n.shaderParts.get(Hn.FRAGMENT_HEAD),r=n.shaderParts.get(Hn.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(Hn.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const s of n.blendModes.values())t+=s.getShaderCode().replace(o,`blend${s.blendFunction}`)+`
`;n.attributes&Lh.DEPTH?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Rn&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(Hn.FRAGMENT_HEAD,t),n.shaderParts.set(Hn.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set(Hn.FRAGMENT_MAIN_UV,i);for(const[s,a]of n.shaderParts)a!==null&&n.shaderParts.set(s,a.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=ug){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,r,i){for(const o of this.effects)o.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const r of this.effects)r.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==ro&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $I=function(n,e){return $I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},$I(n,e)};function rn(n,e){$I(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var _u=function(){return _u=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},_u.apply(this,arguments)};function Ot(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(c){try{l(r.next(c))}catch(h){s(h)}}function u(c){try{l(r.throw(c))}catch(h){s(h)}}function l(c){c.done?o(c.value):i(c.value).then(a,u)}l((r=r.apply(n,[])).next())})}function Bt(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function hT(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var EX=function(n,e){return(EX=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Cc(n,e){function t(){this.constructor=n}EX(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Zt(n,e,t,r){return new(t||(t=Promise))(function(i,o){function s(l){try{u(r.next(l))}catch(c){o(c)}}function a(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(s,a)}u((r=r.apply(n,[])).next())})}function Qt(n,e){var t,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(n,s)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var e2e=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t=t2e(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(function(r){var i=r.split(":"),o=i[0],s=i[1];e.urlFlags[o]=function(a,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+a+".")}(o,s)})}},n}();function t2e(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return function(o,s,a){o[decodeURIComponent(s)]=decodeURIComponent(a||"")}(e,r[0],r[1]),r.join("=")}),e}var Ce=null;function n2e(n){Ce=n}function jI(n,e,t){return Math.max(n,Math.min(e,t))}function CX(n){return n%2==0?n:n+1}function r2e(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function oe(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function rr(n,e,t){t===void 0&&(t=""),oe(Po(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function gg(n){oe(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Xv(n,e){if(e===void 0&&(e=[]),e==null&&(e=[]),Array.isArray(n)||lc(n))for(var t=0;t<n.length;++t)Xv(n[t],e);else e.push(n);return e}function Vt(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Po(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ja(n){return n%1==0}function i2e(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function XI(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function dv(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function e6(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(n())r();else{var a=e(++o);t!=null&&o>=t?i():setTimeout(s,a)}};s()})}function o2e(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function ao(n,e){var t=e.length;return oe((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),oe(n.every(function(r){return ja(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function nd(n,e){for(var t=[],r=[],i=e==null?null:ao(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function qI(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function qb(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function s2e(n,e,t){if(e==="float32")for(var r=0;r<n.length;r++){var i=n[r];if(isNaN(i)||!isFinite(i))throw Error("The result of the '"+t+"' is "+i+".")}}function a2e(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function u2e(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function l2e(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function lc(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function MX(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function c2e(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=2*t.length}),e}function TX(n){return typeof n=="string"||n instanceof String}function h2e(n){return typeof n=="boolean"}function f2e(n){return typeof n=="number"}function tx(n){return Array.isArray(n)?tx(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":f2e(n)?"float32":TX(n)?"string":h2e(n)?"bool":"float32"}function YI(n){return!!(n&&n.constructor&&n.call&&n.apply)}function KI(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function ap(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function RX(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Xv(n)),t&&a2e(n,e),function(o,s){return o instanceof Float32Array&&s==="float32"||o instanceof Int32Array&&s==="int32"||o instanceof Uint8Array&&s==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function t6(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)a[l]=s[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(f,d){return f*d});for(l=0;l<u;l++)a[l]=r(i+l*h,c,s)}return a}(0,n,e)}function AX(n,e){for(var t=nx(n,e),r=0;r<t.length;r++)t[r]=1;return t}function nx(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Yb(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function IX(n){n.forEach(function(e){oe(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function PX(n,e){return Ce.platform.fetch(n,e)}var d2e=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new p2e)}return n.prototype.profileKernel=function(e,t){var r,i=this,o=this.backendTimer.time(function(){r=t()});return(Array.isArray(r)?r:[r]).forEach(function(s){var a=s.dataSync();s2e(a,s.dtype,e),o.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),i.logger.logKernelProfile(e,s,a,u.kernelMs,l)})}),r},n}(),p2e=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o){var s=dv(i+"ms",9),a=dv(e,25),u=t.rank,l=t.size,c=dv(t.shape.toString(),14);console.log("%c"+a+"	%c"+s+"	%c"+u+"D "+c+"	%c"+l+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},n}(),n6=20,m0=3,fT=7;function m2e(n,e,t,r){var i=ap(e),o=function(l,c,h,f){var d=Vt(c),p=f[f.length-1],v=new Array(p).fill(0),g=c.length,m=h==="complex64"?g0(l):l;if(g>1)for(var x=0;x<d/p;x++)for(var _=x*p,b=0;b<p;b++)v[b]=Math.max(v[b],v0(m[_+b],0,h).length);return v}(n,e,t,i),s=e.length,a=function l(c,h,f,d,p,v){v===void 0&&(v=!0);var g=f==="complex64"?2:1,m=h[0],x=h.length;if(x===0){if(f==="complex64"){var _=g0(c);return[v0(_[0],0,f)]}return f==="bool"?[kX(c[0])]:[c[0].toString()]}if(x===1){if(m>n6){var b=m0*g,S=Array.from(c.slice(0,b)),E=Array.from(c.slice(m-m0*g,m));return f==="complex64"&&(S=g0(S),E=g0(E)),["["+S.map(function(V,F){return v0(V,p[F],f)}).join(", ")+", ..., "+E.map(function(V,F){return v0(V,p[m-m0+F],f)}).join(", ")+"]"]}var C=f==="complex64"?g0(c):Array.from(c);return["["+C.map(function(V,F){return v0(V,p[F],f)}).join(", ")+"]"]}var R=h.slice(1),T=d.slice(1),A=d[0]*g,P=[];if(m>n6){for(var k=0;k<m0;k++){var W=k*A,N=W+A;P.push.apply(P,l(c.slice(W,N),R,f,T,p,!1))}P.push("...");for(var k=m-m0;k<m;k++){var W=k*A,N=W+A;P.push.apply(P,l(c.slice(W,N),R,f,T,p,k===m-1))}}else for(var k=0;k<m;k++){var W=k*A,N=W+A;P.push.apply(P,l(c.slice(W,N),R,f,T,p,k===m-1))}var O=x===2?",":"";P[0]="["+P[0]+O;for(var k=1;k<P.length-1;k++)P[k]=" "+P[k]+O;for(var z=`,
`,k=2;k<x;k++)z+=`
`;return P[P.length-1]=" "+P[P.length-1]+"]"+(v?"":z),P}(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+s),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function v0(n,e,t){return dv(Array.isArray(n)?parseFloat(n[0].toFixed(fT))+" + "+parseFloat(n[1].toFixed(fT))+"j":TX(n)?"'"+n+"'":t==="bool"?kX(n):parseFloat(n.toFixed(fT)).toString(),e)}function kX(n){return n===0?"false":"true"}function g0(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var _1=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=Vt(e),r!=null){var o=r.length;oe(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||qb(t,this.size),this.strides=ap(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),oe(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return at.make(this.shape,{values:this.values},this.dtype)},n}(),Ys=null,Fe=null,DX=null,at=function(){function n(e,t,r,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Vt(e),this.strides=ap(e),this.dataId=i??{},this.id=Ys().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ys().registerTensor(this,o),r!=null&&Ys().write(o,this.dataId,r)}return n.make=function(e,t,r,i){return new n(e,r,t.values,t.dataId,i)},n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),oe(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),Fe.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Zt(this,void 0,void 0,function(){var e;return Qt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Fe.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Fe.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Zt(this,void 0,void 0,function(){var e;return Qt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,t6(this.shape,e)]}})})},n.prototype.arraySync=function(){return t6(this.shape,this.dataSync())},n.prototype.data=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(e){return this.throwIfDisposed(),[2,Ys().read(this.dataId)]})})},n.prototype.dataSync=function(){return this.throwIfDisposed(),Ys().readSync(this.dataId)},n.prototype.dispose=function(){this.isDisposed||(Ys().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Fe.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Fe.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Fe.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Fe.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Fe.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Fe.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),Fe.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),m2e(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),Fe.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Fe.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Fe.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Fe.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Fe.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Fe.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Fe.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Fe.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Fe.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Fe.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Fe.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),Fe.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),DX("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),Fe.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Fe.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Fe.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Fe.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Fe.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),Fe.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Fe.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Fe.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Fe.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Fe.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Fe.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Fe.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Fe.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Fe.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),Fe.div(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Fe.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Fe.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Fe.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Fe.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Fe.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Fe.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Fe.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Fe.modStrict(this,e)},n.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Fe.squaredDifference(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Fe.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),Fe.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Fe.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Fe.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Fe.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Fe.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Fe.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Fe.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Fe.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Fe.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Fe.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Fe.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Fe.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Fe.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Fe.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Fe.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Fe.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Fe.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Fe.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Fe.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Fe.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Fe.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Fe.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Fe.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Fe.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Fe.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Fe.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Fe.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Fe.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Fe.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Fe.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Fe.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Fe.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Fe.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Fe.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Fe.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Fe.relu(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Fe.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Fe.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Fe.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Fe.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Fe.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Fe.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Fe.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Fe.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Fe.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Fe.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Fe.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Fe.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Fe.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Fe.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Fe.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Fe.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Fe.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Fe.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Fe.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Fe.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Fe.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Fe.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Fe.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Fe.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Fe.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Fe.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Fe.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Fe.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,s){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Fe.conv1d(this,e,t,r,i,o,s)},n.prototype.conv2d=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Fe.conv2d(this,e,t,r,i,o,s)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),Fe.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Fe.depthwiseConv2d(this,e,t,r,i,o,s)},n.prototype.separableConv2d=function(e,t,r,i,o,s){return o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),Fe.separableConv2d(this,e,t,r,i,o,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),Fe.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),Fe.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),Fe.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),Fe.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),rx.variable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Fe.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Fe.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Fe.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Fe.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,u){return i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),this.throwIfDisposed(),Fe.stridedSlice(this,e,t,r,i,o,s,a,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Fe.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Fe.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Fe.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Fe.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Fe.spectral.irfft(this)},n}();Object.defineProperty(at,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var rx=function(n){function e(t,r,i){r===void 0&&(r=!0);var o=n.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=r,o.name=i,o.name==null&&(o.name=Ys().nextVariableId().toString());try{Ys().registerVariable(o)}catch(s){throw Ys().disposeTensor(o),s}return o}return Cc(e,n),e.variable=function(t,r,i,o){return r===void 0&&(r=!0),o!=null&&o!==t.dtype&&(t=t.asType(o)),new e(t,r,i)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Po(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ys().disposeTensor(this),this.dataId=t.dataId,Ys().registerTensor(this)},e.prototype.dispose=function(){Ys().disposeVariable(this),this.isDisposedInternal=!0},e}(at);Object.defineProperty(rx,Symbol.hasInstance,{value:function(n){return n instanceof at&&n.assign!=null&&n.assign instanceof Function}});var r6,ZI,QI,JI,e4;rx.variable;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(r6||(r6={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(ZI||(ZI={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(QI||(QI={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(JI||(JI={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(e4||(e4={}));var v2e={float32:JI,int32:ZI,bool:QI,complex64:e4};function bi(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return v2e[n][e]}function dT(n){return bi(n,"int32")}function Ai(n,e){if(n.dtype===e.dtype)return[n,e];var t=bi(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function g2e(n,e){oe(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function NX(n){var e=[];return function t(r,i,o){if(r!=null){if(r instanceof at)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,a=r;for(var u in a){var l=a[u];o.has(l)||(o.add(l),t(l,i,o))}}}}(n,e,new Set),e}var pT,i6=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),y2e=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new i6}return n.prototype.ready=function(){return Zt(this,void 0,void 0,function(){var e,t,r;return Qt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Zt(this,void 0,void 0,function(){var t,r,i;return Qt(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.profiler=new d2e(this.backendInstance),[2,!0]}})})},n.prototype.initializeBackend=function(e){var t=this,r=Se.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)}).catch(function(a){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,s=i.asyncInit;if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){this.write(e,t,this.readSync(t))},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=at.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(r){return[r.toFloat()]}),t},n.prototype.runKernel=function(e,t,r){var i,o=this,s=[],a=this.isTapeOn(),u=this.state.activeScope!=null?this.state.activeScope.name:"",l=function(d){a&&(s=d.map(function(p){return o.keep(o.clone(p))}))},c=this.state.numBytes,h=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){i=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(u,function(){return e(o.backend,l)}):e(o.backend,l)}),a){var f={id:this.state.nextTapeNodeId++,name:u,inputs:t,outputs:Array.isArray(i)?i:[i],saved:s};r!=null&&(f.gradient=function(d){return r(d,s)}),this.state.activeTape.push(f)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(d){return t[d].shape}),outputShape:Array.isArray(i)?i.map(function(d){return d.shape}):i.shape}),i},n.prototype.registerTensor=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*MX(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t??this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i,t!=null?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof rx||this.track(e)},n.prototype.registerVariable=function(e){if(this.state.registeredVariables[e.name]!=null)throw new Error("Variable with name "+e.name+" was already registered");this.state.registeredVariables[e.name]=e},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Zt(this,void 0,void 0,function(){var t,r;return Qt(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r){var i={};e.forEach(function(s,a){i[a]=s});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:i,outputs:[t],gradient:function(s){var a=r(s),u={};return a.forEach(function(l,c){u[c]=function(){return l}}),u}};this.state.activeTape.push(o)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=NX(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),oe(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});oe(s instanceof at,function(){return"The result y returned by f() must be a tensor."});var a=function(u,l,c){for(var h={},f={},d=0;d<l.length;d++)h[l[d].id]=!0;for(d=0;d<u.length;d++){var p=(E=u[d]).inputs;for(var v in p){for(var g=p[v],m=!1,x=0;x<l.length;x++)if(h[g.id]){E.outputs.forEach(function(A){return h[A.id]=!0}),m=!0,f[E.id]=!0;break}if(m)break}}var _={};_[c.id]=!0;var b={};for(d=u.length-1;d>=0;d--)for(p=(E=u[d]).inputs,x=0;x<E.outputs.length;x++)if(_[E.outputs[x].id]){for(var v in p)_[p[v].id]=!0,b[E.id]=!0;break}var S=[];for(d=0;d<u.length;d++){var E;if(f[(E=u[d]).id]&&b[E.id]){var C={};for(var v in E.inputs){var R=E.inputs[v];h[R.id]&&(C[v]=R)}var T=Object.assign({},E);T.inputs=C,T.outputs=E.outputs,S.push(T)}}return S}(this.state.activeTape,t,s);if(!i&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[s.id]=r??(u=s.shape,l=AX(Vt(u),"float32"),at.make(u,{values:l})),function(f,d,p){for(var v=function(m){var x=d[m],_=[];if(x.outputs.forEach(function(C){var R=f[C.id];if(R!=null)_.push(R);else{var T=at.make(C.shape,{values:nx(C.size,C.dtype)},C.dtype);_.push(T)}}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.name+".");var b=x.gradient(x.outputs.length===1?_[0]:_),S=function(C){if(!(C in b))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(b)+".");var R=p(function(){return b[C]()});if(R.dtype!=="float32")throw new Error("Error in gradient for op "+x.name+". The gradient of input "+C+" must have 'float32' dtype, but has '"+R.dtype+"'");var T=x.inputs[C];if(!Po(R.shape,T.shape))throw new Error("Error in gradient for op "+x.name+". The gradient of input '"+C+"' has shape '"+R.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=R;else{var A=f[T.id];f[T.id]=A.add(R),A.dispose()}};for(var E in x.inputs)S(E)},g=d.length-1;g>=0;g--)v(g)}(c,a,function(f){return o.tidy(f)});var h=t.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var d in f.saved)f.saved[d].dispose()}),o.state.activeTape=null),{value:s,grads:h}})},n.prototype.customGrad=function(e){var t=this;return oe(YI(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];oe(i.every(function(a){return a instanceof at}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),t.runKernel(function(a,u){return oe((r=e.apply(void 0,i.concat([u]))).value instanceof at,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),oe(YI(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];oe(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),oe(c.every(function(f){return f instanceof at}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,d){h[d]=function(){return f}}),h})}},n.prototype.write=function(e,t,r){var i=this.state.tensorInfo.get(t),o=i.backend;if(e=e||this.backend,i.dtype==="string"){var s=c2e(r);this.state.numBytes+=s-i.bytes,i.bytes=s}e!==o&&(o.disposeData(t),i.backend=e,e.register(t,i.shape,i.dtype)),e.write(t,r)},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},n.prototype.time=function(e){return Zt(this,void 0,void 0,function(){var t,r;return Qt(this,function(i){switch(i.label){case 0:return t=Yb(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Yb()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new i6,this.registry)this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),Se=function(){var n=function(){if(pT==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}pT=t}return pT}();if(n._tfengine==null){var e=new e2e(n);n._tfengine=new y2e(e)}return n2e(n._tfengine.ENV),Ys=function(){return n._tfengine},n._tfengine}();function LX(){return typeof window<"u"||typeof WorkerGlobalScope<"u"}Ce.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Ce.registerFlag("IS_BROWSER",function(){return LX()}),Ce.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Ce.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Ce.registerFlag("PROD",function(){return!1}),Ce.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Ce.getBool("DEBUG")}),Ce.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Ce.registerFlag("IS_TEST",function(){return!1});var Zf={},mT={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function x2e(n,e){Zf[n]=e}function Sl(n){n in Zf||(Zf[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Zf[t]},!1),t===1?r.getContext("webgl",mT)||r.getContext("experimental-webgl",mT):r.getContext("webgl2",mT)}(n));var e=Zf[n];return e.isContextLost()?(delete Zf[n],Sl(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Zf[n])}function Pt(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+S2e(i,o))}(n),r}var w2e=596e-10,_2e=65504;function b2e(n){return!!(Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||w2e<Math.abs(n)&&Math.abs(n)<_2e)}function S2e(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function $w(n,e,t){return Mc(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function E2e(n,e,t){var r=Mc(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Pt(n,e,function(){return n.shaderSource(r,t)}),Pt(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function C2e(n,e,t){var r=Mc(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Pt(n,e,function(){return n.shaderSource(r,t)}),Pt(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(i,o){var s=M2e.exec(o);if(s==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,m){return dv((m+1).toString(),l)+g}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var d=c.slice(0,a-1),p=c.slice(a-1,a),v=c.slice(a);console.log(d.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+dv(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var vT,gT,M2e=/ERROR: [0-9]+:([0-9]+):/g;function T2e(n,e){return Mc(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function R2e(n,e,t){if(Pt(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function yT(n,e,t){if(Pt(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function A2e(n,e,t){var r=Mc(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Pt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Pt(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function I2e(n,e,t){var r=Mc(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Pt(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Pt(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function P2e(n,e){return Mc(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function k2e(n,e){var t=Ce.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function D2e(n,e){return Mc(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function o6(n,e,t,r,i,o,s,a){var u=n.getAttribLocation(t,r);return u!==-1&&(Pt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Pt(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,s,a)}),Pt(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function N2e(n,e,t,r){U2e(n,r),Pt(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function L2e(n,e,t,r){return Mc(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function F2e(n,e,t){return n.getUniformLocation(e,t)}function O2e(n,e,t,r,i,o){Pt(n,e,function(){return N2e(n,e,r,o)}),Pt(n,e,function(){return n.uniform1i(i,o)})}function xT(n,e,t,r){Pt(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Pt(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function s6(n,e,t){Pt(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Pt(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function jw(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+B2e(n,e))}function B2e(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Mc(n,e,t,r){var i=Pt(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function U2e(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function Kb(n,e){return e===void 0&&(e=2),Vt(n.slice(0,n.length-e))}function Zb(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function wT(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[Kb(n)].concat(Zb(n))),e}function z2e(n,e){var t;e===void 0&&(e=!1);var r=Ce.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?CX(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=nd(n);n=i.newShape}var o=Vt(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=Kb(n),a=2,u=2;return n.length&&(a=(t=Zb(n))[0],u=t[1]),XI(o=s*(a/2)*(u/2)).map(function(l){return 2*l})}return XI(o)}function Xw(n){return n%2==0}function qw(n,e){if(Po(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Xw(t)&&Xw(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Xw(n[0])&&Xw(e[0])}function V2e(n){if(vT==null){var e=Sl(n);vT=e.getParameter(e.MAX_TEXTURE_SIZE)}return vT}function W2e(n){if(gT==null){var e=Sl(n);gT=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,gT)}function H2e(n){if(n===0)return 0;var e=Sl(n);return Ld(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Ld(e,"EXT_disjoint_timer_query")?1:0}function Ld(n,e){return n.getExtension(e)!=null}function a6(n){try{if(Sl(n)!=null)return!0}catch{return!1}return!1}function G2e(n){if(n===0)return!1;var e=Sl(n);if(n===1){if(!Ld(e,"OES_texture_float"))return!1}else if(!Ld(e,"EXT_color_buffer_float"))return!1;return FX(e,n)}function $2e(n){if(n===0)return!1;var e=Sl(n);if(n===1){if(!Ld(e,"OES_texture_float")||!Ld(e,"WEBGL_color_buffer_float"))return!1}else if(!Ld(e,"EXT_color_buffer_float"))return!1;return FX(e,n)}function FX(n,e){var t=n.createFramebuffer(),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var i=e===2?n.RGBA32F:n.RGBA;n.texImage2D(n.TEXTURE_2D,0,i,1,1,0,n.RGBA,n.FLOAT,null),n.bindFramebuffer(n.FRAMEBUFFER,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(t),o}function j2e(n){return n===2&&Sl(n).fenceSync!=null}function OX(n){Ce.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ft(n,e){return Se.tidy(n,e)}function Ts(n){NX(n).forEach(function(e){return e.dispose()})}function X2e(n){return Se.keep(n)}function t4(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ce.getBool("IS_TEST")||console.warn.apply(console,n)}function ff(n){var e=n;if(lc(n))return[n.length];if(!Array.isArray(n))return[];for(var t=[];Array.isArray(e)||lc(e);)t.push(e.length),e=e[0];return Array.isArray(n)&&Ce.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function r(i,o,s){if(s=s||[],!Array.isArray(i)&&!lc(i))return void oe(o.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});oe(o.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),oe(i.length===o[0],function(){return"Element arr["+s.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"});for(var a=o.slice(1),u=0;u<i.length;++u)r(i[u],a,s.concat(u))}(n,t,[]),t}function u6(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function te(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof at)return u6(r,n.dtype,e,t),n;var i=tx(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),u6(r,i,e,t),n==null||!lc(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var s=ff(n);lc(n)||Array.isArray(n)||(n=[n]);var a=i!=="string"?RX(n,i,Ce.getBool("DEBUG")):Xv(n);return at.make(s,{values:a},i)}function Qb(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return te(i,e+"["+o+"]",t)},r)}function BX(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function q2e(n,e,t){for(var r=n.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)t.indexOf(a)===-1?i.push(n[o++]):i.push(e[s++]);return i}function wo(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function Xa(n,e){return q2e(n,e.map(function(t){return 1}),e)}function js(n,e,t){oe(BX(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function El(n,e){if(BX(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function ED(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Cl(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function Y2e(n,e){var t=n[0].length;n.forEach(function(i,o){oe(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),oe(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var s=0;s<t;s++)oe(s===e||i[s]===r[s],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function qv(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function he(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];Se.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Se.endScope(a),a}catch(u){throw Se.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Ce.registerFlag("HAS_WEBGL",function(){return Ce.getNumber("WEBGL_VERSION")>0}),Ce.registerFlag("WEBGL_VERSION",function(){return a6(2)?2:a6(1)?1:0}),Ce.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ce.get("WEBGL_VERSION")===2}),Ce.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ce.registerFlag("WEBGL_PACK",function(){return Ce.getBool("HAS_WEBGL")}),Ce.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_PACK_CLIP",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ce.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_PACK_REDUCE",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_CONV_IM2COL",function(){return Ce.getBool("WEBGL_PACK")}),Ce.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return V2e(Ce.getNumber("WEBGL_VERSION"))}),Ce.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return W2e(Ce.getNumber("WEBGL_VERSION"))}),Ce.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ce.getNumber("WEBGL_VERSION");return n===0?0:H2e(n)}),Ce.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Ce.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return G2e(Ce.getNumber("WEBGL_VERSION"))}),Ce.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return $2e(Ce.getNumber("WEBGL_VERSION"))}),Ce.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return j2e(Ce.getNumber("WEBGL_VERSION"))}),Ce.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),DX=OX;var $o=he({complex_:function(n,e){var t=te(n,"real","complex"),r=te(e,"imag","complex");return rr(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),Se.runKernel(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),ul=he({real_:function(n){var e=te(n,"input","real");return Se.runKernel(function(t){return t.real(e)},{$input:e})}}),yh=he({imag_:function(n){var e=te(n,"input","imag");return Se.runKernel(function(t){return t.imag(e)},{$input:e})}});function ls(n,e,t){return df(n,e,ff(n),t)}function df(n,e,t,r){if(r==null&&(r=tx(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!lc(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){IX(e);var i=Vt(e),o=Vt(t);oe(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<t.length;++s){var a=t[s],u=s!==t.length-1||a!==Vt(e.slice(s));oe(t[s]===e[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return lc(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?RX(n,r,Ce.getBool("DEBUG")):Xv(n),at.make(e,{values:n},r)}function pt(n,e){if((lc(n)||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return df(n,[],[],e)}function fs(n,e){gg(n);var t=ff(n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return df(n,null,t,e)}function ix(n,e,t){if(gg(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=ff(n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return df(n,e,r,t)}function CD(n,e,t){if(gg(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=ff(n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return df(n,e,r,t)}function fu(n,e,t){if(gg(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=ff(n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return df(n,e,r,t)}function K2e(n,e,t){if(gg(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=ff(n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return df(n,e,r,t)}function Z2e(n,e,t){if(gg(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=ff(n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return df(n,e=e||r,r,t)}function yg(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=yg(n,"float32"),r=Mr(n,"float32");return $o(t,r)}var i=AX(Vt(n),e);return at.make(n,{values:i},e)}function Mr(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Mr(n,"float32"),r=Mr(n,"float32");return $o(t,r)}var i=nx(Vt(n),e);return at.make(n,{values:i},e)}function pv(n,e,t){return Se.runKernel(function(r){return r.fill(n,e,t)},{})}function Q2e(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return Se.runKernel(function(r){return r.linspace(n,e,t)},{})}function UX(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Mr([0],r);var i=nx(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return fs(i,r)}var zX=he({onesLike_:function(n){var e=te(n,"x","onesLike");if(e.dtype==="complex64"){var t=zX(ul(e)),r=Un(yh(e));return $o(t,r)}return Se.runKernel(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return Un(i)}}})}}),Un=he({zerosLike_:function(n){var e=te(n,"x","zerosLike");return Se.runKernel(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return Un(t)}}})}}),ko=he({concat_:function(n,e){e===void 0&&(e=0),oe(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Qb(n,"tensors","concat");e=ao(e,t[0].shape)[0];var r=qv(t.map(function(s){return s.shape}),e);if(Vt(r)===0)return ls([],r);if((t=t.filter(function(s){return s.size>0})).length===1)return t[0];var i=t.map(function(s){return s.shape});Y2e(i,e);var o=t;return Se.runKernel(function(s){return s.concat(t,e)},o,function(s){var a=i.map(function(u){return u[e]});return MD(s,a,e).map(function(u){return function(){return u}})})}}),J2e=he({concat1d_:function(n){return ko(n,0)}}),ewe=he({concat2d_:function(n,e){return ko(n,e)}}),twe=he({concat3d_:function(n,e){return ko(n,e)}}),nwe=he({concat4d_:function(n,e){return ko(n,e)}}),MD=he({split_:function(n,e,t){t===void 0&&(t=0);var r,i=te(n,"x","split");return t=ao(t,i.shape)[0],typeof e=="number"?(oe(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(oe(i.shape[t]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),Se.runKernel(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return ko(o,t)}}})}});function up(n,e){return n(e={exports:{}},e.exports),e.exports}var rwe=up(function(n){(function(e,t,r){function i(a){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var d=.02519603282416938*(u+=h.charCodeAt(f));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var l=new i(a),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.alea=s})(0,n)}),iwe=up(function(n){(function(e,t,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xor128=s})(0,n)}),owe=up(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xorwow=s})(0,n)}),swe=up(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xorshift7=s})(0,n)}),awe=up(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,d=u.i;return u.w=h=h+1640531527|0,c=f[d+34&127],l=f[d=d+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[d]=c^l,u.i=d,c+(h^h>>>16)|0},function(l,c){var h,f,d,p,v,g=[],m=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,m=Math.max(m,c.length)),d=0,p=-32;p<m;++p)c&&(f^=c.charCodeAt((p+32)%c.length)),p===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(v=v+1640531527|0,d=(h=g[127&p]^=f+v)==0?d+1:0);for(d>=128&&(g[127&(c&&c.length||0)]=-1),d=127,p=512;p>0;--p)f=g[d+34&127],h=g[d=d+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,g[d]=f^h;l.w=v,l.X=g,l.i=d}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xor4096=s})(0,n)}),uwe=up(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var h=u.b,f=u.c,d=u.d,p=u.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-d|0,u.d=d<<16^f>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):l+=a;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.tychei=s})(0,n)}),Qf=up(function(n){(function(e,t){var r,i=this,o=256,s=6,a="random",u=t.pow(o,s),l=t.pow(2,52),c=2*l,h=o-1;function f(m,x,_){var b=[],S=v(function R(T,A){var P,k=[],W=typeof T;if(A&&W=="object")for(P in T)try{k.push(R(T[P],A-1))}catch{}return k.length?k:W=="string"?T:T+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[m,g(e)]:m??function(){try{var R;return r&&(R=r.randomBytes)?R=R(o):(R=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(R)),g(R)}catch{var T=i.navigator,A=T&&T.plugins;return[+new Date,i,A,i.screen,g(e)]}}(),3),b),E=new d(b),C=function(){for(var R=E.g(s),T=u,A=0;R<l;)R=(R+A)*o,T*=o,A=E.g(1);for(;R>=c;)R/=2,T/=2,A>>>=1;return(R+A)/T};return C.int32=function(){return 0|E.g(4)},C.quick=function(){return E.g(4)/4294967296},C.double=C,v(g(E.S),e),(x.pass||_||function(R,T,A,P){return P&&(P.S&&p(P,E),R.state=function(){return p(E,{})}),A?(t[a]=R,T):R})(C,S,"global"in x?x.global:this==t,x.state)}function d(m){var x,_=m.length,b=this,S=0,E=b.i=b.j=0,C=b.S=[];for(_||(m=[_++]);S<o;)C[S]=S++;for(S=0;S<o;S++)C[S]=C[E=h&E+m[S%_]+(x=C[S])],C[E]=x;(b.g=function(R){for(var T,A=0,P=b.i,k=b.j,W=b.S;R--;)T=W[P=h&P+1],A=A*o+W[h&(W[P]=W[k=h&k+T])+(W[k]=T)];return b.i=P,b.j=k,A})(o)}function p(m,x){return x.i=m.i,x.j=m.j,x.S=m.S.slice(),x}function v(m,x){for(var _,b=m+"",S=0;S<b.length;)x[h&S]=h&(_^=19*x[h&S])+b.charCodeAt(S++);return g(x)}function g(m){return String.fromCharCode.apply(0,m)}if(t["seed"+a]=f,v(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Qf.alea=rwe,Qf.xor128=iwe,Qf.xorwow=owe,Qf.xorshift7=swe,Qf.xor4096=awe,Qf.tychei=uwe;var TD=Qf.alea,VX=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=TD(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s;while(a>=1||a===0);var u=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),lwe=function(){function n(e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1);var o=this;if(this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=TD(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function xn(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",IX(n),new _1(n,e,t)}function cwe(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var WX=he({batchToSpaceND_:function(n,e,t){var r=te(n,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return oe(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),oe(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),oe(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),Se.runKernel(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),hwe=he({cast_:function(n,e){var t=te(n,"x","cast");if(!u2e(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");return Se.runKernel(function(r){return r.cast(t,e)},{$x:t},function(r){return{$x:function(){return r.clone()}}})}}),fwe=he({clone_:function(n){var e=te(n,"x","clone",null);return Se.runKernel(function(t){return at.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),dwe=he({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=te(n,"x","cumsum"),o=El([e|=0],i.rank),s=i;o!=null&&(s=i.transpose(o));var a=Cl(1,i.rank)[0],u=Se.runKernel(function(l){return l.cumsum(s,a,t,r)},{permutedX:s},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),pwe=he({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=te(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],s=t==="NHWC"?r.shape[3]:r.shape[1];return oe(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),oe(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),oe(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),Se.runKernel(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),Da=he({expandDims_:function(n,e){e===void 0&&(e=0);var t=te(n,"x","expandDims",null);oe(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(oe(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),gu(t,r)}}),HX=he({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=xn([n,e],r),o=n<=e?n:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return mv(Da(a,0),[t[0],1,1]);if(t.length===2)return mv(Da(Da(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return mv(Da(Da(Da(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),mwe=he({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=te(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var a=s===1?i.as2D(1,-1):i,u=Se.runKernel(function(l){return l.multinomial(a,r,e,t)},{logits2D:a});return s===1?u.as1D():u}}),n4=he({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=te(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),Se.runKernel(function(s){return s.oneHot(i,e,t,r)},{$indices:i},function(s){return{$indices:function(){return Mr(i.shape,"float32")}}}).reshape(o)}}),ox=he({pad_:function(n,e,t){t===void 0&&(t=0);var r=te(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(o){return o[0]});return Se.runKernel(function(o){return o.pad(r,e,t)},{$x:r},function(o){return{$x:function(){return o.slice(i,r.shape)}}})}}),vwe=he({pad1d_:function(n,e,t){return t===void 0&&(t=0),oe(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ox(n,[e],t)}}),gwe=he({pad2d_:function(n,e,t){return t===void 0&&(t=0),oe(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ox(n,e,t)}}),ywe=he({pad3d_:function(n,e,t){return t===void 0&&(t=0),oe(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ox(n,e,t)}}),xwe=he({pad4d_:function(n,e,t){return t===void 0&&(t=0),oe(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ox(n,e,t)}}),wwe=he({rand_:function(n,e,t){var r=Vt(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return at.make(n,{values:i},t)}}),_we=he({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new VX(e,t,r,!1,i),s=xn(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),GX=he({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=xn(n,r),s=new lwe(e,t,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),gu=he({reshape_:function(n,e){var t=te(n,"x","reshape",null);return e=o2e(e,t.size),oe(t.size===Vt(e),function(){return"new shape and old shape must have the same number of elements."}),Se.runKernel(function(r){return r.reshape(t,e)},{$x:t},function(r){return{$x:function(){return r.reshape(t.shape)}}})}}),$X=he({spaceToBatchND_:function(n,e,t){var r=te(n,"x","spaceToBatchND");return oe(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),oe(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),oe(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+t[s-1][0]+t[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),Se.runKernel(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),jX=he({squeeze_:function(n,e){var t=te(n,"x","squeeze");return gu(t,nd(t.shape,e).newShape)}}),bu=he({stack_:function(n,e){e===void 0&&(e=0);var t=Qb(n,"tensors","stack");if(oe(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;oe(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){rr(i,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){oe(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=t.map(function(a){return a.expandDims(e)});return ko(s,e)}}),mv=he({tile_:function(n,e){var t=te(n,"x","tile",null);return oe(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),Se.runKernel(function(r,i){var o=r.tile(t,e);return i([t]),o},{$x:t},function(r,i){var o=i[0];return{$x:function(){var s=Un(o);if(o.rank===1)for(var a=0;a<e[0];++a)s=s.add(r.slice([a*o.shape[0]],[o.shape[0]]));else if(o.rank===2)for(a=0;a<e[0];++a)for(var u=0;u<e[1];++u)s=s.add(r.slice([a*o.shape[0],u*o.shape[1]],[o.shape[0],o.shape[1]]));else if(o.rank===3)for(a=0;a<e[0];++a)for(u=0;u<e[1];++u)for(var l=0;l<e[2];++l)s=s.add(r.slice([a*o.shape[0],u*o.shape[1],l*o.shape[2]],[o.shape[0],o.shape[1],o.shape[2]]));else{if(o.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+o.rank+" tensors yet.");for(a=0;a<e[0];++a)for(u=0;u<e[1];++u)for(l=0;l<e[2];++l)for(var c=0;c<e[3];++c)s=s.add(r.slice([a*o.shape[0],u*o.shape[1],l*o.shape[2],c*o.shape[3]],[o.shape[0],o.shape[1],o.shape[2],o.shape[3]]))}return s}}})}}),bwe=he({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new VX(e,t,r,!0,i),s=xn(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),oo=he({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=te(n,"x","unstack");return oe(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),Se.runKernel(function(r){return r.unstack(t,e)},{$x:t},function(r){return{$x:function(){return bu(r,e)}}})}}),Swe=function(n,e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h;return Qt(this,function(f){switch(f.label){case 0:return t=te(n,"x","setdiff1d"),r=te(e,"y","setdiff1d"),oe(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),oe(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),oe(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),s=new Set(o),a=0,c=0;c<i.length;c++)s.has(i[c])||a++;for(u=new _1([a],t.dtype),l=new _1([a],"int32"),c=0,h=0;c<i.length;c++)s.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function Jb(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(o+1))}return i}function eS(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function tS(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function XX(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function qX(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function YX(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var s=n.shape,a=t.slice();a.pop();var u=1;for(o=r;o<n.rank;++o)u*=s[o],a.push(s[o]);var l=ap(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[a,i,u,l]}var KX=30;function _T(n){return n<=KX?n:KI(n,Math.floor(Math.sqrt(n)))}function Ewe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}(function(r,i,o){var s=i.rank>1?i.shape[i.rank-1]:1,a=i.rank>1?i.rank-1:1,u="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+o.shape+", indices.shape: "+i.shape+", shape: "+r+", sliceDim: "+s+", and batchDim: "+a+".";if(o.rank<a)throw new Error(u+" update.rank < "+a+". ");if(r.length<s+(o.rank-a))throw new Error(u+" Output shape length < "+(s+(o.rank-a)));if(o.rank!==a+r.length-s)throw new Error(u+" update.rank != "+(a+r.length-s));for(var l=0;l<a;++l)if(o.shape[l]!==i.shape[l])throw new Error(u+" updates.shape["+l+"] ("+o.shape[l]+") != indices.shape["+l+"] ("+i.shape[l]+").");for(l=0;l<o.rank-a;++l)if(o.shape[l+a]!==r[l+s])throw new Error(u+" updates.shape["+(l+a)+"] ("+o.shape[l+a]+") != shape["+(l+a)+"] ("+r[l+a]+")")})(t,e,n)}function nS(n,e,t){for(var r=e.rank>1?e.shape[e.rank-1]:1,i=t.length,o=1,s=r;s<i;++s)o*=t[s];var a=r<1?1:r;return{sliceRank:r,numUpdates:e.size/a,sliceSize:o,strides:ap(t.slice(0,r)).concat([1]),outputSize:Vt(t)}}function RD(n,e,t,r,i,o,s,a,u){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),s!==0)throw new Error("ellipsis mask is not yet supported");if(a!==0)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],h=[],f=0;f<n.length;f++)l[f]=Cwe(i,e,r,n,f),c[f]=Mwe(o,t,r,n,f),u&1<<f&&(c[f]=l[f]+1,h.push(f));var d=new Array(n.length).fill(0);return d=d.map(function(p,v){for(var g=0,m=r[v]||1,x=l[v];!(m>0?x>=c[v]:x<=c[v]);x+=m)g+=1;return g}),[l,d,h]}function Cwe(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=jI(0,o,a-1)}function Mwe(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s>0?jI(0,o,a):jI(-1,o,a-1)}function ZX(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function QX(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Twe(n,e){oe(YI(n),function(){return"The f passed in variableGrads(f) must be a function"}),oe(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof rx}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],Se.registeredVariables)e.push(Se.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;oe((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=Se.gradients(n,e,null,!0),a=s.value,u=s.grads;oe(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),oe(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:a,grads:l}}function sx(n){return Se.customGrad(n)}var pf=he({softmax_:function(n,e){e===void 0&&(e=-1);var t=te(n,"logits","softmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return sx(function(r,i){var o=r.logSumExp([e],!0),s=r.toFloat().sub(o).exp();return i([s]),{value:s,gradFunc:function(a,u){var l=u[0],c=a.mul(l);return c.sub(c.sum([e],!0).mul(l))}}})(t)}}),Rwe=he({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=te(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return sx(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),JX=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.data.delete(e)},n}();function Qm(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,s=n[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function Ii(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&t.unshift(o)}return t}function kn(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var s=e[e.length-i-1];if(s==null&&(s=1),o===1)t.unshift(s);else if(s===1)t.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function b1(n,e,t,r,i,o,s){s===void 0&&(s="channelsLast");var a,u=rS(e),l=u[0],c=u[1];if(s==="channelsLast")a=[l,c,n[3],n[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);a=[l,c,n[1],n[1]]}return ax(n,a,t,r,i,o,!1,s)}function ax(n,e,t,r,i,o,s,a){s===void 0&&(s=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(a==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],f=n[1],c=n[2],h=n[3]}var d,p=e[0],v=e[1],g=e[3],m=rS(t),x=m[0],_=m[1],b=rS(r),S=b[0],E=b[1],C=vv(p,S),R=vv(v,E),T=function(N,O,z,V,F,U,L,j){var Q,K,ie;if(typeof N=="number"){var pe=N===0?"VALID":"NUMBER";Q={top:N,bottom:N,left:N,right:N,type:pe};var we=function(de,me,Ie,xe,se,Xe){se==null&&(se=Awe(de,me,xe));var X=de[0],$=de[1],le=c6((X-me+2*se)/xe+1,Xe);oe(ja(le),function(){return"The output # of rows ("+le+") must be an integer. Change the stride and/or zero pad parameters"});var ze=c6(($-me+2*se)/xe+1,Xe);return oe(ja(ze),function(){return"The output # of columns ("+ze+") must be an integer. Change the stride and/or zero pad parameters"}),[le,ze,Ie]}([O,z,1],U,1,V,N,j);K=we[0],ie=we[1]}else if(N==="same"){K=Math.ceil(O/V),ie=Math.ceil(z/F);var ce=Math.max(0,(K-1)*V+U-O),_e=Math.max(0,(ie-1)*F+L-z),Oe=Math.floor(ce/2),Ve=ce-Oe,Ne=Math.floor(_e/2),Z=_e-Ne;Q={top:Oe,bottom:Ve,left:Ne,right:Z,type:"SAME"}}else{if(N!=="valid")throw Error("Unknown padding parameter: "+N);Q={top:0,bottom:0,left:0,right:0,type:"VALID"},K=Math.ceil((O-U+1)/V),ie=Math.ceil((z-L+1)/F)}return{padInfo:Q,outHeight:K,outWidth:ie}}(i,c,h,x,_,C,R,o),A=T.padInfo,P=T.outHeight,k=T.outWidth,W=s?g*f:g;return a==="channelsFirst"?d=[l,W,P,k]:a==="channelsLast"&&(d=[l,P,k,W]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:h,inChannels:f,outHeight:P,outWidth:k,outChannels:W,padInfo:A,strideHeight:x,strideWidth:_,filterHeight:p,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:S,dilationWidth:E,inShape:n,outShape:d,filterShape:e}}function bT(n,e,t,r,i,o,s){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var a=[-1,-1,-1,-1,-1],u=a[0],l=a[1],c=a[2],h=a[3],f=a[4];if(s==="channelsLast")u=n[0],l=n[1],c=n[2],h=n[3],f=n[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);u=n[0],f=n[1],l=n[2],c=n[3],h=n[4]}var d,p=e[0],v=e[1],g=e[2],m=e[4],x=l6(t),_=x[0],b=x[1],S=x[2],E=l6(r),C=E[0],R=E[1],T=E[2],A=function(z,V,F,U,L,j,Q,K,ie,pe){var we,ce,_e,Oe;if(z==="same"){ce=Math.ceil(V/L),_e=Math.ceil(F/j),Oe=Math.ceil(U/Q);var Ve=(ce-1)*L+K-V,Ne=(_e-1)*j+ie-F,Z=(Oe-1)*Q+pe-U,de=Math.floor(Ve/2),me=Ve-de,Ie=Math.floor(Ne/2),xe=Ne-Ie,se=Math.floor(Z/2),Xe=Z-se;we={top:Ie,bottom:xe,left:se,right:Xe,front:de,back:me,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);we={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ce=Math.ceil((V-K+1)/L),_e=Math.ceil((F-ie+1)/j),Oe=Math.ceil((U-pe+1)/Q)}return{padInfo:we,outDepth:ce,outHeight:_e,outWidth:Oe}}(i,l,c,h,_,b,S,vv(p,C),vv(v,R),vv(g,T)),P=A.padInfo,k=A.outDepth,W=A.outHeight,N=A.outWidth,O=o?m*f:m;return s==="channelsFirst"?d=[u,O,k,W,N]:s==="channelsLast"&&(d=[u,k,W,N,O]),{batchSize:u,dataFormat:s,inDepth:l,inHeight:c,inWidth:h,inChannels:f,outDepth:k,outHeight:W,outWidth:N,outChannels:O,padInfo:P,strideDepth:_,strideHeight:b,strideWidth:S,filterDepth:p,filterHeight:v,filterWidth:g,dilationDepth:C,dilationHeight:R,dilationWidth:T,inShape:n,outShape:d,filterShape:e}}function Awe(n,e,t,r){r===void 0&&(r=1);var i=vv(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function rS(n){return typeof n=="number"?[n,n]:n}function l6(n){return typeof n=="number"?[n,n,n]:n}function vv(n,e){return e<=1?n:n+(n-1)*(e-1)}function c6(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function iS(n){var e=rS(n),t=e[0],r=e[1];return t===1&&r===1}function Kh(n,e){return iS(n)||iS(e)}function eq(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Mr(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!l2e(n.dtype,e))return at.make(n.shape,{dataId:n.dataId},e);if(n.dtype==="complex64"){var s=t.real(n);return o=s.cast(e),s.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var a=pt(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function r4(n,e){return at.make(e,{dataId:n.dataId},n.dtype)}function tq(n,e,t){var r=(e-n)/(t-1),i=nx(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return fs(i,"float32")}function i4(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function h6(n,e){return{real:n[2*e],imag:n[2*e+1]}}function Iwe(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function Pwe(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function AD(n,e,t,r,i){for(var o=Array.from(e).map(function(d,p){return{score:d,boxIndex:p}}).filter(function(d){return d.score>i}).sort(function(d,p){return p.score-d.score}),s=[],a=0;a<o.length;a++){var u=o[a],l=u.score,c=u.boxIndex;if(l<i)break;for(var h=!1,f=s.length-1;f>=0;--f)if(kwe(n,c,s[f])>=r){h=!0;break}if(!h&&(s.push(c),s.length>=t))break}return fs(s,"int32")}function kwe(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(a-o)*(u-s),p=(h-l)*(f-c);if(d<=0||p<=0)return 0;var v=Math.max(o,l),g=Math.max(s,c),m=Math.min(a,h),x=Math.min(u,f),_=Math.max(m-v,0)*Math.max(x-g,0);return _/(d+p-_)}function nq(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var s=n.slice(r,i);return r[t]+=o,s})}function rq(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=xn(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var u=n.locToIndex(s);i.values[r]=n.values[u]}return i.toTensor()}function iq(n,e,t,r,i){for(var o=e[e.length-1],s=[n.length/o,o],a=s[0],u=s[1],l=qI(t,a*r),c=qI("int32",a*r),h=0;h<a;h++){for(var f=h*u,d=n.subarray(f,f+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(b,S){return S.value-b.value});var g=h*r,m=l.subarray(g,g+r),x=c.subarray(g,g+r);for(v=0;v<r;v++)m[v]=p[v].value,x[v]=p[v].index}var _=e.slice();return _[_.length-1]=r,[ls(l,_,t),ls(c,_,"int32")]}function ID(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=xn(n,"int32"),o=xn([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]),a=r*n.length;o.values.set(s,a)}return o.toTensor()}var Dwe=function(){return function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `}}(),Nwe=function(){return function(n,e){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `}}(),Lwe=function(){return function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,s=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}();function oq(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function ds(n,e){return e===1?[n]:oq(n,e)}function Co(){var n,e,t,r,i,o,s,a,u,l;return Ce.getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 0. || val == 0.) ? false : true;
      }
    `,u=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}function vd(n,e,t){t===void 0&&(t="index");var r=ap(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function PD(n){var e=ap(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var sq=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function Fwe(n,e,t,r){var i=[];n.forEach(function(d){var p=Vt(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?i.push("uniform float "+d.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+d.name+";"),i.push("uniform int offset"+d.name+";"))});var o,s,a=i.join(`
`),u=n.map(function(d){return function(p,v,g){g===void 0&&(g=!1);var m="";m+=g?aq(p):gm(p);var x=p.shapeInfo.logicalShape,_=v.logicalShape;return x.length<=_.length&&(m+=g?function(b,S){var E,C=b.name,R=C.charAt(0).toUpperCase()+C.slice(1),T="get"+R+"AtOutCoords",A=b.shapeInfo.logicalShape.length,P=S.logicalShape.length,k=Qm(b.shapeInfo.logicalShape,S.logicalShape),W=dr(P),N=P-A,O=["x","y","z","w","u","v"];E=A===0?"":P<2&&k.length>=1?"coords = 0;":k.map(function(Q){return"coords."+O[Q+N]+" = 0;"}).join(`
`);var z="";z=P<2&&A>0?"coords":b.shapeInfo.logicalShape.map(function(Q,K){return"coords."+O[K+N]}).join(", ");var V="return outputValue;",F=Vt(b.shapeInfo.logicalShape)===1,U=Vt(S.logicalShape)===1;if(A!==1||F||U){if(F&&!U)V=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(k.length){var L=A-2,j=A-1;k.indexOf(L)>-1&&k.indexOf(j)>-1?V="return vec4(outputValue.x);":k.indexOf(L)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":k.indexOf(j)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+W+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+R+"("+z+`);
      `+V+`
    }
  `}(p,v):function(b,S){var E=b.name,C=E.charAt(0).toUpperCase()+E.slice(1),R="get"+C+"AtOutCoords",T=S.texShape,A=b.shapeInfo.texShape,P=b.shapeInfo.logicalShape.length,k=S.logicalShape.length;if(!b.shapeInfo.isUniform&&P===k&&b.shapeInfo.flatOffset==null&&Po(A,T))return`
      float `+R+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var W,N=dr(k),O=Qm(b.shapeInfo.logicalShape,S.logicalShape),z=k-P,V=["x","y","z","w","u","v"];W=P===0?"":k<2&&O.length>=1?"coords = 0;":O.map(function(U){return"coords."+V[U+z]+" = 0;"}).join(`
`);var F="";return F=k<2&&P>0?"coords":b.shapeInfo.logicalShape.map(function(U,L){return"coords."+V[L+z]}).join(", "),`
    float `+R+`() {
      `+N+` coords = getOutputCoords();
      `+W+`
      return get`+C+"("+F+`);
    }
  `}(p,v)),m}(d,e,r)}).join(`
`),l=e.texShape,c=Co(),h=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    #define isnan(value) isnan_custom(value)
    `+d.defineSpecialNaN+`
    bvec4 isnan_custom(vec4 val) {
      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
    }

    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+Owe+`
    `+Bwe+`
    `+Uwe+`
  `}(c);return e.isPacked?(o=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,S){var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,S){var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];if(Po(b,S))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var C=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=d,g=p,m=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],x=Math.ceil(v[2]/2),_=x*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,S){for(var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)],C=Math.ceil(b[b.length-1]/2),R=C*Math.ceil(b[b.length-2]/2),T=R,A="",P="b, r, c",k=2;k<b.length-1;k++)T*=b[b.length-k-1],A=`
      int b`+k+" = index / "+T+`;
      index -= b`+k+" * "+T+`;
    `+A,P="b"+k+", "+P;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+A+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec`+b.length+"("+P+`);
    }
  `}(d,p)}var v,g,m,x,_}(e.logicalShape,l),s=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(c)):(o=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(m,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(m,x){return Po(m,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:m[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:m[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+m[1]+`;
      int c = index - r * `+m[1]+`;
      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=p,g=vd(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(m,x){var _=vd(["r","c","d","d2"],m);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `}(d,p);case 5:return function(m,x){var _=vd(["r","c","d","d2","d3"],m);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,p);case 6:return function(m,x){var _=vd(["r","c","d","d2","d3","d4"],m);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,p);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,g}(e.logicalShape,l),s=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=zwe),[f,h,s,a,o,u,t].join(`
`)}function gm(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(s===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=zf(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+sm(t)+`
      }
    `;var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(a===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=zf(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+a+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Po(r,s)){var a=s[0],u=s[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=nd(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var d=ym(t,f);return`
      `+gm(d)+`
      float `+o+`(int row, int col) {
        return `+o+"("+xm(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+sm(t)+`
      }
    `;var p=s[0],v=s[1],g=zf(i);return v===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=nd(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=ym(t,h);return`
        `+gm(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+xm(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+a+`, 1)));
        `+sm(t)+`
      }
    `;var d=t.shapeInfo.texShape,p=d[0],v=d[1],g=t.shapeInfo.flatOffset;if(v===s&&g==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(v===a&&g==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var m=zf(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+a+" + depth + "+m+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,l=nd(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=ym(t,c);return`
      `+gm(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+xm(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+a+", "+s+`, 1)));
        `+sm(t)+`
      }
    `;var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],g=p[1];if(g===u&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===s&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var m=zf(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+a+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+g+", index + "+m+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,l=r[1]*u,c=nd(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var d=ym(t,h);return`
      `+gm(d)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+xm(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+a+", "+s+`)) +
          depth3;
        `+sm(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,g=v[0],m=v[1];if(m===l&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(m===s&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=zf(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+a+` +
          depth2 * `+s+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+m+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=nd(r),a=s.newShape,u=s.keptDims;if(a.length<r.length){var l=ym(t,a);return`
      `+gm(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+xm(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,d=r[2]*f,p=r[1]*d;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+sm(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,m=g[0],x=g[1];if(x===p&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=zf(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+d+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+m+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function aq(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Co(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=Co();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(n);case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Co();if(u!=null&&Po(o,u))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+s+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+s+`, uv);
    }
  `}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=ym(i,c);return`
        `+aq(h)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+xm(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],p=Math.ceil(o[2]/2),v=p*Math.ceil(o[1]/2),g=Co();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+v+", "+p+`, b, row, col);
      return `+g.texture2D+"("+s+`, uv);
    }
  `}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],d=Math.ceil(o[s-1]/2),p=d*Math.ceil(o[s-2]/2),v="int b, int row, int col",g="b * "+p+" + (row / 2) * "+d+" + (col / 2)",m=2;m<s-1;m++)v="int b"+m+", "+v,p*=o[s-m-1],g="b"+m+" * "+p+" + "+g;var x=Co();return`
    vec4 `+u+"("+v+`) {
      int index = `+g+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+a+`, uv);
    }
  `}(n)}}var Owe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Bwe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Uwe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,zwe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function zf(n){return"offset"+n}function sm(n){var e=n.name,t=Vt(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function dr(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function ym(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function xm(n,e){return e.map(function(t){return n[t]}).join(", ")}var Vwe=function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,oe(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,l=u.length,c=dr(l),h=ds("coords",l);if(o===1){var f=dr(a=l+1);s=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else a=l,s=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,a),p="."+d[a-1],v=d.map(function(R){return"int "+R}),g=ds("sourceLocR",a-1).concat("inIdx.r"),m=ds("sourceLocG",a-1).concat("inIdx.g"),x=ds("sourceLocB",a-1).concat("inIdx.b"),_=ds("sourceLocA",a-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",E=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+m.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",C=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+C+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+S+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}(),Wwe=function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,s=n.dilationWidth,a=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=a-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}(),Hwe=function(){return function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],kn(n,e),kn(n,t);var s="0.0";r!=null&&(kn(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";i!=null&&(kn(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}(),Gwe=function(){return function(n,e,t,r,i,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],kn(n,e),kn(n,t);var s="vec4(0.0)";r!=null&&(kn(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(kn(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}}(),$we="return areal * breal - aimag * bimag;",jwe="return areal * bimag + aimag * breal;",f6=function(){return function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=kn(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}(),ST="return a + b;",ET="return a - b;",d6="return a * b;",Vr=function(){return function(n,e,t){this.variableNames=["A","B"],this.outputShape=kn(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}(),Vl=function(){return function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=kn(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||Vt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+dr(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=ds("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}}(),Xwe=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),qwe=function(){function n(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),Ywe=function(){return function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}(),Kwe=function(){return function(n){this.outputShape=[],this.outputShape=qv(n,1),this.variableNames=n.map(function(a,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,s=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `}}(),Zwe=function(){return function(n,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=qv(n,e);var t=this.outputShape,r=t.length,i=dr(r),o=ds("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(v,g){return"T"+g});var a=new Array(n.length-1);a[0]=n[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+n[u][e];var l=s[e],c="vec2("+s.slice(-2).join()+")",h=s.join(),f="if ("+l+" < "+a[0]+`)
          return getChannel(getT0(`+h+"), "+c+");";for(u=1;u<a.length;u++){var d=a[u-1];f+=`
        else if (`+l+" < "+a[u]+`) {
          `+l+" -= "+d+`;
          return getChannel(getT`+u+"("+h+"), "+c+`);
        }`}var p=a.length;f+=`
        else {
          `+l+" -= "+a[a.length-1]+`;
          return getChannel(getT`+p+"("+h+"), "+c+`);
        }`,this.userCode=`
      float getValue(`+s.map(function(v){return"int "+v})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);
        if (++`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }
        if (++`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }
        if (`+o[r-2]+" < "+t[r-2]+` &&
            --`+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}}(),Qwe=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),Jwe=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,s=t-1-n.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),e_e=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,s=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),t_e=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),n_e=function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),r_e=function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,s=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),i_e=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,s=n.dilationWidth,a=n.filterHeight,u=n.filterWidth,l=4*Math.floor(n.inChannels/4),c=n.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+i+`);
      const ivec2 pads = ivec2(`+e+", "+t+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`; wR++) {
          int xR = xRCorner + wR * `+o+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+u+`; wC++) {
            int xC = xCCorner + wC * `+s+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+l+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(c===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+l+`) *
                getW(wR, wC, `+l+`, d2);
            } else if (`+(c===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(c===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1),
                getX(batch, xR, xC, `+l+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2),
                getW(wR, wC, `+l+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),o_e=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,f=n.filterWidth,d=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}(),s_e=function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,s=n.strideWidth,a=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+s+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+a+`;

          if (xR < 0 || xR >= `+e+`) {
            continue;
          }

          for (int wC = 0; wC < `+c+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+t+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}}(),a_e=function(){return function(n){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=n.outShape;for(var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,s=n.strideWidth,a=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=c,f="int xR; int xC; int xCOffset;",d=0;d<l;d++)for(var p=0;p<c;p++)f+=`
          vec4 xTexelR`+d+"C"+2*p+` = vec4(0.);
          vec4 wR`+d+"C"+p+` = vec4(0.);
          vec4 xR`+d+"C"+p+" = vec4(0.);";for(d=0;d<l;d++)for(var v=0;v<h;v++){if(f+=`
          xR = xRCorner + `+d*a+`;
          xC = xCCorner + `+(p=2*v)*u+`;
        `,s===1){if(p<c&&(f+=i%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  xTexelR`+d+"C"+p+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+d+"C"+p+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+d+"C"+p+" = vec4(previous.zw, xTexelR"+d+"C"+p+`.xy);
                } else {
                  xR`+d+"C"+p+" = vec4(0, 0, xTexelR"+d+"C"+p+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+e+" && xC >= 0 && xC < "+t+`) {
                  xTexelR`+d+"C"+p+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+d+"C"+p+` = vec4(0.);
                }

                xR`+d+"C"+p+" = xTexelR"+d+"C"+p+`;
              `,p+1<c)){var g=i%2==0?CX(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(f+=`
                  xCOffset = xC + `+i%2+" + "+g+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+d+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,u>1&&(f+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+e+` &&
                      xCOffset >= 0 && xCOffset < `+t+`) {
                      xTexelR`+d+"C"+p+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+d+"C"+p+` = vec4(0.);
                    }
                  `),f+=`
                  xR`+d+"C"+(p+1)+` = vec4(
                    xTexelR`+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+`.xy);
                `):f+=`
                  xCOffset = xC + `+g+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+d+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+d+"C"+(p+1)+" = xTexelR"+d+"C"+(p+2)+`;
                `}}else p<c&&(f+=`
              if(xR >= 0 && xR < `+e+`) {
            `,i%2==1?(f+=`
                xCOffset = xC + 1 - `+s+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+d+"C"+p+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+d+"C"+p+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+t+`) {
                  xTexelR`+d+"C"+(p+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+d+"C"+(p+2)+` = vec4(0.);
                }

                xR`+d+"C"+p+` = vec4(
                  xTexelR`+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+`.zw);
              `,p+1<c&&(f+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+s+`;
                  if(xCOffset >= 0 && xCOffset < `+t+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+d+"C"+(p+1)+" = vec4(xTexelR"+d+"C"+(p+2)+`.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < `+t+`) {
                  xTexelR`+d+"C"+p+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+d+"C"+p+` = vec4(0.);
                }

                xCOffset = xC + `+s+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+d+"C"+(p+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+d+"C"+(p+2)+` = vec4(0.);
                }

                xR`+d+"C"+p+` = vec4(
                  xTexelR`+d+"C"+p+".xy, xTexelR"+d+"C"+(p+2)+`.xy);
              `,p+1<c&&(f+=`
                  xR`+d+"C"+(p+1)+` = vec4(
                    xTexelR`+d+"C"+p+".zw, xTexelR"+d+"C"+(p+2)+`.zw);
                `)),f+="}");p<c&&(f+=`
            vec4 wTexelR`+d+"C"+p+" = getW("+d+", "+p+`, d1, q);
            wR`+d+"C"+p+" = vec4(wTexelR"+d+"C"+p+".xz, wTexelR"+d+"C"+p+`.xz);
          `,p+1<c&&(f+=`
              vec4 wTexelR`+d+"C"+(p+1)+" = getW("+d+", "+(p+1)+`, d1, q);
              wR`+d+"C"+(p+1)+` =
                vec4(wTexelR`+d+"C"+(p+1)+".xz, wTexelR"+d+"C"+(p+1)+".xz);"))}for(d=0;d<l;d++)for(p=0;p<c;p++)f+="result += xR"+d+"C"+p+" * wR"+d+"C"+p+";";this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+s+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+f+`

        setOutput(result);
      }
    `}}(),u_e=function(){return function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,d=[s-1+".0",a-1+".0"],p=d[0],v=d[1],g=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],m=g[0],x=g[1],_=g[2],b=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],S=b[0],E=b[1],C=b[2];this.userCode=`
      const float height_ratio = float(`+m+`);
      const float width_ratio = float(`+S+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+E+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+C+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}(),l_e=function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+dr(r)+` coords = getOutputCoords();
        int end = `+p6(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+p6(r,"coords")+` = idx;
          val += getX(`+function(s,a){if(s===1)return""+a;if(s===2)return a+".x, "+a+".y";if(s===3)return a+".x, "+a+".y, "+a+".z";if(s===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `}}();function p6(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var c_e=function(){return function(n,e){this.variableNames=["A"];var t=Co();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+vd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}}(),h_e=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;var t=Co();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+vd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}}(),f_e=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),d_e=function(){return function(n){this.variableNames=["A"];var e=Co();this.outputShape=n,this.userCode=`
      `+sq+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `}}(),p_e=function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0;var e=Co();this.outputShape=n,this.userCode=`
      `+sq+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `}}(),m_e=function(){return function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Co(),i=e[0],o=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+PD(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex /= 4;
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `}}(),v_e=function(){return function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Co(),i=e[0],o=e[1];this.outputShape=n;var s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;s+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);
    
              flatIndex /= 4;
              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+PD(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;
        
        `+s+`

        `+r.output+" = "+a+`;
      }
    `}}(),g_e="return real * expR - imag * expI;",y_e="return real * expI + imag * expR;",m6=function(){return function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}(),x_e=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),w_e=function(){return function(n){this.variableNames=["A"];var e=Co(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}(),__e=function(){return function(n){this.variableNames=["A"];var e=Co(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `}}(),b_e=function(){return function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=dr(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<s.length;h++)h===a?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}(),pu,Ks,S_e=function(){return function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=dr(e.length),i=dr(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}}();function LE(n,e){return[e,n]}function CT(n){var e=Vt(n);return XI(Math.ceil(e/4))}function ux(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function E_e(n,e){var t=Co();return E2e(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function C_e(n,e){return A2e(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function M_e(n,e){return I2e(n,e,new Uint16Array([0,1,2,2,1,3]))}function T_e(n,e){var t,r,i,o,s,a,u,l,c=n;return Ce.getNumber("WEBGL_VERSION")===2?(t=c.R32F,r=c.R16F,i=c.RGBA16F,o=c.RGBA32F,s=c.RED,a=4,u=1,l=c.HALF_FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=c.RGBA,s=n.RGBA,a=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:l}}function lx(n,e,t,r,i,o,s){k2e(t,r);var a=P2e(n,e),u=n.TEXTURE_2D;return Pt(n,e,function(){return n.bindTexture(u,a)}),Pt(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Pt(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Pt(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Pt(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Pt(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,s,null)}),Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function R_e(n,e,t,r,i){var o=LE(t,r);return lx(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function A_e(n,e,t,r,i){var o=LE(t,r);return lx(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function I_e(n,e,t,r,i){var o=LE(t,r);return lx(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function P_e(n,e,t,r,i){var o=ux(t,r);return lx(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function k_e(n,e,t,r,i){var o=ux(t,r);return lx(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function D_e(n,e,t,r){return Pt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),o6(n,e,t,"clipSpacePos",r,3,20,0)&&o6(n,e,t,"uv",r,2,20,12)}function N_e(n,e,t,r,i,o,s){var a,u,l;Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(r*i*4),u=n.FLOAT,l=s.internalFormatPackedFloat),a.set(o),Pt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,a)}),Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function L_e(n,e,t,r){Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?Pt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Pt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Pt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function F_e(n,e,t,r,i){var o=n.createBuffer();Pt(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var s=16*t*r;return Pt(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Pt(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),Pt(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function O_e(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function B_e(n,e,t,r,i){var o=LE(t,r),s=o[0],a=o[1],u=new Uint8Array(t*r*4);return Pt(n,e,function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function U_e(n,e,t,r,i,o,s,a){var u=n,l=new Float32Array(function(c,h){var f=ux(c,h);return f[0]*f[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function z_e(n,e,t,r){var i=new Float32Array(t*r*4);return Pt(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(pu||(pu={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Ks||(Ks={}));var V_e=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Ce.getNumber("WEBGL_VERSION");e!=null?(this.gl=e,x2e(t,e)):this.gl=Sl(t),Ce.getNumber("WEBGL_VERSION")===1?(this.textureFloatExtension=$w(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=$w(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=$w(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=C_e(this.gl,this.debug),this.indexBuffer=M_e(this.gl,this.debug),this.framebuffer=D2e(this.gl,this.debug),this.textureConfig=T_e(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Ce.getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Pt(t,this.debug,function(){return t.finish()}),Pt(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Pt(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Pt(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Pt(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Pt(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),R_e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),A_e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),I_e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),L_e(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),N_e(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),k_e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),P_e(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(s6(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Pt(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return B_e(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,s){return U_e(this.gl,e,0,0,0,o,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return O_e(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=F_e(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(Ce.getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=s}else Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return z_e(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=C2e(t,this.debug,e),i=E_e(t,this.debug),o=T2e(t,this.debug);return Pt(t,this.debug,function(){return t.attachShader(o,i)}),Pt(t,this.debug,function(){return t.attachShader(o,r)}),R2e(t,this.debug,o),this.debug&&yT(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=D_e(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Pt(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&yT(this.gl,this.debug,this.program),Pt(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?L2e(this.gl,this.debug,e,t):F2e(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Pt(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),O2e(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=ux(t,r),o=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,o,s)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&yT(this.gl,this.debug,this.program),jw(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Pt(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Pt(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=$w(this.gl,this.debug,Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Zt(this,void 0,void 0,function(){var t=this;return Qt(this,function(r){switch(r.label){case 0:return[4,e6(function(){return t.disposed||t.isQueryAvailable(e,Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length;++i){var o=r[i]();if(!o)break}return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||e6(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),xT(this.gl,this.debug,e,this.framebuffer),this.debug&&jw(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(xT(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&jw(this.gl)):s6(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;xT(i,this.debug,e,this.framebuffer),this.debug&&jw(i),this.outputTexture=e,Pt(i,this.debug,function(){return i.viewport(0,0,t,r)}),Pt(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Pt(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function v6(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],s=o.shape;if(!Po(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!Po(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var W_e=function(){return function(n,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,s=t.strideHeight,a=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=a.left,f=a.top,d=i*r,p=Co();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+n[1]+" || pos >= "+n[0]+`) continue;

            int offsetY = int(blockIndex / (`+u+")) * "+s+" - "+f+`;
            int d0 = offsetY + `+c+" * (pos / "+d+`);

            if(d0 >= `+e[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+h+`.);
            int d1 = offsetX + `+l+" * (int(mod(float(pos), "+d+".) / "+i+`.));

            if(d1 >= `+e[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+i+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+p.output+` = result;
      }
    `}}(),H_e=function(){return function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `}}(),G_e=function(){return function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}(),$_e=function(){return function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var o,s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `}}(),j_e=function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,s=i-1-n.padInfo.top,a=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}(),MT=function(){return function(n,e,t,r,i,o){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var s=t?n[1]:n[2],a=Math.ceil(s/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",d="";o&&(f=`vec4 activation(vec4 x) {
        `+o+`
      }`,d="result = activation(result);");var p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),this.userCode=`
      `+f+`

      const float sharedDimension = `+a+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+a+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          result += (`+c[0]+" * "+h[0]+") + ("+c[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+p+`

        `+d+`

        setOutput(result);
      }
    `}}(),X_e=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),q_e=function(){return function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `}}(),Y_e=function(){return function(n){this.variableNames=["A"],this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=ds("rc",e),r=dr(e),i=function(a,u,l){if(a===1)return"rc > "+u[0];for(var c="",h=a-2;h<a;h++)c+=l[h]+" >= "+u[h],h<a-1&&(c+="||");return c}(e,n,t),o=function(a,u,l,c){if(a===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),s=function(a,u){var l=a.length,c=function(h,f){for(var d=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var g=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),m=2;m<h;m++)g=f[f.length-1-m]+","+g;d.push(g)}return d}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+s+`));
          }
        }
      `}}}(),K_e=function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=dr(r),o=e.map(function(u){return u[0]}).join(","),s=e.map(function(u,l){return u[0]+n[l]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}}(),Z_e=function(){return function(n,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(g,m){return g[0]+n[m]+g[1]});for(var r=n.length,i=dr(r),o=e.map(function(g){return g[0]}).join(","),s=e.map(function(g,m){return g[0]+n[m]}).join(","),a=ds("rc",r),u=ds("source",r),l=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=r===1?2:4;p<v;p++)d+=`
        `+h[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `}}(),TT=function(){return function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var f=e==="avg",d="0.0";if(f||(d="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+s+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(p="avgValue / count");var v=4*Math.floor(r/4),g=r%4,m=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+s+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+a+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              getValue(batch, xR, xC + 3 * `+a+`, d)
            );

            `+m+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+a+`, d),
              getValue(batch, xR, xC + 2 * `+a+`, d),
              initializationValue
            );

            `+m+`
          }
        }
        setOutput(`+p+`);
      }
    `}}}(),Q_e=function(){return function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var s="0.0",a="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",a="min"):e==="max"&&(s="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `}}(),J_e=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+vd(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+PD(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `}}(),ebe=function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[t&&a>1?i-1:i,t&&u>1?o-1:o],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),tbe=function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}(),nbe=function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`; 
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}(),rbe=function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[t&&a>1?i-1:i,t&&u>1?o-1:o],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}(),ibe=function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}(),obe=function(){return function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,s){return function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(s)}).join(","),i=dr(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `}}(),sbe=function(){return function(n,e){this.variableNames=["x"],this.usesPackedTextures=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=ds("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],s=dr(t);function a(u){var l=n.map(function(c,h){return function(f,d){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+d[f]+" - 1":""+d[f]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return a(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",a(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `}}(),g6=function(){return function(n,e,t,r,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=dr(i.length),u=dr(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",d=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}(),abe=function(){return function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/t);this.outputShape=[r,s];var a=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `}}(),ube=function(){return function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<e.length;u++)a.push(""+o[u]),u<n&&s.push(""+o[u]);r=s.join(),i=a.join()}var l=dr(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}}(),lbe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=dr(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(s===1)return"sourceLoc";if(s<=6)return RT.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(s,a){return"sourceLoc."+RT[a]+" = start["+a+"] + coords."+RT[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),RT=["x","y","z","w","u","v"],cbe=function(){function n(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=dr(this.rank),r=ds("coords",this.rank),i=ds("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+` 
        vec4 result = vec4(0.);
        `+a+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),hbe=function(){return function(n,e,t,r){this.variableNames=["x"];var i=t.filter(function(c,h){return r.indexOf(h)===-1});this.outputShape=i;var o=t.length,s=dr(t.length),a=dr(i.length),u="";if(o===1)u="coords * strides + begin";else{var l=0;u=t.map(function(c,h){return r.indexOf(h)===-1?(l++,i.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"):"begin["+h+"]"}).join(",")}this.userCode=`
      `+s+" begin = "+s+"("+n+`);
      `+s+" strides = "+s+"("+e+`);

      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+u+`));
      }
    `}}(),fbe=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=y6(t,r),s=x6(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Ks.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Ks.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Ks.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Ks.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Ks.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=x6(t,y6(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function y6(n,e){if(n===pu.UPLOAD)return Ks.PACKED_2X2_FLOAT32;if(n===pu.RENDER||n==null)return e?Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ks.PACKED_2X2_FLOAT32:Ks.PACKED_2X2_FLOAT16:Ce.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ks.UNPACKED_FLOAT32:Ks.UNPACKED_FLOAT16;if(n===pu.DOWNLOAD||n===pu.PIXELS)return Ks.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function x6(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var dbe=function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=dr(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<s.length;c++)l.push("imod("+u[c]+", "+s[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}}(),pbe=function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=dr(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(a),c=0;c<s.length;c++)l[s[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}}(),mbe=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=dr(this.rank),o=oq("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+s.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }  
      setOutput(result);
    }
    `}}(),kD=1.7580993408473768,DD=1.0507009873554805,dn=function(){return function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),lp="if (isnan(x)) return x;",vbe="return x;",w6=lp+`
  return (x < 0.0) ? 0.0 : x;
`,gbe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+kD+`;
  float scale = `+DD+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,_6="return exp(x);",ybe=lp+`
  return sin(x);
`,xbe=lp+`
  return cos(x);
`,wbe=lp+`
  return atan(x);
`,_be=lp+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,bbe=lp+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Sbe="return x;",b6=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,AT=function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}(),Ebe=function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var e=n.length,t=ds("rc",e),r=dr(e),i=function(a,u){if(a===1)return"rc";for(var l="",c=0;c<a;c++)l+=u[c],c<a-1&&(l+=",");return l}(e,t),o=t.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `}}(),Yw={},Cbe=600,Mbe=function(){function n(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!Ce.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var t=Sl(Ce.getNumber("WEBGL_VERSION"));this.binaryCache=((r=Ce.getNumber("WEBGL_VERSION"))in Yw||(Yw[r]={}),Yw[r]),this.gpgpu=new V_e(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var r;this.textureManager=new fbe(this.gpgpu),this.numMBBeforeWarning=Ce.global.screen==null?1024:Ce.global.screen.height*Ce.global.screen.width*window.devicePixelRatio*Cbe/1024/1024,this.texData=new JX(this,Se)}return n.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r})},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=[e.height,e.width],i=[e.height,e.width,t];if(Ce.getBool("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e.data instanceof Uint8Array))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o,s,a=this.makeTensorHandle(r,"int32");if(this.texData.get(a.dataId).usage=pu.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(a.dataId),e),Ce.getBool("WEBGL_PACK")){o=new __e(i);var u=this.makePackedTensor(o.outputShape,a.dtype);s=this.compileAndRun(o,[a],u)}else o=new w_e(i),s=this.compileAndRun(o,[a]);return this.disposeData(a.dataId),s},n.prototype.makeTensorHandle=function(e,t){var r={};return this.register(r,e,t),{dataId:r,shape:e,dtype:t}},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(Ce.getBool("DEBUG"))for(var r=0;r<t.length;r++){var i=t[r];if(!b2e(i))throw Error("The value "+i+" cannot be represented on this device.")}var o=this.texData.get(e);if(o.dtype==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(e),o.usage=pu.UPLOAD,o.values=t},n.prototype.readSync=function(e){var t=this.texData.get(e),r=t.values,i=t.dtype,o=t.complexTensors,s=t.slice,a=t.shape;if(s!=null){var u=new dn(a,"return x;"),l=this.compileAndRun(u,[{dataId:e,shape:a,dtype:i}]),c=this.readSync(l.dataId);return l.dispose(),c}if(r!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return r;var h,f,d=this.activeTimers!=null;return d&&(h=performance.now()),i==="complex64"?f=i4(o.real.dataSync(),o.imag.dataSync()):f=this.getValuesFromTexture(e),d&&(this.downloadWaitMs+=performance.now()-h),this.convertAndCacheOnCPU(e,f)},n.prototype.read=function(e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E;return Qt(this,function(C){switch(C.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(R){return r.push(R)})];if(i=this.texData.get(e),o=i.values,s=i.shape,a=i.slice,u=i.dtype,l=i.complexTensors,a!=null)return c=new dn(s,"return x;"),h=this.compileAndRun(c,[{dataId:e,shape:s,dtype:u}]),f=this.read(h.dataId),h.dispose(),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(e)];if(!Ce.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ce.getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&Ce.get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(e),e=p.dataId,v=this.texData.get(p.dataId),d=(t=this.gpgpu).createBufferFromTexture.apply(t,[v.texture].concat(CT(s)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:C.sent(),C.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return m=C.sent(),x=m[0],_=m[1],g=i4(x,_),[3,5];case 4:d==null?g=this.getValuesFromTexture(e):(b=Vt(s),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,b),this.disposeData(e)),C.label=5;case 5:return S=this.convertAndCacheOnCPU(e,g),E=this.pendingRead.get(e),this.pendingRead.delete(e),E.forEach(function(R){return R(S)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,S]}})})},n.prototype.getValuesFromTexture=function(e){var t,r=this,i=this.texData.get(e),o=i.shape,s=i.dtype,a=i.isPacked,u=Vt(o);if(Ce.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),h=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(CT(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=Ce.getBool("WEBGL_PACK")&&a===!0,d=f?wT(o):o,p=this.makeTensorHandle(d,"float32");p.size=Vt(o),this.texData.get(p.dataId).usage=pu.DOWNLOAD;var v=Ft(function(){var x=f?new p_e(d):new d_e(d);return r.compileAndRun(x,[{shape:d,dtype:s,dataId:e}],p,null)}),g=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(p.dataId),m},n.prototype.time=function(e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u;return Qt(this,function(l){switch(l.label){case 0:return t=this.activeTimers,r=[],i=!1,this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e(),o=Xv(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),s=Xv(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null}),this.activeTimers=t,i&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return a=l.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:r2e(a),getExtraProfileInfo:function(){return a.map(function(c,h){return{name:s[h],ms:c}}).map(function(c){return c.name+": "+c.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},n.prototype.endTimer=function(e){return Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},n.prototype.getQueryTime=function(e){return Zt(this,void 0,void 0,function(){var t;return Qt(this,function(r){return Ce.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var t=this.texData.get(e),r=t.texture,i=t.dtype,o=t.texShape,s=t.usage,a=t.isPacked,u=t.slice,l=u&&u.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),r!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(r,o,s,a)));var h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getCPUBackend=function(){return Ce.getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=Se.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var r=this;return t===void 0&&(t=128),this.getCPUBackend()!=null&&e.every(function(i){return r.texData.get(i.dataId).texture==null&&i.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,t){var r=this.makeOutputArray(e.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:Se.keep(e.clone()),imag:Se.keep(t.clone())},r},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,r);if(Vt(r)===0)return ls([],r,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=ZX(e.shape,t,r);if(i||!o){var s=Ce.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new cbe(r):new lbe(r),a=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,a)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,r)},n.prototype.shallowSlice=function(e,t,r){var i=this.texData.get(e.dataId),o=at.make(r,{},e.dtype,this),s=this.texData.get(o.dataId);Object.assign(s,i),s.shape=r,s.dtype=e.dtype;var a=QX(t,e.strides);i.slice&&(a+=i.slice.flatOffset),s.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||e.dataId};var u=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,u+1),o},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,u,l){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,r,i,o,s,a,u,l);var c=RD(e.shape,t,r,i,o,s,a,u,l),h=c[0],f=c[1],d=c[2],p=f.filter(function(g,m){return d.indexOf(m)===-1});if(p.some(function(g){return g===0}))return ls([],p);var v=new hbe(h,i,f,d);return this.compileAndRun(v,[e])},n.prototype.reverse=function(e,t){var r=Ce.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sbe(e.shape,t):new obe(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(e.length===1)return e[0];if(e.length>Ce.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),i=this.concat(e.slice(0,r),t),o=this.concat(e.slice(r),t);return this.concat([i,o],t)}if(Ce.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new Zwe(e.map(function(c){return c.shape}),t);return this.compileAndRun(s,e)}var a=qv(e.map(function(c){return c.shape}),t),u=e.map(function(c){return c.as2D(-1,Vt(c.shape.slice(t)))}),l=new Kwe(u.map(function(c){return c.shape}));return this.compileAndRun(l,u).reshape(a)},n.prototype.neg=function(e){var t=new dn(e.shape,"return -x;");return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,r,i){var o=r?e.shape[2]:e.shape[1],s=i?t.shape[1]:t.shape[2],a=r?e.shape[1]:e.shape[2],u=e.shape[0];if((o===1||s===1)&&a>1e3){r&&(e=e.transpose([0,2,1])),i&&(t=t.transpose([0,2,1]));var l=s===1?e:e.as3D(u,a,1),c=s===1?2:1,h=s===1?t.as3D(u,1,a):t;return this.multiply(l,h).sum(c,!0)}var f=bi(e.dtype,t.dtype),d=new MT(e.shape,[u,o,s],r,i),p=this.makePackedTensor(d.outputShape,f);return this.compileAndRun(d,[e,t],p)},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,s){var a=r?e.shape[2]:e.shape[1],u=i?t.shape[1]:t.shape[2],l=e.shape[0],c=bi(e.dtype,t.dtype),h=new MT(e.shape,[l,a,u],r,i,!!o,s?function(p,v){if(p==="linear")return v?Sbe:vbe;if(p==="relu")return v?b6:w6;throw new Error("Activation "+p+" has not been implemented for the WebGL backend.")}(s,!0):null),f=this.makePackedTensor(h.outputShape,c),d=[e,t];return o&&d.push(o),this.compileAndRun(h,d,f)},n.prototype.multiply=function(e,t){if(e.dtype==="complex64"){var r=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=new f6($we,e.shape,t.shape),s=new f6(jwe,e.shape,t.shape),a=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag),this.makeComplexComponentTensorHandle(t,i.complexTensors.real),this.makeComplexComponentTensorHandle(t,i.complexTensors.imag)],u=this.compileAndRun(o,a),l=this.compileAndRun(s,a),c=this.complex(u,l);return u.dispose(),l.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,d6,e.dtype);var h=new Vr(d6,e.shape,t.shape),f=this.makeOutputArray(h.outputShape,e.dtype);return this.compileAndRun(h,[e,t],f)},n.prototype.batchNormalization=function(e,t,r,i,o,s){var a=[e,t,r],u=null;s!=null&&(u=s.shape,a.push(s));var l=null;if(o!=null&&(l=o.shape,a.push(o)),Ce.getBool("WEBGL_PACK_NORMALIZATION")){var c=new Gwe(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(c,a)}var h=new Hwe(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(h,a)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){var s=Ce.getBool("WEBGL_PACK_NORMALIZATION")?new $_e(e.shape,t,r,i,o):new H_e(e.shape,t,r,i,o);return this.compileAndRun(s,[e])},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){var u=new G_e(t.shape,i,o,s,a);return this.compileAndRun(u,[t,r,e])},n.prototype.tile=function(e,t){if(e.dtype==="string")return rq(xn(e.shape,e.dtype,this.readSync(e.dataId)),t);var r=new dbe(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.pad=function(e,t,r){var i=Ce.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z_e(e.shape,t,r):new K_e(e.shape,t,r);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var r=Ce.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mbe(e.shape,t):new pbe(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.gather=function(e,t,r){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,r);var i=new b_e(e.shape,t.size,r);return this.compileAndRun(i,[e,t])},n.prototype.batchToSpaceND=function(e,t,r){oe(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(c,h){return c*h}),o=Jb(e.shape,t,i),s=eS(o.length,t.length),a=tS(e.shape,t,i),u=XX(r,t.length),l=qX(a,r,t.length);return e.reshape(o).transpose(s).reshape(a).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){oe(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,r);for(var s=1+t.length;s<e.shape.length;++s)o.push([0,0]);var a=e.pad(o),u=Jb(a.shape,t,i,!1),l=eS(u.length,t.length,!1),c=tS(a.shape,t,i,!1);return a.reshape(u).transpose(l).reshape(c)},n.prototype.reduce=function(e,t,r){var i=e.shape[0],o=e.shape[1],s=_T(o),a=new Q_e({windowSize:s,inSize:o,batchSize:i},t),u=a.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],r);return this.compileAndRun(a,[e],h),h.shape[1]===1?h:this.reduce(h,t,r)},n.prototype.argReduce=function(e,t,r){r===void 0&&(r=null);var i=e.shape[0],o=e.shape[1];r!=null&&(i=r.shape[0],o=r.shape[1]);var s=_T(o),a=new Lwe({windowSize:s,inSize:o,batchSize:i},t,r==null),u=a.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],"int32"),f=[e];return r!=null&&f.push(r),this.compileAndRun(a,f,h),h.shape[1]===1?h:this.argReduce(e,t,h)},n.prototype.argReducePacked=function(e,t,r){r===void 0&&(r=null);var i=r!=null?r.shape:e.shape,o=_T(i[i.length-1]),s=new Vwe(i,o,t,r==null),a=this.makePackedTensor(s.outputShape,"int32"),u=r==null?[e]:[e,r];return this.compileAndRun(s,u,a),a.rank===e.rank?this.argReducePacked(e,t,a):a},n.prototype.sum=function(e,t){js("sum",t,e.rank);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o),a=dT(e.dtype);return this.reduce(s,"sum",a).reshape(i)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o),a=dT(e.dtype);return this.reduce(s,"prod",a).reshape(i)},n.prototype.unsortedSegmentSum=function(e,t,r){var i=0,o=El([i],e.rank),s=e;o!=null&&(s=e.transpose(o),i=Cl(1,e.rank)[0]);var a=function(f,d,p){for(var v=[],g=f.length,m=0;m<g;m++)m!==d?v.push(f[m]):v.push(p);return v}(s.shape,i,r),u=Vt([s.shape[i]]),l=s.as2D(-1,u),c=dT(e.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",t,c,r).reshape(a);return o!=null&&(h=h.transpose(ED(o))),h},n.prototype.segOpCompute=function(e,t,r,i,o){var s=e.shape[0],a=e.shape[1],u=function(p,v){var g,m=!1;for(p<=KX?(g=p,m=!0):g=KI(p,Math.floor(Math.sqrt(p)));!m;)g>v||g===p?m=!0:g=KI(p,g+1);return g}(a,o),l=new abe({windowSize:u,inSize:a,batchSize:s,numSegments:o},t),c=l.outputShape,h=c[0],f=c[1],d=this.makeOutputArray([h,f],i);return this.compileAndRun(l,[e,r],d),d.shape[1]===o?d:(r=UX(0,o).tile([a/u]),this.segOpCompute(d,t,r,i,o))},n.prototype.argMinMaxReduce=function(e,t,r){var i=[t];if(js("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.rank),!Ce.getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=wo(e.shape,i),s=o[0],a=Vt(o[1]),u=e.as2D(-1,a);return this.argReduce(u,r).reshape(s)}return this.argReducePacked(e,r)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,r,i){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new l_e(e.shape,r,i);return this.compileAndRun(o,[e])},n.prototype.equal=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(equal(a, b));
`,"bool");var r=new Vr("return float(a == b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.notEqual=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(notEqual(a, b));
`,"bool");var r=new Vr("return float(a != b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThan(a, b));
`,"bool");var r=new Vr("return float(a < b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.lessEqual=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThanEqual(a, b));
`,"bool");var r=new Vr("return float(a <= b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThan(a, b));
`,"bool");var r=new Vr("return float(a > b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greaterEqual=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var r=new Vr("return float(a >= b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalNot=function(e){var t=new dn(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var r=new Vr("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalOr=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var r=new Vr("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.select=function(e,t,r){var i=new ube(e.rank,t.shape,t.rank),o=this.makeOutputArray(i.outputShape,bi(t.dtype,r.dtype));return this.compileAndRun(i,[e,t,r],o)},n.prototype.where=function(e){t4("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return ID(e.shape,t)},n.prototype.topk=function(e,t,r){return iq(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){js("min",t,e.rank);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new Vr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.mod=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new Vr(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);js("max",t,e.rank);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new Vr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.all=function(e,t){js("all",t,e.rank);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(e,t){js("any",t,e.rank);var r=wo(e.shape,t),i=r[0],o=Vt(r[1]),s=e.as2D(-1,o);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.squaredDifference=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl("return (a - b) * (a - b);",e.shape,t.shape):new Vr("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.realDivide=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(b.x == 0.0) {
    result.x = NAN;
  } else if(a.x == b.x) {
    result.x = 1.;
  }
  if(b.y == 0.0) {
    result.y = NAN;
  } else if(a.y == b.y) {
    result.y = 1.;
  }
  if(b.z == 0.0) {
    result.z = NAN;
  } else if(a.z == b.z) {
    result.z = 1.;
  }
  if(b.w == 0.0) {
    result.w = NAN;
  } else if(a.w == b.w) {
    result.w = 1.;
  }
  
  return result;
`,"float32",!0);var r=new Vr(`
if (b == 0.0) {
  return NAN;
} 
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],i)},n.prototype.floorDiv=function(e,t){if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var r=new Vr(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[e,t],i)},n.prototype.add=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,ST);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var r=bi(e.dtype,t.dtype);if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ST,r);var i=new Vr(ST,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.packedBinaryOp=function(e,t,r,i,o){o===void 0&&(o=!1);var s=new Vl(r,e.shape,t.shape,o),a=this.makePackedTensor(s.outputShape,i);return this.compileAndRun(s,[e,t],a)},n.prototype.complexSeparableBinaryOp=function(e,t,r){var i=this,o=this.texData.get(e.dataId),s=this.texData.get(t.dataId),a=[[o.complexTensors.real,s.complexTensors.real],[o.complexTensors.imag,s.complexTensors.imag]].map(function(h){var f=h[0],d=h[1],p=i.makeComplexComponentTensorHandle(e,f),v=i.makeComplexComponentTensorHandle(t,d),g=new Vr(r,e.shape,t.shape),m=i.makeOutputArray(g.outputShape,bi(f.dtype,d.dtype));return i.compileAndRun(g,[p,v],m)}),u=a[0],l=a[1],c=this.complex(u,l);return u.dispose(),l.dispose(),c},n.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>Ce.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),r=this.addN(e.slice(0,t)),i=this.addN(e.slice(t));return this.addN([r,i])}var o=e.map(function(c){return c.dtype}).reduce(function(c,h){return bi(c,h)}),s=e.map(function(c){return c.shape}),a=Ce.getBool("WEBGL_PACK"),u=a?new Nwe(e[0].shape,s):new Dwe(e[0].shape,s),l=a?this.makePackedTensor(u.outputShape,o):this.makeOutputArray(u.outputShape,o);return this.compileAndRun(u,e,l)},n.prototype.subtract=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,ET);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var r=bi(e.dtype,t.dtype);if(Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ET,e.dtype);var i=new Vr(ET,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.pow=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=r?new Vl(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new Vr(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,t.shape),o=bi(e.dtype,t.dtype),s=r?this.makePackedTensor(i.outputShape,o):this.makeOutputArray(i.outputShape,o);return this.compileAndRun(i,[e,t],s)},n.prototype.ceil=function(e){var t=new dn(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},n.prototype.floor=function(e){var t=new dn(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new dn(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new dn(e.shape,"return float(isnan(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isInf=function(e){var t=new dn(e.shape,"return float(isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isFinite=function(e){var t=new dn(e.shape,"return float(!isnan(x) && !isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.round=function(e){var t=new dn(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(t,[e])},n.prototype.exp=function(e){var t;return t=Ce.getBool("WEBGL_PACK")?new AT(e.shape,_6):new dn(e.shape,_6),this.compileAndRun(t,[e])},n.prototype.expm1=function(e){var t=new dn(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},n.prototype.log=function(e){var t;return t=Ce.getBool("WEBGL_PACK")?new AT(e.shape,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`):new dn(e.shape,`if (x < 0.0) return NAN;
  return log(x);`),this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new dn(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new dn(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new dn(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},n.prototype.square=function(e){var t=new dn(e.shape,"return x * x;");return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new dn(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=Ce.getBool("WEBGL_PACK")?new AT(e.shape,b6):new dn(e.shape,w6),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,e.shape,t.shape):new Vr("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.elu=function(e){var t=new dn(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,t.shape):new Vr("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.selu=function(e){var t=new dn(e.shape,gbe);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new dn(e.shape,"return float(int(x));"),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},n.prototype.clip=function(e,t,r){var i,o=(i=Ce.getBool("WEBGL_PACK_CLIP")?new qwe(e.shape):new Xwe(e.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(i,[e],null,o)},n.prototype.abs=function(e){var t=new dn(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),r=new Ywe(e.shape),i=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(r,i)},n.prototype.sigmoid=function(e){var t=new dn(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new dn(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new dn(e.shape,ybe);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new dn(e.shape,xbe);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new dn(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new dn(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new dn(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new dn(e.shape,wbe);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var r=Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Vl(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new Vr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.sinh=function(e){var t=new dn(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new dn(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new dn(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new dn(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new dn(e.shape,_be);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new dn(e.shape,bbe);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new dn(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`);return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var r=new dn(e.shape,function(i){return i===void 0&&(i=0),lp+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `}(t));return this.compileAndRun(r,[e])},n.prototype.conv2dByMatMul=function(e,t,r){var i=e.shape,o=this.texData.get(e.dataId),s=r.inChannels,a=i[0]*i[1]*i[2],u=r.outChannels,l=(a===1||u===1)&&s>1e3,c=i[2]%2!=0&&!!o.isPacked;if(l||!Ce.getBool("WEBGL_LAZILY_UNPACK")||!Ce.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){var h=this.reshape(e,[1,i[0]*i[1]*i[2],r.inChannels]),f=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.batchMatMul(h,f,!1,!1),r.outShape)}var d=at.make([1,i[0]*i[1]*(i[2]+1),r.inChannels],{dataId:e.dataId},e.dtype,this),p=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,oe(qw(o.shape,d.shape),function(){return"packed reshape "+o.shape+" to "+d.shape+" isn't free"});var v=this.reshape(t,[1,r.inChannels,r.outChannels]),g=this.batchMatMul(d,v,!1,!1),m=this.texData.get(g.dataId);return oe(m.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=p,m.shape=r.outShape,at.make(r.outShape,{dataId:g.dataId},g.dtype,this)},n.prototype.conv2dWithIm2Row=function(e,t,r){var i=r.filterWidth,o=r.filterHeight,s=r.inChannels,a=r.outWidth,u=r.outHeight,l=i*o*s,c=u*a,h=[l,c],f=e.squeeze([0]),d=t.reshape([1,l,-1]),p=new W_e(h,f.shape,r),v=this.compileAndRun(p,[f]).reshape([1,h[0],h[1]]),g=new MT(v.shape,[1,c,r.outChannels],!0,!1);return this.compileAndRun(g,[v,d]).reshape([1,u,a,r.outChannels])},n.prototype.conv2d=function(e,t,r){if(r.filterHeight===1&&r.filterWidth===1&&r.dilationHeight===1&&r.dilationWidth===1&&r.strideHeight===1&&r.strideWidth===1&&(r.padInfo.type==="SAME"||r.padInfo.type==="VALID"))return this.conv2dByMatMul(e,t,r);if(Ce.getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,t,r);var i=new i_e(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerInput=function(e,t,r){var i=new Jwe(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerFilter=function(e,t,r){var i=new Qwe(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2D=function(e,t,r){var i;return Ce.getBool("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(i=new a_e(r),this.compileAndRun(i,[e,t],this.makePackedTensor(r.outShape,e.dtype))):(i=new s_e(r),this.compileAndRun(i,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,r){var i=new r_e(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){var i=new n_e(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3d=function(e,t,r){var i=new o_e(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerInput=function(e,t,r){var i=new t_e(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerFilter=function(e,t,r){var i=new e_e(r);return this.compileAndRun(i,[e,t])},n.prototype.maxPool=function(e,t){var r=new TT(t,"max",!1),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],i)},n.prototype.avgPool=function(e,t){var r=new TT(t,"avg",!1),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],i)},n.prototype.maxPoolBackprop=function(e,t,r,i){var o=new TT(i,"max",!0),s=this.compileAndRun(o,[t]),a=new j_e(i),u=this.makeOutputArray(a.outputShape,t.dtype),l=this.compileAndRun(a,[e,s],u);return s.dispose(),l},n.prototype.avgPoolBackprop=function(e,t,r){var i=new Wwe(r),o=this.makeOutputArray(i.outputShape,t.dtype);return this.compileAndRun(i,[e],o)},n.prototype.cast=function(e,t){return eq(e,t,this)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,s=0;s<e.rank;s++)s!==t&&(i[o++]=e.shape[s]);var a=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(s=0;s<l.length;s++)a[t]=s,l[s]=this.slice(e,a,u).reshape(i);return l},n.prototype.reshape=function(e,t){var r=this.texData.get(e.dataId);return!r.isPacked||qw(e.shape,t)||r.texture!==null&&qw(r.shape,t)?r4(e,t):this.packedReshape(e,t)},n.prototype.resizeBilinear=function(e,t,r,i){var o=Ce.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new nbe(e.shape,t,r,i):new tbe(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeBilinearBackprop=function(e,t,r){var i=new ebe(e,t,r);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,t,r,i){var o=new ibe(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){var i=new rbe(e,t,r);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,t,r,i){var o=t?e:pf(e),s=o.shape[0],a=o.shape[1],u=new X_e(s,a,r),l=this.makeOutputArray(u.outputShape,"int32"),c=u.getCustomSetupFunc(i);return this.compileAndRun(u,[o],l,c)},n.prototype.oneHot=function(e,t,r,i){var o=new q_e(e.size,t,r,i);return this.compileAndRun(o,[e])},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return t4("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),AD(e.dataSync(),t.dataSync(),r,i,o)},n.prototype.cropAndResize=function(e,t,r,i,o,s){var a=new u_e(e.shape,t.shape,i,o,s);return this.compileAndRun(a,[e,t,r])},n.prototype.depthToSpace=function(e,t,r){oe(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var i=e.shape[0],o=r==="NHWC"?e.shape[1]:e.shape[2],s=r==="NHWC"?e.shape[2]:e.shape[3],a=r==="NHWC"?e.shape[3]:e.shape[1],u=o*t,l=s*t,c=a/(t*t),h=new f_e(r==="NHWC"?[i,u,l,c]:[i,c,u,l],t,r);return this.compileAndRun(h,[e])},n.prototype.split=function(e,t,r){return nq(e,t,r)},n.prototype.scatterND=function(e,t,r){var i=nS(0,e,r),o=i.sliceRank,s=i.numUpdates,a=i.sliceSize,u=i.strides,l=i.outputSize,c=[l/a,a],h=e.reshape([s,o]),f=t.reshape([s,a]);if(l===0)return r4(ls([]),r);var d=pt(0),p=new g6(s,o,h.rank,f.rank,u,c);return this.compileAndRun(p,[f,h,d]).reshape(r)},n.prototype.sparseToDense=function(e,t,r,i){var o=nS(0,e,r),s=o.sliceRank,a=o.numUpdates,u=o.strides,l=o.outputSize,c=new g6(a,s,e.rank,t.rank,u,[l,1],!1);return this.compileAndRun(c,[t,e,i]).reshape(r)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var r=this.texData.get(e.dataId),i=new m6(g_e,e.shape,t),o=new m6(y_e,e.shape,t),s=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],a=this.compileAndRun(i,s),u=this.compileAndRun(o,s),l=this.complex(a,u).as2D(e.shape[0],e.shape[1]);return a.dispose(),u.dispose(),l},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=YX(e,t),s=o[0],a=o[1],u=o[2],l=o[3],c=t.reshape([a,i]),h=e.reshape([e.size/u,u]),f=new S_e(i,l,[a,u]);return this.compileAndRun(f,[h,c]).reshape(s)},n.prototype.fill=function(e,t,r){if((r=r||tx(t))==="string"){var i=qb(r,Vt(e));return i.fill(t),at.make(e,{values:i},r)}var o=new x_e(e,t),s=o.getCustomSetupFunc(t),a=this.makeOutputArray(e,r);return this.compileAndRun(o,[],a,s)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},n.prototype.linspace=function(e,t,r){return tq(e,t,r)},n.prototype.makeOutputArray=function(e,t){return at.make(e,{},t,this)},n.prototype.makePackedTensor=function(e,t){var r=at.make(e,{},t,this);return this.texData.get(r.dataId).isPacked=!0,r},n.prototype.unpackTensor=function(e){var t=new Ebe(e.shape);return this.compileAndRun(t,[e],at.make(t.outputShape,{},e.dtype,this))},n.prototype.packTensor=function(e){var t=new Y_e(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype),null,!0)},n.prototype.packedReshape=function(e,t){var r=e.reshape([Kb(e.shape)].concat(Zb(e.shape))),i=[Kb(t)].concat(Zb(t)),o=new J_e(i,r.shape);return this.compileAndRun(o,[r]).reshape(t)},n.prototype.decode=function(e){var t,r=this.texData.get(e),i=r.isPacked,o=r.shape,s=r.dtype,a=wT(o),u=CT(o),l=this.makeTensorHandle(o,"float32");return this.texData.get(l.dataId).isPacked=!0,this.texData.get(l.dataId).dtype=s,this.texData.get(l.dataId).texShape=u.map(function(c){return 2*c}),t=i?new h_e(a,u):new c_e(a,u),this.compileAndRun(t,[{shape:a,dtype:s,dataId:e}],l,null,!0),l},n.prototype.compileAndRun=function(e,t,r,i,o){var s=this;if(o===void 0&&(o=!1),r==null&&(r=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=qI(r.dtype,0),r;var a=t.map(function(d){if(d.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var p=s.texData.get(d.dataId);if(p.texture==null){if(!e.usesPackedTextures&&Vt(d.shape)<=Ce.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:d.shape,texData:null,isUniform:!0,uniformValues:p.values};e.usesPackedTextures&&(p.isPacked=!0,p.shape=d.shape)}else if(!!p.isPacked!=!!e.usesPackedTextures)d=p.isPacked?s.unpackTensor(d):s.packTensor(d),p=s.texData.get(d.dataId);else if(p.isPacked&&!qw(p.shape,d.shape)){var v=d,g=d.shape;d.shape=p.shape,d=s.packedReshape(d,g),p=s.texData.get(d.dataId),v.shape=g}return s.uploadToGPU(d.dataId),{shape:d.shape,texData:p,isUniform:!1}});this.uploadToGPU(r.dataId);var u,l={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},c=function(d,p,v){var g="";p.concat(v).forEach(function(_){var b=_.texData!=null&&_.texData.slice!=null&&_.texData.slice.flatOffset>0,S=_.isUniform?"uniform":_.texData.texShape;g+=_.shape+"_"+S+"_"+b});var m=d.userCode,x=d.constructor.name;return x+="_"+g+"_"+m}(e,a,l),h=this.getAndSaveBinary(c,function(){return function(d,p,v,g){var m=p.userCode,x=v.map(function(k,W){var N={logicalShape:k.shape,texShape:k.isUniform?null:k.texData.texShape,isUniform:k.isUniform,isPacked:!k.isUniform&&k.texData.isPacked,flatOffset:null};return k.texData!=null&&k.texData.slice!=null&&k.texData.slice.flatOffset>0&&(N.flatOffset=k.texData.slice.flatOffset),{name:p.variableNames[W],shapeInfo:N}}),_=x.map(function(k){return k.shapeInfo}),b={logicalShape:g.shape,texShape:g.texData.texShape,isUniform:!1,isPacked:g.texData.isPacked,flatOffset:null},S=Fwe(x,b,m,p.usesPackedTextures),E=d.createProgram(S),C=null,R=d.getUniformLocation(E,"NAN",!1);Ce.getNumber("WEBGL_VERSION")===1&&(C=d.getUniformLocation(E,"INFINITY",!1));for(var T={},A=0;A<p.variableNames.length;A++){var P=p.variableNames[A];T[P]=d.getUniformLocation(E,P,!1),T["offset"+P]=d.getUniformLocation(E,"offset"+P,!1)}return{program:p,source:S,webGLProgram:E,uniformLocations:T,inShapeInfos:_,outShapeInfo:b,infLoc:C,nanLoc:R}}(s.gpgpu,e,a,l)}),f=this.activeTimers!=null;return f&&(u=this.startTimer()),function(d,p,v,g,m){v6(p.inShapeInfos,v),v6([p.outShapeInfo],[g]);var x=g.texData.texture,_=g.texData.texShape;g.texData.isPacked?d.setOutputPackedMatrixTexture(x,_[0],_[1]):d.setOutputMatrixTexture(x,_[0],_[1]),d.setProgram(p.webGLProgram),Ce.getNumber("WEBGL_VERSION")===1&&p.infLoc!==null&&d.gl.uniform1f(p.infLoc,1/0),p.nanLoc!==null&&d.gl.uniform1f(p.nanLoc,NaN),v.forEach(function(b,S){var E=p.program.variableNames[S],C=p.uniformLocations[E],R=p.uniformLocations["offset"+E];if(C!=null)if(b.isUniform)if(Vt(b.shape)<2)d.gl.uniform1f(C,b.uniformValues[0]);else{var T=b.uniformValues;T instanceof Float32Array||(T=new Float32Array(T)),d.gl.uniform1fv(C,T)}else b.texData.slice!=null&&R!=null&&d.gl.uniform1i(R,b.texData.slice.flatOffset),d.setInputMatrixTexture(b.texData.texture,C,S)}),m!=null&&m(d,p.webGLProgram),d.executeProgram()}(this.gpgpu,h,a,l,i),f&&(u=this.endTimer(u),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(u)})),!Ce.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(r.dataId).isPacked&&o===!1?this.unpackTensor(r):r},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas!=null&&this.canvas.remove!=null?this.canvas.remove():this.canvas=null,this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Ft(function(){var t=Ce.getBool("DEBUG");Ce.set("DEBUG",!1);var r=e.abs(pt(1e-8)).dataSync()[0];return Ce.set("DEBUG",t),r>0?32:16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var t,r=this.texData.get(e),i=r.shape,o=r.dtype,s=r.values,a=r.texture,u=r.usage,l=r.isPacked;if(a==null){var c,h=this.activeTimers!=null;h&&(c=performance.now());var f=r.texShape;if(f==null&&(f=z2e(i,l),r.texShape=f),s!=null){var d=wT(i),p=void 0,v=f[1],g=f[0],m=s instanceof Uint8Array;l?(v=(t=ux(f[0],f[1]))[0],g=t[1],p=new v_e(d,[g,v],m)):p=new m_e(d,[g,v],m);var x=this.makeTensorHandle([g,v],o);this.texData.get(x.dataId).usage=m?pu.PIXELS:pu.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),v,g,s);var _=this.makeTensorHandle(p.outputShape,x.dtype);_.size=Vt(p.outputShape),this.texData.get(_.dataId).isPacked=l,this.compileAndRun(p,[x],_);var b=this.texData.get(_.dataId);r.texture=b.texture,r.texShape=b.texShape,r.isPacked=b.isPacked,r.usage=b.usage,this.disposeData(x.dataId),this.texData.delete(_.dataId),r.values=null,h&&(this.uploadWaitMs+=performance.now()-c)}else{var S=this.acquireTexture(f,u,o,l);r.texture=S}}},n.prototype.convertAndCacheOnCPU=function(e,t){var r=this.texData.get(e),i=r.dtype;return this.releaseGPUData(e),t!=null&&(r.values=function(o,s){if(s==="float32"||s==="complex64")return o;if(s==="int32"||s==="bool"){for(var a=s==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<a.length;++u)a[u]=Math.round(o[u]);return a}throw new Error("Unknown dtype "+s)}(t,i)),r.values},n.prototype.acquireTexture=function(e,t,r,i){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,i)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*MX(t)},n}();LX()&&Se.registerBackend("webgl",function(){return new Mbe},2);var Tbe=he({abs_:function(n){var e=te(n,"x","abs");return e.dtype==="complex64"?Se.runKernel(function(t){return t.complexAbs(e)},{$x:e}):Se.runKernel(function(t,r){var i=t.abs(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().step(-1))}}})}}),Rbe=he({acos_:function(n){var e=te(n,"x","acos");return Se.runKernel(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(pt(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),Abe=he({acosh_:function(n){var e=te(n,"x","acosh");return Se.runKernel(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),Ibe=he({asin_:function(n){var e=te(n,"x","asin");return Se.runKernel(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(pt(1).sub(i.toFloat().square()).sqrt())}}})}}),Pbe=he({asinh_:function(n){var e=te(n,"x","asinh");return Se.runKernel(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(pt(1).add(i.toFloat().square()).sqrt())}}})}}),kbe=he({atan_:function(n){var e=te(n,"x","atan");return Se.runKernel(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),Dbe=he({atanh_:function(n){var e=te(n,"x","atanh");return Se.runKernel(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(pt(1).sub(i.toFloat().square()))}}})}}),Nbe=he({ceil_:function(n){var e=te(n,"x","ceil");return Se.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),ND=he({clipByValue_:function(n,e,t){var r=te(n,"x","clipByValue");return oe(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),Se.runKernel(function(i,o){var s=i.clip(r,e,t);return o([r]),s},{$x:r},function(i,o){var s=o[0];return{$x:function(){return i.where(s.greaterEqual(e).logicalAnd(s.lessEqual(t)),Un(i))}}})}}),Lbe=he({cos_:function(n){var e=te(n,"x","cos");return Se.runKernel(function(t,r){var i=t.cos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sin().neg().mul(t)}}})}}),Fbe=he({cosh_:function(n){var e=te(n,"x","cosh");return Se.runKernel(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),Obe=he({erf_:function(n){var e=te(n,"x","erf");return oe(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),Se.runKernel(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),o4=he({exp_:function(n){var e=te(n,"x","exp");return Se.runKernel(function(t,r){var i=t.exp(e);return r([i]),i},{$x:e},function(t,r){return{$x:function(){return t.mulStrict(r[0])}}})}}),Bbe=he({expm1_:function(n){var e=te(n,"x","expm1");return Se.runKernel(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),Ube=he({floor_:function(n){var e=te(n,"x","floor");return Se.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),zbe=he({log_:function(n){var e=te(n,"x","log");return Se.runKernel(function(t,r){var i=t.log(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat())}}})}}),Vbe=he({log1p_:function(n){var e=te(n,"x","log1p");return Se.runKernel(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),Wbe=he({logSigmoid_:function(n){var e=te(n,"x","logSigmoid");return Se.runKernel(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),oS=he({neg_:function(n){var e=te(n,"x","neg");return Se.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),Hbe=he({reciprocal_:function(n){var e=te(n,"x","reciprocal");return Se.runKernel(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),Gbe=he({round_:function(n){var e=te(n,"x","round");return Se.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),uq=he({rsqrt_:function(n){var e=te(n,"x","rsqrt");return Se.runKernel(function(t,r){var i=t.rsqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}})}}),lq=he({sigmoid_:function(n){var e=te(n,"x","sigmoid");return Se.runKernel(function(t,r){var i=t.sigmoid(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.mul(pt(1).sub(i)))}}})}}),$be=he({sign_:function(n){var e=te(n,"x","sign");return Se.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),jbe=he({isNaN_:function(n){var e=te(n,"x","isNaN");return Se.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),Xbe=he({isInf_:function(n){var e=te(n,"x","isInf");return Se.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),qbe=he({isFinite_:function(n){var e=te(n,"x","isFinite");return Se.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Un(t)}}})}}),Ybe=he({sin_:function(n){var e=te(n,"x","sin");return Se.runKernel(function(t,r){var i=t.sin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cos().mul(t)}}})}}),Kbe=he({sinh_:function(n){var e=te(n,"x","sinh");return Se.runKernel(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),Zbe=he({softplus_:function(n){var e=te(n,"x","softplus");return Se.runKernel(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),Qbe=he({sqrt_:function(n){var e=te(n,"x","sqrt");return Se.runKernel(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),Jbe=he({square_:function(n){var e=te(n,"x","square");return Se.runKernel(function(t,r){return r([e]),t.square(e)},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().mul(2))}}})}}),eSe=he({step_:function(n,e){e===void 0&&(e=0);var t=te(n,"x","step");return Se.runKernel(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Un(r)}}})}}),tSe=he({tan_:function(n){var e=te(n,"x","tan");return Se.runKernel(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),nSe=he({tanh_:function(n){var e=te(n,"x","tanh");return Se.runKernel(function(t,r){var i=t.tanh(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return pt(1).sub(i.square()).mulStrict(t)}}})}});function cq(n,e,t,r,i,o){var s,a,u=te(n,"x","batchNorm"),l=te(e,"mean","batchNorm"),c=te(t,"variance","batchNorm");return i!=null&&(s=te(i,"scale","batchNorm")),r!=null&&(a=te(r,"offset","batchNorm")),oe(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),oe(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),oe(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),s!=null&&oe(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),a!=null&&oe(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),cx(u,l,c,a,s,o)}function hq(n,e,t,r,i,o){var s,a,u=te(n,"x","batchNorm"),l=te(e,"mean","batchNorm"),c=te(t,"variance","batchNorm");return i!=null&&(s=te(i,"scale","batchNorm")),r!=null&&(a=te(r,"offset","batchNorm")),oe(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),oe(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),oe(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),s!=null&&oe(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),a!=null&&oe(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),cx(u,l,c,a,s,o)}function fq(n,e,t,r,i,o){var s,a,u=te(n,"x","batchNorm"),l=te(e,"mean","batchNorm"),c=te(t,"variance","batchNorm");return i!=null&&(s=te(i,"scale","batchNorm")),r!=null&&(a=te(r,"offset","batchNorm")),oe(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),oe(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),oe(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),s!=null&&oe(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),a!=null&&oe(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),cx(u,l,c,a,s,o)}function cx(n,e,t,r,i,o){o==null&&(o=.001);var s,a,u,l=te(n,"x","batchNorm"),c=te(e,"mean","batchNorm"),h=te(t,"variance","batchNorm");return i!=null&&(s=te(i,"scale","batchNorm")),r!=null&&(a=te(r,"offset","batchNorm")),oe(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),oe(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),oe(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,Se.runKernel(function(f,d){var p=f.batchNormalization(u,Kw(c),Kw(h),o,Kw(s),Kw(a));return d([l,c,h,s]),p},{$x:l,$mean:c,$variance:h,$scale:s,$offset:a},function(f,d){var p=d,v=p[0],g=p[1],m=p[2],x=p[3],_=x??pt(1),b=Ii(g.shape,u.shape),S=[];if(g.rank===1){for(var E=0;E<u.shape.length-1;++E)S.push(u.shape[E]);S.push(1)}var C=v.sub(g),R=f.mul(_),T=uq(m.add(pt(o))),A=T.mul(T).mul(T).mul(pt(-.5));return{$x:function(){return g.rank===1?f.mul(mv(T.as4D(1,1,1,g.shape[0]),S)).mul(_).reshape(v.shape):f.mul(T).mul(_).reshape(v.shape)},$mean:function(){var P=T.mul(pt(-1)).mul(R);return g.rank===1&&(P=P.sum(b)),P.reshape(g.shape)},$variance:function(){var P=A.mul(C).mul(R);return g.rank===1&&(P=P.sum(b)),P.reshape(g.shape)},$scale:function(){var P=C.mul(T),k=f.mul(P);return g.rank===1&&(k=k.sum(b)),k.reshape(g.shape)},$offset:function(){var P=f;return g.rank===1&&(P=P.sum(b)),P.reshape(g.shape)}}}).reshape(l.shape)}function Kw(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function FE(){OX("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var rSe=he({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),FE(),cq(n,e,t,o,i,r)}}),iSe=he({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),FE(),hq(n,e,t,o,i,r)}}),oSe=he({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),FE(),fq(n,e,t,o,i,r)}}),sSe=he({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),FE(),cx(n,e,t,o,i,r)}}),dq=he({batchNorm_:cx}),aSe=he({batchNorm2d_:cq}),uSe=he({batchNorm3d_:hq}),lSe=he({batchNorm4d_:fq});function pq(n,e,t,r,i,o){oe(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var s=n,a=e,u=!1;e.rank===3&&(u=!0,a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,n[0],n[1],n[2]]);var l=s[3],c=a.shape[3];oe(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),oe(a.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+a.rank}),oe(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}),oe(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),oe(c===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&oe(ja(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=ax(s,t.shape,r,1,i,o),f=Se.runKernel(function(d,p){var v=d.conv2dDerInput(a,t,h);return p([t,a]),v},{dy4D:a,filter:t},function(d,p){var v=p[0],g=p[1];return{dy4D:function(){return Tc(d,v,r,i,"NHWC",1,o)},filter:function(){return vq(d,g,v.shape,r,i,o)}}});return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function mq(n,e,t,r,i,o){var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e;a.rank===3&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),oe(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),oe(a.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+a.shape+"."}),oe(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),oe(s.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+s.shape[3]+") must match input depth in filter ("+t[2]+"."}),oe(a.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+a.shape[3]+") must match output depth for filter ("+t[3]+")."}),o!=null&&oe(ja(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=ax(s.shape,t,r,1,i,o);return Se.runKernel(function(l){return l.conv2dDerFilter(s,a,u)},{x4D:s,dy4D:a})}function IT(n){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}var cSe=he({conv1d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NWC"),o===void 0&&(o=1);var a=te(n,"x","conv1d"),u=te(e,"filter","conv1d"),l=a,c=!1;a.rank===2&&(c=!0,l=a.as3D(1,a.shape[0],a.shape[1])),oe(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),oe(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),s!=null&&oe(ja(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),oe(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),oe(Kh(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),oe(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=Tc(f,h,[1,t],r,"NHWC",[1,o],s);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Tc=he({conv2d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var a=te(n,"x","conv2d"),u=te(e,"filter","conv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),oe(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),oe(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),s!=null&&oe(ja(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),oe(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),oe(Kh(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),oe(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var h=ax(l.shape,u.shape,t,o,r,s),f=Se.runKernel(function(d,p){var v=d.conv2d(l,u,h);return p([u,l]),v},{x:l,$filter:u},function(d,p){var v=p,g=v[0],m=v[1];return oe(iS(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return pq(m.shape,d,g,t,r)},$filter:function(){return mq(m,d,g.shape,t,r)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),hSe=he({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var s=te(n,"x","conv3d"),a=te(e,"filter","conv3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),oe(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),oe(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),oe(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),oe(function(f,d){return IT(f)||IT(d)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),oe(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=bT(u.shape,a.shape,t,o,r),h=Se.runKernel(function(f,d){var p=f.conv3d(u,a,c);return d([u,a]),p},{x:u,$filter:a},function(f,d){oe(IT(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=d[0],v=d[1];return{x:function(){return function(g,m,x,_,b){oe(g.length===m.rank,function(){return"Length of inShape ("+g.length+") and rank of dy ("+m.rank+") must match"});var S=g,E=m,C=!1;m.rank===4&&(C=!0,E=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]),S=[1,g[0],g[1],g[2],g[3]]);var R=S[4],T=E.shape[4];oe(S.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+S.length+"."}),oe(E.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+E.rank}),oe(x.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+x.rank}),oe(R===x.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+R+") must match input depth for filter "+x.shape[3]+"."}),oe(T===x.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+T+") must match output depth for filter "+x.shape[4]+"."});var A=bT(S,x.shape,_,1,b),P=Se.runKernel(function(k){return k.conv3dDerInput(E,x,A)},{dy5D:E});return C?P.as4D(P.shape[1],P.shape[2],P.shape[3],P.shape[4]):P}(p.shape,f,v,t,r)},$filter:function(){return function(g,m,x,_,b){var S=g;g.rank===4&&(S=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var E=m;E.rank===4&&(E=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),oe(S.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+S.shape+"."}),oe(E.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."}),oe(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),oe(S.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+S.shape[4]+") must match input depth in filter ("+x[3]+"."}),oe(E.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+x[4]+")."});var C=bT(S.shape,x,_,1,b);return Se.runKernel(function(R){return R.conv3dDerFilter(S,E,C)},{x5D:S,dy5D:E})}(p,f,v.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),vq=he({conv2dDerFilter_:mq}),LD=he({depthwiseConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]);var a=te(n,"x","depthwiseConv2d"),u=te(e,"filter","depthwiseConv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),oe(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),oe(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),oe(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),oe(Kh(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&oe(ja(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var h=ax(l.shape,u.shape,t,o,r,s,!0),f=Se.runKernel(function(d,p){var v=d.depthwiseConv2D(l,u,h);return p([l,u]),v},{x:l,$filter:u},function(d,p){oe(iS(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var v=p[0],g=p[1];return{x:function(){return function(m,x,_,b){var S=x,E=!1;x.rank===3&&(E=!0,S=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var C=Se.runKernel(function(R){return R.depthwiseConv2DDerInput(S,_,b)},{dy4D:S});return E?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}(v.shape,d,g,h)},$filter:function(){return function(m,x,_,b){var S=m;m.rank===3&&(S=m.as4D(1,m.shape[0],m.shape[1],m.shape[2]));var E=x;return E.rank===3&&(E=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),Se.runKernel(function(C){return C.depthwiseConv2DDerFilter(S,E,b)},{x4D:S,dy4D:E})}(v,d,g.shape,h)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),gq=he({separableConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC");var a=te(n,"x","separableConv2d"),u=te(e,"depthwiseFilter","separableConv2d"),l=te(t,"pointwiseFilter","separableConv2d"),c=a,h=!1;if(a.rank===3&&(h=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");oe(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),oe(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),oe(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),oe(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),oe(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],d=u.shape[3];oe(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var p=LD(c,u,r,i,s,o),v=Tc(p,l,1,"valid",s);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),fSe=he({conv2dTranspose_:function(n,e,t,r,i,o){return pq(t,te(n,"x","conv2dTranspose"),te(e,"filter","conv2dTranspose"),r,i,o)}}),FD=he({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=te(n,"a","matMul"),s=te(e,"b","matMul");i=Ai(o,s),o=i[0],s=i[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],h=o.shape.slice(0,-2),f=s.shape.slice(0,-2),d=Vt(h),p=Vt(f);oe(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),oe(Po(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),oe(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var v=o.shape.slice(0,-2).concat([l,c]),g=t?o.as3D(d,a,l):o.as3D(d,l,a),m=r?s.as3D(p,c,u):s.as3D(p,u,c);return Se.runKernel(function(x,_){var b=x.batchMatMul(g,m,t,r);return _([g,m]),b},{$a:g,$b:m},function(x,_){var b=_,S=b[0],E=b[1];return t||r?!t&&r?{$a:function(){return x.matMul(E,!1,!1)},$b:function(){return x.matMul(S,!0,!1)}}:t&&!r?{$a:function(){return E.matMul(x,!1,!0)},$b:function(){return S.matMul(x,!1,!1)}}:{$a:function(){return E.matMul(x,!0,!0)},$b:function(){return x.matMul(S,!0,!0)}}:{$a:function(){return x.matMul(E,!1,!0)},$b:function(){return S.matMul(x,!0,!1)}}}).reshape(v)}}),dSe=he({dot_:function(n,e){var t=te(n,"t1","dot"),r=te(e,"t2","dot");oe(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return oe(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),pSe=he({outerProduct_:function(n,e){var t=te(n,"v1","outerProduct"),r=te(e,"v2","outerProduct");return oe(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),hx=he({reverse_:function(n,e){var t=te(n,"x","reverse");if(t.rank===0)return t.clone();var r=ao(e,t.shape);return Se.runKernel(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),mSe=he({reverse1d_:function(n){var e=te(n,"x","reverse");return oe(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),hx(e,0)}}),vSe=he({reverse2d_:function(n,e){var t=te(n,"x","reverse");return oe(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),hx(t,e)}}),gSe=he({reverse3d_:function(n,e){var t=te(n,"x","reverse");return oe(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),hx(t,e)}}),ySe=he({reverse4d_:function(n,e){var t=te(n,"x","reverse");return oe(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),hx(t,e)}});function yq(n,e,t,r,i,o){var s=te(n,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),oe(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),oe(Kh(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&oe(ja(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=b1(a.shape,e,t,r,i,o),c=Se.runKernel(function(h,f){var d=h.maxPool(a,l);return f([a,d]),d},{x:a},function(h,f){var d=f[0],p=f[1];return{x:function(){return function(v,g,m,x,_,b,S,E){var C=te(v,"dy","maxPoolBackprop"),R=te(g,"input","maxPoolBackprop"),T=te(m,"output","maxPoolBackprop");oe(R.rank===C.rank,function(){return"Rank of input ("+R.rank+") does not match rank of dy ("+C.rank+")"}),oe(Kh(_,b),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+b+"'"}),oe(C.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+C.rank+"."}),oe(R.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+R.rank+"."});var A=b1(R.shape,x,_,b,S,E);return Se.runKernel(function(P){return P.maxPoolBackprop(C,R,T,A)},{$dy:C,$input:R})}(h,d,p,e,t,r,i)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function xq(n,e,t,r,i,o){var s=te(n,"x","avgPool","float32");oe(Kh(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),oe(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),o!=null&&oe(ja(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=b1(a.shape,e,t,r,i,o),c=Se.runKernel(function(h){return h.avgPool(a,l)},{x:a},function(h){return{x:function(){return function(f,d,p,v,g,m){var x=te(f,"dy","avgPoolBackprop"),_=te(d,"input","avgPoolBackprop");oe(_.rank===x.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+x.rank+")"}),oe(Kh(v,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"});var b=_,S=x,E=!1;_.rank===3&&(E=!0,b=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),S=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),oe(S.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),oe(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var C=b1(b.shape,p,v,g,m),R=Se.runKernel(function(T){return T.avgPoolBackprop(S,b,C)},{dy4D:S,input4D:b});return E?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}(h,a,e,t,r,i)}}});return c=c.cast(s.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Yv=he({maxPool_:function(n,e,t,r,i){return yq(n,e,t,1,r,i)}}),fx=he({avgPool_:function(n,e,t,r,i){return xq(n,e,t,1,r,i)}}),xSe=he({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var s=te(n,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),oe(Kh(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=b1(a.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(b,S){var E=b.map(function(T,A){return T+(T-1)*(S[A]-1)}).map(function(T){return T-1}),C=E.map(function(T){return Math.floor(T/2)}),R=E.map(function(T,A){return T-C[A]});return E.map(function(T,A){return[C[A],R[A]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,d=function(b,S,E){var C=E.map(function(N){return N[0]}),R=E.map(function(N){return N[1]}),T=b.concat(C,R),A=S.map(function(N,O){return(N-T[O]%N)%N}),P=R.map(function(N,O){return N+A[O]}),k=S.map(function(N,O){return[C[O],P[O]]}),W=S.map(function(N,O){return[0,A[O]]});return[k,W]}([c.inHeight,c.inWidth],h,l),p=d[0],v=d[1],g=f?r:"valid",m=f?a:$X(a,h,p),x=(t==="avg"?function(){return xq(m,e,o,1,g)}:function(){return yq(m,e,o,1,g)})(),_=f?x:WX(x,h,v);return u?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),wl=he({slice_:function(n,e,t){var r,i,o=te(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice(),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(a,u){return a>=0?a:(oe(a===-1,function(){return"Bad value in size"}),o.shape[u]-r[u])}),function(a,u,l){oe(a.rank===u.length,function(){return"Error in slice"+a.rank+"D: Length of begin "+u+" must match the rank of the array ("+a.rank+")."}),oe(a.rank===l.length,function(){return"Error in slice"+a.rank+"D: Length of size "+l+" must match the rank of the array ("+a.rank+")."});for(var c=function(f){oe(u[f]+l[f]<=a.shape[f],function(){return"Error in slice"+a.rank+"D: begin["+f+"] + size["+f+"] ("+(u[f]+l[f])+") would overflow input.shape["+f+"] ("+a.shape[f]+")"})},h=0;h<a.rank;++h)c(h)}(o,r,i);var s=o.shape;return Se.runKernel(function(a){return a.slice(o,r,i)},{$x:o},function(a){for(var u=[],l=0;l<a.rank;l++)u.push([r[l],s[l]-r[l]-i[l]]);return{$x:function(){return a.pad(u)}}})}}),wSe=he({slice1d_:function(n,e,t){var r=te(n,"x","slice1d");return oe(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),wl(r,[e],[t])}}),_Se=he({slice2d_:function(n,e,t){var r=te(n,"x","slice2d");return oe(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),wl(r,e,t)}}),wq=he({slice3d_:function(n,e,t){var r=te(n,"x","slice3d");return oe(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),wl(r,e,t)}}),bSe=he({slice4d_:function(n,e,t){var r=te(n,"x","slice4d");return oe(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),wl(r,e,t)}});function _q(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(Xa(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Xa(n.shape,r))),{$x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var SSe=he({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","all","bool"),i=ao(e,r.shape),o=i,s=El(o,r.rank);s!=null&&(r=r.transpose(s),o=Cl(o.length,r.rank));var a=Se.runKernel(function(l){return l.all(r,o)},{$x:r});if(t){var u=Xa(a.shape,i);return a.reshape(u)}return a}}),ESe=he({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","any","bool"),i=ao(e,r.shape),o=i,s=El(o,r.rank);s!=null&&(r=r.transpose(s),o=Cl(o.length,r.rank));var a=Se.runKernel(function(l){return l.any(r,o)},{$x:r});if(t){var u=Xa(a.shape,i);return a.reshape(u)}return a}}),CSe=he({argMax_:function(n,e){e===void 0&&(e=0);var t=te(n,"x","argMax");e==null&&(e=0);var r=ao(e,t.shape),i=El(r,t.rank);return i!=null&&(t=t.transpose(i),r=Cl(r.length,t.rank)),Se.runKernel(function(o,s){var a=o.argMax(t,r[0]);return s([t]),a},{$x:t},function(o,s){var a=s[0];return{$x:function(){return Un(a)}}})}}),MSe=he({argMin_:function(n,e){e===void 0&&(e=0);var t=te(n,"x","argMin");e==null&&(e=0);var r=ao(e,t.shape),i=El(r,t.rank);return i!=null&&(t=t.transpose(i),r=Cl(r.length,t.rank)),Se.runKernel(function(o,s){var a=o.argMin(t,r[0]);return s([t]),a},{$x:t},function(o,s){var a=s[0];return{$x:function(){return Un(a)}}})}}),TSe=he({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","logSumExp"),i=ao(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(t){var u=Xa(a.shape,i);return a.reshape(u)}return a}}),OE=he({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","max"),i=r,o=ao(e,r.shape),s=o,a=El(s,r.rank);a!=null&&(r=r.transpose(a),s=Cl(s.length,r.rank));var u=Se.runKernel(function(c,h){var f=c.max(r,s);return h([i,f]),f},{$x:r},function(c,h){return _q(c,h[1],h[0],o,a)});if(t){var l=Xa(u.shape,o);u=u.reshape(l)}return u}}),RSe=he({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","mean"),i=ao(e,r.shape),o=Vt(wo(r.shape,i)[1]);return sx(function(s){var a=pt(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(u){var l=s.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(yg(s.shape,"float32")).div(o)}}})(r)}}),ASe=he({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","min"),i=r,o=ao(e,r.shape),s=o,a=El(s,r.rank);a!=null&&(r=r.transpose(a),s=Cl(s.length,r.rank));var u=Se.runKernel(function(c,h){var f=c.min(r,s);return h([i,f]),f},{$x:r},function(c,h){return _q(c,h[1],h[0],o,a)});if(t){var l=Xa(u.shape,o);u=u.reshape(l)}return u}}),ISe=he({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=ao(e,(n=te(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=Xa(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,t)}}}),bq=he({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=ao(e,r.shape);return sx(function(o){var s=El(i,o.rank),a=i,u=o;s!=null&&(u=o.transpose(s),a=Cl(a.length,o.rank));var l=Se.runKernel(function(h){return h.sum(u,a)},{permutedX:u});if(t){var c=Xa(l.shape,i);l=l.reshape(c)}return{value:l,gradFunc:function(h){var f=o.shape.slice();return i.forEach(function(d){f[d]=1}),h.reshape(f).mul(yg(o.shape,"float32"))}}})(r)}}),PSe=he({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=te(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=ao(e,r.shape),o=El(i,r.rank),s=i,a=r;o!=null&&(a=r.transpose(o),s=Cl(s.length,r.rank));var u=Se.runKernel(function(c){return c.prod(a,s)},{permutedX:a});if(t){var l=Xa(u.shape,i);u=u.reshape(l)}return u}}),Sq=he({equal_:function(n,e){var t,r=te(n,"a","equal"),i=te(e,"b","equal");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),kSe=he({equalStrict_:function(n,e){var t=te(n,"a","equalStrict"),r=te(e,"b","equalStrict");return rr(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),DSe=he({greater_:function(n,e){var t,r=te(n,"a","greater"),i=te(e,"b","greater");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o){return o.greater(r,i)},{$a:r,$b:i})}}),Eq=he({greaterEqual_:function(n,e){var t,r=te(n,"a","greaterEqual"),i=te(e,"b","greaterEqual");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{$a:r,$b:i},function(o,s){var a=s[0],u=s[1];return{$a:function(){return Un(a)},$b:function(){return Un(u)}}})}}),NSe=he({greaterEqualStrict_:function(n,e){var t=te(n,"a","greaterEqualStrict"),r=te(e,"b","greaterEqualStrict");return rr(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),LSe=he({greaterStrict_:function(n,e){var t=te(n,"a","greaterStrict"),r=te(e,"b","greaterStrict");return rr(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),FSe=he({less_:function(n,e){var t,r=te(n,"a","less"),i=te(e,"b","less");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o){return o.less(r,i)},{$a:r,$b:i})}}),OSe=he({lessEqual_:function(n,e){var t,r=te(n,"a","lessEqual"),i=te(e,"b","lessEqual");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o){return o.lessEqual(r,i)},{$a:r,$b:i})}}),BSe=he({lessEqualStrict_:function(n,e){var t=te(n,"a","lessEqualStrict"),r=te(e,"b","lessEqualStrict");return rr(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),USe=he({lessStrict_:function(n,e){var t=te(n,"a","lessStrict"),r=te(e,"b","lessStrict");return rr(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),zSe=he({notEqual_:function(n,e){var t,r=te(n,"a","notEqual"),i=te(e,"b","notEqual");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o){return o.notEqual(r,i)},{$a:r,$b:i})}}),VSe=he({notEqualStrict_:function(n,e){var t=te(n,"a","notEqualStrict"),r=te(e,"b","notEqualStrict");return rr(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}}),jn=he({add_:function(n,e){var t,r=te(n,"a","add"),i=te(e,"b","add");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s){return s.add(r,i)},{$a:r,$b:i},function(s){return{$a:function(){var a=s,u=Ii(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},$b:function(){var a=s,u=Ii(i.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(i.shape)}}})}}),WSe=he({addN_:function(n){oe(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),oe(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return te(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Po(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return Se.runKernel(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(s,a){o[a]=function(){return i.clone()}}),o})}}),HSe=he({addStrict_:function(n,e){var t=te(n,"a","addStrict"),r=te(e,"b","addStrict");return rr(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),GSe=he({atan2_:function(n,e){var t,r=te(n,"a","atan2"),i=te(e,"b","atan2");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=jn(u.square(),l.square()),h=s.mul(l.div(c)),f=Ii(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=jn(u.square(),l.square()),h=oS(s.mul(u.div(c))),f=Ii(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),Zu=he({div_:function(n,e){var t,r=te(n,"a","div"),i=te(e,"b","div");if(t=Ai(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return Cq(r,i);var o=kn(r.shape,i.shape);return Se.runKernel(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=s.div(l.toFloat()),h=Ii(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=s.mul(u.toFloat()),h=Ii(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),$Se=he({divStrict_:function(n,e){var t=te(n,"a","div"),r=te(e,"b","div");return rr(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),Cq=he({floorDiv_:function(n,e){var t,r=te(n,"a","floorDiv"),i=te(e,"b","floorDiv");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=s.div(l.toFloat()),h=Ii(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=s.mul(u.toFloat()),h=Ii(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),OD=he({maximum_:function(n,e){var t,r=te(n,"a","maximum"),i=te(e,"b","maximum");return t=Ai(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),kn(r.shape,i.shape),Se.runKernel(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{$a:r,$b:i},function(o,s){var a=s[0],u=s[1];return{$a:function(){return o.mul(a.greaterEqual(u).toFloat())},$b:function(){return o.mul(a.less(u).toFloat())}}})}}),jSe=he({maximumStrict_:function(n,e){var t=te(n,"a","maximumStrict"),r=te(e,"b","maximumStrict");return rr(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),Mq=he({minimum_:function(n,e){var t,r=te(n,"a","minimum"),i=te(e,"b","minimum");return t=Ai(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),kn(r.shape,i.shape),Se.runKernel(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{$a:r,$b:i},function(o,s){var a=s[0],u=s[1];return{$a:function(){return o.mul(a.lessEqual(u).toFloat())},$b:function(){return o.mul(a.greater(u).toFloat())}}})}}),XSe=he({minimumStrict_:function(n,e){var t=te(n,"a","minimumStrict"),r=te(e,"b","minimumStrict");return rr(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),qSe=he({mod_:function(n,e){var t,r=te(n,"a","mod"),i=te(e,"b","mod");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=Ii(u.shape,o);return c.length>0?s.sum(c).reshape(u.shape):s},$b:function(){var c=s.mul(u.div(l).floor().neg()),h=Ii(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),YSe=he({modStrict_:function(n,e){var t=te(n,"a","modStrict"),r=te(e,"b","modStrict");return rr(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),nc=he({mul_:function(n,e){var t,r=te(n,"a","mul"),i=te(e,"b","mul");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=s.mul(l.toFloat()),h=Ii(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=s.mul(u.toFloat()),h=Ii(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),KSe=he({mulStrict_:function(n,e){var t=te(n,"a","mul"),r=te(e,"b","mul");return rr(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),sS=he({pow_:function(n,e){var t=te(n,"base","pow"),r=te(e,"exp","pow"),i=kn(t.shape,r.shape);return n=t.cast(bi(t.dtype,r.dtype)),e=r.cast(bi(t.dtype,r.dtype)),Se.runKernel(function(o,s){var a=o.pow(t,r);return s([t,r,a]),a},{$base:t,$exp:r},function(o,s){var a=s[0],u=s[1],l=s[2];return{$base:function(){var c=u.toFloat(),h=o.mul(c.mul(a.pow(c.sub(pt(1))))),f=Ii(a.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(a.shape)},$exp:function(){var c=a.greater(0),h=a.log().where(c,Un(a)),f=o.mul(l.mul(h)),d=Ii(u.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)}}})}}),ZSe=he({powStrict_:function(n,e){return rr(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),QSe=he({squaredDifference_:function(n,e){var t,r=te(n,"a","squaredDifference"),i=te(e,"b","squaredDifference");return t=Ai(r,i),r=t[0],i=t[1],kn(r.shape,i.shape),Se.runKernel(function(o,s){var a=o.squaredDifference(r,i);return s([r,i]),a},{$a:r,$b:i},function(o,s){var a=s[0],u=s[1],l=pt(2);return{$a:function(){return o.mul(a.sub(u).mul(l))},$b:function(){return o.mul(u.sub(a).mul(l))}}})}}),JSe=he({squaredDifferenceStrict_:function(n,e){var t=te(n,"a","squaredDifferenceStrict"),r=te(e,"b","squaredDifferenceStrict");return rr(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Is=he({sub_:function(n,e){var t,r=te(n,"a","sub"),i=te(e,"b","sub");t=Ai(r,i),r=t[0],i=t[1];var o=kn(r.shape,i.shape);return Se.runKernel(function(s){return s.subtract(r,i)},{$a:r,$b:i},function(s){return{$a:function(){var a=s,u=Ii(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},$b:function(){var a=s,u=Ii(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}})}}),eEe=he({subStrict_:function(n,e){var t=te(n,"a","subStrict"),r=te(e,"b","subStrict");return rr(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),BD=he({logicalAnd_:function(n,e){var t=te(n,"a","logicalAnd","bool"),r=te(e,"b","logicalAnd","bool");return kn(t.shape,r.shape),Se.runKernel(function(i){return i.logicalAnd(t,r)},{$a:t,$b:r})}}),tEe=he({logicalNot_:function(n){var e=te(n,"x","logicalNot","bool");return Se.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),Tq=he({logicalOr_:function(n,e){var t=te(n,"a","logicalOr","bool"),r=te(e,"b","logicalOr","bool");return kn(t.shape,r.shape),Se.runKernel(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),nEe=he({logicalXor_:function(n,e){var t=te(n,"a","logicalXor","bool"),r=te(e,"b","logicalXor","bool");return kn(t.shape,r.shape),Tq(n,e).logicalAnd(BD(n,e).logicalNot())}}),S1=he({where_:function(n,e,t){var r=te(e,"a","where"),i=te(t,"b","where"),o=te(n,"condition","where","bool");return rr(r.shape,i.shape,"Error in where: "),o.rank===1?oe(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):rr(o.shape,i.shape,"Error in where: "),Se.runKernel(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return Un(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),rEe=function(n){return Zt(this,void 0,void 0,function(){var e,t,r;return Qt(this,function(i){switch(i.label){case 0:return[4,(e=te(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=ID(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},iEe=he({elu_:function(n){var e=te(n,"x","elu");return Se.runKernel(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return Se.runKernel(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),oEe=he({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=te(n,"x","leakyRelu");return OD(pt(e).mul(t),t)}}),sEe=he({prelu_:function(n,e){var t=te(n,"x","prelu"),r=te(e,"alpha","prelu");return Se.runKernel(function(i,o){var s=i.prelu(t,r);return o([t,r]),s},{$x:t,$alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{$x:function(){return S1(u,i,i.mul(a))},$alpha:function(){var l=S1(u,Un(i),i.mul(s)),c=Ii(a.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}})}}),di=he({relu_:function(n){var e=te(n,"x","relu");return e.dtype==="bool"?e.toInt():Se.runKernel(function(t,r){var i=t.relu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mulStrict(i.step().toFloat())}}})}}),aEe=he({selu_:function(n){var e=te(n,"x","selu");return Se.runKernel(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(pt(0)),s=pt(kD),a=pt(DD),u=t.mul(a),l=t.mul(s).mul(i.toFloat().exp());return S1(o,u,l)}}})}}),Zh=he({transpose_:function(n,e){var t=te(n,"x","transpose");return e==null&&(e=t.shape.map(function(r,i){return i}).reverse()),oe(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(r){oe(r>=0&&r<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():Se.runKernel(function(r){return r.transpose(t,e)},{$x:t},function(r){var i=ED(e);return{$x:function(){return r.transpose(i)}}})}}),uEe=he({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=te(n,"x","localResponseNormalization");oe(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),oe(ja(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;o.rank===3&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=Se.runKernel(function(l,c){var h=l.localResponseNormalization4D(s,e,t,r,i);return c([s,h]),h},{x4D:s},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return Se.runKernel(function(d){return d.LRNGrad(l,h,f,e,t,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Rq=he({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function a(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return a(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(pt(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=te(n,"x","norm"),e,t),o=i.shape;if(r){var s=ao(t,n.shape);o=Xa(i.shape,s)}return i.reshape(o)}});function S6(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function E6(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Aq=he({gather_:function(n,e,t){t===void 0&&(t=0);var r=te(n,"x","gather"),i=te(e,"indices","gather","int32");t=ao(t,r.shape)[0];var o=function(s,a,u){for(var l=s.shape[u],c=[],h=1,f=1,d=0;d<u;d++)c.push(s.shape[d]),h*=s.shape[d];for(d=0;d<a.rank;d++)c.push(a.shape[d]);for(d=u+1;d<s.rank;d++)c.push(s.shape[d]),f*=s.shape[d];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}}(r,i,t);return Se.runKernel(function(s,a){var u=s.gather(r,i.flatten(),t);return a([i]),u},{$x:r},function(s,a){var u=a[0];return{$x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),f=h.length,d=l.slice(t,l.length).slice(1),p=d.length,v=S6(0,f),g=S6(f+1,f+1+p),m=E6([h,[c],d]),x=s.reshape(m),_=u.reshape([c]),b=E6([[f],v,g]),S=x.transpose(b),E=Iq(S,_,r.shape[t]),C=ED(b);return E=E.transpose(C)}}}).reshape(o.outputShape)}}),Iq=he({unsortedSegmentSum_:function(n,e,t){var r=te(n,"x","unsortedSegmentSum"),i=te(e,"segmentIds","unsortedSegmentSum","int32");return oe(ja(t),function(){return"numSegments must be of dtype int"}),Se.runKernel(function(o,s){var a=o.unsortedSegmentSum(r,i,t);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,l){for(var c=OD(l,Un(l)),h=Aq(u,c),f=Eq(l,pt(0,"int32")),d=h.rank-f.rank,p=0;p<d;++p)f=Da(f,p+1);f=BD(f,yg(h.shape,"bool"));var v=Un(h);return S1(f,h,v)}(o,a)}}})}}),lEe=he({basicLSTMCell_:function(n,e,t,r,i,o){var s=te(n,"forgetBias","basicLSTMCell"),a=te(e,"lstmKernel","basicLSTMCell"),u=te(t,"lstmBias","basicLSTMCell"),l=te(r,"data","basicLSTMCell"),c=te(i,"c","basicLSTMCell"),h=te(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(a).add(u),d=f.shape[0],p=f.shape[1]/4,v=[d,p],g=f.slice([0,0],v),m=f.slice([0,p],v),x=f.slice([0,2*p],v),_=f.slice([0,3*p],v),b=g.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(s.add(x).sigmoid())),S=b.tanh().mulStrict(_.sigmoid());return[b,S]}}),cEe=he({multiRNNCell_:function(n,e,t,r){for(var i=te(e,"data","multiRNNCell"),o=Qb(t,"c","multiRNNCell"),s=Qb(r,"h","multiRNNCell"),a=i,u=[],l=0;l<n.length;l++){var c=n[l](a,o[l],s[l]);u.push(c[0]),u.push(c[1]),a=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),hEe=he({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=te(n,"v","movingAverage"),s=te(e,"x","movingAverage"),a=te(t,"decay","movingAverage");g2e(o,s),oe(Po(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=pt(1),l=u.sub(a),c=s.sub(o).mul(l);if(i){oe(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=te(r,"step","movingAverage");c=c.div(u.sub(sS(a,h)))}return o.add(c)}}),fEe=he({stridedSlice_:function(n,e,t,r,i,o,s,a,u){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),s!==0)throw new Error("ellipsis mask is not yet supported");if(a!==0)throw new Error("new axis mask is not yet supported");var l=te(n,"x","stridedSlice");if(r.every(function(v){return v===1})){var c=RD(l.shape,e,t,r,i,o,s,a,u),h=c[0],f=c[1],d=c[2],p=f.filter(function(v,g){return d.indexOf(g)===-1});return wl(l,h,f).reshape(p)}return Se.runKernel(function(v){return v.stridedSlice(l,e,t,r,i,o,s,a,u)},{$x:l})}}),dEe=he({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=te(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=Se.runKernel(function(s){return s.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),pEe=he({scatterND_:function(n,e,t){var r=te(n,"indices","scatterND","int32"),i=te(e,"updates","scatterND");return Ewe(i,r,t),Se.runKernel(function(o){return o.scatterND(r,i,t)},{$indices:r,$updates:i})}}),UD=he({fft_:function(n){oe(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Se.runKernel(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),aS=he({ifft_:function(n){oe(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return Se.runKernel(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),Pq=he({rfft_:function(n,e){oe(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map(function(m){return 0}),s=n.shape.map(function(m){return m});s[n.shape.length-1]=e,t=n.slice(o,s),r=e}else if(e!=null&&e>r){var a=n.shape.map(function(m){return m});a[n.shape.length-1]=e-r,t=n.concat(Mr(a),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=$o(t,u).as2D(i,r),c=UD(l),h=Math.floor(r/2)+1,f=ul(c),d=yh(c),p=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=h,$o(p[0],v[0]).reshape(g)}}),kq=he({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=aS(r);return ul(i)}var o=[t,2*(e-1)],s=ul(n).as2D(t,e),a=yh(n).as2D(t,e),u=s.slice([0,1],[t,e-2]).reverse(1),l=a.slice([0,1],[t,e-2]).reverse(1).mul(pt(-1)),c=s.concat(u,1),h=a.concat(l,1);return r=$o(c,h).as2D(o[0],o[1]),i=aS(r),ul(i)}}),mEe=Object.freeze({fft:UD,ifft:aS,rfft:Pq,irfft:kq}),vEe=he({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=te(n,"sparseIndices","sparseToDense","int32"),o=te(e,"sparseValues","sparseToDense"),s=te(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,l,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var h=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,s),Se.runKernel(function(a){return a.sparseToDense(i,o,t,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),gEe=he({gatherND_:function(n,e){var t=te(e,"indices","gatherND","int32"),r=te(n,"x","gatherND");return Se.runKernel(function(i){return i.gatherND(r,t)},{$x:r,$indices:t})}}),yEe=he({dropout_:function(n,e,t,r){if(t!=null&&!Po(n.shape,t))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(t));var i=GX(n.shape,0,1,"float32",r).greater(e);return i=i.div(Is(1,e)),n.mul(i)}});function Dq(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(s)}return fs(i,"float32")}var Mo,Nq=he({hannWindow_:function(n){return Dq(n,.5,.5)}}),Lq=he({hammingWindow_:function(n){return Dq(n,.54,.46)}}),Fq=he({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,s=[];o+e<=n.size;)s.push(wl(n,o,e)),o+=t;if(r){var a=o+e-n.size,u=ko([wl(n,o,e-a),pv([a],i)]);s.push(u)}return s.length===0?ix([],[0,e]):ko(s).as2D(s.length,e)}}),xEe=Object.freeze({hannWindow:Nq,hammingWindow:Lq,frame:Fq});(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mo||(Mo={}));var wEe=he({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var i=te(n,"labels","absoluteDifference"),o=te(e,"predictions","absoluteDifference"),s=null;t!=null&&(s=te(t,"weights","absoluteDifference")),rr(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Rc(a,s,r)}}),Rc=he({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Mo.SUM_BY_NONZERO_WEIGHTS);var r=te(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=te(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Mo.NONE)return o;if(t===Mo.SUM)return o.sum();if(t===Mo.MEAN){if(i==null)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(pt(s)):a}if(t===Mo.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(pt(r.size));var u=i.mul(yg(r.shape)).notEqual(pt(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),_Ee=he({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Mo.SUM_BY_NONZERO_WEIGHTS);var o=te(n,"labels","cosineDistance"),s=te(e,"predictions","cosineDistance"),a=null;r!=null&&(a=te(r,"weights","cosineDistance")),rr(o.shape,s.shape,"Error in cosineDistance: ");var u=pt(1).sub(o.mul(s).sum(t,!0));return Rc(u,a,i)}}),bEe=he({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var i=te(n,"labels","hingeLoss"),o=te(e,"predictions","hingeLoss"),s=null;t!=null&&(s=te(t,"weights","hingeLoss")),rr(i.shape,o.shape,"Error in hingeLoss: ");var a=pt(1);i=pt(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Rc(u,s,r)}}),SEe=he({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Mo.SUM_BY_NONZERO_WEIGHTS);var o=te(n,"labels","huberLoss"),s=te(e,"predictions","huberLoss"),a=null;t!=null&&(a=te(t,"weights","huberLoss")),rr(o.shape,s.shape,"Error in huberLoss: ");var u=pt(r),l=s.sub(o).abs(),c=Mq(l,u),h=l.sub(c),f=pt(.5).mul(c.square()).add(u.mul(h));return Rc(f,a,i)}}),EEe=he({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Mo.SUM_BY_NONZERO_WEIGHTS);var o=te(n,"labels","logLoss"),s=te(e,"predictions","logLoss"),a=null;t!=null&&(a=te(t,"weights","logLoss")),rr(o.shape,s.shape,"Error in logLoss: ");var u=pt(1),l=pt(r),c=o.mul(s.add(l).log()).neg().sub(u.sub(o).mul(u.sub(s).add(l).log()));return Rc(c,a,i)}}),CEe=he({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Mo.SUM_BY_NONZERO_WEIGHTS);var i=te(n,"labels","meanSquaredError"),o=te(e,"predictions","meanSquaredError"),s=null;t!=null&&(s=te(t,"weights","meanSquaredError")),rr(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Rc(a,s,r)}}),MEe=he({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Mo.SUM_BY_NONZERO_WEIGHTS);var o=te(n,"multiClassLabels","sigmoidCrossEntropy"),s=te(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=te(t,"weights","sigmoidCrossEntropy")),rr(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=pt(r),l=pt(1),c=pt(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=function(f,d){var p=te(f,"labels","sigmoidCrossEntropyWithLogits"),v=te(d,"logits","sigmoidCrossEntropyWithLogits");rr(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=v.relu(),m=v.mul(p),x=v.abs().neg().exp().log1p();return g.sub(m).add(x)}(o,s);return Rc(h,a,i)}}),TEe=he({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Mo.SUM_BY_NONZERO_WEIGHTS);var o=te(n,"onehotLabels","softmaxCrossEntropy"),s=te(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=te(t,"weights","softmaxCrossEntropy")),rr(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=pt(r),l=pt(1),c=pt(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=function(f,d,p){if(p===void 0&&(p=-1),p===-1&&(p=d.rank-1),p!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+p);return sx(function(v,g,m){var x=g.logSumExp([p],!0),_=g.toFloat().sub(x);return m([v,_]),{value:_.mul(v).neg().sum([p]),gradFunc:function(b,S){var E=S[0],C=S[1],R=Xa(b.shape,[p]);return[b.reshape(R).mul(E.toFloat().sub(C.exp())),b.reshape(R).mul(C.exp().sub(E.toFloat()))]}}})(f,d)}(o,s);return Rc(h,a,i)}}),REe=Object.freeze({get Reduction(){return Mo},absoluteDifference:wEe,computeWeightedLoss:Rc,cosineDistance:_Ee,hingeLoss:bEe,huberLoss:SEe,logLoss:EEe,meanSquaredError:CEe,sigmoidCrossEntropy:MEe,softmaxCrossEntropy:TEe});function C6(n,e){return e===void 0&&(e=!1),Se.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=HX(t),o=n.clone(),s=ix([[1]],[1,1]),a=s.clone(),u=t>=r?r:t,l=function(h){var f,d=o,p=a,v=i;f=Se.tidy(function(){var g=o.slice([h,h],[t-h,1]),m=g.norm(),x=o.slice([h,h],[1,1]),_=x.sign().neg(),b=x.sub(_.mul(m)),S=g.div(b);a=S.shape[0]===1?s.clone():s.concat(S.slice([1,0],[S.shape[0]-1,S.shape[1]]),0);var E=_.matMul(b).div(m).neg(),C=o.slice([h,0],[t-h,r]),R=E.mul(a);o=h===0?C.sub(R.matMul(a.transpose().matMul(C))):o.slice([0,0],[h,r]).concat(C.sub(R.matMul(a.transpose().matMul(C))),0);var T=i.slice([0,h],[t,i.shape[1]-h]);return i=h===0?T.sub(T.matMul(a).matMul(R.transpose())):i.slice([0,0],[t,h]).concat(T.sub(T.matMul(a).matMul(R.transpose())),1),[a,o,i]}),a=f[0],o=f[1],i=f[2],Ts([d,p,v])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var AEe=he({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,oe(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){oe(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=MD(n,n.shape[0],0).map(function(u){return jX(u,[0])});oe(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],s=n,a=function(u){o.push(Se.tidy(function(){var l=s[u];if(u>0)for(var c=0;c<u;++c){var h=bq(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(Rq(l,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return e?bu(o,0):o}}),IEe=he({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return C6(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(s,a){return s*a}),r=oo(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=C6(s,e),u=a[0],l=a[1];i.push(u),o.push(l)}),[bu(i,0).reshape(n.shape),bu(o,0).reshape(n.shape)]}}),PEe=Object.freeze({gramSchmidt:AEe,qr:IEe});function Oq(n,e,t,r,i){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var o=n.shape[0];return t=Math.min(t,o),oe(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),oe(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),oe(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),oe(e.rank===1,function(){return"scores must be a 1D tensor"}),oe(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i}}var kEe=he({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=te(n,"images","resizeBilinear");oe(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),oe(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=Se.runKernel(function(l,c){return c([i]),l.resizeBilinear(i,s,a,t)},{batchImages:i},function(l,c){return{batchImages:function(){return Se.runKernel(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),DEe=he({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=te(n,"images","resizeNearestNeighbor");oe(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),oe(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),oe(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=Se.runKernel(function(l,c){return c([i]),l.resizeNearestNeighbor(i,s,a,t)},{batchImages:i},function(l,c){return{batchImages:function(){return Se.runKernel(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),NEe=he({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=te(n,"boxes","nonMaxSuppression"),s=te(e,"scores","nonMaxSuppression"),a=Oq(o,s,t,r,i);return t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,Se.runKernel(function(u){return u.nonMaxSuppression(o,s,t,r,i)},{$boxes:o})}}),LEe=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Zt(this,void 0,void 0,function(){var o,s,a,u,l,c;return Qt(this,function(h){switch(h.label){case 0:return o=te(n,"boxes","nonMaxSuppressionAsync"),s=te(e,"scores","nonMaxSuppressionAsync"),a=Oq(o,s,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,o.data()];case 1:return u=h.sent(),[4,s.data()];case 2:return l=h.sent(),c=AD(u,l,t,r,i),o!==n&&o.dispose(),s!==e&&s.dispose(),[2,c]}})})},FEe=he({cropAndResize_:function(n,e,t,r,i,o){var s=te(n,"image","cropAndResize","float32"),a=te(e,"boxes","cropAndResize","float32"),u=te(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=a.shape[0];return oe(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),oe(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+a.shape+"."}),oe(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+a.shape+"."}),oe(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),oe(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),oe(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),Se.runKernel(function(c,h){return c.cropAndResize(s,a,u,r,i,o)},{$image:s,$boxes:a})}}),Bq=Object.freeze({resizeBilinear:kEe,resizeNearestNeighbor:DEe,nonMaxSuppression:NEe,nonMaxSuppressionAsync:LEe,cropAndResize:FEe}),OEe=he({matMul_:function(n,e,t,r,i,o){var s;t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o="linear");var a=te(n,"a","fused matMul"),u=te(e,"b","fused matMul");s=Ai(a,u),a=s[0],u=s[1];var l=t?a.shape[a.rank-2]:a.shape[a.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=t?a.shape[a.rank-1]:a.shape[a.rank-2],f=r?u.shape[u.rank-2]:u.shape[u.rank-1],d=a.shape.slice(0,-2),p=u.shape.slice(0,-2),v=Vt(d),g=Vt(p);oe(a.rank>=2&&u.rank>=2&&a.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+u.rank+"."}),oe(Po(d,p),function(){return"Error in fused matMul: outer dimensions ("+d+") and ("+p+") of Tensors with shapes "+a.shape+" and "+u.shape+" must match."}),oe(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+a.shape+" and "+u.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var m,x=a.shape.slice(0,-2).concat([h,f]),_=t?a.as3D(v,l,h):a.as3D(v,h,l),b=r?u.as3D(g,f,c):u.as3D(g,c,f);i!=null&&kn(x,(m=Ai(m=te(i,"bias","fused matMul"),a)[0]).shape);var S={$a:_,$b:b};return i!=null&&(S.$bias=m),Se.runKernel(function(E,C){var R=E.fusedBatchMatMul(_,b,t,r,m,o);return C([_,b,R]),R},S,function(E,C){var R,T=C[0],A=C[1],P=C[2];if(o==null||o==="linear")R=E;else{if(o!=="relu")throw new Error("Gradient for activation "+o+" has not been implemented yet.");R=E.mul(P.step())}var k={};return i!=null&&(k={$bias:function(){var W=R,N=Ii(m.shape,R.shape);return N.length>0&&(W=W.sum(N)),W.reshape(m.shape)}}),Object.assign(t||r?!t&&r?{$a:function(){return R.matMul(A,!1,!1)},$b:function(){return R.matMul(T,!0,!1)}}:t&&!r?{$a:function(){return A.matMul(R,!1,!0)},$b:function(){return T.matMul(R,!1,!1)}}:{$a:function(){return A.matMul(R,!0,!0)},$b:function(){return R.matMul(T,!0,!0)}}:{$a:function(){return R.matMul(A,!1,!0)},$b:function(){return T.matMul(R,!0,!1)}},k)}).reshape(x)}}),BEe=Object.freeze({matMul:OEe}),UEe=Object.freeze({image:Bq,linalg:PEe,losses:REe,spectral:mEe,fused:BEe,signal:xEe,op:he,batchNormalization2d:rSe,batchNormalization3d:iSe,batchNormalization4d:oSe,batchNormalization:sSe,batchNorm:dq,batchNorm2d:aSe,batchNorm3d:uSe,batchNorm4d:lSe,complex:$o,real:ul,imag:yh,concat:ko,concat1d:J2e,concat2d:ewe,concat3d:twe,concat4d:nwe,split:MD,conv1d:cSe,conv2d:Tc,conv3d:hSe,conv2dDerFilter:vq,depthwiseConv2d:LD,separableConv2d:gq,conv2dTranspose:fSe,matMul:FD,dot:dSe,outerProduct:pSe,reverse:hx,reverse1d:mSe,reverse2d:vSe,reverse3d:gSe,reverse4d:ySe,maxPool:Yv,avgPool:fx,pool:xSe,slice:wl,slice1d:wSe,slice2d:_Se,slice3d:wq,slice4d:bSe,abs:Tbe,acos:Rbe,acosh:Abe,asin:Ibe,asinh:Pbe,atan:kbe,atanh:Dbe,ceil:Nbe,clipByValue:ND,cos:Lbe,cosh:Fbe,erf:Obe,exp:o4,expm1:Bbe,floor:Ube,log:zbe,log1p:Vbe,logSigmoid:Wbe,neg:oS,reciprocal:Hbe,round:Gbe,rsqrt:uq,sigmoid:lq,sign:$be,isNaN:jbe,isInf:Xbe,isFinite:qbe,sin:Ybe,sinh:Kbe,softplus:Zbe,sqrt:Qbe,square:Jbe,step:eSe,tan:tSe,tanh:nSe,all:SSe,any:ESe,argMax:CSe,argMin:MSe,logSumExp:TSe,max:OE,mean:RSe,min:ASe,moments:ISe,sum:bq,prod:PSe,equal:Sq,equalStrict:kSe,greater:DSe,greaterEqual:Eq,greaterEqualStrict:NSe,greaterStrict:LSe,less:FSe,lessEqual:OSe,lessEqualStrict:BSe,lessStrict:USe,notEqual:zSe,notEqualStrict:VSe,add:jn,addN:WSe,addStrict:HSe,atan2:GSe,div:Zu,divStrict:$Se,floorDiv:Cq,maximum:OD,maximumStrict:jSe,minimum:Mq,minimumStrict:XSe,mod:qSe,modStrict:YSe,mul:nc,mulStrict:KSe,pow:sS,powStrict:ZSe,squaredDifference:QSe,squaredDifferenceStrict:JSe,sub:Is,subStrict:eEe,elu:iEe,leakyRelu:oEe,prelu:sEe,relu:di,selu:aEe,logicalAnd:BD,logicalNot:tEe,logicalOr:Tq,logicalXor:nEe,where:S1,whereAsync:rEe,buffer:xn,print:cwe,batchToSpaceND:WX,cast:hwe,clone:fwe,cumsum:dwe,depthToSpace:pwe,expandDims:Da,eye:HX,multinomial:mwe,oneHot:n4,pad:ox,pad1d:vwe,pad2d:gwe,pad3d:ywe,pad4d:xwe,rand:wwe,randomNormal:_we,randomUniform:GX,reshape:gu,spaceToBatchND:$X,squeeze:jX,stack:bu,tile:mv,truncatedNormal:bwe,unstack:oo,setdiff1dAsync:Swe,fill:pv,linspace:Q2e,ones:yg,range:UX,scalar:pt,tensor:ls,tensor1d:fs,tensor2d:ix,tensor3d:CD,tensor4d:fu,tensor5d:K2e,tensor6d:Z2e,zeros:Mr,onesLike:zX,zerosLike:Un,transpose:Zh,softmax:pf,logSoftmax:Rwe,localResponseNormalization:uEe,norm:Rq,gather:Aq,unsortedSegmentSum:Iq,basicLSTMCell:lEe,multiRNNCell:cEe,movingAverage:hEe,stridedSlice:fEe,topk:dEe,scatterND:pEe,fft:UD,ifft:aS,rfft:Pq,irfft:kq,sparseToDense:vEe,gatherND:gEe,dropout:yEe,hannWindow:Nq,hammingWindow:Lq,frame:Fq}),zEe=function(){function n(){if(this.blockSize=48,this.firstUse=!0,Ce.get("IS_BROWSER")){var e=function(){if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}();this.fromPixels2DContext=e.getContext("2d")}this.data=new JX(this,Se)}return n.prototype.register=function(e,t,r){if(this.firstUse&&(this.firstUse=!1,Ce.get("IS_NODE")&&t4(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:r})},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,i;if(Ce.get("IS_NODE")&&e.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(e.getContext!=null)r=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData||e.data instanceof Uint8Array)r=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),r=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(t===4)i=new Int32Array(r);else{var o=e.width*e.height;i=new Int32Array(o*t);for(var s=0;s<o;s++)for(var a=0;a<t;++a)i[s*t+a]=r[4*s+a]}return CD(i,[e.height,e.width,t],"int32")},n.prototype.read=function(e){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),r=t.dtype,i=t.complexTensors;return r==="complex64"?i4(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){return xn(e.shape,e.dtype,this.readSync(e.dataId))},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return Zt(this,void 0,void 0,function(){var t;return Qt(this,function(r){return t=Yb(),e(),[2,{kernelMs:Yb()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var r=at.make(e.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:Se.keep(e.clone()),imag:Se.keep(t.clone())},r},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(r){r!=null&&oe(r.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})},n.prototype.slice=function(e,t,r){if(this.assertNotComplex(e,"slice"),ZX(e.shape,t,r)){var i=QX(t,e.strides),o=Vt(r);return ls(this.readSync(e.dataId).subarray(i,i+o),r,e.dtype)}for(var s=xn(r,e.dtype),a=this.bufferSync(e),u=0;u<s.size;++u){var l=s.indexToLoc(u).map(function(c,h){return c+t[h]});s.values[u]=a.get.apply(a,l)}return s.toTensor()},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,u,l){this.assertNotComplex(e,"stridedSlice");var c=RD(e.shape,t,r,i,o,s,a,u,l),h=c[0],f=c[1],d=c[2],p=f.filter(function(S,E){return d.indexOf(E)===-1});if(p.some(function(S){return S===0}))return ls([],p);for(var v=xn(f,e.dtype),g=this.bufferSync(e),m=0;m<v.size;m++){for(var x=v.indexToLoc(m),_=new Array(x.length),b=0;b<_.length;b++)_[b]=x[b]*i[b]+h[b];v.set.apply(v,[g.get.apply(g,_)].concat(x))}return v.toTensor().reshape(p)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,s=0;s<e.rank;s++)s!==t&&(i[o++]=e.shape[s]);var a=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(s=0;s<l.length;s++)a[t]=s,l[s]=this.slice(e,a,u).reshape(i);return l},n.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var r=xn(e.shape,e.dtype),i=this.bufferSync(e),o=function(a){var u=r.indexToLoc(a),l=u.slice();t.forEach(function(c){return l[c]=e.shape[c]-1-l[c]}),r.set.apply(r,[i.get.apply(i,l)].concat(u))},s=0;s<r.size;s++)o(s);return r.toTensor()},n.prototype.concat=function(e,t){var r=this;this.assertNotComplex(e,"concat");var i=e.map(function(c){var h=Vt(c.shape.slice(t));return c.as2D(-1,h)}),o=qv(i.map(function(c){return c.shape}),1),s=xn(o,e[0].dtype).values;if(i[0].shape[0]===1){var a=0;i.forEach(function(c){s.set(r.readSync(c.dataId),a),a+=c.size})}else{var u=0;i.forEach(function(c){for(var h=r.readSync(c.dataId),f=0,d=0;d<c.shape[0];++d)for(var p=d*o[1]+u,v=0;v<c.shape[1];++v)s[p+v]=h[f++];u+=c.shape[1]})}var l=qv(e.map(function(c){return c.shape}),t);return ls(s,l,e[0].dtype)},n.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(pt(-1),e)},n.prototype.add=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,s){return{real:r+o,imag:i+s}}):this.broadcastedBinaryOp(e,t,bi(e.dtype,t.dtype),function(r,i){return r+i})},n.prototype.addN=function(e){var t=this;this.assertNotComplex(e,"addN");for(var r=e.map(function(l){return t.readSync(l.dataId)}),i=xn(e[0].shape,e[0].dtype),o=i.values,s=0;s<e.length;s++)for(var a=r[s],u=0;u<o.length;u++)o[u]+=a[u];return i.toTensor()},n.prototype.subtract=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,s){return{real:r-o,imag:i-s}}):this.broadcastedBinaryOp(e,t,bi(e.dtype,t.dtype),function(r,i){return r-i})},n.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.pow(r,i)})},n.prototype.batchMatMul=function(e,t,r,i){this.assertNotComplex([e,t],"matMul");for(var o=r?e.shape[1]:e.shape[2],s=r?e.shape[2]:e.shape[1],a=i?t.shape[1]:t.shape[2],u=e.shape[0],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=r?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=h[0],d=h[1],p=h[2],v=i?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],g=v[0],m=v[1],x=v[2],_=s*a,b=xn([u,s,a],e.dtype),S=b.values,E=this.blockSize,C=0;C<u;C++)for(var R=0;R<s;R+=E)for(var T=0;T<a;T+=E)for(var A=0;A<o;A+=E)for(var P=Math.min(R+E,s),k=Math.min(T+E,a),W=Math.min(A+E,o),N=R;N<P;N++)for(var O=T;O<k;O++){for(var z=0,V=A;V<W;V++)z+=l[C*f+N*d+V*p]*c[V*g+O*m+C*x];S[C*_+(N*a+O)]+=z}return b.toTensor()},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,s){var a=this.batchMatMul(e,t,r,i);return o&&(a=this.add(a,o)),s&&(a=function(u,l,c){if(l==="linear")return u.linear(c);if(l==="relu")return u.relu(c);throw new Error("Activation "+l+" has not been implemented for the CPU backend.")}(this,s,a)),a},n.prototype.multiply=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,s){return{real:r*o-i*s,imag:r*s+i*o}}):this.broadcastedBinaryOp(e,t,bi(e.dtype,t.dtype),function(r,i){return r*i})},n.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(r,i){return r/i})},n.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(r,i){return Math.floor(r/i)})},n.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),js("sum",t,e.rank);for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,bi(e.dtype,"int32")),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=0,d=0;d<a;++d)f+=l[h+d];u[c]=f}return s},n.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,bi(e.dtype,"int32")),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=1,d=0;d<a;++d)f*=l[h+d];u[c]=f}return s},n.prototype.unsortedSegmentSum=function(e,t,r){this.assertNotComplex(e,"unsortedSegmentSum");for(var i=[],o=e.rank-t.rank,s=0;s<o;++s)t=t.expandDims(s+1);for(s=0;s<r;++s){var a=pt(s,"int32"),u=Sq(a,t).asType("float32").mul(e).sum(0);i.push(u)}return bu(i)},n.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var r=[t];js("argMin",r,e.rank);for(var i=wo(e.shape,r),o=i[0],s=i[1],a=Mr(o,"int32"),u=Vt(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0,v=0;v<u;++v){var g=c[f+v];g<d&&(d=g,p=v)}l[h]=p}return a},n.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var r=[t];js("argMax",r,e.rank);for(var i=wo(e.shape,r),o=i[0],s=i[1],a=Mr(o,"int32"),u=Vt(s),l=this.readSync(a.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0,v=0;v<u;++v){var g=c[f+v];g>d&&(d=g,p=v)}l[h]=p}return a},n.prototype.cumsum=function(e,t,r,i){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=bi(e.dtype,"int32"),s=Mr(e.shape,o),a=this.readSync(s.dataId),u=this.readSync(e.dataId),l=e.shape[e.rank-1],c=i?function(v,g){return v+l-g-1}:function(v,g){return v+g},h=0;h<u.length;h+=l)for(var f=0;f<l;f++){var d=c(h,f);if(f===0)a[d]=r?0:u[d];else{var p=c(h,f-1);a[d]=r?u[p]+a[p]:u[d]+a[p]}}return s},n.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r===i?1:0})},n.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r!==i?1:0})},n.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<i?1:0})},n.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<=i?1:0})},n.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>i?1:0})},n.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>=i?1:0})},n.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t[i]?0:1;return at.make(e.shape,{values:r},"bool")},n.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r&&i})},n.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r||i})},n.prototype.select=function(e,t,r){this.assertNotComplex([e,t,r],"select");for(var i=this.readSync(e.dataId),o=this.readSync(t.dataId),s=this.readSync(r.dataId),a=Mr(t.shape,bi(t.dtype,r.dtype)),u=this.readSync(a.dataId),l=0,c=e.rank===0||e.rank>1||t.rank===1?1:t.shape[1],h=0;h<i.length;h++)for(var f=0;f<c;f++)i[h]===1?u[l++]=o[h]:u[l++]=s[h];return a},n.prototype.where=function(e){this.assertNotComplex([e],"where");var t=this.readSync(e.dataId);return ID(e.shape,t)},n.prototype.topk=function(e,t,r){return this.assertNotComplex(e,"topk"),iq(this.readSync(e.dataId),e.shape,e.dtype,t)},n.prototype.min=function(e,t){this.assertNotComplex(e,"min"),js("min",t,e.rank);for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,e.dtype),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=l[h],d=0;d<a;++d){var p=l[h+d];p<f&&(f=p)}u[c]=f}return s},n.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.min(r,i)})},n.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r%i;return r<0&&i<0||r>=0&&i>=0?o:(o+i)%i})},n.prototype.max=function(e,t){this.assertNotComplex(e,"max"),js("max",t,e.rank);for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,e.dtype),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=l[h],d=0;d<a;++d){var p=l[h+d];p>f&&(f=p)}u[c]=f}return s},n.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.max(r,i)})},n.prototype.all=function(e,t){this.assertNotComplex(e,"all"),js("all",t,e.rank);for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,e.dtype),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=l[h],d=0;d<a;++d){var p=l[h+d];f=f&&p}u[c]=f}return s},n.prototype.any=function(e,t){this.assertNotComplex(e,"any"),js("any",t,e.rank);for(var r=wo(e.shape,t),i=r[0],o=r[1],s=Mr(i,e.dtype),a=Vt(o),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*a,f=l[h],d=0;d<a;++d){var p=l[h+d];f=f||p}u[c]=f}return s},n.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r-i;return o*o})},n.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.ceil(t[i]);return at.make(e.shape,{values:r})},n.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.floor(t[i]);return at.make(e.shape,{values:r})},n.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)t[i]<0?r[i]=-1:t[i]>0?r[i]=1:r[i]=0;return at.make(e.shape,{values:r})},n.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isNaN(t[i])&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Math.abs(t[i])===1/0&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isFinite(t[i])&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=Math.floor(t[i]);t[i]-o<.5?r[i]=Math.floor(t[i]):t[i]-o>.5?r[i]=Math.ceil(t[i]):r[i]=o%2==0?o:o+1}return at.make(e.shape,{values:r})},n.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.exp(t[i]);return at.make(e.shape,{values:r})},n.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.expm1(t[i]);return at.make(e.shape,{values:r})},n.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log(o)}return at.make(e.shape,{values:r})},n.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log1p(o)}return at.make(e.shape,{values:r})},n.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.sqrt(o)}return at.make(e.shape,{values:r})},n.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=1/Math.sqrt(o)}return at.make(e.shape,{values:r})},n.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=o*o}return at.make(e.shape,{values:r})},n.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=1/t[i];return at.make(e.shape,{values:r})},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Mr(e.shape,e.dtype),r=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.max(0,i[o]);return t},n.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return r<0?i*r:r})},n.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];t[i]=o>=0?o:Math.exp(o)-1}return at.make(e.shape,{values:t})},n.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=this.readSync(e.dataId),s=0;s<i.length;++s){var a=i[s];r[s]=a>=1?o[s]:o[s]*(a+1)}return at.make(t.shape,{values:r})},n.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=kD,r=DD,i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=a>=0?r*a:t*(Math.exp(a)-1)}return at.make(e.shape,{values:i})},n.prototype.clip=function(e,t,r){this.assertNotComplex(e,"clip");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),s=0;s<o.length;++s){var a=o[s];i[s]=a>r?r:a<t?t:a}return at.make(e.shape,{values:i})},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.abs(r[i]);return at.make(e.shape,{values:t})},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<e.size;++i){var o=r[2*i],s=r[2*i+1];t[i]=Math.hypot(o,s)}return at.make(e.shape,{values:t})},n.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=r[i];return at.make(e.shape,{values:t},"int32")},n.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=1/(1+Math.exp(-r[i]));return at.make(e.shape,{values:t})},n.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(11920928955078125e-23)+2,r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o]>-t,a=i[o]<t,u=Math.exp(i[o]),l=void 0;l=a?u:s?i[o]:Math.log(1+u),r[o]=l}return at.make(e.shape,{values:r})},n.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.sin(r[i]);return at.make(e.shape,{values:t})},n.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.cos(r[i]);return at.make(e.shape,{values:t})},n.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.tan(r[i]);return at.make(e.shape,{values:t})},n.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.asin(r[i]);return at.make(e.shape,{values:t})},n.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.acos(r[i]);return at.make(e.shape,{values:t})},n.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.atan(r[i]);return at.make(e.shape,{values:t})},n.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.atan2(r,i)})},n.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.sinh(r[i]);return at.make(e.shape,{values:t})},n.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.cosh(r[i]);return at.make(e.shape,{values:t})},n.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=i2e(r[i]);return at.make(e.shape,{values:t})},n.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.asinh(r[i]);return at.make(e.shape,{values:t})},n.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.acosh(r[i]);return at.make(e.shape,{values:t})},n.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.atanh(r[i]);return at.make(e.shape,{values:t})},n.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i],s=1/(1+.3275911*o);t[i]=1-((((1.061405429*s-1.453152027)*s+1.421413741)*s-.284496736)*s+.254829592)*s*Math.exp(-o*o)}return at.make(e.shape,{values:t})},n.prototype.step=function(e,t){t===void 0&&(t=0),this.assertNotComplex(e,"step");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var s=i[o];isNaN(s)?r[o]=NaN:r[o]=s>0?1:t}return at.make(e.shape,{values:r})},n.prototype.conv2d=function(e,t,r){this.assertNotComplex([e,t],"conv2d");for(var i=r.filterHeight,o=r.filterWidth,s=r.dilationHeight,a=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=xn(r.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),d=c.values,p=0;p<r.batchSize;++p)for(var v=p*e.strides[0],g=p*c.strides[0],m=0;m<r.outHeight;++m)for(var x=g+m*c.strides[1],_=m*r.strideHeight-l,b=0;b<i;b++){var S=_+b*s;if(!(S<0||S>=r.inHeight))for(var E=b*t.strides[0],C=v+S*e.strides[1],R=0;R<r.outWidth;++R)for(var T=x+R*r.outChannels,A=R*r.strideWidth-u,P=0;P<o;P++){var k=A+P*a;if(!(k<0||k>=r.inWidth))for(var W=E+P*t.strides[1],N=C+k*r.inChannels,O=W,z=0;z<r.inChannels;++z){for(var V=h[N+z],F=0;F<r.outChannels;++F)d[T+F]+=V*f[O+F];O+=r.outChannels}}}return c.toTensor()},n.prototype.conv3d=function(e,t,r){for(var i=r.filterDepth,o=r.filterHeight,s=r.filterWidth,a=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.padInfo.front,h=r.padInfo.left,f=r.padInfo.top,d=xn(r.outShape,e.dtype),p=this.readSync(e.dataId),v=this.readSync(t.dataId),g=d.values,m=0;m<r.batchSize;++m)for(var x=m*e.strides[0],_=m*d.strides[0],b=0;b<r.outDepth;++b)for(var S=_+b*d.strides[1],E=b*r.strideDepth-c,C=0;C<i;C++){var R=E+C*a;if(!(R<0||R>=r.inDepth))for(var T=C*t.strides[0],A=x+R*e.strides[1],P=0;P<r.outHeight;++P)for(var k=S+P*d.strides[2],W=P*r.strideHeight-f,N=0;N<o;N++){var O=W+N*u;if(!(O<0||O>=r.inHeight))for(var z=T+N*t.strides[1],V=A+O*e.strides[2],F=0;F<r.outWidth;++F)for(var U=k+F*r.outChannels,L=F*r.strideWidth-h,j=0;j<s;j++){var Q=L+j*l;if(!(Q<0||Q>=r.inWidth))for(var K=z+j*t.strides[2],ie=V+Q*r.inChannels,pe=K,we=0;we<r.inChannels;++we){for(var ce=p[ie+we],_e=0;_e<r.outChannels;++_e)g[U+_e]+=ce*v[pe+_e];pe+=r.outChannels}}}}return d.toTensor()},n.prototype.conv2dDerInput=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerInput");for(var i=xn(r.inShape,"float32"),o=i.values,s=i.strides,a=s[0],u=s[1],l=s[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],d=h[1],p=h[2],v=this.readSync(t.dataId),g=t.strides,m=g[0],x=g[1],_=g[2],b=r.batchSize,S=r.filterHeight,E=r.filterWidth,C=r.inChannels,R=r.inHeight,T=r.inWidth,A=r.outChannels,P=r.outHeight,k=r.outWidth,W=r.strideHeight,N=r.strideWidth,O=S-1-r.padInfo.top,z=E-1-r.padInfo.left,V=0;V<b;++V)for(var F=0;F<C;++F)for(var U=0;U<R;++U)for(var L=U-O,j=Math.max(0,Math.ceil(L/W)),Q=Math.min(P,(S+L)/W),K=0;K<T;++K){for(var ie=K-z,pe=Math.max(0,Math.ceil(ie/N)),we=Math.min(k,(E+ie)/N),ce=0,_e=j;_e<Q;++_e)for(var Oe=_e*W-L,Ve=pe;Ve<we;++Ve)for(var Ne=f*V+d*_e+p*Ve,Z=m*(S-1-Oe)+x*(E-1-(Ve*N-ie))+_*F,de=0;de<A;++de)ce+=c[Ne+de]*v[Z+de];o[a*V+u*U+l*K+F]=ce}return i.toTensor()},n.prototype.conv3dDerInput=function(e,t,r){for(var i=xn(r.inShape,"float32"),o=i.values,s=i.strides,a=s[0],u=s[1],l=s[2],c=s[3],h=this.readSync(e.dataId),f=e.strides,d=f[0],p=f[1],v=f[2],g=f[3],m=this.readSync(t.dataId),x=t.strides,_=x[0],b=x[1],S=x[2],E=x[3],C=r.batchSize,R=r.filterDepth,T=r.filterHeight,A=r.filterWidth,P=r.inChannels,k=r.inDepth,W=r.inHeight,N=r.inWidth,O=r.outChannels,z=r.outDepth,V=r.outHeight,F=r.outWidth,U=r.strideDepth,L=r.strideHeight,j=r.strideWidth,Q=R-1-r.padInfo.front,K=T-1-r.padInfo.top,ie=A-1-r.padInfo.left,pe=0;pe<C;++pe)for(var we=0;we<P;++we)for(var ce=0;ce<k;++ce)for(var _e=ce-Q,Oe=Math.max(0,Math.ceil(_e/U)),Ve=Math.min(z,(R+_e)/U),Ne=0;Ne<W;++Ne)for(var Z=Ne-K,de=Math.max(0,Math.ceil(Z/L)),me=Math.min(V,(T+Z)/L),Ie=0;Ie<N;++Ie){for(var xe=Ie-ie,se=Math.max(0,Math.ceil(xe/j)),Xe=Math.min(F,(A+xe)/j),X=0,$=Oe;$<Ve;++$)for(var le=$*U-_e,ze=de;ze<me;++ze)for(var Te=ze*L-Z,J=se;J<Xe;++J)for(var be=d*pe+p*$+v*ze+g*J,ke=_*(R-1-le)+b*(T-1-Te)+S*(A-1-(J*j-xe))+E*we,He=0;He<O;++He)X+=h[be+He]*m[ke+He];o[a*pe+u*ce+l*Ne+c*Ie+we]=X}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerFilter");for(var i=r.strideHeight,o=r.strideWidth,s=r.filterHeight,a=r.filterWidth,u=xn(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),d=0;d<s;++d)for(var p=Math.max(0,Math.ceil((c-d)/i)),v=Math.min(r.outHeight,(r.inHeight+c-d)/i),g=0;g<a;++g)for(var m=Math.max(0,Math.ceil((l-g)/o)),x=Math.min(r.outWidth,(r.inWidth+l-g)/o),_=0;_<r.inChannels;++_)for(var b=0;b<r.outChannels;++b){for(var S=0,E=0;E<r.batchSize;++E)for(var C=p;C<v;++C)for(var R=d+C*i-c,T=m;T<x;++T){var A=g+T*o-l;S+=h.get(E,R,A,_)*f.get(E,C,T,b)}u.set(S,d,g,_,b)}return u.toTensor()},n.prototype.conv3dDerFilter=function(e,t,r){for(var i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,a=r.filterDepth,u=r.filterHeight,l=r.filterWidth,c=xn(r.filterShape,"float32"),h=c.values,f=c.strides,d=f[0],p=f[1],v=f[2],g=f[3],m=this.readSync(t.dataId),x=t.strides,_=x[0],b=x[1],S=x[2],E=x[3],C=this.readSync(e.dataId),R=e.strides,T=R[0],A=R[1],P=R[2],k=R[3],W=r.padInfo.front,N=r.padInfo.left,O=r.padInfo.top,z=0;z<a;++z)for(var V=Math.max(0,Math.ceil((W-z)/i)),F=Math.min(r.outDepth,(r.inDepth+W-z)/i),U=z*d,L=0;L<u;++L)for(var j=Math.max(0,Math.ceil((O-L)/o)),Q=Math.min(r.outHeight,(r.inHeight+O-L)/o),K=L*p+U,ie=0;ie<l;++ie)for(var pe=Math.max(0,Math.ceil((N-ie)/s)),we=Math.min(r.outWidth,(r.inWidth+N-ie)/s),ce=ie*v+K,_e=0;_e<r.inChannels;++_e)for(var Oe=_e*g+ce,Ve=0;Ve<r.outChannels;++Ve){for(var Ne=0,Z=0;Z<r.batchSize;++Z)for(var de=Z*T,me=Z*_,Ie=V;Ie<F;++Ie)for(var xe=(z+Ie*i-W)*A+de,se=Ie*b+me,Xe=j;Xe<Q;++Xe)for(var X=(L+Xe*o-O)*P+xe,$=Xe*S+se,le=pe;le<we;++le){var ze=le*E+$;Ne+=C[(ie+le*s-N)*k+X+_e]*m[ze+Ve]}h[Oe+Ve]=Ne}return c.toTensor()},n.prototype.depthwiseConv2D=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2D");for(var i=r.filterHeight,o=r.filterWidth,s=r.dilationHeight,a=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=r.outChannels/r.inChannels,h=xn(r.outShape,e.dtype),f=this.readSync(e.dataId),d=this.readSync(t.dataId),p=h.values,v=0;v<r.batchSize;++v)for(var g=v*e.strides[0],m=v*h.strides[0],x=0;x<r.outHeight;++x)for(var _=m+x*h.strides[1],b=x*r.strideHeight-u,S=0;S<i;++S){var E=b+S*s;if(!(E<0||E>=r.inHeight))for(var C=S*t.strides[0],R=g+E*e.strides[1],T=0;T<r.outWidth;++T)for(var A=_+T*h.strides[2],P=T*r.strideWidth-l,k=0;k<o;++k){var W=P+k*a;if(!(W<0||W>=r.inWidth))for(var N=C+k*t.strides[1],O=R+W*r.inChannels,z=A,V=N,F=0;F<r.inChannels;++F){for(var U=f[O+F],L=0;L<c;++L)p[z+L]+=U*d[V+L];z+=c,V+=c}}}return h.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var i=xn(r.inShape,"float32"),o=i.values,s=i.strides,a=s[0],u=s[1],l=s[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],d=h[1],p=h[2],v=this.readSync(t.dataId),g=t.strides,m=g[0],x=g[1],_=g[2],b=r.batchSize,S=r.filterHeight,E=r.filterWidth,C=r.inChannels,R=r.inHeight,T=r.inWidth,A=r.outChannels,P=r.outHeight,k=r.outWidth,W=r.strideHeight,N=r.strideWidth,O=S-1-r.padInfo.top,z=E-1-r.padInfo.left,V=A/C,F=0;F<b;++F)for(var U=0;U<C;++U)for(var L=0;L<R;++L)for(var j=L-O,Q=Math.max(0,Math.ceil(j/W)),K=Math.min(P,(S+j)/W),ie=0;ie<T;++ie){for(var pe=ie-z,we=Math.max(0,Math.ceil(pe/N)),ce=Math.min(k,(E+pe)/N),_e=0,Oe=Q;Oe<K;++Oe)for(var Ve=Oe*W-j,Ne=we;Ne<ce;++Ne)for(var Z=f*F+d*Oe+p*Ne,de=m*(S-1-Ve)+x*(E-1-(Ne*N-pe))+_*U,me=0;me<V;++me)_e+=c[Z+(U*V+me)]*v[de+me];o[a*F+u*L+l*ie+U]=_e}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var i=r.strideHeight,o=r.strideWidth,s=r.filterHeight,a=r.filterWidth,u=xn(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=r.outChannels/r.inChannels,f=this.bufferSync(e),d=this.bufferSync(t),p=0;p<s;++p)for(var v=Math.max(0,Math.ceil((c-p)/i)),g=Math.min(r.outHeight,(r.inHeight+c-p)/i),m=0;m<a;++m)for(var x=Math.max(0,Math.ceil((l-m)/o)),_=Math.min(r.outWidth,(r.inWidth+l-m)/o),b=0;b<r.outChannels;++b){for(var S=Math.trunc(b/h),E=b%h,C=0,R=0;R<r.batchSize;++R)for(var T=v;T<g;++T)for(var A=p+T*i-c,P=x;P<_;++P){var k=m+P*o-l;C+=f.get(R,A,k,S)*d.get(R,T,P,b)}u.set(C,p,m,S,E)}return u.toTensor()},n.prototype.tile=function(e,t){return this.assertNotComplex(e,"tile"),rq(this.bufferSync(e),t)},n.prototype.pad=function(e,t,r){this.assertNotComplex(e,"pad");var i=t.map(function(h,f){return h[0]+e.shape[f]+h[1]}),o=t.map(function(h){return h[0]}),s=this.bufferSync(e),a=xn(i,e.dtype);r!==0&&a.values.fill(r);for(var u=0;u<e.size;u++){var l=s.indexToLoc(u),c=l.map(function(h,f){return h+o[f]});a.set.apply(a,[s.get.apply(s,l)].concat(c))}return a.toTensor()},n.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var r=new Array(e.rank),i=0;i<r.length;i++)r[i]=e.shape[t[i]];var o=this.readSync(e.dataId),s=xn(r,e.dtype),a=this.bufferSync(e);for(i=0;i<e.size;++i){for(var u=a.indexToLoc(i),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[t[c]];var h=s.locToIndex(l);s.values[h]=o[i]}return s.toTensor()},n.prototype.gather=function(e,t,r){this.assertNotComplex([e,t],"gather");var i=e.shape.slice(),o=this.readSync(t.dataId);i[r]=o.length;for(var s=xn(i,e.dtype),a=this.bufferSync(e),u=0;u<s.size;++u){var l=s.indexToLoc(u),c=l.slice();c[r]=o[l[r]];var h=a.locToIndex(c);s.values[u]=a.values[h]}return s.toTensor()},n.prototype.batchToSpaceND=function(e,t,r){this.assertNotComplex([e],"batchToSpaceND");var i=t.reduce(function(c,h){return c*h}),o=Jb(e.shape,t,i),s=eS(o.length,t.length),a=tS(e.shape,t,i),u=XX(r,t.length),l=qX(a,r,t.length);return e.reshape(o).transpose(s).reshape(a).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){this.assertNotComplex([e],"spaceToBatchND");var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,r);for(var s=1+t.length;s<e.shape.length;++s)o.push([0,0]);var a=e.pad(o),u=Jb(a.shape,t,i,!1),l=eS(u.length,t.length,!1),c=tS(a.shape,t,i,!1);return a.reshape(u).transpose(l).reshape(c)},n.prototype.pool=function(e,t,r){this.assertNotComplex(e,"pool");for(var i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(e.dataId),p=xn(t.outShape,e.dtype),v=p.values,g=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],x=t.outShape[3],_=0;_<t.batchSize;++_)for(var b=_*g,S=_*e.strides[0],E=0;E<t.inChannels;++E)for(var C=0;C<t.outHeight;++C)for(var R=C*i-c,T=Math.max(0,R),A=Math.min(t.inHeight,u+R),P=b+C*m,k=0;k<t.outWidth;++k){for(var W=k*o-h,N=Math.max(0,W),O=Math.min(t.inWidth,l+W),z=f,V=0,F=0,U=T;U<A;U+=s){for(var L=S+U*e.strides[1],j=N;j<O;j+=a){var Q=d[L+j*e.strides[2]+E];r==="max"&&Q>z?z=Q:r==="avg"&&(V+=Q,F++)}if(isNaN(z))break}v[P+k*x+E]=r==="avg"?V/F:z}return p.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var r=xn(t.outShape,"int32"),i=t.strideHeight,o=t.strideWidth,s=t.dilationHeight,a=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=this.bufferSync(e),d=0;d<t.batchSize;++d)for(var p=0;p<t.inChannels;++p)for(var v=0;v<t.outHeight;++v){for(var g=v*i-c,m=g;m<0;)m+=s;for(var x=Math.min(t.inHeight,u+g),_=0;_<t.outWidth;++_){for(var b=_*o-h,S=b;S<0;)S+=a;for(var E=Math.min(t.inWidth,l+b),C=Number.NEGATIVE_INFINITY,R=-1,T=m;T<x;T+=s)for(var A=T-g,P=S;P<E;P+=a){var k=P-b,W=f.get(d,T,P,p);W>C&&(C=W,R=A*l+k)}r.set(R,d,v,_,p)}}return r.toTensor()},n.prototype.maxPoolBackprop=function(e,t,r,i){this.assertNotComplex([t,r],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,i),s=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,d=c-1-i.padInfo.top,p=xn(t.shape,"float32"),v=this.bufferSync(o),g=this.bufferSync(e),m=0;m<i.batchSize;++m)for(var x=0;x<i.inChannels;++x)for(var _=0;_<i.inHeight;++_)for(var b=0;b<i.inWidth;++b){for(var S=_-d,E=b-f,C=0,R=0;R<c;R+=u){var T=(S+R)/s;if(!(T<0||T>=i.outHeight||Math.floor(T)!==T))for(var A=0;A<h;A+=l){var P=(E+A)/a;if(!(P<0||P>=i.outWidth||Math.floor(P)!==P)){var k=c*h-1-v.get(m,T,P,x)===R*h+A?1:0;k!==0&&(C+=g.get(m,T,P,x)*k)}}}p.set(C,m,_,b,x)}return p.toTensor()},n.prototype.avgPoolBackprop=function(e,t,r){this.assertNotComplex([e,t],"avgPoolBackprop");for(var i=r.strideHeight,o=r.strideWidth,s=r.filterHeight,a=r.filterWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=h-1-r.padInfo.left,d=c-1-r.padInfo.top,p=xn(t.shape,"float32"),v=1/(s*a),g=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var x=0;x<r.inChannels;++x)for(var _=0;_<r.inHeight;++_)for(var b=0;b<r.inWidth;++b){for(var S=_-d,E=b-f,C=0,R=0;R<c;R+=u){var T=(S+R)/i;if(!(T<0||T>=r.outHeight||Math.floor(T)!==T))for(var A=0;A<h;A+=l){var P=(E+A)/o;P<0||P>=r.outWidth||Math.floor(P)!==P||(C+=g.get(m,T,P,x))}}p.set(C*v,m,_,b,x)}return p.toTensor()},n.prototype.cast=function(e,t){return eq(e,t,this)},n.prototype.reshape=function(e,t){return r4(e,t)},n.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,r,i){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(Vt([s,t,r,l])),f=[i&&t>1?a-1:a,i&&r>1?u-1:u],d=[i&&t>1?t-1:t,i&&r>1?r-1:r],p=0,v=f[0]/d[0],g=f[1]/d[1],m=0;m<s;m++)for(var x=0;x<t;x++)for(var _=v*x,b=Math.floor(_),S=_-b,E=Math.min(a-1,Math.ceil(_)),C=m*e.strides[0]+b*e.strides[1],R=m*e.strides[0]+E*e.strides[1],T=0;T<r;T++)for(var A=g*T,P=Math.floor(A),k=A-P,W=Math.min(u-1,Math.ceil(A)),N=C+P*e.strides[2],O=R+P*e.strides[2],z=C+ +W*e.strides[2],V=R+W*e.strides[2],F=0;F<l;F++){var U=c[N+F],L=c[O+F],j=U+(c[z+F]-U)*k,Q=j+(L+(c[V+F]-L)*k-j)*S;h[p++]=Q}return ls(h,[s,t,r,l])},n.prototype.resizeBilinearBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var i=t.shape,o=i[0],s=i[1],a=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*s*a*u),d=[r&&c>1?s-1:s,r&&h>1?a-1:a],p=[r&&c>1?c-1:c,r&&h>1?h-1:h],v=d[0]/p[0],g=d[1]/p[1],m=this.readSync(e.dataId),x=0,_=0;_<o;_++)for(var b=_*t.strides[0],S=0;S<c;S++)for(var E=S*v,C=Math.floor(E),R=Math.min(Math.ceil(E),s-1),T=b+C*t.strides[1],A=b+R*t.strides[1],P=E-C,k=1-P,W=0;W<h;W++)for(var N=W*g,O=Math.floor(N),z=Math.min(Math.ceil(N),a-1),V=N-O,F=1-V,U=T+O*t.strides[2],L=T+z*t.strides[2],j=A+O*t.strides[2],Q=A+z*t.strides[2],K=k*F,ie=k*V,pe=P*F,we=P*V,ce=0;ce<u;ce++){var _e=m[x++];f[U+ce]+=_e*K,f[L+ce]+=_e*ie,f[j+ce]+=_e*pe,f[Q+ce]+=_e*we}return fu(f,[o,a,s,u],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,r,i){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(s*t*r*l),f=[i&&t>1?a-1:a,i&&r>1?u-1:u],d=[i&&t>1?t-1:t,i&&r>1?r-1:r],p=f[0]/d[0],v=f[1]/d[1],g=0,m=0;m<s;m++)for(var x=m*e.strides[0],_=0;_<t;_++)for(var b=p*_,S=x+Math.min(a-1,i?Math.round(b):Math.floor(b))*e.strides[1],E=0;E<r;E++)for(var C=v*E,R=S+Math.min(u-1,i?Math.round(C):Math.floor(C))*e.strides[2],T=0;T<l;T++){var A=c[R+T];h[g++]=A}return ls(h,[s,t,r,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var i=t.shape,o=i[0],s=i[1],a=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*s*a*u),d=this.readSync(e.dataId),p=[r&&c>1?s-1:s,r&&h>1?a-1:a],v=[r&&c>1?c-1:c,r&&h>1?h-1:h],g=p[0]/v[0],m=p[1]/v[1],x=1/g,_=1/m,b=2*Math.ceil(x)+2,S=2*Math.ceil(_)+2,E=0;E<o;E++)for(var C=E*t.strides[0],R=0;R<s;R++)for(var T=C+R*t.strides[1],A=Math.floor(R*x),P=Math.floor(A-b/2),k=0;k<a;k++)for(var W=T+k*t.strides[2],N=Math.floor(k*_),O=Math.floor(N-S/2),z=0;z<u;z++){for(var V=0,F=0;F<b;F++){var U=F+P;if(!(U<0||U>=c)){var L=C+U*e.strides[1],j=U*g;if(R===Math.min(s-1,r?Math.round(j):Math.floor(j)))for(var Q=0;Q<S;Q++){var K=Q+O;if(!(K<0||K>=h)){var ie=L+K*e.strides[2],pe=K*m;k===Math.min(a-1,r?Math.round(pe):Math.floor(pe))&&(V+=d[ie+z])}}}}f[W+z]=V}return fu(f,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,r,i,o,s){this.assertNotComplex([e,t,r,o,s],"batchNorm");for(var a=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),h=s?this.readSync(s.dataId):new Float32Array([0]),f=new Float32Array(a.length),d=h.length,p=c.length,v=l.length,g=u.length,m=0,x=0,_=0,b=0,S=0;S<a.length;++S)f[S]=h[m++]+(a[S]-u[x++])*c[_++]/Math.sqrt(l[b++]+i),m>=d&&(m=0),x>=g&&(x=0),_>=p&&(_=0),b>=v&&(b=0);return fu(f,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){this.assertNotComplex(e,"localResponseNormalization4D");var s=e.shape[3],a=s-1,u=this.readSync(e.dataId),l=e.size,c=new Float32Array(l);function h(v){for(var g=v%s,m=v-g+Math.max(0,g-t),x=v-g+Math.min(g+t,a),_=0;m<=x;m++){var b=u[m];_+=b*b}return _}for(var f=0;f<l;f++){var d=h(f),p=u[f]*Math.pow(r+i*d,-o);c[f]=p}return fu(c,e.shape)},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){this.assertNotComplex(e,"LRNGrad");for(var u=e.shape[3],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=new Float32Array(e.size),d=e.size,p=0;p<d;p++){for(var v=p%u,g=p-v+Math.max(0,v-i),m=p-v+Math.min(u,v+i+1),x=0,_=g;_<m;_++)x+=Math.pow(c[_],2);for(x=s*x+o,_=g;_<m;_++){var b=-2*s*a*c[_]*h[p]/x;p===_&&(b+=Math.pow(x,-a)),b*=l[p],f[_]+=b}}return fu(f,e.shape)},n.prototype.multinomial=function(e,t,r,i){this.assertNotComplex(e,"multinomial");for(var o=t?e:pf(e),s=o.shape[0],a=o.shape[1],u=Mr([s,r],"int32"),l=this.readSync(u.dataId),c=this.readSync(o.dataId),h=0;h<s;++h){var f=h*a,d=new Float32Array(a-1);d[0]=c[f];for(var p=1;p<d.length;++p)d[p]=d[p-1]+c[f+p];for(var v=TD(i.toString()),g=h*r,m=0;m<r;++m){var x=v();l[g+m]=d.length;for(var _=0;_<d.length;_++)if(x<d[_]){l[g+m]=_;break}}}return u},n.prototype.oneHot=function(e,t,r,i){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(i);for(var s=this.readSync(e.dataId),a=0;a<e.size;++a)s[a]>=0&&s[a]<t&&(o[a*t+s[a]]=r);return ix(o,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return this.assertNotComplex(e,"nonMaxSuppression"),AD(this.readSync(e.dataId),this.readSync(t.dataId),r,i,o)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var r=e.shape[0],i=e.shape[1],o=xn(e.shape,"float32"),s=xn(e.shape,"float32"),a=ul(e).as2D(r,i),u=yh(e).as2D(r,i),l=0;l<r;l++)for(var c=a.slice([l,0],[1,i]),h=u.slice([l,0],[1,i]),f=$o(c,h),d=this.readSync(this.fftImpl(f,t).dataId),p=0;p<i;p++){var v=h6(d,p);o.values[l*i+p]=v.real,s.values[l*i+p]=v.imag}return $o(o.toTensor(),s.toTensor()).as2D(r,i)},n.prototype.fftImpl=function(e,t){var r=e.as1D(),i=r.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(r,i,t).as2D(e.shape[0],e.shape[1]);return t&&(o=$o(ul(o).div(pt(i)),yh(o).div(pt(i)))),o}var s=this.readSync(e.dataId),a=function(u){for(var l=new Float32Array(u.length/2),c=new Float32Array(u.length/2),h=0;h<u.length;h+=2)l[h/2]=u[h],c[h/2]=u[h+1];return{real:l,imag:c}}(this.fourierTransformByMatmul(s,i,t));return $o(a.real,a.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return(e&e-1)==0},n.prototype.fftRadix2=function(e,t,r){if(t===1)return e;var i=this.readSync(e.dataId),o=t/2,s=function(g){for(var m=Math.ceil(g.length/4),x=new Float32Array(m),_=new Float32Array(m),b=0;b<g.length;b+=4)x[Math.floor(b/4)]=g[b],_[Math.floor(b/4)]=g[b+1];return{real:x,imag:_}}(i),a=$o(s.real,s.imag).as1D(),u=function(g){for(var m=Math.floor(g.length/4),x=new Float32Array(m),_=new Float32Array(m),b=2;b<g.length;b+=4)x[Math.floor(b/4)]=g[b],_[Math.floor(b/4)]=g[b+1];return{real:x,imag:_}}(i),l=$o(u.real,u.imag).as1D();a=this.fftRadix2(a,o,r),l=this.fftRadix2(l,o,r);var c=function(g,m){for(var x=new Float32Array(g/2),_=new Float32Array(g/2),b=0;b<Math.ceil(g/2);b++){var S=(m?2:-2)*Math.PI*(b/g);x[b]=Math.cos(S),_[b]=Math.sin(S)}return{real:x,imag:_}}(t,r),h=$o(c.real,c.imag).mul(l),f=a.add(h),d=a.sub(h),p=ul(f).concat(ul(d)),v=yh(f).concat(yh(d));return $o(p,v).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,r){for(var i=new Float32Array(2*t),o=0;o<t;o++){for(var s=0,a=0,u=0;u<t;u++){var l=Pwe(o*u,t,r),c=h6(e,u);s+=c.real*l.real-c.imag*l.imag,a+=c.real*l.imag+c.imag*l.real}r&&(s/=t,a/=t),Iwe(i,s,a,o)}return i},n.prototype.depthToSpace=function(e,t,r){oe(r==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),oe(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var i=e.shape[0],o=e.shape[1],s=e.shape[2],a=e.shape[3],u=o*t,l=s*t,c=a/(t*t),h=this.readSync(e.dataId),f=new Float32Array(i*u*l*c),d=0,p=0;p<i;++p)for(var v=0;v<u;++v)for(var g=Math.floor(v/t),m=v%t,x=0;x<l;++x)for(var _=Math.floor(x/t),b=(m*t+x%t)*c,S=0;S<c;++S){var E=S+b+a*(_+s*(g+o*p));f[d++]=h[E]}return fu(f,[i,u,l,c])},n.prototype.broadcastedBinaryOp=function(e,t,r,i){var o=kn(e.shape,t.shape),s=xn(o,r),a=this.readSync(e.dataId),u=this.readSync(t.dataId),l=Qm(e.shape,o),c=Qm(t.shape,o),h=s.values;if(l.length+c.length===0)for(var f=0;f<h.length;++f)h[f]=i(a[f%a.length],u[f%u.length]);else{var d=this.bufferSync(e),p=this.bufferSync(t),v=function(g){var m=s.indexToLoc(g),x=m.slice(-e.rank);l.forEach(function(E){return x[E]=0});var _=d.locToIndex(x),b=m.slice(-t.rank);c.forEach(function(E){return b[E]=0});var S=p.locToIndex(b);h[g]=i(a[_],u[S])};for(f=0;f<h.length;++f)v(f)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,r){var i=kn(e.shape,t.shape),o=xn(i,"float32"),s=xn(i,"float32"),a=this.readSync(e.dataId),u=this.readSync(t.dataId),l=Qm(e.shape,i),c=Qm(t.shape,i),h=o.values,f=s.values;if(l.length+c.length===0)for(var d=0;d<h.length;d++){var p=d%a.length,v=d%u.length,g=r(a[2*p],a[2*p+1],u[2*v],u[2*v+1]);h[d]=g.real,f[d]=g.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=function(b){var S=o.indexToLoc(b),E=S.slice(-e.rank);l.forEach(function(P){return E[P]=0});var C=m.locToIndex(E),R=S.slice(-t.rank);c.forEach(function(P){return R[P]=0});var T=x.locToIndex(R),A=r(a[2*C],a[2*C+1],u[2*T],u[2*T+1]);h[b]=A.real,f[b]=A.imag};for(d=0;d<h.length;d++)_(d)}return this.complex(o.toTensor(),s.toTensor())},n.prototype.split=function(e,t,r){return nq(e,t,r)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,t,r,i,o,s){for(var a=e.shape,u=a[0],l=a[1],c=a[2],h=a[3],f=t.shape[0],d=i[0],p=i[1],v=xn([f,d,p,h],e.dtype),g=this.readSync(t.dataId),m=this.readSync(r.dataId),x=this.readSync(e.dataId),_=e.strides,b=v.strides,S=0;S<f;S++){var E=4*S,C=g[E],R=g[E+1],T=g[E+2],A=g[E+3],P=m[S];if(!(P>=u))for(var k=d>1?(T-C)*(l-1)/(d-1):0,W=p>1?(A-R)*(c-1)/(p-1):0,N=0;N<d;N++){var O=d>1?C*(l-1)+N*k:.5*(C+T)*(l-1);if(O<0||O>l-1)for(var z=0;z<p;z++)for(var V=0;V<h;V++){var F=V+z*b[2]+N*b[1]+S*b[0];v.values[F]=s}else if(o==="bilinear"){var U=Math.floor(O),L=Math.ceil(O),j=O-U;for(z=0;z<p;z++)if((Ve=p>1?R*(c-1)+z*W:.5*(R+A)*(c-1))<0||Ve>c-1)for(V=0;V<h;V++)F=V+z*b[2]+N*b[1]+S*b[0],v.values[F]=s;else{var Q=Math.floor(Ve),K=Math.ceil(Ve),ie=Ve-Q;for(V=0;V<h;V++){var pe=x[F=V+Q*_[2]+U*_[1]+P*_[0]],we=x[F=V+K*_[2]+U*_[1]+P*_[0]],ce=x[F=V+Q*_[2]+L*_[1]+P*_[0]],_e=pe+(we-pe)*ie,Oe=ce+(x[F=V+K*_[2]+L*_[1]+P*_[0]]-ce)*ie;F=V+z*b[2]+N*b[1]+S*b[0],v.values[F]=_e+(Oe-_e)*j}}}else for(z=0;z<p;++z){var Ve;if((Ve=p>1?R*(c-1)+z*W:.5*(R+A)*(c-1))<0||Ve>c-1)for(V=0;V<h;V++)F=V+z*b[2]+N*b[1]+S*b[0],v.values[F]=s;else{var Ne=Math.round(Ve),Z=Math.round(O);for(V=0;V<h;V++){var de=V+Ne*_[2]+Z*_[1]+P*_[0],me=V+z*b[2]+N*b[1]+S*b[0];v.values[me]=x[de]}}}}}return v.toTensor()},n.prototype.sparseToDense=function(e,t,r,i){var o=nS(0,e,r),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize;return this.scatter(e,t,r,c,u,a,s,l,i,!1)},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=YX(e,t),s=o[0],a=o[1],u=o[2],l=o[3];if(a===0)return ls([],s,e.dtype);for(var c=new _1([a,u],e.dtype),h=this.readSync(t.dataId),f=this.readSync(e.dataId),d=0;d<a;d++){for(var p=[],v=0,g=0;g<i;g++){var m=h[d*i+g];v+=m*l[g],p.push(m)}if(v<0||v>=e.size/u)throw new Error("Invalid indices: "+p+" does not index into "+e.shape);for(var x=0;x<u;x++)c.values[d*u+x]=f[v*u+x]}return c.toTensor().reshape(s)},n.prototype.scatterND=function(e,t,r){var i=nS(0,e,r),o=i.sliceRank,s=i.numUpdates,a=i.sliceSize,u=i.strides,l=i.outputSize,c=pt(0);return this.scatter(e,t,r,l,a,s,o,u,c,!0)},n.prototype.fill=function(e,t,r){var i=qb(r=r||tx(t),Vt(e));return i.fill(t),at.make(e,{values:i},r)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=qb(e.dtype,Vt(e.shape));return at.make(e.shape,{values:t},e.dtype)},n.prototype.linspace=function(e,t,r){return tq(e,t,r)},n.prototype.scatter=function(e,t,r,i,o,s,a,u,l,c){var h=[i/o,o],f=this.readSync(e.dataId),d=this.readSync(t.dataId);if(i===0)return ls([],r,t.dtype);var p=new _1(h,t.dtype);p.values.fill(this.readSync(l.dataId)[0]);for(var v=0;v<s;v++){for(var g=[],m=0,x=0;x<a;x++){var _=f[v*a+x];g.push(_),m+=_*u[x]}if(m<0||m>=i/o)throw new Error("Invalid indices: "+g+" does not index into "+r);for(var b=0;b<o;b++)c?p.values[m*o+b]+=d[v*o+b]:p.values[m*o+b]=t.rank===0?d[0]:d[v*o+b]}return p.toTensor().reshape(r)},n}();Se.registerBackend("cpu",function(){return new zEe},1);var VEe=function(){function n(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return n.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},n.prototype.decodeUTF8=function(e){return this.textDecoder.decode(e)},n.prototype.fetch=function(e,t){return fetch(e,t)},n}();Ce.get("IS_BROWSER")&&Ce.setPlatform("browser",new VEe);var PT,WEe=function(){return require("node-fetch")},HEe=function(){function n(){var e=require("util");this.textEncoder=new e.TextEncoder,this.textDecoder=new e.TextDecoder}return n.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},n.prototype.decodeUTF8=function(e){return e.length===0?"":this.textDecoder.decode(e)},n.prototype.fetch=function(e,t){return Ce.global.fetch!=null?Ce.global.fetch(e,t):(PT==null&&(PT=WEe()),PT(e,t))},n}();Ce.get("IS_NODE")&&Ce.setPlatform("node",new HEe);var s4=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function M6(n){return s4?Buffer.byteLength(n):new Blob([n]).size}function GEe(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function BE(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:M6(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:M6(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Zd=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var s=o(e,r);s!==null&&i.push(s)}),i},n}(),T6="://",Uq=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){oe(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(T6)&&(e=e.slice(0,e.indexOf(T6))),oe(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();oe(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}(),gd="models_store",xh="model_info_store";function zq(){if(!Ce.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function a4(n){var e=n.result;e.createObjectStore(gd,{keyPath:"modelPath"}),e.createObjectStore(xh,{keyPath:"modelPath"})}var gv=function(){function n(e){if(this.indexedDB=zq(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return a4(s)},s.onsuccess=function(){var a=s.result;if(t==null){var u=a.transaction(gd,"readonly"),l=u.objectStore(gd).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(v){return a.close(),o(l.error)},u.oncomplete=function(){return a.close()}}else{var c,h=BE(t),f=a.transaction(xh,"readwrite"),d=f.objectStore(xh),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var v=(c=a.transaction(gd,"readwrite")).objectStore(gd).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});v.onsuccess=function(){return i({modelArtifactsInfo:h})},v.onerror=function(g){var m=(d=f.objectStore(xh)).delete(r.modelPath);m.onsuccess=function(){return a.close(),o(v.error)},m.onerror=function(x){return a.close(),o(v.error)}}},p.onerror=function(v){return a.close(),o(p.error)},f.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),R6=function(n){return Ce.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(gv.URL_SCHEME)?(e=n.slice(gv.URL_SCHEME.length),new gv(e)):null;var e};Zd.registerSaveRouter(R6),Zd.registerLoadRouter(R6);var $Ee=function(){function n(){this.indexedDB=zq()}return n.prototype.listModels=function(){return Zt(this,void 0,void 0,function(){var e=this;return Qt(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return a4(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(xh,"readonly"),u=a.objectStore(xh).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return Zt(this,void 0,void 0,function(){var t=this;return Qt(this,function(r){var i;return e=(i=e).startsWith(gv.URL_SCHEME)?i.slice(gv.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return a4(a)},a.onsuccess=function(){var u,l=a.result,c=l.transaction(xh,"readwrite"),h=c.objectStore(xh),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var d=h.delete(e),p=function(){var v=(u=l.transaction(gd,"readwrite")).objectStore(gd).delete(e);v.onsuccess=function(){return o(f.result.modelArtifactsInfo)},v.onerror=function(g){return s(f.error)}};d.onsuccess=p,d.onerror=function(v){return p(),l.close(),s(f.error)}},f.onerror=function(d){return l.close(),s(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},a.onerror=function(u){return s(a.error)}})]})})},n}();if(Ce.getBool("IS_BROWSER"))try{Uq.registerManager(gv.URL_SCHEME,new $Ee)}catch{}var Kl="/",wm="tensorflowjs_models",Vq="info",jEe="model_topology",XEe="weight_specs",qEe="weight_data",YEe="model_metadata";function Wq(n){return{info:[wm,n,Vq].join(Kl),topology:[wm,n,jEe].join(Kl),weightSpecs:[wm,n,XEe].join(Kl),weightData:[wm,n,qEe].join(Kl),modelMetadata:[wm,n,YEe].join(Kl)}}function KEe(n){var e=n.split(Kl);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Kl)}var yv=function(){function n(e){if(!Ce.getBool("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Wq(this.modelPath)}return n.prototype.save=function(e){return Zt(this,void 0,void 0,function(){var t,r,i;return Qt(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=BE(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(s=e.weightData,s4?Buffer.from(s).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(s))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}var s;return[2]})})},n.prototype.load=function(){return Zt(this,void 0,void 0,function(){var e,t,r,i,o,s,a;return Qt(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(o),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(s4){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),d=0;d<h.length;++d)f.set([h.charCodeAt(d)],d);return f.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),A6=function(n){return Ce.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(yv.URL_SCHEME)?(e=n.slice(yv.URL_SCHEME.length),new yv(e)):null;var e};Zd.registerSaveRouter(A6),Zd.registerLoadRouter(A6);var ZEe=function(){function n(){oe(Ce.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),oe(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Zt(this,void 0,void 0,function(){var e,t,r,i,o,s;return Qt(this,function(a){for(e={},t=wm+Kl,r=Kl+Vq,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(s=KEe(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return Zt(this,void 0,void 0,function(){var t,r;return Qt(this,function(i){var o;if(e=(o=e).startsWith(yv.URL_SCHEME)?o.slice(yv.URL_SCHEME.length):o,t=Wq(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(Ce.getBool("IS_BROWSER"))try{Uq.registerManager(yv.URL_SCHEME,new ZEe)}catch{}var QEe="model",JEe=".json",eCe=".weights.bin";function I6(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var kT=function(){function n(e){if(!Ce.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=QEe),this.modelTopologyFileName=e+JEe,this.weightDataFileName=e+eCe}return n.prototype.save=function(e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a;return Qt(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,I6(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,I6(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:BE(e)}]}})})},n.URL_SCHEME="downloads://",n}();function P6(n,e,t,r){(function(o){oe(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,s){oe(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),oe(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),oe(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(s){var a=t+ ++i/n.length*(r-t);return e(a),s}),o}))}function tCe(n,e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c;return Qt(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?PX:e.fetchFunc,r=n.map(function(f){return t(f,e.requestInit)}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=h.sent(),[3,4];case 2:return[4,P6(r,e.onProgress,i,o)];case 3:s=h.sent(),h.label=4;case 4:return a=s.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=h.sent(),[3,8];case 6:return[4,P6(a,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}Zd.registerSaveRouter(function(n){return Ce.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(kT.URL_SCHEME)?(e=n.slice(kT.URL_SCHEME.length),e===void 0&&(e="model"),new kT(e)):null;var e});var Hq=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(oe(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=PX,oe(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&oe(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Zt(this,void 0,void 0,function(){var t,r,i,o;return Qt(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:BE(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return Zt(this,void 0,void 0,function(){var e,t,r,i,o,s,a,u;return Qt(this,function(l){switch(l.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=l.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.json()];case 3:return t=l.sent(),[3,5];case 4:throw l.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:u=l.sent(),s=u[0],a=u[1],l.label=7;case 7:return[2,{modelTopology:i,weightSpecs:s,weightData:a}]}})})},n.prototype.loadWeights=function(e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h,f;return Qt(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var v=p.lastIndexOf("/"),g=p.lastIndexOf("?"),m=p.substring(0,v),x=g>v?p.substring(g):"";return[m+"/",x]}(t),i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,l=e;u<l.length;u++)c=l[u],a.push.apply(a,c.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(v){h.push(s+v+o)})}),[4,tCe(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[a,GEe(f)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function k6(n){return n.match(Hq.URL_SCHEME_REGEX)!=null}var D6=function(n,e){return(Array.isArray(n)?n.every(function(t){return k6(t)}):k6(n))?nCe(n,{onProgress:e}):null};function nCe(n,e){return new Hq(n,e)}Zd.registerSaveRouter(D6),Zd.registerLoadRouter(D6);he({confusionMatrix_:function(n,e,t){var r=te(n,"labels","confusionMatrix"),i=te(e,"predictions","confusionMatrix");oe(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),oe(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),oe(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),oe(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),oe(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=n4(r.asType("int32"),t),s=n4(i.asType("int32"),t);return o.transpose().matMul(s).asType("int32")}});var rCe=he({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return Se.fromPixels(n,e)}}),iCe=Object.freeze({toPixels:function(n,e){return Zt(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R;return Qt(this,function(T){switch(T.label){case 0:if(t=te(n,"img","toPixels"),n instanceof at||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return a=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],d=h[0],p=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(v=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(o*i*4),m=0;m<i*o;++m)x=void 0,_=void 0,b=void 0,S=void 0,s===1?(x=a[m]*v,_=a[m]*v,b=a[m]*v,S=255):s===3?(x=a[3*m]*v,_=a[3*m+1]*v,b=a[3*m+2]*v,S=255):s===4&&(x=a[4*m]*v,_=a[4*m+1]*v,b=a[4*m+2]*v,S=a[4*m+3]*v),g[0+(E=4*m)]=Math.round(x),g[E+1]=Math.round(_),g[E+2]=Math.round(b),g[E+3]=Math.round(S);return e!=null&&(e.width=o,e.height=i,C=e.getContext("2d"),R=new ImageData(g,o,i),C.putImageData(R,0,0)),t!==n&&t.dispose(),[2,g]}})})},fromPixels:rCe}),oCe=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),sCe=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function cp(n){oe(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),oe(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),oe(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),sCe.register(n)}var hp=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Cc(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),s=o.value,a=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:a[l.name]}});this.applyGradients(u)}else this.applyGradients(a);return Ts(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return Twe(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Ts(this.iterations_)},e.prototype.saveIterations=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:pt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){return Qt(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Zt(this,void 0,void 0,function(){var r;return Qt(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(oCe);Object.defineProperty(hp,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var aCe=function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=Se.backend.epsilon()),o}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Se.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Ft(function(){return Un(s).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Ft(function(){return Un(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;Ft(function(){var c=u.mul(r.rho).add(a.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var d=h.mul(-r.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Ts(this.accumulatedGrads.map(function(t){return t.variable})),Ts(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){var t;return Qt(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){var r;return Qt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="AdadeltaOptimizer",e}(hp);cp(aCe);var uCe=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Se.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Ft(function(){return pv(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[o].variable;Ft(function(){var l=u.add(a.square());u.assign(l);var c=a.div(l.add(Se.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Ts(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){return Qt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(hp);cp(uCe);var lCe=function(n){function e(t,r,i,o){o===void 0&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],Ft(function(){s.accBeta1=pt(r).variable(),s.accBeta2=pt(i).variable()}),o==null&&(s.epsilon=Se.backend.epsilon()),s}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Ft(function(){var o=Is(1,r.accBeta1),s=Is(1,r.accBeta2);i.forEach(function(a,u){var l=Se.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Ft(function(){return Un(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:Ft(function(){return Un(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),v=d.div(o),g=p.div(s);h.assign(d),f.assign(p);var m=v.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ts(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Ts(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){var t;return Qt(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){var r,i=this;return Qt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Ft(function(){i.accBeta1.assign(sS(i.beta1,i.iterations_+1)),i.accBeta2.assign(sS(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(hp);cp(lCe);var cCe=function(n){function e(t,r,i,o,s){o===void 0&&(o=null),s===void 0&&(s=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Ft(function(){a.iteration=pt(0).variable(),a.accBeta1=pt(r).variable()}),o==null&&(a.epsilon=Se.backend.epsilon()),a}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Ft(function(){var o=Is(1,r.accBeta1),s=Zu(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var l=Se.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Un(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:Un(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2),v=c.abs(),g=p.maximum(v);h.assign(d),f.assign(g);var m=s.div(o).mul(d.div(g.add(r.epsilon))).add(l);l.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ts(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Ts(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){return Qt(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(hp);cp(cCe);var Gq=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var a=Se.registeredVariables[i];Ft(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=X2e(pt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){return Qt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(hp);cp(Gq);var hCe=function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=pt(o.momentum),o}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Se.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:Ft(function(){return Un(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&Ft(function(){var l,c=r.m.mul(a).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(s):r.c.mul(c).add(s),a.assign(c),s.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Ts(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){return Qt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){return Qt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="MomentumOptimizer",e}(Gq);cp(hCe);var fCe=function(n){function e(t,r,i,o,s){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),s===void 0&&(s=!1);var a=n.call(this)||this;return a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,o==null&&(a.epsilon=Se.backend.epsilon()),a}return Cc(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Se.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Ft(function(){return Un(s).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:Ft(function(){return Un(s).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Ft(function(){return Un(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;Ft(function(){var c=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,f=h.mul(r.decay).add(a.mul(1-r.decay)),d=l.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(d);var p=s.sub(d);s.assign(p)}else{var v=u.mul(r.decay).add(a.square().mul(1-r.decay));d=l.mul(r.momentum).add(a.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),l.assign(d),p=s.sub(d),s.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Ts(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Ts(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Ts(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Zt(this,void 0,void 0,function(){var t;return Qt(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Zt(this,void 0,void 0,function(){var r;return Qt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(hp);cp(fCe);Fe=UEe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var $q=function(n,e){return($q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Du(n,e){function t(){this.constructor=n}$q(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Et(n,e,t,r){return new(t||(t=Promise))(function(i,o){function s(l){try{u(r.next(l))}catch(c){o(c)}}function a(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(s,a)}u((r=r.apply(n,[])).next())})}function Ct(n,e){var t,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,r=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){s=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){s.label=c[1];break}if(c[0]===6&&s.label<i[1]){s.label=i[1],i=c;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(c);break}i[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(n,s)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var dCe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var s=[],a=1;a<arguments.length;a++)s[a-1]=arguments[a];return pCe(r,s[0],s[1]),s.join("=")}),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach(function(o){var s=o.split(":"),a=s[0],u=s[1];e.urlFlags[a]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(a,u)})}},n}();function pCe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function je(){return jq}var jq=null,uS=new Map,u4=new Map;function Xq(n,e){var t=Yq(n,e);return uS.get(t)}function N6(n){return u4.get(n)}function L6(n){for(var e=uS.entries(),t=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var s=o[0],a=o[1];s.split("_")[0]===n&&t.push(a)}return t}function qq(n){var e=n.kernelName,t=n.backendName,r=Yq(e,t);if(uS.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");uS.set(r,n)}function mCe(n){var e=n.kernelName;u4.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),u4.set(e,n)}function Yq(n,e){return e+"_"+n}function l4(n,e,t){return Math.max(n,Math.min(e,t))}function Kq(n){return n%2==0?n:n+1}function vCe(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function ee(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Zn(n,e,t){t===void 0&&(t=""),ee(Wi(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function xg(n){ee(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Kv(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||gl(n)&&!t)for(var r=0;r<n.length;++r)Kv(n[r],e,t);else e.push(n);return e}function St(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Wi(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ii(n){return n%1==0}function gCe(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function c4(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function xv(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function F6(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,s=function(){if(n())r();else{o++;var a=e(o);t!=null&&o>=t?i():setTimeout(s,a)}};s()})}function yCe(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Pi(n,e){var t=e.length;return ee((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),ee(n.every(function(r){return ii(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function rd(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:Pi(e,n).sort(),s=0,a=0;a<n.length;++a){if(o!=null){if(o[s]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(o[s]==null||o[s]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),o[s]<=a&&s++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Zv(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function lS(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function xCe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function wCe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function _Ce(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function gl(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function Zq(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function bCe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function zD(n){return typeof n=="string"||n instanceof String}function SCe(n){return typeof n=="boolean"}function ECe(n){return typeof n=="number"}function dx(n){return Array.isArray(n)?dx(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":ECe(n)?"float32":zD(n)?"string":SCe(n)?"bool":"float32"}function h4(n){return!!(n&&n.constructor&&n.call&&n.apply)}function f4(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function la(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function Qq(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Kv(n)),t&&xCe(n,e),function(o,s){return o instanceof Float32Array&&s==="float32"||o instanceof Int32Array&&s==="int32"||o instanceof Uint8Array&&s==="bool"}(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function O6(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return function r(i,o,s){var a=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)a[l]=s[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(f,d){return f*d});for(l=0;l<u;l++)a[l]=r(i+l*h,c,s)}return a}(0,n,e)}function Jq(n,e){for(var t=px(n,e),r=0;r<t.length;r++)t[r]=1;return t}function px(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function Qu(){return je().platform.now()}function eY(n){n.forEach(function(e){ee(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function CCe(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",je().platform.encode(n,e)}function cS(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",je().platform.decode(n,e)}function d4(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function tY(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var MCe=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new TCe)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,s=this.backendTimer.time(function(){i=r()});return i.forEach(function(a){a.data().then(function(u){(function(l,c,h){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var d=l[f];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+h+"'"),!0}})(u,a.dtype,e),s.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,a,u,l.kernelMs,t,c)})})}),i},n}(),TCe=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,s){var a=typeof i=="number"?xv(i+"ms",9):i.error,u=xv(e,25),l=t.rank,c=t.size,h=xv(t.shape.toString(),14),f="";for(var d in o){var p=o[d].shape||t.shape,v=p.length;f+=d+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"	%c"+a+"	%c"+l+"D "+h+"	%c"+c+"	%c"+f+"	%c"+s,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),B6=20,y0=3,DT=7;function RCe(n,e,t,r){var i=la(e),o=function(l,c,h,f){var d=St(c),p=f[f.length-1],v=new Array(p).fill(0),g=c.length,m=h==="complex64"?w0(l):l;if(g>1)for(var x=0;x<d/p;x++)for(var _=x*p,b=0;b<p;b++)v[b]=Math.max(v[b],x0(m[_+b],0,h).length);return v}(n,e,t,i),s=e.length,a=function l(c,h,f,d,p,v){v===void 0&&(v=!0);var g=f==="complex64"?2:1,m=h[0],x=h.length;if(x===0)return f==="complex64"?[x0(w0(c)[0],0,f)]:f==="bool"?[nY(c[0])]:[c[0].toString()];if(x===1){if(m>B6){var _=y0*g,b=Array.from(c.slice(0,_)),S=Array.from(c.slice((m-y0)*g,m*g));return f==="complex64"&&(b=w0(b),S=w0(S)),["["+b.map(function(O,z){return x0(O,p[z],f)}).join(", ")+", ..., "+S.map(function(O,z){return x0(O,p[m-y0+z],f)}).join(", ")+"]"]}return["["+(f==="complex64"?w0(c):Array.from(c)).map(function(O,z){return x0(O,p[z],f)}).join(", ")+"]"]}var E=h.slice(1),C=d.slice(1),R=d[0]*g,T=[];if(m>B6){for(var A=0;A<y0;A++){var P=(k=A*R)+R;T.push.apply(T,l(c.slice(k,P),E,f,C,p,!1))}for(T.push("..."),A=m-y0;A<m;A++)P=(k=A*R)+R,T.push.apply(T,l(c.slice(k,P),E,f,C,p,A===m-1))}else for(A=0;A<m;A++){var k;P=(k=A*R)+R,T.push.apply(T,l(c.slice(k,P),E,f,C,p,A===m-1))}var W=x===2?",":"";for(T[0]="["+T[0]+W,A=1;A<T.length-1;A++)T[A]=" "+T[A]+W;var N=`,
`;for(A=2;A<x;A++)N+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(v?"":N),T}(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+s),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(a.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function x0(n,e,t){return xv(Array.isArray(n)?parseFloat(n[0].toFixed(DT))+" + "+parseFloat(n[1].toFixed(DT))+"j":zD(n)?"'"+n+"'":t==="bool"?nY(n):parseFloat(n.toFixed(DT)).toString(),e)}function nY(n){return n===0?"false":"true"}function w0(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var E1=function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=St(e),r!=null){var o=r.length;ee(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||lS(t,this.size),this.strides=la(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),ee(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var s=o[i];if(s<0||s>=this.shape[r]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return nl().makeTensor(this.values,this.shape,this.dtype)},n}(),nl=null,Ge=null,rY=null,cr=function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=St(e),this.strides=la(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),ee(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),Ge.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Et(this,void 0,void 0,function(){var e;return Ct(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ge.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Ge.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Et(this,void 0,void 0,function(){var e;return Ct(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,O6(this.shape,e)]}})})},n.prototype.arraySync=function(){return O6(this.shape,this.dataSync())},n.prototype.data=function(){return Et(this,void 0,void 0,function(){var e,t;return Ct(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=nl().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(i){return cS(i)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var e=nl().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return cS(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Et(this,void 0,void 0,function(){var e;return Ct(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,nl().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(nl().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Ge.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Ge.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Ge.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Ge.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Ge.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Ge.clone(this)},n.prototype.toString=function(e){return e===void 0&&(e=!1),RCe(this.dataSync(),this.shape,this.dtype,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ge.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Ge.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Ge.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Ge.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Ge.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Ge.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Ge.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ge.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Ge.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Ge.unstack(this,e)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),rY("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ge.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ge.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ge.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Ge.cast(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Ge.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Ge.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Ge.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Ge.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Ge.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Ge.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Ge.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Ge.mulStrict(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Ge.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Ge.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Ge.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Ge.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Ge.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Ge.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Ge.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Ge.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ge.squaredDifferenceStrict(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Ge.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Ge.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Ge.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Ge.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Ge.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ge.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Ge.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Ge.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Ge.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ge.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ge.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ge.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ge.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Ge.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Ge.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Ge.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Ge.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Ge.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Ge.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Ge.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Ge.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Ge.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Ge.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Ge.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Ge.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Ge.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Ge.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Ge.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Ge.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Ge.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Ge.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Ge.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Ge.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ge.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Ge.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Ge.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Ge.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Ge.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Ge.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Ge.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Ge.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ge.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Ge.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Ge.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Ge.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Ge.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Ge.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Ge.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Ge.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Ge.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Ge.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Ge.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Ge.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Ge.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Ge.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Ge.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Ge.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Ge.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Ge.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Ge.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ge.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ge.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ge.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ge.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,s){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Ge.conv1d(this,e,t,r,i,o,s)},n.prototype.conv2d=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ge.conv2d(this,e,t,r,i,o,s)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),Ge.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,s){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ge.depthwiseConv2d(this,e,t,r,i,o,s)},n.prototype.separableConv2d=function(e,t,r,i,o,s){return o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC"),this.throwIfDisposed(),Ge.separableConv2d(this,e,t,r,i,o,s)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),Ge.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),Ge.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),Ge.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),Ge.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),nl().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ge.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Ge.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ge.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Ge.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,s,a,u){return i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),this.throwIfDisposed(),Ge.stridedSlice(this,e,t,r,i,o,s,a,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ge.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Ge.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Ge.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Ge.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Ge.spectral.irfft(this)},n}();Object.defineProperty(cr,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var U6,p4,m4,v4,g4,Qv=function(n){function e(t,r,i,o){var s=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return s.trainable=r,s.name=i,s}return Du(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Wi(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");nl().disposeTensor(this),this.dataId=t.dataId,nl().incRef(this,null)},e.prototype.dispose=function(){nl().disposeVariable(this),this.isDisposedInternal=!0},e}(cr);Object.defineProperty(Qv,Symbol.hasInstance,{value:function(n){return n instanceof cr&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(U6||(U6={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(p4||(p4={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(m4||(m4={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(v4||(v4={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(g4||(g4={}));var ACe={float32:v4,int32:p4,bool:m4,complex64:g4};function Zi(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return ACe[n][e]}function NT(n){return Zi(n,"int32")}function Or(n,e){if(n.dtype===e.dtype)return[n,e];var t=Zi(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function ICe(n,e){ee(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function iY(n){var e=[];return function t(r,i,o){if(r!=null){if(r instanceof cr)return void i.push(r);if(s=r,!(!Array.isArray(s)&&typeof s!="object")){var s,a=r;for(var u in a){var l=a[u];o.has(l)||(o.add(l),t(l,i,o))}}}}(n,e,new Set),e}var LT,z6=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),PCe=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new z6}return n.prototype.ready=function(){return Et(this,void 0,void 0,function(){var e,t,r;return Ct(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Et(this,void 0,void 0,function(){var t,r,i;return Ct(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new MCe(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this;L6(this.backendName).forEach(function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this;L6(e).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,s=i.then(function(a){return!(o<t.pendingBackendInitId)&&(t.registry[e]=a,t.pendingBackendInit=null,!0)}).catch(function(a){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),!1)});return this.pendingBackendInit=s,{success:s,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(a){return console.warn("Initialization of backend "+e+" failed"),console.warn(a.stack||a.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,s=i.asyncInit;if(s||o)return{name:r,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],function(i){return{x:function(){return i.toFloat()}}},[],{}),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var s=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=i-t-o-s;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,s,a){var u,l=this,c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,g=Xq(i,this.backendName);if(g!=null)f=function(){var x=l.backend.numDataIds();v=g.kernelFunc({inputs:t,attrs:o,backend:l.backend});var _=Array.isArray(v)?v:[v];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,_);var b=_.map(function(C){var R=C.dataId,T=C.shape,A=C.dtype;return l.makeTensorFromDataId(R,T,A)});if(h){var S=l.getTensorsForGradient(i,t,b);if(S==null){a==null&&(a=[]);var E=b.filter(function(C,R){return a[R]});S=(s||[]).slice().concat(E)}c=l.saveTensorsForBackwardMode(S)}return b};else{var m=function(x){h&&(c=x.map(function(_){return l.keep(l.clone(_))}))};f=function(){var x=l.backend.numDataIds();v=l.tidy(function(){return e(l.backend,m)});var _=Array.isArray(v)?v:[v];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,_),_}}return this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,function(){return f()}):f()}),h&&this.addTapeNode(i,t,u,r,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(x){return t[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(v)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map(function(r){return t.keep(t.clone(r))})},n.prototype.getTensorsForGradient=function(e,t,r){var i=N6(e);if(i!=null){var o=i.inputsToSave||[],s=i.outputsToSave||[],a=void 0;i.saveAllInputs?(ee(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),a=Object.keys(t).map(function(l){return t[l]})):a=o.map(function(l){return t[l]});var u=r.filter(function(l,c){return s[c]});return a.concat(u)}return null},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&zD(e[0])&&(o=e.map(function(c){return CCe(c)}));var s=i.write(o,t,r),a=new cr(t,r,s,this.nextTensorId());if(this.incRef(a,i),r==="string"){var u=this.state.tensorInfo.get(s),l=bCe(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return a},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new cr(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Qv(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*Zq(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Qv||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Et(this,void 0,void 0,function(){var t,r;return Ct(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,o,s){var a=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=N6(e);l!=null&&(i=l.gradFunc),i!=null&&(u.gradient=function(c){return c=c.map(function(h,f){if(h==null){var d=r[f],p=px(d.size,d.dtype);return a.makeTensor(p,d.shape,d.dtype)}return h}),i(c.length>1?c:c[0],o,s)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=iY(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var s=this.state.activeScope.track[o];s.kept||i.has(s.id)||s.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==a.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),ee(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var s=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});ee(s instanceof cr,function(){return"The result y returned by f() must be a tensor."});var a=function(u,l,c){for(var h={},f={},d=0;d<l.length;d++)h[l[d].id]=!0;for(d=0;d<u.length;d++){var p=(E=u[d]).inputs;for(var v in p){for(var g=p[v],m=!1,x=0;x<l.length;x++)if(h[g.id]){E.outputs.forEach(function(A){return h[A.id]=!0}),m=!0,f[E.id]=!0;break}if(m)break}}var _={};_[c.id]=!0;var b={};for(d=u.length-1;d>=0;d--)for(p=(E=u[d]).inputs,x=0;x<E.outputs.length;x++)if(_[E.outputs[x].id]){for(var v in p)_[p[v].id]=!0,b[E.id]=!0;break}var S=[];for(d=0;d<u.length;d++){var E;if(f[(E=u[d]).id]&&b[E.id]){var C={};for(var v in E.inputs){var R=E.inputs[v];h[R.id]&&(C[v]=R)}var T=Object.assign({},E);T.inputs=C,T.outputs=E.outputs,S.push(T)}}return S}(this.state.activeTape,t,s);if(!i&&a.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[s.id]=r??(u=s.shape,l=Jq(St(u),"float32"),fe.makeTensor(l,u,"float32")),function(f,d,p){for(var v=function(m){var x=d[m],_=[];if(x.outputs.forEach(function(C){var R=f[C.id];R!=null?_.push(R):_.push(null)}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var b=x.gradient(_),S=function(C){if(!(C in b))throw new Error("Cannot backprop through input "+C+". Available gradients found: "+Object.keys(b)+".");var R=p(function(){return b[C]()});if(R.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+C+" must have 'float32' dtype, but has '"+R.dtype+"'");var T=x.inputs[C];if(!Wi(R.shape,T.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+C+"' has shape '"+R.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=R;else{var A=f[T.id];f[T.id]=A.add(R),A.dispose()}};for(var E in x.inputs)S(E)},g=d.length-1;g>=0;g--)v(g)}(c,a,function(f){return o.tidy(f)});var h=t.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var d=0,p=f.saved;d<p.length;d++)p[d].dispose()}),o.state.activeTape=null),{value:s,grads:h}})},n.prototype.customGrad=function(e){var t=this;return ee(h4(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ee(i.every(function(a){return a instanceof cr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var s={};return i.forEach(function(a,u){s[u]=a}),t.runKernelFunc(function(a,u){return ee((r=e.apply(void 0,i.concat([u]))).value instanceof cr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ee(h4(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},s,function(a,u){var l=r.gradFunc(a,u),c=Array.isArray(l)?l:[l];ee(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ee(c.every(function(f){return f instanceof cr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,d){h[d]=function(){return f}}),h})}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return Et(this,void 0,void 0,function(){var t,r;return Ct(this,function(i){switch(i.label){case 0:return t=Qu(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=Qu()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new z6,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),fe=function(){var n=function(){if(LT==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}LT=t}return LT}();if(n._tfengine==null){var e=new dCe(n);n._tfengine=new PCe(e)}return function(t){jq=t}(n._tfengine.ENV),nl=function(){return n._tfengine},n._tfengine}();function oY(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Wl=je();Wl.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),Wl.registerFlag("IS_BROWSER",function(){return oY()}),Wl.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),Wl.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Wl.registerFlag("PROD",function(){return!1}),Wl.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Wl.getBool("DEBUG")}),Wl.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Wl.registerFlag("IS_TEST",function(){return!1});var C1,ra,Zs,Jf={},FT={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function kCe(n,e){Jf[n]=e}function Ml(n){n in Jf||(Jf[n]=function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Jf[t]},!1),t===1?r.getContext("webgl",FT)||r.getContext("experimental-webgl",FT):r.getContext("webgl2",FT)}(n));var e=Jf[n];return e.isContextLost()?(delete Jf[n],Ml(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Jf[n])}function UE(n,e){return[e,n]}function vy(n){var e=St(n);return c4(Math.ceil(e/4))}function mx(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function VD(n,e){var t,r,i,o,s,a,u,l,c,h=n;return je().getNumber("WEBGL_VERSION")===2?(t=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,s=h.RED,a=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=h.RGBA,s=n.RGBA,a=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:a,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function kt(n,e,t){var r=t();return e&&function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+FCe(i,o))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(C1||(C1={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(ra||(ra={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Zs||(Zs={}));var DCe=596e-10,NCe=65504;function LCe(n){return!!(je().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||DCe<Math.abs(n)&&Math.abs(n)<NCe)}function FCe(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Zw(n,e,t){return Ac(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function OCe(n,e,t){var r=Ac(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(kt(n,e,function(){return n.shaderSource(r,t)}),kt(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function BCe(n,e,t){var r=Ac(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(kt(n,e,function(){return n.shaderSource(r,t)}),kt(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(i,o){var s=UCe.exec(o);if(s==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var a=+s[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,m){return xv((m+1).toString(),l)+g}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var d=c.slice(0,a-1),p=c.slice(a-1,a),v=c.slice(a);console.log(d.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+xv(p[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var OT,BT,UCe=/ERROR: [0-9]+:([0-9]+):/g;function zCe(n,e){return Ac(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function VCe(n,e,t){if(kt(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function UT(n,e,t){if(kt(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function WCe(n,e,t){var r=Ac(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return kt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),kt(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function HCe(n,e,t){var r=Ac(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return kt(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),kt(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function GCe(n,e){return Ac(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function $Ce(n,e){var t=je().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function jCe(n,e){return Ac(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function V6(n,e,t,r,i,o,s,a){var u=n.getAttribLocation(t,r);return u!==-1&&(kt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),kt(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,s,a)}),kt(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function XCe(n,e,t,r){QCe(n,r),kt(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function qCe(n,e,t,r){return Ac(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function YCe(n,e,t){return n.getUniformLocation(e,t)}function KCe(n,e,t,r,i,o){kt(n,e,function(){return XCe(n,e,r,o)}),kt(n,e,function(){return n.uniform1i(i,o)})}function zT(n,e,t,r){kt(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),kt(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function W6(n,e,t){kt(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),kt(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Qw(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ZCe(n,e))}function ZCe(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ac(n,e,t,r){var i=kt(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function QCe(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function hS(n,e){return e===void 0&&(e=2),St(n.slice(0,n.length-e))}function fS(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function VT(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[hS(n)].concat(fS(n))),e}function JCe(n,e){var t;e===void 0&&(e=!1);var r=je().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?Kq(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=rd(n);n=i.newShape}var o=St(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var s=hS(n),a=2,u=2;return n.length&&(a=(t=fS(n))[0],u=t[1]),c4(o=s*(a/2)*(u/2)).map(function(l){return 2*l})}return c4(o)}function Jw(n){return n%2==0}function e_(n,e){if(Wi(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Jw(t)&&Jw(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Jw(n[0])&&Jw(e[0])}function e3e(n){if(OT==null){var e=Ml(n);OT=e.getParameter(e.MAX_TEXTURE_SIZE)}return OT}function t3e(n){if(BT==null){var e=Ml(n);BT=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,BT)}function n3e(n){if(n===0)return 0;var e=Ml(n);return Ua(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Ua(e,"EXT_disjoint_timer_query")?1:0}function Ua(n,e){return n.getExtension(e)!=null}function H6(n){try{if(Ml(n)!=null)return!0}catch{return!1}return!1}function r3e(n){if(n===0)return!1;var e=Ml(n);if(n===1){if(!Ua(e,"OES_texture_float"))return!1}else if(!Ua(e,"EXT_color_buffer_float"))return!1;return y4(e)}function i3e(n){if(n===0)return!1;var e=Ml(n);if(n!==1){if(Ua(e,"EXT_color_buffer_float"))return y4(e);if(Ua(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return function(r,i){var o=VD(r,i),s=r.createTexture();r.bindTexture(r.TEXTURE_2D,s),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var a=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,a),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(s),r.deleteFramebuffer(a),u}(e,t)}return!1}return!!Ua(e,"OES_texture_float")&&!!Ua(e,"WEBGL_color_buffer_float")&&y4(e)}function y4(n){var e=VD(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function o3e(n){return n===2&&Ml(n).fenceSync!=null}var Jt=je();function sY(n){je().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Xn(n,e){return fe.tidy(n,e)}function Rs(n){iY(n).forEach(function(e){return e.dispose()})}function s3e(n){return fe.keep(n)}function dS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];je().getBool("IS_TEST")||console.warn.apply(console,n)}function mf(n,e){var t=n;if(gl(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||gl(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&je().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function i(o,s,a){if(a=a||[],!Array.isArray(o)&&!gl(o))return void ee(s.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+s[0]+" elements"});ee(s.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),ee(o.length===s[0],function(){return"Element arr["+a.join("][")+"] should have "+s[0]+" elements, but has "+o.length+" elements"});for(var u=s.slice(1),l=0;l<o.length;++l)i(o[l],u,a.concat(l))}(n,r,[]),r}function G6(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function Y(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof cr)return G6(r,n.dtype,e,t),n;var i=dx(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),G6(r,i,e,t),n==null||!gl(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var s=mf(n,i);gl(n)||Array.isArray(n)||(n=[n]);var a=i!=="string"?Qq(n,i,je().getBool("DEBUG")):Kv(n,[],!0);return fe.makeTensor(a,s,i)}function pS(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return Y(i,e+"["+o+"]",t)},r)}function aY(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function a3e(n,e,t){for(var r=n.length+e.length,i=[],o=0,s=0,a=0;a<r;a++)t.indexOf(a)===-1?i.push(n[o++]):i.push(e[s++]);return i}function _o(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function Ps(n,e){return a3e(n,e.map(function(t){return 1}),e)}function Xs(n,e,t){ee(aY(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function Tl(n,e){if(aY(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function WD(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Rl(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function u3e(n,e){var t=n[0].length;n.forEach(function(i,o){ee(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),ee(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var s=0;s<t;s++)ee(s===e||i[s]===r[s],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Jv(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function ue(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];fe.startScope(t);try{var a=r.apply(void 0,o);return a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),fe.endScope(a),a}catch(u){throw fe.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}Jt.registerFlag("HAS_WEBGL",function(){return Jt.getNumber("WEBGL_VERSION")>0}),Jt.registerFlag("WEBGL_VERSION",function(){return H6(2)?2:H6(1)?1:0}),Jt.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Jt.get("WEBGL_VERSION")===2}),Jt.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Jt.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Jt.registerFlag("WEBGL_PACK",function(){return Jt.getBool("HAS_WEBGL")}),Jt.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_CLIP",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Jt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_PACK_REDUCE",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_CONV_IM2COL",function(){return Jt.getBool("WEBGL_PACK")}),Jt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return e3e(Jt.getNumber("WEBGL_VERSION"))}),Jt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return t3e(Jt.getNumber("WEBGL_VERSION"))}),Jt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Jt.getNumber("WEBGL_VERSION");return n===0?0:n3e(n)}),Jt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Jt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Jt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return r3e(Jt.getNumber("WEBGL_VERSION"))}),Jt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Jt.getBool("WEBGL_FORCE_F16_TEXTURES")&&Jt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Jt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return i3e(Jt.getNumber("WEBGL_VERSION"))}),Jt.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return o3e(Jt.getNumber("WEBGL_VERSION"))}),Jt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Jt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),rY=sY;var Ki=ue({complex_:function(n,e){var t=Y(n,"real","complex"),r=Y(e,"imag","complex");return Zn(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),fe.runKernelFunc(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),Na=ue({real_:function(n){var e=Y(n,"input","real");return fe.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),rl=ue({imag_:function(n){var e=Y(n,"input","imag");return fe.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Qi(n,e,t){return vf(n,e,mf(n,t),t)}function vf(n,e,t,r){if(r==null&&(r=dx(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!gl(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){eY(e);var i=St(e),o=St(t);ee(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var s=0;s<t.length;++s){var a=t[s],u=s!==t.length-1||a!==St(e.slice(s));ee(t[s]===e[s]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return gl(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?Qq(n,r,je().getBool("DEBUG")):Kv(n,[],!0),fe.makeTensor(n,e,r)}function Dt(n,e){if((gl(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&gl(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vf(n,[],[],e)}function Tu(n,e){xg(n);var t=mf(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vf(n,null,t,e)}function Fd(n,e,t){if(xg(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=mf(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vf(n,e,r,t)}function uY(n,e,t){if(xg(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=mf(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vf(n,e,r,t)}function Ju(n,e,t){if(xg(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=mf(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vf(n,e,r,t)}function l3e(n,e,t){if(xg(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=mf(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vf(n,e,r,t)}function c3e(n,e,t){if(xg(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=mf(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vf(n,e=e||r,r,t)}function h3e(n,e,t,r){return e===void 0&&(e=!0),fe.makeVariable(n,e,t,r)}function wg(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=wg(n,"float32"),r=Gr(n,"float32");return Ki(t,r)}var i=Jq(St(n),e);return fe.makeTensor(i,n,e)}function Gr(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Gr(n,"float32"),r=Gr(n,"float32");return Ki(t,r)}var i=px(St(n),e);return fe.makeTensor(i,n,e)}function Od(n,e,t){return fe.runKernelFunc(function(r){return r.fill(n,e,t)},{})}function f3e(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return fe.runKernelFunc(function(r){return r.linspace(n,e,t)},{})}function mS(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Gr([0],r);var i=px(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Tu(i,r)}var lY=ue({onesLike_:function(n){var e=Y(n,"x","onesLike");if(e.dtype==="complex64"){var t=lY(Na(e)),r=Dn(rl(e));return Ki(t,r)}return fe.runKernelFunc(function(i){return i.onesLike(e)},{x:e},function(i,o){return{x:function(){return Dn(i)}}},"OnesLike")}}),Dn=ue({zerosLike_:function(n){var e=Y(n,"x","zerosLike");return fe.runKernelFunc(function(t){return t.zerosLike(e)},{x:e},function(t,r){return{x:function(){return Dn(t)}}},"ZerosLike")}}),qa=ue({concat_:function(n,e){e===void 0&&(e=0),ee(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=pS(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach(function(a){if(a.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+a.dtype+". ")}),e=Pi(e,t[0].shape)[0];var r=Jv(t.map(function(a){return a.shape}),e);if(St(r)===0)return Qi([],r);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var i=t.map(function(a){return a.shape});u3e(i,e);var o=t,s={axis:e};return fe.runKernelFunc(function(a){return a.concat(t,e)},o,function(a){var u=i.map(function(l){return l[e]});return HD(a,u,e).map(function(l){return function(){return l}})},"Concat",s)}}),d3e=ue({concat1d_:function(n){return qa(n,0)}}),p3e=ue({concat2d_:function(n,e){return qa(n,e)}}),m3e=ue({concat3d_:function(n,e){return qa(n,e)}}),v3e=ue({concat4d_:function(n,e){return qa(n,e)}}),HD=ue({split_:function(n,e,t){t===void 0&&(t=0);var r,i=Y(n,"x","split");return t=Pi(t,i.shape)[0],typeof e=="number"?(ee(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(ee(i.shape[t]===e.reduce(function(o,s){return o+s}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),fe.runKernelFunc(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return qa(o,t)}}})}});function nn(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",eY(n),new E1(n,e,t)}function g3e(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var cY=ue({batchToSpaceND_:function(n,e,t){var r=Y(n,"x","batchToSpaceND"),i=e.reduce(function(o,s){return o*s});return ee(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),ee(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),ee(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),fe.runKernelFunc(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),y3e=ue({cast_:function(n,e){var t=Y(n,"x","cast");if(!wCe(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return fe.runKernelFunc(function(i){return i.cast(t,e)},{x:t},function(i){return{x:function(){return i.clone()}}},"Cast",r)}}),x3e=ue({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=Y(n,"x","cumsum"),o=Tl([e|=0],i.rank),s=i;o!=null&&(s=i.transpose(o));var a=Rl(1,i.rank)[0],u=fe.runKernelFunc(function(l){return l.cumsum(s,a,t,r)},{permutedX:s},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),w3e=ue({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=Y(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],s=t==="NHWC"?r.shape[3]:r.shape[1];return ee(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),ee(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),ee(s%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+s+" for depthToSpace with input shape "+r.shape}),fe.runKernelFunc(function(a){return a.depthToSpace(r,e,t)},{$x:r})}}),sh=ue({expandDims_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","expandDims",null);ee(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(ee(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Xl(t,r)}}),Xl=ue({reshape_:function(n,e){var t=Y(n,"x","reshape",null);e=yCe(e,t.size),ee(t.size===St(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return fe.runKernelFunc(function(i){return i.reshape(t,e)},{x:t},function(i){return{x:function(){return i.reshape(t.shape)}}},"Reshape",r)}}),hY=ue({spaceToBatchND_:function(n,e,t){var r=Y(n,"x","spaceToBatchND");return ee(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),ee(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),ee(r.shape.reduce(function(i,o,s){return s>0&&s<=e.length?i&&(o+t[s-1][0]+t[s-1][1])%e[s-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),fe.runKernelFunc(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),fY=ue({squeeze_:function(n,e){var t=Y(n,"x","squeeze");return Xl(t,rd(t.shape,e).newShape)}}),Qh=ue({stack_:function(n,e){e===void 0&&(e=0);var t=pS(n,"tensors","stack");if(ee(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;ee(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(a){Zn(i,a.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(a){ee(o===a.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=t.map(function(a){return a.expandDims(e)});return qa(s,e)}}),zE=ue({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=Y(n,"x","unstack");ee(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length);var r={axis:e};return fe.runKernelFunc(function(i){return i.unstack(t,e)},{x:t},function(i){return{x:function(){return Qh(i,e)}}},"Unpack",r)}}),_3e=function(n,e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h;return Ct(this,function(f){switch(f.label){case 0:return t=Y(n,"x","setdiff1d"),r=Y(e,"y","setdiff1d"),ee(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),ee(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),ee(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),s=new Set(o),a=0,c=0;c<i.length;c++)s.has(i[c])||a++;for(u=new E1([a],t.dtype),l=new E1([a],"int32"),c=0,h=0;c<i.length;c++)s.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function vS(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,s=0;s<o;++s)i=i.concat([n[s+1]/e[s],e[s]]);i=i.concat(n.slice(o+1))}return i}function gS(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],s=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?s.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,s)}return r}function yS(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function dY(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function pY(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}var mY="Add",VE="Div",WE="SquaredDifference",vY="BroadcastTo",gY="OneHot",yY="Identity",xY="Tile",wY="PadV2",Ya=ue({add_:function(n,e){var t,r=Y(n,"a","add"),i=Y(e,"b","add");t=Or(r,i),r=t[0],i=t[1];var o={a:r,b:i};return fe.runKernelFunc(function(s,a){var u=s.add(r,i);return a([r,i]),u},o,null,mY)}});function wh(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,s=n[o]||1;(e[e.length-1-i]||1)>1&&s===1&&r.unshift(o)}return r}function Ei(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,s=e[o];(i==null||i===1&&s>1)&&t.unshift(o)}return t}function En(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var s=e[e.length-i-1];if(s==null&&(s=1),o===1)t.unshift(s);else if(s===1)t.unshift(o);else{if(o!==s)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}var b3e=ue({abs_:function(n){var e=Y(n,"x","abs");return e.dtype==="complex64"?fe.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):fe.runKernelFunc(function(t,r){var i=t.abs(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}},"Abs")}}),S3e=ue({acos_:function(n){var e=Y(n,"x","acos");return fe.runKernelFunc(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Dt(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),E3e=ue({acosh_:function(n){var e=Y(n,"x","acosh");return fe.runKernelFunc(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),C3e=ue({asin_:function(n){var e=Y(n,"x","asin");return fe.runKernelFunc(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Dt(1).sub(i.toFloat().square()).sqrt())}}})}}),M3e=ue({asinh_:function(n){var e=Y(n,"x","asinh");return fe.runKernelFunc(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Dt(1).add(i.toFloat().square()).sqrt())}}})}}),T3e=ue({atan_:function(n){var e=Y(n,"x","atan");return fe.runKernelFunc(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),R3e=ue({atanh_:function(n){var e=Y(n,"x","atanh");return fe.runKernelFunc(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(Dt(1).sub(i.toFloat().square()))}}})}}),A3e=ue({ceil_:function(n){var e=Y(n,"x","ceil");return fe.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),I3e=ue({clipByValue_:function(n,e,t){var r=Y(n,"x","clipByValue");ee(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."});var i=[r],o={min:e,max:t};return fe.runKernelFunc(function(s,a){var u=s.clip(r,e,t);return a([r]),u},{x:r},function(s,a){var u=a[0];return{x:function(){return s.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),Dn(s))}}},"ClipByValue",o,i)}}),P3e=ue({cos_:function(n){var e=Y(n,"x","cos"),t=[e];return fe.runKernelFunc(function(r,i){var o=r.cos(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},t)}}),k3e=ue({cosh_:function(n){var e=Y(n,"x","cosh");return fe.runKernelFunc(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),D3e=ue({erf_:function(n){var e=Y(n,"x","erf");return ee(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),fe.runKernelFunc(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),N3e=ue({exp_:function(n){var e=Y(n,"x","exp");return fe.runKernelFunc(function(t,r){var i=t.exp(e);return r([i]),i},{x:e},function(t,r){return{x:function(){return t.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),L3e=ue({expm1_:function(n){var e=Y(n,"x","expm1");return fe.runKernelFunc(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),F3e=ue({floor_:function(n){var e=Y(n,"x","floor");return fe.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),O3e=ue({log_:function(n){var e=Y(n,"x","log"),t=[e];return fe.runKernelFunc(function(r,i){var o=r.log(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},t)}}),B3e=ue({log1p_:function(n){var e=Y(n,"x","log1p");return fe.runKernelFunc(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),U3e=ue({logSigmoid_:function(n){var e=Y(n,"x","logSigmoid");return fe.runKernelFunc(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),GD=ue({neg_:function(n){var e=Y(n,"x","neg"),t=[e];return fe.runKernelFunc(function(r){return r.neg(e)},{x:e},function(r){return{x:function(){return r.neg()}}},"Neg",{},t)}}),z3e=ue({reciprocal_:function(n){var e=Y(n,"x","reciprocal");return fe.runKernelFunc(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),V3e=ue({round_:function(n){var e=Y(n,"x","round");return fe.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),_Y=ue({rsqrt_:function(n){var e=Y(n,"x","rsqrt"),t=[e];return fe.runKernelFunc(function(r,i){var o=r.rsqrt(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},t)}}),W3e=ue({sigmoid_:function(n){var e=Y(n,"x","sigmoid");return fe.runKernelFunc(function(t,r){var i=t.sigmoid(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Dt(1).sub(i)))}}},"Sigmoid")}}),H3e=ue({sign_:function(n){var e=Y(n,"x","sign");return fe.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),G3e=ue({isNaN_:function(n){var e=Y(n,"x","isNaN");return fe.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),$3e=ue({isInf_:function(n){var e=Y(n,"x","isInf");return fe.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),j3e=ue({isFinite_:function(n){var e=Y(n,"x","isFinite");return fe.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Dn(t)}}})}}),X3e=ue({sin_:function(n){var e=Y(n,"x","sin"),t=[e];return fe.runKernelFunc(function(r,i){var o=r.sin(e);return i([e]),o},{x:e},function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},t)}}),q3e=ue({sinh_:function(n){var e=Y(n,"x","sinh");return fe.runKernelFunc(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),Y3e=ue({softplus_:function(n){var e=Y(n,"x","softplus");return fe.runKernelFunc(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),K3e=ue({sqrt_:function(n){var e=Y(n,"x","sqrt");return fe.runKernelFunc(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),Z3e=ue({step_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","step");return fe.runKernelFunc(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return Dn(r)}}})}}),Q3e=ue({tan_:function(n){var e=Y(n,"x","tan");return fe.runKernelFunc(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),J3e=ue({tanh_:function(n){var e=Y(n,"x","tanh");return fe.runKernelFunc(function(t,r){var i=t.tanh(e);return r([i]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return Dt(1).sub(i.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}}),eMe=ue({addStrict_:function(n,e){var t=Y(n,"a","addStrict"),r=Y(e,"b","addStrict");return Zn(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),tMe=ue({atan2_:function(n,e){var t,r=Y(n,"a","atan2"),i=Y(e,"b","atan2");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape);return fe.runKernelFunc(function(s,a){var u=s.atan2(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=Ya(u.square(),l.square()),h=s.mul(l.div(c)),f=Ei(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=Ya(u.square(),l.square()),h=GD(s.mul(u.div(c))),f=Ei(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),nMe=ue({divStrict_:function(n,e){var t=Y(n,"a","div"),r=Y(e,"b","div");return Zn(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),bY=ue({floorDiv_:function(n,e){var t,r=Y(n,"a","floorDiv"),i=Y(e,"b","floorDiv");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape);return fe.runKernelFunc(function(s,a){var u=s.floorDiv(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.div(l.toFloat()),h=Ei(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),h=Ei(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),$D=ue({maximum_:function(n,e){var t,r=Y(n,"a","maximum"),i=Y(e,"b","maximum");return t=Or(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),En(r.shape,i.shape),fe.runKernelFunc(function(o,s){var a=o.maximum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.greaterEqual(u).toFloat())},b:function(){return o.mul(a.less(u).toFloat())}}},"Maximum")}}),rMe=ue({maximumStrict_:function(n,e){var t=Y(n,"a","maximumStrict"),r=Y(e,"b","maximumStrict");return Zn(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),SY=ue({minimum_:function(n,e){var t,r=Y(n,"a","minimum"),i=Y(e,"b","minimum");return t=Or(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),En(r.shape,i.shape),fe.runKernelFunc(function(o,s){var a=o.minimum(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return o.mul(a.lessEqual(u).toFloat())},b:function(){return o.mul(a.greater(u).toFloat())}}},"Minimum")}}),iMe=ue({minimumStrict_:function(n,e){var t=Y(n,"a","minimumStrict"),r=Y(e,"b","minimumStrict");return Zn(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),oMe=ue({mod_:function(n,e){var t,r=Y(n,"a","mod"),i=Y(e,"b","mod");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape);return fe.runKernelFunc(function(s,a){var u=s.mod(r,i);return a([r,i]),u},{$a:r,$b:i},function(s,a){var u=a[0],l=a[1];return{$a:function(){var c=Ei(u.shape,o);return c.length>0?s.sum(c).reshape(u.shape):s},$b:function(){var c=s.mul(u.div(l).floor().neg()),h=Ei(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),sMe=ue({modStrict_:function(n,e){var t=Y(n,"a","modStrict"),r=Y(e,"b","modStrict");return Zn(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Hr=ue({mul_:function(n,e){var t,r=Y(n,"a","mul"),i=Y(e,"b","mul");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape);return fe.runKernelFunc(function(s,a){var u=s.multiply(r,i);return a([r,i]),u},{a:r,b:i},function(s,a){var u=a[0],l=a[1];return{a:function(){var c=s.mul(l.toFloat()),h=Ei(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=s.mul(u.toFloat()),h=Ei(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}},"Mul")}}),aMe=ue({mulStrict_:function(n,e){var t=Y(n,"a","mul"),r=Y(e,"b","mul");return Zn(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),xS=ue({pow_:function(n,e){var t,r=Y(n,"base","pow"),i=Y(e,"exp","pow");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape),s=[r,i];return fe.runKernelFunc(function(a,u){var l=a.pow(r,i);return u([r,i,l]),l},{a:r,b:i},function(a,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var f=c.toFloat(),d=a.mul(f.mul(l.pow(f.sub(Dt(1))))),p=Ei(l.shape,o);return p.length>0&&(d=d.sum(p)),d.reshape(l.shape)},b:function(){var f=l.greater(0),d=l.log().where(f,Dn(l)),p=a.mul(h.mul(d)),v=Ei(c.shape,o);return v.length>0&&(p=p.sum(v)),p.reshape(c.shape)}}},"Pow",{},s,[!0])}}),uMe=ue({powStrict_:function(n,e){return Zn(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),lMe=ue({squaredDifferenceStrict_:function(n,e){var t=Y(n,"a","squaredDifferenceStrict"),r=Y(e,"b","squaredDifferenceStrict");return Zn(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Su=ue({sub_:function(n,e){var t,r=Y(n,"a","sub"),i=Y(e,"b","sub");t=Or(r,i),r=t[0],i=t[1];var o=En(r.shape,i.shape);return fe.runKernelFunc(function(s){return s.subtract(r,i)},{a:r,b:i},function(s){return{a:function(){var a=s,u=Ei(r.shape,o);return u.length>0&&(a=a.sum(u)),a.reshape(r.shape)},b:function(){var a=s,u=Ei(i.shape,o);return u.length>0&&(a=a.sum(u)),a.neg().reshape(i.shape)}}},"Sub")}}),cMe=ue({subStrict_:function(n,e){var t=Y(n,"a","subStrict"),r=Y(e,"b","subStrict");return Zn(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Jh=ue({div_:function(n,e){var t,r=Y(n,"a","div"),i=Y(e,"b","div");if(t=Or(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return bY(r,i);var o={a:r,b:i};return fe.runKernelFunc(function(s,a){var u=s.realDivide(r,i);return a([r,i]),u},o,null,VE,{})}});function EY(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var s=n.shape,a=t.slice();a.pop();var u=1;for(o=r;o<n.rank;++o)u*=s[o],a.push(s[o]);var l=la(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[a,i,u,l]}var CY=30;function WT(n){return n<=CY?n:f4(n,Math.floor(Math.sqrt(n)))}function hMe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var s=0;s<i;++s)if(t.shape[s]!==e.shape[s])throw new Error(o+" updates.shape["+s+"] ("+t.shape[s]+") != indices.shape["+s+"] ("+e.shape[s]+").");for(s=0;s<t.rank-i;++s)if(t.shape[s+i]!==n[s+r])throw new Error(o+" updates.shape["+(s+i)+"] ("+t.shape[s+i]+") != shape["+(s+i)+"] ("+n[s+i]+")")}function fMe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}hMe(t,e,n)}function wS(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,s=1,a=i;a<o;++a)s*=t[a];var u=i<1?1:i;return{sliceRank:i,numUpdates:St(e.shape)/u,sliceSize:s,strides:la(t.slice(0,i)).concat([1]),outputSize:St(t)}}function dMe(n,e,t){ee(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."}),ee(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){ee(e[o]+t[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},i=0;i<n.rank;++i)r(i)}function $6(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function jD(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function pMe(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=l4(0,o,a-1)}function mMe(n,e,t,r,i){var o=e[i],s=t[i]||1;(n&1<<i||o==null)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s>0?l4(0,o,a):l4(-1,o,a-1)}function MY(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function TY(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function vMe(n,e){ee(h4(n),function(){return"The f passed in variableGrads(f) must be a function"}),ee(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof Qv}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],fe.registeredVariables)e.push(fe.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;ee((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var s=fe.gradients(n,e,null,!0),a=s.value,u=s.grads;ee(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ee(a.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+a.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i!=null&&i.forEach(function(c){return l[c.name]=null}),{value:a,grads:l}}function HE(n){return fe.customGrad(n)}var GE=ue({softmax_:function(n,e){e===void 0&&(e=-1);var t=Y(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return fe.runKernelFunc(function(r,i){var o=r.softmax(t,e);return i([o]),o},{logits:t},function(r,i){var o=i[0],s=r.mul(o);return{logits:function(){return s.sub(s.sum([e],!0).mul(o))}}},"Softmax",{dim:e},[],[!0])}}),gMe=ue({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=Y(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return HE(function(r,i){var o=r.max(e,!0),s=r.sub(o),a=s.toFloat().sub(s.exp().sum(e,!0).log());return i([a]),{value:a,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),du=ue({transpose_:function(n,e){var t=Y(n,"x","transpose");if(e==null&&(e=t.shape.map(function(i,o){return o}).reverse()),ee(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(i){ee(i>=0&&i<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1)return t.clone();var r={perm:e};return fe.runKernelFunc(function(i){return i.transpose(t,e)},{x:t},null,"Transpose",r)}}),RY=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),AY=function(){function n(){}return n.prototype.time=function(e){return Pe("time")},n.prototype.read=function(e){return Pe("read")},n.prototype.readSync=function(e){return Pe("readSync")},n.prototype.numDataIds=function(){return Pe("numDataIds")},n.prototype.disposeData=function(e){return Pe("disposeData")},n.prototype.write=function(e,t,r){return Pe("write")},n.prototype.move=function(e,t,r,i){return Pe("move")},n.prototype.memory=function(){return Pe("memory")},n.prototype.floatPrecision=function(){return Pe("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return Pe("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,Pe("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return Pe("slice")},n.prototype.stridedSlice=function(e,t,r,i){return Pe("stridedSlice")},n.prototype.unstack=function(e,t){return Pe("unstack")},n.prototype.reverse=function(e,t){return Pe("reverse")},n.prototype.concat=function(e,t){return Pe("concat")},n.prototype.neg=function(e){return Pe("neg")},n.prototype.add=function(e,t){return Pe("add")},n.prototype.addN=function(e){return Pe("addN")},n.prototype.subtract=function(e,t){return Pe("subtract")},n.prototype.multiply=function(e,t){return Pe("multiply")},n.prototype.realDivide=function(e,t){return Pe("realDivide")},n.prototype.floorDiv=function(e,t){return Pe("floorDiv")},n.prototype.sum=function(e,t){return Pe("sum")},n.prototype.prod=function(e,t){return Pe("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return Pe("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return Pe("argMin")},n.prototype.argMax=function(e,t){return Pe("argMax")},n.prototype.equal=function(e,t){return Pe("equal")},n.prototype.notEqual=function(e,t){return Pe("notEqual")},n.prototype.less=function(e,t){return Pe("less")},n.prototype.lessEqual=function(e,t){return Pe("lessEqual")},n.prototype.greater=function(e,t){return Pe("greater")},n.prototype.greaterEqual=function(e,t){return Pe("greaterEqual")},n.prototype.logicalNot=function(e){return Pe("logicalNot")},n.prototype.logicalAnd=function(e,t){return Pe("logicalAnd")},n.prototype.logicalOr=function(e,t){return Pe("logicalOr")},n.prototype.where=function(e){return Pe("where")},n.prototype.select=function(e,t,r){return Pe("select")},n.prototype.topk=function(e,t,r){return Pe("topk")},n.prototype.min=function(e,t){return Pe("min")},n.prototype.minimum=function(e,t){return Pe("minimum")},n.prototype.mod=function(e,t){return Pe("mod")},n.prototype.max=function(e,t){return Pe("max")},n.prototype.maximum=function(e,t){return Pe("maximum")},n.prototype.all=function(e,t){return Pe("all")},n.prototype.any=function(e,t){return Pe("any")},n.prototype.squaredDifference=function(e,t){return Pe("squaredDifference")},n.prototype.ceil=function(e){return Pe("ceil")},n.prototype.floor=function(e){return Pe("floor")},n.prototype.round=function(e){return Pe("round")},n.prototype.sign=function(e){return Pe("sign")},n.prototype.isNaN=function(e){return Pe("isNaN")},n.prototype.isInf=function(e){return Pe("isInf")},n.prototype.isFinite=function(e){return Pe("isFinite")},n.prototype.pow=function(e,t){return Pe("pow")},n.prototype.exp=function(e){return Pe("exp")},n.prototype.expm1=function(e){return Pe("expm1")},n.prototype.softmax=function(e,t){return Pe("softmax")},n.prototype.log=function(e){return Pe("log")},n.prototype.log1p=function(e){return Pe("log1p")},n.prototype.sqrt=function(e){return Pe("sqrt")},n.prototype.rsqrt=function(e){return Pe("rsqrt")},n.prototype.square=function(e){return Pe("square")},n.prototype.reciprocal=function(e){return Pe("reciprocal")},n.prototype.relu=function(e){return Pe("relu")},n.prototype.relu6=function(e){return Pe("relu6")},n.prototype.prelu=function(e,t){return Pe("prelu")},n.prototype.elu=function(e){return Pe("elu")},n.prototype.eluDer=function(e,t){return Pe("eluDer")},n.prototype.selu=function(e){return Pe("selu")},n.prototype.int=function(e){return Pe("int")},n.prototype.clip=function(e,t,r){return Pe("clip")},n.prototype.abs=function(e){return Pe("abs")},n.prototype.complexAbs=function(e){return Pe("complexAbs")},n.prototype.sigmoid=function(e){return Pe("sigmoid")},n.prototype.softplus=function(e){return Pe("softplus")},n.prototype.sin=function(e){return Pe("sin")},n.prototype.cos=function(e){return Pe("cos")},n.prototype.tan=function(e){return Pe("tan")},n.prototype.asin=function(e){return Pe("asin")},n.prototype.acos=function(e){return Pe("acos")},n.prototype.atan=function(e){return Pe("atan")},n.prototype.atan2=function(e,t){return Pe("atan2")},n.prototype.sinh=function(e){return Pe("sinh")},n.prototype.cosh=function(e){return Pe("cosh")},n.prototype.tanh=function(e){return Pe("tanh")},n.prototype.asinh=function(e){return Pe("asinh")},n.prototype.acosh=function(e){return Pe("acosh")},n.prototype.atanh=function(e){return Pe("atanh")},n.prototype.erf=function(e){return Pe("erf")},n.prototype.step=function(e,t){return Pe("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Pe("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return Pe("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return Pe("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return Pe("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,Pe("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return Pe("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return Pe("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return Pe("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return Pe("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return Pe("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return Pe("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return Pe("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return Pe("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return Pe("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return Pe("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return Pe("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return Pe("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return Pe("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return Pe("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return Pe("reshape")},n.prototype.cast=function(e,t){return Pe("cast")},n.prototype.tile=function(e,t){return Pe("tile")},n.prototype.pad=function(e,t,r){return Pe("pad")},n.prototype.transpose=function(e,t){return Pe("transpose")},n.prototype.gather=function(e,t,r){return Pe("gather")},n.prototype.gatherND=function(e,t){return Pe("gatherND")},n.prototype.scatterND=function(e,t,r){return Pe("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return Pe("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return Pe("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return Pe("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return Pe("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return Pe("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return Pe("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,s){return Pe("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return Pe("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,s,a){return Pe("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return Pe("multinomial")},n.prototype.oneHot=function(e,t,r,i){return Pe("oneHot")},n.prototype.cumsum=function(e,t,r,i){return Pe("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return Pe("nonMaxSuppression")},n.prototype.fft=function(e){return Pe("fft")},n.prototype.ifft=function(e){return Pe("ifft")},n.prototype.complex=function(e,t){return Pe("complex")},n.prototype.real=function(e){return Pe("real")},n.prototype.imag=function(e){return Pe("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,s){return Pe("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return Pe("depthToSpace")},n.prototype.split=function(e,t,r){return Pe("split")},n.prototype.sparseToDense=function(e,t,r,i){return Pe("sparseToDense")},n.prototype.diag=function(e){return Pe("diag")},n.prototype.fill=function(e,t,r){return Pe("fill")},n.prototype.onesLike=function(e){return Pe("onesLike")},n.prototype.zerosLike=function(e){return Pe("zerosLike")},n.prototype.linspace=function(e,t,r){return Pe("linspace")},n.prototype.dispose=function(){return Pe("dispose")},n}();function Pe(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Qd(n,e,t,r,i,o,s){s===void 0&&(s="channelsLast");var a,u=SS(e),l=u[0],c=u[1];if(s==="channelsLast")a=[l,c,n[3],n[3]];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);a=[l,c,n[1],n[1]]}return fp(n,a,t,r,i,o,!1,s)}function _S(n,e,t,r,i,o,s){s===void 0&&(s="NDHWC");var a,u,l=x4(e),c=l[0],h=l[1],f=l[2];if(s==="NDHWC")u="channelsLast",a=[c,h,f,n[4],n[4]];else{if(s!=="NCDHW")throw new Error("Unknown dataFormat "+s);u="channelsFirst",a=[c,h,f,n[1],n[1]]}return bS(n,a,t,r,i,!1,u,o)}function fp(n,e,t,r,i,o,s,a){s===void 0&&(s=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(a==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],f=n[1],c=n[2],h=n[3]}var d,p=e[0],v=e[1],g=e[3],m=SS(t),x=m[0],_=m[1],b=SS(r),S=b[0],E=b[1],C=wv(p,S),R=wv(v,E),T=function(N,O,z,V,F,U,L,j){var Q,K,ie;if(typeof N=="number"){Q={top:N,bottom:N,left:N,right:N,type:N===0?"VALID":"NUMBER"};var pe=function(Ne,Z,de,me,Ie){me==null&&(me=IY(Ne,Z,de));var xe=Ne[0],se=Ne[1],Xe=gy((xe-Z+2*me)/de+1,Ie);ee(ii(Xe),function(){return"The output # of rows ("+Xe+") must be an integer. Change the stride and/or zero pad parameters"});var X=gy((se-Z+2*me)/de+1,Ie);return ee(ii(X),function(){return"The output # of columns ("+X+") must be an integer. Change the stride and/or zero pad parameters"}),[Xe,X]}([O,z],U,V,N,j);K=pe[0],ie=pe[1]}else if(N==="same"){K=Math.ceil(O/V),ie=Math.ceil(z/F);var we=Math.max(0,(K-1)*V+U-O),ce=Math.max(0,(ie-1)*F+L-z),_e=Math.floor(we/2),Oe=we-_e,Ve=Math.floor(ce/2);Q={top:_e,bottom:Oe,left:Ve,right:ce-Ve,type:"SAME"}}else{if(N!=="valid")throw Error("Unknown padding parameter: "+N);Q={top:0,bottom:0,left:0,right:0,type:"VALID"},K=Math.ceil((O-U+1)/V),ie=Math.ceil((z-L+1)/F)}return{padInfo:Q,outHeight:K,outWidth:ie}}(i,c,h,x,_,C,R,o),A=T.padInfo,P=T.outHeight,k=T.outWidth,W=s?g*f:g;return a==="channelsFirst"?d=[l,W,P,k]:a==="channelsLast"&&(d=[l,P,k,W]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:h,inChannels:f,outHeight:P,outWidth:k,outChannels:W,padInfo:A,strideHeight:x,strideWidth:_,filterHeight:p,filterWidth:v,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:S,dilationWidth:E,inShape:n,outShape:d,filterShape:e}}function bS(n,e,t,r,i,o,s,a){o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3],d=u[4];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3],d=n[4];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],d=n[1],c=n[2],h=n[3],f=n[4]}var p,v=e[0],g=e[1],m=e[2],x=e[4],_=x4(t),b=_[0],S=_[1],E=_[2],C=x4(r),R=C[0],T=C[1],A=C[2],P=wv(v,R),k=wv(g,T),W=wv(m,A),N=function(L,j,Q,K,ie,pe,we,ce,_e,Oe,Ve){var Ne,Z,de,me;if(typeof L=="number"){Ne={top:L,bottom:L,left:L,right:L,front:L,back:L,type:L===0?"VALID":"NUMBER"};var Ie=function(J,be,ke,He,Ue,We){Ue==null&&(Ue=IY(J,be,He));var Le=J[0],yt=J[1],rt=J[2],dt=gy((Le-be+2*Ue)/He+1,We);ee(ii(dt),function(){return"The output # of depths ("+dt+") must be an integer. Change the stride and/or zero pad parameters"});var ot=gy((yt-be+2*Ue)/He+1,We);ee(ii(ot),function(){return"The output # of rows ("+ot+") must be an integer. Change the stride and/or zero pad parameters"});var Je=gy((rt-be+2*Ue)/He+1,We);return ee(ii(Je),function(){return"The output # of columns ("+Je+") must be an integer. Change the stride and/or zero pad parameters"}),[dt,ot,Je,ke]}([j,Q,K,1],ce,1,ie,L,Ve);Z=Ie[0],de=Ie[1],me=Ie[2]}else if(L==="same"){Z=Math.ceil(j/ie),de=Math.ceil(Q/pe),me=Math.ceil(K/we);var xe=(Z-1)*ie+ce-j,se=(de-1)*pe+_e-Q,Xe=(me-1)*we+Oe-K,X=Math.floor(xe/2),$=xe-X,le=Math.floor(se/2),ze=se-le,Te=Math.floor(Xe/2);Ne={top:le,bottom:ze,left:Te,right:Xe-Te,front:X,back:$,type:"SAME"}}else{if(L!=="valid")throw Error("Unknown padding parameter: "+L);Ne={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},Z=Math.ceil((j-ce+1)/ie),de=Math.ceil((Q-_e+1)/pe),me=Math.ceil((K-Oe+1)/we)}return{padInfo:Ne,outDepth:Z,outHeight:de,outWidth:me}}(i,c,h,f,b,S,E,P,k,W,a),O=N.padInfo,z=N.outDepth,V=N.outHeight,F=N.outWidth,U=o?x*d:x;return s==="channelsFirst"?p=[l,U,z,V,F]:s==="channelsLast"&&(p=[l,z,V,F,U]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:h,inWidth:f,inChannels:d,outDepth:z,outHeight:V,outWidth:F,outChannels:U,padInfo:O,strideDepth:b,strideHeight:S,strideWidth:E,filterDepth:v,filterHeight:g,filterWidth:m,effectiveFilterDepth:P,effectiveFilterHeight:k,effectiveFilterWidth:W,dilationDepth:R,dilationHeight:T,dilationWidth:A,inShape:n,outShape:p,filterShape:e}}function IY(n,e,t,r){r===void 0&&(r=1);var i=wv(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function SS(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function x4(n){return typeof n=="number"?[n,n,n]:n}function wv(n,e){return e<=1?n:n+(n-1)*(e-1)}function gy(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function eg(n){var e=SS(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function es(n,e){return eg(n)||eg(e)}function XD(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function PY(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Gr(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!_Ce(n.dtype,e))return fe.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var s=t.real(n);return o=s.cast(e),s.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var a=Dt(0,n.dtype);return o=t.notEqual(n,a),a.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function w4(n,e){return fe.makeTensorFromDataId(n.dataId,e,n.dtype)}function kY(n,e,t){var r=(e-n)/(t-1),i=px(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Tu(i,"float32")}function _4(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function j6(n,e){return{real:n[2*e],imag:n[2*e+1]}}function yMe(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function xMe(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function wMe(n,e,t){var r=function(o,s,a){return function(u,l,c){for(var h=0,f=u.length,d=0,p=!1;h<f;){var v=c(l,u[d=h+(f-h>>>1)]);v>0?h=d+1:(f=d,p=!v)}return p?h:-h-1}(o,s,a||_Me)}(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function _Me(n,e){return n>e?1:n<e?-1:0}function qD(n,e,t,r,i){return DY(n,e,t,r,i,0).selectedIndices}function YD(n,e,t,r,i,o){var s=DY(n,e,t,r,i,o);return s.numValidOutputs.dispose(),{selectedIndices:s.selectedIndices,selectedScores:s.selectedScores}}function DY(n,e,t,r,i,o,s,a){a===void 0&&(a=!1);for(var u=Array.from(e).map(function(b,S){return{score:b,boxIndex:S,suppressBeginIndex:0}}).filter(function(b){return b.score>i}).sort(X6),l=o>0?-.5/o:0,c=[],h=[];c.length<t&&u.length>0;){var f=u.pop(),d=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(d<i)break;for(var g=!1,m=c.length-1;m>=v;--m){var x=bMe(n,p,c[m]);if(x>=r){g=!0;break}if(f.score=f.score*SMe(r,l,x),f.score<=i)break}f.suppressBeginIndex=c.length,g||(f.score===d?(c.push(p),h.push(f.score)):f.score>i&&wMe(u,f,X6))}var _=c.length;return a&&(c.fill(0,_),h.fill(0,_)),{selectedIndices:Tu(c,"int32"),selectedScores:Tu(h,"float32"),numValidOutputs:Dt(_,"int32")}}function bMe(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(a-o)*(u-s),p=(h-l)*(f-c);if(d<=0||p<=0)return 0;var v=Math.max(o,l),g=Math.max(s,c),m=Math.min(a,h),x=Math.min(u,f),_=Math.max(m-v,0)*Math.max(x-g,0);return _/(d+p-_)}function SMe(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function X6(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function NY(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var s=n.slice(r,i);return r[t]+=o,s})}function LY(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=nn(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),s=new Array(n.rank),a=0;a<s.length;a++)s[a]=o[a]%n.shape[a];var u=n.locToIndex(s);i.values[r]=n.values[u]}return i.toTensor()}function FY(n,e,t,r,i){for(var o=e[e.length-1],s=[n.length/o,o],a=s[0],u=s[1],l=Zv(t,a*r),c=Zv("int32",a*r),h=0;h<a;h++){for(var f=h*u,d=n.subarray(f,f+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort(function(b,S){return S.value-b.value});var g=h*r,m=l.subarray(g,g+r),x=c.subarray(g,g+r);for(v=0;v<r;v++)m[v]=p[v].value,x[v]=p[v].index}var _=e.slice();return _[_.length-1]=r,[Qi(l,_,t),Qi(c,_,"int32")]}function KD(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=nn(n,"int32"),o=nn([t.length,n.length],"int32");for(r=0;r<t.length;r++){var s=i.indexToLoc(t[r]),a=r*n.length;o.values.set(s,a)}return o.toTensor()}var EMe=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},CMe=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},MMe=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,s=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];var a=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+a+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function OY(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function ps(n,e){return e===1?[n]:OY(n,e)}function To(){var n,e,t,r,i,o,s,a,u,l;return je().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:u,defineRound:l}}function yd(n,e,t){t===void 0&&(t="index");var r=la(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function ZD(n){var e=la(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var BY=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function TMe(n,e,t,r){var i=[];n.forEach(function(d){var p=St(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?i.push("uniform float "+d.name+(p>1?"["+p+"]":"")+";"):(i.push("uniform sampler2D "+d.name+";"),i.push("uniform int offset"+d.name+";"))});var o,s,a=i.join(`
`),u=n.map(function(d){return function(p,v,g){g===void 0&&(g=!1);var m="";m+=g?UY(p):_m(p);var x=p.shapeInfo.logicalShape,_=v.logicalShape;return x.length<=_.length&&(m+=g?function(b,S){var E,C=b.name,R=C.charAt(0).toUpperCase()+C.slice(1),T="get"+R+"AtOutCoords",A=b.shapeInfo.logicalShape.length,P=S.logicalShape.length,k=wh(b.shapeInfo.logicalShape,S.logicalShape),W=pr(P),N=P-A,O=["x","y","z","w","u","v"];E=A===0?"":P<2&&k.length>=1?"coords = 0;":k.map(function(Q){return"coords."+O[Q+N]+" = 0;"}).join(`
`);var z="";z=P<2&&A>0?"coords":b.shapeInfo.logicalShape.map(function(Q,K){return"coords."+O[K+N]}).join(", ");var V="return outputValue;",F=St(b.shapeInfo.logicalShape)===1,U=St(S.logicalShape)===1;if(A!==1||F||U){if(F&&!U)V=P===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(k.length){var L=A-2,j=A-1;k.indexOf(L)>-1&&k.indexOf(j)>-1?V="return vec4(outputValue.x);":k.indexOf(L)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":k.indexOf(j)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+W+` coords = getOutputCoords();
      `+E+`
      vec4 outputValue = get`+R+"("+z+`);
      `+V+`
    }
  `}(p,v):function(b,S){var E=b.name,C=E.charAt(0).toUpperCase()+E.slice(1),R="get"+C+"AtOutCoords",T=S.texShape,A=b.shapeInfo.texShape,P=b.shapeInfo.logicalShape.length,k=S.logicalShape.length;if(!b.shapeInfo.isUniform&&P===k&&b.shapeInfo.flatOffset==null&&Wi(A,T))return`
      float `+R+`() {
        return sampleTexture(`+E+`, resultUV);
      }
    `;var W,N=pr(k),O=wh(b.shapeInfo.logicalShape,S.logicalShape),z=k-P,V=["x","y","z","w","u","v"];W=P===0?"":k<2&&O.length>=1?"coords = 0;":O.map(function(U){return"coords."+V[U+z]+" = 0;"}).join(`
`);var F="";return F=k<2&&P>0?"coords":b.shapeInfo.logicalShape.map(function(U,L){return"coords."+V[L+z]}).join(", "),`
    float `+R+`() {
      `+N+` coords = getOutputCoords();
      `+W+`
      return get`+C+"("+F+`);
    }
  `}(p,v)),m}(d,e,r)}).join(`
`),l=e.texShape,c=To(),h=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+RMe+`
    `+AMe+`
    `+IMe+`
  `}(c);return e.isPacked?(o=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(b,S){var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];return E[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+E[1]+`.0);
      }
    `:E[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+E[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      return 2 * (resTexRC.x * `+E[1]+` + resTexRC.y);
    }
  `}(0,p);case 2:return function(b,S){var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)];if(Wi(b,S))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+E[0]+", "+E[1]+`));
      }
    `;var C=Math.ceil(b[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));

      int index = resTexRC.x * `+E[1]+` + resTexRC.y;
      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=d,g=p,m=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],x=Math.ceil(v[2]/2),_=x*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;

      int b = index / `+_+`;
      index -= b * `+_+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(b,S){for(var E=[Math.ceil(S[0]/2),Math.ceil(S[1]/2)],C=Math.ceil(b[b.length-1]/2),R=C*Math.ceil(b[b.length-2]/2),T=R,A="",P="b, r, c",k=2;k<b.length-1;k++)T*=b[b.length-k-1],A=`
      int b`+k+" = index / "+T+`;
      index -= b`+k+" * "+T+`;
    `+A,P="b"+k+", "+P;return`
    ivec`+b.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+E[0]+", "+E[1]+`));
      int index = resTexRC.x * `+E[1]+` + resTexRC.y;

      `+A+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+C+`);
      int c = imod(index, `+C+`) * 2;

      return ivec`+b.length+"("+P+`);
    }
  `}(d,p)}var v,g,m,x,_}(e.logicalShape,l),s=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(c)):(o=function(d,p){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(m,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,p);case 2:return function(m,x){return Wi(m,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:m[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:m[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+m[1]+`;
      int c = index - r * `+m[1]+`;
      return ivec2(r, c);
    }
  `}(d,p);case 3:return v=p,g=yd(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(m,x){var _=yd(["r","c","d","d2"],m);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+_+`
      return ivec4(r, c, d, d2);
    }
  `}(d,p);case 5:return function(m,x){var _=yd(["r","c","d","d2","d3"],m);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,p);case 6:return function(m,x){var _=yd(["r","c","d","d2","d3","d4"],m);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+_+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,p);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,g}(e.logicalShape,l),s=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=PMe),[f,h,s,a,o,u,t].join(`
`)}function _m(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(s===1&&a===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=Vf(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+am(t)+`
      }
    `;var o=t.shapeInfo.texShape,s=o[0],a=o[1];if(a===1&&s===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Vf(r);return a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+s+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+a+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+s+", "+a+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=t.shapeInfo.texShape;if(s!=null&&Wi(r,s)){var a=s[0],u=s[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+a+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=rd(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var d=bm(t,f);return`
      `+_m(d)+`
      float `+o+`(int row, int col) {
        return `+o+"("+Sm(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+am(t)+`
      }
    `;var p=s[0],v=s[1],g=Vf(i);return v===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:p===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+i+`, uv);
  }
`}(n);case 3:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[1]*r[2],a=r[2],u=rd(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=bm(t,h);return`
        `+_m(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+Sm(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+s+", "+a+`, 1)));
        `+am(t)+`
      }
    `;var d=t.shapeInfo.texShape,p=d[0],v=d[1],g=t.shapeInfo.flatOffset;if(v===s&&g==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+a+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(v===a&&g==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var m=Vf(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+s+" + col * "+a+" + depth + "+m+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `}(n);case 4:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[3],a=r[2]*s,u=r[1]*a,l=rd(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=bm(t,c);return`
      `+_m(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+Sm(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+a+", "+s+`, 1)));
        `+am(t)+`
      }
    `;var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],g=p[1];if(g===u&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(g===s&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var m=Vf(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+a+` +
          depth * `+s+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+g+", index + "+m+`);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 5:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=r[4],a=r[3]*s,u=r[2]*a,l=r[1]*u,c=rd(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var d=bm(t,h);return`
      `+_m(d)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+Sm(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+a+", "+s+`)) +
          depth3;
        `+am(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,g=v[0],m=v[1];if(m===l&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+a+", "+s+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(m===s&&p==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=Vf(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+a+` +
          depth2 * `+s+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+m+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);case 6:return function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),s=rd(r),a=s.newShape,u=s.keptDims;if(a.length<r.length){var l=bm(t,a);return`
      `+_m(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+Sm(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,d=r[2]*f,p=r[1]*d;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+d+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+am(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,m=g[0],x=g[1];if(x===p&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var _=Vf(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+d+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+_+`;
      vec2 uv = uvFromFlat(`+m+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `}(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function UY(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=To(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return function(i){var o=i.name,s="get"+o.charAt(0).toUpperCase()+o.slice(1),a=i.shapeInfo.texShape,u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],l=To();return`
    vec4 `+s+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(n);case 2:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=To();if(u!=null&&Wi(o,u))return`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+s+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(o[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+s+`, uv);
    }
  `}(n);case 3:return function(i){var o=i.shapeInfo.logicalShape,s=i.name,a="get"+s.charAt(0).toUpperCase()+s.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=bm(i,c);return`
        `+UY(h)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Sm(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],p=Math.ceil(o[2]/2),v=p*Math.ceil(o[1]/2),g=To();return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+v+", "+p+`, b, row, col);
      return `+g.texture2D+"("+s+`, uv);
    }
  `}(n);default:return function(i){for(var o=i.shapeInfo.logicalShape,s=o.length,a=i.name,u="get"+a.charAt(0).toUpperCase()+a.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],d=Math.ceil(o[s-1]/2),p=d*Math.ceil(o[s-2]/2),v="int b, int row, int col",g="b * "+p+" + (row / 2) * "+d+" + (col / 2)",m=2;m<s-1;m++)v="int b"+m+", "+v,p*=o[s-m-1],g="b"+m+" * "+p+" + "+g;var x=To();return`
    vec4 `+u+"("+v+`) {
      int index = `+g+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+a+`, uv);
    }
  `}(n)}}var RMe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,AMe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IMe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,PMe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Vf(n){return"offset"+n}function am(n){var e=n.name,t=St(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function pr(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function bm(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Sm(n,e){return e.map(function(t){return n[t]}).join(", ")}var kMe=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,ee(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var s,a,u=this.outputShape,l=u.length,c=pr(l),h=ps("coords",l);if(o===1){var f=pr(a=l+1);s=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else a=l,s=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,a),p="."+d[a-1],v=d.map(function(R){return"int "+R}),g=ps("sourceLocR",a-1).concat("inIdx.r"),m=ps("sourceLocG",a-1).concat("inIdx.g"),x=ps("sourceLocB",a-1).concat("inIdx.b"),_=ps("sourceLocA",a-1).concat("inIdx.a"),b=t==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+_.join()+")));",E=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+m.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+_.join()+") : 0.)",C=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+C+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+s+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+E+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+S+`
          vec4 candidate = `+E+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+b+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},DMe=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,s=n.dilationWidth,a=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=a-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},NMe=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=c-1-n.padInfo.front,p=h-1-n.padInfo.top,v=f-1-n.padInfo.left,g=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+p+", "+v+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},LMe=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],En(n,e),En(n,t);var s="0.0";r!=null&&(En(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="1.0";i!=null&&(En(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+a+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},FMe=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],En(n,e),En(n,t);var s="vec4(0.0)";r!=null&&(En(n,r),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var a="vec4(1.0)";i!=null&&(En(n,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+a+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},OMe="return areal * breal - aimag * bimag;",BMe="return areal * bimag + aimag * breal;",q6=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=En(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},HT="return a + b;",GT="return a - b;",Y6="return a * b;",UMe=`
if (a == b) {
  return 1.0;
};
return a / b;`,zY="return (a < 0.) ? b * a : a;",Wr=function(n,e,t){this.variableNames=["A","B"],this.outputShape=En(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},zMe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,VY=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Xu=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=En(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||St(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+pr(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var s=ps("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+s[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+s[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},VMe=function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),WMe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n}(),HMe=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},GMe=function(n){this.outputShape=[],this.outputShape=Jv(n,1),this.variableNames=n.map(function(a,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,s=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},$Me=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Jv(n,e);var t=this.outputShape,r=t.length,i=pr(r),o=ps("coords",r),s=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,m){return"T"+m});var a=new Array(n.length-1);a[0]=n[0][e];for(var u=1;u<a.length;u++)a[u]=a[u-1]+n[u][e];var l=s[e],c=s.slice(-2),h=s.join(),f="if ("+l+" < "+a[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<a.length;u++){var d=a[u-1];f+=`
        if (`+l+" < "+a[u]+"  && "+l+" >= "+a[u-1]+`) {
          return getChannel(
            getT`+u+"("+t_(s,l,d)+`),
            vec2(`+t_(c,l,d)+`));
        }`}var p=a.length,v=a[a.length-1];f+=`
        return getChannel(
          getT`+p+"("+t_(s,l,v)+`),
          vec2(`+t_(c,l,v)+"));",this.userCode=`
      float getValue(`+s.map(function(g){return"int "+g})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function t_(n,e,t){var r=n.indexOf(e);return n.map(function(i,o){return o===r?i+" - "+t:i}).join()}var jMe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},XMe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dataFormat==="channelsLast",s=e-1-n.padInfo.top,a=t-1-n.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},qMe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,s=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+s+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},YMe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+a+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},KMe=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},ZMe=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,s=t-1-n.padInfo.left,a=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+a+`; dm++) {
              int d2 = d1 * `+a+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},K6=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,s=n.strideHeight,a=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,f=4*Math.floor(n.inChannels/4),d=n.inChannels%4,p=n.dataFormat==="channelsLast",v=p?1:2,g=p?2:3,m=p?3:1,x="",_="";t&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,_="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+m+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+b+`
        `+_+`
        setOutput(result);
      }
    `},QMe=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,s=n.strideWidth,a=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,f=n.filterWidth,d=4*Math.floor(n.inChannels/4),p=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+a+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Z6=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,f=n.filterHeight,d=n.filterWidth,p=n.outChannels/n.inChannels,v="",g="";t&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,g="result = activation(result);");var m=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+m+`
        `+g+`
        setOutput(result);
      }
    `},Q6=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,s=n.padInfo.top,a=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,f=n.filterHeight,d=n.filterWidth,p=d,v="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var m=0;m<d;m++)v+=`
          vec4 xTexelR`+g+"C"+2*m+` = vec4(0.);
          vec4 wR`+g+"C"+m+` = vec4(0.);
          vec4 xR`+g+"C"+m+" = vec4(0.);";for(g=0;g<f;g++)for(var x=0;x<p;x++){if(v+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(m=2*x)*h+`;
        `,l===1){if(m<d&&(v+=a%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+g+"C"+m+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+m+" = vec4(previous.zw, xTexelR"+g+"C"+m+`.xy);
                } else {
                  xR`+g+"C"+m+" = vec4(0, 0, xTexelR"+g+"C"+m+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xR`+g+"C"+m+" = xTexelR"+g+"C"+m+`;
              `,m+1<d)){var _=a%2==0?Kq(h):h;h%2==0&&a%2==1||h%2!=0&&a%2!=1?(v+=`
                  xCOffset = xC + `+a%2+" + "+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+m+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+_+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(m+1)+" = xTexelR"+g+"C"+(m+2)+`;
                `}}else m<d&&(v+=`
              if(xR >= 0 && xR < `+i+`) {
            `,a%2==1?(v+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
              `,m+1<d&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(m+1)+" = vec4(xTexelR"+g+"C"+(m+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".xy, xTexelR"+g+"C"+(m+2)+`.xy);
              `,m+1<d&&(v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
                `)),v+="}");m<d&&(v+=`
            vec4 wTexelR`+g+"C"+m+" = getW("+g+", "+m+`, d1, q);
            wR`+g+"C"+m+" = vec4(wTexelR"+g+"C"+m+".xz, wTexelR"+g+"C"+m+`.xz);
          `,m+1<d&&(v+=`
              vec4 wTexelR`+g+"C"+(m+1)+" = getW("+g+", "+(m+1)+`, d1, q);
              wR`+g+"C"+(m+1)+` =
                vec4(wTexelR`+g+"C"+(m+1)+".xz, wTexelR"+g+"C"+(m+1)+".xz);"))}for(g=0;g<f;g++)for(m=0;m<d;m++)v+="dotProd += xR"+g+"C"+m+" * wR"+g+"C"+m+";";var b="",S="";t&&(b=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,S="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+E+`
        `+S+`
        setOutput(result);
      }
    `},JMe=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],s=n[1],a=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,d=[s-1+".0",a-1+".0"],p=d[0],v=d[1],g=c>1?[""+(s-1)/(c-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],m=g[0],x=g[1],_=g[2],b=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],S=b[0],E=b[1],C=b[2];this.userCode=`
      const float height_ratio = float(`+m+`);
      const float width_ratio = float(`+S+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+E+`;

        float in_y = `+_+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+C+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},eTe=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+pr(r)+` coords = getOutputCoords();
        int end = `+J6(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+J6(r,"coords")+` = idx;
          val += getX(`+function(s,a){if(s===1)return""+a;if(s===2)return a+".x, "+a+".y";if(s===3)return a+".x, "+a+".y, "+a+".z";if(s===4)return a+".x, "+a+".y, "+a+".z, "+a+".w";throw Error("Cumulative sum for rank "+s+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function J6(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var tTe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=C1.DENSE;var e=vy(n),t=To();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+yd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},nTe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=C1.DENSE;var e=vy(n),t=To();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+yd(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},rTe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),iTe=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},oTe=function(n){this.variableNames=["A"],this.outTexUsage=ra.DOWNLOAD;var e=To();this.outputShape=n,this.userCode=`
      `+BY+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},sTe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ra.DOWNLOAD;var e=To();this.outputShape=n,this.userCode=`
      `+BY+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},aTe=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=To(),i=e[0],o=e[1];this.outputShape=n;var s="result";t&&(s="floor(result * 255. + 0.5)"),this.userCode=`
      `+ZD(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+s+`, 0., 0., 0.);
      }
    `},uTe=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=To(),i=e[0],o=e[1];this.outputShape=n;var s="",a="result";t&&(a="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;s+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+ZD(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+s+`

        `+r.output+" = "+a+`;
      }
    `},lTe="return real * expR - imag * expI;",cTe="return real * expI + imag * expR;",e8=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},hTe=function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n}(),fTe=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=pr(this.rank),o=function(s,a){var u=s.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<s.length;h++)h===a?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()}(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},dTe=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=pr(e.length),i=pr(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function pTe(n,e){var t=To();return OCe(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function mTe(n,e){return WCe(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function vTe(n,e){return HCe(n,e,new Uint16Array([0,1,2,2,1,3]))}function vx(n,e,t,r,i,o,s){$Ce(t,r);var a=GCe(n,e),u=n.TEXTURE_2D;return kt(n,e,function(){return n.bindTexture(u,a)}),kt(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),kt(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),kt(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),kt(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),kt(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,s,null)}),kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),a}function gTe(n,e,t,r,i){var o=UE(t,r);return vx(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function yTe(n,e,t,r,i){var o=UE(t,r);return vx(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function xTe(n,e,t,r,i){var o=UE(t,r);return vx(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function wTe(n,e,t,r,i){var o=mx(t,r);return vx(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function _Te(n,e,t,r,i){var o=mx(t,r);return vx(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function bTe(n,e,t,r){return kt(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),V6(n,e,t,"clipSpacePos",r,3,20,0)&&V6(n,e,t,"uv",r,2,20,12)}function STe(n,e,t,r,i,o,s){var a,u,l;kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(a=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(a=new Float32Array(r*i*4),u=n.FLOAT,l=s.internalFormatPackedFloat),a.set(o),kt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,a)}),kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function ETe(n,e,t,r){kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?kt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):kt(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),kt(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function CTe(n,e,t,r,i){var o=n.createBuffer();kt(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var s=16*t*r;return kt(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),kt(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),kt(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function MTe(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function TTe(n,e,t,r,i){var o=UE(t,r),s=o[0],a=o[1],u=new Uint8Array(t*r*4);return kt(n,e,function(){return n.readPixels(0,0,s,a,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function RTe(n,e,t,r,i,o,s,a){var u=n,l=new Float32Array(function(c,h){var f=mx(c,h);return f[0]*f[1]*4}(o,s));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function ATe(n,e,t,r){var i=new Float32Array(t*r*4);return kt(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}var ITe=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=je().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,kCe(t,e)):this.gl=Ml(t);var r="WEBGL_color_buffer_float";if(je().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Zw(this.gl,this.debug,"OES_texture_float"),Ua(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Zw(this.gl,this.debug,"OES_texture_half_float");else if(je().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Ua(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Zw(this.gl,this.debug,"EXT_color_buffer_half_float");else if(je().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Ua(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!Ua(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=mTe(this.gl,this.debug),this.indexBuffer=vTe(this.gl,this.debug),this.framebuffer=jCe(this.gl,this.debug),this.textureConfig=VD(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return je().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;kt(t,this.debug,function(){return t.finish()}),kt(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),kt(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),kt(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),kt(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),kt(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),gTe(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),yTe(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),xTe(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),ETe(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),STe(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),_Te(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),wTe(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(W6(this.gl,this.debug,this.framebuffer),this.outputTexture=null),kt(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return TTe(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,s){return RTe(this.gl,e,0,0,0,o,s,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return MTe(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=CTe(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(je().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var a=o.clientWaitSync(s,0,0);return a===o.ALREADY_SIGNALED||a===o.CONDITION_SATISFIED},t=s}else je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return ATe(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=BCe(t,this.debug,e),i=pTe(t,this.debug),o=zCe(t,this.debug);return kt(t,this.debug,function(){return t.attachShader(o,i)}),kt(t,this.debug,function(){return t.attachShader(o,r)}),VCe(t,this.debug,o),this.debug&&UT(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=bTe(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&kt(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&UT(this.gl,this.debug,this.program),kt(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?qCe(this.gl,this.debug,e,t):YCe(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),kt(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),KCe(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=mx(t,r),o=i[0],s=i[1];this.setOutputMatrixTextureDriver(e,o,s)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&UT(this.gl,this.debug,this.program),Qw(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),kt(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),kt(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Zw(this.gl,this.debug,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Et(this,void 0,void 0,function(){var t=this;return Ct(this,function(r){switch(r.label){case 0:return[4,F6(function(){return t.disposed||t.isQueryAvailable(e,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||F6(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),zT(this.gl,this.debug,e,this.framebuffer),this.debug&&Qw(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(zT(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Qw(this.gl)):W6(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;zT(i,this.debug,e,this.framebuffer),this.debug&&Qw(i),this.outputTexture=e,kt(i,this.debug,function(){return i.viewport(0,0,t,r)}),kt(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),kt(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function t8(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],s=o.shape;if(!Wi(i,s))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+s+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!Wi(a,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+u+" must match")}})}var PTe=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,s=t.strideHeight,a=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,f=a.left,d=a.top,p=i*r,v=To(),g=h==="channelsLast",m=g?0:1,x=g?1:2,_="",b=0;b<=1;b++)for(var S=0;S<=1;S++)_+=`
          blockIndex = rc.y + `+S+`;
          pos = rc.x + `+b+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+s+" - "+d+`;
            d0 = offsetY + `+c+" * (pos / "+p+`);

            if(d0 < `+e[m]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+p+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*b+S)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*b+S)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+_+`

        `+v.output+` = result;
      }
    `},kTe=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+s+"; j <= "+s+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+a+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},DTe=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},NTe=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=e,a=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+s+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+s+"; j <= "+s+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+a+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},LTe=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,s=i-1-n.padInfo.top,a=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},FTe=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,o=n.dilationHeight,s=n.dilationWidth,a=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=a-1-n.padInfo.front,h=u-1-n.padInfo.top,f=l-1-n.padInfo.left,d=a*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+a+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},$T=function(n,e,t,r,i,o,s){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),s===void 0&&(s=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var a=t?n[1]:n[2],u=Math.ceil(a/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",p="";o&&(d=s?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,p="result = activation(result);");var v=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},OTe=function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n}(),BTe=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},UTe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=ps("rc",e),r=pr(e),i=function(a,u,l){if(a===1)return"rc > "+u[0];for(var c="",h=a-2;h<a;h++)c+=l[h]+" >= "+u[h],h<a-1&&(c+="||");return c}(e,n,t),o=function(a,u,l,c){if(a===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(e,n[n.length-1],n[n.length-2],t),s=function(a,u){var l=a.length,c=function(h,f){for(var d=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var g=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),m=2;m<h;m++)g=f[f.length-1-m]+","+g;d.push(g)}return d}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+a[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+s+`));
          }
        }
      `}},zTe=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=pr(r),o=e.map(function(u){return u[0]}).join(","),s=e.map(function(u,l){return u[0]+n[l]}).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+a+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},VTe=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(g,m){return g[0]+n[m]+g[1]});for(var r=n.length,i=pr(r),o=e.map(function(g){return g[0]}).join(","),s=e.map(function(g,m){return g[0]+n[m]}).join(","),a=ps("rc",r),u=ps("source",r),l=a[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",a[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+a[r-2]+` += 1;
       if(`+a[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+a[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=r===1?2:4;p<v;p++)d+=`
        `+h[p]+`
        if (`+f+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},yy=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,s=n.strideHeight,a=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=n.padInfo.top,d=n.padInfo.left;this.outputShape=n.outShape;var p=e==="avg",v="((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d",g="(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d",m="0.0";if(p||(m="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+a+`);
        const ivec2 pads = ivec2(`+f+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(r?i?v:g:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var _=4*Math.floor(o/4),b=o%4,S=`
      if (`+p+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+a+`);
      const ivec2 pads = ivec2(`+f+", "+d+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+u+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+_+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+S+`
          }

          int xC = xCCorner + `+_+`;
          if (`+(b===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+S+`
          } else if (`+(b===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+S+`
          } else if (`+(b===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+S+`
          }
        }
        setOutput(`+x+`);
      }
    `}},jT=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,s=n.strideDepth,a=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=n.padInfo.front,g=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var x=e==="avg",_="0.0";if(x||(_="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+a+", "+u+`);
        const ivec3 pads = ivec3(`+v+", "+g+", "+m+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+f+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+p+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(r?i?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+d+" * "+p+` +
                      wR * `+p+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(b="avgValue / count");var S=4*Math.floor(o/4),E=o%4,C=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+a+", "+u+`);
      const ivec3 pads = ivec3(`+v+", "+g+", "+m+`);
      const float initializationValue = `+_+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+_+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+S+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+C+`
            }

            int xC = xCCorner + `+S+`;
            if (`+(E===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(E===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+C+`
            } else if (`+(E===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+C+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},WTe=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var s="0.0",a="";e==="prod"?s="1.0":e==="min"?(s="1.0 / 1e-20",a="min"):e==="max"&&(s="-1.0 / 1e-20",a="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+a+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";i%t>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},HTe=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+yd(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+ZD(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},GTe=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[t&&a>1?i-1:i,t&&u>1?o-1:o],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},$Te=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},jTe=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+s+`.0,
                                     `+s+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(a-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},XTe=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],s=n.shape,a=s[1],u=s[2],l=[t&&a>1?i-1:i,t&&u>1?o-1:o],c=[t&&a>1?a-1:a,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+a+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},qTe=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],s=n[2],a=n[3];this.outputShape=[i,e,t,a];var u=[r&&e>1?o-1:o,r&&t>1?s-1:s],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+s+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},YTe=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,s){return function(a){return e.indexOf(a)!==-1&&n[a]!==1?n[a]+" - coords["+a+"] - 1":"coords["+a+"]"}(s)}).join(","),i=pr(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},KTe=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=ps("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],s=pr(t);function a(u){var l=n.map(function(c,h){return function(f,d){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+d[f]+" - 1":""+d[f]}(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return a(u)}(r.slice())+`;
          if(`+i+`){
            result.g = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",a(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            if(`+i+`) {
              result.a = `+function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",a(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},n8=function(n,e,t,r,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var a=pr(i.length),u=pr(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",d=e>1?"strides[j]":"strides";this.userCode=`
        `+a+" strides = "+a+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},ZTe=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,s=o*Math.ceil(i/t);this.outputShape=[r,s];var a=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+a+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+a+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},QTe=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],a=[],u=0;u<e.length;u++)a.push(""+o[u]),u<n&&s.push(""+o[u]);r=s.join(),i=a.join()}var l=pr(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},JTe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=pr(this.rank),i="uniform int start["+this.rank+"];",o=function(s){if(s===1)return"sourceLoc";if(s<=6)return XT.slice(0,s).map(function(a){return"sourceLoc."+a}).join(",");throw Error("Slicing for rank "+s+" is not yet supported")}(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(s,a){return"sourceLoc."+XT[a]+" = start["+a+"] + coords."+XT[a]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),XT=["x","y","z","w","u","v"],eRe=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=pr(this.rank),r=ps("coords",this.rank),i=ps("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",s="getChannel(getSource("+i.join()+"), "+o+")",a=`
      result.x = `+s+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+s+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+s+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+s+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+a+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n}(),tRe=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=pr(t.length),o=pr(t.length),s="";if(r===1)s="coords * strides + begin";else{var a=0;s=t.map(function(u,l){return a++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(a-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `},nRe=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=r8(t,r),s=i8(e,o,r);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[s].shift();return this.usedTextures[s].push(a),a}return this.numUsedTextures++,this.log(),o===Zs.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Zs.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Zs.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Zs.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Zs.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=i8(t,r8(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var s=this.usedTextures[o],a=s.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");s.splice(a,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function r8(n,e){if(n===ra.UPLOAD)return Zs.PACKED_2X2_FLOAT32;if(n===ra.RENDER||n==null)return function(t){return je().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Zs.PACKED_2X2_FLOAT32:Zs.UNPACKED_FLOAT32:t?Zs.PACKED_2X2_FLOAT16:Zs.UNPACKED_FLOAT16}(e);if(n===ra.DOWNLOAD||n===ra.PIXELS)return Zs.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function i8(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var rRe=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=pr(this.rank),o=function(s){var a=s.length;if(a>5)throw Error("Tile for rank "+a+" is not yet supported");if(a===1)return"imod(resRC, "+s[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<s.length;c++)l.push("imod("+u[c]+", "+s[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},QD=1.7580993408473768,JD=1.0507009873554805,un=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Nu="if (isnan(x)) return x;",iRe="return x;",o8="return abs(x);",WY=Nu+`
  return (x < 0.0) ? 0.0 : x;
`,HY=Nu+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,GY="return (x >= 0.0) ? x : (exp(x) - 1.0);",oRe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+QD+`;
  float scale = `+JD+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,s8="return -x;",a8="return ceil(x);",u8="return floor(x);",l8="return exp(x);",c8="return exp(x) - 1.0;",sRe=Nu+`
  return sin(x);
`,aRe=Nu+`
  return cos(x);
`,uRe=Nu+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,lRe=Nu+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,cRe=Nu+`
  return atan(x);
`,hRe=Nu+"return log(x + sqrt(x * x + 1.0));",fRe=Nu+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,dRe=Nu+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,n_="return x;",pRe="return x;",$Y=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jY=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,XY=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_0=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},mRe=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=ps("rc",e),r=pr(e),i=function(a,u){if(a===1)return"rc";for(var l="",c=0;c<a;c++)l+=u[c],c<a-1&&(l+=",");return l}(e,t),o=t.slice(-2),s=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `},r_={};function i_(n,e){if(e===void 0&&(e=!1),n==="linear")return e?pRe:iRe;if(n==="relu")return e?$Y:WY;if(n==="elu")return e?XY:GY;if(n==="relu6")return e?jY:HY;if(n==="prelu")return e?VY:zY;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var vRe=600,gRe=function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!je().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=Ml(je().getNumber("WEBGL_VERSION"));i.binaryCache=((r=je().getNumber("WEBGL_VERSION"))in r_||(r_[r]={}),r_[r]),i.gpgpu=new ITe(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new nRe(i.gpgpu),i.numMBBeforeWarning=je().global.screen==null?1024:je().global.screen.height*je().global.screen.width*window.devicePixelRatio*vRe/1024/1024,i.texData=new RY(i,fe),i}return Du(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(je().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:ra.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(je().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:ra.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,s=r.complexTensors,a=r.slice,u=r.shape,l=r.isPacked;if(a!=null){var c=void 0;c=l?new _0(u,n_):new un(u,n_);var h=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:o}],o),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var d,p,v=this.activeTimers!=null;return v&&(d=Qu()),o==="complex64"?p=_4(s.real.dataSync(),s.imag.dataSync()):p=this.getValuesFromTexture(t),v&&(this.downloadWaitMs+=Qu()-d),this.convertAndCacheOnCPU(t,p)},e.prototype.read=function(t){return Et(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R;return Ct(this,function(T){switch(T.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(A){return r.push(A)})];if(i=this.texData.get(t),o=i.values,s=i.shape,a=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,a!=null)return h=void 0,h=c?new _0(s,n_):new un(s,n_),f=this.runWebGLProgram(h,[{dataId:t,shape:s,dtype:u}],u),d=this.read(f.dataId),this.disposeData(f.dataId),[2,d];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!je().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&je().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&je().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),g=this.texData.get(v.dataId),p=(R=this.gpgpu).createBufferFromTexture.apply(R,[g.texture].concat(vy(s)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:T.sent(),T.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=T.sent(),_=x[0],b=x[1],m=_4(_,b),[3,5];case 4:p==null?m=this.getValuesFromTexture(t):(S=St(s),m=this.gpgpu.downloadFloat32MatrixFromBuffer(p,S)),T.label=5;case 5:return v!=null&&this.disposeData(v.dataId),E=this.convertAndCacheOnCPU(t,m),C=this.pendingRead.get(t),this.pendingRead.delete(t),C.forEach(function(A){return A(E)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,E]}})})},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!LCe(i))throw je().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.isPacked,u=St(o);if(je().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(vy(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=je().getBool("WEBGL_PACK")&&a===!0,d=f?VT(o):o,p=f?new sTe(d):new oTe(d),v=this.runWebGLProgram(p,[{shape:d,dtype:s,dataId:t}],"float32"),g=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),m},e.prototype.time=function(t){return Et(this,void 0,void 0,function(){var r,i,o,s,a,u,l;return Ct(this,function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),s=Kv(this.activeTimers.map(function(h){return h.query})).filter(function(h){return h!=null}),a=Kv(this.activeTimers.map(function(h){return h.name})).filter(function(h){return h!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=c.sent(),u.kernelMs=vCe(l),u.getExtraProfileInfo=function(){return l.map(function(h,f){return{name:a[f],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Qu(),endMs:null}},e.prototype.endTimer=function(t){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Qu(),t)},e.prototype.getQueryTime=function(t){return Et(this,void 0,void 0,function(){var r;return Ct(this,function(i){return je().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,s=r.texShape,a=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(s,o),this.textureManager.releaseTexture(i,s,a,u)));var f=this.texData.get(t);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return je().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=fe.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every(function(o){return i.texData.get(o.dataId).texture==null&&St(o.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:fe.keep(t.clone()),imag:fe.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(St(i)===0)return Qi([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,s=MY(t.shape,r,i);if(o||!s){var a=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eRe(i):new JTe(i),u=a.getCustomSetupFunc(r);return this.compileAndRun(a,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),s=this.makeOutput(i,t.dtype),a=this.texData.get(s.dataId);Object.assign(a,o),a.shape=i,a.dtype=t.dtype;var u=TY(r,t.strides);o.slice&&(u+=o.slice.flatOffset),a.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var l=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,l+1),s},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var s=jD(r,i,o);if(s.some(function(u){return u===0}))return Qi([],s);var a=new tRe(r,o,s);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,r){var i=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new KTe(t.shape,r):new YTe(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map(function(d){return Na(d)}),o=t.map(function(d){return rl(d)});return Ki(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>je().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var s=Math.floor(t.length/2),a=this.concat(t.slice(0,s),r),u=this.concat(t.slice(s),r);return this.concat([a,u],r)}if(je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new $Me(t.map(function(d){return d.shape}),r);return this.compileAndRun(l,t)}var c=Jv(t.map(function(d){return d.shape}),r),h=t.map(function(d){return d.as2D(-1,St(d.shape.slice(r)))}),f=new GMe(h.map(function(d){return d.shape}));return this.compileAndRun(f,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,s8,t.dtype);var r=new un(t.shape,s8);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var s=i?t.shape[2]:t.shape[1],a=o?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((s===1||a===1)&&u>1e3){i&&(t=du(t,[0,2,1])),o&&(r=du(r,[0,2,1]));var c=a===1?t:t.as3D(l,u,1),h=a===1?2:1,f=a===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(h,!0)}var d=Zi(t.dtype,r.dtype),p=new $T(t.shape,[l,s,a],i,o);return this.compileAndRun(p,[t,r],d)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=o?r.shape[2]:r.shape[1],h=s?i.shape[1]:i.shape[2],f=r.shape[0],d=Zi(r.dtype,i.dtype),p=a!=null,v=l!=null,g=u?i_(u,!0):null,m=new $T(r.shape,[f,c,h],o,s,p,g,v),x=[r,i];return a&&x.push(a),l&&x.push(l),this.compileAndRun(m,x,d)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),s=new q6(OMe,t.shape,r.shape),a=new q6(BMe,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(s,u),c=this.compileAndRun(a,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Y6,t.dtype);var f=new Wr(Y6,t.shape,r.shape);return this.compileAndRun(f,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){var u=[t,r,i],l=null;a!=null&&(l=a.shape,u.push(a));var c=null;if(s!=null&&(c=s.shape,u.push(s)),je().getBool("WEBGL_PACK_NORMALIZATION")){var h=new FMe(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var f=new LMe(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){var a=je().getBool("WEBGL_PACK_NORMALIZATION")?new NTe(t.shape,r,i,o,s):new kTe(t.shape,r,i,o,s);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,r,i,o,s,a,u){var l=new DTe(r.shape,o,s,a,u);return this.compileAndRun(l,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map(function(s){return cS(s)});return LY(nn(t.shape,t.dtype,i),r)}var o=new rRe(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new VTe(t.shape,r,i):new zTe(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new fTe(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){ee(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(h,f){return h*f}),s=vS(t.shape,r,o),a=gS(s.length,r.length),u=yS(t.shape,r,o),l=dY(i,r.length),c=pY(u,i,r.length);return du(t.reshape(s),a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){ee(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(f,d){return f*d}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var u=t.pad(s),l=vS(u.shape,r,o,!1),c=gS(l.length,r.length,!1),h=yS(u.shape,r,o,!1);return du(u.reshape(l),c).reshape(h)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],s=t.shape[1],a=WT(s),u=new WTe({windowSize:a,inSize:s,batchSize:o},r),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],s=t.shape[1];i!=null&&(o=i.shape[0],s=i.shape[1]);var a=WT(s),u=new MMe({windowSize:a,inSize:s,batchSize:o},r,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,s=WT(o[o.length-1]),a=new kMe(o,s,r,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(a,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){Xs("sum",r,t.rank);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s),u=NT(t.dtype);return this.reduce(a,"sum",u).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s),u=NT(t.dtype);return this.reduce(a,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,s=Tl([o],t.rank),a=t;s!=null&&(a=du(t,s),o=Rl(1,t.rank)[0]);var u=function(d,p,v){for(var g=[],m=d.length,x=0;x<m;x++)x!==p?g.push(d[x]):g.push(v);return g}(a.shape,o,i),l=St([a.shape[o]]),c=a.as2D(-1,l),h=NT(t.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,h,i).reshape(u);return s!=null&&(f=du(f,WD(s))),f},e.prototype.segOpCompute=function(t,r,i,o,s){var a=t.shape[0],u=t.shape[1],l=function(f,d){var p,v=!1;for(f<=CY?(p=f,v=!0):p=f4(f,Math.floor(Math.sqrt(f)));!v;)p>d||p===f?v=!0:p=f4(f,p+1);return p}(u,s),c=new ZTe({windowSize:l,inSize:u,batchSize:a,numSegments:s}),h=this.compileAndRun(c,[t,i],o);return h.shape[1]===s?h:(i=mS(0,s).tile([u/l]),this.segOpCompute(h,r,i,o,s))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(Xs("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!je().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var s=_o(t.shape,o),a=s[0],u=St(s[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(a)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var s=new eTe(t.shape,i,o);return this.compileAndRun(s,[t])},e.prototype.equal=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new Wr("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new Wr("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new Wr("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new Wr("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new Wr("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new Wr("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new un(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new Wr("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new Wr("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new QTe(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],Zi(r.dtype,i.dtype))},e.prototype.where=function(t){dS("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return KD(t.shape,r)},e.prototype.topk=function(t,r,i){return FY(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Xs("min",r,t.rank);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s);return this.reduce(a,"min",a.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Wr(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Xs("max",r,t.rank);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s);return this.reduce(a,"max",a.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){Xs("all",r,t.rank);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s);return this.reduce(a,"all",a.dtype).reshape(o)},e.prototype.any=function(t,r){Xs("any",r,t.rank);var i=_o(t.shape,r),o=i[0],s=St(i[1]),a=t.as2D(-1,s);return this.reduce(a,"any",a.dtype).reshape(o)},e.prototype.floorDiv=function(t,r){if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new Wr(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,HT);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=Zi(t.dtype,r.dtype);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,HT,i);var o=new Wr(HT,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new _0(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,s){s===void 0&&(s=!1);var a=new Xu(i,t.shape,r.shape,s);return this.compileAndRun(a,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,s=this.texData.get(t.dataId),a=this.texData.get(r.dataId),u=[[s.complexTensors.real,a.complexTensors.real],[s.complexTensors.imag,a.complexTensors.imag]].map(function(f){var d=f[0],p=f[1],v=o.makeComplexComponentTensorInfo(t,d),g=o.makeComplexComponentTensorInfo(r,p),m=new Wr(i,t.shape,r.shape);return o.compileAndRun(m,[v,g],Zi(d.dtype,p.dtype))}),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>je().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var s=t.map(function(l){return l.dtype}).reduce(function(l,c){return Zi(l,c)}),a=t.map(function(l){return l.shape}),u=je().getBool("WEBGL_PACK")?new CMe(t[0].shape,a):new EMe(t[0].shape,a);return this.compileAndRun(u,t,s)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,GT);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=Zi(t.dtype,r.dtype);if(je().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,GT,t.dtype);var o=new Wr(GT,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Wr(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=Zi(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,a8,t.dtype);var r=new un(t.shape,a8);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,u8,t.dtype);var r=new un(t.shape,u8);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new un(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new un(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new un(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new un(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new un(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,l8,t.dtype);var r=new un(t.shape,l8);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,c8,t.dtype);var r=new un(t.shape,c8);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=Pi([r],t.shape),o=this.max(t,i),s=Ps(o.shape,i),a=this.subtract(t,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return Jh(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new un(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new un(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new un(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new un(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new un(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=je().getBool("WEBGL_PACK")?new _0(t.shape,$Y):new un(t.shape,WY),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=je().getBool("WEBGL_PACK")?new _0(t.shape,jY):new un(t.shape,HY),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(VY,t.shape,r.shape):new Wr(zY,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,XY,t.dtype);var r=new un(t.shape,GY);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new Wr("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new un(t.shape,oRe);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new un(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,s=(o=je().getBool("WEBGL_PACK_CLIP")?new WMe(t.shape):new VMe(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,s)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(je().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,o8,t.dtype);var r=new un(t.shape,o8);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new HMe(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new un(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new un(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new un(t.shape,sRe);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new un(t.shape,aRe);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new un(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new un(t.shape,uRe);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new un(t.shape,lRe);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new un(t.shape,cRe);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new Wr(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new un(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new un(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new un(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new un(t.shape,hRe);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new un(t.shape,fRe);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new un(t.shape,dRe);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new un(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new un(t.shape,function(o){return o===void 0&&(o=0),Nu+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,s,a){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],f=i.outChannels,d=i.dataFormat==="channelsLast",p=(h===1||f===1)&&c>1e3,v=u[2]%2!=0&&!!l.isPacked;if(p||!je().getBool("WEBGL_LAZILY_UNPACK")||!je().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var g=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],m=this.reshape(t,[1,g,i.inChannels]),x=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:x,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),i.outShape)}var _=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),b={dataId:t.dataId,shape:[1,_,i.inChannels],dtype:t.dtype},S=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,ee(e_(l.shape,b.shape),function(){return"packed reshape "+l.shape+" to "+b.shape+" isn't free"});var E=this.reshape(r,[1,i.inChannels,i.outChannels]),C=this.fusedBatchMatMul({a:b,b:E,transposeA:!1,transposeB:!1,bias:o,activation:s,preluActivationWeights:a}),R=this.texData.get(C.dataId);return ee(R.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=S,R.shape=i.outShape,fe.makeTensorFromDataId(C.dataId,i.outShape,C.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,s,a){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,f=i.outHeight,d=i.dataFormat==="channelsLast",p=u*l*c,v=f*h,g=[p,v],m=t.squeeze([0]),x=r.reshape([1,p,-1]),_=new PTe(g,m.shape,i),b=this.compileAndRun(_,[m]).reshape([1,g[0],g[1]]),S=o!=null,E=a!=null,C=s?i_(s,!0):null,R=new $T(b.shape,[1,v,i.outChannels],!0,!1,S,C,E),T=[b,x];o&&T.push(o),E&&T.push(a);var A=this.compileAndRun(R,T);return d?A.reshape([1,f,h,i.outChannels]):A.reshape([1,i.outChannels,f,h])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,s,a,u);if(je().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,s,a,u);var l=s!=null,c=u!=null,h=a?i_(a,!1):null,f=new K6(o,l,h,c),d=[r,i];return s&&d.push(s),u&&d.push(u),this.compileAndRun(f,d)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(je().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new K6(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new XMe(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new jMe(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,s=t.convInfo,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=je().getBool("WEBGL_PACK_DEPTHWISECONV")&&s.strideWidth<=2&&s.outChannels/s.inChannels==1,h=u?i_(u,c):null,f=[i,o],d=a!=null,p=l!=null;return d&&f.push(a),p&&f.push(l),c?(r=new Q6(s,d,h,p),this.compileAndRun(r,f)):(r=new Z6(s,d,h,p),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return je().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new Q6(i),this.compileAndRun(o,[t,r])):(o=new Z6(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new ZMe(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new KMe(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new QMe(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new YMe(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new qMe(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new yy(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new yy(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var s=new yy(o,"max",!0),a=this.compileAndRun(s,[r]),u=new LTe(o),l=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,i){var o=new DMe(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return PY(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(t,u,l).reshape(o);return c},e.prototype.avgPool3d=function(t,r){var i=new jT(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new NMe(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new jT(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var s=new jT(o,"max",!0),a=this.compileAndRun(s,[r]),u=new FTe(o),l=this.compileAndRun(u,[t,a],r.dtype);return a.dispose(),l},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!e_(t.shape,r)&&(i.texture===null||!e_(i.shape,r))){var o=this.packedReshape(t,r);return fe.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return w4(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var s=je().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new jTe(t.shape,r,i,o):new $Te(t.shape,r,i,o);return this.compileAndRun(s,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new GTe(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var s=new qTe(t.shape,r,i,o);return this.compileAndRun(s,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new XTe(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var s=r?t:GE(t),a=s.shape[0],u=s.shape[1],l=new OTe(a,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[s],"int32",c)},e.prototype.oneHot=function(t,r,i,o){var s=new BTe(t.size,r,i,o);return this.compileAndRun(s,[t])},e.prototype.diag=function(t){var r=new iTe(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return dS("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),qD(t.dataSync(),r.dataSync(),i,o,s)},e.prototype.cropAndResize=function(t,r,i,o,s,a){var u=new JMe(t.shape,r.shape,o,s,a);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){ee(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=t.shape[0],s=i==="NHWC"?t.shape[1]:t.shape[2],a=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=s*r,c=a*r,h=u/(r*r),f=new rTe(i==="NHWC"?[o,l,c,h]:[o,h,l,c],r,i);return this.compileAndRun(f,[t])},e.prototype.split=function(t,r,i){return NY(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=wS(0,t,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],f=t.reshape([a,s]),d=r.reshape([a,u]);if(c===0)return w4(Qi([]),i);var p=Dt(0),v=new n8(a,s,f.rank,d.rank,l,h);return this.compileAndRun(v,[d,f,p]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var s=wS(0,t,i),a=s.sliceRank,u=s.numUpdates,l=s.strides,c=s.outputSize,h=new n8(u,a,t.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new e8(lTe,t.shape,r),s=new e8(cTe,t.shape,r),a=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,a),l=this.compileAndRun(s,a),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=EY(t,r),a=s[0],u=s[1],l=s[2],c=s[3],h=r.reshape([u,o]),f=t.reshape([t.size/l,l]),d=new dTe(o,c,[u,l]);return this.compileAndRun(d,[f,h]).reshape(a)},e.prototype.fill=function(t,r,i){if((i=i||dx(r))==="string"){var o=lS(i,St(t));return o.fill(r),fe.makeTensor(o,t,i,this)}var s=new hTe(t,r),a=s.getCustomSetupFunc(r);return this.compileAndRun(s,[],i,a)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return kY(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return fe.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new mRe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new UTe(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[hS(t.shape)].concat(fS(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},s=[hS(r)].concat(fS(r)),a=new HTe(s,i),u=this.runWebGLProgram(a,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,s=i.shape,a=i.dtype,u=VT(s);return r=o?new nTe(u):new tTe(u),{dtype:a,shape:s,dataId:this.runWebGLProgram(r,[{shape:u,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,s){var a=this;s===void 0&&(s=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===C1.DENSE){var c=vy(t.outputShape);l.texShape=c.map(function(_){return 2*_})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),St(u.shape)===0)return l.values=Zv(u.dtype,0),u;var h=[],f=r.map(function(_){if(_.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var b=a.texData.get(_.dataId);if(b.texture==null){if(!t.packedInputs&&St(_.shape)<=je().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:_.shape,texData:null,isUniform:!0,uniformValues:b.values};t.packedInputs&&(b.isPacked=!0,b.shape=_.shape)}else if(!!b.isPacked!=!!t.packedInputs)_=b.isPacked?a.unpackTensor(_):a.packTensor(_),h.push(_),b=a.texData.get(_.dataId);else if(b.isPacked&&!e_(b.shape,_.shape)){var S=_,E=_.shape;_.shape=b.shape,_=a.packedReshape(_,E),h.push(_),b=a.texData.get(_.dataId),S.shape=E}return a.uploadToGPU(_.dataId),{shape:_.shape,texData:b,isUniform:!1}});this.uploadToGPU(u.dataId);var d,p={shape:u.shape,texData:l,isUniform:!1},v=function(_,b,S){var E="";b.concat(S).forEach(function(T){var A=T.texData!=null&&T.texData.slice!=null&&T.texData.slice.flatOffset>0,P=T.isUniform?"uniform":T.texData.texShape;E+=T.shape+"_"+P+"_"+A});var C=_.userCode,R=_.constructor.name;return R+="_"+E+"_"+C}(t,f,p),g=this.getAndSaveBinary(v,function(){return function(_,b,S,E){var C=b.userCode,R=S.map(function(F,U){var L={logicalShape:F.shape,texShape:F.isUniform?null:F.texData.texShape,isUniform:F.isUniform,isPacked:!F.isUniform&&F.texData.isPacked,flatOffset:null};return F.texData!=null&&F.texData.slice!=null&&F.texData.slice.flatOffset>0&&(L.flatOffset=F.texData.slice.flatOffset),{name:b.variableNames[U],shapeInfo:L}}),T=R.map(function(F){return F.shapeInfo}),A={logicalShape:E.shape,texShape:E.texData.texShape,isUniform:!1,isPacked:E.texData.isPacked,flatOffset:null},P=TMe(R,A,C,b.packedInputs),k=_.createProgram(P),W=null,N=_.getUniformLocation(k,"NAN",!1);je().getNumber("WEBGL_VERSION")===1&&(W=_.getUniformLocation(k,"INFINITY",!1));for(var O={},z=0;z<b.variableNames.length;z++){var V=b.variableNames[z];O[V]=_.getUniformLocation(k,V,!1),O["offset"+V]=_.getUniformLocation(k,"offset"+V,!1)}return{program:b,source:P,webGLProgram:k,uniformLocations:O,inShapeInfos:T,outShapeInfo:A,infLoc:W,nanLoc:N}}(a.gpgpu,t,f,p)}),m=this.activeTimers!=null;if(m&&(d=this.startTimer()),function(_,b,S,E,C){t8(b.inShapeInfos,S),t8([b.outShapeInfo],[E]);var R=E.texData.texture,T=E.texData.texShape;E.texData.isPacked?_.setOutputPackedMatrixTexture(R,T[0],T[1]):_.setOutputMatrixTexture(R,T[0],T[1]),_.setProgram(b.webGLProgram),je().getNumber("WEBGL_VERSION")===1&&b.infLoc!==null&&_.gl.uniform1f(b.infLoc,1/0),b.nanLoc!==null&&_.gl.uniform1f(b.nanLoc,NaN),S.forEach(function(A,P){var k=b.program.variableNames[P],W=b.uniformLocations[k],N=b.uniformLocations["offset"+k];if(W!=null)if(A.isUniform)if(St(A.shape)<2)_.gl.uniform1f(W,A.uniformValues[0]);else{var O=A.uniformValues;O instanceof Float32Array||(O=new Float32Array(O)),_.gl.uniform1fv(W,O)}else A.texData.slice!=null&&N!=null&&_.gl.uniform1i(N,A.texData.slice.flatOffset),_.setInputMatrixTexture(A.texData.texture,W,P)}),C!=null&&C(_,b.webGLProgram),_.executeProgram()}(this.gpgpu,g,f,p,o),h.forEach(function(_){return a.disposeData(_.dataId)}),m&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)})),!je().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(t,r,i,o,s){s===void 0&&(s=!1),i=i||r[0].dtype;var a=this.runWebGLProgram(t,r,i,o,s);return fe.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(je().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Xn(function(){if(!je().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=je().getBool("DEBUG");je().set("DEBUG",!1);var i=t.abs(Dt(1e-8)).dataSync()[0];if(je().set("DEBUG",r),i>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,s=i.dtype,a=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,f=this.activeTimers!=null;f&&(h=Qu());var d=i.texShape;if(d==null&&(d=JCe(o,c),i.texShape=d),a!=null){var p=VT(o),v=void 0,g=d[1],m=d[0],x=a instanceof Uint8Array;c?(g=(r=mx(d[0],d[1]))[0],m=r[1],v=new uTe(p,[m,g],x)):v=new aTe(p,[m,g],x);var _=this.makeTensorInfo([m,g],s);this.texData.get(_.dataId).usage=x?ra.PIXELS:ra.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(_.dataId),g,m,a);var b=this.runWebGLProgram(v,[_],s,null,!0),S=this.texData.get(b.dataId);i.texture=S.texture,i.texShape=S.texShape,i.isPacked=S.isPacked,i.usage=S.usage,this.disposeData(_.dataId),this.texData.delete(b.dataId),i.values=null,f&&(this.uploadWaitMs+=Qu()-h)}else{var E=this.acquireTexture(d,l,s,c);i.texture=E}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=function(s,a){if(a==="float32"||a==="complex64")return s;if(a==="int32"||a==="bool"){for(var u=a==="int32"?new Int32Array(s.length):new Uint8Array(s.length),l=0;l<u.length;++l)u[l]=Math.round(s[l]);return u}throw new Error("Unknown dtype "+a)}(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+s+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*Zq(r)},e}(AY);oY()&&fe.registerBackend("webgl",function(){return new gRe},2);function dp(n,e){return n(e={exports:{}},e.exports),e.exports}var yRe=dp(function(n){(function(e,t,r){function i(a){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var d=.02519603282416938*(u+=h.charCodeAt(f));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function s(a,u){var l=new i(a),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.alea=s})(0,n)}),xRe=dp(function(n){(function(e,t,r){function i(a){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xor128=s})(0,n)}),wRe=dp(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,a===(0|a)?u.x=a:l+=a;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(a,u){return u.x=a.x,u.y=a.y,u.z=a.z,u.w=a.w,u.v=a.v,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xorwow=s})(0,n)}),_Re=dp(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()}(u,a)}function o(a,u){return u.x=a.x.slice(),u.i=a.i,u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xorshift7=s})(0,n)}),bRe=dp(function(n){(function(e,t,r){function i(a){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,d=u.i;return u.w=h=h+1640531527|0,c=f[d+34&127],l=f[d=d+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[d]=c^l,u.i=d,c+(h^h>>>16)|0},function(l,c){var h,f,d,p,v,g=[],m=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,m=Math.max(m,c.length)),d=0,p=-32;p<m;++p)c&&(f^=c.charCodeAt((p+32)%c.length)),p===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,p>=0&&(v=v+1640531527|0,d=(h=g[127&p]^=f+v)==0?d+1:0);for(d>=128&&(g[127&(c&&c.length||0)]=-1),d=127,p=512;p>0;--p)f=g[d+34&127],h=g[d=d+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,g[d]=f^h;l.w=v,l.X=g,l.i=d}(u,a)}function o(a,u){return u.i=a.i,u.w=a.w,u.X=a.X.slice(),u}function s(a,u){a==null&&(a=+new Date);var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.xor4096=s})(0,n)}),SRe=dp(function(n){(function(e,t,r){function i(a){var u=this,l="";u.next=function(){var h=u.b,f=u.c,d=u.d,p=u.a;return h=h<<25^h>>>7^f,f=f-d|0,d=d<<24^d>>>8^p,p=p-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-d|0,u.d=d<<16^f>>>16^p,u.a=p-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,a===Math.floor(a)?(u.a=a/4294967296|0,u.b=0|a):l+=a;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(a,u){return u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u}function s(a,u){var l=new i(a),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=s:this.tychei=s})(0,n)}),ed=dp(function(n){(function(e,t){var r,i=this,o=256,s=6,a="random",u=t.pow(o,s),l=t.pow(2,52),c=2*l,h=o-1;function f(m,x,_){var b=[],S=v(function R(T,A){var P,k=[],W=typeof T;if(A&&W=="object")for(P in T)try{k.push(R(T[P],A-1))}catch{}return k.length?k:W=="string"?T:T+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[m,g(e)]:m??function(){try{var R;return r&&(R=r.randomBytes)?R=R(o):(R=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(R)),g(R)}catch{var T=i.navigator,A=T&&T.plugins;return[+new Date,i,A,i.screen,g(e)]}}(),3),b),E=new d(b),C=function(){for(var R=E.g(s),T=u,A=0;R<l;)R=(R+A)*o,T*=o,A=E.g(1);for(;R>=c;)R/=2,T/=2,A>>>=1;return(R+A)/T};return C.int32=function(){return 0|E.g(4)},C.quick=function(){return E.g(4)/4294967296},C.double=C,v(g(E.S),e),(x.pass||_||function(R,T,A,P){return P&&(P.S&&p(P,E),R.state=function(){return p(E,{})}),A?(t[a]=R,T):R})(C,S,"global"in x?x.global:this==t,x.state)}function d(m){var x,_=m.length,b=this,S=0,E=b.i=b.j=0,C=b.S=[];for(_||(m=[_++]);S<o;)C[S]=S++;for(S=0;S<o;S++)C[S]=C[E=h&E+m[S%_]+(x=C[S])],C[E]=x;(b.g=function(R){for(var T,A=0,P=b.i,k=b.j,W=b.S;R--;)T=W[P=h&P+1],A=A*o+W[h&(W[P]=W[k=h&k+T])+(W[k]=T)];return b.i=P,b.j=k,A})(o)}function p(m,x){return x.i=m.i,x.j=m.j,x.S=m.S.slice(),x}function v(m,x){for(var _,b=m+"",S=0;S<b.length;)x[h&S]=h&(_^=19*x[h&S])+b.charCodeAt(S++);return g(x)}function g(m){return String.fromCharCode.apply(0,m)}if(t["seed"+a]=f,v(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)});ed.alea=yRe,ed.xor128=xRe,ed.xorwow=wRe,ed.xorshift7=_Re,ed.xor4096=bRe,ed.tychei=SRe;var $E=ed.alea,ERe=ue({addN_:function(n){ee(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ee(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return Y(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Wi(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return fe.runKernelFunc(function(i,o){return i.addN(e)},r,null,"AddN")}});function jE(){sY("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function qY(n){return n.rank===0||n.rank===1?n.as4D(1,1,1,n.size):n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function YY(n,e,t,r,i,o){o==null&&(o=.001);var s,a,u=Y(n,"x","batchNorm"),l=Y(e,"mean","batchNorm"),c=Y(t,"variance","batchNorm");i!=null&&(s=Y(i,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(l.rank===c.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ee(a==null||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ee(s==null||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var h={x:u,scale:s,offset:a,mean:l,variance:c},f={varianceEpsilon:o};return fe.runKernelFunc(function(d,p){var v=qY(u),g=d.batchNormalization(v,o_(l),o_(c),o,o_(s),o_(a));return p([u,l,c,s]),g},h,null,"FusedBatchNorm",f).reshape(u.shape)}function o_(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var CRe=ue({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),jE(),YY(n,e,t,o,i,r)}}),gx=ue({batchNorm_:YY});function KY(n,e,t,r,i,o){var s,a,u=Y(n,"x","batchNorm"),l=Y(e,"mean","batchNorm"),c=Y(t,"variance","batchNorm");return i!=null&&(s=Y(i,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ee(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),s!=null&&ee(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+s.rank+"."}),a!=null&&ee(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+a.rank+"."}),gx(u,l,c,a,s,o)}var MRe=ue({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),jE(),KY(n,e,t,o,i,r)}}),TRe=ue({batchNorm2d_:KY});function ZY(n,e,t,r,i,o){var s,a,u=Y(n,"x","batchNorm"),l=Y(e,"mean","batchNorm"),c=Y(t,"variance","batchNorm");return i!=null&&(s=Y(i,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ee(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),s!=null&&ee(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+s.rank+"."}),a!=null&&ee(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+a.rank+"."}),gx(u,l,c,a,s,o)}var RRe=ue({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),jE(),ZY(n,e,t,o,i,r)}}),ARe=ue({batchNorm3d_:ZY});function QY(n,e,t,r,i,o){var s,a,u=Y(n,"x","batchNorm"),l=Y(e,"mean","batchNorm"),c=Y(t,"variance","batchNorm");return i!=null&&(s=Y(i,"scale","batchNorm")),r!=null&&(a=Y(r,"offset","batchNorm")),ee(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),ee(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),s!=null&&ee(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+s.rank+"."}),a!=null&&ee(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+a.rank+"."}),gx(u,l,c,a,s,o)}var IRe=ue({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),jE(),QY(n,e,t,o,i,r)}}),PRe=ue({batchNorm4d_:QY}),JY=ue({broadcastTo_:function(n,e){var t=Y(n,"broadcastTo","x"),r=t.shape;if(e.some(function(h){return!(h>0)||h%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=t.shape,s=Array.from(e),a=e.length-1;a>=0;a--)if(o[a]===e[a])s[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=s.map(function(h,f){return h>1?f:-1}).filter(function(h){return h>=0});if(u.length===0)return t.clone();var l={x:t},c={shape:e,inputShape:o};return fe.runKernelFunc(function(h){return h.tile(t,s)},l,function(h){return{x:function(){return h.sum(u,!0)}}},vY,c)}}),kRe=ue({clone_:function(n){var e=Y(n,"x","clone",null);return fe.runKernelFunc(function(){return fe.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{x:e},null,yY)}}),XE=ue({logicalAnd_:function(n,e){var t=Y(n,"a","logicalAnd","bool"),r=Y(e,"b","logicalAnd","bool");return En(t.shape,r.shape),fe.runKernelFunc(function(i){return i.logicalAnd(t,r)},{a:t,b:r},null,"LogicalAnd")}}),DRe=ue({logicalNot_:function(n){var e=Y(n,"x","logicalNot","bool");return fe.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),eK=ue({logicalOr_:function(n,e){var t=Y(n,"a","logicalOr","bool"),r=Y(e,"b","logicalOr","bool");return En(t.shape,r.shape),fe.runKernelFunc(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),NRe=ue({logicalXor_:function(n,e){var t=Y(n,"a","logicalXor","bool"),r=Y(e,"b","logicalXor","bool");return En(t.shape,r.shape),eK(n,e).logicalAnd(XE(n,e).logicalNot())}}),Jd=ue({where_:function(n,e,t){var r=Y(e,"a","where"),i=Y(t,"b","where"),o=Y(n,"condition","where","bool");return Zn(r.shape,i.shape,"Error in where: "),o.rank===1?ee(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Zn(o.shape,i.shape,"Error in where: "),fe.runKernelFunc(function(s,a){var u=s.select(o,r,i);return a([o]),u},{$condition:o,$a:r,$b:i},function(s,a){var u=a[0];return{$condition:function(){return Dn(u).toFloat()},$a:function(){return s.mul(u.cast(s.dtype))},$b:function(){return s.mul(u.logicalNot().cast(s.dtype))}}})}}),tK=function(n){return Et(this,void 0,void 0,function(){var e,t,r;return Ct(this,function(i){switch(i.label){case 0:return[4,(e=Y(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=KD(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},nK=ue({divNoNan_:function(n,e){var t,r=Y(n,"a","div"),i=Y(e,"b","div");r=(t=Or(r,i))[0],i=t[1];var o=Jh(r,i),s=Dn(o),a=i.equal(s);return Jd(a,s,o)}}),_v=ue({tile_:function(n,e){var t=Y(n,"x","tile",null);ee(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."});var r=[t],i={x:t},o={reps:e};return fe.runKernelFunc(function(s,a){var u=s.tile(t,e);return a([t]),u},i,null,xY,o,r)}}),rK=ue({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=nn([n,e],r),o=n<=e?n:e,s=0;s<o;++s)i.set(1,s,s);var a=i.toTensor().as2D(n,e);if(t==null)return a;if(t.length===1)return _v(sh(a,0),[t[0],1,1]);if(t.length===2)return _v(sh(sh(a,0),0),[t[0],t[1],1,1]);if(t.length===3)return _v(sh(sh(sh(a,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),LRe=ue({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=Y(n,"logits","multinomial"),o=i.size,s=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(s>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+s);t=t||Math.random();var a=s===1?i.as2D(1,-1):i,u=fe.runKernelFunc(function(l){return l.multinomial(a,r,e,t)},{logits2D:a});return s===1?u.as1D():u}}),ES=ue({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=Y(n,"indices","oneHot","int32"),o=i.shape.concat([e]),s={indices:i=i.flatten()},a={depth:e,onValue:t,offValue:r};return fe.runKernelFunc(function(u,l){return l([i]),u.oneHot(i,e,t,r)},s,null,gY,a).reshape(o)}}),Ic=ue({pad_:function(n,e,t){t===void 0&&(t=0);var r=Y(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t},o={x:r};return fe.runKernelFunc(function(s,a){return a([r]),s.pad(r,e,t)},o,null,wY,i)}}),FRe=ue({pad1d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Ic(n,[e],t)}}),ORe=ue({pad2d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ic(n,e,t)}}),BRe=ue({pad3d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ic(n,e,t)}}),URe=ue({pad4d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Ic(n,e,t)}}),zRe=ue({rand_:function(n,e,t){var r=St(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return fe.makeTensor(i,n,t)}}),eN=function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var s=o||Math.random();this.random=$E(s.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,s=void 0,a=void 0;do a=(o=2*this.random()-1)*o+(s=2*this.random()-1)*s;while(a>=1||a===0);var u=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*s*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),VRe=function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=$E(o.toString()),this.randn=new eN(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,s;;){do i=this.randn.nextValue(),s=1+this.c*i;while(s<=0);if(s*=s*s,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-s+Math.log(s)),(o=this.randu())<t||Math.log(o)<r)break}return s=1/this.beta*this.d*s,this.alpha<1&&(s*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(s)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),WRe=function(){function n(e,t,r,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=$E(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}(),HRe=ue({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new VRe(e,t,r,i),s=nn(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),GRe=ue({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new eN(e,t,r,!1,i),s=nn(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),iK=ue({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=nn(n,r),s=new WRe(e,t,null,i),a=0;a<o.values.length;a++)o.values[a]=s.nextValue();return o.toTensor()}}),oK=ue({square_:function(n){var e=Y(n,"x","square"),t=[e];return fe.runKernelFunc(function(r,i){return i([e]),r.square(e)},{x:e},null,"Square",{},t,[])}}),sK=ue({squaredDifference_:function(n,e){var t,r=Y(n,"a","squaredDifference"),i=Y(e,"b","squaredDifference");t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape);var o={a:r,b:i},s=[r,i];return fe.runKernelFunc(function(a,u){var l=a.squaredDifference(r,i);return u([r,i]),l},o,function(a,u){var l=u[0],c=u[1],h=Dt(2);return{a:function(){return a.mul(l.sub(c).mul(h))},b:function(){return a.mul(c.sub(l).mul(h))}}},WE,{},s,[])}}),$Re=ue({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var o=new eN(e,t,r,!0,i),s=nn(n,r),a=0;a<s.values.length;a++)s.values[a]=o.nextValue();return s.toTensor()}}),aK=ue({equal_:function(n,e){var t,r=Y(n,"a","equal"),i=Y(e,"b","equal");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),jRe=ue({equalStrict_:function(n,e){var t=Y(n,"a","equalStrict"),r=Y(e,"b","equalStrict");return Zn(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),XRe=ue({greater_:function(n,e){var t,r=Y(n,"a","greater"),i=Y(e,"b","greater");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o){return o.greater(r,i)},{a:r,b:i},null,"Greater")}}),uK=ue({greaterEqual_:function(n,e){var t,r=Y(n,"a","greaterEqual"),i=Y(e,"b","greaterEqual");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o,s){var a=o.greaterEqual(r,i);return s([r,i]),a},{a:r,b:i},function(o,s){var a=s[0],u=s[1];return{a:function(){return Dn(a)},b:function(){return Dn(u)}}},"GreaterEqual")}}),qRe=ue({greaterEqualStrict_:function(n,e){var t=Y(n,"a","greaterEqualStrict"),r=Y(e,"b","greaterEqualStrict");return Zn(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),YRe=ue({greaterStrict_:function(n,e){var t=Y(n,"a","greaterStrict"),r=Y(e,"b","greaterStrict");return Zn(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),KRe=ue({less_:function(n,e){var t,r=Y(n,"a","less"),i=Y(e,"b","less");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o){return o.less(r,i)},{a:r,b:i},null,"Less")}}),ZRe=ue({lessEqual_:function(n,e){var t,r=Y(n,"a","lessEqual"),i=Y(e,"b","lessEqual");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o,s){var a=o.lessEqual(r,i);return s([r,i]),a},{a:r,b:i},null,"LessEqual")}}),QRe=ue({lessEqualStrict_:function(n,e){var t=Y(n,"a","lessEqualStrict"),r=Y(e,"b","lessEqualStrict");return Zn(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),JRe=ue({lessStrict_:function(n,e){var t=Y(n,"a","lessStrict"),r=Y(e,"b","lessStrict");return Zn(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),eAe=ue({notEqual_:function(n,e){var t,r=Y(n,"a","notEqual"),i=Y(e,"b","notEqual");return t=Or(r,i),r=t[0],i=t[1],En(r.shape,i.shape),fe.runKernelFunc(function(o){return o.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),tAe=ue({notEqualStrict_:function(n,e){var t=Y(n,"a","notEqualStrict"),r=Y(e,"b","notEqualStrict");return Zn(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function h8(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function f8(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var tN=ue({gather_:function(n,e,t){t===void 0&&(t=0);var r=Y(n,"x","gather"),i=Y(e,"indices","gather","int32");t=Pi(t,r.shape)[0];var o=function(s,a,u){for(var l=s.shape[u],c=[],h=1,f=1,d=0;d<u;d++)c.push(s.shape[d]),h*=s.shape[d];for(d=0;d<a.rank;d++)c.push(a.shape[d]);for(d=u+1;d<s.rank;d++)c.push(s.shape[d]),f*=s.shape[d];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}}(r,i,t);return fe.runKernelFunc(function(s,a){var u=s.gather(r,i.flatten(),t);return a([i]),u},{x:r,indices:i},function(s,a){var u=a[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),f=h.length,d=l.slice(t,l.length).slice(1),p=d.length,v=h8(0,f),g=h8(f+1,f+1+p),m=f8([h,[c],d]),x=s.reshape(m),_=u.reshape([c]),b=f8([[f],v,g]),S=x.transpose(b),E=lK(S,_,r.shape[t]),C=WD(b);return E=E.transpose(C)},indices:function(){return u}}},"Gather",{axis:t}).reshape(o.outputShape)}}),lK=ue({unsortedSegmentSum_:function(n,e,t){var r=Y(n,"x","unsortedSegmentSum"),i=Y(e,"segmentIds","unsortedSegmentSum","int32");return ee(ii(t),function(){return"numSegments must be of dtype int"}),fe.runKernelFunc(function(o,s){var a=o.unsortedSegmentSum(r,i,t);return s([i]),a},{$x:r},function(o,s){var a=s[0];return{$x:function(){return function(u,l){for(var c=$D(l,Dn(l)),h=tN(u,c),f=uK(l,Dt(0,"int32")),d=h.rank-f.rank,p=0;p<d;++p)f=sh(f,p+1);f=XE(f,wg(h.shape,"bool"));var v=Dn(h);return Jd(f,h,v)}(o,a)}}})}}),nAe=function(n,e,t){return Et(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,p,v;return Ct(this,function(g){switch(g.label){case 0:for(r=Y(n,"tensor","boolMask"),i=Y(e,"mask","boolMask","bool"),o=t??0,s=i.rank,a=r.shape,ee(s>0,function(){return"mask cannot be scalar"}),Zn(a.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+s;l++)u*=a[l];return c=a.slice(0,o).concat([u],a.slice(o+s)),h=r.reshape(c),f=i.reshape([-1]),[4,tK(f)];case 1:return d=g.sent(),p=d.squeeze([1]),v=tN(h,p,o),n!==r&&r.dispose(),e!==i&&i.dispose(),p.dispose(),h.dispose(),f.dispose(),d.dispose(),[2,v]}})})};function cK(n,e,t,r,i,o,s){o===void 0&&(o="NHWC"),ee(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]),ee(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),ee(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),ee(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank});var c=o==="NHWC"?a[3]:a[1],h=o==="NHWC"?u.shape[3]:u.shape[1];ee(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."}),ee(h===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."}),s!=null&&ee(ii(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var f=XD(o),d=fp(a,t.shape,r,1,i,s,!1,f),p=fe.runKernelFunc(function(v,g){var m=v.conv2dDerInput(u,t,d);return g([t,u]),m},{dy4D:u,filter:t},function(v,g){var m=g[0],x=g[1];return{dy4D:function(){return pp(v,m,r,i,o,1,s)},filter:function(){return nN(v,x,m.shape,r,i,o,s)}}});return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function qT(n){var e=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function hK(n,e,t,r,i){ee(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var o=n,s=e,a=!1;e.rank===4&&(a=!0,s=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=s.shape[4];ee(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),ee(s.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+s.rank}),ee(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank}),ee(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."}),ee(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."});var c=bS(o,t.shape,r,1,i),h=fe.runKernelFunc(function(f){return f.conv3dDerInput(s,t,c)},{dy5D:s});return a?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var rAe=ue({conv1d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NWC"),o===void 0&&(o=1);var a=Y(n,"x","conv1d"),u=Y(e,"filter","conv1d"),l=a,c=!1;a.rank===2&&(c=!0,l=a.as3D(1,a.shape[0],a.shape[1])),ee(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),ee(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),s!=null&&ee(ii(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."}),ee(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),ee(es(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),ee(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=pp(f,h,[1,t],r,"NHWC",[1,o],s);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),pp=ue({conv2d_:function(n,e,t,r,i,o,s){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var a=Y(n,"x","conv2d"),u=Y(e,"filter","conv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),ee(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),s!=null&&ee(ii(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var h=i==="NHWC"?l.shape[3]:l.shape[1];ee(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),ee(es(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"});var f=XD(i),d=fp(l.shape,u.shape,t,o,r,s,!1,f),p=[u,l],v=fe.runKernelFunc(function(g,m){var x=g.conv2d(l,u,d);return m([u,l]),x},{x:l,filter:u},function(g,m){var x=m,_=x[0],b=x[1];return ee(eg(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return fK(b.shape,g,_,t,r,i)},filter:function(){return nN(b,g,_.shape,t,r,i)}}},"Conv2D",d,p);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),iAe=ue({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var s=Y(n,"x","conv3d"),a=Y(e,"filter","conv3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),ee(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),ee(a.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+a.rank+"."}),ee(u.shape[4]===a.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+a.shape[3]+"."}),ee(function(f,d){return qT(f)||qT(d)}(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),ee(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=bS(u.shape,a.shape,t,o,r),h=fe.runKernelFunc(function(f,d){var p=f.conv3d(u,a,c);return d([u,a]),p},{x:u,$filter:a},function(f,d){ee(qT(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var p=d[0],v=d[1];return{x:function(){return hK(p.shape,f,v,t,r)},$filter:function(){return function(g,m,x,_,b){var S=g;g.rank===4&&(S=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var E=m;E.rank===4&&(E=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),ee(S.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+S.shape+"."}),ee(E.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+E.shape+"."}),ee(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),ee(S.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+S.shape[4]+") must match input depth in filter ("+x[3]+"."}),ee(E.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+E.shape[4]+") must match output depth for filter ("+x[4]+")."});var C=bS(S.shape,x,_,1,b);return fe.runKernelFunc(function(R){return R.conv3dDerFilter(S,E,C)},{x5D:S,dy5D:E})}(p,f,v.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),nN=ue({conv2dDerFilter_:function(n,e,t,r,i,o,s){o===void 0&&(o="NHWC");var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ee(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),ee(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),ee(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."});var l=o==="NHWC"?a.shape[3]:a.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];ee(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."}),ee(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."}),s!=null&&ee(ii(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."});var h=XD(o),f=fp(a.shape,t,r,1,i,s,!1,h);return fe.runKernelFunc(function(d){return d.conv2dDerFilter(a,u,f)},{x4D:a,dy4D:u})}}),fK=ue({conv2dDerInput_:cK}),rN=ue({depthwiseConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]);var a=Y(n,"x","depthwiseConv2d"),u=Y(e,"filter","depthwiseConv2d"),l=a,c=!1;a.rank===3&&(c=!0,l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),ee(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),ee(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),ee(es(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),s!=null&&ee(ii(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+r+"."});var h=fp(l.shape,u.shape,t,o,r,s,!0),f=[l,u],d=fe.runKernelFunc(function(p,v){var g=p.depthwiseConv2D(l,u,h);return v([l,u]),g},{x:l,filter:u},function(p,v){ee(eg(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var g=v[0],m=v[1];return{x:function(){return dK(g.shape,p,m,h)},filter:function(){return pK(g,p,m.shape,h)}}},"DepthwiseConv2dNative",h,f);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),dK=ue({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var s=fe.runKernelFunc(function(a){return a.depthwiseConv2DDerInput(i,t,r)},{dy4D:i});return o?s.as3D(s.shape[1],s.shape[2],s.shape[3]):s}}),pK=ue({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),fe.runKernelFunc(function(s){return s.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),mK=ue({separableConv2d_:function(n,e,t,r,i,o,s){o===void 0&&(o=[1,1]),s===void 0&&(s="NHWC");var a=Y(n,"x","separableConv2d"),u=Y(e,"depthwiseFilter","separableConv2d"),l=Y(t,"pointwiseFilter","separableConv2d"),c=a,h=!1;if(a.rank===3&&(h=!0,c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ee(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),ee(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),ee(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),ee(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),ee(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],d=u.shape[3];ee(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var p=rN(c,u,r,i,s,o),v=pp(p,l,1,"valid",s);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),oAe=ue({conv2dTranspose_:function(n,e,t,r,i,o){return cK(t,Y(n,"x","conv2dTranspose"),Y(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),sAe=ue({conv3dTranspose_:function(n,e,t,r,i){return hK(t,Y(n,"x","conv3dTranspose"),Y(e,"filter","conv3dTranspose"),r,i)}}),vK=ue({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=Y(n,"a","matMul"),s=Y(e,"b","matMul");i=Or(o,s),o=i[0],s=i[1];var a=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?s.shape[s.rank-1]:s.shape[s.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?s.shape[s.rank-2]:s.shape[s.rank-1],h=o.shape.slice(0,-2),f=s.shape.slice(0,-2),d=St(h),p=St(f);ee(o.rank>=2&&s.rank>=2&&o.rank===s.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+s.rank+"."}),ee(Wi(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+s.shape+" must match."}),ee(a===u,function(){return"Error in matMul: inner shapes ("+a+") and ("+u+") of Tensors with shapes "+o.shape+" and "+s.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var v=o.shape.slice(0,-2).concat([l,c]),g=t?o.as3D(d,a,l):o.as3D(d,l,a),m=r?s.as3D(p,c,u):s.as3D(p,u,c),x={transposeA:t,transposeB:r};return fe.runKernelFunc(function(_,b){var S=_.batchMatMul(g,m,t,r);return b([g,m]),S},{a:g,b:m},function(_,b){var S=b,E=S[0],C=S[1];return t||r?!t&&r?{a:function(){return _.matMul(C,!1,!1)},b:function(){return _.matMul(E,!0,!1)}}:t&&!r?{a:function(){return C.matMul(_,!1,!0)},b:function(){return E.matMul(_,!1,!1)}}:{a:function(){return C.matMul(_,!0,!0)},b:function(){return _.matMul(E,!0,!0)}}:{a:function(){return _.matMul(C,!1,!0)},b:function(){return E.matMul(_,!0,!1)}}},"BatchMatMul",x).reshape(v)}}),aAe=ue({dot_:function(n,e){var t=Y(n,"t1","dot"),r=Y(e,"t2","dot");ee(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return ee(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),uAe=ue({outerProduct_:function(n,e){var t=Y(n,"v1","outerProduct"),r=Y(e,"v2","outerProduct");return ee(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),yx=ue({reverse_:function(n,e){var t=Y(n,"x","reverse");if(t.rank===0)return t.clone();var r=Pi(e,t.shape);return fe.runKernelFunc(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),lAe=ue({reverse1d_:function(n){var e=Y(n,"x","reverse");return ee(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),yx(e,0)}}),cAe=ue({reverse2d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),yx(t,e)}}),hAe=ue({reverse3d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),yx(t,e)}}),fAe=ue({reverse4d_:function(n,e){var t=Y(n,"x","reverse");return ee(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),yx(t,e)}});function gK(n,e,t,r,i,o){var s=Y(n,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ee(a.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.rank+"."}),ee(es(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&ee(ii(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qd(a.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&Wi(l.inShape,l.outShape))return s.clone();var c=[a],h=fe.runKernelFunc(function(f,d){var p=f.maxPool(a,l);return d([a,p]),p},{x:a},function(f,d){var p=d[0],v=d[1];return{x:function(){return function(g,m,x,_,b,S,E,C){var R=Y(g,"dy","maxPoolBackprop"),T=Y(m,"input","maxPoolBackprop"),A=Y(x,"output","maxPoolBackprop");ee(T.rank===R.rank,function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+R.rank+")"}),ee(es(b,S),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+S+"'"}),ee(R.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."}),ee(T.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+T.rank+"."});var P=Qd(T.shape,_,b,S,E,C);return fe.runKernelFunc(function(k){return k.maxPoolBackprop(R,T,A,P)},{$dy:R,$input:T})}(f,p,v,e,t,r,i)}}},"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function yK(n,e,t,r,i,o){var s=Y(n,"x","avgPool","float32");ee(es(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ee(a.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+a.rank+"."}),o!=null&&ee(ii(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qd(a.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&Wi(l.inShape,l.outShape))return s.clone();var c=fe.runKernelFunc(function(h){return h.avgPool(a,l)},{x:a},function(h){return{x:function(){return function(f,d,p,v,g,m){var x=Y(f,"dy","avgPoolBackprop"),_=Y(d,"input","avgPoolBackprop");ee(_.rank===x.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+x.rank+")"}),ee(es(v,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"});var b=_,S=x,E=!1;_.rank===3&&(E=!0,b=_.as4D(1,_.shape[0],_.shape[1],_.shape[2]),S=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),ee(S.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),ee(b.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+b.rank+"."});var C=Qd(b.shape,p,v,g,m),R=fe.runKernelFunc(function(T){return T.avgPoolBackprop(S,b,C)},{dy4D:S,input4D:b});return E?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}(h,a,e,t,r,i)}}},"AvgPool",l);return c=c.cast(s.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Vs=ue({maxPool_:function(n,e,t,r,i){return gK(n,e,t,1,r,i)}}),dAe=ue({avgPool_:function(n,e,t,r,i){return yK(n,e,t,1,r,i)}}),pAe=ue({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var s=Y(n,"x","maxPool"),a=s,u=!1;s.rank===3&&(u=!0,a=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ee(es(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=Qd(a.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(b,S){var E=b.map(function(T,A){return T+(T-1)*(S[A]-1)}).map(function(T){return T-1}),C=E.map(function(T){return Math.floor(T/2)}),R=E.map(function(T,A){return T-C[A]});return E.map(function(T,A){return[C[A],R[A]]})}([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,d=function(b,S,E){var C=E.map(function(N){return N[0]}),R=E.map(function(N){return N[1]}),T=b.concat(C,R),A=S.map(function(N,O){return(N-T[O]%N)%N}),P=R.map(function(N,O){return N+A[O]}),k=S.map(function(N,O){return[C[O],P[O]]}),W=S.map(function(N,O){return[0,A[O]]});return[k,W]}([c.inHeight,c.inWidth],h,l),p=d[0],v=d[1],g=f?r:"valid",m=f?a:hY(a,h,p),x=(t==="avg"?function(){return yK(m,e,o,1,g)}:function(){return gK(m,e,o,1,g)})(),_=f?x:cY(x,h,v);return u?_.as3D(_.shape[1],_.shape[2],_.shape[3]):_}}),mAe=ue({maxPool3d_:function(n,e,t,r,i,o,s){o===void 0&&(o="NDHWC");var a=Y(n,"x","maxPool3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),ee(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),ee(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),ee(es(t,s),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),i!=null&&ee(ii(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=_S(u.shape,e,t,s,r,i,o),h=fe.runKernelFunc(function(f,d){var p=f.maxPool3d(u,c);return d([u,p]),p},{x:u},function(f,d){var p=d[0],v=d[1];return{x:function(){return function(g,m,x,_,b,S,E,C){var R=Y(g,"dy","maxPool3dBackprop"),T=Y(m,"input","maxPool3dBackprop"),A=Y(x,"output","maxPool3dBackprop"),P=R,k=T,W=A,N=!1;T.rank===4&&(N=!0,P=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),k=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),W=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3])),ee(P.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+P.rank+"."}),ee(k.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."}),ee(W.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+W.rank+"."}),S==null&&(S=[1,1,1]),ee(es(b,S),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+b+" and dilations '"+S+"'"}),C!=null&&ee(ii(E),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+C+" but got pad "+E+"."});var O=_S(k.shape,_,b,S,E,C),z=fe.runKernelFunc(function(V){return V.maxPool3dBackprop(P,k,W,O)},{dy5D:P,input5D:k});return N?z.as4D(z.shape[1],z.shape[2],z.shape[3],z.shape[4]):z}(f,p,v,e,t,s,r,i)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),vAe=ue({avgPool3d_:function(n,e,t,r,i,o,s){o===void 0&&(o="NDHWC");var a=Y(n,"x","avgPool3d","float32"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),s==null&&(s=[1,1,1]),ee(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),ee(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),ee(es(t,s),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+s+"'"}),i!=null&&ee(ii(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var c=_S(u.shape,e,t,s,r,i,o),h=fe.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(d,p,v,g,m,x,_){var b=Y(d,"dy","avgPool3dBackprop"),S=Y(p,"input","avgPool3dBackprop"),E=b,C=S,R=!1;S.rank===4&&(R=!0,E=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3]),C=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3])),ee(E.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+E.rank+"."}),ee(C.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+C.rank+"."}),m==null&&(m=[1,1,1]),ee(es(g,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"}),_!=null&&ee(ii(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+_+" but got pad "+x+"."});var T=_S(C.shape,v,g,m,x,_),A=fe.runKernelFunc(function(P){return P.avgPool3dBackprop(E,C,T)},{dy5D:E,input5D:C});return R?A.as4D(A.shape[1],A.shape[2],A.shape[3],A.shape[4]):A}(f,u,e,t,s,r,i)}}});return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),gAe=ue({maxPoolWithArgmax_:function(n,e,t,r,i){i===void 0&&(i=!1);var o=Y(n,"x","maxPoolWithArgmax"),s={filterSize:e,strides:t,pad:r,includeBatchInIndex:i},a=fe.runKernel("MaxPoolWithArgmax",{x:o},s);return{result:a[0],indexes:a[1]}}}),ef=ue({slice_:function(n,e,t){var r,i,o=Y(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(u){ee(u!==-1,function(){return"slice() does not support negative begin indexing."})}),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(u,l){return u>=0?u:(ee(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),dMe(o,r,i);var s=o.shape,a={begin:r,size:i};return fe.runKernelFunc(function(u){return u.slice(o,r,i)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],s[c]-r[c]-i[c]]);return{x:function(){return Ic(u,l)}}},"Slice",a)}}),yAe=ue({slice1d_:function(n,e,t){var r=Y(n,"x","slice1d");return ee(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ef(r,[e],[t])}}),xAe=ue({slice2d_:function(n,e,t){var r=Y(n,"x","slice2d");return ee(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ef(r,e,t)}}),wAe=ue({slice3d_:function(n,e,t){var r=Y(n,"x","slice3d");return ee(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ef(r,e,t)}}),_Ae=ue({slice4d_:function(n,e,t){var r=Y(n,"x","slice4d");return ee(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ef(r,e,t)}});function xK(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(Ps(e.shape,r))),n.rank<t.rank&&(n=n.reshape(Ps(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var bAe=ue({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","all","bool"),i=Pi(e,r.shape),o=i,s=Tl(o,r.rank);s!=null&&(r=r.transpose(s),o=Rl(o.length,r.rank));var a=fe.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(t){var u=Ps(a.shape,i);return a.reshape(u)}return a}}),SAe=ue({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","any","bool"),i=Pi(e,r.shape),o=i,s=Tl(o,r.rank);s!=null&&(r=r.transpose(s),o=Rl(o.length,r.rank));var a=fe.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(t){var u=Ps(a.shape,i);return a.reshape(u)}return a}}),EAe=ue({argMax_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","argMax");e==null&&(e=0);var r=Pi(e,t.shape),i=Tl(r,t.rank);i!=null&&(t=t.transpose(i),r=Rl(r.length,t.rank));var o={axis:r[0]},s=[t];return fe.runKernelFunc(function(a,u){var l=a.argMax(t,r[0]);return u([t]),l},{x:t},function(a,u){var l=u[0];return{x:function(){return Dn(l)}}},"ArgMax",o,s)}}),CAe=ue({argMin_:function(n,e){e===void 0&&(e=0);var t=Y(n,"x","argMin");e==null&&(e=0);var r=Pi(e,t.shape),i=Tl(r,t.rank);return i!=null&&(t=t.transpose(i),r=Rl(r.length,t.rank)),fe.runKernelFunc(function(o,s){var a=o.argMin(t,r[0]);return s([t]),a},{$x:t},function(o,s){var a=s[0];return{$x:function(){return Dn(a)}}})}}),MAe=ue({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","logSumExp"),i=Pi(e,r.shape),o=r.max(i,!0),s=r.sub(o).exp().sum(i).log(),a=o.reshape(s.shape).add(s);if(t){var u=Ps(a.shape,i);return a.reshape(u)}return a}}),TAe=ue({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","max"),i=r,o=Pi(e,r.shape),s=o,a=Tl(s,r.rank);a!=null&&(r=r.transpose(a),s=Rl(s.length,r.rank));var u=[r],l=fe.runKernelFunc(function(h,f){var d=h.max(r,s);return f([i,d]),d},{x:r},function(h,f){return xK(h,f[1],f[0],o,a)},"Max",{axes:s},u,[!0]);if(t){var c=Ps(l.shape,o);l=l.reshape(c)}return l}}),RAe=ue({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","mean"),i=Pi(e,r.shape),o=St(_o(r.shape,i)[1]);return HE(function(s){var a=Dt(o);return{value:(a.dtype===s.dtype?s:s.cast(a.dtype)).div(a).sum(e,t),gradFunc:function(u){var l=s.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(wg(s.shape,"float32")).div(o)}}})(r)}}),AAe=ue({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","min"),i=r,o=Pi(e,r.shape),s=o,a=Tl(s,r.rank);a!=null&&(r=r.transpose(a),s=Rl(s.length,r.rank));var u=[r],l=fe.runKernelFunc(function(h,f){var d=h.min(r,s);return f([i,d]),d},{x:r},function(h,f){return xK(h,f[1],f[0],o,a)},"Min",{axes:s},u,[!0]);if(t){var c=Ps(l.shape,o);l=l.reshape(c)}return l}}),IAe=ue({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Pi(e,(n=Y(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=Ps(i.shape,r));var s=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:s.mean(r,t)}}}),ah=ue({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Pi(e,r.shape);return HE(function(o){var s=Tl(i,o.rank),a=i,u=o;s!=null&&(u=o.transpose(s),a=Rl(a.length,o.rank));var l=function(d){var p=o.shape.slice();return i.forEach(function(v){p[v]=1}),d.reshape(p).mul(wg(o.shape,"float32"))},c={axes:a},h=fe.runKernelFunc(function(d){return d.sum(u,a)},{x:u},function(d){return{x:function(){return l(d)}}},"Sum",c);if(t){var f=Ps(h.shape,i);h=h.reshape(f)}return{value:h,gradFunc:l}})(r)}}),PAe=ue({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Y(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Pi(e,r.shape),o=Tl(i,r.rank),s=i,a=r;o!=null&&(a=r.transpose(o),s=Rl(s.length,r.rank));var u=fe.runKernelFunc(function(c){return c.prod(a,s)},{permutedX:a});if(t){var l=Ps(u.shape,i);u=u.reshape(l)}return u}}),wK=ue({elu_:function(n){var e=Y(n,"x","elu");return fe.runKernelFunc(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return fe.runKernelFunc(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),kAe=ue({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=Y(n,"x","leakyRelu");return $D(Dt(e).mul(t),t)}}),_K=ue({prelu_:function(n,e){var t=Y(n,"x","prelu"),r=Y(e,"alpha","prelu");return fe.runKernelFunc(function(i,o){var s=i.prelu(t,r);return o([t,r]),s},{x:t,alpha:r},function(i,o){var s=o[0],a=o[1],u=s.greater(0);return{x:function(){return Jd(u,i,i.mul(a))},alpha:function(){var l=Jd(u,Dn(i),i.mul(s)),c=Ei(a.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(a.shape)}}},"Prelu")}}),qE=ue({relu_:function(n){var e=Y(n,"x","relu");return e.dtype==="bool"?e.toInt():fe.runKernelFunc(function(t,r){var i=t.relu(e);return r([e]),i},{x:e},function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}},"Relu")}}),bK=ue({relu6_:function(n){var e=Y(n,"x","relu6");return e.dtype==="bool"?e.toInt():fe.runKernelFunc(function(t,r){var i=t.relu6(e);return r([e]),i},{x:e},function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}},"Relu6")}}),DAe=ue({selu_:function(n){var e=Y(n,"x","selu");return fe.runKernelFunc(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(Dt(0)),s=Dt(QD),a=Dt(JD),u=t.mul(a),l=t.mul(s).mul(i.toFloat().exp());return Jd(o,u,l)}}})}}),NAe=ue({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=Y(n,"x","localResponseNormalization");ee(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),ee(ii(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var s=o,a=!1;o.rank===3&&(a=!0,s=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=fe.runKernelFunc(function(l,c){var h=l.localResponseNormalization4D(s,e,t,r,i);return c([s,h]),h},{x4D:s},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return fe.runKernelFunc(function(d){return d.LRNGrad(l,h,f,e,t,r,i)},{})}}});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),SK=ue({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=function a(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return a(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Dt(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=Y(n,"x","norm"),e,t),o=i.shape;if(r){var s=Pi(t,n.shape);o=Ps(i.shape,s)}return i.reshape(o)}}),LAe=ue({basicLSTMCell_:function(n,e,t,r,i,o){var s=Y(n,"forgetBias","basicLSTMCell"),a=Y(e,"lstmKernel","basicLSTMCell"),u=Y(t,"lstmBias","basicLSTMCell"),l=Y(r,"data","basicLSTMCell"),c=Y(i,"c","basicLSTMCell"),h=Y(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(a).add(u),d=f.shape[0],p=f.shape[1]/4,v=[d,p],g=f.slice([0,0],v),m=f.slice([0,p],v),x=f.slice([0,2*p],v),_=f.slice([0,3*p],v),b=g.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(s.add(x).sigmoid())),S=b.tanh().mulStrict(_.sigmoid());return[b,S]}}),FAe=ue({multiRNNCell_:function(n,e,t,r){for(var i=Y(e,"data","multiRNNCell"),o=pS(t,"c","multiRNNCell"),s=pS(r,"h","multiRNNCell"),a=i,u=[],l=0;l<n.length;l++){var c=n[l](a,o[l],s[l]);u.push(c[0]),u.push(c[1]),a=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),OAe=ue({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=Y(n,"v","movingAverage"),s=Y(e,"x","movingAverage"),a=Y(t,"decay","movingAverage");ICe(o,s),ee(Wi(o.shape,s.shape),function(){return"Shape mismatch in v and x"});var u=Dt(1),l=u.sub(a),c=s.sub(o).mul(l);if(i){ee(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=Y(r,"step","movingAverage");c=c.div(u.sub(xS(a,h)))}return o.add(c)}}),BAe=ue({stridedSlice_:function(n,e,t,r,i,o,s,a,u){if(i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),a===void 0&&(a=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),s!==0)throw new Error("ellipsis mask is not yet supported");var l=Y(n,"x","stridedSlice"),c=$6(a),h=l.shape.slice();c.forEach(function(g){e[g]=0,t[g]=1,h.splice(g,0,1)}),l=l.reshape(h);for(var f=0;f<l.rank;f++)e[f]=pMe(i,e,r,l.shape,f),t[f]=mMe(o,t,r,l.shape,f),r[f]=r[f]||1;var d=$6(u);d.forEach(function(g){t[g]=e[g]+1,r[g]=1});var p=jD(e,t,r),v=p.filter(function(g,m){return d.indexOf(m)===-1});return r.every(function(g){return g===1})?ef(l,e,p).reshape(v):fe.runKernelFunc(function(g){return g.stridedSlice(l,e,t,r)},{$x:l}).reshape(v)}}),UAe=ue({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=Y(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=fe.runKernelFunc(function(s){return s.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),zAe=ue({scatterND_:function(n,e,t){var r=Y(n,"indices","scatterND","int32"),i=Y(e,"updates","scatterND");return fMe(i,r,t),fe.runKernelFunc(function(o){return o.scatterND(r,i,t)},{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),iN=ue({fft_:function(n){ee(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return fe.runKernelFunc(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),CS=ue({ifft_:function(n){ee(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return fe.runKernelFunc(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),oN=ue({rfft_:function(n,e){ee(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map(function(m){return 0}),s=n.shape.map(function(m){return m});s[n.shape.length-1]=e,t=n.slice(o,s),r=e}else if(e!=null&&e>r){var a=n.shape.map(function(m){return m});a[n.shape.length-1]=e-r,t=n.concat(Gr(a),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=Ki(t,u).as2D(i,r),c=iN(l),h=Math.floor(r/2)+1,f=Na(c),d=rl(c),p=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),g=t.shape.slice();return g[t.shape.length-1]=h,Ki(p[0],v[0]).reshape(g)}}),EK=ue({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=CS(r);return Na(i)}var o=[t,2*(e-1)],s=Na(n).as2D(t,e),a=rl(n).as2D(t,e),u=s.slice([0,1],[t,e-2]).reverse(1),l=a.slice([0,1],[t,e-2]).reverse(1).mul(Dt(-1)),c=s.concat(u,1),h=a.concat(l,1);return r=Ki(c,h).as2D(o[0],o[1]),i=CS(r),Na(i)}}),VAe=Object.freeze({fft:iN,ifft:CS,rfft:oN,irfft:EK}),WAe=ue({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=Y(n,"sparseIndices","sparseToDense","int32"),o=Y(e,"sparseValues","sparseToDense"),s=Y(r,"defaultValue","sparseToDense",o.dtype);return function(a,u,l,c){if(a.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+a.dtype+".");if(a.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+a.shape+".");var h=a.rank>0?a.shape[0]:1,f=a.rank>1?a.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,t,s),fe.runKernelFunc(function(a){return a.sparseToDense(i,o,t,s)},{$sparseIndices:i,$sparseValues:o,$defaultValue:s})}}),HAe=ue({gatherND_:function(n,e){var t=Y(e,"indices","gatherND","int32"),r=Y(n,"x","gatherND");return fe.runKernelFunc(function(i){return i.gatherND(r,t)},{x:r,indices:t},null,"GatherNd")}}),GAe=ue({diag_:function(n){var e=Y(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return fe.runKernelFunc(function(r){return r.diag(e)},{$x:e}).reshape(t)}}),$Ae=ue({dropout_:function(n,e,t,r){var i=Y(n,"x","dropout");if(ee(i.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),ee(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return n instanceof cr?i.clone():i;var o=function(u,l){if(l==null)return u.shape.slice();if(Wi(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l}(i,t),s=1-e,a=iK(o,0,1,"float32",r).add(s).floor().div(s);return i.mul(a)}});function CK(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var s=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(s)}return Tu(i,"float32")}var sN=ue({hannWindow_:function(n){return CK(n,.5,.5)}}),MK=ue({hammingWindow_:function(n){return CK(n,.54,.46)}}),aN=ue({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,s=[];o+e<=n.size;)s.push(ef(n,o,e)),o+=t;if(r)for(;o<n.size;){var a=o+e-n.size,u=qa([ef(n,o,e-a),Od([a],i)]);s.push(u),o+=t}return s.length===0?Fd([],[0,e]):qa(s).as2D(s.length,e)}}),TK=ue({stft_:function(n,e,t,r,i){var o;i===void 0&&(i=sN),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var s=aN(n,e,t),a=Hr(s,i(e)),u=[],l=0;l<s.shape[0];l++)u.push(oN(a.slice([l,0],[1,e]),r));return qa(u)}}),jAe=Object.freeze({hannWindow:sN,hammingWindow:MK,frame:aN,stft:TK}),Ro,XAe=function(n,e,t){return t===void 0&&(t=1),Et(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h,f,d,p,v,g;return Ct(this,function(m){switch(m.label){case 0:return r=Y(n,"predictions","inTopK"),i=Y(e,"targets","inTopK"),ee(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),ee(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),Zn(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],ee(t>0&&t<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t}),[4,r.data()];case 1:return s=m.sent(),[4,i.data()];case 2:for(a=m.sent(),u=[s.length/o,o],c=u[1],h=Zv("bool",l=u[0]),f=0;f<l;f++){for(d=f*c,p=s.subarray(d,d+c),v=[],g=0;g<p.length;g++)v.push({value:p[g],index:g});for(v.sort(function(x,_){return _.value-x.value}),h[f]=0,g=0;g<t;g++)if(v[g].index===a[f]){h[f]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Qi(h,i.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Ro||(Ro={}));var qAe=ue({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Ro.SUM_BY_NONZERO_WEIGHTS);var i=Y(n,"labels","absoluteDifference"),o=Y(e,"predictions","absoluteDifference"),s=null;t!=null&&(s=Y(t,"weights","absoluteDifference")),Zn(i.shape,o.shape,"Error in absoluteDifference: ");var a=i.sub(o).abs();return Pc(a,s,r)}}),Pc=ue({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Ro.SUM_BY_NONZERO_WEIGHTS);var r=Y(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=Y(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Ro.NONE)return o;if(t===Ro.SUM)return o.sum();if(t===Ro.MEAN){if(i==null)return o.mean();var s=r.size/i.size,a=o.sum().div(i.sum());return s>1?a.div(Dt(s)):a}if(t===Ro.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Dt(r.size));var u=i.mul(wg(r.shape)).notEqual(Dt(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),YAe=ue({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Ro.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","cosineDistance"),s=Y(e,"predictions","cosineDistance"),a=null;r!=null&&(a=Y(r,"weights","cosineDistance")),Zn(o.shape,s.shape,"Error in cosineDistance: ");var u=Dt(1).sub(o.mul(s).sum(t,!0));return Pc(u,a,i)}}),KAe=ue({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Ro.SUM_BY_NONZERO_WEIGHTS);var i=Y(n,"labels","hingeLoss"),o=Y(e,"predictions","hingeLoss"),s=null;t!=null&&(s=Y(t,"weights","hingeLoss")),Zn(i.shape,o.shape,"Error in hingeLoss: ");var a=Dt(1);i=Dt(2).mul(i).sub(a);var u=a.sub(i.mul(o)).relu();return Pc(u,s,r)}}),ZAe=ue({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Ro.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","huberLoss"),s=Y(e,"predictions","huberLoss"),a=null;t!=null&&(a=Y(t,"weights","huberLoss")),Zn(o.shape,s.shape,"Error in huberLoss: ");var u=Dt(r),l=s.sub(o).abs(),c=SY(l,u),h=l.sub(c),f=Dt(.5).mul(c.square()).add(u.mul(h));return Pc(f,a,i)}}),QAe=ue({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Ro.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"labels","logLoss"),s=Y(e,"predictions","logLoss"),a=null;t!=null&&(a=Y(t,"weights","logLoss")),Zn(o.shape,s.shape,"Error in logLoss: ");var u=Dt(1),l=Dt(r),c=o.mul(s.add(l).log()).neg().sub(u.sub(o).mul(u.sub(s).add(l).log()));return Pc(c,a,i)}}),JAe=ue({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Ro.SUM_BY_NONZERO_WEIGHTS);var i=Y(n,"labels","meanSquaredError"),o=Y(e,"predictions","meanSquaredError"),s=null;t!=null&&(s=Y(t,"weights","meanSquaredError")),Zn(i.shape,o.shape,"Error in meanSquaredError: ");var a=i.squaredDifference(o);return Pc(a,s,r)}}),eIe=ue({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ro.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"multiClassLabels","sigmoidCrossEntropy"),s=Y(e,"logits","sigmoidCrossEntropy"),a=null;if(t!=null&&(a=Y(t,"weights","sigmoidCrossEntropy")),Zn(o.shape,s.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Dt(r),l=Dt(1),c=Dt(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=function(f,d){var p=Y(f,"labels","sigmoidCrossEntropyWithLogits"),v=Y(d,"logits","sigmoidCrossEntropyWithLogits");Zn(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=v.relu(),m=v.mul(p),x=v.abs().neg().exp().log1p();return g.sub(m).add(x)}(o,s);return Pc(h,a,i)}}),tIe=ue({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Ro.SUM_BY_NONZERO_WEIGHTS);var o=Y(n,"onehotLabels","softmaxCrossEntropy"),s=Y(e,"logits","softmaxCrossEntropy"),a=null;if(t!=null&&(a=Y(t,"weights","softmaxCrossEntropy")),Zn(o.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Dt(r),l=Dt(1),c=Dt(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=function(f,d,p){if(p===void 0&&(p=-1),p===-1&&(p=d.rank-1),p!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+p);return HE(function(v,g,m){var x=g.logSumExp([p],!0),_=g.toFloat().sub(x);return m([v,_]),{value:_.mul(v).neg().sum([p]),gradFunc:function(b,S){var E=S[0],C=S[1],R=Ps(b.shape,[p]);return[b.reshape(R).mul(E.toFloat().sub(C.exp())),b.reshape(R).mul(C.exp().sub(E.toFloat()))]}}})(f,d)}(o,s);return Pc(h,a,i)}}),nIe=Object.freeze({get Reduction(){return Ro},absoluteDifference:qAe,computeWeightedLoss:Pc,cosineDistance:YAe,hingeLoss:KAe,huberLoss:ZAe,logLoss:QAe,meanSquaredError:JAe,sigmoidCrossEntropy:eIe,softmaxCrossEntropy:tIe});function d8(n,e){return e===void 0&&(e=!1),fe.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=rK(t),o=n.clone(),s=Fd([[1]],[1,1]),a=s.clone(),u=t>=r?r:t,l=function(h){var f,d=o,p=a,v=i;f=fe.tidy(function(){var g=o.slice([h,h],[t-h,1]),m=g.norm(),x=o.slice([h,h],[1,1]),_=Fd([[-1]]).where(x.greater(0),Fd([[1]])),b=x.sub(_.mul(m)),S=g.div(b);a=S.shape[0]===1?s.clone():s.concat(S.slice([1,0],[S.shape[0]-1,S.shape[1]]),0);var E=_.matMul(b).div(m).neg(),C=o.slice([h,0],[t-h,r]),R=E.mul(a),T=a.transpose();if(h===0)o=C.sub(R.matMul(T.matMul(C)));else{var A=C.sub(R.matMul(T.matMul(C)));o=o.slice([0,0],[h,r]).concat(A,0)}var P=R.transpose(),k=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=k.sub(k.matMul(a).matMul(P));else{var W=k.sub(k.matMul(a).matMul(P));i=i.slice([0,0],[t,h]).concat(W,1)}return[a,o,i]}),a=f[0],o=f[1],i=f[2],Rs([d,p,v])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var rIe=ue({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=Y(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),s=o[0],a=o[1];if(!(e<=s))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+s+").");if(!(t<=a))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+a+").");e<0&&(e=s),t<0&&(t=a);var u=mS(0,s,1,"int32").reshape([-1,1]),l=mS(0,a,1,"int32"),c=Su(u,l),h=XE(c.lessEqual(Dt(+e,"int32")),c.greaterEqual(Dt(-t,"int32"))),f=Gr([s,a],r.dtype);return Qh(zE(r.reshape([-1,s,a])).map(function(d){return Jd(h,d,f)})).reshape(i)}}),iIe=ue({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,ee(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){ee(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=HD(n,n.shape[0],0).map(function(u){return fY(u,[0])});ee(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],s=n,a=function(u){o.push(fe.tidy(function(){var l=s[u];if(u>0)for(var c=0;c<u;++c){var h=ah(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(SK(l,"euclidean"))}))};for(i=0;i<n.length;++i)a(i);return e?Qh(o,0):o}}),oIe=ue({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return d8(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(s,a){return s*a}),r=zE(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(s){var a=d8(s,e),u=a[0],l=a[1];i.push(u),o.push(l)}),[Qh(i,0).reshape(n.shape),Qh(o,0).reshape(n.shape)]}}),sIe=Object.freeze({bandPart:rIe,gramSchmidt:iIe,qr:oIe});function YE(n,e,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var s=n.shape[0];return t=Math.min(t,s),ee(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),ee(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),ee(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),ee(e.rank===1,function(){return"scores must be a 1D tensor"}),ee(e.shape[0]===s,function(){return"scores has incompatible shape with boxes. Expected "+s+", but was "+e.shape[0]}),ee(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var aIe=ue({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=Y(n,"images","resizeBilinear");ee(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),ee(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=fe.runKernelFunc(function(l,c){return c([i]),l.resizeBilinear(i,s,a,t)},{x:i},function(l,c){return{x:function(){return fe.runKernelFunc(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}},"ResizeBilinear",{alignCorners:t,newHeight:s,newWidth:a});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),uIe=ue({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=Y(n,"images","resizeNearestNeighbor");ee(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),ee(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),ee(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e[0],a=e[1],u=fe.runKernelFunc(function(l,c){return c([i]),l.resizeNearestNeighbor(i,s,a,t)},{batchImages:i},function(l,c){return{batchImages:function(){return fe.runKernelFunc(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),lIe=ue({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=Y(n,"boxes","nonMaxSuppression"),s=Y(e,"scores","nonMaxSuppression"),a=YE(o,s,t,r,i);t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return fe.runKernelFunc(function(l){return l.nonMaxSuppression(o,s,t,r,i)},{boxes:o,scores:s},null,"NonMaxSuppressionV3",u)}}),cIe=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Et(this,void 0,void 0,function(){var o,s,a,u,l,c,h;return Ct(this,function(f){switch(f.label){case 0:return o=Y(n,"boxes","nonMaxSuppressionAsync"),s=Y(e,"scores","nonMaxSuppressionAsync"),a=YE(o,s,t,r,i),t=a.maxOutputSize,r=a.iouThreshold,i=a.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],h=qD(l,c,t,r,i),o!==n&&o.dispose(),s!==e&&s.dispose(),[2,h]}})})},hIe=ue({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var s=Y(n,"boxes","nonMaxSuppression"),a=Y(e,"scores","nonMaxSuppression"),u=YE(s,a,t,r,i,o),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=fe.runKernel("NonMaxSuppressionV5",{boxes:s,scores:a},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),fIe=function(n,e,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),Et(this,void 0,void 0,function(){var s,a,u,l,c,h,f;return Ct(this,function(d){switch(d.label){case 0:return s=Y(n,"boxes","nonMaxSuppressionAsync"),a=Y(e,"scores","nonMaxSuppressionAsync"),u=YE(s,a,t,r,i,o),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([s.data(),a.data()])];case 1:return l=d.sent(),c=l[0],h=l[1],f=YD(c,h,t,r,i,o),s!==n&&s.dispose(),a!==e&&a.dispose(),[2,f]}})})},dIe=ue({cropAndResize_:function(n,e,t,r,i,o){var s=Y(n,"image","cropAndResize"),a=Y(e,"boxes","cropAndResize","float32"),u=Y(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=a.shape[0];return ee(s.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+s.rank+"."}),ee(a.rank===2&&a.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+a.shape+"."}),ee(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+a.shape+"."}),ee(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),ee(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),ee(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),fe.runKernelFunc(function(c,h){return c.cropAndResize(s,a,u,r,i,o)},{images:s,boxes:a,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),RK=Object.freeze({resizeBilinear:aIe,resizeNearestNeighbor:uIe,nonMaxSuppression:lIe,nonMaxSuppressionAsync:cIe,nonMaxSuppressionWithScore:hIe,nonMaxSuppressionWithScoreAsync:fIe,cropAndResize:dIe}),uN=function(n,e){return!(n>0)||e==="linear"},lN=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},cN=function(n,e){var t=e,r=Ei(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},hN=function(n,e,t){if(e==="linear")return n;if(e==="relu")return qE(n);if(e==="elu")return wK(n);if(e==="relu6")return bK(n);if(e==="prelu")return _K(n,t);throw new Error("Unknown fused activation "+e+".")},pIe=ue({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=i!==void 0&&i,s=n.transposeB,a=s!==void 0&&s,u=n.bias,l=n.activation,c=l===void 0?"linear":l,h=n.preluActivationWeights;if(uN(fe.state.gradientDepth,c)===!1){var f=vK(t,r,o,a);return u!=null&&(f=Ya(f,u)),hN(f,c,h)}var d=Y(t,"a","fused matMul"),p=Y(r,"b","fused matMul");e=Or(d,p),d=e[0],p=e[1];var v=o?d.shape[d.rank-2]:d.shape[d.rank-1],g=a?p.shape[p.rank-1]:p.shape[p.rank-2],m=o?d.shape[d.rank-1]:d.shape[d.rank-2],x=a?p.shape[p.rank-2]:p.shape[p.rank-1],_=d.shape.slice(0,-2),b=p.shape.slice(0,-2),S=St(_),E=St(b);ee(d.rank>=2&&p.rank>=2&&d.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."}),ee(Wi(_,b),function(){return"Error in fused matMul: outer dimensions ("+_+") and ("+b+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."}),ee(v===g,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+g+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+a+" must match."});var C,R,T=d.shape.slice(0,-2).concat([m,x]),A=o?d.as3D(S,v,m):d.as3D(S,m,v),P=a?p.as3D(E,x,g):p.as3D(E,g,x);u!=null&&En(T,(C=Or(C=Y(u,"bias","fused matMul"),d)[0]).shape),h!=null&&(R=Y(h,"prelu weights","fused matMul"));var k={a:A,b:P};u!=null&&(k.bias=C),h!=null&&(k.preluActivationWeights=R);var W=[A,P];return fe.runKernelFunc(function(N,O){var z=N.fusedBatchMatMul({a:A,b:P,transposeA:o,transposeB:a,bias:C,activation:c,preluActivationWeights:R});return O([A,P,z]),z},k,function(N,O){var z=O[0],V=O[1],F=O[2],U=lN(N,F,c),L={};return u!=null&&(L={bias:function(){return cN(C,U)}}),Object.assign(o||a?!o&&a?{a:function(){return U.matMul(V,!1,!1)},b:function(){return U.matMul(z,!0,!1)}}:o&&!a?{a:function(){return V.matMul(U,!1,!0)},b:function(){return z.matMul(U,!1,!1)}}:{a:function(){return V.matMul(U,!0,!0)},b:function(){return U.matMul(z,!0,!0)}}:{a:function(){return U.matMul(V,!1,!0)},b:function(){return z.matMul(U,!0,!1)}},L)},"_FusedMatMul",{transposeA:o,transposeB:a,activation:c},W,[!0]).reshape(T)}}),mIe=ue({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,a=n.dilations,u=a===void 0?[1,1]:a,l=n.dimRoundingMode,c=n.bias,h=n.activation,f=h===void 0?"linear":h,d=n.preluActivationWeights;if(f=f||"linear",uN(fe.state.gradientDepth,f)===!1){var p=pp(e,t,r,i,s,u,l);return c!=null&&(p=Ya(p,c)),hN(p,f,d)}var v=Y(e,"x","conv2d"),g=Y(t,"filter","conv2d"),m=v,x=!1;v.rank===3&&(x=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ee(m.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),ee(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),l!=null&&ee(ii(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."}),ee(m.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),ee(es(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),ee(s==="NHWC",function(){return"Error in conv2d: got dataFormat of "+s+" but only NHWC is currently supported."});var _,b,S=fp(m.shape,g.shape,r,u,i,l);c!=null&&(_=Or(_=Y(c,"bias","fused conv2d"),v)[0],En(S.outShape,_.shape)),d!=null&&(b=Y(d,"prelu weights","fused conv2d"));var E={x:m,filter:g};c!=null&&(E.bias=_),d!=null&&(E.preluActivationWeights=b);var C=[g,m],R=fe.runKernelFunc(function(T,A){var P=T.fusedConv2d({input:m,filter:g,convInfo:S,bias:_,activation:f,preluActivationWeights:b});return A([g,m,P]),P},E,function(T,A){var P=A,k=P[0],W=P[1],N=P[2],O=lN(T,N,f);ee(eg(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var z={};return c!=null&&(z={bias:function(){return cN(_,O)}}),Object.assign({x:function(){return fK(W.shape,O,k,r,i)},filter:function(){return nN(W,O,k.shape,r,i)}},z)},"FusedConv2D",{convInfo:S,activation:f},C,[!0]);return x?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),vIe=ue({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,a=n.dilations,u=a===void 0?[1,1]:a,l=n.dimRoundingMode,c=n.bias,h=n.activation,f=h===void 0?"linear":h,d=n.preluActivationWeights;if(uN(fe.state.gradientDepth,f)===!1){var p=rN(e,t,r,i,s,u,l);return c!=null&&(p=Ya(p,c)),hN(p,f,d)}var v=Y(e,"x","depthwiseConv2d"),g=Y(t,"filter","depthwiseConv2d"),m=v,x=!1;v.rank===3&&(x=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),ee(m.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),ee(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),ee(m.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),ee(es(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&ee(ii(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."});var _,b,S=fp(m.shape,g.shape,r,u,i,l,!0);c!=null&&(_=Or(_=Y(c,"bias","fused conv2d"),v)[0],En(S.outShape,_.shape)),d!=null&&(b=Y(d,"prelu weights","fused depthwiseConv2d"));var E={x:m,filter:g};c!=null&&(E.bias=_),d!=null&&(E.preluActivationWeights=b);var C=[g,m],R=fe.runKernelFunc(function(T,A){var P=T.fusedDepthwiseConv2D({input:m,filter:g,convInfo:S,bias:_,activation:f,preluActivationWeights:b});return A([g,m,P]),P},E,function(T,A){ee(eg(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var P=A[0],k=A[1],W=A[2],N=lN(T,W,f),O={};return c!=null&&(O={bias:function(){return cN(_,N)}}),Object.assign({x:function(){return dK(k.shape,N,P,S)},filter:function(){return pK(k,N,P.shape,S)}},O)},"FusedDepthwiseConv2D",{convInfo:S,activation:f},C,[!0]);return x?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),gIe=Object.freeze({matMul:pIe,conv2d:mIe,depthwiseConv2d:vIe}),yIe=Object.freeze({image:RK,linalg:sIe,losses:nIe,spectral:VAe,fused:gIe,signal:jAe,add:Ya,addN:ERe,batchNorm:gx,batchNormalization:CRe,batchNorm2d:TRe,batchNormalization2d:MRe,batchNorm3d:ARe,batchNormalization3d:RRe,batchNorm4d:PRe,batchNormalization4d:IRe,broadcastTo:JY,clone:kRe,div:Jh,divNoNan:nK,eye:rK,multinomial:LRe,oneHot:ES,pad:Ic,pad1d:FRe,pad2d:ORe,pad3d:BRe,pad4d:URe,rand:zRe,randomGamma:HRe,randomNormal:GRe,randomUniform:iK,square:oK,squaredDifference:sK,tile:_v,truncatedNormal:$Re,conv1d:rAe,conv2d:pp,conv3d:iAe,depthwiseConv2d:rN,separableConv2d:mK,conv2dTranspose:oAe,conv3dTranspose:sAe,op:ue,booleanMaskAsync:nAe,complex:Ki,real:Na,imag:rl,concat:qa,concat1d:d3e,concat2d:p3e,concat3d:m3e,concat4d:v3e,split:HD,matMul:vK,dot:aAe,outerProduct:uAe,reverse:yx,reverse1d:lAe,reverse2d:cAe,reverse3d:hAe,reverse4d:fAe,maxPool:Vs,avgPool:dAe,pool:pAe,maxPool3d:mAe,avgPool3d:vAe,maxPoolWithArgmax:gAe,slice:ef,slice1d:yAe,slice2d:xAe,slice3d:wAe,slice4d:_Ae,abs:b3e,acos:S3e,acosh:E3e,asin:C3e,asinh:M3e,atan:T3e,atanh:R3e,ceil:A3e,clipByValue:I3e,cos:P3e,cosh:k3e,erf:D3e,exp:N3e,expm1:L3e,floor:F3e,log:O3e,log1p:B3e,logSigmoid:U3e,neg:GD,reciprocal:z3e,round:V3e,rsqrt:_Y,sigmoid:W3e,sign:H3e,isNaN:G3e,isInf:$3e,isFinite:j3e,sin:X3e,sinh:q3e,softplus:Y3e,sqrt:K3e,step:Z3e,tan:Q3e,tanh:J3e,all:bAe,any:SAe,argMax:EAe,argMin:CAe,logSumExp:MAe,max:TAe,mean:RAe,min:AAe,moments:IAe,sum:ah,prod:PAe,equal:aK,equalStrict:jRe,greater:XRe,greaterEqual:uK,greaterEqualStrict:qRe,greaterStrict:YRe,less:KRe,lessEqual:ZRe,lessEqualStrict:QRe,lessStrict:JRe,notEqual:eAe,notEqualStrict:tAe,addStrict:eMe,atan2:tMe,divStrict:nMe,floorDiv:bY,maximum:$D,maximumStrict:rMe,minimum:SY,minimumStrict:iMe,mod:oMe,modStrict:sMe,mul:Hr,mulStrict:aMe,pow:xS,powStrict:uMe,squaredDifferenceStrict:lMe,sub:Su,subStrict:cMe,elu:wK,leakyRelu:kAe,prelu:_K,relu:qE,relu6:bK,selu:DAe,logicalAnd:XE,logicalNot:DRe,logicalOr:eK,logicalXor:NRe,where:Jd,whereAsync:tK,buffer:nn,print:g3e,batchToSpaceND:cY,cast:y3e,cumsum:x3e,depthToSpace:w3e,expandDims:sh,reshape:Xl,spaceToBatchND:hY,squeeze:fY,stack:Qh,unstack:zE,setdiff1dAsync:_3e,fill:Od,linspace:f3e,ones:wg,range:mS,scalar:Dt,tensor:Qi,tensor1d:Tu,tensor2d:Fd,tensor3d:uY,tensor4d:Ju,tensor5d:l3e,tensor6d:c3e,variable:h3e,zeros:Gr,onesLike:lY,zerosLike:Dn,transpose:du,softmax:GE,logSoftmax:gMe,localResponseNormalization:NAe,norm:SK,gather:tN,unsortedSegmentSum:lK,basicLSTMCell:LAe,multiRNNCell:FAe,movingAverage:OAe,stridedSlice:BAe,topk:UAe,scatterND:zAe,fft:iN,ifft:CS,rfft:oN,irfft:EK,sparseToDense:WAe,gatherND:HAe,diag:GAe,dropout:$Ae,hannWindow:sN,hammingWindow:MK,frame:aN,stft:TK,inTopKAsync:XAe});function qe(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&ee(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors."})})}function b4(n,e,t,r,i,o){for(var s=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=i.padInfo.top,d=i.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=nn(i.outShape,t),g=v.values,m=i.outShape[1]*i.outShape[2]*i.outShape[3],x=i.outShape[2]*i.outShape[3],_=i.outShape[3],b=0;b<i.batchSize;++b)for(var S=b*m,E=b*r[0],C=0;C<i.inChannels;++C)for(var R=0;R<i.outHeight;++R)for(var T=R*s-f,A=Math.max(0,T),P=Math.min(i.inHeight,c+T),k=S+R*x,W=0;W<i.outWidth;++W){for(var N=W*a-d,O=Math.max(0,N),z=Math.min(i.inWidth,h+N),V=p,F=0,U=0,L=A;L<P;L+=u){for(var j=E+L*r[1],Q=O;Q<z;Q+=l){var K=n[j+Q*r[2]+C];o==="max"&&K>V?V=K:o==="avg"&&(F+=K,U++)}if(isNaN(V))break}g[k+W*_+C]=o==="avg"?F/U:V}return v}function AK(n,e,t,r,i,o){i===void 0&&(i=!1),o===void 0&&(o=!1);for(var s=nn(r.outShape,"int32"),a=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=nn(e,t,n),g=0;g<r.batchSize;++g)for(var m=0;m<r.inChannels;++m)for(var x=0;x<r.outHeight;++x){for(var _=x*a-d,b=_;b<0;)b+=l;for(var S=Math.min(r.inHeight,h+_),E=0;E<r.outWidth;++E){for(var C=E*u-p,R=C;R<0;)R+=c;for(var T=Math.min(r.inWidth,f+C),A=Number.NEGATIVE_INFINITY,P=-1,k=b;k<S;k+=l)for(var W=k-_,N=R;N<T;N+=c){var O=N-C,z=v.get(g,k,N,m);z>A&&(A=z,P=i?o?((g*r.inHeight+k)*r.inWidth+N)*r.inChannels+m:(k*r.inWidth+N)*r.inChannels+m:W*f+O)}s.set(P,g,x,E,m)}}return s}function YT(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var xIe=function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new RY(t,fe),t}return Du(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,je().get("IS_NODE")&&dS(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?_4(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map(function(o){return cS(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return nn(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return fe.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Et(this,void 0,void 0,function(){var r;return Ct(this,function(i){return r=Qu(),t(),[2,{kernelMs:Qu()-r}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:fe.keep(t.clone()),imag:fe.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(qe(t,"slice"),MY(t.shape,r,i)){var o=TY(r,t.strides),s=St(i);return Qi(this.readSync(t.dataId).subarray(o,o+s),i,t.dtype)}for(var a=nn(i,t.dtype),u=this.bufferSync(t),l=0;l<a.size;++l){var c=a.indexToLoc(l).map(function(h,f){return h+r[f]});a.values[l]=u.get.apply(u,c)}return a.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){qe(t,"stridedSlice");var s=jD(r,i,o);if(s.some(function(d){return d===0}))return Qi([],s);for(var a=nn(s,t.dtype),u=this.bufferSync(t),l=0;l<a.size;l++){for(var c=a.indexToLoc(l),h=new Array(c.length),f=0;f<h.length;f++)h[f]=c[f]*o[f]+r[f];a.set.apply(a,[u.get.apply(u,h)].concat(c))}return a.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=nn([t.size,t.size],t.dtype),o=i.values,s=0;s<r.length;s++)o[s*t.size+s]=r[s];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),s=0,a=0;a<t.rank;a++)a!==r&&(o[s++]=t.shape[a]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(a=0;a<c.length;a++)u[r]=a,c[a]=this.slice(t,u,l).reshape(o);return c},e.prototype.reverse=function(t,r){qe(t,"reverse");for(var i=nn(t.shape,t.dtype),o=this.bufferSync(t),s=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach(function(h){return c[h]=t.shape[h]-1-c[h]}),i.set.apply(i,[o.get.apply(o,c)].concat(l))},a=0;a<i.size;a++)s(a);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map(function(d){return Na(d)}),s=t.map(function(d){return rl(d)});return Ki(this.concat(o,r),this.concat(s,r))}var a=t.map(function(d){var p=St(d.shape.slice(r));return d.as2D(-1,p)}),u=Jv(a.map(function(d){return d.shape}),1),l=nn(u,t[0].dtype).values;if(a[0].shape[0]===1){var c=0;a.forEach(function(d){l.set(i.readSync(d.dataId),c),c+=d.size})}else{var h=0;a.forEach(function(d){for(var p=i.readSync(d.dataId),v=0,g=0;g<d.shape[0];++g)for(var m=g*u[1]+h,x=0;x<d.shape[1];++x)l[m+x]=p[v++];h+=d.shape[1]})}var f=Jv(t.map(function(d){return d.shape}),r);return Qi(l,f,t[0].dtype)},e.prototype.neg=function(t){return qe(t,"neg"),this.multiply(Dt(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i+s,imag:o+a}}):this.broadcastedBinaryOp(t,r,Zi(t.dtype,r.dtype),function(i,o){return i+o})},e.prototype.addN=function(t){var r=this;qe(t,"addN");for(var i=t.map(function(c){return r.readSync(c.dataId)}),o=nn(t[0].shape,t[0].dtype),s=o.values,a=0;a<t.length;a++)for(var u=i[a],l=0;l<s.length;l++)s[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(t,r){var i=Pi([r],t.shape),o=this.max(t,i),s=Ps(o.shape,i),a=this.subtract(t,o.reshape(s)),u=this.exp(a),l=this.sum(u,i).reshape(s);return Jh(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i-s,imag:o-a}}):this.broadcastedBinaryOp(t,r,Zi(t.dtype,r.dtype),function(i,o){return i-o})},e.prototype.pow=function(t,r){return qe([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.pow(i,o)})},e.prototype.batchMatMul=function(t,r,i,o){qe([t,r],"matMul");for(var s=i?t.shape[1]:t.shape[2],a=i?t.shape[2]:t.shape[1],u=o?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],d=f[0],p=f[1],v=f[2],g=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=g[0],x=g[1],_=g[2],b=a*u,S=nn([l,a,u],t.dtype),E=S.values,C=this.blockSize,R=0;R<l;R++)for(var T=0;T<a;T+=C)for(var A=0;A<u;A+=C)for(var P=0;P<s;P+=C)for(var k=Math.min(T+C,a),W=Math.min(A+C,u),N=Math.min(P+C,s),O=T;O<k;O++)for(var z=A;z<W;z++){for(var V=0,F=P;F<N;F++)V+=c[R*d+O*p+F*v]*h[F*m+z*x+R*_];E[R*b+(O*u+z)]+=V}return S.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,s=t.transposeB,a=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,i,o,s);return a&&(c=this.add(c,a)),u&&(c=YT(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),function(i,o,s,a){return{real:i*s-o*a,imag:i*a+o*s}}):this.broadcastedBinaryOp(t,r,Zi(t.dtype,r.dtype),function(i,o){return i*o})},e.prototype.floorDiv=function(t,r){return qe([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",function(i,o){return Math.floor(i/o)})},e.prototype.sum=function(t,r){qe(t,"sum"),Xs("sum",r,t.rank);for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,Zi(t.dtype,"int32")),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=0,p=0;p<u;++p)d+=c[f+p];l[h]=d}return a},e.prototype.prod=function(t,r){qe(t,"sum");for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,Zi(t.dtype,"int32")),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=1,p=0;p<u;++p)d*=c[f+p];l[h]=d}return a},e.prototype.unsortedSegmentSum=function(t,r,i){qe(t,"unsortedSegmentSum");for(var o=[],s=t.rank-r.rank,a=0;a<s;++a)r=r.expandDims(a+1);for(a=0;a<i;++a){var u=Dt(a,"int32"),l=aK(u,r).asType("float32").mul(t).sum(0);o.push(l)}return Qh(o)},e.prototype.argMin=function(t,r){qe(t,"argMin");var i=[r];Xs("argMin",i,t.rank);for(var o=_o(t.shape,i),s=o[0],a=o[1],u=Gr(s,"int32"),l=St(a),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*l,p=h[d],v=0,g=0;g<l;++g){var m=h[d+g];m<p&&(p=m,v=g)}c[f]=v}return u},e.prototype.argMax=function(t,r){qe(t,"argMax");var i=[r];Xs("argMax",i,t.rank);for(var o=_o(t.shape,i),s=o[0],a=o[1],u=Gr(s,"int32"),l=St(a),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*l,p=h[d],v=0,g=0;g<l;++g){var m=h[d+g];m>p&&(p=m,v=g)}c[f]=v}return u},e.prototype.cumsum=function(t,r,i,o){if(qe(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var s=Zi(t.dtype,"int32"),a=Gr(t.shape,s),u=this.readSync(a.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],h=o?function(g,m){return g+c-m-1}:function(g,m){return g+m},f=0;f<l.length;f+=c)for(var d=0;d<c;d++){var p=h(f,d);if(d===0)u[p]=i?0:l[p];else{var v=h(f,d-1);u[p]=i?l[v]+u[v]:l[p]+u[v]}}return a},e.prototype.equal=function(t,r){return qe([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i===o?1:0})},e.prototype.notEqual=function(t,r){return qe([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i!==o?1:0})},e.prototype.less=function(t,r){return qe([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<o?1:0})},e.prototype.lessEqual=function(t,r){return qe([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i<=o?1:0})},e.prototype.greater=function(t,r){return qe([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>o?1:0})},e.prototype.greaterEqual=function(t,r){return qe([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i>=o?1:0})},e.prototype.logicalNot=function(t){qe(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return qe([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i&&o})},e.prototype.logicalOr=function(t,r){return qe([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",function(i,o){return i||o})},e.prototype.select=function(t,r,i){qe([t,r,i],"select");for(var o=this.readSync(t.dataId),s=this.readSync(r.dataId),a=this.readSync(i.dataId),u=Gr(r.shape,Zi(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=t.rank===0||t.rank>1||r.rank===1?1:St(r.shape.slice(1)),f=0;f<o.length;f++)for(var d=0;d<h;d++)o[f]===1?l[c++]=s[f]:l[c++]=a[f];return u},e.prototype.where=function(t){qe([t],"where");var r=this.readSync(t.dataId);return KD(t.shape,r)},e.prototype.topk=function(t,r,i){return qe(t,"topk"),FY(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){qe(t,"min"),Xs("min",r,t.rank);for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,t.dtype),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var v=c[f+p];v<d&&(d=v)}l[h]=d}return a},e.prototype.minimum=function(t,r){return qe([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.min(i,o)})},e.prototype.mod=function(t,r){return qe([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i%o;return i<0&&o<0||i>=0&&o>=0?s:(s+o)%o})},e.prototype.max=function(t,r){qe(t,"max"),Xs("max",r,t.rank);for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,t.dtype),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var v=c[f+p];v>d&&(d=v)}l[h]=d}return a},e.prototype.maximum=function(t,r){return qe([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.max(i,o)})},e.prototype.all=function(t,r){qe(t,"all"),Xs("all",r,t.rank);for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,t.dtype),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var v=c[f+p];d=d&&v}l[h]=d}return a},e.prototype.any=function(t,r){qe(t,"any"),Xs("any",r,t.rank);for(var i=_o(t.shape,r),o=i[0],s=i[1],a=Gr(o,t.dtype),u=St(s),l=this.readSync(a.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,d=c[f],p=0;p<u;++p){var v=c[f+p];d=d||v}l[h]=d}return a},e.prototype.squaredDifference=function(t,r){return qe([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){var s=i-o;return s*s})},e.prototype.ceil=function(t){qe(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){qe(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){qe(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){qe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){qe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){qe(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){qe(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=Math.floor(r[o]);r[o]-s<.5?i[o]=Math.floor(r[o]):r[o]-s>.5?i[o]=Math.ceil(r[o]):i[o]=s%2==0?s:s+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){qe(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){qe(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){qe(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){qe(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.log1p(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){qe(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){qe(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var s=r[o];i[o]=1/Math.sqrt(s)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){qe(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){qe(t,"relu");for(var r=Gr(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.max(0,o[s]);return r},e.prototype.relu6=function(t){qe(t,"relu");for(var r=Gr(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),s=0;s<o.length;++s)i[s]=Math.min(Math.max(0,o[s]),6);return r},e.prototype.prelu=function(t,r){return qe([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return i<0?o*i:i})},e.prototype.elu=function(t){qe(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=i[o];r[o]=s>=0?s:Math.exp(s)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){qe([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),s=this.readSync(t.dataId),a=0;a<o.length;++a){var u=o[a];i[a]=u>=1?s[a]:s[a]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){qe(t,"selu");for(var r=QD,i=JD,o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){qe(t,"clip");for(var o=new Float32Array(t.size),s=this.readSync(t.dataId),a=0;a<s.length;++a){var u=s[a];o[a]=u>i?i:u<r?r:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var s=i[2*o],a=i[2*o+1];r[o]=Math.hypot(s,a)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){qe(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){qe(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){qe(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s]>-r,u=o[s]<r,l=Math.exp(o[s]),c=void 0;c=u?l:a?o[s]:Math.log(1+l),i[s]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){qe(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){qe(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){qe(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){qe(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){qe(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){qe(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return qe([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,function(i,o){return Math.atan2(i,o)})},e.prototype.sinh=function(t){qe(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){qe(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){qe(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=gCe(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){qe(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){qe(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){qe(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){qe(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var s=Math.sign(i[o]),a=Math.abs(i[o]),u=1/(1+.3275911*a);r[o]=s*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-a*a))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),qe(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),s=0;s<o.length;++s){var a=o[s];isNaN(a)?i[s]=NaN:i[s]=a>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,i,o);return s&&(l=this.add(l,s)),a&&(l=YT(this,l,a,u)),l},e.prototype.conv2d=function(t,r,i){qe([t,r],"conv2d");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",f=nn(i.outShape,t.dtype),d=t.strides[0],p=h?t.strides[1]:t.strides[2],v=h?t.strides[2]:1,g=h?1:t.strides[1],m=f.strides[0],x=h?f.strides[1]:f.strides[2],_=h?f.strides[2]:1,b=h?1:f.strides[1],S=this.readSync(t.dataId),E=this.readSync(r.dataId),C=f.values,R=0;R<i.batchSize;++R)for(var T=R*d,A=R*m,P=0;P<i.outHeight;++P)for(var k=A+P*x,W=P*i.strideHeight-c,N=0;N<o;N++){var O=W+N*a;if(!(O<0||O>=i.inHeight))for(var z=N*r.strides[0],V=T+O*p,F=0;F<i.outWidth;++F)for(var U=k+F*_,L=F*i.strideWidth-l,j=0;j<s;j++){var Q=L+j*u;if(!(Q<0||Q>=i.inWidth))for(var K=V+Q*v,ie=z+j*r.strides[1],pe=0;pe<i.inChannels;++pe){for(var we=S[K+pe*g],ce=0;ce<i.outChannels;++ce)C[U+ce*b]+=we*E[ie+ce];ie+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,s=i.filterHeight,a=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,f=i.padInfo.left,d=i.padInfo.top,p=nn(i.outShape,t.dtype),v=this.readSync(t.dataId),g=this.readSync(r.dataId),m=p.values,x=0;x<i.batchSize;++x)for(var _=x*t.strides[0],b=x*p.strides[0],S=0;S<i.outDepth;++S)for(var E=b+S*p.strides[1],C=S*i.strideDepth-h,R=0;R<o;R++){var T=C+R*u;if(!(T<0||T>=i.inDepth))for(var A=R*r.strides[0],P=_+T*t.strides[1],k=0;k<i.outHeight;++k)for(var W=E+k*p.strides[2],N=k*i.strideHeight-d,O=0;O<s;O++){var z=N+O*l;if(!(z<0||z>=i.inHeight))for(var V=A+O*r.strides[1],F=P+z*t.strides[2],U=0;U<i.outWidth;++U)for(var L=W+U*i.outChannels,j=U*i.strideWidth-f,Q=0;Q<a;Q++){var K=j+Q*c;if(!(K<0||K>=i.inWidth))for(var ie=V+Q*r.strides[2],pe=F+K*i.inChannels,we=ie,ce=0;ce<i.inChannels;++ce){for(var _e=v[pe+ce],Oe=0;Oe<i.outChannels;++Oe)m[L+Oe]+=_e*g[we+Oe];we+=i.outChannels}}}}return p.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){qe([t,r],"conv2dDerInput");for(var o=nn(i.inShape,"float32"),s=o.values,a=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],f=l[2],d=i.batchSize,p=i.filterHeight,v=i.filterWidth,g=i.inChannels,m=i.inHeight,x=i.inWidth,_=i.outChannels,b=i.outHeight,S=i.outWidth,E=i.strideHeight,C=i.strideWidth,R=i.dataFormat,T=p-1-i.padInfo.top,A=v-1-i.padInfo.left,P=R==="channelsLast",k=o.strides[0],W=P?o.strides[1]:o.strides[2],N=P?o.strides[2]:1,O=P?1:o.strides[1],z=t.strides[0],V=P?t.strides[1]:t.strides[2],F=P?t.strides[2]:1,U=P?1:t.strides[1],L=0;L<d;++L)for(var j=0;j<g;++j)for(var Q=0;Q<m;++Q)for(var K=Q-T,ie=Math.max(0,Math.ceil(K/E)),pe=Math.min(b,(p+K)/E),we=0;we<x;++we){for(var ce=we-A,_e=Math.max(0,Math.ceil(ce/C)),Oe=Math.min(S,(v+ce)/C),Ve=0,Ne=ie;Ne<pe;++Ne)for(var Z=Ne*E-K,de=_e;de<Oe;++de)for(var me=z*L+V*Ne+F*de,Ie=c*(p-1-Z)+h*(v-1-(de*C-ce))+f*j,xe=0;xe<_;++xe)Ve+=a[me+U*xe]*u[Ie+xe];s[k*L+W*Q+N*we+O*j]=Ve}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=nn(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],h=a[3],f=this.readSync(t.dataId),d=t.strides,p=d[0],v=d[1],g=d[2],m=d[3],x=this.readSync(r.dataId),_=r.strides,b=_[0],S=_[1],E=_[2],C=_[3],R=i.batchSize,T=i.filterDepth,A=i.filterHeight,P=i.filterWidth,k=i.inChannels,W=i.inDepth,N=i.inHeight,O=i.inWidth,z=i.outChannels,V=i.outDepth,F=i.outHeight,U=i.outWidth,L=i.strideDepth,j=i.strideHeight,Q=i.strideWidth,K=T-1-i.padInfo.front,ie=A-1-i.padInfo.top,pe=P-1-i.padInfo.left,we=0;we<R;++we)for(var ce=0;ce<k;++ce)for(var _e=0;_e<W;++_e)for(var Oe=_e-K,Ve=Math.max(0,Math.ceil(Oe/L)),Ne=Math.min(V,(T+Oe)/L),Z=0;Z<N;++Z)for(var de=Z-ie,me=Math.max(0,Math.ceil(de/j)),Ie=Math.min(F,(A+de)/j),xe=0;xe<O;++xe){for(var se=xe-pe,Xe=Math.max(0,Math.ceil(se/Q)),X=Math.min(U,(P+se)/Q),$=0,le=Ve;le<Ne;++le)for(var ze=le*L-Oe,Te=me;Te<Ie;++Te)for(var J=Te*j-de,be=Xe;be<X;++be)for(var ke=p*we+v*le+g*Te+m*be,He=b*(T-1-ze)+S*(A-1-J)+E*(P-1-(be*Q-se))+C*ce,Ue=0;Ue<z;++Ue)$+=f[ke+Ue]*x[He+Ue];s[u*we+l*_e+c*Z+h*xe+ce]=$}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){qe([t,r],"conv2dDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=nn(i.filterShape,"float32"),h=i.padInfo.left,f=i.padInfo.top,d=this.bufferSync(t),p=this.bufferSync(r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((f-v)/o)),m=Math.min(i.outHeight,(i.inHeight+f-v)/o),x=0;x<u;++x)for(var _=Math.max(0,Math.ceil((h-x)/s)),b=Math.min(i.outWidth,(i.inWidth+h-x)/s),S=0;S<i.inChannels;++S)for(var E=0;E<i.outChannels;++E){for(var C=0,R=0;R<i.batchSize;++R)for(var T=g;T<m;++T)for(var A=v+T*o-f,P=_;P<b;++P){var k=x+P*s-h;C+=l?d.get(R,A,k,S)*p.get(R,T,P,E):d.get(R,S,A,k)*p.get(R,E,T,P)}c.set(C,v,x,S,E)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=nn(i.filterShape,"float32"),f=h.values,d=h.strides,p=d[0],v=d[1],g=d[2],m=d[3],x=this.readSync(r.dataId),_=r.strides,b=_[0],S=_[1],E=_[2],C=_[3],R=this.readSync(t.dataId),T=t.strides,A=T[0],P=T[1],k=T[2],W=T[3],N=i.padInfo.front,O=i.padInfo.left,z=i.padInfo.top,V=0;V<u;++V)for(var F=Math.max(0,Math.ceil((N-V)/o)),U=Math.min(i.outDepth,(i.inDepth+N-V)/o),L=V*p,j=0;j<l;++j)for(var Q=Math.max(0,Math.ceil((z-j)/s)),K=Math.min(i.outHeight,(i.inHeight+z-j)/s),ie=j*v+L,pe=0;pe<c;++pe)for(var we=Math.max(0,Math.ceil((O-pe)/a)),ce=Math.min(i.outWidth,(i.inWidth+O-pe)/a),_e=pe*g+ie,Oe=0;Oe<i.inChannels;++Oe)for(var Ve=Oe*m+_e,Ne=0;Ne<i.outChannels;++Ne){for(var Z=0,de=0;de<i.batchSize;++de)for(var me=de*A,Ie=de*b,xe=F;xe<U;++xe)for(var se=(V+xe*o-N)*P+me,Xe=xe*S+Ie,X=Q;X<K;++X)for(var $=(j+X*s-z)*k+se,le=X*E+Xe,ze=we;ze<ce;++ze){var Te=ze*C+le;Z+=R[(pe+ze*a-O)*W+$+Oe]*x[Te+Ne]}f[Ve+Ne]=Z}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,s=t.bias,a=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return s&&(l=this.add(l,s)),a&&(l=YT(this,l,a,u)),l},e.prototype.depthwiseConv2D=function(t,r,i){qe([t,r],"depthwiseConv2D");for(var o=i.filterHeight,s=i.filterWidth,a=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,f=nn(i.outShape,t.dtype),d=this.readSync(t.dataId),p=this.readSync(r.dataId),v=f.values,g=0;g<i.batchSize;++g)for(var m=g*t.strides[0],x=g*f.strides[0],_=0;_<i.outHeight;++_)for(var b=x+_*f.strides[1],S=_*i.strideHeight-l,E=0;E<o;++E){var C=S+E*a;if(!(C<0||C>=i.inHeight))for(var R=E*r.strides[0],T=m+C*t.strides[1],A=0;A<i.outWidth;++A)for(var P=b+A*f.strides[2],k=A*i.strideWidth-c,W=0;W<s;++W){var N=k+W*u;if(!(N<0||N>=i.inWidth))for(var O=R+W*r.strides[1],z=T+N*i.inChannels,V=P,F=O,U=0;U<i.inChannels;++U){for(var L=d[z+U],j=0;j<h;++j)v[V+j]+=L*p[F+j];V+=h,F+=h}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){qe([t,r],"depthwiseConv2DDerInput");for(var o=nn(i.inShape,"float32"),s=o.values,a=o.strides,u=a[0],l=a[1],c=a[2],h=this.readSync(t.dataId),f=t.strides,d=f[0],p=f[1],v=f[2],g=this.readSync(r.dataId),m=r.strides,x=m[0],_=m[1],b=m[2],S=i.batchSize,E=i.filterHeight,C=i.filterWidth,R=i.inChannels,T=i.inHeight,A=i.inWidth,P=i.outChannels,k=i.outHeight,W=i.outWidth,N=i.strideHeight,O=i.strideWidth,z=E-1-i.padInfo.top,V=C-1-i.padInfo.left,F=P/R,U=0;U<S;++U)for(var L=0;L<R;++L)for(var j=0;j<T;++j)for(var Q=j-z,K=Math.max(0,Math.ceil(Q/N)),ie=Math.min(k,(E+Q)/N),pe=0;pe<A;++pe){for(var we=pe-V,ce=Math.max(0,Math.ceil(we/O)),_e=Math.min(W,(C+we)/O),Oe=0,Ve=K;Ve<ie;++Ve)for(var Ne=Ve*N-Q,Z=ce;Z<_e;++Z)for(var de=d*U+p*Ve+v*Z,me=x*(E-1-Ne)+_*(C-1-(Z*O-we))+b*L,Ie=0;Ie<F;++Ie)Oe+=h[de+(L*F+Ie)]*g[me+Ie];s[u*U+l*j+c*pe+L]=Oe}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){qe([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=nn(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,f=i.outChannels/i.inChannels,d=this.bufferSync(t),p=this.bufferSync(r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((h-v)/o)),m=Math.min(i.outHeight,(i.inHeight+h-v)/o),x=0;x<u;++x)for(var _=Math.max(0,Math.ceil((c-x)/s)),b=Math.min(i.outWidth,(i.inWidth+c-x)/s),S=0;S<i.outChannels;++S){for(var E=Math.trunc(S/f),C=S%f,R=0,T=0;T<i.batchSize;++T)for(var A=g;A<m;++A)for(var P=v+A*o-h,k=_;k<b;++k){var W=x+k*s-c;R+=d.get(T,P,W,E)*p.get(T,A,k,S)}l.set(R,v,x,E,C)}return l.toTensor()},e.prototype.tile=function(t,r){return qe(t,"tile"),LY(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){qe(t,"pad");var o=r.map(function(f,d){return f[0]+t.shape[d]+f[1]}),s=r.map(function(f){return f[0]}),a=this.bufferSync(t),u=nn(o,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=a.indexToLoc(l),h=c.map(function(f,d){return f+s[d]});u.set.apply(u,[a.get.apply(a,c)].concat(h))}return u.toTensor()},e.prototype.gather=function(t,r,i){qe([t,r],"gather");var o=t.shape.slice(),s=this.readSync(r.dataId);o[i]=s.length;for(var a=nn(o,t.dtype),u=this.bufferSync(t),l=0;l<a.size;++l){var c=a.indexToLoc(l),h=c.slice();h[i]=s[c[i]];var f=u.locToIndex(h);a.values[l]=u.values[f]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){qe([t],"batchToSpaceND");var o=r.reduce(function(h,f){return h*f}),s=vS(t.shape,r,o),a=gS(s.length,r.length),u=yS(t.shape,r,o),l=dY(i,r.length),c=pY(u,i,r.length);return du(t.reshape(s),a).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){qe([t],"spaceToBatchND");var o=r.reduce(function(f,d){return f*d}),s=[[0,0]];s.push.apply(s,i);for(var a=1+r.length;a<t.shape.length;++a)s.push([0,0]);var u=t.pad(s),l=vS(u.shape,r,o,!1),c=gS(l.length,r.length,!1),h=yS(u.shape,r,o,!1);return du(u.reshape(l),c).reshape(h)},e.prototype.maxPool=function(t,r){return qe(t,"maxPool"),b4(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){qe([r,i],"maxPoolBackprop");for(var s=this.readSync(r.dataId),a=nn(o.outShape,r.dtype,AK(s,r.shape,r.dtype,o).values),u=o.strideHeight,l=o.strideWidth,c=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=d-1-o.padInfo.left,v=f-1-o.padInfo.top,g=nn(r.shape,"float32"),m=this.bufferSync(t),x=0;x<o.batchSize;++x)for(var _=0;_<o.inChannels;++_)for(var b=0;b<o.inHeight;++b)for(var S=0;S<o.inWidth;++S){for(var E=b-v,C=S-p,R=0,T=0;T<f;T+=c){var A=(E+T)/u;if(!(A<0||A>=o.outHeight||Math.floor(A)!==A))for(var P=0;P<d;P+=h){var k=(C+P)/l;if(!(k<0||k>=o.outWidth||Math.floor(k)!==k)){var W=f*d-1-a.get(x,A,k,_)===T*d+P?1:0;W!==0&&(R+=m.get(x,A,k,_)*W)}}}g.set(R,x,b,S,_)}return g.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){qe([t,r],"avgPoolBackprop");for(var o=i.strideHeight,s=i.strideWidth,a=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,f=i.effectiveFilterWidth,d=f-1-i.padInfo.left,p=h-1-i.padInfo.top,v=nn(r.shape,"float32"),g=1/(a*u),m=this.bufferSync(t),x=0;x<i.batchSize;++x)for(var _=0;_<i.inChannels;++_)for(var b=0;b<i.inHeight;++b)for(var S=0;S<i.inWidth;++S){for(var E=b-p,C=S-d,R=0,T=0;T<h;T+=l){var A=(E+T)/o;if(!(A<0||A>=i.outHeight||Math.floor(A)!==A))for(var P=0;P<f;P+=c){var k=(C+P)/s;k<0||k>=i.outWidth||Math.floor(k)!==k||(R+=m.get(x,A,k,_))}}v.set(R*g,x,b,S,_)}return v.toTensor()},e.prototype.pool3d=function(t,r,i){qe(t,"pool3d");for(var o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),_=nn(r.outShape,t.dtype),b=_.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],R=r.outShape[4],T=0;T<r.batchSize;++T)for(var A=T*S,P=T*t.strides[0],k=0;k<r.inChannels;++k)for(var W=0;W<r.outDepth;++W){for(var N=W*o-p,O=N;O<0;)O+=u;for(var z=Math.min(r.inDepth,h+N),V=A+W*E,F=0;F<r.outHeight;++F){for(var U=F*s-v,L=U;L<0;)L+=l;for(var j=Math.min(r.inHeight,f+U),Q=V+F*C,K=0;K<r.outWidth;++K){for(var ie=K*a-g,pe=ie;pe<0;)pe+=c;for(var we=Math.min(r.inWidth,d+ie),ce=Q+K*R,_e=m,Oe=0,Ve=0,Ne=O;Ne<z;Ne+=u){for(var Z=P+Ne*t.strides[1],de=L;de<j;de+=l){for(var me=Z+de*t.strides[2],Ie=pe;Ie<we;Ie+=c){var xe=x[me+Ie*t.strides[3]+k];if(i==="max"&&xe>_e?_e=xe:i==="avg"&&(Oe+=xe,Ve++),isNaN(_e))break}if(isNaN(_e))break}if(isNaN(_e))break}b[ce+k]=i==="avg"?Oe/Ve:_e}}}return _.toTensor()},e.prototype.avgPool3d=function(t,r){return qe(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){qe([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,s=i.strideHeight,a=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,f=i.dilationHeight,d=i.dilationWidth,p=i.effectiveFilterDepth,v=i.effectiveFilterHeight,g=i.effectiveFilterWidth,m=p-1-i.padInfo.front,x=g-1-i.padInfo.left,_=v-1-i.padInfo.top,b=nn(r.shape,"float32"),S=1/(u*l*c),E=this.bufferSync(t),C=0;C<i.batchSize;++C)for(var R=0;R<i.inChannels;++R)for(var T=0;T<i.inDepth;++T)for(var A=0;A<i.inHeight;++A)for(var P=0;P<i.inWidth;++P){for(var k=T-m,W=A-_,N=P-x,O=0,z=0;z<p;z+=h){var V=(k+z)/o;if(!(V<0||V>=i.outDepth||Math.floor(V)!==V))for(var F=0;F<v;F+=f){var U=(W+F)/s;if(!(U<0||U>=i.outHeight||Math.floor(U)!==U))for(var L=0;L<g;L+=d){var j=(N+L)/a;j<0||j>=i.outWidth||Math.floor(j)!==j||(O+=E.get(C,V,U,j,R))}}}b.set(O*S,C,T,A,P,R)}return b.toTensor()},e.prototype.maxPool3d=function(t,r){return qe(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=nn(r.outShape,"int32"),o=r.strideDepth,s=r.strideHeight,a=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=this.bufferSync(t),x=0;x<r.batchSize;++x)for(var _=0;_<r.inChannels;++_)for(var b=0;b<r.outDepth;++b){for(var S=b*o-p,E=S;E<0;)E+=u;for(var C=Math.min(r.inDepth,h+S),R=0;R<r.outHeight;++R){for(var T=R*s-v,A=T;A<0;)A+=l;for(var P=Math.min(r.inHeight,f+T),k=0;k<r.outWidth;++k){for(var W=k*a-g,N=W;N<0;)N+=c;for(var O=Math.min(r.inWidth,d+W),z=Number.NEGATIVE_INFINITY,V=-1,F=E;F<C;F+=u)for(var U=F-S,L=A;L<P;L+=l)for(var j=L-T,Q=N;Q<O;Q+=c){var K=Q-W,ie=m.get(x,F,L,Q,_);ie>=z&&(z=ie,V=U*f*d+j*f+K)}i.set(V,x,b,R,k,_)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){qe([r,i],"maxPool3dBackprop");for(var s=this.maxPool3dPositions(r,o),a=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,f=o.dilationWidth,d=o.effectiveFilterDepth,p=o.effectiveFilterHeight,v=o.effectiveFilterWidth,g=d-1-o.padInfo.front,m=v-1-o.padInfo.left,x=p-1-o.padInfo.top,_=nn(r.shape,"float32"),b=this.bufferSync(s),S=this.bufferSync(t),E=0;E<o.batchSize;++E)for(var C=0;C<o.inChannels;++C)for(var R=0;R<o.inDepth;++R)for(var T=0;T<o.inHeight;++T)for(var A=0;A<o.inWidth;++A){for(var P=R-g,k=T-x,W=A-m,N=0,O=0;O<d;O+=c){var z=(P+O)/a;if(!(z<0||z>=o.outDepth||Math.floor(z)!==z))for(var V=0;V<p;V+=h){var F=(k+V)/u;if(!(F<0||F>=o.outHeight||Math.floor(F)!==F))for(var U=0;U<v;U+=f){var L=(W+U)/l;if(!(L<0||L>=o.outWidth||Math.floor(L)!==L)){var j=d*p*v-1-b.get(E,z,F,L,C)===O*p*v+V*v+U?1:0;j!==0&&(N+=S.get(E,z,F,L,C)*j)}}}}_.set(N,E,R,T,A,C)}return _.toTensor()},e.prototype.cast=function(t,r){return PY(t,r,this)},e.prototype.reshape=function(t,r){return w4(t,r)},e.prototype.avgPool=function(t,r){return qe(t,"avgPool"),qe(t,"maxPool"),b4(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){qe(t,"resizeBilinear");for(var s=t.shape,a=s[0],u=s[1],l=s[2],c=s[3],h=this.readSync(t.dataId),f=new Float32Array(St([a,r,i,c])),d=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],v=0,g=d[0]/p[0],m=d[1]/p[1],x=0;x<a;x++)for(var _=0;_<r;_++)for(var b=g*_,S=Math.floor(b),E=b-S,C=Math.min(u-1,Math.ceil(b)),R=x*t.strides[0]+S*t.strides[1],T=x*t.strides[0]+C*t.strides[1],A=0;A<i;A++)for(var P=m*A,k=Math.floor(P),W=P-k,N=Math.min(l-1,Math.ceil(P)),O=R+k*t.strides[2],z=T+k*t.strides[2],V=R+N*t.strides[2],F=T+N*t.strides[2],U=0;U<c;U++){var L=h[O+U],j=h[z+U],Q=L+(h[V+U]-L)*W,K=Q+(j+(h[F+U]-j)*W-Q)*E;f[v++]=K}return Qi(f,[a,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){qe([t,r],"resizeBilinearBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],d=new Float32Array(s*a*u*l),p=[i&&h>1?a-1:a,i&&f>1?u-1:u],v=[i&&h>1?h-1:h,i&&f>1?f-1:f],g=p[0]/v[0],m=p[1]/v[1],x=this.readSync(t.dataId),_=0,b=0;b<s;b++)for(var S=b*r.strides[0],E=0;E<h;E++)for(var C=E*g,R=Math.floor(C),T=Math.min(Math.ceil(C),a-1),A=S+R*r.strides[1],P=S+T*r.strides[1],k=C-R,W=1-k,N=0;N<f;N++)for(var O=N*m,z=Math.floor(O),V=Math.min(Math.ceil(O),u-1),F=O-z,U=1-F,L=A+z*r.strides[2],j=A+V*r.strides[2],Q=P+z*r.strides[2],K=P+V*r.strides[2],ie=W*U,pe=W*F,we=k*U,ce=k*F,_e=0;_e<l;_e++){var Oe=x[_++];d[L+_e]+=Oe*ie,d[j+_e]+=Oe*pe,d[Q+_e]+=Oe*we,d[K+_e]+=Oe*ce}return Ju(d,[s,u,a,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){qe(t,"resizeNearestNeighbor");for(var s=t.shape,a=s[0],u=s[1],l=s[2],c=s[3],h=this.readSync(t.dataId),f=new Float32Array(a*r*i*c),d=[o&&r>1?u-1:u,o&&i>1?l-1:l],p=[o&&r>1?r-1:r,o&&i>1?i-1:i],v=d[0]/p[0],g=d[1]/p[1],m=0,x=0;x<a;x++)for(var _=x*t.strides[0],b=0;b<r;b++)for(var S=v*b,E=_+Math.min(u-1,o?Math.round(S):Math.floor(S))*t.strides[1],C=0;C<i;C++)for(var R=g*C,T=E+Math.min(l-1,o?Math.round(R):Math.floor(R))*t.strides[2],A=0;A<c;A++){var P=h[T+A];f[m++]=P}return Qi(f,[a,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){qe([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,s=o[0],a=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],d=new Float32Array(s*a*u*l),p=this.readSync(t.dataId),v=[i&&h>1?a-1:a,i&&f>1?u-1:u],g=[i&&h>1?h-1:h,i&&f>1?f-1:f],m=v[0]/g[0],x=v[1]/g[1],_=1/m,b=1/x,S=2*Math.ceil(_)+2,E=2*Math.ceil(b)+2,C=0;C<s;C++)for(var R=C*r.strides[0],T=0;T<a;T++)for(var A=R+T*r.strides[1],P=Math.floor(T*_),k=Math.floor(P-S/2),W=0;W<u;W++)for(var N=A+W*r.strides[2],O=Math.floor(W*b),z=Math.floor(O-E/2),V=0;V<l;V++){for(var F=0,U=0;U<S;U++){var L=U+k;if(!(L<0||L>=h)){var j=R+L*t.strides[1],Q=L*m;if(T===Math.min(a-1,i?Math.round(Q):Math.floor(Q)))for(var K=0;K<E;K++){var ie=K+z;if(!(ie<0||ie>=f)){var pe=j+ie*t.strides[2],we=ie*x;W===Math.min(u-1,i?Math.round(we):Math.floor(we))&&(F+=p[pe+V])}}}}d[N+V]=F}return Ju(d,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,s,a){qe([t,r,i,s,a],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),h=s?this.readSync(s.dataId):new Float32Array([1]),f=a?this.readSync(a.dataId):new Float32Array([0]),d=new Float32Array(u.length),p=f.length,v=h.length,g=c.length,m=l.length,x=0,_=0,b=0,S=0,E=0;E<u.length;++E)d[E]=f[x++]+(u[E]-l[_++])*h[b++]/Math.sqrt(c[S++]+o),x>=p&&(x=0),_>=m&&(_=0),b>=v&&(b=0),S>=g&&(S=0);return Ju(d,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,s){qe(t,"localResponseNormalization4D");var a=t.shape[3],u=a-1,l=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function f(g){for(var m=g%a,x=g-m+Math.max(0,m-r),_=g-m+Math.min(m+r,u),b=0;x<=_;x++){var S=l[x];b+=S*S}return b}for(var d=0;d<c;d++){var p=f(d),v=l[d]*Math.pow(i+o*p,-s);h[d]=v}return Ju(h,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,s,a,u){qe(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=this.readSync(i.dataId),d=new Float32Array(t.size),p=t.size,v=0;v<p;v++){for(var g=v%l,m=v-g+Math.max(0,g-o),x=v-g+Math.min(l,g+o+1),_=0,b=m;b<x;b++)_+=Math.pow(h[b],2);for(_=a*_+s,b=m;b<x;b++){var S=-2*a*u*h[b]*f[v]/_;v===b&&(S+=Math.pow(_,-u)),S*=c[v],d[b]+=S}}return Ju(d,t.shape)},e.prototype.multinomial=function(t,r,i,o){qe(t,"multinomial");for(var s=r?t:GE(t),a=s.shape[0],u=s.shape[1],l=Gr([a,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(s.dataId),f=0;f<a;++f){var d=f*u,p=new Float32Array(u-1);p[0]=h[d];for(var v=1;v<p.length;++v)p[v]=p[v-1]+h[d+v];for(var g=$E(o.toString()),m=f*i,x=0;x<i;++x){var _=g();c[m+x]=p.length;for(var b=0;b<p.length;b++)if(_<p[b]){c[m+x]=b;break}}}return l},e.prototype.oneHot=function(t,r,i,o){qe(t,"oneHot");var s=new Float32Array(t.size*r);s.fill(o);for(var a=this.readSync(t.dataId),u=0;u<t.size;++u)a[u]>=0&&a[u]<r&&(s[u*r+a[u]]=i);return Fd(s,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,s){return qe(t,"nonMaxSuppression"),qD(this.readSync(t.dataId),this.readSync(r.dataId),i,o,s)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],s=nn(t.shape,"float32"),a=nn(t.shape,"float32"),u=Na(t).as2D(i,o),l=rl(t).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),f=l.slice([c,0],[1,o]),d=Ki(h,f),p=this.readSync(this.fftImpl(d,r).dataId),v=0;v<o;v++){var g=j6(p,v);s.values[c*o+v]=g.real,a.values[c*o+v]=g.imag}return Ki(s.toTensor(),a.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var s=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(s=Ki(Na(s).div(Dt(o)),rl(s).div(Dt(o)))),s}var a=this.readSync(t.dataId),u=function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],h[f/2]=l[f+1];return{real:c,imag:h}}(this.fourierTransformByMatmul(a,o,r));return Ki(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),s=r/2,a=function(m){for(var x=Math.ceil(m.length/4),_=new Float32Array(x),b=new Float32Array(x),S=0;S<m.length;S+=4)_[Math.floor(S/4)]=m[S],b[Math.floor(S/4)]=m[S+1];return{real:_,imag:b}}(o),u=Ki(a.real,a.imag).as1D(),l=function(m){for(var x=Math.floor(m.length/4),_=new Float32Array(x),b=new Float32Array(x),S=2;S<m.length;S+=4)_[Math.floor(S/4)]=m[S],b[Math.floor(S/4)]=m[S+1];return{real:_,imag:b}}(o),c=Ki(l.real,l.imag).as1D();u=this.fftRadix2(u,s,i),c=this.fftRadix2(c,s,i);var h=function(m,x){for(var _=new Float32Array(m/2),b=new Float32Array(m/2),S=0;S<Math.ceil(m/2);S++){var E=(x?2:-2)*Math.PI*(S/m);_[S]=Math.cos(E),b[S]=Math.sin(E)}return{real:_,imag:b}}(r,i),f=Ki(h.real,h.imag).mul(c),d=u.add(f),p=u.sub(f),v=Na(d).concat(Na(p)),g=rl(d).concat(rl(p));return Ki(v,g).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),s=0;s<r;s++){for(var a=0,u=0,l=0;l<r;l++){var c=xMe(s*l,r,i),h=j6(t,l);a+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(a/=r,u/=r),yMe(o,a,u,s)}return o},e.prototype.depthToSpace=function(t,r,i){ee(i==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i}),ee(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=t.shape[0],s=t.shape[1],a=t.shape[2],u=t.shape[3],l=s*r,c=a*r,h=u/(r*r),f=this.readSync(t.dataId),d=new Float32Array(o*l*c*h),p=0,v=0;v<o;++v)for(var g=0;g<l;++g)for(var m=Math.floor(g/r),x=g%r,_=0;_<c;++_)for(var b=Math.floor(_/r),S=(x*r+_%r)*h,E=0;E<h;++E){var C=E+S+u*(b+a*(m+s*v));d[p++]=f[C]}return Ju(d,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var s=En(t.shape,r.shape),a=nn(s,i),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=wh(t.shape,s),h=wh(r.shape,s),f=a.values;if(c.length+h.length===0)for(var d=0;d<f.length;++d)f[d]=o(u[d%u.length],l[d%l.length]);else{var p=this.bufferSync(t),v=this.bufferSync(r),g=function(m){var x=a.indexToLoc(m),_=x.slice(-t.rank);c.forEach(function(C){return _[C]=0});var b=p.locToIndex(_),S=x.slice(-r.rank);h.forEach(function(C){return S[C]=0});var E=v.locToIndex(S);f[m]=o(u[b],l[E])};for(d=0;d<f.length;++d)g(d)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=En(t.shape,r.shape),s=nn(o,"float32"),a=nn(o,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=wh(t.shape,o),h=wh(r.shape,o),f=s.values,d=a.values;if(c.length+h.length===0)for(var p=0;p<f.length;p++){var v=p%u.length,g=p%l.length,m=i(u[2*v],u[2*v+1],l[2*g],l[2*g+1]);f[p]=m.real,d[p]=m.imag}else{var x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),_=this.bufferSync(this.data.get(r.dataId).complexTensors.real),b=function(S){var E=s.indexToLoc(S),C=E.slice(-t.rank);c.forEach(function(k){return C[k]=0});var R=x.locToIndex(C),T=E.slice(-r.rank);h.forEach(function(k){return T[k]=0});var A=_.locToIndex(T),P=i(u[2*R],u[2*R+1],l[2*A],l[2*A+1]);f[S]=P.real,d[S]=P.imag};for(p=0;p<f.length;p++)b(p)}return this.complex(s.toTensor(),a.toTensor())},e.prototype.split=function(t,r,i){return NY(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,s,a){for(var u=t.shape,l=u[0],c=u[1],h=u[2],f=u[3],d=r.shape[0],p=o[0],v=o[1],g=nn([d,p,v,f],"float32"),m=this.readSync(r.dataId),x=this.readSync(i.dataId),_=this.readSync(t.dataId),b=t.strides,S=g.strides,E=0;E<d;E++){var C=4*E,R=m[C],T=m[C+1],A=m[C+2],P=m[C+3],k=x[E];if(!(k>=l))for(var W=p>1?(A-R)*(c-1)/(p-1):0,N=v>1?(P-T)*(h-1)/(v-1):0,O=0;O<p;O++){var z=p>1?R*(c-1)+O*W:.5*(R+A)*(c-1);if(z<0||z>c-1)for(var V=0;V<v;V++)for(var F=0;F<f;F++){var U=F+V*S[2]+O*S[1]+E*S[0];g.values[U]=a}else if(s==="bilinear"){var L=Math.floor(z),j=Math.ceil(z),Q=z-L;for(V=0;V<v;V++)if((Ne=v>1?T*(h-1)+V*N:.5*(T+P)*(h-1))<0||Ne>h-1)for(F=0;F<f;F++)U=F+V*S[2]+O*S[1]+E*S[0],g.values[U]=a;else{var K=Math.floor(Ne),ie=Math.ceil(Ne),pe=Ne-K;for(F=0;F<f;F++){var we=_[U=F+K*b[2]+L*b[1]+k*b[0]],ce=_[U=F+ie*b[2]+L*b[1]+k*b[0]],_e=_[U=F+K*b[2]+j*b[1]+k*b[0]],Oe=we+(ce-we)*pe,Ve=_e+(_[U=F+ie*b[2]+j*b[1]+k*b[0]]-_e)*pe;U=F+V*S[2]+O*S[1]+E*S[0],g.values[U]=Oe+(Ve-Oe)*Q}}}else for(V=0;V<v;++V){var Ne;if((Ne=v>1?T*(h-1)+V*N:.5*(T+P)*(h-1))<0||Ne>h-1)for(F=0;F<f;F++)U=F+V*S[2]+O*S[1]+E*S[0],g.values[U]=a;else{var Z=Math.round(Ne),de=Math.round(z);for(F=0;F<f;F++){var me=F+Z*b[2]+de*b[1]+k*b[0],Ie=F+V*S[2]+O*S[1]+E*S[0];g.values[Ie]=_[me]}}}}}return g.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var s=wS(0,t,i),a=s.sliceRank,u=s.numUpdates,l=s.sliceSize,c=s.strides,h=s.outputSize;return this.scatter(t,r,i,h,l,u,a,c,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],s=EY(t,r),a=s[0],u=s[1],l=s[2],c=s[3];if(u===0)return Qi([],a,t.dtype);for(var h=new E1([u,l],t.dtype),f=this.readSync(r.dataId),d=this.readSync(t.dataId),p=0;p<u;p++){for(var v=[],g=0,m=0;m<o;m++){var x=f[p*o+m];g+=x*c[m],v.push(x)}if(g<0||g>=t.size/l)throw new Error("Invalid indices: "+v+" does not index into "+t.shape);for(var _=0;_<l;_++)h.values[p*l+_]=d[g*l+_]}return h.toTensor().reshape(a)},e.prototype.scatterND=function(t,r,i){var o=wS(0,t,i),s=o.sliceRank,a=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=Dt(0);return this.scatter(t,r,i,c,u,a,s,l,h,!0)},e.prototype.fill=function(t,r,i){var o=lS(i=i||dx(r),St(t));return o.fill(r),fe.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=lS(t.dtype,St(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return kY(t,r,i)},e.prototype.scatter=function(t,r,i,o,s,a,u,l,c,h){var f=[o/s,s],d=this.readSync(t.dataId),p=this.readSync(r.dataId);if(o===0)return Qi([],i,r.dtype);var v=new E1(f,r.dtype);v.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<a;g++){for(var m=[],x=0,_=0;_<u;_++){var b=d[g*u+_];m.push(b),x+=b*l[_]}if(x<0||x>=o/s)throw new Error("Invalid indices: "+m+" does not index into "+i);for(var S=0;S<s;S++)h?v.values[x*s+S]+=p[g*s+S]:v.values[x*s+S]=r.rank===0?p[0]:p[g*s+S]}return v.toTensor().reshape(i)},e}(AY);function IK(n,e){return{kernelName:n,backendName:"cpu",kernelFunc:function(t){var r=t.inputs,i=t.backend,o=r,s=o.a,a=o.b,u=i;qe([s,a],n);var l=u.data.get(s.dataId).values,c=u.data.get(a.dataId).values,h=e(s.shape,a.shape,l,c,s.dtype),f=h[0],d=h[1];return{dataId:u.write(f,d,s.dtype),shape:d,dtype:s.dtype}}}}function PK(n){return function(e,t,r,i,o){var s=En(e,t),a=s.length,u=la(s),l=Zv(o,St(s)),c=e.length,h=t.length,f=la(e),d=la(t),p=wh(e,s),v=wh(t,s);if(p.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],i[g%i.length]);else{var m=function(x){var _=tY(x,a,u),b=_.slice(-c);p.forEach(function(R){return b[R]=0});var S=d4(b,c,f),E=_.slice(-h);v.forEach(function(R){return E[R]=0});var C=d4(E,h,d);l[x]=n(r[S],i[C])};for(g=0;g<l.length;++g)m(g)}return[l,s]}}fe.registerBackend("cpu",function(){return new xIe},1);var wIe=PK(function(n,e){return n/e}),_Ie=IK(VE,wIe),bIe={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,s=o.filterSize,a=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;qe(i,"MaxPoolWithArgmax");var h=c.data.get(i.dataId).values,f=Qd(i.shape,s,a,[1,1],u),d=function(x,_,b,S,E){var C=b4(x,0,b,la(_),E,"max"),R=AK(x,_,b,E,!0,S);return[C.values,R.values]}(h,i.shape,i.dtype,l,f),p=d[0],v=d[1],g=c.write(p,f.outShape,i.dtype),m=c.write(v,f.outShape,i.dtype);return[{dataId:g,shape:f.outShape,dtype:i.dtype},{dataId:m,shape:f.outShape,dtype:"int32"}]}},SIe={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,f=t;qe(o,"NonMaxSuppressionWithScore");var d=YD(f.data.get(o.dataId).values,f.data.get(s.dataId).values,u,l,c,h);return[d.selectedIndices,d.selectedScores]}},EIe={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;qe(r,"square");for(var o=i.data.get(r.dataId).values,s=new Float32Array(o.length),a=0;a<o.length;++a){var u=o[a];s[a]=u*u}return{dataId:i.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},CIe=PK(function(n,e){var t=n-e;return t*t});function kK(n,e,t,r,i){for(var o=St(e),s=e.length,a=la(e),u=la(i),l=Zv(t,St(i)),c=0;c<o;++c){for(var h=tY(c,s,a),f=new Array(h.length),d=0;d<f.length;d++)f[d]=h[r[d]];l[d4(f,s,u)]=n[c]}return l}for(var KT=0,p8=[SIe,EIe,IK(WE,CIe),_Ie,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t.perm,s=r;qe(i,"transpose");for(var a=i.shape.length,u=new Array(a),l=0;l<u.length;l++)u[l]=i.shape[o[l]];var c=kK(s.data.get(i.dataId).values,i.shape,i.dtype,o,u);return{dataId:s.write(c,u,i.dtype),shape:u,dtype:i.dtype}}},bIe];KT<p8.length;KT++)qq(p8[KT]);var um,MIe=function(n){this.variableNames=["A"];var e=To(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},TIe=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=To(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `},RIe=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=pr(this.rank),o=function(s){var a=s.length;if(a>6)throw Error("Transpose for rank "+a+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(a),c=0;c<s.length;c++)l[s[c]]=u[c];return l.join()}(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},AIe=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=pr(this.rank),o=OY("rc",this.rank),s=new Array(this.rank);for(r=0;r<e.length;r++)s[e[r]]=o[r];var a="vec2("+s.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+s.join()+"), "+a+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `};for(var ZT=0,m8=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,o=r.numChannels,s=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=s?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],f=[c,l,o];(a||s)&&(um==null&&(um=document.createElement("canvas").getContext("2d")),um.canvas.width=l,um.canvas.height=c,um.drawImage(i,0,0,l,c),i=um.canvas);var d=t.makeTensorInfo(h,"int32");t.texData.get(d.dataId).usage=ra.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),i);var p=je().getBool("WEBGL_PACK")?new TIe(f):new MIe(f),v=t.runWebGLProgram(p,[d],"int32");return t.disposeData(d.dataId),v}},{kernelName:VE,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e;return function(i,o,s){var a=new Wr(UMe,i.shape,o.shape);return je().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(a=new Xu(zMe,i.shape,o.shape,!0)),s.runWebGLProgram(a,[i,o],"float32")}(r.a,r.b,t)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;dS("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,s=i.scores,a=r,u=a.maxOutputSize,l=a.iouThreshold,c=a.scoreThreshold,h=a.softNmsSigma,f=t,d=YD(f.readSync(o.dataId),f.readSync(s.dataId),u,l,c,h);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,o=new un(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:WE,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,s=t,a=je().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xu("return (a - b) * (a - b);",i.shape,o.shape):new Wr("return (a - b) * (a - b);",i.shape,o.shape);return s.compileAndRun(a,[i,o])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var e,t=n.inputs,r=n.attrs,i=n.backend,o=t.x,s=r.perm,a=i,u=o.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=o.shape[s[c]];if(a.shouldExecuteOnCPU([o])){var h=kK(a.texData.get(o.dataId).values,o.shape,o.dtype,s,l);e=a.makeTensorInfo(l,o.dtype),a.texData.get(e.dataId).values=h}else e=function(f,d,p){var v=je().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AIe(f.shape,d):new RIe(f.shape,d);return p.runWebGLProgram(v,[f],f.dtype)}(o,s,a);return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,s=o.filterSize,a=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;ee(i.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."});var h=[1,1];ee(es(a,h),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+h+"'"});var f=Qd(i.shape,s,a,h,u),d=function(p,v,g,m){var x=new yy(g,"max",!1),_=m.runWebGLProgram(x,[p],"float32");return x=new yy(g,"max",!0,!0,v),[_,m.runWebGLProgram(x,[p],"float32")]}(i,l,f,c);return[d[0],d[1]]}}];ZT<m8.length;ZT++)qq(m8[ZT]);for(var QT=0,v8=[{kernelName:mY,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=En(t.shape,r.shape);return{a:function(){var o=n,s=Ei(t.shape,i);return s.length>0&&(o=o.sum(s)),o.reshape(t.shape)},b:function(){var o=n,s=Ei(r.shape,i);return s.length>0&&(o=o.sum(s)),o.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,i){t[i]=function(){return n.clone()}}),t}},{kernelName:vY,gradFunc:function(n,e,t){for(var r=t,i=r.inputShape,o=r.shape,s=Array.from(o),a=i.length-1;a>=0;a--)if(i[a]===o[a])s[a]=1;else if(i[a]!==1)throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+o+"].");var u=[];for(a=0;a<s.length;a++)s[a]>1&&u.push(a);return{x:function(){return n.sum(u,!0)}}}},{kernelName:VE,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=En(t.shape,r.shape);return{a:function(){var o=Jh(n,r.toFloat()),s=Ei(t.shape,i);return s.length>0?ah(o,s).reshape(t.shape):o},b:function(){var o=n.mul(t.toFloat()),s=Ei(r.shape,i);s.length>0&&(o=ah(o,s).reshape(r.shape));var a=oK(r);return GD(Jh(o,a.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,i=e[0],o=e[1],s=e[2],a=e[3],u=qY(i),l=a??Dt(1),c=Ei(o.shape,u.shape),h=[];if(o.rank===1){for(var f=0;f<u.shape.length-1;++f)h.push(u.shape[f]);h.push(1)}var d=Su(i,o),p=Hr(n,l),v=_Y(Ya(s,Dt(r))),g=Hr(Hr(Hr(v,v),v),Dt(-.5));return{x:function(){return o.rank===1?Xl(Hr(Hr(n,_v(v.as4D(1,1,1,o.shape[0]),h)),l),i.shape):Xl(Hr(Hr(n,v),l),i.shape)},mean:function(){var m=Hr(Hr(v,Dt(-1)),p);return o.rank===1&&(m=ah(m,c)),Xl(m,o.shape)},variance:function(){var m=Hr(Hr(g,d),p);return o.rank===1&&(m=ah(m,c)),Xl(m,o.shape)},scale:function(){var m=Hr(d,v),x=Hr(n,m);return o.rank===1&&(x=ah(x,c)),Xl(x,o.shape)},offset:function(){var m=n;return o.rank===1&&(m=ah(m,c)),Xl(m,o.shape)}}}},{kernelName:yY,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:gY,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return Gr(t.shape,"float32")}}}},{kernelName:wY,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.paddings.map(function(o){return o[0]});return{x:function(){return n.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:WE,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=Dt(2);return{a:function(){return Hr(n,Hr(i,Su(t,r)))},b:function(){return Hr(n,Hr(i,Su(r,t)))}}}},{kernelName:xY,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.reps;return{x:function(){var o=Dn(r);if(r.rank===1)for(var s=0;s<i[0];++s)o=o.add(n.slice([s*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(s=0;s<i[0];++s)for(var a=0;a<i[1];++a)o=o.add(n.slice([s*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(s=0;s<i[0];++s)for(a=0;a<i[1];++a)for(var u=0;u<i[2];++u)o=o.add(n.slice([s*r.shape[0],a*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(r.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(s=0;s<i[0];++s)for(a=0;a<i[1];++a)for(u=0;u<i[2];++u)for(var l=0;l<i[3];++l)o=o.add(n.slice([s*r.shape[0],a*r.shape[1],u*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return o}}}},{kernelName:"Transpose",gradFunc:function(n,e,t){var r=WD(t.perm);return{x:function(){return du(n,r)}}}}];QT<v8.length;QT++)mCe(v8[QT]);var IIe=function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n}();je().get("IS_BROWSER")&&je().setPlatform("browser",new IIe);var JT,PIe=function(){return require("node-fetch")},kIe=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return je().global.fetch!=null?je().global.fetch(e,t):(JT==null&&(JT=PIe()),JT(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n}();je().get("IS_NODE")&&je().setPlatform("node",new kIe);var S4={float32:4,int32:4,uint16:2,uint8:1,bool:1},MS=4;function DK(n,e){for(var t={},r=0,i=function(a){var u=a.name,l=a.dtype,c=a.shape,h=St(c),f=void 0;if("quantization"in a){var d=a.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+a.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=S4[d.dtype],v=n.slice(r,r+h*p),g=d.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(l==="float32")f=Float32Array.from(g,function(E){return E*d.scale+d.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(g,function(E){return Math.round(E*d.scale+d.min)})}r+=h*p}else if(l==="string"){var m=St(a.shape);f=[];for(var x=0;x<m;x++){var _=new Uint32Array(n.slice(r,r+MS))[0];r+=MS;var b=new Uint8Array(n.slice(r,r+_));f.push(b),r+=_}}else{var S=S4[l];if(v=n.slice(r,r+h*S),l==="float32")f=new Float32Array(v);else if(l==="int32")f=new Int32Array(v);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(v)}r+=h*S}t[u]=Qi(f,c,l)},o=0,s=e;o<s.length;o++)i(s[o]);return t}function DIe(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach(function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(e),i=0;return t.forEach(function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength}),r.buffer}var E4=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function g8(n){return E4?Buffer.byteLength(n):new Blob([n]).size}function fN(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function y8(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function xx(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:g8(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:g8(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var ia=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var s=o(e,r);s!==null&&i.push(s)}),i},n}(),bv="://",Fh=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){ee(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(bv)&&(e=e.slice(0,e.indexOf(bv))),ee(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();ee(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function q_(n){if(n.indexOf(bv)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Fh.getSchemes().join(","));return{scheme:n.split(bv)[0],path:n.split(bv)[1]}}function x8(n,e,t){return t===void 0&&(t=!1),Et(this,void 0,void 0,function(){var r,i,o,s,a,u,l,c,h;return Ct(this,function(f){switch(f.label){case 0:return ee(n!==e,function(){return"Old path and new path are the same: '"+n+"'"}),ee((r=ia.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),ee(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),i=r[0],ee((o=ia.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),ee(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),s=o[0],a=q_(n).scheme,u=q_(n).path,l=a===q_(n).scheme,[4,i.load()];case 1:return c=f.sent(),t&&l?[4,Fh.getManager(a).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,s.save(c)];case 4:return h=f.sent(),!t||l?[3,6]:[4,Fh.getManager(a).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var xd="models_store",_h="model_info_store";function NK(){if(!je().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function C4(n){var e=n.result;e.createObjectStore(xd,{keyPath:"modelPath"}),e.createObjectStore(_h,{keyPath:"modelPath"})}var Sv=function(){function n(e){if(this.indexedDB=NK(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Et(this,void 0,void 0,function(){return Ct(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var s=r.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return C4(s)},s.onsuccess=function(){var a=s.result;if(t==null){var u=a.transaction(xd,"readonly"),l=u.objectStore(xd).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return a.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(v){return a.close(),o(l.error)},u.oncomplete=function(){return a.close()}}else{var c,h=xx(t),f=a.transaction(_h,"readwrite"),d=f.objectStore(_h),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:h});p.onsuccess=function(){var v=(c=a.transaction(xd,"readwrite")).objectStore(xd).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});v.onsuccess=function(){return i({modelArtifactsInfo:h})},v.onerror=function(g){var m=(d=f.objectStore(_h)).delete(r.modelPath);m.onsuccess=function(){return a.close(),o(v.error)},m.onerror=function(x){return a.close(),o(v.error)}}},p.onerror=function(v){return a.close(),o(p.error)},f.oncomplete=function(){c==null?a.close():c.oncomplete=function(){return a.close()}}}},s.onerror=function(a){return o(s.error)}})},n.URL_SCHEME="indexeddb://",n}(),w8=function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Sv.URL_SCHEME)?(e=n.slice(Sv.URL_SCHEME.length),new Sv(e)):null;var e};ia.registerSaveRouter(w8),ia.registerLoadRouter(w8);var NIe=function(){function n(){this.indexedDB=NK()}return n.prototype.listModels=function(){return Et(this,void 0,void 0,function(){var e=this;return Ct(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return C4(o)},o.onsuccess=function(){var s=o.result,a=s.transaction(_h,"readonly"),u=a.objectStore(_h).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return s.close(),i(u.error)},a.oncomplete=function(){return s.close()}},o.onerror=function(s){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return Et(this,void 0,void 0,function(){var t=this;return Ct(this,function(r){var i;return e=(i=e).startsWith(Sv.URL_SCHEME)?i.slice(Sv.URL_SCHEME.length):i,[2,new Promise(function(o,s){var a=t.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return C4(a)},a.onsuccess=function(){var u,l=a.result,c=l.transaction(_h,"readwrite"),h=c.objectStore(_h),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),s(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var d=h.delete(e),p=function(){var v=(u=l.transaction(xd,"readwrite")).objectStore(xd).delete(e);v.onsuccess=function(){return o(f.result.modelArtifactsInfo)},v.onerror=function(g){return s(f.error)}};d.onsuccess=p,d.onerror=function(v){return p(),l.close(),s(f.error)}},f.onerror=function(d){return l.close(),s(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},a.onerror=function(u){return s(a.error)}})]})})},n}();if(je().getBool("IS_BROWSER"))try{Fh.registerManager(Sv.URL_SCHEME,new NIe)}catch{}var Zl="/",Em="tensorflowjs_models",LK="info",LIe="model_topology",FIe="weight_specs",OIe="weight_data",BIe="model_metadata";function FK(n){return{info:[Em,n,LK].join(Zl),topology:[Em,n,LIe].join(Zl),weightSpecs:[Em,n,FIe].join(Zl),weightData:[Em,n,OIe].join(Zl),modelMetadata:[Em,n,BIe].join(Zl)}}function UIe(n){var e=n.split(Zl);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Zl)}var Ev=function(){function n(e){if(!je().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=FK(this.modelPath)}return n.prototype.save=function(e){return Et(this,void 0,void 0,function(){var t,r,i;return Ct(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=xx(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(s){if(E4)return Buffer.from(s).toString("base64");for(var a=new Uint8Array(s),u="",l=0,c=a.length;l<c;l++)u+=String.fromCharCode(a[l]);return btoa(u)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return Et(this,void 0,void 0,function(){var e,t,r,i,o,s,a;return Ct(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(s=JSON.parse(o),t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,t.userDefinedMetadata=s.userDefinedMetadata),(a=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(l){if(E4){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),d=0;d<h.length;++d)f.set([h.charCodeAt(d)],d);return f.buffer}(a),[2,t]})})},n.URL_SCHEME="localstorage://",n}(),_8=function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ev.URL_SCHEME)?(e=n.slice(Ev.URL_SCHEME.length),new Ev(e)):null;var e};ia.registerSaveRouter(_8),ia.registerLoadRouter(_8);var zIe=function(){function n(){ee(je().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ee(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Et(this,void 0,void 0,function(){var e,t,r,i,o,s;return Ct(this,function(a){for(e={},t=Em+Zl,r=Zl+LK,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(s=UIe(o),e[s]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return Et(this,void 0,void 0,function(){var t,r;return Ct(this,function(i){var o;if(e=(o=e).startsWith(Ev.URL_SCHEME)?o.slice(Ev.URL_SCHEME.length):o,t=FK(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n}();if(je().getBool("IS_BROWSER"))try{Fh.registerManager(Ev.URL_SCHEME,new zIe)}catch{}var VIe="model",WIe=".json",HIe=".weights.bin";function b8(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var eR=function(){function n(e){if(!je().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=VIe),this.modelTopologyFileName=e+WIe,this.weightDataFileName=e+HIe}return n.prototype.save=function(e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a;return Ct(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(s=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,s.href=o,[4,b8(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=t,[4,b8(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:xx(e)}]}})})},n.URL_SCHEME="downloads://",n}(),GIe=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return Et(this,void 0,void 0,function(){var e,t,r=this;return Ct(this,function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise(function(o,s){var a=new FileReader;a.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,t)}catch(g){return void s(g)}var d=[],p=[],v=[];h.forEach(function(g){g.paths.forEach(function(m){p.push(m),v.push(null)}),d.push.apply(d,g.weights)}),h.forEach(function(g){g.paths.forEach(function(m){var x=new FileReader;x.onload=function(_){var b=_.target.result,S=p.indexOf(m);v[S]=b,v.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:d,weightData:fN(v),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(_){return s("Failed to weights data from file of path '"+m+"'.")},x.readAsArrayBuffer(f[m])})})}else s(new Error("weightManifest field is missing from file "+e.name))}else s(new Error("modelTopology field is missing from file "+e.name))},a.onerror=function(u){return s("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(e)})]})})},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map(function(u){return y8(u.name)}),o={},s=0,a=e;s<a.length;s++)a[s].paths.forEach(function(u){var l=y8(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=t[i.indexOf(l)]});if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n}();function S8(n,e,t,r){(function(o){ee(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,s){ee(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),ee(s>=0&&s<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+s}),ee(s>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+s})}(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(s){var a=t+ ++i/n.length*(r-t);return e(a),s}),o}))}function OK(n,e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c;return Ct(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?je().platform.fetch:e.fetchFunc,r=n.map(function(f){return t(f,e.requestInit,{isBinary:!0})}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=h.sent(),[3,4];case 2:return[4,S8(r,e.onProgress,i,o)];case 3:s=h.sent(),h.label=4;case 4:return a=s.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(a)];case 5:return c=h.sent(),[3,8];case 6:return[4,S8(a,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}function E8(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),Et(e,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,p;return Ct(this,function(v){switch(v.label){case 0:if(o=t.map(function(){return!1}),s={},a=i!=null?i.map(function(){return!1}):[],u=[],t.forEach(function(g,m){var x=0;g.weights.forEach(function(_){var b="quantization"in _?_.quantization.dtype:_.dtype,S=S4[b]*St(_.shape),E=function(){o[m]=!0,s[m]==null&&(s[m]=[]),s[m].push({manifestEntry:_,groupOffset:x,sizeBytes:S})};i!=null?i.forEach(function(C,R){C===_.name&&(E(),a[R]=!0)}):E(),u.push(_.name),x+=S})}),!a.every(function(g){return g}))throw l=i.filter(function(g,m){return!a[m]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(g,m,x){return m&&g.push(x),g},[]),h=[],c.forEach(function(g){t[g].paths.forEach(function(m){var x=r+(r.endsWith("/")?"":"/")+m;h.push(x)})}),[4,n(h)];case 1:return f=v.sent(),d={},p=0,c.forEach(function(g){for(var m=t[g].paths.length,x=0,_=0;_<m;_++)x+=f[p+_].byteLength;for(var b=new ArrayBuffer(x),S=new Uint8Array(b),E=0,C=0;C<m;C++){var R=new Uint8Array(f[p+C]);S.set(R,E),E+=R.byteLength}s[g].forEach(function(T){var A=DK(b.slice(T.groupOffset,T.groupOffset+T.sizeBytes),[T.manifestEntry]);for(var P in A)d[P]=A[P]}),p+=m}),[2,d]}})})}}ia.registerSaveRouter(function(n){return je().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(eR.URL_SCHEME)?function(e){return e===void 0&&(e="model"),new eR(e)}(n.slice(eR.URL_SCHEME.length)):null});var BK=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(ee(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=je().platform.fetch,ee(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&ee(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Et(this,void 0,void 0,function(){var t,r,i,o;return Ct(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=s.sent()).ok)return[2,{modelArtifactsInfo:xx(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return Et(this,void 0,void 0,function(){var e,t,r,i,o,s,a,u,l,c,h,f;return Ct(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,e.json()];case 3:return t=d.sent(),[3,5];case 4:throw d.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,s=t.generatedBy,a=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=d.sent(),c=f[0],h=f[1],d.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:s,convertedBy:a,format:u}]}})})},n.prototype.loadWeights=function(e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h,f;return Ct(this,function(d){switch(d.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=function(p){var v=p.lastIndexOf("/"),g=p.lastIndexOf("?"),m=p.substring(0,v),x=g>v?p.substring(g):"";return[m+"/",x]}(t),i=r[0],o=r[1],s=this.weightPathPrefix||i,a=[],u=0,l=e;u<l.length;u++)c=l[u],a.push.apply(a,c.weights);return h=[],e.forEach(function(p){p.paths.forEach(function(v){h.push(s+v+o)})}),[4,OK(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[a,fN(f)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function M4(n){return n.match(BK.URL_SCHEME_REGEX)!=null}var C8=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(t){return M4(t)}):M4(n))?T4(n,{onProgress:e}):null};function T4(n,e){return new BK(n,e)}ia.registerSaveRouter(C8),ia.registerLoadRouter(C8);var tR=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(e){return[2,this.modelArtifacts]})})},n}(),$Ie=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return Et(this,void 0,void 0,function(){return Ct(this,function(t){return[2,this.saveHandler(e)]})})},n}(),UK=Object.freeze({browserFiles:function(n){return new GIe(n)},browserHTTPRequest:function(n,e){return T4(n,e)},concatenateArrayBuffers:fN,decodeWeights:DK,encodeWeights:function(n,e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return Ct(this,function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),o=function(l){var c=i[l],h=Array.isArray(n)?n[l].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var f={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(p){return Et(a,void 0,void 0,function(){var v,g,m,x,_,b,S;return Ct(this,function(E){switch(E.label){case 0:return[4,h.bytes()];case 1:for(v=E.sent(),g=v.reduce(function(C,R){return C+R.length},0)+MS*v.length,m=new Uint8Array(g),x=0,_=0;_<v.length;_++)b=v[_],S=new Uint8Array(new Uint32Array([b.length]).buffer),m.set(S,x),x+=MS,m.set(b,x),x+=b.length;return p(m),[2]}})})});r.push(d)}else r.push(h.data());e!=null&&(f.group=e),t.push(f)},s=0;s<i.length;++s)o(s);return[4,Promise.all(r)];case 1:return[2,{data:DIe(u.sent()),specs:t}]}})})},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new tR(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tR({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new tR({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return ia.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:xx,getSaveHandlers:function(n){return ia.getSaveHandlers(n)},http:T4,isHTTPScheme:M4,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),Et(this,void 0,void 0,function(){return Ct(this,function(i){return[2,E8(function(o){return OK(o,{requestInit:r})})(n,e,t)]})})},registerLoadRouter:function(n){return ia.registerLoadRouter(n)},registerSaveRouter:function(n){return ia.registerSaveRouter(n)},weightsLoaderFactory:E8,withSaveHandler:function(n){return new $Ie(n)},copyModel:function(n,e){return Et(this,void 0,void 0,function(){return Ct(this,function(t){return[2,x8(n,e,!1)]})})},listModels:function(){return Et(this,void 0,void 0,function(){var n,e,t,r,i,o,s;return Ct(this,function(a){switch(a.label){case 0:n=Fh.getSchemes(),e={},t=0,r=n,a.label=1;case 1:return t<r.length?(i=r[t],[4,Fh.getManager(i).listModels()]):[3,4];case 2:for(s in o=a.sent())e[i+bv+s]=o[s];a.label=3;case 3:return t++,[3,1];case 4:return[2,e]}})})},moveModel:function(n,e){return Et(this,void 0,void 0,function(){return Ct(this,function(t){return[2,x8(n,e,!0)]})})},removeModel:function(n){return Et(this,void 0,void 0,function(){var e;return Ct(this,function(t){return e=q_(n),[2,Fh.getManager(e.scheme).removeModel(e.path)]})})}}),lm;ue({confusionMatrix_:function(n,e,t){var r=Y(n,"labels","confusionMatrix"),i=Y(e,"predictions","confusionMatrix");ee(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),ee(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),ee(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),ee(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),ee(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=ES(r.asType("int32"),t),s=ES(i.asType("int32"),t);return o.transpose().matMul(s).asType("int32")}});var jIe=ue({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);s=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Xq("FromPixels",fe.backendName)!=null)return fe.runKernel("FromPixels",{pixels:n},{numChannels:e});var a,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],h=l[1];if(s?a=n.getContext("2d").getImageData(0,0,c,h).data:r||t?a=n.data:(o||i)&&(lm==null&&(lm=document.createElement("canvas").getContext("2d")),lm.canvas.width=c,lm.canvas.height=h,lm.drawImage(n,0,0,c,h),a=lm.getImageData(0,0,c,h).data),e===4)u=new Int32Array(a);else{var f=c*h;u=new Int32Array(f*e);for(var d=0;d<f;d++)for(var p=0;p<e;++p)u[d*e+p]=a[4*d+p]}return uY(u,[h,c,e],"int32")}}),zK=Object.freeze({toPixels:function(n,e){return Et(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R;return Ct(this,function(T){switch(T.label){case 0:if(t=Y(n,"img","toPixels"),n instanceof cr||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(s=t.rank===2?1:t.shape[2])>4||s===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,t.data()];case 1:return a=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],d=h[0],p=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(d<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(d<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+p+"].")}for(v=t.dtype==="float32"?255:1,g=new Uint8ClampedArray(o*i*4),m=0;m<i*o;++m)x=void 0,_=void 0,b=void 0,S=void 0,s===1?(x=a[m]*v,_=a[m]*v,b=a[m]*v,S=255):s===3?(x=a[3*m]*v,_=a[3*m+1]*v,b=a[3*m+2]*v,S=255):s===4&&(x=a[4*m]*v,_=a[4*m+1]*v,b=a[4*m+2]*v,S=a[4*m+3]*v),g[(E=4*m)+0]=Math.round(x),g[E+1]=Math.round(_),g[E+2]=Math.round(b),g[E+3]=Math.round(S);return e!=null&&(e.width=o,e.height=i,C=e.getContext("2d"),R=new ImageData(g,o,i),C.putImageData(R,0,0)),t!==n&&t.dispose(),[2,g]}})})},fromPixels:jIe}),XIe=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),qIe=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function mp(n){ee(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),ee(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),ee(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),qIe.register(n)}var vp=function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Du(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),s=o.value,a=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:a[l.name]}});this.applyGradients(u)}else this.applyGradients(a);return Rs(a),r?s:(s.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return vMe(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Rs(this.iterations_)},e.prototype.saveIterations=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Dt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Et(this,void 0,void 0,function(){var r;return Ct(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e}(XIe);Object.defineProperty(vp,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var YIe=function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=fe.backend.epsilon()),o}return Du(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=fe.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Xn(function(){return Dn(s).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Xn(function(){return Dn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;Xn(function(){var c=u.mul(r.rho).add(a.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(a),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var d=h.mul(-r.learningRate).add(s);s.assign(d)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Rs(this.accumulatedGrads.map(function(t){return t.variable})),Rs(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){var t;return Ct(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){var r;return Ct(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e}(vp);mp(YIe);var KIe=function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Du(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=fe.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Xn(function(){return Od(s.shape,r.initialAccumulatorValue).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedGrads[o].variable;Xn(function(){var l=u.add(a.square());u.assign(l);var c=a.div(l.add(fe.backend.epsilon()).sqrt()).mul(-r.learningRate).add(s);s.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Rs(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e}(vp);mp(KIe);var ZIe=function(n){function e(t,r,i,o){o===void 0&&(o=null);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.accumulatedFirstMoment=[],s.accumulatedSecondMoment=[],Xn(function(){s.accBeta1=Dt(r).variable(),s.accBeta2=Dt(i).variable()}),o==null&&(s.epsilon=fe.backend.epsilon()),s}return Du(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Xn(function(){var o=Su(1,r.accBeta1),s=Su(1,r.accBeta2);i.forEach(function(a,u){var l=fe.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Xn(function(){return Dn(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:a+"/v",variable:Xn(function(){return Dn(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),v=d.div(o),g=p.div(s);h.assign(d),f.assign(p);var m=v.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Rs(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Rs(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){var t;return Ct(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){var r,i=this;return Ct(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Xn(function(){i.accBeta1.assign(xS(i.beta1,i.iterations_+1)),i.accBeta2.assign(xS(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e}(vp);mp(ZIe);var QIe=function(n){function e(t,r,i,o,s){o===void 0&&(o=null),s===void 0&&(s=0);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.decay=s,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Xn(function(){a.iteration=Dt(0).variable(),a.accBeta1=Dt(r).variable()}),o==null&&(a.epsilon=fe.backend.epsilon()),a}return Du(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Xn(function(){var o=Su(1,r.accBeta1),s=Jh(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(a,u){var l=fe.registeredVariables[a];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:a+"/m",variable:Dn(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:a+"/v",variable:Dn(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[a];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,d=h.mul(r.beta1).add(c.mul(1-r.beta1)),p=f.mul(r.beta2),v=c.abs(),g=p.maximum(v);h.assign(d),f.assign(g);var m=s.div(o).mul(d.div(g.add(r.epsilon))).add(l);l.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Rs(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Rs(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e}(vp);mp(QIe);var VK=function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Du(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var a=fe.registeredVariables[i];Xn(function(){var u=r.c.mul(s).add(a);a.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=s3e(Dt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e}(vp);mp(VK);var JIe=function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Dt(o.momentum),o}return Du(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=fe.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:Xn(function(){return Dn(s).variable(!1)})});var a=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&Xn(function(){var l,c=r.m.mul(a).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(s):r.c.mul(c).add(s),a.assign(c),s.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Rs(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){return Ct(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){return Ct(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e}(VK);mp(JIe);var e4e=function(n){function e(t,r,i,o,s){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),s===void 0&&(s=!1);var a=n.call(this)||this;if(a.learningRate=t,a.decay=r,a.momentum=i,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=s,o==null&&(a.epsilon=fe.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Du(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var s=fe.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Xn(function(){return Dn(s).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:Xn(function(){return Dn(s).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Xn(function(){return Dn(s).variable(!1)})});var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;Xn(function(){var c=u.mul(r.decay).add(a.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,f=h.mul(r.decay).add(a.mul(1-r.decay)),d=l.mul(r.momentum).add(a.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(d);var p=s.sub(d);s.assign(p)}else{var v=u.mul(r.decay).add(a.square().mul(1-r.decay));d=l.mul(r.momentum).add(a.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),l.assign(d),p=s.sub(d),s.assign(p)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Rs(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Rs(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Rs(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Et(this,void 0,void 0,function(){var t;return Ct(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Et(this,void 0,void 0,function(){var r;return Ct(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e}(vp);mp(e4e);cr.prototype.add=function(n){return Ya(this,n)},cr.prototype.broadcastTo=function(n){return JY(this,n)},cr.prototype.div=function(n){return Jh(this,n)},cr.prototype.divNoNan=function(n){return nK(this,n)},cr.prototype.squaredDifference=function(n){return sK(this,n)},cr.prototype.tile=function(n){return _v(this,n)},cr.prototype.oneHot=function(n,e,t){return e===void 0&&(e=1),t===void 0&&(t=0),ES(this,n,e,t)},cr.prototype.transpose=function(n){return du(this,n)},cr.prototype.pad=function(n,e){return Ic(this,n,e)},cr.prototype.batchNorm=function(n,e,t,r,i){return gx(this,n,e,t,r,i)},Ge=yIe;var Cv=function(){function n(e,t){if(!Bd(e)||!Bd(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}(),Gn=function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}();function KE(n,e){return n instanceof cr&&n.shape.length===e}function t4e(n){return KE(n,2)}function ZE(n){return KE(n,3)}function Oh(n){return KE(n,4)}function n4e(n){return n%1!==0}function M8(n){return n%2===0}function dN(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function T8(n){return n&&n.width&&n.height}function r4e(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Cv(Math.round(t*i),Math.round(r*i))}function pN(n){return n.reduce(function(e,t){return e.add(t)},new Gn(0,0)).div(new Gn(n.length,n.length))}function M1(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Bd(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function R8(n){return Bd(n)&&0<=n&&n<=1}var _l=function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Bd),o=[r.x,r.y,r.width,r.height].every(Bd);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var s=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],a=s[0],u=s[1],l=s[2],c=s[3];n.assertIsValidBox({x:a,y:u,width:l,height:c},"Box.constructor",t),this._x=a,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Bd)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Gn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Gn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Gn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Gn(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.round(s)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(s){return Math.floor(s)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,s=Math.abs(i-o);return i<o&&(t-=s/2,i+=s),o<i&&(r-=s/2,o+=s),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=T8(e)?e.width:e,r=T8(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],o=r[1],s=r[2],a=r[3];return new n({x:i,y:o,width:s,height:a})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,o=r.y,s=r.right,a=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=s-u,h=a-l,f=Math.min(c,e-u),d=Math.min(h,t-l);return new n({x:u,y:l,width:f,height:d}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,o=r.height,s=this.x+e,a=this.y+t;return new n({x:s,y:a,width:i,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,o=1,s=1,a=r,u=i,l=this.left,c=this.top,h=this.right,f=this.bottom;return h>t&&(a=-h+t+r,h=t),f>e&&(u=-f+e+i,f=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:s,edy:u,dx:o,edx:a,y:c,ey:f,x:l,ex:h,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n}(),QE=function(n){rn(e,n);function e(t,r,i,o,s){return s===void 0&&(s=!1),n.call(this,{left:t,top:r,right:i,bottom:o},s)||this}return e}(_l),A8=function(n){rn(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(_l.assertIsValidBox(t,r),!Bd(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(_l),WK=function(){function n(e,t,r,i,o){this._imageDims=new Cv(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new _l(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new _l(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n}();(function(n){rn(e,n);function e(t,r,i,o){var s=n.call(this,t,r)||this;return s._score=i,s._classScore=o,s}return e.assertIsValidPredictedBox=function(t,r){if(A8.assertIsValidLabeledBox(t,r),!R8(t.score)||!R8(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(A8);var mN=function(n){rn(e,n);function e(t,r,i,o,s){return s===void 0&&(s=!1),n.call(this,{x:t,y:r,width:i,height:o},s)||this}return e}(_l);function HK(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function GK(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,o){n.readFile(r,function(s,a){return s?o(s):i(a)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function $K(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=GK();return _u({Canvas:n||function(){function s(){}return s}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function s(){}return s}(),Image:e||function(){function s(){}return s}(),ImageData:global.ImageData||function(){function s(){}return s}(),Video:global.HTMLVideoElement||function(){function s(){}return s}(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function jK(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function XK(){return typeof global=="object"&&typeof require=="function"&&typeof IZ<"u"&&typeof process<"u"&&!!process.version}var yi;function i4e(){if(!yi)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return yi}function R4(n){yi=n}function vN(){jK()&&R4(HK()),XK()&&R4($K())}function o4e(n){if(yi||vN(),!yi)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?yi.Canvas:e,r=n.Image,i=r===void 0?yi.Image:r;yi.Canvas=t,yi.Image=i,yi.createCanvasElement=n.createCanvasElement||function(){return new t},yi.createImageElement=n.createImageElement||function(){return new i},yi.ImageData=n.ImageData||yi.ImageData,yi.Video=n.Video||yi.Video,yi.fetch=n.fetch||yi.fetch,yi.readFile=n.readFile||yi.readFile}var No={getEnv:i4e,setEnv:R4,initialize:vN,createBrowserEnv:HK,createFileSystem:GK,createNodejsEnv:$K,monkeyPatch:o4e,isBrowser:jK,isNodejs:XK};vN();function gN(n){return!No.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function bl(n){var e=No.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=gN(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var rc;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(rc||(rc={}));var yN=function(){function n(e){e===void 0&&(e={});var t=e.anchorPosition,r=e.backgroundColor,i=e.fontColor,o=e.fontSize,s=e.fontStyle,a=e.padding;this.anchorPosition=t||rc.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=s||"Georgia",this.padding=a||4}return n}(),xN=function(){function n(e,t,r){r===void 0&&(r={}),this.text=typeof e=="string"?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new yN(r)}return n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,r=e.padding;return this.text.length*t+2*r},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,i=r===rc.BOTTOM_RIGHT||r===rc.TOP_RIGHT,o=r===rc.BOTTOM_LEFT||r===rc.BOTTOM_RIGHT,s=this.measureWidth(e),a=this.measureHeight(),u=i?this.anchor.x-s:this.anchor.x,l=o?this.anchor.y-a:this.anchor.y;if(t){var c=t.width,h=t.height,f=Math.max(Math.min(u,c-s),0),d=Math.max(Math.min(l,h-a),0);return{x:f,y:d}}return{x:u,y:l}},n.prototype.draw=function(e){var t=gN(e),r=bl(t),i=this.options,o=i.backgroundColor,s=i.fontColor,a=i.fontSize,u=i.fontStyle,l=i.padding;r.font=a+"px "+u;var c=this.measureWidth(r),h=this.measureHeight();r.fillStyle=o;var f=this.getUpperLeft(r,t);r.fillRect(f.x,f.y,c,h),r.fillStyle=s,this.text.forEach(function(d,p){var v=l+f.x,g=l+f.y+(p+1)*a;r.fillText(d,v,g)})},n}(),qK=function(){function n(e){e===void 0&&(e={});var t=e.boxColor,r=e.lineWidth,i=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=i;var s={anchorPosition:rc.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new yN(Object.assign({},s,o))}return n}(),YK=function(){function n(e,t){t===void 0&&(t={}),this.box=new _l(e),this.options=new qK(t)}return n.prototype.draw=function(e){var t=bl(e),r=this.options,i=r.boxColor,o=r.lineWidth,s=this.box,a=s.x,u=s.y,l=s.width,c=s.height;t.strokeStyle=i,t.lineWidth=o,t.strokeRect(a,u,l,c);var h=this.options.label;h&&new xN([h],{x:a-o/2,y:u},this.options.drawLabelOptions).draw(e)},n}();const s4e=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return rc},DrawBox:YK,DrawBoxOptions:qK,DrawTextField:xN,DrawTextFieldOptions:yN},Symbol.toStringTag,{value:"Module"}));function Eu(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),Xn(function(){var i=Ya(pp(n,e.filters,[1,1],t),e.bias);return r?qE(i):i})}function kc(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function JE(n,e){return function(t,r,i,o){var s=Ju(n(t*r*i*i),[i,i,t,r]),a=Tu(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:s,bias:a}}}function wN(n,e){return function(t,r,i){var o=Fd(n(t*r),[t,r]),s=Tu(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:s}}}var KK=function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n}();function _N(n,e){return function(t,r,i){var o=Ju(n(9*t),[3,3,t,1]),s=Ju(n(t*r),[1,1,t,r]),a=Tu(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new KK(o,s,a)}}function bN(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new KK(t,r,i)}}function gf(n,e){return function(t,r,i){var o=n[t];if(!KE(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function Dc(n){var e=n;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function ZK(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(a){return a}),o=n.endsWith(".json")?i[i.length-1]:t,s=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return s=n.startsWith("/")?"/"+s:s,{modelBaseUri:s,manifestUri:s==="/"?"/"+o:s+"/"+o}}function QK(n){var e=No.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function a4e(n){return new Promise(function(e,t){if(n instanceof No.getEnv().Canvas||QK(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}function JK(n){var e=No.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Cv(n.naturalWidth,n.naturalHeight):n instanceof r?new Cv(n.videoWidth,n.videoHeight):new Cv(n.width,n.height)}function eC(n){var e=n.width,t=n.height,r=No.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function SN(n,e){var t=No.getEnv().ImageData;if(!(n instanceof t)&&!QK(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=JK(n),i=r.width,o=r.height,s=eC({width:i,height:o});return n instanceof t?bl(s).putImageData(n,0,0):bl(s).drawImage(n,0,0,i,o),s}function u4e(n,e){return Ot(this,void 0,void 0,function(){var t,r;return Bt(this,function(i){switch(i.label){case 0:return t=No.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function l4e(n){return Ot(this,void 0,void 0,function(){return Bt(this,function(e){switch(e.label){case 0:return[4,u4e(n)];case 1:return[2,e.sent().json()]}})})}function c4e(n,e){return Ot(this,void 0,void 0,function(){var t,r,i,o,s,a;return Bt(this,function(u){switch(u.label){case 0:return t=No.getEnv().createCanvasElement(),r=n.shape.slice(Oh(n)?1:0),i=r[0],o=r[1],s=r[2],a=Xn(function(){return n.as3D(i,o,s).toInt()}),[4,zK.toPixels(a,t)];case 1:return u.sent(),a.dispose(),[2,t]}})})}function h4e(n,e,t){t===void 0&&(t=!1);var r=No.getEnv(),i=r.Image,o=r.Canvas;if(!(n instanceof i||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var s=JK(n),a=e/Math.max(s.height,s.width),u=a*s.width,l=a*s.height,c=eC({width:e,height:e}),h=n instanceof o?n:SN(n),f=Math.abs(u-l)/2,d=t&&u<l?f:0,p=t&&l<u?f:0;return bl(c).drawImage(h,d,p,u,l),c}function I8(n){var e=No.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function f4e(n,e){return Ot(this,void 0,void 0,function(){var t,r,i,o;return Bt(this,function(s){switch(s.label){case 0:return t=ZK(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,l4e(r)];case 1:return o=s.sent(),[2,UK.loadWeights(o,i)]}})})}function d4e(n,e){return e===void 0&&(e=!1),Xn(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),s=Math.round(o*(e?.5:1)),a=r>i?2:1,u=function(d){var p=n.shape.slice();return p[a]=d,Od(p,0)},l=u(s),c=o-l.shape[a],h=e&&c?u(c):null,f=[h,n,l].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return qa(f,a)})}var TS=function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(ZE(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(Oh(i)){var s=i.shape[0];if(s!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+s+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var a=i instanceof No.getEnv().Canvas?i:SN(i);r._canvases[o]=a,r._inputDimensions[o]=[a.height,a.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return M1(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return r4e({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,Xn(function(){var i=M1(r.batchSize,0,1).map(function(s){var a=r.getInput(s);if(a instanceof cr){var u=Oh(a)?a:a.expandDims();return u=d4e(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=RK.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(a instanceof No.getEnv().Canvas)return zK.fromPixels(h4e(a,e,t));throw new Error("toBatchTensor - at batchIdx "+s+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+a)}),o=Qh(i.map(function(s){return s.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n}();function Gi(n){return Ot(this,void 0,void 0,function(){var e,t,r;return Bt(this,function(i){switch(i.label){case 0:if(n instanceof TS)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(gN),r.forEach(function(o,s){if(!I8(o)&&!ZE(o)&&!Oh(o))throw typeof e[s]=="string"?new Error("toNetInput -"+t(s)+" string passed, but could not resolve HTMLElement for element id "+e[s]):new Error("toNetInput -"+t(s)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Oh(o)){var a=o.shape[0];if(a!==1)throw new Error("toNetInput -"+t(s)+" tf.Tensor4D with batchSize "+a+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return I8(o)&&a4e(o)}))];case 1:return i.sent(),[2,new TS(r,Array.isArray(n))]}})})}var Nc=function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Qv})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Qv)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=Qi(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return Ot(this,void 0,void 0,function(){return Bt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return Ot(this,void 0,void 0,function(){var t;return Bt(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,f4e(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return Ot(this,void 0,void 0,function(){var t,r,i,o,s,a,u,l,c,h;return Bt(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=No.getEnv().readFile,r=ZK(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,s=function(d){return Promise.all(d.map(function(p){return t(p).then(function(v){return v.buffer})}))},a=UK.weightsLoaderFactory(s),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,a(u,o)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,s){if(!o.nextObj.hasOwnProperty(s))throw new Error("traversePropertyPath - object does not have property "+s+", for path "+e);return{obj:o.nextObj,objProp:s,nextObj:o.nextObj[s]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof cr))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n}();function p4e(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*i;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function T1(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(a,u){return{score:a,boxIndex:u}}).sort(function(a,u){return a.score-u.score}).map(function(a){return a.boxIndex}),o=[],s=function(){var a=i.pop();o.push(a);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],f=n[a],d=n[h];l.push(p4e(f,d,r))}i=i.filter(function(p,v){return l[v]<=t})};i.length>0;)s();return o}function wx(n,e){return Xn(function(){var t=e[0],r=e[1],i=e[2],o=Od(hT(n.shape.slice(0,3),[1]),t),s=Od(hT(n.shape.slice(0,3),[1]),r),a=Od(hT(n.shape.slice(0,3),[1]),i),u=qa([o,s,a],3);return Su(n,u)})}function nR(n){return 1/(1+Math.exp(-n))}var s_=function(n){return typeof n=="number"};function m4e(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!s_(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return s_(e.x)&&s_(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(s_)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function EN(n){return Xn(function(){var e=Hr(n,Dt(.10000000149011612));return Ya(qE(Su(n,e)),e)})}function Qc(n,e){return Xn(function(){var t=Ic(n,[[0,0],[1,1],[1,1],[0,0]]);return t=pp(t,e.conv.filters,[1,1],"valid"),t=Su(t,e.bn.sub),t=Hr(t,e.bn.truediv),t=Ya(t,e.conv.bias),EN(t)})}function Jc(n,e){return Xn(function(){var t=Ic(n,[[0,0],[1,1],[1,1],[0,0]]);return t=mK(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=Ya(t,e.bias),EN(t)})}function v4e(n,e){var t=JE(n,e);function r(s,a){var u=Tu(n(s)),l=Tu(n(s));return e.push({paramPath:a+"/sub"},{paramPath:a+"/truediv"}),{sub:u,truediv:l}}function i(s,a,u){var l=t(s,a,3,u+"/conv"),c=r(a,u+"/bn");return{conv:l,bn:c}}var o=_N(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function g4e(n,e,t,r){var i=Dc(n),o=i.extractWeights,s=i.getRemainingWeights,a=[],u=v4e(o,a),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var d=r[0],p=r[1],v=r[2],g=r[3],m=r[4],x=r[5],_=r[6],b=r[7],S=r[8],E=e.isFirstLayerConv2d?l(d,p,3,"conv0"):h(d,p,"conv0"),C=h(p,v,"conv1"),R=h(v,g,"conv2"),T=h(g,m,"conv3"),A=h(m,x,"conv4"),P=h(x,_,"conv5"),k=b?h(_,b,"conv6"):void 0,W=S?h(b,S,"conv7"):void 0,N=l(S||b||_,5*t,1,"conv8");f={conv0:E,conv1:C,conv2:R,conv3:T,conv4:A,conv5:P,conv6:k,conv7:W,conv8:N}}else{var d=r[0],p=r[1],v=r[2],g=r[3],m=r[4],x=r[5],_=r[6],b=r[7],S=r[8],E=c(d,p,"conv0"),C=c(p,v,"conv1"),R=c(v,g,"conv2"),T=c(g,m,"conv3"),A=c(m,x,"conv4"),P=c(x,_,"conv5"),k=c(_,b,"conv6"),W=c(b,S,"conv7"),N=l(S,5*t,1,"conv8");f={conv0:E,conv1:C,conv2:R,conv3:T,conv4:A,conv5:P,conv6:k,conv7:W,conv8:N}}if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{params:f,paramMappings:a}}function y4e(n,e){var t=gf(n,e);function r(a){var u=t(a+"/sub",1),l=t(a+"/truediv",1);return{sub:u,truediv:l}}function i(a){var u=t(a+"/filters",4),l=t(a+"/bias",1);return{filters:u,bias:l}}function o(a){var u=i(a+"/conv"),l=r(a+"/bn");return{conv:u,bn:l}}var s=bN(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:s}}function x4e(n,e){var t=[],r=y4e(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,s=r.extractSeparableConvParams,a;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;a={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else a={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return kc(n,t),{params:a,paramMappings:t}}var P8;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(P8||(P8={}));var CN=function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),eZ=function(n){rn(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return m4e(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Qc(t,r.conv0);return i=Vs(i,[2,2],[2,2],"same"),i=Qc(i,r.conv1),i=Vs(i,[2,2],[2,2],"same"),i=Qc(i,r.conv2),i=Vs(i,[2,2],[2,2],"same"),i=Qc(i,r.conv3),i=Vs(i,[2,2],[2,2],"same"),i=Qc(i,r.conv4),i=Vs(i,[2,2],[2,2],"same"),i=Qc(i,r.conv5),i=Vs(i,[2,2],[1,1],"same"),i=Qc(i,r.conv6),i=Qc(i,r.conv7),Eu(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?EN(Eu(t,r.conv0,"valid",!1)):Jc(t,r.conv0);return i=Vs(i,[2,2],[2,2],"same"),i=Jc(i,r.conv1),i=Vs(i,[2,2],[2,2],"same"),i=Jc(i,r.conv2),i=Vs(i,[2,2],[2,2],"same"),i=Jc(i,r.conv3),i=Vs(i,[2,2],[2,2],"same"),i=Jc(i,r.conv4),i=Vs(i,[2,2],[2,2],"same"),i=Jc(i,r.conv5),i=Vs(i,[2,2],[1,1],"same"),i=r.conv6?Jc(i,r.conv6):i,i=r.conv7?Jc(i,r.conv7):i,Eu(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return Xn(function(){var s=t.toBatchTensor(r,!1).toFloat();return s=i.config.meanRgb?wx(s,i.config.meanRgb):s,s=s.div(Dt(256)),i.config.withSeparableConvs?i.runMobilenet(s,o):i.runTinyYolov2(s,o)})},e.prototype.forward=function(t,r){return Ot(this,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Gi(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),Ot(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,p,v,g,m,x=this;return Bt(this,function(_){switch(_.label){case 0:return i=new CN(r),o=i.inputSize,s=i.scoreThreshold,[4,Gi(t)];case 1:return a=_.sent(),[4,this.forwardInput(a,o)];case 2:return u=_.sent(),l=Xn(function(){return zE(u)[0].expandDims()}),c={width:a.getInputWidth(0),height:a.getInputHeight(0)},[4,this.extractBoxes(l,a.getReshapedInputDimensions(0),s)];case 3:return h=_.sent(),u.dispose(),l.dispose(),f=h.map(function(b){return b.box}),d=h.map(function(b){return b.score}),p=h.map(function(b){return b.classScore}),v=h.map(function(b){return x.config.classes[b.label]}),g=T1(f.map(function(b){return b.rescale(o)}),d,this.config.iouThreshold,!0),m=g.map(function(b){return new WK(d[b],p[b],v[b],f[b],c)}),[2,m]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return x4e(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return g4e(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return Ot(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R,T,A,P,k,W,N,O,z,V,F=this;return Bt(this,function(U){switch(U.label){case 0:return o=r.width,s=r.height,a=Math.max(o,s),u=a/o,l=a/s,c=t.shape[1],h=this.config.anchors.length,f=Xn(function(){var L=t.reshape([c,c,h,F.boxEncodingSize]),j=L.slice([0,0,0,0],[c,c,h,4]),Q=L.slice([0,0,0,4],[c,c,h,1]),K=F.withClassScores?GE(L.slice([0,0,0,5],[c,c,h,F.config.classes.length]),3):Dt(0);return[j,Q,K]}),d=f[0],p=f[1],v=f[2],g=[],[4,p.array()];case 1:return m=U.sent(),[4,d.array()];case 2:x=U.sent(),_=0,U.label=3;case 3:if(!(_<c))return[3,12];b=0,U.label=4;case 4:if(!(b<c))return[3,11];S=0,U.label=5;case 5:return S<h?(E=nR(m[_][b][S][0]),!i||E>i?(C=(b+nR(x[_][b][S][0]))/c*u,R=(_+nR(x[_][b][S][1]))/c*l,T=Math.exp(x[_][b][S][2])*this.config.anchors[S].x/c*u,A=Math.exp(x[_][b][S][3])*this.config.anchors[S].y/c*l,P=C-T/2,k=R-A/2,W={row:_,col:b,anchor:S},this.withClassScores?[4,this.extractPredictedClass(v,W)]:[3,7]):[3,9]):[3,10];case 6:return V=U.sent(),[3,8];case 7:V={classScore:1,label:0},U.label=8;case 8:N=V,O=N.classScore,z=N.label,g.push(_u({box:new QE(P,k,P+T,k+A),score:E,classScore:E*O,label:z},W)),U.label=9;case 9:return S++,[3,5];case 10:return b++,[3,4];case 11:return _++,[3,3];case 12:return d.dispose(),p.dispose(),v.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,r){return Ot(this,void 0,void 0,function(){var i,o,s,a;return Bt(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,s=r.anchor,[4,t.array()];case 1:return a=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return a[i][o][s][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Nc);function nh(n,e,t){if(t===void 0&&(t=!1),n.beginPath(),e.slice(1).forEach(function(o,s){var a=o.x,u=o.y,l=e[s];n.moveTo(l.x,l.y),n.lineTo(a,u)}),t){var r=e[e.length-1],i=e[0];if(!r||!i)return;n.moveTo(r.x,r.y),n.lineTo(i.x,i.y)}n.stroke()}var Ka=function(n){rn(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),o=i.score,s=i.relativeBox,a=i.imageDims;return new e(o,s,a)},e}(WK);function RS(n){return n.detection instanceof Ka}function MN(n,e){var t={detection:e};return Object.assign({},n,t)}function w4e(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof Ka?r.score:RS(r)?r.detection.score:void 0,o=r instanceof Ka?r.box:RS(r)?r.detection.box:new _l(r),s=i?""+dN(i):void 0;new YK(o,{label:s}).draw(n)})}function oa(n,e,t){return Ft(function(){var r=gq(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=jn(r,e.bias),r})}function rR(n,e,t){return t===void 0&&(t=!1),Ft(function(){var r=di(t?jn(Tc(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):oa(n,e.conv0,[2,2])),i=oa(r,e.conv1,[1,1]),o=di(jn(r,i)),s=oa(o,e.conv2,[1,1]);return di(jn(r,jn(i,s)))})}function a_(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),Ft(function(){var i=di(t?jn(Tc(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):oa(n,e.conv0,r?[2,2]:[1,1])),o=oa(i,e.conv1,[1,1]),s=di(jn(i,o)),a=oa(s,e.conv2,[1,1]),u=di(jn(i,jn(o,a))),l=oa(u,e.conv3,[1,1]);return di(jn(i,jn(o,jn(a,l))))})}function tZ(n,e){var t=JE(n,e),r=_N(n,e);function i(s,a,u,l){l===void 0&&(l=!1);var c=l?t(s,a,3,u+"/conv0"):r(s,a,u+"/conv0"),h=r(a,a,u+"/conv1"),f=r(a,a,u+"/conv2");return{conv0:c,conv1:h,conv2:f}}function o(s,a,u,l){l===void 0&&(l=!1);var c=i(s,a,u,l),h=c.conv0,f=c.conv1,d=c.conv2,p=r(a,a,u+"/conv3");return{conv0:h,conv1:f,conv2:d,conv3:p}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function _4e(n){var e=[],t=Dc(n),r=t.extractWeights,i=t.getRemainingWeights,o=tZ(r,e).extractDenseBlock4Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u,dense3:l}}}function nZ(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function rZ(n,e){var t=gf(n,e),r=nZ(t),i=bN(t);function o(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),h=i(a+"/conv2");return{conv0:l,conv1:c,conv2:h}}function s(a,u){u===void 0&&(u=!1);var l=u?r(a+"/conv0"):i(a+"/conv0"),c=i(a+"/conv1"),h=i(a+"/conv2"),f=i(a+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:s}}function b4e(n){var e=[],t=rZ(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return kc(n,e),{params:r,paramMappings:e}}var iZ=function(n){rn(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return Ft(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=wx(i,o).div(pt(255)),a=a_(s,r.dense0,!0);return a=a_(a,r.dense1),a=a_(a,r.dense2),a=a_(a,r.dense3),a=fx(a,[7,7],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return b4e(t)},e.prototype.extractParams=function(t){return _4e(t)},e}(Nc);function ll(n,e){return Ft(function(){return jn(FD(n,e.weights),e.bias)})}function S4e(n,e,t){var r=[],i=Dc(n),o=i.extractWeights,s=i.getRemainingWeights,a=wN(o,r),u=a(e,t,"fc");if(s().length!==0)throw new Error("weights remaing after extract: "+s().length);return{paramMappings:r,params:{fc:u}}}function E4e(n){var e=[],t=gf(n,e);function r(o){var s=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:s,bias:a}}var i={fc:r("fc")};return kc(n,e),{params:i,paramMappings:e}}function oZ(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var sZ=function(n){rn(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Ft(function(){var o=t instanceof TS?r.faceFeatureExtractor.forwardInput(t):t;return ll(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return S4e(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=oZ(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),E4e(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,s=t.slice(0,t.length-o),a=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(s),this.extractClassifierParams(a)},e}(Nc),k8=["neutral","happy","sad","angry","fearful","disgusted","surprised"],TN=function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);k8.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return k8.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n}(),C4e=function(n){rn(e,n);function e(t){return t===void 0&&(t=new iZ),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return Ft(function(){return pf(r.runNet(t))})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return Ot(this,void 0,void 0,function(){var r,i,o,s,a=this;return Bt(this,function(u){switch(u.label){case 0:return[4,Gi(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(oo(i).map(function(l){return Ot(a,void 0,void 0,function(){var c;return Bt(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),s=o.map(function(l){return new TN(l)}),[2,r.isBatchInput?s:s[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(sZ);function M4e(n){return n.expressions instanceof TN}function aZ(n,e){var t={expressions:e};return Object.assign({},n,t)}function T4e(n,e,t,r){t===void 0&&(t=.1);var i=Array.isArray(e)?e:[e];i.forEach(function(o){var s=o instanceof TN?o:M4e(o)?o.expressions:void 0;if(!s)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var a=s.asSortedArray(),u=a.filter(function(h){return h.probability>t}),l=RS(o)?o.detection.box.bottomLeft:r||new Gn(0,0),c=new xN(u.map(function(h){return h.expression+" ("+dN(h.probability)+")"}),l);c.draw(n)})}function R4e(n){var e=n.map(function(a){return a.x}),t=n.map(function(a){return a.y}),r=e.reduce(function(a,u){return u<a?u:a},1/0),i=t.reduce(function(a,u){return u<a?u:a},1/0),o=e.reduce(function(a,u){return a<u?u:a},0),s=t.reduce(function(a,u){return a<u?u:a},0);return new QE(r,i,o,s)}var A4e=.5,I4e=.43,P4e=.45,R1=function(){function n(e,t,r){r===void 0&&(r=new Gn(0,0));var i=t.width,o=t.height;this._imgDims=new Cv(i,o),this._shift=r,this._positions=e.map(function(s){return s.mul(new Gn(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Gn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new Gn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new Gn(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof Ka?e.box.floor():new _l(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,s=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(s)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},s=(o(t)+o(r))/2,a=Math.floor(s/P4e),u=pN(e),l=Math.floor(Math.max(0,u.x-A4e*a)),c=Math.floor(Math.max(0,u.y-I4e*a));return new mN(l,c,Math.min(a,this.imageWidth+l),Math.min(a,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=R4e(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),uZ=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(pN)},e}(R1);function lZ(n){return RS(n)&&n.landmarks instanceof R1&&n.unshiftedLandmarks instanceof R1&&n.alignedRect instanceof Ka}function RN(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,s=new Ka(n.detection.score,i.rescale(o.reverse()),o),a={landmarks:r,unshiftedLandmarks:e,alignedRect:s};return Object.assign({},n,a)}var cZ=function(){function n(e){e===void 0&&(e={});var t=e.drawLines,r=t===void 0?!0:t,i=e.drawPoints,o=i===void 0?!0:i,s=e.lineWidth,a=e.lineColor,u=e.pointSize,l=e.pointColor;this.drawLines=r,this.drawPoints=o,this.lineWidth=s||1,this.pointSize=u||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return n}(),hZ=function(){function n(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new cZ(t)}return n.prototype.draw=function(e){var t=bl(e),r=this.options,i=r.drawLines,o=r.drawPoints,s=r.lineWidth,a=r.lineColor,u=r.pointSize,l=r.pointColor;if(i&&this.faceLandmarks instanceof uZ&&(t.strokeStyle=a,t.lineWidth=s,nh(t,this.faceLandmarks.getJawOutline()),nh(t,this.faceLandmarks.getLeftEyeBrow()),nh(t,this.faceLandmarks.getRightEyeBrow()),nh(t,this.faceLandmarks.getNose()),nh(t,this.faceLandmarks.getLeftEye(),!0),nh(t,this.faceLandmarks.getRightEye(),!0),nh(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=l,t.fillStyle=l;var c=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(c)}},n}();function k4e(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof R1?r:lZ(r)?r.landmarks:void 0;if(!i)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new hZ(i).draw(n)})}const D4e=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:hZ,DrawFaceLandmarksOptions:cZ,drawContour:nh,drawDetections:w4e,drawFaceExpressions:T4e,drawFaceLandmarks:k4e},Symbol.toStringTag,{value:"Module"}));function N4e(n,e){var t=JE(n,e),r=_N(n,e);function i(s,a,u){var l=r(s,a,u+"/separable_conv0"),c=r(a,a,u+"/separable_conv1"),h=t(s,a,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(s,a){var u=r(s,s,a+"/separable_conv0"),l=r(s,s,a+"/separable_conv1"),c=r(s,s,a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function L4e(n,e){var t=[],r=Dc(n),i=r.extractWeights,o=r.getRemainingWeights,s=N4e(i,t),a=s.extractConvParams,u=s.extractSeparableConvParams,l=s.extractReductionBlockParams,c=s.extractMainBlockParams,h=a(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),d=l(64,128,"entry_flow/reduction_block_1"),p={conv_in:h,reduction_block_0:f,reduction_block_1:d},v={};M1(e,0,1).forEach(function(_){v["main_block_"+_]=c(128,"middle_flow/main_block_"+_)});var g=l(128,256,"exit_flow/reduction_block"),m=u(256,512,"exit_flow/separable_conv"),x={reduction_block:g,separable_conv:m};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:v,exit_flow:x}}}function F4e(n,e){var t=gf(n,e),r=nZ(t),i=bN(t);function o(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=r(a+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function s(a){var u=i(a+"/separable_conv0"),l=i(a+"/separable_conv1"),c=i(a+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:s}}function O4e(n,e){var t=[],r=F4e(n,t),i=r.extractConvParams,o=r.extractSeparableConvParams,s=r.extractReductionBlockParams,a=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=s("entry_flow/reduction_block_0"),c=s("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};M1(e,0,1).forEach(function(g){f["main_block_"+g]=a("middle_flow/main_block_"+g)});var d=s("exit_flow/reduction_block"),p=o("exit_flow/separable_conv"),v={reduction_block:d,separable_conv:p};return kc(n,t),{params:{entry_flow:h,middle_flow:f,exit_flow:v},paramMappings:t}}function fZ(n,e,t){return jn(Tc(n,e.filters,t,"same"),e.bias)}function iR(n,e,t){t===void 0&&(t=!0);var r=t?di(n):n;return r=oa(r,e.separable_conv0,[1,1]),r=oa(di(r),e.separable_conv1,[1,1]),r=Yv(r,[3,3],[2,2],"same"),r=jn(r,fZ(n,e.expansion_conv,[2,2])),r}function B4e(n,e){var t=oa(di(n),e.separable_conv0,[1,1]);return t=oa(di(t),e.separable_conv1,[1,1]),t=oa(di(t),e.separable_conv2,[1,1]),t=jn(t,n),t}var U4e=function(n){rn(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Ft(function(){var o=t.toBatchTensor(112,!0),s=[122.782,117.001,104.298],a=wx(o,s).div(pt(256)),u=di(fZ(a,i.entry_flow.conv_in,[2,2]));return u=iR(u,i.entry_flow.reduction_block_0,!1),u=iR(u,i.entry_flow.reduction_block_1),M1(r._numMainBlocks,0,1).forEach(function(l){u=B4e(u,i.middle_flow["main_block_"+l])}),u=iR(u,i.exit_flow.reduction_block),u=di(oa(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return O4e(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return L4e(t,this._numMainBlocks)},e}(Nc);function z4e(n){var e=[],t=Dc(n),r=t.extractWeights,i=t.getRemainingWeights,o=wN(r,e),s=o(512,1,"fc/age"),a=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:s,gender:a}}}}function V4e(n){var e=[],t=gf(n,e);function r(o){var s=t(o+"/weights",2),a=t(o+"/bias",1);return{weights:s,bias:a}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return kc(n,e),{params:i,paramMappings:e}}var AS;(function(n){n.FEMALE="female",n.MALE="male"})(AS||(AS={}));var W4e=function(n){rn(e,n);function e(t){t===void 0&&(t=new U4e(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Ft(function(){var o=t instanceof TS?r.faceFeatureExtractor.forwardInput(t):t,s=fx(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),a=ll(s,i.fc.age).as1D(),u=ll(s,i.fc.gender);return{age:a,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return Ft(function(){var i=r.runNet(t),o=i.age,s=i.gender;return{age:o,gender:pf(s)}})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Ot(this,void 0,void 0,function(){var r,i,o,s,a,u,l=this;return Bt(this,function(c){switch(c.label){case 0:return[4,Gi(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=oo(i.age),s=oo(i.gender),a=o.map(function(h,f){return{ageTensor:h,genderTensor:s[f]}}),[4,Promise.all(a.map(function(h){var f=h.ageTensor,d=h.genderTensor;return Ot(l,void 0,void 0,function(){var p,v,g,m,x;return Bt(this,function(_){switch(_.label){case 0:return[4,f.data()];case 1:return p=_.sent()[0],[4,d.data()];case 2:return v=_.sent()[0],g=v>.5,m=g?AS.MALE:AS.FEMALE,x=g?v:1-v,f.dispose(),d.dispose(),[2,{age:p,gender:m,genderProbability:x}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return z4e(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=oZ(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),V4e(o)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(Nc),H4e=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],pN([t[3],t[4]])]},e}(R1),D8=function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+dN(this.distance)+")":"")},n}(),oR=function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n}();function AN(n,e){return Ot(this,void 0,void 0,function(){var t,r,i,o,s,a,u;return Bt(this,function(l){switch(l.label){case 0:return t=No.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,Gi(n)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(s=o,[3,4]):[3,2];case 2:return[4,c4e(o)];case 3:s=l.sent(),l.label=4;case 4:r=s,l.label=5;case 5:return a=bl(r),u=e.map(function(c){return c instanceof Ka?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,f=c.y,d=c.width,p=c.height,v=eC({width:d,height:p});return bl(v).putImageData(a.getImageData(h,f,d,p),0,0),v})]}})})}function IN(n,e){return Ot(this,void 0,void 0,function(){return Bt(this,function(t){if(!ZE(n)&&!Oh(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Oh(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Ft(function(){var r=n.shape.slice(Oh(n)?1:0),i=r[0],o=r[1],s=r[2],a=e.map(function(l){return l instanceof Ka?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=a.map(function(l){var c=l.x,h=l.y,f=l.width,d=l.height;return wq(n.as3D(i,o,s),[h,c,0],[d,f,s])});return u})]})})}var dZ=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var o=i.map(function(a){var u=a.width,l=a.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),s=o.length;return Ft(function(){var a=function(f,d){return bu([pv([68],f),pv([68],d)],1).as2D(1,136).as1D()},u=function(f,d){var p=o[f],v=p.width,g=p.height;return d(v,g)?Math.abs(v-g)/2:0},l=function(f){return u(f,function(d,p){return d<p})},c=function(f){return u(f,function(d,p){return p<d})},h=t.mul(pv([s,136],r)).sub(bu(Array.from(Array(s),function(f,d){return a(l(d),c(d))}))).div(bu(Array.from(Array(s),function(f,d){return a(o[d].width,o[d].height)})));return h})},e.prototype.forwardInput=function(t){var r=this;return Ft(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var s=o[0],a=o[1];return{height:s,width:a}}))})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Ot(this,void 0,void 0,function(){var r,i,o,s=this;return Bt(this,function(a){switch(a.label){case 0:return[4,Gi(t)];case 1:return r=a.sent(),i=Ft(function(){return oo(s.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return Ot(s,void 0,void 0,function(){var c,h,f,d,p;return Bt(this,function(v){switch(v.label){case 0:return f=(h=Array).from,[4,u.data()];case 1:return c=f.apply(h,[v.sent()]),d=c.filter(function(g,m){return M8(m)}),p=c.filter(function(g,m){return!M8(m)}),[2,new uZ(Array(68).fill(0).map(function(g,m){return new Gn(d[m],p[m])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(sZ),pZ=function(n){rn(e,n);function e(t){return t===void 0&&(t=new iZ),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(dZ);function G4e(n){var e=[],t=rZ(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return kc(n,e),{params:r,paramMappings:e}}function $4e(n){var e=[],t=Dc(n),r=t.extractWeights,i=t.getRemainingWeights,o=tZ(r,e).extractDenseBlock3Params,s=o(3,32,"dense0",!0),a=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:s,dense1:a,dense2:u}}}var j4e=function(n){rn(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ft(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],s=wx(i,o).div(pt(255)),a=rR(s,r.dense0,!0);return a=rR(a,r.dense1),a=rR(a,r.dense2),a=fx(a,[14,14],[2,2],"valid"),a})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return G4e(t)},e.prototype.extractParams=function(t){return $4e(t)},e}(Nc),X4e=function(n){rn(e,n);function e(t){return t===void 0&&(t=new j4e),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(dZ);(function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(pZ);function q4e(n,e){return jn(nc(n,e.weights),e.biases)}function PN(n,e,t,r,i){i===void 0&&(i="same");var o=e.conv,s=o.filters,a=o.bias,u=Tc(n,s,t,i);return u=jn(u,a),u=q4e(u,e.scale),r?di(u):u}function Y4e(n,e){return PN(n,e,[1,1],!0)}function mZ(n,e){return PN(n,e,[1,1],!1)}function vZ(n,e){return PN(n,e,[2,2],!0,"valid")}function K4e(n,e){function t(a,u,l){var c=n(a),h=c.length/(u*l*l);if(n4e(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Ft(function(){return Zh(fu(c,[u,h,l,l]),[2,3,1,0])})}function r(a,u,l,c){var h=t(a,u,l),f=fs(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:f}}function i(a,u){var l=fs(n(a)),c=fs(n(a));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(a,u,l,c){var h=r(a,u,l,c+"/conv"),f=i(u,c+"/scale");return{conv:h,scale:f}}function s(a,u,l,c,h){h===void 0&&(h=!1);var f=o((h?.5:1)*a,u,l,c+"/conv1"),d=o(a,u,l,c+"/conv2");return{conv1:f,conv2:d}}return{extractConvLayerParams:o,extractResidualLayerParams:s}}function Z4e(n){var e=Dc(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=K4e(t,i),s=o.extractConvLayerParams,a=o.extractResidualLayerParams,u=s(4704,32,7,"conv32_down"),l=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),h=a(9216,32,3,"conv32_3"),f=a(36864,64,3,"conv64_down",!0),d=a(36864,64,3,"conv64_1"),p=a(36864,64,3,"conv64_2"),v=a(36864,64,3,"conv64_3"),g=a(147456,128,3,"conv128_down",!0),m=a(147456,128,3,"conv128_1"),x=a(147456,128,3,"conv128_2"),_=a(589824,256,3,"conv256_down",!0),b=a(589824,256,3,"conv256_1"),S=a(589824,256,3,"conv256_2"),E=a(589824,256,3,"conv256_down_out"),C=Ft(function(){return Zh(ix(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var R={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:f,conv64_1:d,conv64_2:p,conv64_3:v,conv128_down:g,conv128_1:m,conv128_2:x,conv256_down:_,conv256_1:b,conv256_2:S,conv256_down_out:E,fc:C};return{params:R,paramMappings:i}}function Q4e(n,e){var t=gf(n,e);function r(s){var a=t(s+"/scale/weights",1),u=t(s+"/scale/biases",1);return{weights:a,biases:u}}function i(s){var a=t(s+"/conv/filters",4),u=t(s+"/conv/bias",1),l=r(s);return{conv:{filters:a,bias:u},scale:l}}function o(s){return{conv1:i(s+"/conv1"),conv2:i(s+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function J4e(n){var e=[],t=Q4e(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),s=i("conv32_1"),a=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),f=i("conv64_3"),d=i("conv128_down"),p=i("conv128_1"),v=i("conv128_2"),g=i("conv256_down"),m=i("conv256_1"),x=i("conv256_2"),_=i("conv256_down_out"),b=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!t4e(b))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var S={conv32_down:o,conv32_1:s,conv32_2:a,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:f,conv128_down:d,conv128_1:p,conv128_2:v,conv256_down:g,conv256_1:m,conv256_2:x,conv256_down_out:_,fc:b};return kc(n,e),{params:S,paramMappings:e}}function $u(n,e){var t=Y4e(n,e.conv1);return t=mZ(t,e.conv2),t=jn(t,n),t=di(t),t}function u_(n,e){var t=vZ(n,e.conv1);t=mZ(t,e.conv2);var r=fx(n,2,2,"valid"),i=Mr(r.shape),o=r.shape[3]!==t.shape[3],s=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(s){var a=t.shape.slice();a[1]=1;var u=Mr(a);t=ko([t,u],1);var l=t.shape.slice();l[2]=1;var c=Mr(l);t=ko([t,c],2)}return r=o?ko([r,i],3):r,t=jn(r,t),t=di(t),t}var ePe=function(n){rn(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return Ft(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],s=wx(i,o).div(pt(256)),a=vZ(s,r.conv32_down);a=Yv(a,3,2,"valid"),a=$u(a,r.conv32_1),a=$u(a,r.conv32_2),a=$u(a,r.conv32_3),a=u_(a,r.conv64_down),a=$u(a,r.conv64_1),a=$u(a,r.conv64_2),a=$u(a,r.conv64_3),a=u_(a,r.conv128_down),a=$u(a,r.conv128_1),a=$u(a,r.conv128_2),a=u_(a,r.conv256_down),a=$u(a,r.conv256_1),a=$u(a,r.conv256_2),a=u_(a,r.conv256_down_out);var u=a.mean([1,2]),l=FD(u,r.fc);return l})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Ot(this,void 0,void 0,function(){var r,i,o,s=this;return Bt(this,function(a){switch(a.label){case 0:return[4,Gi(t)];case 1:return r=a.sent(),i=Ft(function(){return oo(s.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=a.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return J4e(t)},e.prototype.extractParams=function(t){return Z4e(t)},e}(Nc);function gZ(n,e){var t={descriptor:e};return Object.assign({},n,t)}var yZ=function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,s=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=s||[.6,.7,.7],this._scaleSteps=a,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function tPe(n,e){function t(u,l){var c=fu(n(9*u),[3,3,u,1]),h=fs(n(u)),f=fs(n(u)),d=fs(n(u)),p=fs(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:d,batch_norm_variance:p}}function r(u,l,c,h,f){var d=fu(n(u*l*c*c),[c,c,u,l]),p=fs(n(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:d,bias:p}}function i(u,l,c,h){var f=r(u,l,c,h,!0),d=f.filters,p=f.bias;return{filters:d,batch_norm_offset:p}}function o(u,l,c){var h=t(u,c+"/depthwise_conv"),f=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function s(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),d=o(256,256,"mobilenetv1/conv_5"),p=o(256,512,"mobilenetv1/conv_6"),v=o(512,512,"mobilenetv1/conv_7"),g=o(512,512,"mobilenetv1/conv_8"),m=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),_=o(512,512,"mobilenetv1/conv_11"),b=o(512,1024,"mobilenetv1/conv_12"),S=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:v,conv_8:g,conv_9:m,conv_10:x,conv_11:_,conv_12:b,conv_13:S}}function a(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),d=i(128,256,3,"prediction_layer/conv_5"),p=i(256,64,1,"prediction_layer/conv_6"),v=i(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),m=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),_=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),b=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),S=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),E=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),C=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),R=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),A=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),P=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),k={box_encoding_predictor:g,class_predictor:m},W={box_encoding_predictor:x,class_predictor:_},N={box_encoding_predictor:b,class_predictor:S},O={box_encoding_predictor:E,class_predictor:C},z={box_encoding_predictor:R,class_predictor:T},V={box_encoding_predictor:A,class_predictor:P};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:d,conv_6:p,conv_7:v,box_predictor_0:k,box_predictor_1:W,box_predictor_2:N,box_predictor_3:O,box_predictor_4:z,box_predictor_5:V}}return{extractMobilenetV1Params:s,extractPredictionLayerParams:a}}function nPe(n){var e=[],t=Dc(n),r=t.extractWeights,i=t.getRemainingWeights,o=tPe(r,e),s=o.extractMobilenetV1Params,a=o.extractPredictionLayerParams,u=s(),l=a(),c=CD(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function rPe(n,e){var t=gf(n,e);function r(l,c,h){var f=t(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),d=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:d}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",d=c+"/pointwise_conv",p=t(h+"/depthwise_weights",4,f+"/filters"),v=t(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),g=t(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),m=t(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),x=t(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:g,batch_norm_mean:m,batch_norm_variance:x},pointwise_conv:r("MobilenetV1",l,d)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function s(l,c){var h=t(l+"/weights",4,c+"/filters"),f=t(l+"/biases",1,c+"/bias");return{filters:h,bias:f}}function a(l){var c=s("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=s("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function iPe(n){var e=[],t=rPe(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!ZE(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var s={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return kc(n,e),{params:s,paramMappings:e}}function qu(n,e,t){return Ft(function(){var r=Tc(n,e.filters,t,"same");return r=jn(r,e.batch_norm_offset),ND(r,0,6)})}var oPe=.0010000000474974513;function sPe(n,e,t){return Ft(function(){var r=LD(n,e.filters,t,"same");return r=dq(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,oPe),ND(r,0,6)})}function aPe(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function uPe(n,e){return Ft(function(){var t=null,r=qu(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,s){var a=s+1,u=aPe(a);r=sPe(r,o.depthwise_conv,u),r=qu(r,o.pointwise_conv,[1,1]),a===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function lPe(n,e,t,r,i){var o=n.shape[0],s=Math.min(t,o),a=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return a.forEach(function(c){if(!(l.length>=s)){for(var h=c.score,f=l.length-1;f>=0;--f){var d=cPe(n,c.boxIndex,l[f]);if(d!==0&&(c.score*=u(d),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function cPe(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),s=Math.max(r[e][0],r[e][2]),a=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),h=Math.max(r[t][1],r[t][3]),f=(s-i)*(a-o),d=(c-u)*(h-l);if(f<=0||d<=0)return 0;var p=Math.max(i,u),v=Math.max(o,l),g=Math.min(s,c),m=Math.min(a,h),x=Math.max(g-p,0)*Math.max(m-v,0);return x/(f+d-x)}function hPe(n){var e=oo(Zh(n,[1,0])),t=[Is(e[2],e[0]),Is(e[3],e[1])],r=[jn(e[0],Zu(t[0],pt(2))),jn(e[1],Zu(t[1],pt(2)))];return{sizes:t,centers:r}}function fPe(n,e){var t=hPe(n),r=t.sizes,i=t.centers,o=oo(Zh(e,[1,0])),s=Zu(nc(o4(Zu(o[2],pt(5))),r[0]),pt(2)),a=jn(nc(Zu(o[0],pt(10)),r[0]),i[0]),u=Zu(nc(o4(Zu(o[3],pt(5))),r[1]),pt(2)),l=jn(nc(Zu(o[1],pt(10)),r[1]),i[1]);return Zh(bu([Is(a,s),Is(l,u),jn(a,s),jn(l,u)]),[1,0])}function dPe(n,e,t){return Ft(function(){var r=n.shape[0],i=fPe(gu(mv(t.extra_dim,[r,1,1]),[-1,4]),gu(n,[-1,4]));i=gu(i,[r,i.shape[0]/r,4]);var o=lq(wl(e,[0,0,1],[-1,-1,-1])),s=wl(o,[0,0,0],[-1,-1,1]);s=gu(s,[r,s.shape[1]]);var a=oo(i),u=oo(s);return{boxes:a,scores:u}})}function cm(n,e){return Ft(function(){var t=n.shape[0],r=gu(Eu(n,e.box_encoding_predictor),[t,-1,1,4]),i=gu(Eu(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function pPe(n,e,t){return Ft(function(){var r=qu(n,t.conv_0,[1,1]),i=qu(r,t.conv_1,[2,2]),o=qu(i,t.conv_2,[1,1]),s=qu(o,t.conv_3,[2,2]),a=qu(s,t.conv_4,[1,1]),u=qu(a,t.conv_5,[2,2]),l=qu(u,t.conv_6,[1,1]),c=qu(l,t.conv_7,[2,2]),h=cm(e,t.box_predictor_0),f=cm(n,t.box_predictor_1),d=cm(i,t.box_predictor_2),p=cm(s,t.box_predictor_3),v=cm(u,t.box_predictor_4),g=cm(c,t.box_predictor_5),m=ko([h.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,g.boxPredictionEncoding],1),x=ko([h.classPrediction,f.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,g.classPrediction],1);return{boxPredictions:m,classPredictions:x}})}var tC=function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),xZ=function(n){rn(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return Ft(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=Is(nc(i,pt(.007843137718737125)),pt(1)),s=uPe(o,r.mobilenetv1),a=pPe(s.out,s.conv11,r.prediction_layer),u=a.boxPredictions,l=a.classPredictions;return dPe(u,l,r.output_layer)})},e.prototype.forward=function(t){return Ot(this,void 0,void 0,function(){var r;return Bt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,Gi(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),Ot(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R;return Bt(this,function(T){switch(T.label){case 0:return i=new tC(r),o=i.maxResults,s=i.minConfidence,[4,Gi(t)];case 1:for(a=T.sent(),u=this.forwardInput(a),l=u.boxes,c=u.scores,h=l[0],f=c[0],d=1;d<l.length;d++)l[d].dispose(),c[d].dispose();return g=(v=Array).from,[4,f.data()];case 2:return p=g.apply(v,[T.sent()]),m=.5,x=lPe(h,p,o,m,s),_=a.getReshapedInputDimensions(0),b=a.inputSize,S=b/_.width,E=b/_.height,C=h.arraySync(),R=x.map(function(A){var P=[Math.max(0,C[A][0]),Math.min(1,C[A][2])].map(function(V){return V*E}),k=P[0],W=P[1],N=[Math.max(0,C[A][1]),Math.min(1,C[A][3])].map(function(V){return V*S}),O=N[0],z=N[1];return new Ka(p[A],new mN(O,k,z-O,W-k),{height:a.getInputHeight(0),width:a.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,R]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return iPe(t)},e.prototype.extractParams=function(t){return nPe(t)},e}(Nc);(function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(xZ);var wZ=function(n){rn(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e}(CN),_x=function(){function n(){}return n.prototype.then=function(e){return Ot(this,void 0,void 0,function(){var t;return Bt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return Ot(this,void 0,void 0,function(){return Bt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n}();function nC(n,e,t,r,i){return i===void 0&&(i=function(o){var s=o.alignedRect;return s}),Ot(this,void 0,void 0,function(){var o,s,a,u,l;return Bt(this,function(c){switch(c.label){case 0:return o=n.map(function(h){return lZ(h)?i(h):h.detection}),a=r,a?[3,5]:e instanceof at?[4,IN(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,AN(e,o)];case 3:u=c.sent(),c.label=4;case 4:a=u,c.label=5;case 5:return s=a,[4,t(s)];case 6:return l=c.sent(),s.forEach(function(h){return h instanceof at&&h.dispose()}),[2,l]}})})}function kN(n,e,t,r,i){return Ot(this,void 0,void 0,function(){var o=this;return Bt(this,function(s){return[2,nC([n],e,function(a){return Ot(o,void 0,void 0,function(){return Bt(this,function(u){return[2,t(a[0])]})})},r,i)]})})}function mPe(n){return Ft(function(){return bu(oo(n,3).reverse(),3)})}var l_=2,IS=12;function vPe(n,e){var t=JE(n,e),r=wN(n,e);function i(l,c){var h=fs(n(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var f=t(l[0],l[1],3,c+"/conv1"),d=i(l[1],c+"/prelu1_alpha"),p=t(l[1],l[2],3,c+"/conv2"),v=i(l[2],c+"/prelu2_alpha"),g=t(l[2],l[3],h?2:3,c+"/conv3"),m=i(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:p,prelu2_alpha:v,conv3:g,prelu3_alpha:m}}function s(){var l=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return _u({},l,{conv4_1:c,conv4_2:h})}function a(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),d=r(128,4,"rnet/fc2_2");return _u({},l,{fc1:c,prelu4_alpha:h,fc2_1:f,fc2_2:d})}function u(){var l=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),d=i(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return _u({},l,{conv4:c,prelu4_alpha:h,fc1:f,prelu5_alpha:d,fc2_1:p,fc2_2:v,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:a,extractONetParams:u}}function gPe(n){var e=Dc(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=vPe(t,i),s=o.extractPNetParams,a=o.extractRNetParams,u=o.extractONetParams,l=s(),c=a(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function yPe(n,e){var t=gf(n,e);function r(c){var h=t(c+"/weights",4,c+"/filters"),f=t(c+"/bias",1);return{filters:h,bias:f}}function i(c){var h=t(c+"/weights",2),f=t(c+"/bias",1);return{weights:h,bias:f}}function o(c){return t(c,1)}function s(c){var h=r(c+"/conv1"),f=o(c+"/prelu1_alpha"),d=r(c+"/conv2"),p=o(c+"/prelu2_alpha"),v=r(c+"/conv3"),g=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:d,prelu2_alpha:p,conv3:v,prelu3_alpha:g}}function a(){var c=s("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return _u({},c,{conv4_1:h,conv4_2:f})}function u(){var c=s("rnet"),h=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),d=i("rnet/fc2_1"),p=i("rnet/fc2_2");return _u({},c,{fc1:h,prelu4_alpha:f,fc2_1:d,fc2_2:p})}function l(){var c=s("onet"),h=r("onet/conv4"),f=o("onet/prelu4_alpha"),d=i("onet/fc1"),p=o("onet/prelu5_alpha"),v=i("onet/fc2_1"),g=i("onet/fc2_2"),m=i("onet/fc2_3");return _u({},c,{conv4:h,prelu4_alpha:f,fc1:d,prelu5_alpha:p,fc2_1:v,fc2_2:g,fc2_3:m})}return{extractPNetParams:a,extractRNetParams:u,extractONetParams:l}}function xPe(n){var e=[],t=yPe(n,e),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,s=r(),a=i(),u=o();return kc(n,e),{params:{pnet:s,rnet:a,onet:u},paramMappings:e}}function A4(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function wPe(n,e,t){for(var r=t[0],i=t[1],o=IS/n,s=[],a=Math.min(r,i)*o,u=0;a>=12;)s.push(o*Math.pow(e,u)),a=a*e,u+=1;return s}var DN=function(n){rn(e,n);function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return e}(_l);function _Z(n){return Ft(function(){return nc(Is(n,pt(127.5)),pt(.0078125))})}function Mv(n,e){return Ft(function(){return jn(di(n),nc(e,oS(di(oS(n)))))})}function NN(n,e,t){return t===void 0&&(t=!1),Ft(function(){var r=Eu(n,e.conv1,"valid");return r=Mv(r,e.prelu1_alpha),r=Yv(r,t?[2,2]:[3,3],[2,2],"same"),r=Eu(r,e.conv2,"valid"),r=Mv(r,e.prelu2_alpha),r=t?r:Yv(r,[3,3],[2,2],"valid"),r=Eu(r,e.conv3,"valid"),r=Mv(r,e.prelu3_alpha),r})}function _Pe(n,e){return Ft(function(){var t=NN(n,e,!0),r=Eu(t,e.conv4_1,"valid"),i=Da(OE(r,3),3),o=pf(Is(r,i),3),s=Eu(t,e.conv4_2,"valid");return{prob:o,regions:s}})}function bPe(n,e){return Ft(function(){var t=A4(e,n.shape.slice(1)),r=t.height,i=t.width,o=Bq.resizeBilinear(n,[r,i]),s=_Z(o);return Zh(s,[0,2,1,3])})}function SPe(n,e,t,r){for(var i=[],o=n.arraySync(),s=0;s<n.shape[0];s++)for(var a=0;a<n.shape[1];a++)o[s][a]>=r&&i.push(new Gn(a,s));var u=i.map(function(l){var c=new QE(Math.round((l.y*l_+1)/t),Math.round((l.x*l_+1)/t),Math.round((l.y*l_+IS)/t),Math.round((l.x*l_+IS)/t)),h=o[l.y][l.x],f=e.arraySync(),d=new DN(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:h,region:d}});return u}function EPe(n,e,t,r,i){i.stage1=[];var o=e.map(function(f){return Ft(function(){var d={scale:f},p=bPe(n,f),v=Date.now(),g=_Pe(p,r),m=g.prob,x=g.regions;d.pnet=Date.now()-v;var _=oo(oo(m,3)[1])[0],b=oo(x)[0];return{scoresTensor:_,regionsTensor:b,scale:f,statsForScale:d}})}),s=o.map(function(f){var d=f.scoresTensor,p=f.regionsTensor,v=f.scale,g=f.statsForScale,m=SPe(d,p,v,t);if(d.dispose(),p.dispose(),!m.length)return i.stage1.push(g),[];var x=Date.now(),_=T1(m.map(function(b){return b.cell}),m.map(function(b){return b.score}),.5);return g.nms=Date.now()-x,g.numBoxes=_.length,i.stage1.push(g),_.map(function(b){return m[b]})}),a=s.reduce(function(f,d){return f.concat(d)},[]),u=[],l=[];if(a.length>0){var c=Date.now(),h=T1(a.map(function(f){return f.cell}),a.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(f){return a[f].score}),u=h.map(function(f){return a[f]}).map(function(f){var d=f.cell,p=f.region;return new QE(d.left+p.left*d.width,d.top+p.top*d.height,d.right+p.right*d.width,d.bottom+p.bottom*d.height).toSquare().round()})}return{boxes:u,scores:l}}function bZ(n,e,t){var r=t.width,i=t.height;return Ot(this,void 0,void 0,function(){var o,s,a,u=this;return Bt(this,function(l){switch(l.label){case 0:return o=bl(n),[4,Promise.all(e.map(function(c){return Ot(u,void 0,void 0,function(){var h,f,d,p,v,g,m,x;return Bt(this,function(_){return h=c.padAtBorders(n.height,n.width),f=h.y,d=h.ey,p=h.x,v=h.ex,g=p-1,m=f-1,x=o.getImageData(g,m,v-g,d-m),[2,No.isNodejs()?SN(x):createImageBitmap(x)]})})}))];case 1:return s=l.sent(),a=[],s.forEach(function(c){var h=eC({width:r,height:i}),f=bl(h);f.drawImage(c,0,0,r,i);for(var d=f.getImageData(0,0,r,i).data,p=[],v=0;v<d.length;v+=4)p.push(d[v+2]),p.push(d[v+1]),p.push(d[v]);a.push(p)}),[2,a.map(function(c){var h=Ft(function(){var f=Zh(fu(c,[1,r,i,3]),[0,2,1,3]).toFloat();return _Z(f)});return h})]}})})}function CPe(n,e){return Ft(function(){var t=NN(n,e),r=gu(t,[t.shape[0],e.fc1.weights.shape[0]]),i=ll(r,e.fc1),o=Mv(i,e.prelu4_alpha),s=ll(o,e.fc2_1),a=Da(OE(s,1),1),u=pf(Is(s,a),1),l=ll(o,e.fc2_2),c=oo(u,1)[1];return{scores:c,regions:l}})}function MPe(n,e,t,r,i){return Ot(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,p,v,g,m,x;return Bt(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,bZ(n,e,{width:24,height:24})];case 1:return s=_.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(b){var S=CPe(b,r);return b.dispose(),S}),i.stage2_rnet=Date.now()-o,u=a.length>1?ko(a.map(function(b){return b.scores})):a[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[_.sent()]),u.dispose(),f=l.map(function(b,S){return{score:b,idx:S}}).filter(function(b){return b.score>t}).map(function(b){var S=b.idx;return S}),d=f.map(function(b){return e[b]}),p=f.map(function(b){return l[b]}),v=[],g=[],d.length>0&&(o=Date.now(),m=T1(d,p,.7),i.stage2_nms=Date.now()-o,x=m.map(function(b){var S=a[f[b]].regions.arraySync();return new DN(S[0][0],S[0][1],S[0][2],S[0][3])}),g=m.map(function(b){return p[b]}),v=m.map(function(b,S){return d[b].calibrate(x[S])})),a.forEach(function(b){b.regions.dispose(),b.scores.dispose()}),[2,{boxes:v,scores:g}]}})})}function TPe(n,e){return Ft(function(){var t=NN(n,e);t=Yv(t,[2,2],[2,2],"same"),t=Eu(t,e.conv4,"valid"),t=Mv(t,e.prelu4_alpha);var r=gu(t,[t.shape[0],e.fc1.weights.shape[0]]),i=ll(r,e.fc1),o=Mv(i,e.prelu5_alpha),s=ll(o,e.fc2_1),a=Da(OE(s,1),1),u=pf(Is(s,a),1),l=ll(o,e.fc2_2),c=ll(o,e.fc2_3),h=oo(u,1)[1];return{scores:h,regions:l,points:c}})}function RPe(n,e,t,r,i){return Ot(this,void 0,void 0,function(){var o,s,a,u,l,c,h,f,d,p,v,g,m,x,_;return Bt(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,bZ(n,e,{width:48,height:48})];case 1:return s=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),a=s.map(function(S){var E=TPe(S,r);return S.dispose(),E}),i.stage3_onet=Date.now()-o,u=a.length>1?ko(a.map(function(S){return S.scores})):a[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[b.sent()]),u.dispose(),f=l.map(function(S,E){return{score:S,idx:E}}).filter(function(S){return S.score>t}).map(function(S){var E=S.idx;return E}),d=f.map(function(S){var E=a[S].regions.arraySync();return new DN(E[0][0],E[0][1],E[0][2],E[0][3])}),p=f.map(function(S,E){return e[S].calibrate(d[E])}),v=f.map(function(S){return l[S]}),g=[],m=[],x=[],p.length>0&&(o=Date.now(),_=T1(p,v,.7,!1),i.stage3_nms=Date.now()-o,g=_.map(function(S){return p[S]}),m=_.map(function(S){return v[S]}),x=_.map(function(S,E){return Array(5).fill(0).map(function(C,R){var T=a[S].points.arraySync();return new Gn(T[0][R]*(g[E].width+1)+g[E].left,T[0][R+5]*(g[E].height+1)+g[E].top)})})),a.forEach(function(S){S.regions.dispose(),S.scores.dispose(),S.points.dispose()}),[2,{boxes:g,scores:m,points:x}]}})})}var APe=function(n){rn(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),Ot(this,void 0,void 0,function(){var i,o,s,a,u,l,c,h,f,d,p,v,g,m,x,_,b,S,E,C,R;return Bt(this,function(T){switch(T.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return s={},a=Date.now(),u=Ft(function(){return mPe(Da(iCe.fromPixels(o)).toFloat())}),l=function(A){return u.dispose(),s.total=Date.now()-a,A},c=u.shape.slice(1),h=c[0],f=c[1],d=new yZ(r),p=d.minFaceSize,v=d.scaleFactor,g=d.maxNumScales,m=d.scoreThresholds,x=d.scaleSteps,_=(x||wPe(p,v,[h,f])).filter(function(A){var P=A4(A,[h,f]);return Math.min(P.width,P.height)>IS}).slice(0,g),s.scales=_,s.pyramid=_.map(function(A){return A4(A,[h,f])}),b=Date.now(),[4,EPe(u,_,m[0],i.pnet,s)];case 1:return S=T.sent(),s.total_stage1=Date.now()-b,S.boxes.length?(s.stage2_numInputBoxes=S.boxes.length,b=Date.now(),[4,MPe(o,S.boxes,m[1],i.rnet,s)]):[2,l({results:[],stats:s})];case 2:return E=T.sent(),s.total_stage2=Date.now()-b,E.boxes.length?(s.stage3_numInputBoxes=E.boxes.length,b=Date.now(),[4,RPe(o,E.boxes,m[2],i.onet,s)]):[2,l({results:[],stats:s})];case 3:return C=T.sent(),s.total_stage3=Date.now()-b,R=C.boxes.map(function(A,P){return RN(MN({},new Ka(C.scores[P],new mN(A.left/f,A.top/h,A.width/f,A.height/h),{height:h,width:f})),new H4e(C.points[P].map(function(k){return k.sub(new Gn(A.left,A.top)).div(new Gn(A.width,A.height))}),{width:A.width,height:A.height}))}),[2,l({results:R,stats:s})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),Ot(this,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Gi(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),Ot(this,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,Gi(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return xPe(t)},e.prototype.extractParams=function(t){return gPe(t)},e}(Nc),IPe=.4,PPe=[new Gn(1.603231,2.094468),new Gn(6.041143,7.080126),new Gn(2.882459,3.518061),new Gn(4.266906,5.178857),new Gn(9.041765,10.66308)],kPe=[117.001,114.697,97.404],DPe=function(n){rn(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:IPe,classes:["face"],anchors:PPe,meanRgb:kPe,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ot(this,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Ka(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(eZ),NPe=.4,LPe=[new Gn(.738768,.874946),new Gn(2.42204,2.65704),new Gn(4.30971,7.04493),new Gn(10.246,4.59428),new Gn(12.6868,11.8741)],FPe=[new Gn(1.603231,2.094468),new Gn(6.041143,7.080126),new Gn(2.882459,3.518061),new Gn(4.266906,5.178857),new Gn(9.041765,10.66308)],OPe=[117.001,114.697,97.404],BPe="tiny_yolov2_model",UPe="tiny_yolov2_separable_conv_model",zPe=function(n){rn(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:NPe,classes:["face"]},t?{anchors:FPe,meanRgb:OPe}:{anchors:LPe,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return Ot(this,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(s){return new Ka(s.score,s.relativeBox,{width:s.imageWidth,height:s.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?UPe:BPe},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e}(eZ),ys={ssdMobilenetv1:new xZ,tinyFaceDetector:new DPe,tinyYolov2:new zPe,mtcnn:new APe,faceLandmark68Net:new pZ,faceLandmark68TinyNet:new X4e,faceRecognitionNet:new ePe,faceExpressionNet:new C4e,ageGenderNet:new W4e};function SZ(n,e){var t={age:e};return Object.assign({},n,t)}function EZ(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var CZ=function(n){rn(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(_x),LN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i=this;return Bt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,nC(t,this.input,function(s){return Ot(i,void 0,void 0,function(){return Bt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return ys.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){return aZ(s,r[a])})]}})})},e.prototype.withAgeAndGender=function(){return new UN(this,this.input)},e}(CZ),FN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r;return Bt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,kN(t,this.input,function(o){return ys.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,aZ(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new zN(this,this.input)},e}(CZ),ON=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new VN(this,this.input)},e.prototype.withFaceDescriptors=function(){return new HN(this,this.input)},e}(LN),BN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new WN(this,this.input)},e.prototype.withFaceDescriptor=function(){return new GN(this,this.input)},e}(FN),MZ=function(n){rn(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e}(_x),UN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i=this;return Bt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,nC(t,this.input,function(s){return Ot(i,void 0,void 0,function(){return Bt(this,function(a){switch(a.label){case 0:return[4,Promise.all(s.map(function(u){return ys.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,a.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(s,a){var u=r[a],l=u.age,c=u.gender,h=u.genderProbability;return SZ(EZ(s,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new LN(this,this.input)},e}(MZ),zN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i,o,s;return Bt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?[4,kN(t,this.input,function(u){return ys.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=a.sent(),i=r.age,o=r.gender,s=r.genderProbability,[2,SZ(EZ(t,o,s),i)]}})})},e.prototype.withFaceExpressions=function(){return new FN(this,this.input)},e}(MZ),VN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new ON(this,this.input)},e.prototype.withFaceDescriptors=function(){return new HN(this,this.input)},e}(UN),WN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new BN(this,this.input)},e.prototype.withFaceDescriptor=function(){return new GN(this,this.input)},e}(zN),TZ=function(n){rn(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e}(_x),HN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r;return Bt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,nC(t,this.input,function(o){return Promise.all(o.map(function(s){return ys.faceRecognitionNet.computeFaceDescriptor(s)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,s){return gZ(t[s],o)})]}})})},e.prototype.withFaceExpressions=function(){return new ON(this,this.input)},e.prototype.withAgeAndGender=function(){return new VN(this,this.input)},e}(TZ),GN=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r;return Bt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,kN(t,this.input,function(o){return ys.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,gZ(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new BN(this,this.input)},e.prototype.withAgeAndGender=function(){return new WN(this,this.input)},e}(TZ),RZ=function(n){rn(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?ys.faceLandmark68TinyNet:ys.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(_x),VPe=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i,o,s,a=this;return Bt(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof at?[4,IN(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,AN(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return a.landmarkNet.detectLandmarks(l)}))];case 6:return s=u.sent(),i.forEach(function(l){return l instanceof at&&l.dispose()}),[2,t.map(function(l,c){return RN(l,s[c])})]}})})},e.prototype.withFaceExpressions=function(){return new ON(this,this.input)},e.prototype.withAgeAndGender=function(){return new VN(this,this.input)},e.prototype.withFaceDescriptors=function(){return new HN(this,this.input)},e}(RZ),WPe=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i,o,s;return Bt(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),t?(r=t.detection,this.input instanceof at?[4,IN(this.input,[r])]:[3,3]):[2];case 2:return o=a.sent(),[3,5];case 3:return[4,AN(this.input,[r])];case 4:o=a.sent(),a.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return s=a.sent(),i.forEach(function(u){return u instanceof at&&u.dispose()}),[2,RN(t,s)]}})})},e.prototype.withFaceExpressions=function(){return new BN(this,this.input)},e.prototype.withAgeAndGender=function(){return new WN(this,this.input)},e.prototype.withFaceDescriptor=function(){return new GN(this,this.input)},e}(RZ),AZ=function(n){rn(e,n);function e(t,r){r===void 0&&(r=new tC);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e}(_x),HPe=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r,i,o;return Bt(this,function(s){switch(s.label){case 0:return t=this,r=t.input,i=t.options,i instanceof yZ?[4,ys.mtcnn.forward(r,i)]:[3,2];case 1:return[2,s.sent().map(function(a){return a.detection})];case 2:if(o=i instanceof wZ?function(a){return ys.tinyFaceDetector.locateFaces(a,i)}:i instanceof tC?function(a){return ys.ssdMobilenetv1.locateFaces(a,i)}:i instanceof CN?function(a){return ys.tinyYolov2.locateFaces(a,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return Ot(t,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(s){return MN({},s)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new VPe(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new LN(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new UN(this.runAndExtendWithFaceDetections(),this.input)},e}(AZ),GPe=function(n){rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return Ot(this,void 0,void 0,function(){var t,r;return Bt(this,function(i){switch(i.label){case 0:return[4,new HPe(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return Ot(t,void 0,void 0,function(){var i;return Bt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?MN({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new WPe(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new FN(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new zN(this.runAndExtendWithFaceDetection(),this.input)},e}(AZ);function $Pe(n,e){return e===void 0&&(e=new tC),new GPe(n,e)}function jPe(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(s){if(s instanceof oR)return s;if(s instanceof Float32Array)return new oR(o(),[s]);if(s.descriptor&&s.descriptor instanceof Float32Array)return new oR(o(),[s.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return jPe(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new D8(o,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new D8("unknown",t.distance)},n})();_u({},s4e,D4e);const XPe=`
varying vec2 vUv;
void main(){
  vUv = uv;
  gl_Position = vec4(position.xy, 0.0, 1.0);
}
`,qPe=`
precision highp float;
uniform vec3 iResolution;
uniform float iTime;
uniform vec2 uSkew;
uniform float uTilt;
uniform float uYaw;
uniform float uLineThickness;
uniform vec3 uLinesColor;
uniform vec3 uScanColor;
uniform float uGridScale;
uniform float uLineStyle;
uniform float uLineJitter;
uniform float uScanOpacity;
uniform float uScanDirection;
uniform float uNoise;
uniform float uBloomOpacity;
uniform float uScanGlow;
uniform float uScanSoftness;
uniform float uPhaseTaper;
uniform float uScanDuration;
uniform float uScanDelay;
varying vec2 vUv;

uniform float uScanStarts[8];
uniform float uScanCount;

const int MAX_SCANS = 8;

float smoother01(float a, float b, float x){
  float t = clamp((x - a) / max(1e-5, (b - a)), 0.0, 1.0);
  return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}

void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
    vec2 p = (2.0 * fragCoord - iResolution.xy) / iResolution.y;

    vec3 ro = vec3(0.0);
    vec3 rd = normalize(vec3(p, 2.0));

    float cR = cos(uTilt), sR = sin(uTilt);
    rd.xy = mat2(cR, -sR, sR, cR) * rd.xy;

    float cY = cos(uYaw), sY = sin(uYaw);
    rd.xz = mat2(cY, -sY, sY, cY) * rd.xz;

    vec2 skew = clamp(uSkew, vec2(-0.7), vec2(0.7));
    rd.xy += skew * rd.z;

    vec3 color = vec3(0.0);
  float minT = 1e20;
  float gridScale = max(1e-5, uGridScale);
    float fadeStrength = 2.0;
    vec2 gridUV = vec2(0.0);

  float hitIsY = 1.0;
    for (int i = 0; i < 4; i++)
    {
        float isY = float(i < 2);
        float pos = mix(-0.2, 0.2, float(i)) * isY + mix(-0.5, 0.5, float(i - 2)) * (1.0 - isY);
        float num = pos - (isY * ro.y + (1.0 - isY) * ro.x);
        float den = isY * rd.y + (1.0 - isY) * rd.x;
        float t = num / den;
        vec3 h = ro + rd * t;

        float depthBoost = smoothstep(0.0, 3.0, h.z);
        h.xy += skew * 0.15 * depthBoost;

    bool use = t > 0.0 && t < minT;
    gridUV = use ? mix(h.zy, h.xz, isY) / gridScale : gridUV;
    minT = use ? t : minT;
    hitIsY = use ? isY : hitIsY;
    }

    vec3 hit = ro + rd * minT;
    float dist = length(hit - ro);

  float jitterAmt = clamp(uLineJitter, 0.0, 1.0);
  if (jitterAmt > 0.0) {
    vec2 j = vec2(
      sin(gridUV.y * 2.7 + iTime * 1.8),
      cos(gridUV.x * 2.3 - iTime * 1.6)
    ) * (0.15 * jitterAmt);
    gridUV += j;
  }
  float fx = fract(gridUV.x);
  float fy = fract(gridUV.y);
  float ax = min(fx, 1.0 - fx);
  float ay = min(fy, 1.0 - fy);
  float wx = fwidth(gridUV.x);
  float wy = fwidth(gridUV.y);
  float halfPx = max(0.0, uLineThickness) * 0.5;

  float tx = halfPx * wx;
  float ty = halfPx * wy;

  float aax = wx;
  float aay = wy;

  float lineX = 1.0 - smoothstep(tx, tx + aax, ax);
  float lineY = 1.0 - smoothstep(ty, ty + aay, ay);
  if (uLineStyle > 0.5) {
    float dashRepeat = 4.0;
    float dashDuty = 0.5;
    float vy = fract(gridUV.y * dashRepeat);
    float vx = fract(gridUV.x * dashRepeat);
    float dashMaskY = step(vy, dashDuty);
    float dashMaskX = step(vx, dashDuty);
    if (uLineStyle < 1.5) {
      lineX *= dashMaskY;
      lineY *= dashMaskX;
    } else {
      float dotRepeat = 6.0;
      float dotWidth = 0.18;
      float cy = abs(fract(gridUV.y * dotRepeat) - 0.5);
      float cx = abs(fract(gridUV.x * dotRepeat) - 0.5);
      float dotMaskY = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.y * dotRepeat), cy);
      float dotMaskX = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.x * dotRepeat), cx);
      lineX *= dotMaskY;
      lineY *= dotMaskX;
    }
  }
  float primaryMask = max(lineX, lineY);

  vec2 gridUV2 = (hitIsY > 0.5 ? hit.xz : hit.zy) / gridScale;
  if (jitterAmt > 0.0) {
    vec2 j2 = vec2(
      cos(gridUV2.y * 2.1 - iTime * 1.4),
      sin(gridUV2.x * 2.5 + iTime * 1.7)
    ) * (0.15 * jitterAmt);
    gridUV2 += j2;
  }
  float fx2 = fract(gridUV2.x);
  float fy2 = fract(gridUV2.y);
  float ax2 = min(fx2, 1.0 - fx2);
  float ay2 = min(fy2, 1.0 - fy2);
  float wx2 = fwidth(gridUV2.x);
  float wy2 = fwidth(gridUV2.y);
  float tx2 = halfPx * wx2;
  float ty2 = halfPx * wy2;
  float aax2 = wx2;
  float aay2 = wy2;
  float lineX2 = 1.0 - smoothstep(tx2, tx2 + aax2, ax2);
  float lineY2 = 1.0 - smoothstep(ty2, ty2 + aay2, ay2);
  if (uLineStyle > 0.5) {
    float dashRepeat2 = 4.0;
    float dashDuty2 = 0.5;
    float vy2m = fract(gridUV2.y * dashRepeat2);
    float vx2m = fract(gridUV2.x * dashRepeat2);
    float dashMaskY2 = step(vy2m, dashDuty2);
    float dashMaskX2 = step(vx2m, dashDuty2);
    if (uLineStyle < 1.5) {
      lineX2 *= dashMaskY2;
      lineY2 *= dashMaskX2;
    } else {
      float dotRepeat2 = 6.0;
      float dotWidth2 = 0.18;
      float cy2 = abs(fract(gridUV2.y * dotRepeat2) - 0.5);
      float cx2 = abs(fract(gridUV2.x * dotRepeat2) - 0.5);
      float dotMaskY2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.y * dotRepeat2), cy2);
      float dotMaskX2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.x * dotRepeat2), cx2);
      lineX2 *= dotMaskY2;
      lineY2 *= dotMaskX2;
    }
  }
    float altMask = max(lineX2, lineY2);

    float edgeDistX = min(abs(hit.x - (-0.5)), abs(hit.x - 0.5));
    float edgeDistY = min(abs(hit.y - (-0.2)), abs(hit.y - 0.2));
    float edgeDist = mix(edgeDistY, edgeDistX, hitIsY);
    float edgeGate = 1.0 - smoothstep(gridScale * 0.5, gridScale * 2.0, edgeDist);
    altMask *= edgeGate;

  float lineMask = max(primaryMask, altMask);

    float fade = exp(-dist * fadeStrength);

    float dur = max(0.05, uScanDuration);
    float del = max(0.0, uScanDelay);
    float scanZMax = 2.0;
    float widthScale = max(0.1, uScanGlow);
    float sigma = max(0.001, 0.18 * widthScale * uScanSoftness);
    float sigmaA = sigma * 2.0;

    float combinedPulse = 0.0;
    float combinedAura = 0.0;

    float cycle = dur + del;
    float tCycle = mod(iTime, cycle);
    float scanPhase = clamp((tCycle - del) / dur, 0.0, 1.0);
    float phase = scanPhase;
    if (uScanDirection > 0.5 && uScanDirection < 1.5) {
      phase = 1.0 - phase;
    } else if (uScanDirection > 1.5) {
      float t2 = mod(max(0.0, iTime - del), 2.0 * dur);
      phase = (t2 < dur) ? (t2 / dur) : (1.0 - (t2 - dur) / dur);
    }
    float scanZ = phase * scanZMax;
    float dz = abs(hit.z - scanZ);
    float lineBand = exp(-0.5 * (dz * dz) / (sigma * sigma));
    float taper = clamp(uPhaseTaper, 0.0, 0.49);
    float headW = taper;
    float tailW = taper;
    float headFade = smoother01(0.0, headW, phase);
    float tailFade = 1.0 - smoother01(1.0 - tailW, 1.0, phase);
    float phaseWindow = headFade * tailFade;
    float pulseBase = lineBand * phaseWindow;
    combinedPulse += pulseBase * clamp(uScanOpacity, 0.0, 1.0);
    float auraBand = exp(-0.5 * (dz * dz) / (sigmaA * sigmaA));
    combinedAura += (auraBand * 0.25) * phaseWindow * clamp(uScanOpacity, 0.0, 1.0);

    for (int i = 0; i < MAX_SCANS; i++) {
      if (float(i) >= uScanCount) break;
      float tActiveI = iTime - uScanStarts[i];
      float phaseI = clamp(tActiveI / dur, 0.0, 1.0);
      if (uScanDirection > 0.5 && uScanDirection < 1.5) {
        phaseI = 1.0 - phaseI;
      } else if (uScanDirection > 1.5) {
        phaseI = (phaseI < 0.5) ? (phaseI * 2.0) : (1.0 - (phaseI - 0.5) * 2.0);
      }
      float scanZI = phaseI * scanZMax;
      float dzI = abs(hit.z - scanZI);
      float lineBandI = exp(-0.5 * (dzI * dzI) / (sigma * sigma));
      float headFadeI = smoother01(0.0, headW, phaseI);
      float tailFadeI = 1.0 - smoother01(1.0 - tailW, 1.0, phaseI);
      float phaseWindowI = headFadeI * tailFadeI;
      combinedPulse += lineBandI * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
      float auraBandI = exp(-0.5 * (dzI * dzI) / (sigmaA * sigmaA));
      combinedAura += (auraBandI * 0.25) * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
    }

  float lineVis = lineMask;
  vec3 gridCol = uLinesColor * lineVis * fade;
  vec3 scanCol = uScanColor * combinedPulse;
  vec3 scanAura = uScanColor * combinedAura;

    color = gridCol + scanCol + scanAura;

  float n = fract(sin(dot(gl_FragCoord.xy + vec2(iTime * 123.4), vec2(12.9898,78.233))) * 43758.5453123);
  color += (n - 0.5) * uNoise;
  color = clamp(color, 0.0, 1.0);
  float alpha = clamp(max(lineVis, combinedPulse), 0.0, 1.0);
  float gx = 1.0 - smoothstep(tx * 2.0, tx * 2.0 + aax * 2.0, ax);
  float gy = 1.0 - smoothstep(ty * 2.0, ty * 2.0 + aay * 2.0, ay);
  float halo = max(gx, gy) * fade;
  alpha = max(alpha, halo * clamp(uBloomOpacity, 0.0, 1.0));
  fragColor = vec4(color, alpha);
}

void main(){
  vec4 c;
  mainImage(c, vUv * iResolution.xy);
  gl_FragColor = c;
}
`,YPe=({enableWebcam:n=!1,showPreview:e=!1,modelsPath:t="https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights",sensitivity:r=.55,lineThickness:i=1,linesColor:o="#392e4e",scanColor:s="#FF9FFC",scanOpacity:a=.4,gridScale:u=.1,lineStyle:l="solid",lineJitter:c=.1,scanDirection:h="pingpong",enablePost:f=!0,bloomIntensity:d=0,bloomThreshold:p=0,bloomSmoothing:v=0,chromaticAberration:g=.002,noiseIntensity:m=.01,scanGlow:x=.5,scanSoftness:_=2,scanPhaseTaper:b=.9,scanDuration:S=2,scanDelay:E=2,enableGyro:C=!1,scanOnClick:R=!1,snapBackDelay:T=250,className:A,style:P})=>{const k=H.useRef(null),W=H.useRef(null),N=H.useRef(null),O=H.useRef(null),z=H.useRef(null),V=H.useRef(null),F=H.useRef(null),U=H.useRef(null),[L,j]=H.useState(!1),[Q,K]=H.useState(!1),ie=H.useRef(new De(0,0)),pe=H.useRef(0),we=H.useRef(0),ce=H.useRef(new De(0,0)),_e=H.useRef(new De(0,0)),Oe=H.useRef(0),Ve=H.useRef(0),Ne=H.useRef(0),Z=H.useRef(0),de=8,me=H.useRef([]),Ie=Ue=>{const We=me.current.slice();if(We.length>=de&&We.shift(),We.push(Ue),me.current=We,O.current){const Le=O.current.uniforms,yt=new Array(de).fill(0);for(let rt=0;rt<We.length&&rt<de;rt++)yt[rt]=We[rt];Le.uScanStarts.value=yt,Le.uScanCount.value=We.length}},xe=H.useRef([]),se=H.useRef([]),Xe=H.useRef([]),X=H.useRef([]),$=zs.clamp(r,0,1),le=zs.lerp(.06,.2,$),ze=zs.lerp(.12,.3,$),Te=zs.lerp(.1,.28,$),J=zs.lerp(.25,.45,$),be=zs.lerp(.45,.12,$),ke=1/0,He=zs.lerp(1.2,1.6,$);return H.useEffect(()=>{const Ue=k.current;if(!Ue)return;let We=null;const Le=ot=>{if(Q)return;We&&(clearTimeout(We),We=null);const Je=Ue.getBoundingClientRect(),Wt=(ot.clientX-Je.left)/Je.width*2-1,jt=-((ot.clientY-Je.top)/Je.height*2-1);ie.current.set(Wt,jt)},yt=async()=>{const ot=performance.now()/1e3;if(R&&Ie(ot),C&&typeof window<"u"&&window.DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission)try{await DeviceOrientationEvent.requestPermission()}catch{}},rt=()=>{We&&(clearTimeout(We),We=null)},dt=()=>{Q||(We&&clearTimeout(We),We=window.setTimeout(()=>{ie.current.set(0,0),pe.current=0,we.current=0},Math.max(0,T||0)))};return Ue.addEventListener("mousemove",Le),Ue.addEventListener("mouseenter",rt),R&&Ue.addEventListener("click",yt),Ue.addEventListener("mouseleave",dt),()=>{Ue.removeEventListener("mousemove",Le),Ue.removeEventListener("mouseenter",rt),Ue.removeEventListener("mouseleave",dt),R&&Ue.removeEventListener("click",yt),We&&clearTimeout(We)}},[Q,T,R,C]),H.useEffect(()=>{const Ue=k.current;if(!Ue)return;const We=new hg({antialias:!0,alpha:!0});N.current=We,We.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),We.setSize(Ue.clientWidth,Ue.clientHeight),We.outputColorSpace=Rn,We.toneMapping=wu,We.autoClear=!1,We.setClearColor(0,0),Ue.appendChild(We.domElement);const Le={iResolution:{value:new ne(Ue.clientWidth,Ue.clientHeight,We.getPixelRatio())},iTime:{value:0},uSkew:{value:new De(0,0)},uTilt:{value:0},uYaw:{value:0},uLineThickness:{value:i},uLinesColor:{value:c_(o)},uScanColor:{value:c_(s)},uGridScale:{value:u},uLineStyle:{value:l==="dashed"?1:l==="dotted"?2:0},uLineJitter:{value:Math.max(0,Math.min(1,c||0))},uScanOpacity:{value:a},uNoise:{value:m},uBloomOpacity:{value:d},uScanGlow:{value:x},uScanSoftness:{value:_},uPhaseTaper:{value:b},uScanDuration:{value:S},uScanDelay:{value:E},uScanDirection:{value:h==="backward"?1:h==="pingpong"?2:0},uScanStarts:{value:new Array(de).fill(0)},uScanCount:{value:0}},yt=new pi({uniforms:Le,vertexShader:XPe,fragmentShader:qPe,transparent:!0,depthWrite:!1,depthTest:!1});O.current=yt;const rt=new vc,dt=new af(-1,1,1,-1,0,1),ot=new yr(new fl(2,2),yt);rt.add(ot);let Je=null;if(f){Je=new j1e(We),z.current=Je;const nt=new qxe(rt,dt);Je.addPass(nt);const Ye=new Gxe({intensity:1,luminanceThreshold:p,luminanceSmoothing:v});Ye.blendMode.opacity.value=Math.max(0,d),V.current=Ye;const ae=new Xxe({offset:new De(g,g),radialModulation:!0,modulationOffset:0});F.current=ae;const Ze=new Jxe(dt,Ye,ae);Ze.renderToScreen=!0,Je.addPass(Ze)}const Wt=()=>{We.setSize(Ue.clientWidth,Ue.clientHeight),yt.uniforms.iResolution.value.set(Ue.clientWidth,Ue.clientHeight,We.getPixelRatio()),z.current&&z.current.setSize(Ue.clientWidth,Ue.clientHeight)};window.addEventListener("resize",Wt);let jt=performance.now();const yn=()=>{const nt=performance.now(),Ye=Math.max(0,Math.min(.1,(nt-jt)/1e3));jt=nt,ce.current.copy(KPe(ce.current,ie.current,_e.current,be,ke,Ye));const ae=N8(Oe.current,pe.current,{v:Ve.current},be,ke,Ye);Oe.current=ae.value,Ve.current=ae.v;const Ze=N8(Ne.current,we.current,{v:Z.current},be,ke,Ye);Ne.current=Ze.value,Z.current=Ze.v;const et=new De(ce.current.x*le,-ce.current.y*He*le);yt.uniforms.uSkew.value.set(et.x,et.y),yt.uniforms.uTilt.value=Oe.current*ze,yt.uniforms.uYaw.value=zs.clamp(Ne.current*Te,-.6,.6),yt.uniforms.iTime.value=nt/1e3,We.clear(!0,!0,!0),z.current?z.current.render(Ye):We.render(rt,dt),U.current=requestAnimationFrame(yn)};return U.current=requestAnimationFrame(yn),()=>{U.current&&cancelAnimationFrame(U.current),window.removeEventListener("resize",Wt),yt.dispose(),ot.geometry.dispose(),z.current&&(z.current.dispose(),z.current=null),We.dispose(),Ue.removeChild(We.domElement)}},[r,i,o,s,a,u,l,c,h,f,m,d,x,_,b,S,E,p,v,g,be,ke,le,He,ze,Te]),H.useEffect(()=>{const Ue=O.current;if(Ue){const We=Ue.uniforms;We.uLineThickness.value=i,We.uLinesColor.value.copy(c_(o)),We.uScanColor.value.copy(c_(s)),We.uGridScale.value=u,We.uLineStyle.value=l==="dashed"?1:l==="dotted"?2:0,We.uLineJitter.value=Math.max(0,Math.min(1,c||0)),We.uBloomOpacity.value=Math.max(0,d),We.uNoise.value=Math.max(0,m),We.uScanGlow.value=x,We.uScanOpacity.value=Math.max(0,Math.min(1,a)),We.uScanDirection.value=h==="backward"?1:h==="pingpong"?2:0,We.uScanSoftness.value=_,We.uPhaseTaper.value=b,We.uScanDuration.value=Math.max(.05,S),We.uScanDelay.value=Math.max(0,E)}V.current&&(V.current.blendMode.opacity.value=Math.max(0,d),V.current.luminanceMaterial.threshold=p,V.current.luminanceMaterial.smoothing=v),F.current&&F.current.offset.set(g,g)},[i,o,s,u,l,c,d,p,v,g,m,x,a,h,_,b,S,E]),H.useEffect(()=>{if(!C)return;const Ue=We=>{if(Q)return;const Le=We.gamma??0,yt=We.beta??0,rt=zs.clamp(Le/45,-1,1),dt=zs.clamp(-yt/30,-1,1);ie.current.set(rt,dt),pe.current=zs.degToRad(Le)*.4};return window.addEventListener("deviceorientation",Ue),()=>{window.removeEventListener("deviceorientation",Ue)}},[C,Q]),H.useEffect(()=>{let Ue=!1;return(async()=>{try{await Promise.all([ys.tinyFaceDetector.loadFromUri(t),ys.faceLandmark68TinyNet.loadFromUri(t)]),Ue||j(!0)}catch{Ue||j(!1)}})(),()=>{Ue=!0}},[t]),H.useEffect(()=>{let Ue=!1,We=0;const Le=W.current;return(async()=>{if(!n||!L||!Le)return;try{const ot=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},audio:!1});Le.srcObject=ot,await Le.play()}catch{return}const rt=new wZ({inputSize:320,scoreThreshold:.5}),dt=async ot=>{if(!Ue){if(ot-We>=33){We=ot;try{const Je=await $Pe(Le,rt).withFaceLandmarks(!0);if(Je&&Je.detection){const jt=Je.detection.box,yn=Le.videoWidth||1,nt=Le.videoHeight||1,Ye=jt.x+jt.width*.5,ae=jt.y+jt.height*.5,Ze=Ye/yn*2-1,et=ae/nt*2-1;h_(xe.current,Ze,5),h_(se.current,et,5);const Nt=f_(xe.current),Tt=f_(se.current),hn=new De(Math.tanh(Nt),Math.tanh(Tt)),Sn=Math.min(1,Math.hypot(jt.width/yn,jt.height/nt)),mt=1+J*(Sn-.25);ie.current.copy(hn.multiplyScalar(mt));const ft=Je.landmarks.getLeftEye(),Mt=Je.landmarks.getRightEye(),Ke=L8(ft),Rt=L8(Mt),It=Math.atan2(Rt.y-Ke.y,Rt.x-Ke.x);h_(Xe.current,It,5),pe.current=f_(Xe.current);const Gt=Je.landmarks.getNose(),tr=Gt[Gt.length-1]||Gt[Math.floor(Gt.length/2)],qt=Je.landmarks.getJawOutline(),qn=qt[3]||qt[2],Sr=qt[13]||qt[14],Qn=F8(tr,qn),Yn=F8(tr,Sr),Nn=Math.hypot(Rt.x-Ke.x,Rt.y-Ke.y)+1e-6;let mi=zs.clamp((Yn-Qn)/(Nn*1.6),-1,1);mi=Math.tanh(mi),h_(X.current,mi,5),we.current=f_(X.current),K(!0)}else K(!1)}catch{K(!1)}}"requestVideoFrameCallback"in HTMLVideoElement.prototype?Le.requestVideoFrameCallback(()=>dt(performance.now())):requestAnimationFrame(dt)}};requestAnimationFrame(dt)})(),()=>{if(Ue=!0,Le){const rt=Le.srcObject;rt&&rt.getTracks().forEach(dt=>dt.stop()),Le.pause(),Le.srcObject=null}}},[n,L,J]),G.jsx("div",{ref:k,className:`relative w-full h-full overflow-hidden ${A??""}`,style:P,children:e&&G.jsxs("div",{className:"absolute right-3 bottom-3 w-[220px] h-[132px] rounded-lg overflow-hidden border border-white/25 shadow-[0_4px_16px_rgba(0,0,0,0.4)] bg-black text-white text-[12px] leading-[1.2] font-sans pointer-events-none",children:[G.jsx("video",{ref:W,muted:!0,playsInline:!0,autoPlay:!0,className:"w-full h-full object-cover -scale-x-100"}),G.jsx("div",{className:"absolute left-2 top-2 px-[6px] py-[2px] bg-black/50 rounded-[6px] backdrop-blur-[4px]",children:n?L?Q?"Face: tracking":"Face: searching":"Loading models":"Webcam disabled"})]})})};function c_(n){return new ct(n).convertSRGBToLinear()}function KPe(n,e,t,r,i,o){const s=n.clone();r=Math.max(1e-4,r);const a=2/r,u=a*o,l=1/(1+u+.48*u*u+.235*u*u*u);let c=n.clone().sub(e);const h=e.clone(),f=i*r;c.length()>f&&c.setLength(f),e=n.clone().sub(c);const d=t.clone().addScaledVector(c,a).multiplyScalar(o);t.sub(d.clone().multiplyScalar(a)),t.multiplyScalar(l),s.copy(e.clone().add(c.add(d).multiplyScalar(l)));const p=h.clone().sub(n),v=s.clone().sub(h);return p.dot(v)>0&&(s.copy(h),t.set(0,0)),s}function N8(n,e,t,r,i,o){r=Math.max(1e-4,r);const s=2/r,a=s*o,u=1/(1+a+.48*a*a+.235*a*a*a);let l=n-e;const c=e,h=i*r;l=Math.sign(l)*Math.min(Math.abs(l),h),e=n-l;const f=(t.v+s*l)*o;t.v=(t.v-s*f)*u;let d=e+(l+f)*u;const p=c-n,v=d-c;return p*v>0&&(d=c,t.v=0),{value:d,v:t.v}}function h_(n,e,t){n.push(e),n.length>t&&n.shift()}function f_(n){if(n.length===0)return 0;const e=[...n].sort((r,i)=>r-i),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])*.5}function L8(n){let e=0,t=0;const r=n.length||1;for(const i of n)e+=i.x,t+=i.y;return{x:e/r,y:t/r}}function F8(n,e){return Math.hypot(n.x-e.x,n.y-e.y)}const ZPe=({onLoadComplete:n,isMobile:e=!1})=>{const[t,r]=H.useState(0),[i,o]=H.useState("Initializing..."),[s,a]=H.useState(!1);return H.useEffect(()=>{let f=0;const d=setInterval(()=>{f+=1.25,f>=100?(f=100,clearInterval(d),o("Complete!"),setTimeout(()=>{a(!0),setTimeout(()=>{n&&n()},800)},300)):f<30?o("Initializing..."):f<60?o("Loading assets..."):f<90?o("Almost there..."):o("Finalizing..."),r(Math.min(f,100))},50);return()=>clearInterval(d)},[n]),G.jsxs("div",{className:`loader-container ${s?"loader-exit":""}`,children:[G.jsx("div",{className:"absolute inset-0 z-0",children:G.jsx(YPe,{sensitivity:.55,lineThickness:1,linesColor:"#1a1a2e",gridScale:.1,scanColor:"#FF9FFC",scanOpacity:.4,enablePost:!0,bloomIntensity:.6,chromaticAberration:.002,noiseIntensity:.01})}),G.jsxs("div",{className:"loader-content",children:[G.jsxs("div",{className:"brand-container",children:[G.jsx("h1",{className:"brand-name",children:"Mayank Kumar"}),G.jsx("p",{className:"brand-subtitle",children:"Portfolio"})]}),G.jsx("div",{className:"progress-container",children:G.jsx("div",{className:"progress-bar-wrapper",children:G.jsx("div",{className:"progress-bar-bg",children:G.jsx("div",{className:"progress-bar-fill",style:{width:`${t}%`}})})})}),G.jsxs("div",{className:"loading-dots",children:[G.jsx("span",{className:"dot"}),G.jsx("span",{className:"dot"}),G.jsx("span",{className:"dot"})]})]}),G.jsx("div",{className:"corner-decoration top-left"}),G.jsx("div",{className:"corner-decoration top-right"}),G.jsx("div",{className:"corner-decoration bottom-left"}),G.jsx("div",{className:"corner-decoration bottom-right"})]})},QPe=({onDismiss:n})=>{const[e,t]=H.useState(!0),[r,i]=H.useState(!1),o=()=>{i(!0),setTimeout(()=>{t(!1),sessionStorage.setItem("mobileAlertDismissed","true"),n&&n()},300)};return e?G.jsxs("div",{className:`fixed inset-0 z-[10000] flex items-center justify-center bg-[#0a0a0f]/98 backdrop-blur-xl transition-opacity duration-300 ${r?"opacity-0":"opacity-100"}`,children:[G.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[G.jsx("div",{className:"absolute top-1/4 left-1/4 w-64 h-64 bg-primary/10 rounded-full blur-3xl animate-pulse"}),G.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-64 h-64 bg-secondary/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),G.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-tertiary/5 rounded-full blur-3xl animate-pulse",style:{animationDelay:"0.5s"}})]}),G.jsxs("div",{className:"relative z-10 px-8 py-12 max-w-sm mx-4 text-center",children:[G.jsx("div",{className:"mb-8 flex justify-center",children:G.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-secondary/20 border border-primary/30 flex items-center justify-center",children:G.jsx("svg",{className:"w-10 h-10 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:G.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})})}),G.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary via-secondary to-tertiary bg-clip-text text-transparent mb-4",children:"Desktop Recommended"}),G.jsx("p",{className:"text-gray-400 text-base leading-relaxed mb-10",children:"For the best experience, please open this website on a laptop or desktop."}),G.jsx("button",{onClick:o,className:"px-8 py-4 rounded-full bg-gradient-to-r from-surface/80 to-surface-light/80 border border-white/10 text-gray-300 font-medium text-sm transition-all duration-300 hover:border-primary/30 hover:text-white active:scale-95",children:"Ruin My Experience"})]})]}):null},JPe=()=>{const[n,e]=H.useState(!1);return H.useEffect(()=>{const t=()=>{e(window.innerWidth<=768)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),n};function eke(){Ru();const n=JPe(),[e,t]=H.useState(()=>typeof window>"u"?!1:!sessionStorage.getItem("mobileAlertDismissed")&&window.innerWidth<=768),[r,i]=H.useState(()=>{const a=window.location.pathname==="/",u=sessionStorage.getItem("loaderShown"),l=sessionStorage.getItem("mobileAlertDismissed");return window.innerWidth<=768&&!l?!1:a&&!u});H.useEffect(()=>{r&&sessionStorage.setItem("loaderShown","true")},[r]);const o=()=>{i(!1)},s=()=>{t(!1);const a=window.location.pathname==="/",u=sessionStorage.getItem("loaderShown");a&&!u&&i(!0)};return e&&n?G.jsx(QPe,{onDismiss:s}):r?G.jsx(ZPe,{onLoadComplete:o,isMobile:n}):G.jsxs("div",{className:`w-full min-h-screen bg-[#0a0a0f] ${n?"overflow-y-auto overflow-x-hidden":"h-screen overflow-hidden"}`,children:[!n&&G.jsx(B1e,{}),n?G.jsx(O1e,{}):G.jsx(F1e,{}),G.jsxs(Gte,{children:[G.jsx(hm,{path:"/",element:G.jsx(age,{})}),G.jsx(hm,{path:"/about",element:G.jsx(hge,{})}),G.jsx(hm,{path:"/projects",element:G.jsx(L1e,{})}),G.jsx(hm,{path:"/skills",element:G.jsx(Nye,{})}),G.jsx(hm,{path:"/contact",element:G.jsx(rye,{})})]})]})}function tke(){return G.jsx(pne,{children:G.jsx(eke,{})})}ZW(document.getElementById("root")).render(G.jsx(H.StrictMode,{children:G.jsx(tke,{})}))});export default nke();
